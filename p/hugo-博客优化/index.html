<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="为博客做了一些简单自定义更新与优化"><title>Hugo 博客优化</title>
<link rel=canonical href=https://zeddyu.github.io/p/hugo-%E5%8D%9A%E5%AE%A2%E4%BC%98%E5%8C%96/><link rel=stylesheet href=https://cdn.zdy.world/gh/zeddyu/zeddyu.github.io///scss/style.min.css integrity="sha256-fF7AdIPMSCGGaIS7UZHBfGQpV0YU38aZCzY1ucpb+iU=" crossorigin=anonymous><meta property='og:title' content="Hugo 博客优化"><meta property='og:description' content="为博客做了一些简单自定义更新与优化"><meta property='og:url' content='https://zeddyu.github.io/p/hugo-%E5%8D%9A%E5%AE%A2%E4%BC%98%E5%8C%96/'><meta property='og:site_name' content="Zeddy's Blog"><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:published_time' content='2025-01-05T16:22:56+08:00'><meta property='article:modified_time' content='2025-01-05T16:22:56+08:00'><meta name=twitter:title content="Hugo 博客优化"><meta name=twitter:description content="为博客做了一些简单自定义更新与优化"><link rel="shortcut icon" href=/favicon.ico><style>body:has(.article-content){.article-readmore { display: none; }}</style><script>enScroll=!1,enFdl=!1,extCurrent=void 0,filename=void 0,targetText=void 0,splitOrigin=void 0;const lStor=localStorage,sStor=sessionStorage,doc=document,docEl=document.documentElement,docBody=document.body,docLoc=document.location,w=window,s=screen,nav=navigator||{},extensions=["pdf","xls","xlsx","doc","docx","txt","rtf","csv","exe","key","pps","ppt","pptx","7z","pkg","rar","gz","zip","avi","mov","mp4","mpe","mpeg","wmv","mid","midi","mp3","wav","wma"];function a(e,t,n,o){const j="G-PDESKL57LT",r=()=>Math.floor(Math.random()*1e9)+1,c=()=>Math.floor(Date.now()/1e3),F=()=>(sStor._p||(sStor._p=r()),sStor._p),E=()=>r()+"."+c(),_=()=>(lStor.cid_v4||(lStor.cid_v4=E()),lStor.cid_v4),m=lStor.getItem("cid_v4"),v=()=>m?void 0:enScroll==!0?void 0:"1",p=()=>(sStor.sid||(sStor.sid=c()),sStor.sid),O=()=>{if(!sStor._ss)return sStor._ss="1",sStor._ss;if(sStor.getItem("_ss")=="1")return void 0},a="1",g=()=>{if(sStor.sct)if(enScroll==!0)return sStor.sct;else x=+sStor.getItem("sct")+ +a,sStor.sct=x;else sStor.sct=a;return sStor.sct},i=docLoc.search,b=new URLSearchParams(i),h=["q","s","search","query","keyword"],y=h.some(e=>i.includes("&"+e+"=")||i.includes("?"+e+"=")),u=()=>y==!0?"view_search_results":enScroll==!0?"scroll":enFdl==!0?"file_download":"page_view",f=()=>enScroll==!0?"90":void 0,C=()=>{if(u()=="view_search_results"){for(let e of b)if(h.includes(e[0]))return e[1]}else return void 0},d=encodeURIComponent,k=e=>{let t=[];for(let n in e)e.hasOwnProperty(n)&&e[n]!==void 0&&t.push(d(n)+"="+d(e[n]));return t.join("&")},A=!1,S="https://ga.zdy.one/collect_path",M=k({v:"2",tid:j,_p:F(),sr:(s.width*w.devicePixelRatio+"x"+s.height*w.devicePixelRatio).toString(),ul:(nav.language||void 0).toLowerCase(),cid:_(),_fv:v(),_s:"1",dl:docLoc.origin+docLoc.pathname+i,dt:doc.title||void 0,dr:doc.referrer||void 0,sid:p(),sct:g(),seg:"1",en:u(),"epn.percent_scrolled":f(),"ep.search_term":C(),"ep.file_extension":e||void 0,"ep.file_name":t||void 0,"ep.link_text":n||void 0,"ep.link_url":o||void 0,_ss:O(),_dbg:A?1:void 0}),l=S+"?"+M;if(nav.sendBeacon)nav.sendBeacon(l);else{let e=new XMLHttpRequest;e.open("POST",l,!0)}}a();function sPr(){return(docEl.scrollTop||docBody.scrollTop)/((docEl.scrollHeight||docBody.scrollHeight)-docEl.clientHeight)*100}doc.addEventListener("scroll",sEv,{passive:!0});function sEv(){const e=sPr();if(e<90)return;enScroll=!0,a(),doc.removeEventListener("scroll",sEv,{passive:!0}),enScroll=!1}document.addEventListener("DOMContentLoaded",function(){let e=document.getElementsByTagName("a");for(let t=0;t<e.length;t++)if(e[t].getAttribute("href")!=null){const n=e[t].getAttribute("href"),s=n.substring(n.lastIndexOf("/")+1),o=s.split(".").pop();(e[t].hasAttribute("download")||extensions.includes(o))&&e[t].addEventListener("click",fDl,{passive:!0})}});function fDl(e){enFdl=!0;const t=e.currentTarget.getAttribute("href"),n=t.substring(t.lastIndexOf("/")+1),s=n.split(".").pop(),o=n.replace("."+s,""),i=e.currentTarget.text,r=t.replace(docLoc.origin,"");a(s,o,i,r),enFdl=!1}</script></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky compact"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=https://cdn.zdy.world/gh/zeddyu/zeddyu.github.io//img/avatar_hu_7feaa59b2ccb17f7.webp width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>Zeddy's Blog</a></h1><h2 class=site-description></h2></div></header><ol class=menu-social><li><a href=https://github.com/ZeddYu target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://zeddyu.github.io/atom.xml target=_blank title=Rss rel=me><svg class="icon icon-tabler icon-tabler-rss" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="5" cy="19" r="1"/><path d="M4 4a16 16 0 0116 16"/><path d="M4 11a9 9 0 019 9"/></svg></a></li><li><a href=https://x.com/ZeddYu_Lu target=_blank title=Twitter rel=me><svg class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84.0 00.497-3.753C20.18 7.773 21.692 5.25 22 4.009z"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/about/><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>About</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/ads/><svg class="icon icon-tabler icon-tabler-ad" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><rect x="3" y="5" width="18" height="14" rx="2"/><path d="M7 15v-4a2 2 0 014 0v4"/><line x1="7" y1="13" x2="11" y2="13"/><path d="M17 9v6h-1.5a1.5 1.5.0 111.5-1.5"/></svg>
<span>Advertisement</span></a></li><li><a href=/links/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#tldr>TL;DR</a></li><li><a href=#domain>Domain</a></li><li><a href=#cloudflare>Cloudflare</a><ol><li><a href=#static-files-acceleration>Static Files Acceleration</a></li><li><a href=#traffic-diversion>Traffic Diversion</a></li><li><a href=#oss-s3-cloudflare-r2>OSS? S3? Cloudflare R2!</a></li><li><a href=#cloudflare-workers>Cloudflare Workers</a></li></ol></li><li><a href=#theme-optimization>Theme Optimization</a><ol><li><a href=#cdn>CDN</a></li><li><a href=#google-analytics-4>Google Analytics 4</a></li><li><a href=#service-worker>Service Worker</a></li><li><a href=#speculation-rules>Speculation Rules</a></li><li><a href=#other-optimizations>Other Optimizations</a></li></ol></li><li><a href=#summary>Summary</a></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/dev/ style=background-color:#06c;color:#fff>Dev</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/hugo-%E5%8D%9A%E5%AE%A2%E4%BC%98%E5%8C%96/>Hugo 博客优化</a></h2><div class=article-subtitle>为博客做了一些简单自定义更新与优化</div></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Jan 05, 2025</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>13 minute read</time></div><div class=article-readmore><a href=/p/hugo-%E5%8D%9A%E5%AE%A2%E4%BC%98%E5%8C%96/>Read More…</a></div></footer></div></header><section class=article-content><p>由于自己很久没更新博客了，加上之前用的博客主题也更新了挺多，自己便趁放假的这段时间为自己的博客主题跟进了一些更新，也做了一些自定义，花了几天时间终于到达一个勉强令自己满意的程度。</p><h2 id=tldr>TL;DR</h2><p>本文主要从以下几个方面对自己托管在 Github Page 上的 Hugo 博客进行了优化：</p><ul><li>大部分静态资源 (CSS / JS / 图片) 加上了 Cloudflare CDN</li><li>将托管在 Cloudflare CDN 做了简单的国内外流量分流</li><li>使用对国内环境友好且免费够用的 Cloudflare R2 作为图床</li><li>使用 Cloudflare Workers 反代 Google Analytics 4</li><li>更新 Workbox 进行 Service Worker 缓存</li><li>增加 Quicklink 来提高页面加载效率</li></ul><p>还有一些则是自己在原来模板基础上，根据各种优化建议做的简单优化。</p><h2 id=domain>Domain</h2><p>关于域名，我放弃了之前自己精心维护的域名 zeddyu.info ，也不再考虑续费，以后就主要使用 zeddyu.github.io 的这个域名作为博客域名。一方面是因为自己这个域名除了搭建一个静态博客之外，也就是在各种 CTF 比赛中使用，用处其实并不多；另一方面当然就是由于域名捆绑问题，域名商一开始会提供一个很便宜的价格吸引你续费运营该域名，但是之后几年的续费价格连年飙升，这里我猜测是域名商一旦发现你的域名访问量增加到一定程度，便会坐地起价，极大抬高续费价格，这对于我一个不把域名或者其与之有关的附加途径（比如静态博客）作为高盈利手段的人来说有一些得不偿失，这也是促使我直接放弃该域名的直接原因。当然，如果你想要运营一个域名并想从中获利也是有一些渠道的，但是我确实不太想那么做，这里也不再细谈。</p><p>除此以外，虽然我放弃了运营自己的域名，但是我也会准备一个用完即换的域名，用作 Cloudflare 服务以备其他需要用到域名场合，后面就会使用这个域名配合 Cloudflare Free Plan 为自己的博客做一些加速服务。</p><style type=text/css>.notice{--title-color:#fff;--title-background-color:#6be;--content-color:#444;--content-background-color:#e7f2fa}.notice.info{--title-background-color:#fb7;--content-background-color:#fec}.notice.tip{--title-background-color:#5a5;--content-background-color:#efe}.notice.warning{--title-background-color:#c33;--content-background-color:#fee}@media(prefers-color-scheme:dark){.notice{--title-color:#fff;--title-background-color:#069;--content-color:#ddd;--content-background-color:#023}.notice.info{--title-background-color:#a50;--content-background-color:#420}.notice.tip{--title-background-color:#363;--content-background-color:#121}.notice.warning{--title-background-color:#800;--content-background-color:#400}}body.dark .notice{--title-color:#fff;--title-background-color:#069;--content-color:#ddd;--content-background-color:#023}body.dark .notice.info{--title-background-color:#a50;--content-background-color:#420}body.dark .notice.tip{--title-background-color:#363;--content-background-color:#121}body.dark .notice.warning{--title-background-color:#800;--content-background-color:#400}.notice{padding:18px;line-height:24px;margin-bottom:24px;border-radius:4px;color:var(--content-color);background:var(--content-background-color)}.notice p:last-child{margin-bottom:0}.notice-title{margin:-18px -18px 12px;padding:4px 18px;border-radius:4px 4px 0 0;font-weight:700;color:var(--title-color);background:var(--title-background-color)}.icon-notice{display:inline-flex;align-self:center;margin-right:8px}.icon-notice img,.icon-notice svg{height:1em;width:1em;fill:currentColor}.icon-notice img,.icon-notice.baseline svg{top:.125em;position:relative}</style><div class="notice info"><p class=notice-title><span class="icon-notice baseline"><svg viewBox="92 59.5 300 300"><path d="M292 303.25V272c0-3.516-2.734-6.25-6.25-6.25H267v-1e2c0-3.516-2.734-6.25-6.25-6.25h-62.5c-3.516.0-6.25 2.734-6.25 6.25V197c0 3.516 2.734 6.25 6.25 6.25H217v62.5h-18.75c-3.516.0-6.25 2.734-6.25 6.25v31.25c0 3.516 2.734 6.25 6.25 6.25h87.5c3.516.0 6.25-2.734 6.25-6.25zm-25-175V97c0-3.516-2.734-6.25-6.25-6.25h-37.5c-3.516.0-6.25 2.734-6.25 6.25v31.25c0 3.516 2.734 6.25 6.25 6.25h37.5c3.516.0 6.25-2.734 6.25-6.25zm125 81.25c0 82.813-67.188 150-150 150-82.813.0-150-67.188-150-150 0-82.813 67.188-150 150-150 82.813.0 150 67.188 150 150z"/></svg>
</span>Info</p><p>请不要直接把我文中或者本站的 CDN 域名应用到你的博客，因为我使用了一些自定义配置，并且不保证其长期正常运行</p></div><h2 id=cloudflare>Cloudflare</h2><p>Cloudflare (以下简称 CF )无疑是我认知范围内最慷慨的云厂商，不仅免费提供 CDN 服务，还提供了很多其他免费的（一定限额）云服务，可玩性非常高，我这几天仅仅是花了一些时间复刻了几个可以免费为自己博客加速的操作，就感觉到其中的操作非常多。</p><h3 id=static-files-acceleration>Static Files Acceleration</h3><p>这里我要首先介绍一下我目前博客的架构：</p><ul><li>仅使用 zeddyu.github.io 作为主域名。因为我放弃了运营主域名，所以不同于其他博客的操作，我不再直接使用自定义域名托管 CF 上直接为博客加速。</li><li>使用一个其他域名托管在 CF 上用作加速服务。加速主要考虑的是为博客的静态资源，静态资源主要分为 CSS / JS / 图片资源。<ul><li>css / js 资源可以考虑直接使用 jsdelivr 等其他第三方 CDN 服务直接加速<ul><li>其中有一些比较特殊，比如 Google Fonts 等资源，可能需要单独处理，比如使用 Proxy / 其他 CDN / 选择平替 <a class=link href=https://developers.cloudflare.com/speed/optimization/content/fonts/ target=_blank rel=noopener>Cloudflare Fonts</a></li></ul></li><li>图片资源可以针对性考虑。首先考虑博客读者的网络环境，可以针对性使用不同云服务运营商的免费、付费托管服务，当然也可以直接放在 github 上然后使用 jsdelivr 进行加速。</li></ul></li></ul><p>这里稍微提一下，因为一些博客说到如果使用 CF 服务加速 css / js 等静态资源可能反而是副作用，但是在我这种情况下，国内网络环境下使用 curl 请求 20 次，直接访问 github.io 下的静态资源，平均时间在 3-4s 左右，甚至有时候到达 7s ，在使用了以下的加速配置后平均时间在 1s 左右，虽然期间也出现过一次 20s 的情况，但是考虑到网络波动等情况，这种情况能够接受。在国外的网络情况下，我使用首尔的 VPS 以及香港的 CMHK 网络环境测试，基本都差不多，都能在 1s 内，平均 0.1s ，那基本就无所谓了。</p><h3 id=traffic-diversion>Traffic Diversion</h3><p>首先我们考虑比较重要的网站架构资源 CSS / JS 文件资源。我参考了一些资料，直接使用CF 的 CDN服务为这些资源加速，虽然 CF 的 CDN 服务对于国内表现不算优秀，但是可以用他的 CF Workers 配合 CDN 做一些分流措施，将国外国内流量分流至不同的 CDN 服务获得最佳的效果。主要参考文章: <a class=link href=https://www.haoyep.com/posts/github-graph-beds-cdn/ target=_blank rel=noopener>通过 Cloudflare 和 jsDelivr 免费加速博客 GitHub 图床等静态资源</a></p><ol><li><p>首先在 CF 上托管自己的域名，并添加一个 CNAME 记录指向 cdn.jsdmirror.com ，开启代理状态。以下我们以 cdn.zdy.one 举例说明。</p></li><li><p>再到 CF 规则 / 重定向规则中，添加两个规则。</p><ul><li>规则 1 ： 主要为分流国内流量，使用自定义筛选表达式，按照图中配置，主机名使用刚才我们填写的 cdn.zdy.one ，国家地区选择 China ，下方重定向填写 <code>concat("https://cdn.jsdmirror.com", http.request.uri.path)</code></li><li>规则 2 ：主要为分流国外流量，类似规则 1 配置，只不过把国家地区选择不等于 China ，并且下方重定向表达式改为 <code>concat("https://cdn.jsdelivr.net", http.request.uri.path)</code></li><li>以上步骤与参考文章步骤一致，更详细可以参考原文章。以下为我自己添加的配置</li></ul><p><img src=https://s21.ax1x.com/2025/01/04/pEp4lGR.png loading=lazy alt=pEp4lGR.png></p></li><li><p>为静态资源添加 CORS 头</p><ul><li>到 CF 面板 / 规则 / 转换规则 / 修改响应头 / 创建规则</li><li>选择自定义筛选表达式，并按图配置，主机选择我们的 cdn.zdy.one 域名，按需设置一个 CORS 头部。</li><li>设置这个主要是因为我的静态资源在被引入使用的时候，而通过上面的配置，静态资源是通过 302 实现的地区分流，然而浏览器会因为 302 而会抛出 CORS 错误，所以我们需要配置这个来解决 CORS 的问题。当然你也可以按需配置一些其他的</li></ul><p><img src=https://s21.ax1x.com/2025/01/04/pEp4Qi9.png loading=lazy alt=pEp4Qi9.png></p></li></ol><h3 id=oss-s3-cloudflare-r2>OSS? S3? Cloudflare R2!</h3><p>现在有很多免费的图床，虽然某些看起来可能不太可靠，但是有一些图床从我运营自己博客到现在，也一直持续了有几年时间，到目前(2025.1.3)为止，我印象里比较可靠的免费图床有：</p><ul><li>路过图床： <a class=link href=https://imgse.com/ target=_blank rel=noopener>https://imgse.com/</a></li><li>SM.MS： <a class=link href=https://sm.ms/ target=_blank rel=noopener>https://sm.ms/</a></li></ul><p>当然也可以一些付费服务，比如各种云厂商提供的付费对象存储服务，阿里云 OSS / AWS S3 ，甚至 Cloudflare 在我不知不觉间也推出了自己的对象存储服务 <a class=link href=https://www.cloudflare.com/developer-platform/products/r2/ target=_blank rel=noopener>Cloudflare R2</a>，甚至免费额度还挺不错；另外还有一些另辟蹊径的服务用作图床，比如 Onedrive 等。</p><p>这里我之前是使用腾讯云的 COS 对象存储服务，虽然确实花费比较少，每个月几毛或者几分，但是有时候访问量高起来也有几块钱的开销。之前我也有考虑过使用 CF CDN 配上 COS ，这样可以节省一些流量访问，但是现在为了支持“降本增效”，我就把之前腾讯云的 COS 图床彻底迁移到了 CF R2 上，毕竟对于我来说其提供的免费额度足够我目前的使用，后期如果实在超出额度，或者 CF R2 变更了其免费计划再考虑其他方案，比如 Onedrive 等。并且，其速度在国内网络环境下表现也能接受，甚至有时候能大部分全绿。</p><p><img src=https://s21.ax1x.com/2025/01/04/pEphQjf.png loading=lazy></p><p>其次，后面我会尽量少用图片，因为之前看自己的 Writeup 文章，用图片确实很奢侈，甚至拿到一个 FLAG 都要放张图，当时觉得无所谓，但是现在看起来，这其实没什么必要，因为这些图片跟你只用一句话解释“于是通过这样我拿到了FLAG”达到的表达效果其实并没有太多区别，一行文字能表达清楚的我就尽量不使用图片，除非这张图真的很有意义。</p><p>再者，对于真要放图的地方，我会考虑其对于阅读效果的影响。十分重要的，离开了这张图片就可能影响表达效果的，我就把他放到自己的 Github Repo 或者 CF R2 上；一般重要的，看情况放在 CF R2 上 或者 SM.MS 上；可以放张图，并且即使这张图挂了都不会影响阅读内容体验的图会放到 SM.MS / 路过等免费图床上。</p><p>在确定好自己的图床后，可以在 CF 上修改请求 R2 中图片的缓存时间，毕竟图片一般很少更改，我们可以直接增大缓存时间以获得良好的优化效果，我们可以在Cloudflare 面板中：</p><ol><li>缓存 / Cache Rules 中增加一条规则</li><li>默认配置下本身他已经帮我们配置好了很多静态资源的扩展名，我们可以直接使用他的配置，并再增加一条匹配规则，使其只匹配我们的图床域名： <code>(http.host eq "yourdomain.com")</code></li><li>缓存资格：选择 <em>符合缓存条件</em></li><li>边缘TTL：选择 <em>忽略缓存控制标头，使用此 TTL</em>，缓存时间设置为 <em>1 年</em></li><li>浏览器TTL：选择 <em>替代源服务器，使用此 TTL</em>，缓存时间设置为 <em>1 年</em></li><li>缓存密钥：开启 <em>缓存欺骗盔甲</em></li></ol><p>你可以自己选择觉得合适的缓存时间，我这里直接设置得比较大为一年。</p><p>除此以外，关于图床的优化还可以使用一些专门对于图片的缓存优化，比如 WebP Cloud ，详细参考以下：</p><ul><li><a class=link href=https://www.backblaze.com/blog/free-image-hosting-with-cloudflare-transform-rules-and-backblaze-b2/ target=_blank rel=noopener>Free Image Hosting With Cloudflare Transform Rules and Backblaze B2</a></li><li><a class=link href=https://sspai.com/post/90170 target=_blank rel=noopener>从零开始搭建你的免费图床系统 （Cloudflare R2 + WebP Cloud + PicGo）</a></li></ul><h3 id=cloudflare-workers>Cloudflare Workers</h3><p>CF workers 是 CF 推出的 Serverless 优秀工具，也是经常被用来作反代加速处理的不二选一，用好了的话可以在其免费额度内解决很多国内的网络环境问题，甚至某些魔法问题，可以参考：https://github.com/topics/cloudflare-workers</p><p>但是目前由于其官方分配的 workers.dev 很早就被屏蔽了，我们就需要绑定一个自己的域名来规避这个问题，后面我们会使用这个功能来实现一些 Google 服务的加速。</p><h2 id=theme-optimization>Theme Optimization</h2><p>这部分就是本博客主题的优化了</p><h3 id=cdn>CDN</h3><p>既然为静态资源配置 CDN ，那接下来我们就得修改主题资源的 URL 使其指向这些 CDN 链接啦。</p><div class="notice warning"><p class=notice-title><span class="icon-notice baseline"><svg viewBox="126 76.5 300 300"><path d="M297.431 324.397v-34.255c0-3.245-2.344-5.95-5.358-5.95h-32.146c-3.014.0-5.358 2.705-5.358 5.95v34.255c0 3.245 2.344 5.95 5.358 5.95h32.146c3.014.0 5.358-2.705 5.358-5.95zm-.335-67.428 3.014-82.753c0-1.081-.502-2.524-1.674-3.425-1.005-.902-2.512-1.983-4.019-1.983h-36.834c-1.507.0-3.014 1.081-4.019 1.983-1.172.901-1.674 2.704-1.674 3.786l2.846 82.392c0 2.344 2.512 4.146 5.693 4.146h30.975c3.013.0 5.525-1.803 5.692-4.146zm-2.344-168.39L423.34 342.425c3.683 7.032 3.516 15.686-.335 22.717-3.85 7.031-10.883 11.358-18.417 11.358H147.413c-7.534.0-14.566-4.327-18.417-11.358-3.85-7.031-4.018-15.685-.335-22.716L257.248 88.578C260.93 81.188 268.13 76.5 276 76.5s15.069 4.688 18.752 12.08z"/></svg>
</span>Warning</p><p>请在使用第三方 CDN 资源的时候注意配置 SRI 以免被投毒篡改</p></div><p>以我 stack 的主题为例，我为博客主题 <a class=link href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener>stack</a> 为例，在开发测试的时候，可以直接在 config.yaml 增加新的配置</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>    </span><span class=nt>cdn</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>github</span><span class=p>:</span><span class=w> </span><span class=l>https://cdn.zdy.one/gh/zeddyu/zeddyu.github.io/</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>如果使用的是生产配置模板 <a class=link href=https://github.com/CaiJimmy/hugo-theme-stack-starter target=_blank rel=noopener>starter</a> ，那么就需要在 config/_default/params.toml 中增加配置</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-toml data-lang=toml><span class=line><span class=cl><span class=p>[</span><span class=nx>cdn</span><span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=nx>github</span> <span class=p>=</span> <span class=s2>&#34;https://cdn.zdy.one/gh/zeddyu/zeddyu.github.io/&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>这个配置是为了方便直接在 Hugo 主题 HTML 模板中引入 CDN 链接，接下来就是为需要的地方对应添加 CDN 链接了，主要位置就是在各种引入了 CSS / JS / 图片 前添加我们的 CDN 链接 ，主要思路就是先判断是否存在 CDN 配置，如果存在就使用 CDN 链接替换掉原来的链接，参考代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=cl><span class=gd>--- &#34;layouts/partials/sidebar/left.html&#34;	1900-01-00 00:00:00 +0000
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+++ &#34;layouts/partials/sidebar/left.html&#34;	1900-01-00 00:00:00 +0000
</span></span></span><span class=line><span class=cl><span class=gi></span><span class=gu>@@ -17,8 +17,14 @@
</span></span></span><span class=line><span class=cl><span class=gu></span>                     
</span></span><span class=line><span class=cl>                     {{ if $avatar }}
</span></span><span class=line><span class=cl>                         {{ $avatarResized := $avatar.Resize &#34;300x&#34; }}
</span></span><span class=line><span class=cl><span class=gd>-                        &lt;img src=&#34;{{ $avatarResized.RelPermalink }}&#34; width=&#34;{{ $avatarResized.Width }}&#34;
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+                        {{ if $.Site.Params.cdn.github }}
</span></span></span><span class=line><span class=cl><span class=gi>+                            &lt;img src=&#34;{{ printf &#34;%s%s&#34; $.Site.Params.cdn.github $avatarResized.RelPermalink }}&#34; width=&#34;{{ $avatarResized.Width }}&#34;
</span></span></span><span class=line><span class=cl><span class=gi></span>                             height=&#34;{{ $avatarResized.Height }}&#34; class=&#34;site-logo&#34; loading=&#34;lazy&#34; alt=&#34;Avatar&#34;&gt;
</span></span><span class=line><span class=cl><span class=gi>+                        {{ else }}
</span></span></span><span class=line><span class=cl><span class=gi>+                            &lt;img src=&#34;{{ $avatarResized.RelPermalink }}&#34; width=&#34;{{ $avatarResized.Width }}&#34;
</span></span></span><span class=line><span class=cl><span class=gi>+                                height=&#34;{{ $avatarResized.Height }}&#34; class=&#34;site-logo&#34; loading=&#34;lazy&#34; alt=&#34;Avatar&#34;&gt;
</span></span></span><span class=line><span class=cl><span class=gi>+                        {{ end }}
</span></span></span><span class=line><span class=cl><span class=gi>+                        
</span></span></span><span class=line><span class=cl><span class=gi></span>                     {{ else }}
</span></span><span class=line><span class=cl>                         {{ errorf &#34;Failed loading avatar from %q&#34; . }}
</span></span><span class=line><span class=cl>                     {{ end }}
</span></span></code></pre></td></tr></table></div></div><p>以下是我为主题替换的地方：</p><ul><li><p>layouts/partials/sidebar/left.html: 左侧的头像图片</p></li><li><p>layouts/partials/head/style.html: 主要的 CSS 样式文件</p></li><li><p>layouts/partials/footer/components/script.html: 主要的 JS 文件，修改逻辑与上类似</p></li><li><p>layouts/page/search.html: search.js 文件，修改逻辑与上类似</p></li><li><p>layouts/_default/_markup/render-image.html: 为图片链接在 github.io 上的链接增加 CDN</p></li></ul><h3 id=google-analytics-4>Google Analytics 4</h3><p>如果直接使用 Hugo 内置的 Google Analysis 模板的话，我们可以从 <a class=link href=https://github.com/gohugoio/hugo/blob/master/tpl/tplimpl/embedded/templates/google_analytics.html target=_blank rel=noopener>_internal/google_analytics.html</a> 代码中看到，其直接使用了 script 标签引入 GA 4 的 JS 文件</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>async</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;https://www.googletagmanager.com/gtag/js?id={{ . }}&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>而在早些年的一个篇分析中 <a class=link href=https://dariusz.wieckiewicz.org/en/minimal-google-analytics-4-snippet/ target=_blank rel=noopener>A very Minimal Google Analytics 4 Snippet</a>，我们可以从中知道如果直接使用的话，可能会遇到几个问题：JS 文件体积过于臃肿 / 可能会被用户浏览器的广告拦截器拦截，并且在这篇文章中，也给出了比较直接的解决方案，那我们何乐不为呢？</p><p>但是如果直接使用 <a class=link href=https://www.google-analytics.com target=_blank rel=noopener>www.google-analytics.com</a> 域名的话，国内网络环境总是出现各种问题，从站长的测速来看福建联通稳定链接不上，所以我采用了另一种方案，就是使用 CF Workers 来进行 GA 4 的反代，这里主要参考：</p><ul><li><a class=link href=https://some.fylsen.com/posts/lightweight-google-analytics-cloudflare-workers-adblock-solution/ target=_blank rel=noopener>使用轻量版 Google Analytics：通过 Cloudflare Workers 规避拦截与优化性能</a></li><li><a class=link href=https://xxand.cc/61.html target=_blank rel=noopener>google analytics 用 Cloudflare workers 代理</a></li></ul><p>在 CF Workers 上部署以上博客其中一个脚本，再配合修改使用 <a class=link href=https://gist.github.com/idarek/9ade69ac2a2ef00d98ab950426af5791 target=_blank rel=noopener>Minimal Google Analytics Scripts</a> 即可，记得把其中的 collect_path 以及 GID 修改为自己的即可。</p><h3 id=service-worker>Service Worker</h3><p>在三年前的 <a class=link href=https://zeddyu.github.io/p/%e4%bb%8e-hexo-%e6%90%ac%e8%bf%81%e8%87%b3-hugo/ target=_blank rel=noopener>从 Hexo 搬迁至 Hugo</a> 中，我用 Workbox 实现 Service Worker Cache 相关的操作；三年过去后 Workbox 没有比较大的更新，现在已经有更多的博主使用 Workbox 来优化他们的博客，所以我也参考了现在比较流行的一些配置，改进了一下我的 Workbox 脚本，具体代码可见 <a class=link href=https://cdn.jsdelivr.net/gh/zeddyu/zeddyu.github.io/sw.min.js target=_blank rel=noopener>https://cdn.jsdelivr.net/gh/zeddyu/zeddyu.github.io/sw.min.js</a></p><p>主要按照 Google Workbox 官方的 <a class=link href=https://developer.chrome.com/docs/workbox/modules/workbox-recipes target=_blank rel=noopener>workbox-recipes</a> 文档进行了增改，同时也了解了一下 Workbox 的 precache 策略：</p><blockquote><p>One feature of service workers is the ability to save a set of files to the cache when the service worker is installing. This is often referred to as &ldquo;precaching&rdquo;, since you are caching content ahead of the service worker being used.</p></blockquote><p>从 <a class=link href=https://developer.chrome.com/docs/workbox/modules/workbox-precaching target=_blank rel=noopener>workbox-precaching</a> 理论上来说，我们可以在 Service Worker 的安装过程中就提前请求缓存所需要的资源，这个比较适合用来提前缓存首页加载所需要的内容资源。因为我们几乎所有静态资源都上了 CDN ，所以一开始我试图用来缓存我配置的 CDN 上的静态资源，但是令人比较意外的是这个函数严格限制了跨域资源的加载，并且不管你 CORS 与否，相关代码见 <a class=link href=https://github.com/GoogleChrome/workbox/blob/v7/packages/workbox-core/src/copyResponse.ts#L26 target=_blank rel=noopener>workbox/packages/workbox-core/src/copyResponse.ts#L26</a> ：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>     * This method is intentionally limited to same-origin responses, regardless of
</span></span><span class=line><span class=cl>     * whether CORS was used or not.
</span></span></code></pre></td></tr></table></div></div><p>这就让我不得不放弃对 CDN 资源使用 precaching 策略，尽管也有 <a class=link href=https://developer.chrome.com/docs/workbox/modules/workbox-recipes#warm_strategy_cache target=_blank rel=noopener>Warm Page Cache</a> 作为平替，但是最好的做法当然不适用 Cache 这些 CDN 上的资源了，而且使用 StaleWhileRevalidate 的策略也不会影响太多。虽然我们也可以放弃对我们页面静态资源加 CDN ，直接请求 github.io/style.min.css 来使用，但是按照国内网络环境这速度，我觉得还是加上 CDN 为好，毕竟第一次打开还是更费时的。</p><h3 id=speculation-rules>Speculation Rules</h3><p>在了解 precaching 的过程中，我还意外找到了另一种优化策略: <a class=link href=https://developer.mozilla.org/en-US/docs/Web/API/Speculation_Rules_API target=_blank rel=noopener>Speculation Rules API</a> ( 这里突然想起之前的某个 CTF 就出过类似的题目，没想到将之用于自己的博客优化上，搜了一下竟然只有上个月的 SECCON CTF ，但是我应该有印象的不是在这个比赛的题目&mldr; )</p><blockquote><p>The <strong>Speculation Rules API</strong> is designed to improve performance for future navigations. It targets document URLs rather than specific resource files, and so makes sense for multi-page applications (MPAs) rather than single-page applications (SPAs).</p></blockquote><p>回到主题，Speculation Rules 不难从其名字就能知道，这个是用来推测用户行为的一个 API ，有点类似于我之前在使用 Hexo 主题的时候使用的一个插件 <a class=link href=https://instant.page/ target=_blank rel=noopener>instant.page</a> ，大概效果说白了就是按照一定的规则，根据用户的鼠标行为（例如悬停，点击等）提前让浏览器做出行为，比如用户鼠标放在一个超链接上，它会根据页面的策略是否提前向该链接发起请求、后台渲染，亦或者在浏览器处于空闲状态时候对页面的超链接进行分析并按照策略提前发起请求等。总之，这是稍微预判用户行为，并在用户做出行动前就采取请求的 API 功能。</p><p>一开始我原本想手写 Speculation Rules 来进行我博客的适配，但是写了一些规则总对于他的文档说明有点摸不着头脑的感觉，例如如果在 Speculation Rules 中使用 <code>urls</code> ，例如使用以下配置：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&#34;urls&#34;: [&#34;/about/&#34;, &#34;/archives/&#34;, &#34;/ads/&#34;, &#34;/categories/&#34;, &#34;/links/&#34;, &#34;/search/&#34;, &#34;/&#34;],
</span></span></code></pre></td></tr></table></div></div><p>按照这个配置， Chrome 会使用当前路径加上 urls 列表进行匹配，比如如果当前页面路径为 <code>/about/</code> ，那么 Chrome 会根据对应配置的策略对 <code>/about/ads</code> 进行 Prefetch / Prerender 获取，这就有点反直觉，毕竟我是加了根目录的斜杠。</p><p>后来发现早就有了更为成熟的框架 <a class=link href=https://github.com/GoogleChromeLabs/quicklink target=_blank rel=noopener>quicklink</a> 来实现、拓展 Prefetches / Prerender ，而且使用起来也比较简单，提供了对应的 API ，当然我们也可以直接让 quicklink 自己决定页面的策略:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;https://cdn.jsdelivr.net/npm/quicklink@2.3.0/dist/quicklink.umd.js&#34;</span> <span class=na>defer</span> <span class=na>integrity</span><span class=o>=</span><span class=s>&#34;sha256-yvJQOINiH9fWemHn0vCA5lsHWJaHs6/ZmO+1Ft04SvM=&#34;</span> <span class=na>crossorigin</span><span class=o>=</span><span class=s>&#34;anonymous&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=nb>window</span><span class=p>.</span><span class=nx>addEventListener</span><span class=p>(</span><span class=s1>&#39;load&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>quicklink</span><span class=p>.</span><span class=nx>listen</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>当然如果你对 Speculation Rules 感兴趣，也可以参考以下几个文档：</p><ul><li><p><a class=link href=https://developer.mozilla.org/en-US/docs/Web/HTML/Element/script/type/speculationrules target=_blank rel=noopener>speculationrules</a></p></li><li><p><a class=link href=https://wicg.github.io/nav-speculation/speculation-rules.html target=_blank rel=noopener>Speculation Rules</a></p></li><li><p><a class=link href=https://codelabs.developers.google.com/speculation-rules target=_blank rel=noopener>通过 Speculation Rules API 实现即时导航</a></p></li><li><p><a class=link href=https://developer.chrome.com/docs/web-platform/prerender-pages target=_blank rel=noopener>Prerender pages in Chrome for instant page navigations</a></p></li><li><p><a class=link href=https://web.dev/learn/performance/prefetching-prerendering-precaching target=_blank rel=noopener>Prefetching, prerendering, and service worker precaching</a></p></li></ul><h3 id=other-optimizations>Other Optimizations</h3><p>还有一些其他的优化，可以使用 Chrome 开发者工具栏的 Lighthouse 进行测试，也可以使用在线版 <a class=link href=https://pagespeed.web.dev/ target=_blank rel=noopener>PageSpeed Insights</a> ，也或者使用 <a class=link href=https://www.webpagetest.org/ target=_blank rel=noopener>WebpageTest</a> ，尽管他们出的报告好像都差不多。基于这些报告，我们可以从中得到一些优化建议，比如</p><ul><li>头像的 PNG 可以换成 Webp</li><li>非主要的 CSS / JS 文件可以加 <code>defer</code> 等异步</li></ul><p>当然这些建议都比较机械化，只是简单判断是否存在 A 便提出建议 B ，是否要采用这个建议还需要根据你自己的需求，否则有些时候一味提升这个固化的表面“速度”分数恰好适得其反。</p><p>当然这里列举一些我了解到的其他优化方案，比如可以替换的服务：</p><ul><li>Cloudflare<ul><li>对于流量分流来说，有些博客使用了某些国内云厂商的智能 DNS ，从 DNS 解析就做了国内外的流量分流，这也是一个不错的选择。但是鉴于你涉及到国内的 DNS ，自然逃不开备案的那一套，所以我就直接放弃了这个想法</li></ul></li><li>Github Page<ul><li>Vercel (国内已屏蔽): 2021年左右的时候，因为当时我还持有自己的域名，我有考虑过将博客从 Github Page 迁移到其他对国内网络环境比较友好的服务商上，当时就听说 Vercel 对国内网络环境比较友好，结果没想到现在我用国内网络环境测试我之前部署在 Vercel 上的站点已经彻底无法打开了，而且 Vercel 对于超出一定额度的流量收费也是劝退了我。<ul><li>当然你也可以通过其他方式来绕过屏蔽限制，但是本身我之前想用 Vercel 就是因为其对国内网络环境稍微友好一些，一旦失去了这个优势那就没有换的必要了。</li></ul></li><li>Cloudflare Page: CF 大善人的静态页面托管服务，这个取决于国内用户访问 CF 的网络速度</li><li>还有一些其他静态页面托管服务，但是总体来说与 Github Page 大差不差，没有 Vercel 当初那种能直接提供网络优势的，所以基本没有切换的动力，以及后期确实不考虑运营域名的情况，还是主要以使用 Github Page 为主</li></ul></li><li>图床服务：<ul><li><a class=link href=https://www.backblaze.com/cloud-storage/pricing target=_blank rel=noopener>Backblaze B2</a>: 提供免费的 10GB 试用，而且外出流量免费，综合对比其他国外的存储服务还是很有优势的</li><li>Cloudflare R2: 免费 10GB 存储，外出流量免费</li><li>Onedrive: 个人免费 5GB 存储，外出免费</li><li><a class=link href=https://sm.ms/ target=_blank rel=noopener>SM.MS</a> : 个人免费 5GB 存储，外出免费</li><li><a class=link href=https://imgse.com/ target=_blank rel=noopener>路过图床</a>: 没有找到免费计划的额度</li></ul></li></ul><p>目前 (2025-01-05) 可以在国内网络环境下，直接使用的服务：</p><ul><li>Google Fonts: Google Fonts 在国内仍可以访问并且速度也不错，可以直接使用，<ul><li>当然你要是不放心，也可以参考 USTC 的方案： <a class=link href=https://github.com/ustclug/discussions/issues/325#issuecomment-637319675 target=_blank rel=noopener>*.proxy.ustclug.org 等服务无法访问，以及后续计划</a></li><li>使用 CF Workers 实现反代</li><li>其他备选方案(并不推荐)：<ul><li>fonts.loli.net: <a class=link href="https://fonts.loli.net/css2?family=Lato:wght@300;400;700&amp;display=swap" target=_blank rel=noopener>https://fonts.loli.net/css2?family=Lato:wght@300;400;700&display=swap</a></li><li>fonts.font.im: <a class=link href=https://www.googlefonts.cn/ target=_blank rel=noopener>https://www.googlefonts.cn/</a> 国内站长提供的 CDN 服务，可靠性未知</li></ul></li></ul></li><li>Cloudflare:<ul><li>R2: 国内网络环境支持不错</li><li>Page: 直接分配的域名在国内访问的速度跟 Github Page 半斤八两</li></ul></li></ul><h2 id=summary>Summary</h2><p>除了以上优化以外，自己花的这几天时间也跟进了一波目前 Web (主要是 CSS / Browser ) 的新特性，有一些改进确实很方便，也挺有趣的，但是由于不在我用的那些特性并不算对于博客的优化，只是我用来修改自己对于主题不太满意的地方；Cloudflare 可玩性确实很高，还有很多值得探索利用的功能，以后可能会经常关注其新功能的支持，也算是增加一下对业界的了解，以后也会尽力回归到博客的日常更新中。</p><p>最后，祝看到这里的各位新年快乐！</p></section><footer class=article-footer><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section><br><div class="notice tip"><p class=notice-title><span class="icon-notice baseline"><svg viewBox="300.5 134 300 300"><path d="M551.281 252.36c0-3.32-1.172-6.641-3.515-8.985l-17.774-17.578c-2.344-2.344-5.469-3.711-8.789-3.711-3.32.0-6.445 1.367-8.789 3.71l-79.687 79.493-44.141-44.14c-2.344-2.344-5.469-3.712-8.79-3.712-3.32.0-6.444 1.368-8.788 3.711l-17.774 17.579c-2.343 2.343-3.515 5.664-3.515 8.984s1.172 6.445 3.515 8.789l70.704 70.703c2.343 2.344 5.664 3.711 8.789 3.711 3.32.0 6.64-1.367 8.984-3.71l106.055-106.056c2.343-2.343 3.515-5.468 3.515-8.789zM600.5 284c0 82.813-67.188 150-150 150-82.813.0-150-67.188-150-150 0-82.813 67.188-150 150-150 82.813.0 150 67.188 150 150z"/></svg>
</span>Tip</p><p>I am looking for some guys who have a strong interest in CTFs to build a team focused on international CTFs that are on the ctftime.org, if anyone is interested in this idea you can take a look at here: <a class=link href=https://zeddyu.github.io/advertisement/#international-ctf-team target=_blank rel=noopener>Advertisements</a></p><p>想了解更多有意思的国际赛 CTF 中 Web 知识技巧，欢迎加入我的 <a class=link href=https://zeddyu.github.io/advertisement/#%e7%9f%a5%e8%af%86%e6%98%9f%e7%90%83 target=_blank rel=noopener>知识星球</a> ; 另外我正在召集一群小伙伴组建一支专注国际 CTF 的队伍，如果有感兴趣的小伙伴也可在 <a class=link href=https://zeddyu.github.io/advertisement/#international-ctf-team target=_blank rel=noopener>International CTF Team</a> 查看详情</p></div></footer></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/p/%E4%BB%8E-hexo-%E6%90%AC%E8%BF%81%E8%87%B3-hugo/><div class=article-details><h2 class=article-title>从 Hexo 搬迁至 Hugo</h2></div></a></article><article><a href=/p/flutter-packages-get-424%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/><div class=article-details><h2 class=article-title>Flutter packages get 424问题解决方法</h2></div></a></article><article><a href=/p/mac-idea-%E5%90%AF%E5%8A%A8tomcat%E7%AB%AF%E5%8F%A3%E5%8D%A0%E7%94%A8%E5%A5%87%E5%BC%82%E9%97%AE%E9%A2%98/><div class=article-details><h2 class=article-title>Mac idea 启动tomcat端口占用奇异问题</h2></div></a></article><article><a href=/p/%E5%8D%9A%E5%AE%A2%E8%87%AA%E5%8A%A8%E5%8C%96%E5%8F%8A%E4%B8%80%E4%BA%9B%E5%9D%91/><div class=article-details><h2 class=article-title>博客自动化及一些坑</h2></div></a></article><article><a href=/p/macos-x-%E4%B8%8B%E9%85%8D%E7%BD%AEnginx-amp-php/><div class=article-details><h2 class=article-title>MacOS X 下配置Nginx &amp;amp; PHP</h2></div></a></article></div></div></aside><script src=https://giscus.app/client.js data-repo=ZeddYu/ZeddYu.github.io data-repo-id="MDEwOlJlcG9zaXRvcnkzMzgyODQ1OTY=" data-category=Announcements data-category-id=DIC_kwDOFCnQNM4ClsKy data-mapping=title data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=light data-lang=en data-loading=lazy crossorigin=anonymous async></script><script>function setGiscusTheme(e){let t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:{setConfig:{theme:e}}},"https://giscus.app")}(function(){addEventListener("message",t=>{if(event.origin!=="https://giscus.app")return;e()}),window.addEventListener("onColorSchemeChange",e);function e(){setGiscusTheme(document.documentElement.dataset.scheme==="light"?"light":"dark_dimmed")}})()</script><footer class=site-footer><section class=copyright>&copy;
2020 -
2025 Zeddy's Blog</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.29.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.zdy.one/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.zdy.one/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.zdy.one/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.zdy.one/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.zdy.one/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=https://cdn.zdy.world/gh/zeddyu/zeddyu.github.io///ts/main.js defer integrity="sha256-Hpo7r9hGztTDRdCEs1X7jHuudXAcM4+KH4qCx4ATeCY=" crossorigin=anonymous></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script><script>"serviceWorker"in navigator&&window.addEventListener("load",function(){navigator.serviceWorker.register("https://zeddyu.github.io/sw.min.js").then(function(e){console.log("ServiceWorker registration successful with scope: ",e.scope)},function(e){console.log("ServiceWorker registration failed: ",e)})})</script><script src=https://cdn.zdy.one/npm/quicklink@2.3.0/dist/quicklink.umd.js defer integrity="sha256-yvJQOINiH9fWemHn0vCA5lsHWJaHs6/ZmO+1Ft04SvM=" crossorigin=anonymous></script><script>function checkNetworkEnvironment(){if(navigator.connection){const e=navigator.connection,t=e.effectiveType==="4g"&&e.downlink>5;t?quicklink.listen():console.log("Network is poor, skipping speculation rules")}else console.log("Network Information API not supported")}window.addEventListener("load",checkNetworkEnvironment)</script></body></html>